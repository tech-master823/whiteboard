/*! For license information please see main.b8072b35.js.LICENSE.txt */
(()=>{var e={7283:e=>{"use strict";var t=Object.prototype.hasOwnProperty,n="~";function o(){}function r(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function i(e,t,o,i,s){if("function"!==typeof o)throw new TypeError("The listener must be a function");var a=new r(o,i||e,s),l=n?n+t:t;return e._events[l]?e._events[l].fn?e._events[l]=[e._events[l],a]:e._events[l].push(a):(e._events[l]=a,e._eventsCount++),e}function s(e,t){0===--e._eventsCount?e._events=new o:delete e._events[t]}function a(){this._events=new o,this._eventsCount=0}Object.create&&(o.prototype=Object.create(null),(new o).__proto__||(n=!1)),a.prototype.eventNames=function(){var e,o,r=[];if(0===this._eventsCount)return r;for(o in e=this._events)t.call(e,o)&&r.push(n?o.slice(1):o);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(e)):r},a.prototype.listeners=function(e){var t=n?n+e:e,o=this._events[t];if(!o)return[];if(o.fn)return[o.fn];for(var r=0,i=o.length,s=new Array(i);r<i;r++)s[r]=o[r].fn;return s},a.prototype.listenerCount=function(e){var t=n?n+e:e,o=this._events[t];return o?o.fn?1:o.length:0},a.prototype.emit=function(e,t,o,r,i,s){var a=n?n+e:e;if(!this._events[a])return!1;var l,c,d=this._events[a],u=arguments.length;if(d.fn){switch(d.once&&this.removeListener(e,d.fn,void 0,!0),u){case 1:return d.fn.call(d.context),!0;case 2:return d.fn.call(d.context,t),!0;case 3:return d.fn.call(d.context,t,o),!0;case 4:return d.fn.call(d.context,t,o,r),!0;case 5:return d.fn.call(d.context,t,o,r,i),!0;case 6:return d.fn.call(d.context,t,o,r,i,s),!0}for(c=1,l=new Array(u-1);c<u;c++)l[c-1]=arguments[c];d.fn.apply(d.context,l)}else{var h,p=d.length;for(c=0;c<p;c++)switch(d[c].once&&this.removeListener(e,d[c].fn,void 0,!0),u){case 1:d[c].fn.call(d[c].context);break;case 2:d[c].fn.call(d[c].context,t);break;case 3:d[c].fn.call(d[c].context,t,o);break;case 4:d[c].fn.call(d[c].context,t,o,r);break;default:if(!l)for(h=1,l=new Array(u-1);h<u;h++)l[h-1]=arguments[h];d[c].fn.apply(d[c].context,l)}}return!0},a.prototype.on=function(e,t,n){return i(this,e,t,n,!1)},a.prototype.once=function(e,t,n){return i(this,e,t,n,!0)},a.prototype.removeListener=function(e,t,o,r){var i=n?n+e:e;if(!this._events[i])return this;if(!t)return s(this,i),this;var a=this._events[i];if(a.fn)a.fn!==t||r&&!a.once||o&&a.context!==o||s(this,i);else{for(var l=0,c=[],d=a.length;l<d;l++)(a[l].fn!==t||r&&!a[l].once||o&&a[l].context!==o)&&c.push(a[l]);c.length?this._events[i]=1===c.length?c[0]:c:s(this,i)}return this},a.prototype.removeAllListeners=function(e){var t;return e?(t=n?n+e:e,this._events[t]&&s(this,t)):(this._events=new o,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=n,a.EventEmitter=a,e.exports=a},67:(e,t,n)=>{e=n.nmd(e);var o="__lodash_hash_undefined__",r=9007199254740991,i="[object Arguments]",s="[object Array]",a="[object Boolean]",l="[object Date]",c="[object Error]",d="[object Function]",u="[object Map]",h="[object Number]",p="[object Object]",f="[object Promise]",g="[object RegExp]",m="[object Set]",y="[object String]",v="[object Symbol]",b="[object WeakMap]",w="[object ArrayBuffer]",x="[object DataView]",S=/^\[object .+?Constructor\]$/,k=/^(?:0|[1-9]\d*)$/,P={};P["[object Float32Array]"]=P["[object Float64Array]"]=P["[object Int8Array]"]=P["[object Int16Array]"]=P["[object Int32Array]"]=P["[object Uint8Array]"]=P["[object Uint8ClampedArray]"]=P["[object Uint16Array]"]=P["[object Uint32Array]"]=!0,P[i]=P[s]=P[w]=P[a]=P[x]=P[l]=P[c]=P[d]=P[u]=P[h]=P[p]=P[g]=P[m]=P[y]=P[b]=!1;var C="object"==typeof n.g&&n.g&&n.g.Object===Object&&n.g,_="object"==typeof self&&self&&self.Object===Object&&self,I=C||_||Function("return this")(),E=t&&!t.nodeType&&t,j=E&&e&&!e.nodeType&&e,T=j&&j.exports===E,M=T&&C.process,A=function(){try{return M&&M.binding&&M.binding("util")}catch(e){}}(),O=A&&A.isTypedArray;function D(e,t){for(var n=-1,o=null==e?0:e.length;++n<o;)if(t(e[n],n,e))return!0;return!1}function R(e){var t=-1,n=Array(e.size);return e.forEach((function(e,o){n[++t]=[o,e]})),n}function L(e){var t=-1,n=Array(e.size);return e.forEach((function(e){n[++t]=e})),n}var z,N,F=Array.prototype,B=Function.prototype,U=Object.prototype,H=I["__core-js_shared__"],K=B.toString,V=U.hasOwnProperty,W=function(){var e=/[^.]+$/.exec(H&&H.keys&&H.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),q=U.toString,Y=RegExp("^"+K.call(V).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),G=T?I.Buffer:void 0,X=I.Symbol,$=I.Uint8Array,Z=U.propertyIsEnumerable,Q=F.splice,J=X?X.toStringTag:void 0,ee=Object.getOwnPropertySymbols,te=G?G.isBuffer:void 0,ne=(z=Object.keys,N=Object,function(e){return z(N(e))}),oe=Me(I,"DataView"),re=Me(I,"Map"),ie=Me(I,"Promise"),se=Me(I,"Set"),ae=Me(I,"WeakMap"),le=Me(Object,"create"),ce=Re(oe),de=Re(re),ue=Re(ie),he=Re(se),pe=Re(ae),fe=X?X.prototype:void 0,ge=fe?fe.valueOf:void 0;function me(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var o=e[t];this.set(o[0],o[1])}}function ye(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var o=e[t];this.set(o[0],o[1])}}function ve(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var o=e[t];this.set(o[0],o[1])}}function be(e){var t=-1,n=null==e?0:e.length;for(this.__data__=new ve;++t<n;)this.add(e[t])}function we(e){var t=this.__data__=new ye(e);this.size=t.size}function xe(e,t){var n=Ne(e),o=!n&&ze(e),r=!n&&!o&&Fe(e),i=!n&&!o&&!r&&Ve(e),s=n||o||r||i,a=s?function(e,t){for(var n=-1,o=Array(e);++n<e;)o[n]=t(n);return o}(e.length,String):[],l=a.length;for(var c in e)!t&&!V.call(e,c)||s&&("length"==c||r&&("offset"==c||"parent"==c)||i&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||De(c,l))||a.push(c);return a}function Se(e,t){for(var n=e.length;n--;)if(Le(e[n][0],t))return n;return-1}function ke(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":J&&J in Object(e)?function(e){var t=V.call(e,J),n=e[J];try{e[J]=void 0;var o=!0}catch(i){}var r=q.call(e);o&&(t?e[J]=n:delete e[J]);return r}(e):function(e){return q.call(e)}(e)}function Pe(e){return Ke(e)&&ke(e)==i}function Ce(e,t,n,o,r){return e===t||(null==e||null==t||!Ke(e)&&!Ke(t)?e!==e&&t!==t:function(e,t,n,o,r,d){var f=Ne(e),b=Ne(t),S=f?s:Oe(e),k=b?s:Oe(t),P=(S=S==i?p:S)==p,C=(k=k==i?p:k)==p,_=S==k;if(_&&Fe(e)){if(!Fe(t))return!1;f=!0,P=!1}if(_&&!P)return d||(d=new we),f||Ve(e)?Ee(e,t,n,o,r,d):function(e,t,n,o,r,i,s){switch(n){case x:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case w:return!(e.byteLength!=t.byteLength||!i(new $(e),new $(t)));case a:case l:case h:return Le(+e,+t);case c:return e.name==t.name&&e.message==t.message;case g:case y:return e==t+"";case u:var d=R;case m:var p=1&o;if(d||(d=L),e.size!=t.size&&!p)return!1;var f=s.get(e);if(f)return f==t;o|=2,s.set(e,t);var b=Ee(d(e),d(t),o,r,i,s);return s.delete(e),b;case v:if(ge)return ge.call(e)==ge.call(t)}return!1}(e,t,S,n,o,r,d);if(!(1&n)){var I=P&&V.call(e,"__wrapped__"),E=C&&V.call(t,"__wrapped__");if(I||E){var j=I?e.value():e,T=E?t.value():t;return d||(d=new we),r(j,T,n,o,d)}}if(!_)return!1;return d||(d=new we),function(e,t,n,o,r,i){var s=1&n,a=je(e),l=a.length,c=je(t),d=c.length;if(l!=d&&!s)return!1;var u=l;for(;u--;){var h=a[u];if(!(s?h in t:V.call(t,h)))return!1}var p=i.get(e);if(p&&i.get(t))return p==t;var f=!0;i.set(e,t),i.set(t,e);var g=s;for(;++u<l;){var m=e[h=a[u]],y=t[h];if(o)var v=s?o(y,m,h,t,e,i):o(m,y,h,e,t,i);if(!(void 0===v?m===y||r(m,y,n,o,i):v)){f=!1;break}g||(g="constructor"==h)}if(f&&!g){var b=e.constructor,w=t.constructor;b==w||!("constructor"in e)||!("constructor"in t)||"function"==typeof b&&b instanceof b&&"function"==typeof w&&w instanceof w||(f=!1)}return i.delete(e),i.delete(t),f}(e,t,n,o,r,d)}(e,t,n,o,Ce,r))}function _e(e){return!(!He(e)||function(e){return!!W&&W in e}(e))&&(Be(e)?Y:S).test(Re(e))}function Ie(e){if(!function(e){var t=e&&e.constructor,n="function"==typeof t&&t.prototype||U;return e===n}(e))return ne(e);var t=[];for(var n in Object(e))V.call(e,n)&&"constructor"!=n&&t.push(n);return t}function Ee(e,t,n,o,r,i){var s=1&n,a=e.length,l=t.length;if(a!=l&&!(s&&l>a))return!1;var c=i.get(e);if(c&&i.get(t))return c==t;var d=-1,u=!0,h=2&n?new be:void 0;for(i.set(e,t),i.set(t,e);++d<a;){var p=e[d],f=t[d];if(o)var g=s?o(f,p,d,t,e,i):o(p,f,d,e,t,i);if(void 0!==g){if(g)continue;u=!1;break}if(h){if(!D(t,(function(e,t){if(s=t,!h.has(s)&&(p===e||r(p,e,n,o,i)))return h.push(t);var s}))){u=!1;break}}else if(p!==f&&!r(p,f,n,o,i)){u=!1;break}}return i.delete(e),i.delete(t),u}function je(e){return function(e,t,n){var o=t(e);return Ne(e)?o:function(e,t){for(var n=-1,o=t.length,r=e.length;++n<o;)e[r+n]=t[n];return e}(o,n(e))}(e,We,Ae)}function Te(e,t){var n=e.__data__;return function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}(t)?n["string"==typeof t?"string":"hash"]:n.map}function Me(e,t){var n=function(e,t){return null==e?void 0:e[t]}(e,t);return _e(n)?n:void 0}me.prototype.clear=function(){this.__data__=le?le(null):{},this.size=0},me.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},me.prototype.get=function(e){var t=this.__data__;if(le){var n=t[e];return n===o?void 0:n}return V.call(t,e)?t[e]:void 0},me.prototype.has=function(e){var t=this.__data__;return le?void 0!==t[e]:V.call(t,e)},me.prototype.set=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=le&&void 0===t?o:t,this},ye.prototype.clear=function(){this.__data__=[],this.size=0},ye.prototype.delete=function(e){var t=this.__data__,n=Se(t,e);return!(n<0)&&(n==t.length-1?t.pop():Q.call(t,n,1),--this.size,!0)},ye.prototype.get=function(e){var t=this.__data__,n=Se(t,e);return n<0?void 0:t[n][1]},ye.prototype.has=function(e){return Se(this.__data__,e)>-1},ye.prototype.set=function(e,t){var n=this.__data__,o=Se(n,e);return o<0?(++this.size,n.push([e,t])):n[o][1]=t,this},ve.prototype.clear=function(){this.size=0,this.__data__={hash:new me,map:new(re||ye),string:new me}},ve.prototype.delete=function(e){var t=Te(this,e).delete(e);return this.size-=t?1:0,t},ve.prototype.get=function(e){return Te(this,e).get(e)},ve.prototype.has=function(e){return Te(this,e).has(e)},ve.prototype.set=function(e,t){var n=Te(this,e),o=n.size;return n.set(e,t),this.size+=n.size==o?0:1,this},be.prototype.add=be.prototype.push=function(e){return this.__data__.set(e,o),this},be.prototype.has=function(e){return this.__data__.has(e)},we.prototype.clear=function(){this.__data__=new ye,this.size=0},we.prototype.delete=function(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n},we.prototype.get=function(e){return this.__data__.get(e)},we.prototype.has=function(e){return this.__data__.has(e)},we.prototype.set=function(e,t){var n=this.__data__;if(n instanceof ye){var o=n.__data__;if(!re||o.length<199)return o.push([e,t]),this.size=++n.size,this;n=this.__data__=new ve(o)}return n.set(e,t),this.size=n.size,this};var Ae=ee?function(e){return null==e?[]:(e=Object(e),function(e,t){for(var n=-1,o=null==e?0:e.length,r=0,i=[];++n<o;){var s=e[n];t(s,n,e)&&(i[r++]=s)}return i}(ee(e),(function(t){return Z.call(e,t)})))}:function(){return[]},Oe=ke;function De(e,t){return!!(t=null==t?r:t)&&("number"==typeof e||k.test(e))&&e>-1&&e%1==0&&e<t}function Re(e){if(null!=e){try{return K.call(e)}catch(t){}try{return e+""}catch(t){}}return""}function Le(e,t){return e===t||e!==e&&t!==t}(oe&&Oe(new oe(new ArrayBuffer(1)))!=x||re&&Oe(new re)!=u||ie&&Oe(ie.resolve())!=f||se&&Oe(new se)!=m||ae&&Oe(new ae)!=b)&&(Oe=function(e){var t=ke(e),n=t==p?e.constructor:void 0,o=n?Re(n):"";if(o)switch(o){case ce:return x;case de:return u;case ue:return f;case he:return m;case pe:return b}return t});var ze=Pe(function(){return arguments}())?Pe:function(e){return Ke(e)&&V.call(e,"callee")&&!Z.call(e,"callee")},Ne=Array.isArray;var Fe=te||function(){return!1};function Be(e){if(!He(e))return!1;var t=ke(e);return t==d||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t}function Ue(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=r}function He(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}function Ke(e){return null!=e&&"object"==typeof e}var Ve=O?function(e){return function(t){return e(t)}}(O):function(e){return Ke(e)&&Ue(e.length)&&!!P[ke(e)]};function We(e){return null!=(t=e)&&Ue(t.length)&&!Be(t)?xe(e):Ie(e);var t}e.exports=function(e,t){return Ce(e,t)}},381:(e,t,n)=>{var o="Expected a function",r=/^\s+|\s+$/g,i=/^[-+]0x[0-9a-f]+$/i,s=/^0b[01]+$/i,a=/^0o[0-7]+$/i,l=parseInt,c="object"==typeof n.g&&n.g&&n.g.Object===Object&&n.g,d="object"==typeof self&&self&&self.Object===Object&&self,u=c||d||Function("return this")(),h=Object.prototype.toString,p=Math.max,f=Math.min,g=function(){return u.Date.now()};function m(e,t,n){var r,i,s,a,l,c,d=0,u=!1,h=!1,m=!0;if("function"!=typeof e)throw new TypeError(o);function b(t){var n=r,o=i;return r=i=void 0,d=t,a=e.apply(o,n)}function w(e){var n=e-c;return void 0===c||n>=t||n<0||h&&e-d>=s}function x(){var e=g();if(w(e))return S(e);l=setTimeout(x,function(e){var n=t-(e-c);return h?f(n,s-(e-d)):n}(e))}function S(e){return l=void 0,m&&r?b(e):(r=i=void 0,a)}function k(){var e=g(),n=w(e);if(r=arguments,i=this,c=e,n){if(void 0===l)return function(e){return d=e,l=setTimeout(x,t),u?b(e):a}(c);if(h)return l=setTimeout(x,t),b(c)}return void 0===l&&(l=setTimeout(x,t)),a}return t=v(t)||0,y(n)&&(u=!!n.leading,s=(h="maxWait"in n)?p(v(n.maxWait)||0,t):s,m="trailing"in n?!!n.trailing:m),k.cancel=function(){void 0!==l&&clearTimeout(l),d=0,r=c=i=l=void 0},k.flush=function(){return void 0===l?a:S(g())},k}function y(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function v(e){if("number"==typeof e)return e;if(function(e){return"symbol"==typeof e||function(e){return!!e&&"object"==typeof e}(e)&&"[object Symbol]"==h.call(e)}(e))return NaN;if(y(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=y(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(r,"");var n=s.test(e);return n||a.test(e)?l(e.slice(2),n?2:8):i.test(e)?NaN:+e}e.exports=function(e,t,n){var r=!0,i=!0;if("function"!=typeof e)throw new TypeError(o);return y(n)&&(r="leading"in n?!!n.leading:r,i="trailing"in n?!!n.trailing:i),m(e,t,{leading:r,maxWait:t,trailing:i})}},5040:(e,t,n)=>{var o="__lodash_hash_undefined__",r="[object Function]",i="[object GeneratorFunction]",s=/^\[object .+?Constructor\]$/,a="object"==typeof n.g&&n.g&&n.g.Object===Object&&n.g,l="object"==typeof self&&self&&self.Object===Object&&self,c=a||l||Function("return this")();function d(e,t){return!!(e?e.length:0)&&function(e,t,n){if(t!==t)return function(e,t,n,o){var r=e.length,i=n+(o?1:-1);for(;o?i--:++i<r;)if(t(e[i],i,e))return i;return-1}(e,h,n);var o=n-1,r=e.length;for(;++o<r;)if(e[o]===t)return o;return-1}(e,t,0)>-1}function u(e,t,n){for(var o=-1,r=e?e.length:0;++o<r;)if(n(t,e[o]))return!0;return!1}function h(e){return e!==e}function p(e,t){return e.has(t)}function f(e){var t=-1,n=Array(e.size);return e.forEach((function(e){n[++t]=e})),n}var g=Array.prototype,m=Function.prototype,y=Object.prototype,v=c["__core-js_shared__"],b=function(){var e=/[^.]+$/.exec(v&&v.keys&&v.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),w=m.toString,x=y.hasOwnProperty,S=y.toString,k=RegExp("^"+w.call(x).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),P=g.splice,C=L(c,"Map"),_=L(c,"Set"),I=L(Object,"create");function E(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var o=e[t];this.set(o[0],o[1])}}function j(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var o=e[t];this.set(o[0],o[1])}}function T(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var o=e[t];this.set(o[0],o[1])}}function M(e){var t=-1,n=e?e.length:0;for(this.__data__=new T;++t<n;)this.add(e[t])}function A(e,t){for(var n,o,r=e.length;r--;)if((n=e[r][0])===(o=t)||n!==n&&o!==o)return r;return-1}function O(e){if(!z(e)||(t=e,b&&b in t))return!1;var t,n=function(e){var t=z(e)?S.call(e):"";return t==r||t==i}(e)||function(e){var t=!1;if(null!=e&&"function"!=typeof e.toString)try{t=!!(e+"")}catch(n){}return t}(e)?k:s;return n.test(function(e){if(null!=e){try{return w.call(e)}catch(t){}try{return e+""}catch(t){}}return""}(e))}E.prototype.clear=function(){this.__data__=I?I(null):{}},E.prototype.delete=function(e){return this.has(e)&&delete this.__data__[e]},E.prototype.get=function(e){var t=this.__data__;if(I){var n=t[e];return n===o?void 0:n}return x.call(t,e)?t[e]:void 0},E.prototype.has=function(e){var t=this.__data__;return I?void 0!==t[e]:x.call(t,e)},E.prototype.set=function(e,t){return this.__data__[e]=I&&void 0===t?o:t,this},j.prototype.clear=function(){this.__data__=[]},j.prototype.delete=function(e){var t=this.__data__,n=A(t,e);return!(n<0)&&(n==t.length-1?t.pop():P.call(t,n,1),!0)},j.prototype.get=function(e){var t=this.__data__,n=A(t,e);return n<0?void 0:t[n][1]},j.prototype.has=function(e){return A(this.__data__,e)>-1},j.prototype.set=function(e,t){var n=this.__data__,o=A(n,e);return o<0?n.push([e,t]):n[o][1]=t,this},T.prototype.clear=function(){this.__data__={hash:new E,map:new(C||j),string:new E}},T.prototype.delete=function(e){return R(this,e).delete(e)},T.prototype.get=function(e){return R(this,e).get(e)},T.prototype.has=function(e){return R(this,e).has(e)},T.prototype.set=function(e,t){return R(this,e).set(e,t),this},M.prototype.add=M.prototype.push=function(e){return this.__data__.set(e,o),this},M.prototype.has=function(e){return this.__data__.has(e)};var D=_&&1/f(new _([,-0]))[1]==1/0?function(e){return new _(e)}:function(){};function R(e,t){var n=e.__data__;return function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}(t)?n["string"==typeof t?"string":"hash"]:n.map}function L(e,t){var n=function(e,t){return null==e?void 0:e[t]}(e,t);return O(n)?n:void 0}function z(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}e.exports=function(e){return e&&e.length?function(e,t,n){var o=-1,r=d,i=e.length,s=!0,a=[],l=a;if(n)s=!1,r=u;else if(i>=200){var c=t?null:D(e);if(c)return f(c);s=!1,r=p,l=new M}else l=t?[]:a;e:for(;++o<i;){var h=e[o],g=t?t(h):h;if(h=n||0!==h?h:0,s&&g===g){for(var m=l.length;m--;)if(l[m]===g)continue e;t&&l.push(g),a.push(h)}else r(l,g,n)||(l!==a&&l.push(g),a.push(h))}return a}(e):[]}},3393:(e,t,n)=>{var o,r=function(){var e=String.fromCharCode,t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",o={};function r(e,t){if(!o[e]){o[e]={};for(var n=0;n<e.length;n++)o[e][e.charAt(n)]=n}return o[e][t]}var i={compressToBase64:function(e){if(null==e)return"";var n=i._compress(e,6,(function(e){return t.charAt(e)}));switch(n.length%4){default:case 0:return n;case 1:return n+"===";case 2:return n+"==";case 3:return n+"="}},decompressFromBase64:function(e){return null==e?"":""==e?null:i._decompress(e.length,32,(function(n){return r(t,e.charAt(n))}))},compressToUTF16:function(t){return null==t?"":i._compress(t,15,(function(t){return e(t+32)}))+" "},decompressFromUTF16:function(e){return null==e?"":""==e?null:i._decompress(e.length,16384,(function(t){return e.charCodeAt(t)-32}))},compressToUint8Array:function(e){for(var t=i.compress(e),n=new Uint8Array(2*t.length),o=0,r=t.length;o<r;o++){var s=t.charCodeAt(o);n[2*o]=s>>>8,n[2*o+1]=s%256}return n},decompressFromUint8Array:function(t){if(null===t||void 0===t)return i.decompress(t);for(var n=new Array(t.length/2),o=0,r=n.length;o<r;o++)n[o]=256*t[2*o]+t[2*o+1];var s=[];return n.forEach((function(t){s.push(e(t))})),i.decompress(s.join(""))},compressToEncodedURIComponent:function(e){return null==e?"":i._compress(e,6,(function(e){return n.charAt(e)}))},decompressFromEncodedURIComponent:function(e){return null==e?"":""==e?null:(e=e.replace(/ /g,"+"),i._decompress(e.length,32,(function(t){return r(n,e.charAt(t))})))},compress:function(t){return i._compress(t,16,(function(t){return e(t)}))},_compress:function(e,t,n){if(null==e)return"";var o,r,i,s={},a={},l="",c="",d="",u=2,h=3,p=2,f=[],g=0,m=0;for(i=0;i<e.length;i+=1)if(l=e.charAt(i),Object.prototype.hasOwnProperty.call(s,l)||(s[l]=h++,a[l]=!0),c=d+l,Object.prototype.hasOwnProperty.call(s,c))d=c;else{if(Object.prototype.hasOwnProperty.call(a,d)){if(d.charCodeAt(0)<256){for(o=0;o<p;o++)g<<=1,m==t-1?(m=0,f.push(n(g)),g=0):m++;for(r=d.charCodeAt(0),o=0;o<8;o++)g=g<<1|1&r,m==t-1?(m=0,f.push(n(g)),g=0):m++,r>>=1}else{for(r=1,o=0;o<p;o++)g=g<<1|r,m==t-1?(m=0,f.push(n(g)),g=0):m++,r=0;for(r=d.charCodeAt(0),o=0;o<16;o++)g=g<<1|1&r,m==t-1?(m=0,f.push(n(g)),g=0):m++,r>>=1}0==--u&&(u=Math.pow(2,p),p++),delete a[d]}else for(r=s[d],o=0;o<p;o++)g=g<<1|1&r,m==t-1?(m=0,f.push(n(g)),g=0):m++,r>>=1;0==--u&&(u=Math.pow(2,p),p++),s[c]=h++,d=String(l)}if(""!==d){if(Object.prototype.hasOwnProperty.call(a,d)){if(d.charCodeAt(0)<256){for(o=0;o<p;o++)g<<=1,m==t-1?(m=0,f.push(n(g)),g=0):m++;for(r=d.charCodeAt(0),o=0;o<8;o++)g=g<<1|1&r,m==t-1?(m=0,f.push(n(g)),g=0):m++,r>>=1}else{for(r=1,o=0;o<p;o++)g=g<<1|r,m==t-1?(m=0,f.push(n(g)),g=0):m++,r=0;for(r=d.charCodeAt(0),o=0;o<16;o++)g=g<<1|1&r,m==t-1?(m=0,f.push(n(g)),g=0):m++,r>>=1}0==--u&&(u=Math.pow(2,p),p++),delete a[d]}else for(r=s[d],o=0;o<p;o++)g=g<<1|1&r,m==t-1?(m=0,f.push(n(g)),g=0):m++,r>>=1;0==--u&&(u=Math.pow(2,p),p++)}for(r=2,o=0;o<p;o++)g=g<<1|1&r,m==t-1?(m=0,f.push(n(g)),g=0):m++,r>>=1;for(;;){if(g<<=1,m==t-1){f.push(n(g));break}m++}return f.join("")},decompress:function(e){return null==e?"":""==e?null:i._decompress(e.length,32768,(function(t){return e.charCodeAt(t)}))},_decompress:function(t,n,o){var r,i,s,a,l,c,d,u=[],h=4,p=4,f=3,g="",m=[],y={val:o(0),position:n,index:1};for(r=0;r<3;r+=1)u[r]=r;for(s=0,l=Math.pow(2,2),c=1;c!=l;)a=y.val&y.position,y.position>>=1,0==y.position&&(y.position=n,y.val=o(y.index++)),s|=(a>0?1:0)*c,c<<=1;switch(s){case 0:for(s=0,l=Math.pow(2,8),c=1;c!=l;)a=y.val&y.position,y.position>>=1,0==y.position&&(y.position=n,y.val=o(y.index++)),s|=(a>0?1:0)*c,c<<=1;d=e(s);break;case 1:for(s=0,l=Math.pow(2,16),c=1;c!=l;)a=y.val&y.position,y.position>>=1,0==y.position&&(y.position=n,y.val=o(y.index++)),s|=(a>0?1:0)*c,c<<=1;d=e(s);break;case 2:return""}for(u[3]=d,i=d,m.push(d);;){if(y.index>t)return"";for(s=0,l=Math.pow(2,f),c=1;c!=l;)a=y.val&y.position,y.position>>=1,0==y.position&&(y.position=n,y.val=o(y.index++)),s|=(a>0?1:0)*c,c<<=1;switch(d=s){case 0:for(s=0,l=Math.pow(2,8),c=1;c!=l;)a=y.val&y.position,y.position>>=1,0==y.position&&(y.position=n,y.val=o(y.index++)),s|=(a>0?1:0)*c,c<<=1;u[p++]=e(s),d=p-1,h--;break;case 1:for(s=0,l=Math.pow(2,16),c=1;c!=l;)a=y.val&y.position,y.position>>=1,0==y.position&&(y.position=n,y.val=o(y.index++)),s|=(a>0?1:0)*c,c<<=1;u[p++]=e(s),d=p-1,h--;break;case 2:return m.join("")}if(0==h&&(h=Math.pow(2,f),f++),u[d])g=u[d];else{if(d!==p)return null;g=i+i.charAt(0)}m.push(g),u[p++]=i+g.charAt(0),i=g,0==--h&&(h=Math.pow(2,f),f++)}}};return i}();void 0===(o=function(){return r}.call(t,n,t,e))||(e.exports=o)},7004:(e,t,n)=>{"use strict";var o=n(8853),r=n(5043),i=n(7950);function s(e){var t="https://react.dev/errors/"+e;if(1<arguments.length){t+="?args[]="+encodeURIComponent(arguments[1]);for(var n=2;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n])}return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function a(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}var l=Symbol.for("react.element"),c=Symbol.for("react.transitional.element"),d=Symbol.for("react.portal"),u=Symbol.for("react.fragment"),h=Symbol.for("react.strict_mode"),p=Symbol.for("react.profiler"),f=Symbol.for("react.provider"),g=Symbol.for("react.consumer"),m=Symbol.for("react.context"),y=Symbol.for("react.forward_ref"),v=Symbol.for("react.suspense"),b=Symbol.for("react.suspense_list"),w=Symbol.for("react.memo"),x=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var S=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.tracing_marker");var k=Symbol.for("react.memo_cache_sentinel"),P=Symbol.iterator;function C(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=P&&e[P]||e["@@iterator"])?e:null}var _=Symbol.for("react.client.reference");function I(e){if(null==e)return null;if("function"===typeof e)return e.$$typeof===_?null:e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case u:return"Fragment";case d:return"Portal";case p:return"Profiler";case h:return"StrictMode";case v:return"Suspense";case b:return"SuspenseList"}if("object"===typeof e)switch(e.$$typeof){case m:return(e.displayName||"Context")+".Provider";case g:return(e._context.displayName||"Context")+".Consumer";case y:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case w:return null!==(t=e.displayName||null)?t:I(e.type)||"Memo";case x:t=e._payload,e=e._init;try{return I(e(t))}catch(n){}}return null}var E,j,T=r.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,M=Object.assign;function A(e){if(void 0===E)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);E=t&&t[1]||"",j=-1<n.stack.indexOf("\n    at")?" (<anonymous>)":-1<n.stack.indexOf("@")?"@unknown:0:0":""}return"\n"+E+e+j}var O=!1;function D(e,t){if(!e||O)return"";O=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var o={DetermineComponentFrameRoot:function(){try{if(t){var n=function(){throw Error()};if(Object.defineProperty(n.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(n,[])}catch(r){var o=r}Reflect.construct(e,[],n)}else{try{n.call()}catch(i){o=i}e.call(n.prototype)}}else{try{throw Error()}catch(s){o=s}(n=e())&&"function"===typeof n.catch&&n.catch((function(){}))}}catch(a){if(a&&o&&"string"===typeof a.stack)return[a.stack,o.stack]}return[null,null]}};o.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var r=Object.getOwnPropertyDescriptor(o.DetermineComponentFrameRoot,"name");r&&r.configurable&&Object.defineProperty(o.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var i=o.DetermineComponentFrameRoot(),s=i[0],a=i[1];if(s&&a){var l=s.split("\n"),c=a.split("\n");for(r=o=0;o<l.length&&!l[o].includes("DetermineComponentFrameRoot");)o++;for(;r<c.length&&!c[r].includes("DetermineComponentFrameRoot");)r++;if(o===l.length||r===c.length)for(o=l.length-1,r=c.length-1;1<=o&&0<=r&&l[o]!==c[r];)r--;for(;1<=o&&0<=r;o--,r--)if(l[o]!==c[r]){if(1!==o||1!==r)do{if(o--,0>--r||l[o]!==c[r]){var d="\n"+l[o].replace(" at new "," at ");return e.displayName&&d.includes("<anonymous>")&&(d=d.replace("<anonymous>",e.displayName)),d}}while(1<=o&&0<=r);break}}}finally{O=!1,Error.prepareStackTrace=n}return(n=e?e.displayName||e.name:"")?A(n):""}function R(e){switch(e.tag){case 26:case 27:case 5:return A(e.type);case 16:return A("Lazy");case 13:return A("Suspense");case 19:return A("SuspenseList");case 0:case 15:return e=D(e.type,!1);case 11:return e=D(e.type.render,!1);case 1:return e=D(e.type,!0);default:return""}}function L(e){try{var t="";do{t+=R(e),e=e.return}while(e);return t}catch(n){return"\nError generating stack: "+n.message+"\n"+n.stack}}function z(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function N(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function F(e){if(z(e)!==e)throw Error(s(188))}function B(e){var t=e.tag;if(5===t||26===t||27===t||6===t)return e;for(e=e.child;null!==e;){if(null!==(t=B(e)))return t;e=e.sibling}return null}var U=Array.isArray,H=i.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,K={pending:!1,data:null,method:null,action:null},V=[],W=-1;function q(e){return{current:e}}function Y(e){0>W||(e.current=V[W],V[W]=null,W--)}function G(e,t){W++,V[W]=e.current,e.current=t}var X=q(null),$=q(null),Z=q(null),Q=q(null);function J(e,t){switch(G(Z,t),G($,e),G(X,null),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)&&(t=t.namespaceURI)?$d(t):0;break;default:if(t=(e=8===e?t.parentNode:t).tagName,e=e.namespaceURI)t=Zd(e=$d(e),t);else switch(t){case"svg":t=1;break;case"math":t=2;break;default:t=0}}Y(X),G(X,t)}function ee(){Y(X),Y($),Y(Z)}function te(e){null!==e.memoizedState&&G(Q,e);var t=X.current,n=Zd(t,e.type);t!==n&&(G($,e),G(X,n))}function ne(e){$.current===e&&(Y(X),Y($)),Q.current===e&&(Y(Q),Lu._currentValue=K)}var oe=Object.prototype.hasOwnProperty,re=o.unstable_scheduleCallback,ie=o.unstable_cancelCallback,se=o.unstable_shouldYield,ae=o.unstable_requestPaint,le=o.unstable_now,ce=o.unstable_getCurrentPriorityLevel,de=o.unstable_ImmediatePriority,ue=o.unstable_UserBlockingPriority,he=o.unstable_NormalPriority,pe=o.unstable_LowPriority,fe=o.unstable_IdlePriority,ge=o.log,me=o.unstable_setDisableYieldValue,ye=null,ve=null;function be(e){if("function"===typeof ge&&me(e),ve&&"function"===typeof ve.setStrictMode)try{ve.setStrictMode(ye,e)}catch(t){}}var we=Math.clz32?Math.clz32:function(e){return 0===(e>>>=0)?32:31-(xe(e)/Se|0)|0},xe=Math.log,Se=Math.LN2;var ke=128,Pe=4194304;function Ce(e){var t=42&e;if(0!==t)return t;switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194176&e;case 4194304:case 8388608:case 16777216:case 33554432:return 62914560&e;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return e}}function _e(e,t){var n=e.pendingLanes;if(0===n)return 0;var o=0,r=e.suspendedLanes,i=e.pingedLanes,s=e.warmLanes;e=0!==e.finishedLanes;var a=134217727&n;return 0!==a?0!==(n=a&~r)?o=Ce(n):0!==(i&=a)?o=Ce(i):e||0!==(s=a&~s)&&(o=Ce(s)):0!==(a=n&~r)?o=Ce(a):0!==i?o=Ce(i):e||0!==(s=n&~s)&&(o=Ce(s)),0===o?0:0!==t&&t!==o&&0===(t&r)&&((r=o&-o)>=(s=t&-t)||32===r&&0!==(4194176&s))?t:o}function Ie(e,t){return 0===(e.pendingLanes&~(e.suspendedLanes&~e.pingedLanes)&t)}function Ee(e,t){switch(e){case 1:case 2:case 4:case 8:return t+250;case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function je(){var e=ke;return 0===(4194176&(ke<<=1))&&(ke=128),e}function Te(){var e=Pe;return 0===(62914560&(Pe<<=1))&&(Pe=4194304),e}function Me(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function Ae(e,t){e.pendingLanes|=t,268435456!==t&&(e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0)}function Oe(e,t,n){e.pendingLanes|=t,e.suspendedLanes&=~t;var o=31-we(t);e.entangledLanes|=t,e.entanglements[o]=1073741824|e.entanglements[o]|4194218&n}function De(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var o=31-we(n),r=1<<o;r&t|e[o]&t&&(e[o]|=t),n&=~r}}function Re(e){return 2<(e&=-e)?8<e?0!==(134217727&e)?32:268435456:8:2}function Le(){var e=H.p;return 0!==e?e:void 0===(e=window.event)?32:Zu(e.type)}var ze=Math.random().toString(36).slice(2),Ne="__reactFiber$"+ze,Fe="__reactProps$"+ze,Be="__reactContainer$"+ze,Ue="__reactEvents$"+ze,He="__reactListeners$"+ze,Ke="__reactHandles$"+ze,Ve="__reactResources$"+ze,We="__reactMarker$"+ze;function qe(e){delete e[Ne],delete e[Fe],delete e[Ue],delete e[He],delete e[Ke]}function Ye(e){var t=e[Ne];if(t)return t;for(var n=e.parentNode;n;){if(t=n[Be]||n[Ne]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=lu(e);null!==e;){if(n=e[Ne])return n;e=lu(e)}return t}n=(e=n).parentNode}return null}function Ge(e){if(e=e[Ne]||e[Be]){var t=e.tag;if(5===t||6===t||13===t||26===t||27===t||3===t)return e}return null}function Xe(e){var t=e.tag;if(5===t||26===t||27===t||6===t)return e.stateNode;throw Error(s(33))}function $e(e){var t=e[Ve];return t||(t=e[Ve]={hoistableStyles:new Map,hoistableScripts:new Map}),t}function Ze(e){e[We]=!0}var Qe=new Set,Je={};function et(e,t){tt(e,t),tt(e+"Capture",t)}function tt(e,t){for(Je[e]=t,e=0;e<t.length;e++)Qe.add(t[e])}var nt=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),ot=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),rt={},it={};function st(e,t,n){if(r=t,oe.call(it,r)||!oe.call(rt,r)&&(ot.test(r)?it[r]=!0:(rt[r]=!0,0)))if(null===n)e.removeAttribute(t);else{switch(typeof n){case"undefined":case"function":case"symbol":return void e.removeAttribute(t);case"boolean":var o=t.toLowerCase().slice(0,5);if("data-"!==o&&"aria-"!==o)return void e.removeAttribute(t)}e.setAttribute(t,""+n)}var r}function at(e,t,n){if(null===n)e.removeAttribute(t);else{switch(typeof n){case"undefined":case"function":case"symbol":case"boolean":return void e.removeAttribute(t)}e.setAttribute(t,""+n)}}function lt(e,t,n,o){if(null===o)e.removeAttribute(n);else{switch(typeof o){case"undefined":case"function":case"symbol":case"boolean":return void e.removeAttribute(n)}e.setAttributeNS(t,n,""+o)}}function ct(e){switch(typeof e){case"bigint":case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function dt(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function ut(e){e._valueTracker||(e._valueTracker=function(e){var t=dt(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),o=""+e[t];if(!e.hasOwnProperty(t)&&"undefined"!==typeof n&&"function"===typeof n.get&&"function"===typeof n.set){var r=n.get,i=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return r.call(this)},set:function(e){o=""+e,i.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return o},setValue:function(e){o=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function ht(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),o="";return e&&(o=dt(e)?e.checked?"true":"false":e.value),(e=o)!==n&&(t.setValue(e),!0)}function pt(e){if("undefined"===typeof(e=e||("undefined"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}var ft=/[\n"\\]/g;function gt(e){return e.replace(ft,(function(e){return"\\"+e.charCodeAt(0).toString(16)+" "}))}function mt(e,t,n,o,r,i,s,a){e.name="",null!=s&&"function"!==typeof s&&"symbol"!==typeof s&&"boolean"!==typeof s?e.type=s:e.removeAttribute("type"),null!=t?"number"===s?(0===t&&""===e.value||e.value!=t)&&(e.value=""+ct(t)):e.value!==""+ct(t)&&(e.value=""+ct(t)):"submit"!==s&&"reset"!==s||e.removeAttribute("value"),null!=t?vt(e,s,ct(t)):null!=n?vt(e,s,ct(n)):null!=o&&e.removeAttribute("value"),null==r&&null!=i&&(e.defaultChecked=!!i),null!=r&&(e.checked=r&&"function"!==typeof r&&"symbol"!==typeof r),null!=a&&"function"!==typeof a&&"symbol"!==typeof a&&"boolean"!==typeof a?e.name=""+ct(a):e.removeAttribute("name")}function yt(e,t,n,o,r,i,s,a){if(null!=i&&"function"!==typeof i&&"symbol"!==typeof i&&"boolean"!==typeof i&&(e.type=i),null!=t||null!=n){if(!("submit"!==i&&"reset"!==i||void 0!==t&&null!==t))return;n=null!=n?""+ct(n):"",t=null!=t?""+ct(t):n,a||t===e.value||(e.value=t),e.defaultValue=t}o="function"!==typeof(o=null!=o?o:r)&&"symbol"!==typeof o&&!!o,e.checked=a?e.checked:!!o,e.defaultChecked=!!o,null!=s&&"function"!==typeof s&&"symbol"!==typeof s&&"boolean"!==typeof s&&(e.name=s)}function vt(e,t,n){"number"===t&&pt(e.ownerDocument)===e||e.defaultValue===""+n||(e.defaultValue=""+n)}function bt(e,t,n,o){if(e=e.options,t){t={};for(var r=0;r<n.length;r++)t["$"+n[r]]=!0;for(n=0;n<e.length;n++)r=t.hasOwnProperty("$"+e[n].value),e[n].selected!==r&&(e[n].selected=r),r&&o&&(e[n].defaultSelected=!0)}else{for(n=""+ct(n),t=null,r=0;r<e.length;r++){if(e[r].value===n)return e[r].selected=!0,void(o&&(e[r].defaultSelected=!0));null!==t||e[r].disabled||(t=e[r])}null!==t&&(t.selected=!0)}}function wt(e,t,n){null==t||((t=""+ct(t))!==e.value&&(e.value=t),null!=n)?e.defaultValue=null!=n?""+ct(n):"":e.defaultValue!==t&&(e.defaultValue=t)}function xt(e,t,n,o){if(null==t){if(null!=o){if(null!=n)throw Error(s(92));if(U(o)){if(1<o.length)throw Error(s(93));o=o[0]}n=o}null==n&&(n=""),t=n}n=ct(t),e.defaultValue=n,(o=e.textContent)===n&&""!==o&&null!==o&&(e.value=o)}function St(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var kt=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Pt(e,t,n){var o=0===t.indexOf("--");null==n||"boolean"===typeof n||""===n?o?e.setProperty(t,""):"float"===t?e.cssFloat="":e[t]="":o?e.setProperty(t,n):"number"!==typeof n||0===n||kt.has(t)?"float"===t?e.cssFloat=n:e[t]=(""+n).trim():e[t]=n+"px"}function Ct(e,t,n){if(null!=t&&"object"!==typeof t)throw Error(s(62));if(e=e.style,null!=n){for(var o in n)!n.hasOwnProperty(o)||null!=t&&t.hasOwnProperty(o)||(0===o.indexOf("--")?e.setProperty(o,""):"float"===o?e.cssFloat="":e[o]="");for(var r in t)o=t[r],t.hasOwnProperty(r)&&n[r]!==o&&Pt(e,r,o)}else for(var i in t)t.hasOwnProperty(i)&&Pt(e,i,t[i])}function _t(e){if(-1===e.indexOf("-"))return!1;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var It=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Et=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function jt(e){return Et.test(""+e)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":e}var Tt=null;function Mt(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var At=null,Ot=null;function Dt(e){var t=Ge(e);if(t&&(e=t.stateNode)){var n=e[Fe]||null;e:switch(e=t.stateNode,t.type){case"input":if(mt(e,n.value,n.defaultValue,n.defaultValue,n.checked,n.defaultChecked,n.type,n.name),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll('input[name="'+gt(""+t)+'"][type="radio"]'),t=0;t<n.length;t++){var o=n[t];if(o!==e&&o.form===e.form){var r=o[Fe]||null;if(!r)throw Error(s(90));mt(o,r.value,r.defaultValue,r.defaultValue,r.checked,r.defaultChecked,r.type,r.name)}}for(t=0;t<n.length;t++)(o=n[t]).form===e.form&&ht(o)}break e;case"textarea":wt(e,n.value,n.defaultValue);break e;case"select":null!=(t=n.value)&&bt(e,!!n.multiple,t,!1)}}}var Rt=!1;function Lt(e,t,n){if(Rt)return e(t,n);Rt=!0;try{return e(t)}finally{if(Rt=!1,(null!==At||null!==Ot)&&(Nc(),At&&(t=At,e=Ot,Ot=At=null,Dt(t),e)))for(t=0;t<e.length;t++)Dt(e[t])}}function zt(e,t){var n=e.stateNode;if(null===n)return null;var o=n[Fe]||null;if(null===o)return null;n=o[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(o=!o.disabled)||(o=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!o;break e;default:e=!1}if(e)return null;if(n&&"function"!==typeof n)throw Error(s(231,t,typeof n));return n}var Nt=!1;if(nt)try{var Ft={};Object.defineProperty(Ft,"passive",{get:function(){Nt=!0}}),window.addEventListener("test",Ft,Ft),window.removeEventListener("test",Ft,Ft)}catch(xh){Nt=!1}var Bt=null,Ut=null,Ht=null;function Kt(){if(Ht)return Ht;var e,t,n=Ut,o=n.length,r="value"in Bt?Bt.value:Bt.textContent,i=r.length;for(e=0;e<o&&n[e]===r[e];e++);var s=o-e;for(t=1;t<=s&&n[o-t]===r[i-t];t++);return Ht=r.slice(e,1<t?1-t:void 0)}function Vt(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function Wt(){return!0}function qt(){return!1}function Yt(e){function t(t,n,o,r,i){for(var s in this._reactName=t,this._targetInst=o,this.type=n,this.nativeEvent=r,this.target=i,this.currentTarget=null,e)e.hasOwnProperty(s)&&(t=e[s],this[s]=t?t(r):r[s]);return this.isDefaultPrevented=(null!=r.defaultPrevented?r.defaultPrevented:!1===r.returnValue)?Wt:qt,this.isPropagationStopped=qt,this}return M(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=Wt)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=Wt)},persist:function(){},isPersistent:Wt}),t}var Gt,Xt,$t,Zt={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Qt=Yt(Zt),Jt=M({},Zt,{view:0,detail:0}),en=Yt(Jt),tn=M({},Jt,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:pn,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==$t&&($t&&"mousemove"===e.type?(Gt=e.screenX-$t.screenX,Xt=e.screenY-$t.screenY):Xt=Gt=0,$t=e),Gt)},movementY:function(e){return"movementY"in e?e.movementY:Xt}}),nn=Yt(tn),on=Yt(M({},tn,{dataTransfer:0})),rn=Yt(M({},Jt,{relatedTarget:0})),sn=Yt(M({},Zt,{animationName:0,elapsedTime:0,pseudoElement:0})),an=Yt(M({},Zt,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}})),ln=Yt(M({},Zt,{data:0})),cn={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},dn={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},un={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function hn(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=un[e])&&!!t[e]}function pn(){return hn}var fn=Yt(M({},Jt,{key:function(e){if(e.key){var t=cn[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=Vt(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?dn[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:pn,charCode:function(e){return"keypress"===e.type?Vt(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?Vt(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}})),gn=Yt(M({},tn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),mn=Yt(M({},Jt,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:pn})),yn=Yt(M({},Zt,{propertyName:0,elapsedTime:0,pseudoElement:0})),vn=Yt(M({},tn,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0})),bn=Yt(M({},Zt,{newState:0,oldState:0})),wn=[9,13,27,32],xn=nt&&"CompositionEvent"in window,Sn=null;nt&&"documentMode"in document&&(Sn=document.documentMode);var kn=nt&&"TextEvent"in window&&!Sn,Pn=nt&&(!xn||Sn&&8<Sn&&11>=Sn),Cn=String.fromCharCode(32),_n=!1;function In(e,t){switch(e){case"keyup":return-1!==wn.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function En(e){return"object"===typeof(e=e.detail)&&"data"in e?e.data:null}var jn=!1;var Tn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Mn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!Tn[e.type]:"textarea"===t}function An(e,t,n,o){At?Ot?Ot.push(o):Ot=[o]:At=o,0<(t=Ld(t,"onChange")).length&&(n=new Qt("onChange","change",null,n,o),e.push({event:n,listeners:t}))}var On=null,Dn=null;function Rn(e){Ed(e,0)}function Ln(e){if(ht(Xe(e)))return e}function zn(e,t){if("change"===e)return t}var Nn=!1;if(nt){var Fn;if(nt){var Bn="oninput"in document;if(!Bn){var Un=document.createElement("div");Un.setAttribute("oninput","return;"),Bn="function"===typeof Un.oninput}Fn=Bn}else Fn=!1;Nn=Fn&&(!document.documentMode||9<document.documentMode)}function Hn(){On&&(On.detachEvent("onpropertychange",Kn),Dn=On=null)}function Kn(e){if("value"===e.propertyName&&Ln(Dn)){var t=[];An(t,Dn,e,Mt(e)),Lt(Rn,t)}}function Vn(e,t,n){"focusin"===e?(Hn(),Dn=n,(On=t).attachEvent("onpropertychange",Kn)):"focusout"===e&&Hn()}function Wn(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Ln(Dn)}function qn(e,t){if("click"===e)return Ln(t)}function Yn(e,t){if("input"===e||"change"===e)return Ln(t)}var Gn="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t};function Xn(e,t){if(Gn(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var n=Object.keys(e),o=Object.keys(t);if(n.length!==o.length)return!1;for(o=0;o<n.length;o++){var r=n[o];if(!oe.call(t,r)||!Gn(e[r],t[r]))return!1}return!0}function $n(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function Zn(e,t){var n,o=$n(e);for(e=0;o;){if(3===o.nodeType){if(n=e+o.textContent.length,e<=t&&n>=t)return{node:o,offset:t-e};e=n}e:{for(;o;){if(o.nextSibling){o=o.nextSibling;break e}o=o.parentNode}o=void 0}o=$n(o)}}function Qn(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?Qn(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function Jn(e){for(var t=pt((e=null!=e&&null!=e.ownerDocument&&null!=e.ownerDocument.defaultView?e.ownerDocument.defaultView:window).document);t instanceof e.HTMLIFrameElement;){try{var n="string"===typeof t.contentWindow.location.href}catch(o){n=!1}if(!n)break;t=pt((e=t.contentWindow).document)}return t}function eo(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}function to(e,t){var n=Jn(t);t=e.focusedElem;var o=e.selectionRange;if(n!==t&&t&&t.ownerDocument&&Qn(t.ownerDocument.documentElement,t)){if(null!==o&&eo(t))if(e=o.start,void 0===(n=o.end)&&(n=e),"selectionStart"in t)t.selectionStart=e,t.selectionEnd=Math.min(n,t.value.length);else if((n=(e=t.ownerDocument||document)&&e.defaultView||window).getSelection){n=n.getSelection();var r=t.textContent.length,i=Math.min(o.start,r);o=void 0===o.end?i:Math.min(o.end,r),!n.extend&&i>o&&(r=o,o=i,i=r),r=Zn(t,i);var s=Zn(t,o);r&&s&&(1!==n.rangeCount||n.anchorNode!==r.node||n.anchorOffset!==r.offset||n.focusNode!==s.node||n.focusOffset!==s.offset)&&((e=e.createRange()).setStart(r.node,r.offset),n.removeAllRanges(),i>o?(n.addRange(e),n.extend(s.node,s.offset)):(e.setEnd(s.node,s.offset),n.addRange(e)))}for(e=[],n=t;n=n.parentNode;)1===n.nodeType&&e.push({element:n,left:n.scrollLeft,top:n.scrollTop});for("function"===typeof t.focus&&t.focus(),t=0;t<e.length;t++)(n=e[t]).element.scrollLeft=n.left,n.element.scrollTop=n.top}}var no=nt&&"documentMode"in document&&11>=document.documentMode,oo=null,ro=null,io=null,so=!1;function ao(e,t,n){var o=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;so||null==oo||oo!==pt(o)||("selectionStart"in(o=oo)&&eo(o)?o={start:o.selectionStart,end:o.selectionEnd}:o={anchorNode:(o=(o.ownerDocument&&o.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:o.anchorOffset,focusNode:o.focusNode,focusOffset:o.focusOffset},io&&Xn(io,o)||(io=o,0<(o=Ld(ro,"onSelect")).length&&(t=new Qt("onSelect","select",null,t,n),e.push({event:t,listeners:o}),t.target=oo)))}function lo(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var co={animationend:lo("Animation","AnimationEnd"),animationiteration:lo("Animation","AnimationIteration"),animationstart:lo("Animation","AnimationStart"),transitionrun:lo("Transition","TransitionRun"),transitionstart:lo("Transition","TransitionStart"),transitioncancel:lo("Transition","TransitionCancel"),transitionend:lo("Transition","TransitionEnd")},uo={},ho={};function po(e){if(uo[e])return uo[e];if(!co[e])return e;var t,n=co[e];for(t in n)if(n.hasOwnProperty(t)&&t in ho)return uo[e]=n[t];return e}nt&&(ho=document.createElement("div").style,"AnimationEvent"in window||(delete co.animationend.animation,delete co.animationiteration.animation,delete co.animationstart.animation),"TransitionEvent"in window||delete co.transitionend.transition);var fo=po("animationend"),go=po("animationiteration"),mo=po("animationstart"),yo=po("transitionrun"),vo=po("transitionstart"),bo=po("transitioncancel"),wo=po("transitionend"),xo=new Map,So="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll scrollEnd toggle touchMove waiting wheel".split(" ");function ko(e,t){xo.set(e,t),et(t,[e])}var Po=[],Co=0,_o=0;function Io(){for(var e=Co,t=_o=Co=0;t<e;){var n=Po[t];Po[t++]=null;var o=Po[t];Po[t++]=null;var r=Po[t];Po[t++]=null;var i=Po[t];if(Po[t++]=null,null!==o&&null!==r){var s=o.pending;null===s?r.next=r:(r.next=s.next,s.next=r),o.pending=r}0!==i&&Mo(n,r,i)}}function Eo(e,t,n,o){Po[Co++]=e,Po[Co++]=t,Po[Co++]=n,Po[Co++]=o,_o|=o,e.lanes|=o,null!==(e=e.alternate)&&(e.lanes|=o)}function jo(e,t,n,o){return Eo(e,t,n,o),Ao(e)}function To(e,t){return Eo(e,null,null,t),Ao(e)}function Mo(e,t,n){e.lanes|=n;var o=e.alternate;null!==o&&(o.lanes|=n);for(var r=!1,i=e.return;null!==i;)i.childLanes|=n,null!==(o=i.alternate)&&(o.childLanes|=n),22===i.tag&&(null===(e=i.stateNode)||1&e._visibility||(r=!0)),e=i,i=i.return;r&&null!==t&&3===e.tag&&(i=e.stateNode,r=31-we(n),null===(e=(i=i.hiddenUpdates)[r])?i[r]=[t]:e.push(t),t.lane=536870912|n)}function Ao(e){if(50<Ec)throw Ec=0,jc=null,Error(s(185));for(var t=e.return;null!==t;)t=(e=t).return;return 3===e.tag?e.stateNode:null}var Oo={},Do=new WeakMap;function Ro(e,t){if("object"===typeof e&&null!==e){var n=Do.get(e);return void 0!==n?n:(t={value:e,source:t,stack:L(t)},Do.set(e,t),t)}return{value:e,source:t,stack:L(t)}}var Lo=[],zo=0,No=null,Fo=0,Bo=[],Uo=0,Ho=null,Ko=1,Vo="";function Wo(e,t){Lo[zo++]=Fo,Lo[zo++]=No,No=e,Fo=t}function qo(e,t,n){Bo[Uo++]=Ko,Bo[Uo++]=Vo,Bo[Uo++]=Ho,Ho=e;var o=Ko;e=Vo;var r=32-we(o)-1;o&=~(1<<r),n+=1;var i=32-we(t)+r;if(30<i){var s=r-r%5;i=(o&(1<<s)-1).toString(32),o>>=s,r-=s,Ko=1<<32-we(t)+r|n<<r|o,Vo=i+e}else Ko=1<<i|n<<r|o,Vo=e}function Yo(e){null!==e.return&&(Wo(e,1),qo(e,1,0))}function Go(e){for(;e===No;)No=Lo[--zo],Lo[zo]=null,Fo=Lo[--zo],Lo[zo]=null;for(;e===Ho;)Ho=Bo[--Uo],Bo[Uo]=null,Vo=Bo[--Uo],Bo[Uo]=null,Ko=Bo[--Uo],Bo[Uo]=null}var Xo=null,$o=null,Zo=!1,Qo=null,Jo=!1,er=Error(s(519));function tr(e){throw sr(Ro(Error(s(418,"")),e)),er}function nr(e){var t=e.stateNode,n=e.type,o=e.memoizedProps;switch(t[Ne]=e,t[Fe]=o,n){case"dialog":jd("cancel",t),jd("close",t);break;case"iframe":case"object":case"embed":jd("load",t);break;case"video":case"audio":for(n=0;n<_d.length;n++)jd(_d[n],t);break;case"source":jd("error",t);break;case"img":case"image":case"link":jd("error",t),jd("load",t);break;case"details":jd("toggle",t);break;case"input":jd("invalid",t),yt(t,o.value,o.defaultValue,o.checked,o.defaultChecked,o.type,o.name,!0),ut(t);break;case"select":jd("invalid",t);break;case"textarea":jd("invalid",t),xt(t,o.value,o.defaultValue,o.children),ut(t)}"string"!==typeof(n=o.children)&&"number"!==typeof n&&"bigint"!==typeof n||t.textContent===""+n||!0===o.suppressHydrationWarning||Hd(t.textContent,n)?(null!=o.popover&&(jd("beforetoggle",t),jd("toggle",t)),null!=o.onScroll&&jd("scroll",t),null!=o.onScrollEnd&&jd("scrollend",t),null!=o.onClick&&(t.onclick=Kd),t=!0):t=!1,t||tr(e)}function or(e){for(Xo=e.return;Xo;)switch(Xo.tag){case 3:case 27:return void(Jo=!0);case 5:case 13:return void(Jo=!1);default:Xo=Xo.return}}function rr(e){if(e!==Xo)return!1;if(!Zo)return or(e),Zo=!0,!1;var t,n=!1;if((t=3!==e.tag&&27!==e.tag)&&((t=5===e.tag)&&(t=!("form"!==(t=e.type)&&"button"!==t)||Qd(e.type,e.memoizedProps)),t=!t),t&&(n=!0),n&&$o&&tr(e),or(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(s(317));e:{for(e=e.nextSibling,n=0;e;){if(8===e.nodeType)if("/$"===(t=e.data)){if(0===n){$o=au(e.nextSibling);break e}n--}else"$"!==t&&"$!"!==t&&"$?"!==t||n++;e=e.nextSibling}$o=null}}else $o=Xo?au(e.stateNode.nextSibling):null;return!0}function ir(){$o=Xo=null,Zo=!1}function sr(e){null===Qo?Qo=[e]:Qo.push(e)}var ar=Error(s(460)),lr=Error(s(474)),cr={then:function(){}};function dr(e){return"fulfilled"===(e=e.status)||"rejected"===e}function ur(){}function hr(e,t,n){switch(void 0===(n=e[n])?e.push(t):n!==t&&(t.then(ur,ur),t=n),t.status){case"fulfilled":return t.value;case"rejected":if((e=t.reason)===ar)throw Error(s(483));throw e;default:if("string"===typeof t.status)t.then(ur,ur);else{if(null!==(e=tc)&&100<e.shellSuspendCounter)throw Error(s(482));(e=t).status="pending",e.then((function(e){if("pending"===t.status){var n=t;n.status="fulfilled",n.value=e}}),(function(e){if("pending"===t.status){var n=t;n.status="rejected",n.reason=e}}))}switch(t.status){case"fulfilled":return t.value;case"rejected":if((e=t.reason)===ar)throw Error(s(483));throw e}throw pr=t,ar}}var pr=null;function fr(){if(null===pr)throw Error(s(459));var e=pr;return pr=null,e}var gr=null,mr=0;function yr(e){var t=mr;return mr+=1,null===gr&&(gr=[]),hr(gr,e,t)}function vr(e,t){t=t.props.ref,e.ref=void 0!==t?t:null}function br(e,t){if(t.$$typeof===l)throw Error(s(525));throw e=Object.prototype.toString.call(t),Error(s(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function wr(e){return(0,e._init)(e._payload)}function xr(e){function t(t,n){if(e){var o=t.deletions;null===o?(t.deletions=[n],t.flags|=16):o.push(n)}}function n(n,o){if(!e)return null;for(;null!==o;)t(n,o),o=o.sibling;return null}function o(e){for(var t=new Map;null!==e;)null!==e.key?t.set(e.key,e):t.set(e.index,e),e=e.sibling;return t}function r(e,t){return(e=zl(e,t)).index=0,e.sibling=null,e}function i(t,n,o){return t.index=o,e?null!==(o=t.alternate)?(o=o.index)<n?(t.flags|=33554434,n):o:(t.flags|=33554434,n):(t.flags|=1048576,n)}function a(t){return e&&null===t.alternate&&(t.flags|=33554434),t}function l(e,t,n,o){return null===t||6!==t.tag?((t=Hl(n,e.mode,o)).return=e,t):((t=r(t,n)).return=e,t)}function h(e,t,n,o){var i=n.type;return i===u?f(e,t,n.props.children,o,n.key):null!==t&&(t.elementType===i||"object"===typeof i&&null!==i&&i.$$typeof===x&&wr(i)===t.type)?(vr(t=r(t,n.props),n),t.return=e,t):(vr(t=Fl(n.type,n.key,n.props,null,e.mode,o),n),t.return=e,t)}function p(e,t,n,o){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=Kl(n,e.mode,o)).return=e,t):((t=r(t,n.children||[])).return=e,t)}function f(e,t,n,o,i){return null===t||7!==t.tag?((t=Bl(n,e.mode,o,i)).return=e,t):((t=r(t,n)).return=e,t)}function g(e,t,n){if("string"===typeof t&&""!==t||"number"===typeof t||"bigint"===typeof t)return(t=Hl(""+t,e.mode,n)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case c:return vr(n=Fl(t.type,t.key,t.props,null,e.mode,n),t),n.return=e,n;case d:return(t=Kl(t,e.mode,n)).return=e,t;case x:return g(e,t=(0,t._init)(t._payload),n)}if(U(t)||C(t))return(t=Bl(t,e.mode,n,null)).return=e,t;if("function"===typeof t.then)return g(e,yr(t),n);if(t.$$typeof===m)return g(e,_a(e,t),n);br(e,t)}return null}function y(e,t,n,o){var r=null!==t?t.key:null;if("string"===typeof n&&""!==n||"number"===typeof n||"bigint"===typeof n)return null!==r?null:l(e,t,""+n,o);if("object"===typeof n&&null!==n){switch(n.$$typeof){case c:return n.key===r?h(e,t,n,o):null;case d:return n.key===r?p(e,t,n,o):null;case x:return y(e,t,n=(r=n._init)(n._payload),o)}if(U(n)||C(n))return null!==r?null:f(e,t,n,o,null);if("function"===typeof n.then)return y(e,t,yr(n),o);if(n.$$typeof===m)return y(e,t,_a(e,n),o);br(e,n)}return null}function v(e,t,n,o,r){if("string"===typeof o&&""!==o||"number"===typeof o||"bigint"===typeof o)return l(t,e=e.get(n)||null,""+o,r);if("object"===typeof o&&null!==o){switch(o.$$typeof){case c:return h(t,e=e.get(null===o.key?n:o.key)||null,o,r);case d:return p(t,e=e.get(null===o.key?n:o.key)||null,o,r);case x:return v(e,t,n,o=(0,o._init)(o._payload),r)}if(U(o)||C(o))return f(t,e=e.get(n)||null,o,r,null);if("function"===typeof o.then)return v(e,t,n,yr(o),r);if(o.$$typeof===m)return v(e,t,n,_a(t,o),r);br(t,o)}return null}function b(l,h,p,f){if("object"===typeof p&&null!==p&&p.type===u&&null===p.key&&(p=p.props.children),"object"===typeof p&&null!==p){switch(p.$$typeof){case c:e:{for(var w=p.key;null!==h;){if(h.key===w){if((w=p.type)===u){if(7===h.tag){n(l,h.sibling),(f=r(h,p.props.children)).return=l,l=f;break e}}else if(h.elementType===w||"object"===typeof w&&null!==w&&w.$$typeof===x&&wr(w)===h.type){n(l,h.sibling),vr(f=r(h,p.props),p),f.return=l,l=f;break e}n(l,h);break}t(l,h),h=h.sibling}p.type===u?((f=Bl(p.props.children,l.mode,f,p.key)).return=l,l=f):(vr(f=Fl(p.type,p.key,p.props,null,l.mode,f),p),f.return=l,l=f)}return a(l);case d:e:{for(w=p.key;null!==h;){if(h.key===w){if(4===h.tag&&h.stateNode.containerInfo===p.containerInfo&&h.stateNode.implementation===p.implementation){n(l,h.sibling),(f=r(h,p.children||[])).return=l,l=f;break e}n(l,h);break}t(l,h),h=h.sibling}(f=Kl(p,l.mode,f)).return=l,l=f}return a(l);case x:return b(l,h,p=(w=p._init)(p._payload),f)}if(U(p))return function(r,s,a,l){for(var c=null,d=null,u=s,h=s=0,p=null;null!==u&&h<a.length;h++){u.index>h?(p=u,u=null):p=u.sibling;var f=y(r,u,a[h],l);if(null===f){null===u&&(u=p);break}e&&u&&null===f.alternate&&t(r,u),s=i(f,s,h),null===d?c=f:d.sibling=f,d=f,u=p}if(h===a.length)return n(r,u),Zo&&Wo(r,h),c;if(null===u){for(;h<a.length;h++)null!==(u=g(r,a[h],l))&&(s=i(u,s,h),null===d?c=u:d.sibling=u,d=u);return Zo&&Wo(r,h),c}for(u=o(u);h<a.length;h++)null!==(p=v(u,r,h,a[h],l))&&(e&&null!==p.alternate&&u.delete(null===p.key?h:p.key),s=i(p,s,h),null===d?c=p:d.sibling=p,d=p);return e&&u.forEach((function(e){return t(r,e)})),Zo&&Wo(r,h),c}(l,h,p,f);if(C(p)){if("function"!==typeof(w=C(p)))throw Error(s(150));return function(r,a,l,c){if(null==l)throw Error(s(151));for(var d=null,u=null,h=a,p=a=0,f=null,m=l.next();null!==h&&!m.done;p++,m=l.next()){h.index>p?(f=h,h=null):f=h.sibling;var b=y(r,h,m.value,c);if(null===b){null===h&&(h=f);break}e&&h&&null===b.alternate&&t(r,h),a=i(b,a,p),null===u?d=b:u.sibling=b,u=b,h=f}if(m.done)return n(r,h),Zo&&Wo(r,p),d;if(null===h){for(;!m.done;p++,m=l.next())null!==(m=g(r,m.value,c))&&(a=i(m,a,p),null===u?d=m:u.sibling=m,u=m);return Zo&&Wo(r,p),d}for(h=o(h);!m.done;p++,m=l.next())null!==(m=v(h,r,p,m.value,c))&&(e&&null!==m.alternate&&h.delete(null===m.key?p:m.key),a=i(m,a,p),null===u?d=m:u.sibling=m,u=m);return e&&h.forEach((function(e){return t(r,e)})),Zo&&Wo(r,p),d}(l,h,p=w.call(p),f)}if("function"===typeof p.then)return b(l,h,yr(p),f);if(p.$$typeof===m)return b(l,h,_a(l,p),f);br(l,p)}return"string"===typeof p&&""!==p||"number"===typeof p||"bigint"===typeof p?(p=""+p,null!==h&&6===h.tag?(n(l,h.sibling),(f=r(h,p)).return=l,l=f):(n(l,h),(f=Hl(p,l.mode,f)).return=l,l=f),a(l)):n(l,h)}return function(e,t,n,o){try{mr=0;var r=b(e,t,n,o);return gr=null,r}catch(s){if(s===ar)throw s;var i=Rl(29,s,null,e.mode);return i.lanes=o,i.return=e,i}}}var Sr=xr(!0),kr=xr(!1),Pr=q(null),Cr=q(0);function _r(e,t){G(Cr,e=cc),G(Pr,t),cc=e|t.baseLanes}function Ir(){G(Cr,cc),G(Pr,Pr.current)}function Er(){cc=Cr.current,Y(Pr),Y(Cr)}var jr=q(null),Tr=null;function Mr(e){var t=e.alternate;G(Rr,1&Rr.current),G(jr,e),null===Tr&&(null===t||null!==Pr.current||null!==t.memoizedState)&&(Tr=e)}function Ar(e){if(22===e.tag){if(G(Rr,Rr.current),G(jr,e),null===Tr){var t=e.alternate;null!==t&&null!==t.memoizedState&&(Tr=e)}}else Or()}function Or(){G(Rr,Rr.current),G(jr,jr.current)}function Dr(e){Y(jr),Tr===e&&(Tr=null),Y(Rr)}var Rr=q(0);function Lr(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||"$!"===n.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(128&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var zr="undefined"!==typeof AbortController?AbortController:function(){var e=[],t=this.signal={aborted:!1,addEventListener:function(t,n){e.push(n)}};this.abort=function(){t.aborted=!0,e.forEach((function(e){return e()}))}},Nr=o.unstable_scheduleCallback,Fr=o.unstable_NormalPriority,Br={$$typeof:m,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Ur(){return{controller:new zr,data:new Map,refCount:0}}function Hr(e){e.refCount--,0===e.refCount&&Nr(Fr,(function(){e.controller.abort()}))}var Kr=null,Vr=0,Wr=0,qr=null;function Yr(){if(0===--Vr&&null!==Kr){null!==qr&&(qr.status="fulfilled");var e=Kr;Kr=null,Wr=0,qr=null;for(var t=0;t<e.length;t++)(0,e[t])()}}var Gr=T.S;T.S=function(e,t){"object"===typeof t&&null!==t&&"function"===typeof t.then&&function(e,t){if(null===Kr){var n=Kr=[];Vr=0,Wr=xd(),qr={status:"pending",value:void 0,then:function(e){n.push(e)}}}Vr++,t.then(Yr,Yr)}(0,t),null!==Gr&&Gr(e,t)};var Xr=q(null);function $r(){var e=Xr.current;return null!==e?e:tc.pooledCache}function Zr(e,t){G(Xr,null===t?Xr.current:t.pool)}function Qr(){var e=$r();return null===e?null:{parent:Br._currentValue,pool:e}}var Jr=0,ei=null,ti=null,ni=null,oi=!1,ri=!1,ii=!1,si=0,ai=0,li=null,ci=0;function di(){throw Error(s(321))}function ui(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!Gn(e[n],t[n]))return!1;return!0}function hi(e,t,n,o,r,i){return Jr=i,ei=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,T.H=null===e||null===e.memoizedState?_s:Is,ii=!1,i=n(o,r),ii=!1,ri&&(i=fi(t,n,o,r)),pi(e),i}function pi(e){T.H=Cs;var t=null!==ti&&null!==ti.next;if(Jr=0,ni=ti=ei=null,oi=!1,ai=0,li=null,t)throw Error(s(300));null===e||Vs||null!==(e=e.dependencies)&&ka(e)&&(Vs=!0)}function fi(e,t,n,o){ei=e;var r=0;do{if(ri&&(li=null),ai=0,ri=!1,25<=r)throw Error(s(301));if(r+=1,ni=ti=null,null!=e.updateQueue){var i=e.updateQueue;i.lastEffect=null,i.events=null,i.stores=null,null!=i.memoCache&&(i.memoCache.index=0)}T.H=Es,i=t(n,o)}while(ri);return i}function gi(){var e=T.H,t=e.useState()[0];return t="function"===typeof t.then?xi(t):t,e=e.useState()[0],(null!==ti?ti.memoizedState:null)!==e&&(ei.flags|=1024),t}function mi(){var e=0!==si;return si=0,e}function yi(e,t,n){t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~n}function vi(e){if(oi){for(e=e.memoizedState;null!==e;){var t=e.queue;null!==t&&(t.pending=null),e=e.next}oi=!1}Jr=0,ni=ti=ei=null,ri=!1,ai=si=0,li=null}function bi(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===ni?ei.memoizedState=ni=e:ni=ni.next=e,ni}function wi(){if(null===ti){var e=ei.alternate;e=null!==e?e.memoizedState:null}else e=ti.next;var t=null===ni?ei.memoizedState:ni.next;if(null!==t)ni=t,ti=e;else{if(null===e){if(null===ei.alternate)throw Error(s(467));throw Error(s(310))}e={memoizedState:(ti=e).memoizedState,baseState:ti.baseState,baseQueue:ti.baseQueue,queue:ti.queue,next:null},null===ni?ei.memoizedState=ni=e:ni=ni.next=e}return ni}function xi(e){var t=ai;return ai+=1,null===li&&(li=[]),e=hr(li,e,t),t=ei,null===(null===ni?t.memoizedState:ni.next)&&(t=t.alternate,T.H=null===t||null===t.memoizedState?_s:Is),e}function Si(e){if(null!==e&&"object"===typeof e){if("function"===typeof e.then)return xi(e);if(e.$$typeof===m)return Ca(e)}throw Error(s(438,String(e)))}function ki(e){var t=null,n=ei.updateQueue;if(null!==n&&(t=n.memoCache),null==t){var o=ei.alternate;null!==o&&(null!==(o=o.updateQueue)&&(null!=(o=o.memoCache)&&(t={data:o.data.map((function(e){return e.slice()})),index:0})))}if(null==t&&(t={data:[],index:0}),null===n&&(n={lastEffect:null,events:null,stores:null,memoCache:null},ei.updateQueue=n),n.memoCache=t,void 0===(n=t.data[t.index]))for(n=t.data[t.index]=Array(e),o=0;o<e;o++)n[o]=k;return t.index++,n}function Pi(e,t){return"function"===typeof t?t(e):t}function Ci(e){return _i(wi(),ti,e)}function _i(e,t,n){var o=e.queue;if(null===o)throw Error(s(311));o.lastRenderedReducer=n;var r=e.baseQueue,i=o.pending;if(null!==i){if(null!==r){var a=r.next;r.next=i.next,i.next=a}t.baseQueue=r=i,o.pending=null}if(i=e.baseState,null===r)e.memoizedState=i;else{var l=a=null,c=null,d=t=r.next,u=!1;do{var h=-536870913&d.lane;if(h!==d.lane?(oc&h)===h:(Jr&h)===h){var p=d.revertLane;if(0===p)null!==c&&(c=c.next={lane:0,revertLane:0,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null}),h===Wr&&(u=!0);else{if((Jr&p)===p){d=d.next,p===Wr&&(u=!0);continue}h={lane:0,revertLane:d.revertLane,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null},null===c?(l=c=h,a=i):c=c.next=h,ei.lanes|=p,uc|=p}h=d.action,ii&&n(i,h),i=d.hasEagerState?d.eagerState:n(i,h)}else p={lane:h,revertLane:d.revertLane,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null},null===c?(l=c=p,a=i):c=c.next=p,ei.lanes|=h,uc|=h;d=d.next}while(null!==d&&d!==t);if(null===c?a=i:c.next=l,!Gn(i,e.memoizedState)&&(Vs=!0,u&&null!==(n=qr)))throw n;e.memoizedState=i,e.baseState=a,e.baseQueue=c,o.lastRenderedState=i}return null===r&&(o.lanes=0),[e.memoizedState,o.dispatch]}function Ii(e){var t=wi(),n=t.queue;if(null===n)throw Error(s(311));n.lastRenderedReducer=e;var o=n.dispatch,r=n.pending,i=t.memoizedState;if(null!==r){n.pending=null;var a=r=r.next;do{i=e(i,a.action),a=a.next}while(a!==r);Gn(i,t.memoizedState)||(Vs=!0),t.memoizedState=i,null===t.baseQueue&&(t.baseState=i),n.lastRenderedState=i}return[i,o]}function Ei(e,t,n){var o=ei,r=wi(),i=Zo;if(i){if(void 0===n)throw Error(s(407));n=n()}else n=t();var a=!Gn((ti||r).memoizedState,n);if(a&&(r.memoizedState=n,Vs=!0),r=r.queue,Ji(Mi.bind(null,o,r,e),[e]),r.getSnapshot!==t||a||null!==ni&&1&ni.memoizedState.tag){if(o.flags|=2048,Gi(9,Ti.bind(null,o,r,n,t),{destroy:void 0},null),null===tc)throw Error(s(349));i||0!==(60&Jr)||ji(o,t,n)}return n}function ji(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=ei.updateQueue)?(t={lastEffect:null,events:null,stores:null,memoCache:null},ei.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function Ti(e,t,n,o){t.value=n,t.getSnapshot=o,Ai(t)&&Oi(e)}function Mi(e,t,n){return n((function(){Ai(t)&&Oi(e)}))}function Ai(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!Gn(e,n)}catch(o){return!0}}function Oi(e){var t=To(e,2);null!==t&&Ac(t,e,2)}function Di(e){var t=bi();if("function"===typeof e){var n=e;if(e=n(),ii){be(!0);try{n()}finally{be(!1)}}}return t.memoizedState=t.baseState=e,t.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Pi,lastRenderedState:e},t}function Ri(e,t,n,o){return e.baseState=n,_i(e,ti,"function"===typeof o?o:Pi)}function Li(e,t,n,o,r){if(Ss(e))throw Error(s(485));if(null!==(e=t.action)){var i={payload:r,action:e,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(e){i.listeners.push(e)}};null!==T.T?n(!0):i.isTransition=!1,o(i),null===(n=t.pending)?(i.next=t.pending=i,zi(t,i)):(i.next=n.next,t.pending=n.next=i)}}function zi(e,t){var n=t.action,o=t.payload,r=e.state;if(t.isTransition){var i=T.T,s={};T.T=s;try{var a=n(r,o),l=T.S;null!==l&&l(s,a),Ni(e,t,a)}catch(c){Bi(e,t,c)}finally{T.T=i}}else try{Ni(e,t,i=n(r,o))}catch(d){Bi(e,t,d)}}function Ni(e,t,n){null!==n&&"object"===typeof n&&"function"===typeof n.then?n.then((function(n){Fi(e,t,n)}),(function(n){return Bi(e,t,n)})):Fi(e,t,n)}function Fi(e,t,n){t.status="fulfilled",t.value=n,Ui(t),e.state=n,null!==(t=e.pending)&&((n=t.next)===t?e.pending=null:(n=n.next,t.next=n,zi(e,n)))}function Bi(e,t,n){var o=e.pending;if(e.pending=null,null!==o){o=o.next;do{t.status="rejected",t.reason=n,Ui(t),t=t.next}while(t!==o)}e.action=null}function Ui(e){e=e.listeners;for(var t=0;t<e.length;t++)(0,e[t])()}function Hi(e,t){return t}function Ki(e,t){if(Zo){var n=tc.formState;if(null!==n){e:{var o=ei;if(Zo){if($o){t:{for(var r=$o,i=Jo;8!==r.nodeType;){if(!i){r=null;break t}if(null===(r=au(r.nextSibling))){r=null;break t}}r="F!"===(i=r.data)||"F"===i?r:null}if(r){$o=au(r.nextSibling),o="F!"===r.data;break e}}tr(o)}o=!1}o&&(t=n[0])}}return(n=bi()).memoizedState=n.baseState=t,o={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Hi,lastRenderedState:t},n.queue=o,n=bs.bind(null,ei,o),o.dispatch=n,o=Di(!1),i=xs.bind(null,ei,!1,o.queue),r={state:t,dispatch:null,action:e,pending:null},(o=bi()).queue=r,n=Li.bind(null,ei,r,i,n),r.dispatch=n,o.memoizedState=e,[t,n,!1]}function Vi(e){return Wi(wi(),ti,e)}function Wi(e,t,n){t=_i(e,t,Hi)[0],e=Ci(Pi)[0],t="object"===typeof t&&null!==t&&"function"===typeof t.then?xi(t):t;var o=wi(),r=o.queue,i=r.dispatch;return n!==o.memoizedState&&(ei.flags|=2048,Gi(9,qi.bind(null,r,n),{destroy:void 0},null)),[t,i,e]}function qi(e,t){e.action=t}function Yi(e){var t=wi(),n=ti;if(null!==n)return Wi(t,n,e);wi(),t=t.memoizedState;var o=(n=wi()).queue.dispatch;return n.memoizedState=e,[t,o,!1]}function Gi(e,t,n,o){return e={tag:e,create:t,inst:n,deps:o,next:null},null===(t=ei.updateQueue)&&(t={lastEffect:null,events:null,stores:null,memoCache:null},ei.updateQueue=t),null===(n=t.lastEffect)?t.lastEffect=e.next=e:(o=n.next,n.next=e,e.next=o,t.lastEffect=e),e}function Xi(){return wi().memoizedState}function $i(e,t,n,o){var r=bi();ei.flags|=e,r.memoizedState=Gi(1|t,n,{destroy:void 0},void 0===o?null:o)}function Zi(e,t,n,o){var r=wi();o=void 0===o?null:o;var i=r.memoizedState.inst;null!==ti&&null!==o&&ui(o,ti.memoizedState.deps)?r.memoizedState=Gi(t,n,i,o):(ei.flags|=e,r.memoizedState=Gi(1|t,n,i,o))}function Qi(e,t){$i(8390656,8,e,t)}function Ji(e,t){Zi(2048,8,e,t)}function es(e,t){return Zi(4,2,e,t)}function ts(e,t){return Zi(4,4,e,t)}function ns(e,t){if("function"===typeof t){e=e();var n=t(e);return function(){"function"===typeof n?n():t(null)}}if(null!==t&&void 0!==t)return e=e(),t.current=e,function(){t.current=null}}function os(e,t,n){n=null!==n&&void 0!==n?n.concat([e]):null,Zi(4,4,ns.bind(null,t,e),n)}function rs(){}function is(e,t){var n=wi();t=void 0===t?null:t;var o=n.memoizedState;return null!==t&&ui(t,o[1])?o[0]:(n.memoizedState=[e,t],e)}function ss(e,t){var n=wi();t=void 0===t?null:t;var o=n.memoizedState;if(null!==t&&ui(t,o[1]))return o[0];if(o=e(),ii){be(!0);try{e()}finally{be(!1)}}return n.memoizedState=[o,t],o}function as(e,t,n){return void 0===n||0!==(1073741824&Jr)?e.memoizedState=t:(e.memoizedState=n,e=Mc(),ei.lanes|=e,uc|=e,n)}function ls(e,t,n,o){return Gn(n,t)?n:null!==Pr.current?(e=as(e,n,o),Gn(e,t)||(Vs=!0),e):0===(42&Jr)?(Vs=!0,e.memoizedState=n):(e=Mc(),ei.lanes|=e,uc|=e,t)}function cs(e,t,n,o,r){var i=H.p;H.p=0!==i&&8>i?i:8;var s=T.T,a={};T.T=a,xs(e,!1,t,n);try{var l=r(),c=T.S;if(null!==c&&c(a,l),null!==l&&"object"===typeof l&&"function"===typeof l.then)ws(e,t,function(e,t){var n=[],o={status:"pending",value:null,reason:null,then:function(e){n.push(e)}};return e.then((function(){o.status="fulfilled",o.value=t;for(var e=0;e<n.length;e++)(0,n[e])(t)}),(function(e){for(o.status="rejected",o.reason=e,e=0;e<n.length;e++)(0,n[e])(void 0)})),o}(l,o),Tc());else ws(e,t,o,Tc())}catch(d){ws(e,t,{then:function(){},status:"rejected",reason:d},Tc())}finally{H.p=i,T.T=s}}function ds(){}function us(e,t,n,o){if(5!==e.tag)throw Error(s(476));var r=hs(e).queue;cs(e,r,t,K,null===n?ds:function(){return ps(e),n(o)})}function hs(e){var t=e.memoizedState;if(null!==t)return t;var n={};return(t={memoizedState:K,baseState:K,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Pi,lastRenderedState:K},next:null}).next={memoizedState:n,baseState:n,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Pi,lastRenderedState:n},next:null},e.memoizedState=t,null!==(e=e.alternate)&&(e.memoizedState=t),t}function ps(e){ws(e,hs(e).next.queue,{},Tc())}function fs(){return Ca(Lu)}function gs(){return wi().memoizedState}function ms(){return wi().memoizedState}function ys(e){for(var t=e.return;null!==t;){switch(t.tag){case 24:case 3:var n=Tc(),o=Aa(t,e=Ma(n),n);return null!==o&&(Ac(o,t,n),Oa(o,t,n)),t={cache:Ur()},void(e.payload=t)}t=t.return}}function vs(e,t,n){var o=Tc();n={lane:o,revertLane:0,action:n,hasEagerState:!1,eagerState:null,next:null},Ss(e)?ks(t,n):null!==(n=jo(e,t,n,o))&&(Ac(n,e,o),Ps(n,t,o))}function bs(e,t,n){ws(e,t,n,Tc())}function ws(e,t,n,o){var r={lane:o,revertLane:0,action:n,hasEagerState:!1,eagerState:null,next:null};if(Ss(e))ks(t,r);else{var i=e.alternate;if(0===e.lanes&&(null===i||0===i.lanes)&&null!==(i=t.lastRenderedReducer))try{var s=t.lastRenderedState,a=i(s,n);if(r.hasEagerState=!0,r.eagerState=a,Gn(a,s))return Eo(e,t,r,0),null===tc&&Io(),!1}catch(l){}if(null!==(n=jo(e,t,r,o)))return Ac(n,e,o),Ps(n,t,o),!0}return!1}function xs(e,t,n,o){if(o={lane:2,revertLane:xd(),action:o,hasEagerState:!1,eagerState:null,next:null},Ss(e)){if(t)throw Error(s(479))}else null!==(t=jo(e,n,o,2))&&Ac(t,e,2)}function Ss(e){var t=e.alternate;return e===ei||null!==t&&t===ei}function ks(e,t){ri=oi=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function Ps(e,t,n){if(0!==(4194176&n)){var o=t.lanes;n|=o&=e.pendingLanes,t.lanes=n,De(e,n)}}var Cs={readContext:Ca,use:Si,useCallback:di,useContext:di,useEffect:di,useImperativeHandle:di,useLayoutEffect:di,useInsertionEffect:di,useMemo:di,useReducer:di,useRef:di,useState:di,useDebugValue:di,useDeferredValue:di,useTransition:di,useSyncExternalStore:di,useId:di};Cs.useCacheRefresh=di,Cs.useMemoCache=di,Cs.useHostTransitionStatus=di,Cs.useFormState=di,Cs.useActionState=di,Cs.useOptimistic=di;var _s={readContext:Ca,use:Si,useCallback:function(e,t){return bi().memoizedState=[e,void 0===t?null:t],e},useContext:Ca,useEffect:Qi,useImperativeHandle:function(e,t,n){n=null!==n&&void 0!==n?n.concat([e]):null,$i(4194308,4,ns.bind(null,t,e),n)},useLayoutEffect:function(e,t){return $i(4194308,4,e,t)},useInsertionEffect:function(e,t){$i(4,2,e,t)},useMemo:function(e,t){var n=bi();t=void 0===t?null:t;var o=e();if(ii){be(!0);try{e()}finally{be(!1)}}return n.memoizedState=[o,t],o},useReducer:function(e,t,n){var o=bi();if(void 0!==n){var r=n(t);if(ii){be(!0);try{n(t)}finally{be(!1)}}}else r=t;return o.memoizedState=o.baseState=r,e={pending:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:r},o.queue=e,e=e.dispatch=vs.bind(null,ei,e),[o.memoizedState,e]},useRef:function(e){return e={current:e},bi().memoizedState=e},useState:function(e){var t=(e=Di(e)).queue,n=bs.bind(null,ei,t);return t.dispatch=n,[e.memoizedState,n]},useDebugValue:rs,useDeferredValue:function(e,t){return as(bi(),e,t)},useTransition:function(){var e=Di(!1);return e=cs.bind(null,ei,e.queue,!0,!1),bi().memoizedState=e,[!1,e]},useSyncExternalStore:function(e,t,n){var o=ei,r=bi();if(Zo){if(void 0===n)throw Error(s(407));n=n()}else{if(n=t(),null===tc)throw Error(s(349));0!==(60&oc)||ji(o,t,n)}r.memoizedState=n;var i={value:n,getSnapshot:t};return r.queue=i,Qi(Mi.bind(null,o,i,e),[e]),o.flags|=2048,Gi(9,Ti.bind(null,o,i,n,t),{destroy:void 0},null),n},useId:function(){var e=bi(),t=tc.identifierPrefix;if(Zo){var n=Vo;t=":"+t+"R"+(n=(Ko&~(1<<32-we(Ko)-1)).toString(32)+n),0<(n=si++)&&(t+="H"+n.toString(32)),t+=":"}else t=":"+t+"r"+(n=ci++).toString(32)+":";return e.memoizedState=t},useCacheRefresh:function(){return bi().memoizedState=ys.bind(null,ei)}};_s.useMemoCache=ki,_s.useHostTransitionStatus=fs,_s.useFormState=Ki,_s.useActionState=Ki,_s.useOptimistic=function(e){var t=bi();t.memoizedState=t.baseState=e;var n={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return t.queue=n,t=xs.bind(null,ei,!0,n),n.dispatch=t,[e,t]};var Is={readContext:Ca,use:Si,useCallback:is,useContext:Ca,useEffect:Ji,useImperativeHandle:os,useInsertionEffect:es,useLayoutEffect:ts,useMemo:ss,useReducer:Ci,useRef:Xi,useState:function(){return Ci(Pi)},useDebugValue:rs,useDeferredValue:function(e,t){return ls(wi(),ti.memoizedState,e,t)},useTransition:function(){var e=Ci(Pi)[0],t=wi().memoizedState;return["boolean"===typeof e?e:xi(e),t]},useSyncExternalStore:Ei,useId:gs};Is.useCacheRefresh=ms,Is.useMemoCache=ki,Is.useHostTransitionStatus=fs,Is.useFormState=Vi,Is.useActionState=Vi,Is.useOptimistic=function(e,t){return Ri(wi(),0,e,t)};var Es={readContext:Ca,use:Si,useCallback:is,useContext:Ca,useEffect:Ji,useImperativeHandle:os,useInsertionEffect:es,useLayoutEffect:ts,useMemo:ss,useReducer:Ii,useRef:Xi,useState:function(){return Ii(Pi)},useDebugValue:rs,useDeferredValue:function(e,t){var n=wi();return null===ti?as(n,e,t):ls(n,ti.memoizedState,e,t)},useTransition:function(){var e=Ii(Pi)[0],t=wi().memoizedState;return["boolean"===typeof e?e:xi(e),t]},useSyncExternalStore:Ei,useId:gs};function js(e,t,n,o){n=null===(n=n(o,t=e.memoizedState))||void 0===n?t:M({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}Es.useCacheRefresh=ms,Es.useMemoCache=ki,Es.useHostTransitionStatus=fs,Es.useFormState=Yi,Es.useActionState=Yi,Es.useOptimistic=function(e,t){var n=wi();return null!==ti?Ri(n,0,e,t):(n.baseState=e,[e,n.queue.dispatch])};var Ts={isMounted:function(e){return!!(e=e._reactInternals)&&z(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternals;var o=Tc(),r=Ma(o);r.payload=t,void 0!==n&&null!==n&&(r.callback=n),null!==(t=Aa(e,r,o))&&(Ac(t,e,o),Oa(t,e,o))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var o=Tc(),r=Ma(o);r.tag=1,r.payload=t,void 0!==n&&null!==n&&(r.callback=n),null!==(t=Aa(e,r,o))&&(Ac(t,e,o),Oa(t,e,o))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=Tc(),o=Ma(n);o.tag=2,void 0!==t&&null!==t&&(o.callback=t),null!==(t=Aa(e,o,n))&&(Ac(t,e,n),Oa(t,e,n))}};function Ms(e,t,n,o,r,i,s){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(o,i,s):!t.prototype||!t.prototype.isPureReactComponent||(!Xn(n,o)||!Xn(r,i))}function As(e,t,n,o){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,o),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,o),t.state!==e&&Ts.enqueueReplaceState(t,t.state,null)}function Os(e,t){var n=t;if("ref"in t)for(var o in n={},t)"ref"!==o&&(n[o]=t[o]);if(e=e.defaultProps)for(var r in n===t&&(n=M({},n)),e)void 0===n[r]&&(n[r]=e[r]);return n}var Ds="function"===typeof reportError?reportError:function(e){if("object"===typeof window&&"function"===typeof window.ErrorEvent){var t=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:"object"===typeof e&&null!==e&&"string"===typeof e.message?String(e.message):String(e),error:e});if(!window.dispatchEvent(t))return}else if("object"===typeof process&&"function"===typeof process.emit)return void process.emit("uncaughtException",e);console.error(e)};function Rs(e){Ds(e)}function Ls(e){console.error(e)}function zs(e){Ds(e)}function Ns(e,t){try{(0,e.onUncaughtError)(t.value,{componentStack:t.stack})}catch(n){setTimeout((function(){throw n}))}}function Fs(e,t,n){try{(0,e.onCaughtError)(n.value,{componentStack:n.stack,errorBoundary:1===t.tag?t.stateNode:null})}catch(o){setTimeout((function(){throw o}))}}function Bs(e,t,n){return(n=Ma(n)).tag=3,n.payload={element:null},n.callback=function(){Ns(e,t)},n}function Us(e){return(e=Ma(e)).tag=3,e}function Hs(e,t,n,o){var r=n.type.getDerivedStateFromError;if("function"===typeof r){var i=o.value;e.payload=function(){return r(i)},e.callback=function(){Fs(t,n,o)}}var s=n.stateNode;null!==s&&"function"===typeof s.componentDidCatch&&(e.callback=function(){Fs(t,n,o),"function"!==typeof r&&(null===Sc?Sc=new Set([this]):Sc.add(this));var e=o.stack;this.componentDidCatch(o.value,{componentStack:null!==e?e:""})})}var Ks=Error(s(461)),Vs=!1;function Ws(e,t,n,o){t.child=null===e?kr(t,null,n,o):Sr(t,e.child,n,o)}function qs(e,t,n,o,r){n=n.render;var i=t.ref;if("ref"in o){var s={};for(var a in o)"ref"!==a&&(s[a]=o[a])}else s=o;return Pa(t),o=hi(e,t,n,s,i,r),a=mi(),null===e||Vs?(Zo&&a&&Yo(t),t.flags|=1,Ws(e,t,o,r),t.child):(yi(e,t,r),ha(e,t,r))}function Ys(e,t,n,o,r){if(null===e){var i=n.type;return"function"!==typeof i||Ll(i)||void 0!==i.defaultProps||null!==n.compare?((e=Fl(n.type,null,o,t,t.mode,r)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=i,Gs(e,t,i,o,r))}if(i=e.child,!pa(e,r)){var s=i.memoizedProps;if((n=null!==(n=n.compare)?n:Xn)(s,o)&&e.ref===t.ref)return ha(e,t,r)}return t.flags|=1,(e=zl(i,o)).ref=t.ref,e.return=t,t.child=e}function Gs(e,t,n,o,r){if(null!==e){var i=e.memoizedProps;if(Xn(i,o)&&e.ref===t.ref){if(Vs=!1,t.pendingProps=o=i,!pa(e,r))return t.lanes=e.lanes,ha(e,t,r);0!==(131072&e.flags)&&(Vs=!0)}}return Qs(e,t,n,o,r)}function Xs(e,t,n){var o=t.pendingProps,r=o.children,i=0!==(2&t.stateNode._pendingVisibility),s=null!==e?e.memoizedState:null;if(Zs(e,t),"hidden"===o.mode||i){if(0!==(128&t.flags)){if(o=null!==s?s.baseLanes|n:n,null!==e){for(r=t.child=e.child,i=0;null!==r;)i=i|r.lanes|r.childLanes,r=r.sibling;t.childLanes=i&~o}else t.childLanes=0,t.child=null;return $s(e,t,o,n)}if(0===(536870912&n))return t.lanes=t.childLanes=536870912,$s(e,t,null!==s?s.baseLanes|n:n,n);t.memoizedState={baseLanes:0,cachePool:null},null!==e&&Zr(0,null!==s?s.cachePool:null),null!==s?_r(t,s):Ir(),Ar(t)}else null!==s?(Zr(0,s.cachePool),_r(t,s),Or(),t.memoizedState=null):(null!==e&&Zr(0,null),Ir(),Or());return Ws(e,t,r,n),t.child}function $s(e,t,n,o){var r=$r();return r=null===r?null:{parent:Br._currentValue,pool:r},t.memoizedState={baseLanes:n,cachePool:r},null!==e&&Zr(0,null),Ir(),Ar(t),null!==e&&Sa(e,t,o,!0),null}function Zs(e,t){var n=t.ref;if(null===n)null!==e&&null!==e.ref&&(t.flags|=2097664);else{if("function"!==typeof n&&"object"!==typeof n)throw Error(s(284));null!==e&&e.ref===n||(t.flags|=2097664)}}function Qs(e,t,n,o,r){return Pa(t),n=hi(e,t,n,o,void 0,r),o=mi(),null===e||Vs?(Zo&&o&&Yo(t),t.flags|=1,Ws(e,t,n,r),t.child):(yi(e,t,r),ha(e,t,r))}function Js(e,t,n,o,r,i){return Pa(t),t.updateQueue=null,n=fi(t,o,n,r),pi(e),o=mi(),null===e||Vs?(Zo&&o&&Yo(t),t.flags|=1,Ws(e,t,n,i),t.child):(yi(e,t,i),ha(e,t,i))}function ea(e,t,n,o,r){if(Pa(t),null===t.stateNode){var i=Oo,s=n.contextType;"object"===typeof s&&null!==s&&(i=Ca(s)),i=new n(o,i),t.memoizedState=null!==i.state&&void 0!==i.state?i.state:null,i.updater=Ts,t.stateNode=i,i._reactInternals=t,(i=t.stateNode).props=o,i.state=t.memoizedState,i.refs={},ja(t),s=n.contextType,i.context="object"===typeof s&&null!==s?Ca(s):Oo,i.state=t.memoizedState,"function"===typeof(s=n.getDerivedStateFromProps)&&(js(t,n,s,o),i.state=t.memoizedState),"function"===typeof n.getDerivedStateFromProps||"function"===typeof i.getSnapshotBeforeUpdate||"function"!==typeof i.UNSAFE_componentWillMount&&"function"!==typeof i.componentWillMount||(s=i.state,"function"===typeof i.componentWillMount&&i.componentWillMount(),"function"===typeof i.UNSAFE_componentWillMount&&i.UNSAFE_componentWillMount(),s!==i.state&&Ts.enqueueReplaceState(i,i.state,null),za(t,o,i,r),La(),i.state=t.memoizedState),"function"===typeof i.componentDidMount&&(t.flags|=4194308),o=!0}else if(null===e){i=t.stateNode;var a=t.memoizedProps,l=Os(n,a);i.props=l;var c=i.context,d=n.contextType;s=Oo,"object"===typeof d&&null!==d&&(s=Ca(d));var u=n.getDerivedStateFromProps;d="function"===typeof u||"function"===typeof i.getSnapshotBeforeUpdate,a=t.pendingProps!==a,d||"function"!==typeof i.UNSAFE_componentWillReceiveProps&&"function"!==typeof i.componentWillReceiveProps||(a||c!==s)&&As(t,i,o,s),Ea=!1;var h=t.memoizedState;i.state=h,za(t,o,i,r),La(),c=t.memoizedState,a||h!==c||Ea?("function"===typeof u&&(js(t,n,u,o),c=t.memoizedState),(l=Ea||Ms(t,n,l,o,h,c,s))?(d||"function"!==typeof i.UNSAFE_componentWillMount&&"function"!==typeof i.componentWillMount||("function"===typeof i.componentWillMount&&i.componentWillMount(),"function"===typeof i.UNSAFE_componentWillMount&&i.UNSAFE_componentWillMount()),"function"===typeof i.componentDidMount&&(t.flags|=4194308)):("function"===typeof i.componentDidMount&&(t.flags|=4194308),t.memoizedProps=o,t.memoizedState=c),i.props=o,i.state=c,i.context=s,o=l):("function"===typeof i.componentDidMount&&(t.flags|=4194308),o=!1)}else{i=t.stateNode,Ta(e,t),d=Os(n,s=t.memoizedProps),i.props=d,u=t.pendingProps,h=i.context,c=n.contextType,l=Oo,"object"===typeof c&&null!==c&&(l=Ca(c)),(c="function"===typeof(a=n.getDerivedStateFromProps)||"function"===typeof i.getSnapshotBeforeUpdate)||"function"!==typeof i.UNSAFE_componentWillReceiveProps&&"function"!==typeof i.componentWillReceiveProps||(s!==u||h!==l)&&As(t,i,o,l),Ea=!1,h=t.memoizedState,i.state=h,za(t,o,i,r),La();var p=t.memoizedState;s!==u||h!==p||Ea||null!==e&&null!==e.dependencies&&ka(e.dependencies)?("function"===typeof a&&(js(t,n,a,o),p=t.memoizedState),(d=Ea||Ms(t,n,d,o,h,p,l)||null!==e&&null!==e.dependencies&&ka(e.dependencies))?(c||"function"!==typeof i.UNSAFE_componentWillUpdate&&"function"!==typeof i.componentWillUpdate||("function"===typeof i.componentWillUpdate&&i.componentWillUpdate(o,p,l),"function"===typeof i.UNSAFE_componentWillUpdate&&i.UNSAFE_componentWillUpdate(o,p,l)),"function"===typeof i.componentDidUpdate&&(t.flags|=4),"function"===typeof i.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!==typeof i.componentDidUpdate||s===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!==typeof i.getSnapshotBeforeUpdate||s===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),t.memoizedProps=o,t.memoizedState=p),i.props=o,i.state=p,i.context=l,o=d):("function"!==typeof i.componentDidUpdate||s===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!==typeof i.getSnapshotBeforeUpdate||s===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),o=!1)}return i=o,Zs(e,t),o=0!==(128&t.flags),i||o?(i=t.stateNode,n=o&&"function"!==typeof n.getDerivedStateFromError?null:i.render(),t.flags|=1,null!==e&&o?(t.child=Sr(t,e.child,null,r),t.child=Sr(t,null,n,r)):Ws(e,t,n,r),t.memoizedState=i.state,e=t.child):e=ha(e,t,r),e}function ta(e,t,n,o){return ir(),t.flags|=256,Ws(e,t,n,o),t.child}var na={dehydrated:null,treeContext:null,retryLane:0};function oa(e){return{baseLanes:e,cachePool:Qr()}}function ra(e,t,n){return e=null!==e?e.childLanes&~n:0,t&&(e|=fc),e}function ia(e,t,n){var o,r=t.pendingProps,i=!1,a=0!==(128&t.flags);if((o=a)||(o=(null===e||null!==e.memoizedState)&&0!==(2&Rr.current)),o&&(i=!0,t.flags&=-129),o=0!==(32&t.flags),t.flags&=-33,null===e){if(Zo){if(i?Mr(t):Or(),Zo){var l,c=$o;if(l=c){e:{for(l=c,c=Jo;8!==l.nodeType;){if(!c){c=null;break e}if(null===(l=au(l.nextSibling))){c=null;break e}}c=l}null!==c?(t.memoizedState={dehydrated:c,treeContext:null!==Ho?{id:Ko,overflow:Vo}:null,retryLane:536870912},(l=Rl(18,null,null,0)).stateNode=c,l.return=t,t.child=l,Xo=t,$o=null,l=!0):l=!1}l||tr(t)}if(null!==(c=t.memoizedState)&&null!==(c=c.dehydrated))return"$!"===c.data?t.lanes=16:t.lanes=536870912,null;Dr(t)}return c=r.children,r=r.fallback,i?(Or(),c=aa({mode:"hidden",children:c},i=t.mode),r=Bl(r,i,n,null),c.return=t,r.return=t,c.sibling=r,t.child=c,(i=t.child).memoizedState=oa(n),i.childLanes=ra(e,o,n),t.memoizedState=na,r):(Mr(t),sa(t,c))}if(null!==(l=e.memoizedState)&&null!==(c=l.dehydrated)){if(a)256&t.flags?(Mr(t),t.flags&=-257,t=la(e,t,n)):null!==t.memoizedState?(Or(),t.child=e.child,t.flags|=128,t=null):(Or(),i=r.fallback,c=t.mode,r=aa({mode:"visible",children:r.children},c),(i=Bl(i,c,n,null)).flags|=2,r.return=t,i.return=t,r.sibling=i,t.child=r,Sr(t,e.child,null,n),(r=t.child).memoizedState=oa(n),r.childLanes=ra(e,o,n),t.memoizedState=na,t=i);else if(Mr(t),"$!"===c.data){if(o=c.nextSibling&&c.nextSibling.dataset)var d=o.dgst;o=d,(r=Error(s(419))).stack="",r.digest=o,sr({value:r,source:null,stack:null}),t=la(e,t,n)}else if(Vs||Sa(e,t,n,!1),o=0!==(n&e.childLanes),Vs||o){if(null!==(o=tc)){if(0!==(42&(r=n&-n)))r=1;else switch(r){case 2:r=1;break;case 8:r=4;break;case 32:r=16;break;case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:r=64;break;case 268435456:r=134217728;break;default:r=0}if(0!==(r=0!==(r&(o.suspendedLanes|n))?0:r)&&r!==l.retryLane)throw l.retryLane=r,To(e,r),Ac(o,e,r),Ks}"$?"===c.data||Vc(),t=la(e,t,n)}else"$?"===c.data?(t.flags|=128,t.child=e.child,t=ad.bind(null,e),c._reactRetry=t,t=null):(e=l.treeContext,$o=au(c.nextSibling),Xo=t,Zo=!0,Qo=null,Jo=!1,null!==e&&(Bo[Uo++]=Ko,Bo[Uo++]=Vo,Bo[Uo++]=Ho,Ko=e.id,Vo=e.overflow,Ho=t),(t=sa(t,r.children)).flags|=4096);return t}return i?(Or(),i=r.fallback,c=t.mode,d=(l=e.child).sibling,(r=zl(l,{mode:"hidden",children:r.children})).subtreeFlags=31457280&l.subtreeFlags,null!==d?i=zl(d,i):(i=Bl(i,c,n,null)).flags|=2,i.return=t,r.return=t,r.sibling=i,t.child=r,r=i,i=t.child,null===(c=e.child.memoizedState)?c=oa(n):(null!==(l=c.cachePool)?(d=Br._currentValue,l=l.parent!==d?{parent:d,pool:d}:l):l=Qr(),c={baseLanes:c.baseLanes|n,cachePool:l}),i.memoizedState=c,i.childLanes=ra(e,o,n),t.memoizedState=na,r):(Mr(t),e=(n=e.child).sibling,(n=zl(n,{mode:"visible",children:r.children})).return=t,n.sibling=null,null!==e&&(null===(o=t.deletions)?(t.deletions=[e],t.flags|=16):o.push(e)),t.child=n,t.memoizedState=null,n)}function sa(e,t){return(t=aa({mode:"visible",children:t},e.mode)).return=e,e.child=t}function aa(e,t){return Ul(e,t,0,null)}function la(e,t,n){return Sr(t,e.child,null,n),(e=sa(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function ca(e,t,n){e.lanes|=t;var o=e.alternate;null!==o&&(o.lanes|=t),wa(e.return,t,n)}function da(e,t,n,o,r){var i=e.memoizedState;null===i?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:o,tail:n,tailMode:r}:(i.isBackwards=t,i.rendering=null,i.renderingStartTime=0,i.last=o,i.tail=n,i.tailMode=r)}function ua(e,t,n){var o=t.pendingProps,r=o.revealOrder,i=o.tail;if(Ws(e,t,o.children,n),0!==(2&(o=Rr.current)))o=1&o|2,t.flags|=128;else{if(null!==e&&0!==(128&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&ca(e,n,t);else if(19===e.tag)ca(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}o&=1}switch(G(Rr,o),r){case"forwards":for(n=t.child,r=null;null!==n;)null!==(e=n.alternate)&&null===Lr(e)&&(r=n),n=n.sibling;null===(n=r)?(r=t.child,t.child=null):(r=n.sibling,n.sibling=null),da(t,!1,r,n,i);break;case"backwards":for(n=null,r=t.child,t.child=null;null!==r;){if(null!==(e=r.alternate)&&null===Lr(e)){t.child=r;break}e=r.sibling,r.sibling=n,n=r,r=e}da(t,!0,n,null,i);break;case"together":da(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function ha(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),uc|=t.lanes,0===(n&t.childLanes)){if(null===e)return null;if(Sa(e,t,n,!1),0===(n&t.childLanes))return null}if(null!==e&&t.child!==e.child)throw Error(s(153));if(null!==t.child){for(n=zl(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=zl(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function pa(e,t){return 0!==(e.lanes&t)||!(null===(e=e.dependencies)||!ka(e))}function fa(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps)Vs=!0;else{if(!pa(e,n)&&0===(128&t.flags))return Vs=!1,function(e,t,n){switch(t.tag){case 3:J(t,t.stateNode.containerInfo),va(t,Br,e.memoizedState.cache),ir();break;case 27:case 5:te(t);break;case 4:J(t,t.stateNode.containerInfo);break;case 10:va(t,t.type,t.memoizedProps.value);break;case 13:var o=t.memoizedState;if(null!==o)return null!==o.dehydrated?(Mr(t),t.flags|=128,null):0!==(n&t.child.childLanes)?ia(e,t,n):(Mr(t),null!==(e=ha(e,t,n))?e.sibling:null);Mr(t);break;case 19:var r=0!==(128&e.flags);if((o=0!==(n&t.childLanes))||(Sa(e,t,n,!1),o=0!==(n&t.childLanes)),r){if(o)return ua(e,t,n);t.flags|=128}if(null!==(r=t.memoizedState)&&(r.rendering=null,r.tail=null,r.lastEffect=null),G(Rr,Rr.current),o)break;return null;case 22:case 23:return t.lanes=0,Xs(e,t,n);case 24:va(t,Br,e.memoizedState.cache)}return ha(e,t,n)}(e,t,n);Vs=0!==(131072&e.flags)}else Vs=!1,Zo&&0!==(1048576&t.flags)&&qo(t,Fo,t.index);switch(t.lanes=0,t.tag){case 16:e:{e=t.pendingProps;var o=t.elementType,r=o._init;if(o=r(o._payload),t.type=o,"function"!==typeof o){if(void 0!==o&&null!==o){if((r=o.$$typeof)===y){t.tag=11,t=qs(null,t,o,e,n);break e}if(r===w){t.tag=14,t=Ys(null,t,o,e,n);break e}}throw t=I(o)||o,Error(s(306,t,""))}Ll(o)?(e=Os(o,e),t.tag=1,t=ea(null,t,o,e,n)):(t.tag=0,t=Qs(null,t,o,e,n))}return t;case 0:return Qs(e,t,t.type,t.pendingProps,n);case 1:return ea(e,t,o=t.type,r=Os(o,t.pendingProps),n);case 3:e:{if(J(t,t.stateNode.containerInfo),null===e)throw Error(s(387));var i=t.pendingProps;o=(r=t.memoizedState).element,Ta(e,t),za(t,i,null,n);var a=t.memoizedState;if(i=a.cache,va(t,Br,i),i!==r.cache&&xa(t,[Br],n,!0),La(),i=a.element,r.isDehydrated){if(r={element:i,isDehydrated:!1,cache:a.cache},t.updateQueue.baseState=r,t.memoizedState=r,256&t.flags){t=ta(e,t,i,n);break e}if(i!==o){sr(o=Ro(Error(s(424)),t)),t=ta(e,t,i,n);break e}for($o=au(t.stateNode.containerInfo.firstChild),Xo=t,Zo=!0,Qo=null,Jo=!0,n=kr(t,null,i,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(ir(),i===o){t=ha(e,t,n);break e}Ws(e,t,i,n)}t=t.child}return t;case 26:return Zs(e,t),null===e?(n=mu(t.type,null,t.pendingProps,null))?t.memoizedState=n:Zo||(n=t.type,e=t.pendingProps,(o=Xd(Z.current).createElement(n))[Ne]=t,o[Fe]=e,qd(o,n,e),Ze(o),t.stateNode=o):t.memoizedState=mu(t.type,e.memoizedProps,t.pendingProps,e.memoizedState),null;case 27:return te(t),null===e&&Zo&&(o=t.stateNode=cu(t.type,t.pendingProps,Z.current),Xo=t,Jo=!0,$o=au(o.firstChild)),o=t.pendingProps.children,null!==e||Zo?Ws(e,t,o,n):t.child=Sr(t,null,o,n),Zs(e,t),t.child;case 5:return null===e&&Zo&&((r=o=$o)&&(null!==(o=function(e,t,n,o){for(;1===e.nodeType;){var r=n;if(e.nodeName.toLowerCase()!==t.toLowerCase()){if(!o&&("INPUT"!==e.nodeName||"hidden"!==e.type))break}else if(o){if(!e[We])switch(t){case"meta":if(!e.hasAttribute("itemprop"))break;return e;case"link":if("stylesheet"===(i=e.getAttribute("rel"))&&e.hasAttribute("data-precedence"))break;if(i!==r.rel||e.getAttribute("href")!==(null==r.href?null:r.href)||e.getAttribute("crossorigin")!==(null==r.crossOrigin?null:r.crossOrigin)||e.getAttribute("title")!==(null==r.title?null:r.title))break;return e;case"style":if(e.hasAttribute("data-precedence"))break;return e;case"script":if(((i=e.getAttribute("src"))!==(null==r.src?null:r.src)||e.getAttribute("type")!==(null==r.type?null:r.type)||e.getAttribute("crossorigin")!==(null==r.crossOrigin?null:r.crossOrigin))&&i&&e.hasAttribute("async")&&!e.hasAttribute("itemprop"))break;return e;default:return e}}else{if("input"!==t||"hidden"!==e.type)return e;var i=null==r.name?null:""+r.name;if("hidden"===r.type&&e.getAttribute("name")===i)return e}if(null===(e=au(e.nextSibling)))break}return null}(o,t.type,t.pendingProps,Jo))?(t.stateNode=o,Xo=t,$o=au(o.firstChild),Jo=!1,r=!0):r=!1),r||tr(t)),te(t),r=t.type,i=t.pendingProps,a=null!==e?e.memoizedProps:null,o=i.children,Qd(r,i)?o=null:null!==a&&Qd(r,a)&&(t.flags|=32),null!==t.memoizedState&&(r=hi(e,t,gi,null,null,n),Lu._currentValue=r),Zs(e,t),Ws(e,t,o,n),t.child;case 6:return null===e&&Zo&&((e=n=$o)&&(null!==(n=function(e,t,n){if(""===t)return null;for(;3!==e.nodeType;){if((1!==e.nodeType||"INPUT"!==e.nodeName||"hidden"!==e.type)&&!n)return null;if(null===(e=au(e.nextSibling)))return null}return e}(n,t.pendingProps,Jo))?(t.stateNode=n,Xo=t,$o=null,e=!0):e=!1),e||tr(t)),null;case 13:return ia(e,t,n);case 4:return J(t,t.stateNode.containerInfo),o=t.pendingProps,null===e?t.child=Sr(t,null,o,n):Ws(e,t,o,n),t.child;case 11:return qs(e,t,t.type,t.pendingProps,n);case 7:return Ws(e,t,t.pendingProps,n),t.child;case 8:case 12:return Ws(e,t,t.pendingProps.children,n),t.child;case 10:return o=t.pendingProps,va(t,t.type,o.value),Ws(e,t,o.children,n),t.child;case 9:return r=t.type._context,o=t.pendingProps.children,Pa(t),o=o(r=Ca(r)),t.flags|=1,Ws(e,t,o,n),t.child;case 14:return Ys(e,t,t.type,t.pendingProps,n);case 15:return Gs(e,t,t.type,t.pendingProps,n);case 19:return ua(e,t,n);case 22:return Xs(e,t,n);case 24:return Pa(t),o=Ca(Br),null===e?(null===(r=$r())&&(r=tc,i=Ur(),r.pooledCache=i,i.refCount++,null!==i&&(r.pooledCacheLanes|=n),r=i),t.memoizedState={parent:o,cache:r},ja(t),va(t,Br,r)):(0!==(e.lanes&n)&&(Ta(e,t),za(t,null,null,n),La()),r=e.memoizedState,i=t.memoizedState,r.parent!==o?(r={parent:o,cache:o},t.memoizedState=r,0===t.lanes&&(t.memoizedState=t.updateQueue.baseState=r),va(t,Br,o)):(o=i.cache,va(t,Br,o),o!==r.cache&&xa(t,[Br],n,!0))),Ws(e,t,t.pendingProps.children,n),t.child;case 29:throw t.pendingProps}throw Error(s(156,t.tag))}var ga=q(null),ma=null,ya=null;function va(e,t,n){G(ga,t._currentValue),t._currentValue=n}function ba(e){e._currentValue=ga.current,Y(ga)}function wa(e,t,n){for(;null!==e;){var o=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==o&&(o.childLanes|=t)):null!==o&&(o.childLanes&t)!==t&&(o.childLanes|=t),e===n)break;e=e.return}}function xa(e,t,n,o){var r=e.child;for(null!==r&&(r.return=e);null!==r;){var i=r.dependencies;if(null!==i){var a=r.child;i=i.firstContext;e:for(;null!==i;){var l=i;i=r;for(var c=0;c<t.length;c++)if(l.context===t[c]){i.lanes|=n,null!==(l=i.alternate)&&(l.lanes|=n),wa(i.return,n,e),o||(a=null);break e}i=l.next}}else if(18===r.tag){if(null===(a=r.return))throw Error(s(341));a.lanes|=n,null!==(i=a.alternate)&&(i.lanes|=n),wa(a,n,e),a=null}else a=r.child;if(null!==a)a.return=r;else for(a=r;null!==a;){if(a===e){a=null;break}if(null!==(r=a.sibling)){r.return=a.return,a=r;break}a=a.return}r=a}}function Sa(e,t,n,o){e=null;for(var r=t,i=!1;null!==r;){if(!i)if(0!==(524288&r.flags))i=!0;else if(0!==(262144&r.flags))break;if(10===r.tag){var a=r.alternate;if(null===a)throw Error(s(387));if(null!==(a=a.memoizedProps)){var l=r.type;Gn(r.pendingProps.value,a.value)||(null!==e?e.push(l):e=[l])}}else if(r===Q.current){if(null===(a=r.alternate))throw Error(s(387));a.memoizedState.memoizedState!==r.memoizedState.memoizedState&&(null!==e?e.push(Lu):e=[Lu])}r=r.return}null!==e&&xa(t,e,n,o),t.flags|=262144}function ka(e){for(e=e.firstContext;null!==e;){if(!Gn(e.context._currentValue,e.memoizedValue))return!0;e=e.next}return!1}function Pa(e){ma=e,ya=null,null!==(e=e.dependencies)&&(e.firstContext=null)}function Ca(e){return Ia(ma,e)}function _a(e,t){return null===ma&&Pa(e),Ia(e,t)}function Ia(e,t){var n=t._currentValue;if(t={context:t,memoizedValue:n,next:null},null===ya){if(null===e)throw Error(s(308));ya=t,e.dependencies={lanes:0,firstContext:t},e.flags|=524288}else ya=ya.next=t;return n}var Ea=!1;function ja(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Ta(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,callbacks:null})}function Ma(e){return{lane:e,tag:0,payload:null,callback:null,next:null}}function Aa(e,t,n){var o=e.updateQueue;if(null===o)return null;if(o=o.shared,0!==(2&ec)){var r=o.pending;return null===r?t.next=t:(t.next=r.next,r.next=t),o.pending=t,t=Ao(e),Mo(e,null,n),t}return Eo(e,o,t,n),Ao(e)}function Oa(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,0!==(4194176&n))){var o=t.lanes;n|=o&=e.pendingLanes,t.lanes=n,De(e,n)}}function Da(e,t){var n=e.updateQueue,o=e.alternate;if(null!==o&&n===(o=o.updateQueue)){var r=null,i=null;if(null!==(n=n.firstBaseUpdate)){do{var s={lane:n.lane,tag:n.tag,payload:n.payload,callback:null,next:null};null===i?r=i=s:i=i.next=s,n=n.next}while(null!==n);null===i?r=i=t:i=i.next=t}else r=i=t;return n={baseState:o.baseState,firstBaseUpdate:r,lastBaseUpdate:i,shared:o.shared,callbacks:o.callbacks},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}var Ra=!1;function La(){if(Ra){if(null!==qr)throw qr}}function za(e,t,n,o){Ra=!1;var r=e.updateQueue;Ea=!1;var i=r.firstBaseUpdate,s=r.lastBaseUpdate,a=r.shared.pending;if(null!==a){r.shared.pending=null;var l=a,c=l.next;l.next=null,null===s?i=c:s.next=c,s=l;var d=e.alternate;null!==d&&((a=(d=d.updateQueue).lastBaseUpdate)!==s&&(null===a?d.firstBaseUpdate=c:a.next=c,d.lastBaseUpdate=l))}if(null!==i){var u=r.baseState;for(s=0,d=c=l=null,a=i;;){var h=-536870913&a.lane,p=h!==a.lane;if(p?(oc&h)===h:(o&h)===h){0!==h&&h===Wr&&(Ra=!0),null!==d&&(d=d.next={lane:0,tag:a.tag,payload:a.payload,callback:null,next:null});e:{var f=e,g=a;h=t;var m=n;switch(g.tag){case 1:if("function"===typeof(f=g.payload)){u=f.call(m,u,h);break e}u=f;break e;case 3:f.flags=-65537&f.flags|128;case 0:if(null===(h="function"===typeof(f=g.payload)?f.call(m,u,h):f)||void 0===h)break e;u=M({},u,h);break e;case 2:Ea=!0}}null!==(h=a.callback)&&(e.flags|=64,p&&(e.flags|=8192),null===(p=r.callbacks)?r.callbacks=[h]:p.push(h))}else p={lane:h,tag:a.tag,payload:a.payload,callback:a.callback,next:null},null===d?(c=d=p,l=u):d=d.next=p,s|=h;if(null===(a=a.next)){if(null===(a=r.shared.pending))break;a=(p=a).next,p.next=null,r.lastBaseUpdate=p,r.shared.pending=null}}null===d&&(l=u),r.baseState=l,r.firstBaseUpdate=c,r.lastBaseUpdate=d,null===i&&(r.shared.lanes=0),uc|=s,e.lanes=s,e.memoizedState=u}}function Na(e,t){if("function"!==typeof e)throw Error(s(191,e));e.call(t)}function Fa(e,t){var n=e.callbacks;if(null!==n)for(e.callbacks=null,e=0;e<n.length;e++)Na(n[e],t)}function Ba(e,t){try{var n=t.updateQueue,o=null!==n?n.lastEffect:null;if(null!==o){var r=o.next;n=r;do{if((n.tag&e)===e){o=void 0;var i=n.create,s=n.inst;o=i(),s.destroy=o}n=n.next}while(n!==r)}}catch(a){od(t,t.return,a)}}function Ua(e,t,n){try{var o=t.updateQueue,r=null!==o?o.lastEffect:null;if(null!==r){var i=r.next;o=i;do{if((o.tag&e)===e){var s=o.inst,a=s.destroy;if(void 0!==a){s.destroy=void 0,r=t;var l=n;try{a()}catch(c){od(r,l,c)}}}o=o.next}while(o!==i)}}catch(c){od(t,t.return,c)}}function Ha(e){var t=e.updateQueue;if(null!==t){var n=e.stateNode;try{Fa(t,n)}catch(o){od(e,e.return,o)}}}function Ka(e,t,n){n.props=Os(e.type,e.memoizedProps),n.state=e.memoizedState;try{n.componentWillUnmount()}catch(o){od(e,t,o)}}function Va(e,t){try{var n=e.ref;if(null!==n){var o=e.stateNode;switch(e.tag){case 26:case 27:case 5:var r=o;break;default:r=o}"function"===typeof n?e.refCleanup=n(r):n.current=r}}catch(i){od(e,t,i)}}function Wa(e,t){var n=e.ref,o=e.refCleanup;if(null!==n)if("function"===typeof o)try{o()}catch(r){od(e,t,r)}finally{e.refCleanup=null,null!=(e=e.alternate)&&(e.refCleanup=null)}else if("function"===typeof n)try{n(null)}catch(i){od(e,t,i)}else n.current=null}function qa(e){var t=e.type,n=e.memoizedProps,o=e.stateNode;try{e:switch(t){case"button":case"input":case"select":case"textarea":n.autoFocus&&o.focus();break e;case"img":n.src?o.src=n.src:n.srcSet&&(o.srcset=n.srcSet)}}catch(r){od(e,e.return,r)}}function Ya(e,t,n){try{var o=e.stateNode;!function(e,t,n,o){switch(t){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var r=null,i=null,a=null,l=null,c=null,d=null,u=null;for(f in n){var h=n[f];if(n.hasOwnProperty(f)&&null!=h)switch(f){case"checked":case"value":break;case"defaultValue":c=h;default:o.hasOwnProperty(f)||Vd(e,t,f,null,o,h)}}for(var p in o){var f=o[p];if(h=n[p],o.hasOwnProperty(p)&&(null!=f||null!=h))switch(p){case"type":i=f;break;case"name":r=f;break;case"checked":d=f;break;case"defaultChecked":u=f;break;case"value":a=f;break;case"defaultValue":l=f;break;case"children":case"dangerouslySetInnerHTML":if(null!=f)throw Error(s(137,t));break;default:f!==h&&Vd(e,t,p,f,o,h)}}return void mt(e,a,l,c,d,u,i,r);case"select":for(i in f=a=l=p=null,n)if(c=n[i],n.hasOwnProperty(i)&&null!=c)switch(i){case"value":break;case"multiple":f=c;default:o.hasOwnProperty(i)||Vd(e,t,i,null,o,c)}for(r in o)if(i=o[r],c=n[r],o.hasOwnProperty(r)&&(null!=i||null!=c))switch(r){case"value":p=i;break;case"defaultValue":l=i;break;case"multiple":a=i;default:i!==c&&Vd(e,t,r,i,o,c)}return t=l,n=a,o=f,void(null!=p?bt(e,!!n,p,!1):!!o!==!!n&&(null!=t?bt(e,!!n,t,!0):bt(e,!!n,n?[]:"",!1)));case"textarea":for(l in f=p=null,n)if(r=n[l],n.hasOwnProperty(l)&&null!=r&&!o.hasOwnProperty(l))switch(l){case"value":case"children":break;default:Vd(e,t,l,null,o,r)}for(a in o)if(r=o[a],i=n[a],o.hasOwnProperty(a)&&(null!=r||null!=i))switch(a){case"value":p=r;break;case"defaultValue":f=r;break;case"children":break;case"dangerouslySetInnerHTML":if(null!=r)throw Error(s(91));break;default:r!==i&&Vd(e,t,a,r,o,i)}return void wt(e,p,f);case"option":for(var g in n)if(p=n[g],n.hasOwnProperty(g)&&null!=p&&!o.hasOwnProperty(g))if("selected"===g)e.selected=!1;else Vd(e,t,g,null,o,p);for(c in o)if(p=o[c],f=n[c],o.hasOwnProperty(c)&&p!==f&&(null!=p||null!=f))if("selected"===c)e.selected=p&&"function"!==typeof p&&"symbol"!==typeof p;else Vd(e,t,c,p,o,f);return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var m in n)p=n[m],n.hasOwnProperty(m)&&null!=p&&!o.hasOwnProperty(m)&&Vd(e,t,m,null,o,p);for(d in o)if(p=o[d],f=n[d],o.hasOwnProperty(d)&&p!==f&&(null!=p||null!=f))switch(d){case"children":case"dangerouslySetInnerHTML":if(null!=p)throw Error(s(137,t));break;default:Vd(e,t,d,p,o,f)}return;default:if(_t(t)){for(var y in n)p=n[y],n.hasOwnProperty(y)&&void 0!==p&&!o.hasOwnProperty(y)&&Wd(e,t,y,void 0,o,p);for(u in o)p=o[u],f=n[u],!o.hasOwnProperty(u)||p===f||void 0===p&&void 0===f||Wd(e,t,u,p,o,f);return}}for(var v in n)p=n[v],n.hasOwnProperty(v)&&null!=p&&!o.hasOwnProperty(v)&&Vd(e,t,v,null,o,p);for(h in o)p=o[h],f=n[h],!o.hasOwnProperty(h)||p===f||null==p&&null==f||Vd(e,t,h,p,o,f)}(o,e.type,n,t),o[Fe]=t}catch(r){od(e,e.return,r)}}function Ga(e){return 5===e.tag||3===e.tag||26===e.tag||27===e.tag||4===e.tag}function Xa(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||Ga(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&27!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function $a(e,t,n){var o=e.tag;if(5===o||6===o)e=e.stateNode,t?8===n.nodeType?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(8===n.nodeType?(t=n.parentNode).insertBefore(e,n):(t=n).appendChild(e),null!==(n=n._reactRootContainer)&&void 0!==n||null!==t.onclick||(t.onclick=Kd));else if(4!==o&&27!==o&&null!==(e=e.child))for($a(e,t,n),e=e.sibling;null!==e;)$a(e,t,n),e=e.sibling}function Za(e,t,n){var o=e.tag;if(5===o||6===o)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==o&&27!==o&&null!==(e=e.child))for(Za(e,t,n),e=e.sibling;null!==e;)Za(e,t,n),e=e.sibling}var Qa=!1,Ja=!1,el=!1,tl="function"===typeof WeakSet?WeakSet:Set,nl=null,ol=!1;function rl(e,t,n){var o=n.flags;switch(n.tag){case 0:case 11:case 15:yl(e,n),4&o&&Ba(5,n);break;case 1:if(yl(e,n),4&o)if(e=n.stateNode,null===t)try{e.componentDidMount()}catch(a){od(n,n.return,a)}else{var r=Os(n.type,t.memoizedProps);t=t.memoizedState;try{e.componentDidUpdate(r,t,e.__reactInternalSnapshotBeforeUpdate)}catch(l){od(n,n.return,l)}}64&o&&Ha(n),512&o&&Va(n,n.return);break;case 3:if(yl(e,n),64&o&&null!==(o=n.updateQueue)){if(e=null,null!==n.child)switch(n.child.tag){case 27:case 5:case 1:e=n.child.stateNode}try{Fa(o,e)}catch(a){od(n,n.return,a)}}break;case 26:yl(e,n),512&o&&Va(n,n.return);break;case 27:case 5:yl(e,n),null===t&&4&o&&qa(n),512&o&&Va(n,n.return);break;case 12:default:yl(e,n);break;case 13:yl(e,n),4&o&&dl(e,n);break;case 22:if(!(r=null!==n.memoizedState||Qa)){t=null!==t&&null!==t.memoizedState||Ja;var i=Qa,s=Ja;Qa=r,(Ja=t)&&!s?bl(e,n,0!==(8772&n.subtreeFlags)):yl(e,n),Qa=i,Ja=s}512&o&&("manual"===n.memoizedProps.mode?Va(n,n.return):Wa(n,n.return))}}function il(e){var t=e.alternate;null!==t&&(e.alternate=null,il(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&qe(t)),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}var sl=null,al=!1;function ll(e,t,n){for(n=n.child;null!==n;)cl(e,t,n),n=n.sibling}function cl(e,t,n){if(ve&&"function"===typeof ve.onCommitFiberUnmount)try{ve.onCommitFiberUnmount(ye,n)}catch(s){}switch(n.tag){case 26:Ja||Wa(n,t),ll(e,t,n),n.memoizedState?n.memoizedState.count--:n.stateNode&&(n=n.stateNode).parentNode.removeChild(n);break;case 27:Ja||Wa(n,t);var o=sl,r=al;for(sl=n.stateNode,ll(e,t,n),t=(n=n.stateNode).attributes;t.length;)n.removeAttributeNode(t[0]);qe(n),sl=o,al=r;break;case 5:Ja||Wa(n,t);case 6:r=sl;var i=al;if(sl=null,ll(e,t,n),al=i,null!==(sl=r))if(al)try{e=sl,o=n.stateNode,8===e.nodeType?e.parentNode.removeChild(o):e.removeChild(o)}catch(a){od(n,t,a)}else try{sl.removeChild(n.stateNode)}catch(a){od(n,t,a)}break;case 18:null!==sl&&(al?(t=sl,n=n.stateNode,8===t.nodeType?iu(t.parentNode,n):1===t.nodeType&&iu(t,n),gh(t)):iu(sl,n.stateNode));break;case 4:o=sl,r=al,sl=n.stateNode.containerInfo,al=!0,ll(e,t,n),sl=o,al=r;break;case 0:case 11:case 14:case 15:Ja||Ua(2,n,t),Ja||Ua(4,n,t),ll(e,t,n);break;case 1:Ja||(Wa(n,t),"function"===typeof(o=n.stateNode).componentWillUnmount&&Ka(n,t,o)),ll(e,t,n);break;case 21:ll(e,t,n);break;case 22:Ja||Wa(n,t),Ja=(o=Ja)||null!==n.memoizedState,ll(e,t,n),Ja=o;break;default:ll(e,t,n)}}function dl(e,t){if(null===t.memoizedState&&(null!==(e=t.alternate)&&(null!==(e=e.memoizedState)&&null!==(e=e.dehydrated))))try{gh(e)}catch(n){od(t,t.return,n)}}function ul(e,t){var n=function(e){switch(e.tag){case 13:case 19:var t=e.stateNode;return null===t&&(t=e.stateNode=new tl),t;case 22:return null===(t=(e=e.stateNode)._retryCache)&&(t=e._retryCache=new tl),t;default:throw Error(s(435,e.tag))}}(e);t.forEach((function(t){var o=ld.bind(null,e,t);n.has(t)||(n.add(t),t.then(o,o))}))}function hl(e,t){var n=t.deletions;if(null!==n)for(var o=0;o<n.length;o++){var r=n[o],i=e,a=t,l=a;e:for(;null!==l;){switch(l.tag){case 27:case 5:sl=l.stateNode,al=!1;break e;case 3:case 4:sl=l.stateNode.containerInfo,al=!0;break e}l=l.return}if(null===sl)throw Error(s(160));cl(i,a,r),sl=null,al=!1,null!==(i=r.alternate)&&(i.return=null),r.return=null}if(13878&t.subtreeFlags)for(t=t.child;null!==t;)fl(t,e),t=t.sibling}var pl=null;function fl(e,t){var n=e.alternate,o=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:hl(t,e),gl(e),4&o&&(Ua(3,e,e.return),Ba(3,e),Ua(5,e,e.return));break;case 1:hl(t,e),gl(e),512&o&&(Ja||null===n||Wa(n,n.return)),64&o&&Qa&&(null!==(e=e.updateQueue)&&(null!==(o=e.callbacks)&&(n=e.shared.hiddenCallbacks,e.shared.hiddenCallbacks=null===n?o:n.concat(o))));break;case 26:var r=pl;if(hl(t,e),gl(e),512&o&&(Ja||null===n||Wa(n,n.return)),4&o){var i=null!==n?n.memoizedState:null;if(o=e.memoizedState,null===n)if(null===o)if(null===e.stateNode){e:{o=e.type,n=e.memoizedProps,r=r.ownerDocument||r;t:switch(o){case"title":(!(i=r.getElementsByTagName("title")[0])||i[We]||i[Ne]||"http://www.w3.org/2000/svg"===i.namespaceURI||i.hasAttribute("itemprop"))&&(i=r.createElement(o),r.head.insertBefore(i,r.querySelector("head > title"))),qd(i,o,n),i[Ne]=e,Ze(i),o=i;break e;case"link":var a=Iu("link","href",r).get(o+(n.href||""));if(a)for(var l=0;l<a.length;l++)if((i=a[l]).getAttribute("href")===(null==n.href?null:n.href)&&i.getAttribute("rel")===(null==n.rel?null:n.rel)&&i.getAttribute("title")===(null==n.title?null:n.title)&&i.getAttribute("crossorigin")===(null==n.crossOrigin?null:n.crossOrigin)){a.splice(l,1);break t}qd(i=r.createElement(o),o,n),r.head.appendChild(i);break;case"meta":if(a=Iu("meta","content",r).get(o+(n.content||"")))for(l=0;l<a.length;l++)if((i=a[l]).getAttribute("content")===(null==n.content?null:""+n.content)&&i.getAttribute("name")===(null==n.name?null:n.name)&&i.getAttribute("property")===(null==n.property?null:n.property)&&i.getAttribute("http-equiv")===(null==n.httpEquiv?null:n.httpEquiv)&&i.getAttribute("charset")===(null==n.charSet?null:n.charSet)){a.splice(l,1);break t}qd(i=r.createElement(o),o,n),r.head.appendChild(i);break;default:throw Error(s(468,o))}i[Ne]=e,Ze(i),o=i}e.stateNode=o}else Eu(r,e.type,e.stateNode);else e.stateNode=Su(r,o,e.memoizedProps);else i!==o?(null===i?null!==n.stateNode&&(n=n.stateNode).parentNode.removeChild(n):i.count--,null===o?Eu(r,e.type,e.stateNode):Su(r,o,e.memoizedProps)):null===o&&null!==e.stateNode&&Ya(e,e.memoizedProps,n.memoizedProps)}break;case 27:if(4&o&&null===e.alternate){r=e.stateNode,i=e.memoizedProps;try{for(var c=r.firstChild;c;){var d=c.nextSibling,u=c.nodeName;c[We]||"HEAD"===u||"BODY"===u||"SCRIPT"===u||"STYLE"===u||"LINK"===u&&"stylesheet"===c.rel.toLowerCase()||r.removeChild(c),c=d}for(var h=e.type,p=r.attributes;p.length;)r.removeAttributeNode(p[0]);qd(r,h,i),r[Ne]=e,r[Fe]=i}catch(g){od(e,e.return,g)}}case 5:if(hl(t,e),gl(e),512&o&&(Ja||null===n||Wa(n,n.return)),32&e.flags){r=e.stateNode;try{St(r,"")}catch(g){od(e,e.return,g)}}4&o&&null!=e.stateNode&&Ya(e,r=e.memoizedProps,null!==n?n.memoizedProps:r),1024&o&&(el=!0);break;case 6:if(hl(t,e),gl(e),4&o){if(null===e.stateNode)throw Error(s(162));o=e.memoizedProps,n=e.stateNode;try{n.nodeValue=o}catch(g){od(e,e.return,g)}}break;case 3:if(_u=null,r=pl,pl=hu(t.containerInfo),hl(t,e),pl=r,gl(e),4&o&&null!==n&&n.memoizedState.isDehydrated)try{gh(t.containerInfo)}catch(g){od(e,e.return,g)}el&&(el=!1,ml(e));break;case 4:o=pl,pl=hu(e.stateNode.containerInfo),hl(t,e),gl(e),pl=o;break;case 12:hl(t,e),gl(e);break;case 13:hl(t,e),gl(e),8192&e.child.flags&&null!==e.memoizedState!==(null!==n&&null!==n.memoizedState)&&(bc=le()),4&o&&(null!==(o=e.updateQueue)&&(e.updateQueue=null,ul(e,o)));break;case 22:if(512&o&&(Ja||null===n||Wa(n,n.return)),c=null!==e.memoizedState,d=null!==n&&null!==n.memoizedState,Qa=(u=Qa)||c,Ja=(h=Ja)||d,hl(t,e),Ja=h,Qa=u,gl(e),(t=e.stateNode)._current=e,t._visibility&=-3,t._visibility|=2&t._pendingVisibility,8192&o&&(t._visibility=c?-2&t._visibility:1|t._visibility,c&&(t=Qa||Ja,null===n||d||t||vl(e)),null===e.memoizedProps||"manual"!==e.memoizedProps.mode))e:for(n=null,t=e;;){if(5===t.tag||26===t.tag||27===t.tag){if(null===n){d=n=t;try{if(r=d.stateNode,c)"function"===typeof(i=r.style).setProperty?i.setProperty("display","none","important"):i.display="none";else{a=d.stateNode;var f=void 0!==(l=d.memoizedProps.style)&&null!==l&&l.hasOwnProperty("display")?l.display:null;a.style.display=null==f||"boolean"===typeof f?"":(""+f).trim()}}catch(g){od(d,d.return,g)}}}else if(6===t.tag){if(null===n){d=t;try{d.stateNode.nodeValue=c?"":d.memoizedProps}catch(g){od(d,d.return,g)}}}else if((22!==t.tag&&23!==t.tag||null===t.memoizedState||t===e)&&null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;null===t.sibling;){if(null===t.return||t.return===e)break e;n===t&&(n=null),t=t.return}n===t&&(n=null),t.sibling.return=t.return,t=t.sibling}4&o&&(null!==(o=e.updateQueue)&&(null!==(n=o.retryQueue)&&(o.retryQueue=null,ul(e,n))));break;case 19:hl(t,e),gl(e),4&o&&(null!==(o=e.updateQueue)&&(e.updateQueue=null,ul(e,o)));break;case 21:break;default:hl(t,e),gl(e)}}function gl(e){var t=e.flags;if(2&t){try{if(27!==e.tag){e:{for(var n=e.return;null!==n;){if(Ga(n)){var o=n;break e}n=n.return}throw Error(s(160))}switch(o.tag){case 27:var r=o.stateNode;Za(e,Xa(e),r);break;case 5:var i=o.stateNode;32&o.flags&&(St(i,""),o.flags&=-33),Za(e,Xa(e),i);break;case 3:case 4:var a=o.stateNode.containerInfo;$a(e,Xa(e),a);break;default:throw Error(s(161))}}}catch(l){od(e,e.return,l)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function ml(e){if(1024&e.subtreeFlags)for(e=e.child;null!==e;){var t=e;ml(t),5===t.tag&&1024&t.flags&&t.stateNode.reset(),e=e.sibling}}function yl(e,t){if(8772&t.subtreeFlags)for(t=t.child;null!==t;)rl(e,t.alternate,t),t=t.sibling}function vl(e){for(e=e.child;null!==e;){var t=e;switch(t.tag){case 0:case 11:case 14:case 15:Ua(4,t,t.return),vl(t);break;case 1:Wa(t,t.return);var n=t.stateNode;"function"===typeof n.componentWillUnmount&&Ka(t,t.return,n),vl(t);break;case 26:case 27:case 5:Wa(t,t.return),vl(t);break;case 22:Wa(t,t.return),null===t.memoizedState&&vl(t);break;default:vl(t)}e=e.sibling}}function bl(e,t,n){for(n=n&&0!==(8772&t.subtreeFlags),t=t.child;null!==t;){var o=t.alternate,r=e,i=t,s=i.flags;switch(i.tag){case 0:case 11:case 15:bl(r,i,n),Ba(4,i);break;case 1:if(bl(r,i,n),"function"===typeof(r=(o=i).stateNode).componentDidMount)try{r.componentDidMount()}catch(c){od(o,o.return,c)}if(null!==(r=(o=i).updateQueue)){var a=o.stateNode;try{var l=r.shared.hiddenCallbacks;if(null!==l)for(r.shared.hiddenCallbacks=null,r=0;r<l.length;r++)Na(l[r],a)}catch(c){od(o,o.return,c)}}n&&64&s&&Ha(i),Va(i,i.return);break;case 26:case 27:case 5:bl(r,i,n),n&&null===o&&4&s&&qa(i),Va(i,i.return);break;case 12:default:bl(r,i,n);break;case 13:bl(r,i,n),n&&4&s&&dl(r,i);break;case 22:null===i.memoizedState&&bl(r,i,n),Va(i,i.return)}t=t.sibling}}function wl(e,t){var n=null;null!==e&&null!==e.memoizedState&&null!==e.memoizedState.cachePool&&(n=e.memoizedState.cachePool.pool),e=null,null!==t.memoizedState&&null!==t.memoizedState.cachePool&&(e=t.memoizedState.cachePool.pool),e!==n&&(null!=e&&e.refCount++,null!=n&&Hr(n))}function xl(e,t){e=null,null!==t.alternate&&(e=t.alternate.memoizedState.cache),(t=t.memoizedState.cache)!==e&&(t.refCount++,null!=e&&Hr(e))}function Sl(e,t,n,o){if(10256&t.subtreeFlags)for(t=t.child;null!==t;)kl(e,t,n,o),t=t.sibling}function kl(e,t,n,o){var r=t.flags;switch(t.tag){case 0:case 11:case 15:Sl(e,t,n,o),2048&r&&Ba(9,t);break;case 3:Sl(e,t,n,o),2048&r&&(e=null,null!==t.alternate&&(e=t.alternate.memoizedState.cache),(t=t.memoizedState.cache)!==e&&(t.refCount++,null!=e&&Hr(e)));break;case 12:if(2048&r){Sl(e,t,n,o),e=t.stateNode;try{var i=t.memoizedProps,s=i.id,a=i.onPostCommit;"function"===typeof a&&a(s,null===t.alternate?"mount":"update",e.passiveEffectDuration,-0)}catch(l){od(t,t.return,l)}}else Sl(e,t,n,o);break;case 23:break;case 22:i=t.stateNode,null!==t.memoizedState?4&i._visibility?Sl(e,t,n,o):Cl(e,t):4&i._visibility?Sl(e,t,n,o):(i._visibility|=4,Pl(e,t,n,o,0!==(10256&t.subtreeFlags))),2048&r&&wl(t.alternate,t);break;case 24:Sl(e,t,n,o),2048&r&&xl(t.alternate,t);break;default:Sl(e,t,n,o)}}function Pl(e,t,n,o,r){for(r=r&&0!==(10256&t.subtreeFlags),t=t.child;null!==t;){var i=e,s=t,a=n,l=o,c=s.flags;switch(s.tag){case 0:case 11:case 15:Pl(i,s,a,l,r),Ba(8,s);break;case 23:break;case 22:var d=s.stateNode;null!==s.memoizedState?4&d._visibility?Pl(i,s,a,l,r):Cl(i,s):(d._visibility|=4,Pl(i,s,a,l,r)),r&&2048&c&&wl(s.alternate,s);break;case 24:Pl(i,s,a,l,r),r&&2048&c&&xl(s.alternate,s);break;default:Pl(i,s,a,l,r)}t=t.sibling}}function Cl(e,t){if(10256&t.subtreeFlags)for(t=t.child;null!==t;){var n=e,o=t,r=o.flags;switch(o.tag){case 22:Cl(n,o),2048&r&&wl(o.alternate,o);break;case 24:Cl(n,o),2048&r&&xl(o.alternate,o);break;default:Cl(n,o)}t=t.sibling}}var _l=8192;function Il(e){if(e.subtreeFlags&_l)for(e=e.child;null!==e;)El(e),e=e.sibling}function El(e){switch(e.tag){case 26:Il(e),e.flags&_l&&null!==e.memoizedState&&function(e,t,n){if(null===Tu)throw Error(s(475));var o=Tu;if("stylesheet"===t.type&&("string"!==typeof n.media||!1!==matchMedia(n.media).matches)&&0===(4&t.state.loading)){if(null===t.instance){var r=yu(n.href),i=e.querySelector(vu(r));if(i)return null!==(e=i._p)&&"object"===typeof e&&"function"===typeof e.then&&(o.count++,o=Au.bind(o),e.then(o,o)),t.state.loading|=4,t.instance=i,void Ze(i);i=e.ownerDocument||e,n=bu(n),(r=du.get(r))&&Pu(n,r),Ze(i=i.createElement("link"));var a=i;a._p=new Promise((function(e,t){a.onload=e,a.onerror=t})),qd(i,"link",n),t.instance=i}null===o.stylesheets&&(o.stylesheets=new Map),o.stylesheets.set(t,e),(e=t.state.preload)&&0===(3&t.state.loading)&&(o.count++,t=Au.bind(o),e.addEventListener("load",t),e.addEventListener("error",t))}}(pl,e.memoizedState,e.memoizedProps);break;case 5:default:Il(e);break;case 3:case 4:var t=pl;pl=hu(e.stateNode.containerInfo),Il(e),pl=t;break;case 22:null===e.memoizedState&&(null!==(t=e.alternate)&&null!==t.memoizedState?(t=_l,_l=16777216,Il(e),_l=t):Il(e))}}function jl(e){var t=e.alternate;if(null!==t&&null!==(e=t.child)){t.child=null;do{t=e.sibling,e.sibling=null,e=t}while(null!==e)}}function Tl(e){var t=e.deletions;if(0!==(16&e.flags)){if(null!==t)for(var n=0;n<t.length;n++){var o=t[n];nl=o,Ol(o,e)}jl(e)}if(10256&e.subtreeFlags)for(e=e.child;null!==e;)Ml(e),e=e.sibling}function Ml(e){switch(e.tag){case 0:case 11:case 15:Tl(e),2048&e.flags&&Ua(9,e,e.return);break;case 3:case 12:default:Tl(e);break;case 22:var t=e.stateNode;null!==e.memoizedState&&4&t._visibility&&(null===e.return||13!==e.return.tag)?(t._visibility&=-5,Al(e)):Tl(e)}}function Al(e){var t=e.deletions;if(0!==(16&e.flags)){if(null!==t)for(var n=0;n<t.length;n++){var o=t[n];nl=o,Ol(o,e)}jl(e)}for(e=e.child;null!==e;){switch((t=e).tag){case 0:case 11:case 15:Ua(8,t,t.return),Al(t);break;case 22:4&(n=t.stateNode)._visibility&&(n._visibility&=-5,Al(t));break;default:Al(t)}e=e.sibling}}function Ol(e,t){for(;null!==nl;){var n=nl;switch(n.tag){case 0:case 11:case 15:Ua(8,n,t);break;case 23:case 22:if(null!==n.memoizedState&&null!==n.memoizedState.cachePool){var o=n.memoizedState.cachePool.pool;null!=o&&o.refCount++}break;case 24:Hr(n.memoizedState.cache)}if(null!==(o=n.child))o.return=n,nl=o;else e:for(n=e;null!==nl;){var r=(o=nl).sibling,i=o.return;if(il(o),o===n){nl=null;break e}if(null!==r){r.return=i,nl=r;break e}nl=i}}}function Dl(e,t,n,o){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=o,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Rl(e,t,n,o){return new Dl(e,t,n,o)}function Ll(e){return!(!(e=e.prototype)||!e.isReactComponent)}function zl(e,t){var n=e.alternate;return null===n?((n=Rl(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=31457280&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n.refCleanup=e.refCleanup,n}function Nl(e,t){e.flags&=31457282;var n=e.alternate;return null===n?(e.childLanes=0,e.lanes=t,e.child=null,e.subtreeFlags=0,e.memoizedProps=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null,e.stateNode=null):(e.childLanes=n.childLanes,e.lanes=n.lanes,e.child=n.child,e.subtreeFlags=0,e.deletions=null,e.memoizedProps=n.memoizedProps,e.memoizedState=n.memoizedState,e.updateQueue=n.updateQueue,e.type=n.type,t=n.dependencies,e.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext}),e}function Fl(e,t,n,o,r,i){var a=0;if(o=e,"function"===typeof e)Ll(e)&&(a=1);else if("string"===typeof e)a=function(e,t,n){if(1===n||null!=t.itemProp)return!1;switch(e){case"meta":case"title":return!0;case"style":if("string"!==typeof t.precedence||"string"!==typeof t.href||""===t.href)break;return!0;case"link":if("string"!==typeof t.rel||"string"!==typeof t.href||""===t.href||t.onLoad||t.onError)break;return"stylesheet"!==t.rel||(e=t.disabled,"string"===typeof t.precedence&&null==e);case"script":if(t.async&&"function"!==typeof t.async&&"symbol"!==typeof t.async&&!t.onLoad&&!t.onError&&t.src&&"string"===typeof t.src)return!0}return!1}(e,n,X.current)?26:"html"===e||"head"===e||"body"===e?27:5;else e:switch(e){case u:return Bl(n.children,r,i,t);case h:a=8,r|=24;break;case p:return(e=Rl(12,n,t,2|r)).elementType=p,e.lanes=i,e;case v:return(e=Rl(13,n,t,r)).elementType=v,e.lanes=i,e;case b:return(e=Rl(19,n,t,r)).elementType=b,e.lanes=i,e;case S:return Ul(n,r,i,t);default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case f:case m:a=10;break e;case g:a=9;break e;case y:a=11;break e;case w:a=14;break e;case x:a=16,o=null;break e}a=29,n=Error(s(130,null===e?"null":typeof e,"")),o=null}return(t=Rl(a,n,t,r)).elementType=e,t.type=o,t.lanes=i,t}function Bl(e,t,n,o){return(e=Rl(7,e,o,t)).lanes=n,e}function Ul(e,t,n,o){(e=Rl(22,e,o,t)).elementType=S,e.lanes=n;var r={_visibility:1,_pendingVisibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null,_current:null,detach:function(){var e=r._current;if(null===e)throw Error(s(456));if(0===(2&r._pendingVisibility)){var t=To(e,2);null!==t&&(r._pendingVisibility|=2,Ac(t,e,2))}},attach:function(){var e=r._current;if(null===e)throw Error(s(456));if(0!==(2&r._pendingVisibility)){var t=To(e,2);null!==t&&(r._pendingVisibility&=-3,Ac(t,e,2))}}};return e.stateNode=r,e}function Hl(e,t,n){return(e=Rl(6,e,null,t)).lanes=n,e}function Kl(e,t,n){return(t=Rl(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Vl(e){e.flags|=4}function Wl(e,t){if("stylesheet"!==t.type||0!==(4&t.state.loading))e.flags&=-16777217;else if(e.flags|=16777216,!ju(t)){if(null!==(t=jr.current)&&((4194176&oc)===oc?null!==Tr:(62914560&oc)!==oc&&0===(536870912&oc)||t!==Tr))throw pr=cr,lr;e.flags|=8192}}function ql(e,t){null!==t&&(e.flags|=4),16384&e.flags&&(t=22!==e.tag?Te():536870912,e.lanes|=t,gc|=t)}function Yl(e,t){if(!Zo)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var o=null;null!==n;)null!==n.alternate&&(o=n),n=n.sibling;null===o?t||null===e.tail?e.tail=null:e.tail.sibling=null:o.sibling=null}}function Gl(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,o=0;if(t)for(var r=e.child;null!==r;)n|=r.lanes|r.childLanes,o|=31457280&r.subtreeFlags,o|=31457280&r.flags,r.return=e,r=r.sibling;else for(r=e.child;null!==r;)n|=r.lanes|r.childLanes,o|=r.subtreeFlags,o|=r.flags,r.return=e,r=r.sibling;return e.subtreeFlags|=o,e.childLanes=n,t}function Xl(e,t,n){var o=t.pendingProps;switch(Go(t),t.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:case 1:return Gl(t),null;case 3:return n=t.stateNode,o=null,null!==e&&(o=e.memoizedState.cache),t.memoizedState.cache!==o&&(t.flags|=2048),ba(Br),ee(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),null!==e&&null!==e.child||(rr(t)?Vl(t):null===e||e.memoizedState.isDehydrated&&0===(256&t.flags)||(t.flags|=1024,null!==Qo&&(Dc(Qo),Qo=null))),Gl(t),null;case 26:return n=t.memoizedState,null===e?(Vl(t),null!==n?(Gl(t),Wl(t,n)):(Gl(t),t.flags&=-16777217)):n?n!==e.memoizedState?(Vl(t),Gl(t),Wl(t,n)):(Gl(t),t.flags&=-16777217):(e.memoizedProps!==o&&Vl(t),Gl(t),t.flags&=-16777217),null;case 27:ne(t),n=Z.current;var r=t.type;if(null!==e&&null!=t.stateNode)e.memoizedProps!==o&&Vl(t);else{if(!o){if(null===t.stateNode)throw Error(s(166));return Gl(t),null}e=X.current,rr(t)?nr(t):(e=cu(r,o,n),t.stateNode=e,Vl(t))}return Gl(t),null;case 5:if(ne(t),n=t.type,null!==e&&null!=t.stateNode)e.memoizedProps!==o&&Vl(t);else{if(!o){if(null===t.stateNode)throw Error(s(166));return Gl(t),null}if(e=X.current,rr(t))nr(t);else{switch(r=Xd(Z.current),e){case 1:e=r.createElementNS("http://www.w3.org/2000/svg",n);break;case 2:e=r.createElementNS("http://www.w3.org/1998/Math/MathML",n);break;default:switch(n){case"svg":e=r.createElementNS("http://www.w3.org/2000/svg",n);break;case"math":e=r.createElementNS("http://www.w3.org/1998/Math/MathML",n);break;case"script":(e=r.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild);break;case"select":e="string"===typeof o.is?r.createElement("select",{is:o.is}):r.createElement("select"),o.multiple?e.multiple=!0:o.size&&(e.size=o.size);break;default:e="string"===typeof o.is?r.createElement(n,{is:o.is}):r.createElement(n)}}e[Ne]=t,e[Fe]=o;e:for(r=t.child;null!==r;){if(5===r.tag||6===r.tag)e.appendChild(r.stateNode);else if(4!==r.tag&&27!==r.tag&&null!==r.child){r.child.return=r,r=r.child;continue}if(r===t)break e;for(;null===r.sibling;){if(null===r.return||r.return===t)break e;r=r.return}r.sibling.return=r.return,r=r.sibling}t.stateNode=e;e:switch(qd(e,n,o),n){case"button":case"input":case"select":case"textarea":e=!!o.autoFocus;break e;case"img":e=!0;break e;default:e=!1}e&&Vl(t)}}return Gl(t),t.flags&=-16777217,null;case 6:if(e&&null!=t.stateNode)e.memoizedProps!==o&&Vl(t);else{if("string"!==typeof o&&null===t.stateNode)throw Error(s(166));if(e=Z.current,rr(t)){if(e=t.stateNode,n=t.memoizedProps,o=null,null!==(r=Xo))switch(r.tag){case 27:case 5:o=r.memoizedProps}e[Ne]=t,(e=!!(e.nodeValue===n||null!==o&&!0===o.suppressHydrationWarning||Hd(e.nodeValue,n)))||tr(t)}else(e=Xd(e).createTextNode(o))[Ne]=t,t.stateNode=e}return Gl(t),null;case 13:if(o=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(r=rr(t),null!==o&&null!==o.dehydrated){if(null===e){if(!r)throw Error(s(318));if(!(r=null!==(r=t.memoizedState)?r.dehydrated:null))throw Error(s(317));r[Ne]=t}else ir(),0===(128&t.flags)&&(t.memoizedState=null),t.flags|=4;Gl(t),r=!1}else null!==Qo&&(Dc(Qo),Qo=null),r=!0;if(!r)return 256&t.flags?(Dr(t),t):(Dr(t),null)}if(Dr(t),0!==(128&t.flags))return t.lanes=n,t;if(n=null!==o,e=null!==e&&null!==e.memoizedState,n){r=null,null!==(o=t.child).alternate&&null!==o.alternate.memoizedState&&null!==o.alternate.memoizedState.cachePool&&(r=o.alternate.memoizedState.cachePool.pool);var i=null;null!==o.memoizedState&&null!==o.memoizedState.cachePool&&(i=o.memoizedState.cachePool.pool),i!==r&&(o.flags|=2048)}return n!==e&&n&&(t.child.flags|=8192),ql(t,t.updateQueue),Gl(t),null;case 4:return ee(),null===e&&Ad(t.stateNode.containerInfo),Gl(t),null;case 10:return ba(t.type),Gl(t),null;case 19:if(Y(Rr),null===(r=t.memoizedState))return Gl(t),null;if(o=0!==(128&t.flags),null===(i=r.rendering))if(o)Yl(r,!1);else{if(0!==dc||null!==e&&0!==(128&e.flags))for(e=t.child;null!==e;){if(null!==(i=Lr(e))){for(t.flags|=128,Yl(r,!1),e=i.updateQueue,t.updateQueue=e,ql(t,e),t.subtreeFlags=0,e=n,n=t.child;null!==n;)Nl(n,e),n=n.sibling;return G(Rr,1&Rr.current|2),t.child}e=e.sibling}null!==r.tail&&le()>wc&&(t.flags|=128,o=!0,Yl(r,!1),t.lanes=4194304)}else{if(!o)if(null!==(e=Lr(i))){if(t.flags|=128,o=!0,e=e.updateQueue,t.updateQueue=e,ql(t,e),Yl(r,!0),null===r.tail&&"hidden"===r.tailMode&&!i.alternate&&!Zo)return Gl(t),null}else 2*le()-r.renderingStartTime>wc&&536870912!==n&&(t.flags|=128,o=!0,Yl(r,!1),t.lanes=4194304);r.isBackwards?(i.sibling=t.child,t.child=i):(null!==(e=r.last)?e.sibling=i:t.child=i,r.last=i)}return null!==r.tail?(t=r.tail,r.rendering=t,r.tail=t.sibling,r.renderingStartTime=le(),t.sibling=null,e=Rr.current,G(Rr,o?1&e|2:1&e),t):(Gl(t),null);case 22:case 23:return Dr(t),Er(),o=null!==t.memoizedState,null!==e?null!==e.memoizedState!==o&&(t.flags|=8192):o&&(t.flags|=8192),o?0!==(536870912&n)&&0===(128&t.flags)&&(Gl(t),6&t.subtreeFlags&&(t.flags|=8192)):Gl(t),null!==(n=t.updateQueue)&&ql(t,n.retryQueue),n=null,null!==e&&null!==e.memoizedState&&null!==e.memoizedState.cachePool&&(n=e.memoizedState.cachePool.pool),o=null,null!==t.memoizedState&&null!==t.memoizedState.cachePool&&(o=t.memoizedState.cachePool.pool),o!==n&&(t.flags|=2048),null!==e&&Y(Xr),null;case 24:return n=null,null!==e&&(n=e.memoizedState.cache),t.memoizedState.cache!==n&&(t.flags|=2048),ba(Br),Gl(t),null;case 25:return null}throw Error(s(156,t.tag))}function $l(e,t){switch(Go(t),t.tag){case 1:return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return ba(Br),ee(),0!==(65536&(e=t.flags))&&0===(128&e)?(t.flags=-65537&e|128,t):null;case 26:case 27:case 5:return ne(t),null;case 13:if(Dr(t),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(s(340));ir()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return Y(Rr),null;case 4:return ee(),null;case 10:return ba(t.type),null;case 22:case 23:return Dr(t),Er(),null!==e&&Y(Xr),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 24:return ba(Br),null;default:return null}}function Zl(e,t){switch(Go(t),t.tag){case 3:ba(Br),ee();break;case 26:case 27:case 5:ne(t);break;case 4:ee();break;case 13:Dr(t);break;case 19:Y(Rr);break;case 10:ba(t.type);break;case 22:case 23:Dr(t),Er(),null!==e&&Y(Xr);break;case 24:ba(Br)}}var Ql={getCacheForType:function(e){var t=Ca(Br),n=t.data.get(e);return void 0===n&&(n=e(),t.data.set(e,n)),n}},Jl="function"===typeof WeakMap?WeakMap:Map,ec=0,tc=null,nc=null,oc=0,rc=0,ic=null,sc=!1,ac=!1,lc=!1,cc=0,dc=0,uc=0,hc=0,pc=0,fc=0,gc=0,mc=null,yc=null,vc=!1,bc=0,wc=1/0,xc=null,Sc=null,kc=!1,Pc=null,Cc=0,_c=0,Ic=null,Ec=0,jc=null;function Tc(){if(0!==(2&ec)&&0!==oc)return oc&-oc;if(null!==T.T){return 0!==Wr?Wr:xd()}return Le()}function Mc(){0===fc&&(fc=0===(536870912&oc)||Zo?je():536870912);var e=jr.current;return null!==e&&(e.flags|=32),fc}function Ac(e,t,n){(e===tc&&2===rc||null!==e.cancelPendingCommit)&&(Bc(e,0),zc(e,oc,fc,!1)),Ae(e,n),0!==(2&ec)&&e===tc||(e===tc&&(0===(2&ec)&&(hc|=n),4===dc&&zc(e,oc,fc,!1)),gd(e))}function Oc(e,t,n){if(0!==(6&ec))throw Error(s(327));for(var o=!n&&0===(60&t)&&0===(t&e.expiredLanes)||Ie(e,t),r=o?function(e,t){var n=ec;ec|=2;var o=Hc(),r=Kc();tc!==e||oc!==t?(xc=null,wc=le()+500,Bc(e,t)):ac=Ie(e,t);e:for(;;)try{if(0!==rc&&null!==nc){t=nc;var i=ic;t:switch(rc){case 1:rc=0,ic=null,$c(e,t,i,1);break;case 2:if(dr(i)){rc=0,ic=null,Xc(t);break}t=function(){2===rc&&tc===e&&(rc=7),gd(e)},i.then(t,t);break e;case 3:rc=7;break e;case 4:rc=5;break e;case 7:dr(i)?(rc=0,ic=null,Xc(t)):(rc=0,ic=null,$c(e,t,i,7));break;case 5:var a=null;switch(nc.tag){case 26:a=nc.memoizedState;case 5:case 27:var l=nc;if(!a||ju(a)){rc=0,ic=null;var c=l.sibling;if(null!==c)nc=c;else{var d=l.return;null!==d?(nc=d,Zc(d)):nc=null}break t}}rc=0,ic=null,$c(e,t,i,5);break;case 6:rc=0,ic=null,$c(e,t,i,6);break;case 8:Fc(),dc=6;break e;default:throw Error(s(462))}}Yc();break}catch(u){Uc(e,u)}return ya=ma=null,T.H=o,T.A=r,ec=n,null!==nc?0:(tc=null,oc=0,Io(),dc)}(e,t):Wc(e,t,!0),i=o;;){if(0===r){ac&&!o&&zc(e,t,0,!1);break}if(6===r)zc(e,t,0,!sc);else{if(n=e.current.alternate,i&&!Lc(n)){r=Wc(e,t,!1),i=!1;continue}if(2===r){if(i=t,e.errorRecoveryDisabledLanes&i)var a=0;else a=0!==(a=-536870913&e.pendingLanes)?a:536870912&a?536870912:0;if(0!==a){t=a;e:{var l=e;r=mc;var c=l.current.memoizedState.isDehydrated;if(c&&(Bc(l,a).flags|=256),2!==(a=Wc(l,a,!1))){if(lc&&!c){l.errorRecoveryDisabledLanes|=i,hc|=i,r=4;break e}i=yc,yc=r,null!==i&&Dc(i)}r=a}if(i=!1,2!==r)continue}}if(1===r){Bc(e,0),zc(e,t,0,!0);break}e:{switch(o=e,r){case 0:case 1:throw Error(s(345));case 4:if((4194176&t)===t){zc(o,t,fc,!sc);break e}break;case 2:yc=null;break;case 3:case 5:break;default:throw Error(s(329))}if(o.finishedWork=n,o.finishedLanes=t,(62914560&t)===t&&10<(i=bc+300-le())){if(zc(o,t,fc,!sc),0!==_e(o,0))break e;o.timeoutHandle=eu(Rc.bind(null,o,n,yc,xc,vc,t,fc,hc,gc,sc,2,-0,0),i)}else Rc(o,n,yc,xc,vc,t,fc,hc,gc,sc,0,-0,0)}}break}gd(e)}function Dc(e){null===yc?yc=e:yc.push.apply(yc,e)}function Rc(e,t,n,o,r,i,a,l,c,d,u,h,p){var f=t.subtreeFlags;if((8192&f||16785408===(16785408&f))&&(Tu={stylesheets:null,count:0,unsuspend:Mu},El(t),null!==(t=function(){if(null===Tu)throw Error(s(475));var e=Tu;return e.stylesheets&&0===e.count&&Du(e,e.stylesheets),0<e.count?function(t){var n=setTimeout((function(){if(e.stylesheets&&Du(e,e.stylesheets),e.unsuspend){var t=e.unsuspend;e.unsuspend=null,t()}}),6e4);return e.unsuspend=t,function(){e.unsuspend=null,clearTimeout(n)}}:null}())))return e.cancelPendingCommit=t(Jc.bind(null,e,n,o,r,a,l,c,1,h,p)),void zc(e,i,a,!d);Jc(e,n,o,r,a,l,c,u,h,p)}function Lc(e){for(var t=e;;){var n=t.tag;if((0===n||11===n||15===n)&&16384&t.flags&&(null!==(n=t.updateQueue)&&null!==(n=n.stores)))for(var o=0;o<n.length;o++){var r=n[o],i=r.getSnapshot;r=r.value;try{if(!Gn(i(),r))return!1}catch(s){return!1}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function zc(e,t,n,o){t&=~pc,t&=~hc,e.suspendedLanes|=t,e.pingedLanes&=~t,o&&(e.warmLanes|=t),o=e.expirationTimes;for(var r=t;0<r;){var i=31-we(r),s=1<<i;o[i]=-1,r&=~s}0!==n&&Oe(e,n,t)}function Nc(){return 0!==(6&ec)||(md(0,!1),!1)}function Fc(){if(null!==nc){if(0===rc)var e=nc.return;else ya=ma=null,vi(e=nc),gr=null,mr=0,e=nc;for(;null!==e;)Zl(e.alternate,e),e=e.return;nc=null}}function Bc(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;-1!==n&&(e.timeoutHandle=-1,tu(n)),null!==(n=e.cancelPendingCommit)&&(e.cancelPendingCommit=null,n()),Fc(),tc=e,nc=n=zl(e.current,null),oc=t,rc=0,ic=null,sc=!1,ac=Ie(e,t),lc=!1,gc=fc=pc=hc=uc=dc=0,yc=mc=null,vc=!1,0!==(8&t)&&(t|=32&t);var o=e.entangledLanes;if(0!==o)for(e=e.entanglements,o&=t;0<o;){var r=31-we(o),i=1<<r;t|=e[r],o&=~i}return cc=t,Io(),n}function Uc(e,t){ei=null,T.H=Cs,t===ar?(t=fr(),rc=3):t===lr?(t=fr(),rc=4):rc=t===Ks?8:null!==t&&"object"===typeof t&&"function"===typeof t.then?6:1,ic=t,null===nc&&(dc=1,Ns(e,Ro(t,e.current)))}function Hc(){var e=T.H;return T.H=Cs,null===e?Cs:e}function Kc(){var e=T.A;return T.A=Ql,e}function Vc(){dc=4,sc||(4194176&oc)!==oc&&null!==jr.current||(ac=!0),0===(134217727&uc)&&0===(134217727&hc)||null===tc||zc(tc,oc,fc,!1)}function Wc(e,t,n){var o=ec;ec|=2;var r=Hc(),i=Kc();tc===e&&oc===t||(xc=null,Bc(e,t)),t=!1;var s=dc;e:for(;;)try{if(0!==rc&&null!==nc){var a=nc,l=ic;switch(rc){case 8:Fc(),s=6;break e;case 3:case 2:case 6:null===jr.current&&(t=!0);var c=rc;if(rc=0,ic=null,$c(e,a,l,c),n&&ac){s=0;break e}break;default:c=rc,rc=0,ic=null,$c(e,a,l,c)}}qc(),s=dc;break}catch(d){Uc(e,d)}return t&&e.shellSuspendCounter++,ya=ma=null,ec=o,T.H=r,T.A=i,null===nc&&(tc=null,oc=0,Io()),s}function qc(){for(;null!==nc;)Gc(nc)}function Yc(){for(;null!==nc&&!se();)Gc(nc)}function Gc(e){var t=fa(e.alternate,e,cc);e.memoizedProps=e.pendingProps,null===t?Zc(e):nc=t}function Xc(e){var t=e,n=t.alternate;switch(t.tag){case 15:case 0:t=Js(n,t,t.pendingProps,t.type,void 0,oc);break;case 11:t=Js(n,t,t.pendingProps,t.type.render,t.ref,oc);break;case 5:vi(t);default:Zl(n,t),t=fa(n,t=nc=Nl(t,cc),cc)}e.memoizedProps=e.pendingProps,null===t?Zc(e):nc=t}function $c(e,t,n,o){ya=ma=null,vi(t),gr=null,mr=0;var r=t.return;try{if(function(e,t,n,o,r){if(n.flags|=32768,null!==o&&"object"===typeof o&&"function"===typeof o.then){if(null!==(t=n.alternate)&&Sa(t,n,r,!0),null!==(n=jr.current)){switch(n.tag){case 13:return null===Tr?Vc():null===n.alternate&&0===dc&&(dc=3),n.flags&=-257,n.flags|=65536,n.lanes=r,o===cr?n.flags|=16384:(null===(t=n.updateQueue)?n.updateQueue=new Set([o]):t.add(o),rd(e,o,r)),!1;case 22:return n.flags|=65536,o===cr?n.flags|=16384:(null===(t=n.updateQueue)?(t={transitions:null,markerInstances:null,retryQueue:new Set([o])},n.updateQueue=t):null===(n=t.retryQueue)?t.retryQueue=new Set([o]):n.add(o),rd(e,o,r)),!1}throw Error(s(435,n.tag))}return rd(e,o,r),Vc(),!1}if(Zo)return null!==(t=jr.current)?(0===(65536&t.flags)&&(t.flags|=256),t.flags|=65536,t.lanes=r,o!==er&&sr(Ro(e=Error(s(422),{cause:o}),n))):(o!==er&&sr(Ro(t=Error(s(423),{cause:o}),n)),(e=e.current.alternate).flags|=65536,r&=-r,e.lanes|=r,o=Ro(o,n),Da(e,r=Bs(e.stateNode,o,r)),4!==dc&&(dc=2)),!1;var i=Error(s(520),{cause:o});if(i=Ro(i,n),null===mc?mc=[i]:mc.push(i),4!==dc&&(dc=2),null===t)return!0;o=Ro(o,n),n=t;do{switch(n.tag){case 3:return n.flags|=65536,e=r&-r,n.lanes|=e,Da(n,e=Bs(n.stateNode,o,e)),!1;case 1:if(t=n.type,i=n.stateNode,0===(128&n.flags)&&("function"===typeof t.getDerivedStateFromError||null!==i&&"function"===typeof i.componentDidCatch&&(null===Sc||!Sc.has(i))))return n.flags|=65536,r&=-r,n.lanes|=r,Hs(r=Us(r),e,n,o),Da(n,r),!1}n=n.return}while(null!==n);return!1}(e,r,t,n,oc))return dc=1,Ns(e,Ro(n,e.current)),void(nc=null)}catch(i){if(null!==r)throw nc=r,i;return dc=1,Ns(e,Ro(n,e.current)),void(nc=null)}32768&t.flags?(Zo||1===o?e=!0:ac||0!==(536870912&oc)?e=!1:(sc=e=!0,(2===o||3===o||6===o)&&(null!==(o=jr.current)&&13===o.tag&&(o.flags|=16384))),Qc(t,e)):Zc(t)}function Zc(e){var t=e;do{if(0!==(32768&t.flags))return void Qc(t,sc);e=t.return;var n=Xl(t.alternate,t,cc);if(null!==n)return void(nc=n);if(null!==(t=t.sibling))return void(nc=t);nc=t=e}while(null!==t);0===dc&&(dc=5)}function Qc(e,t){do{var n=$l(e.alternate,e);if(null!==n)return n.flags&=32767,void(nc=n);if(null!==(n=e.return)&&(n.flags|=32768,n.subtreeFlags=0,n.deletions=null),!t&&null!==(e=e.sibling))return void(nc=e);nc=e=n}while(null!==e);dc=6,nc=null}function Jc(e,t,n,o,r,i,a,l,c,d){var u=T.T,h=H.p;try{H.p=2,T.T=null,function(e,t,n,o,r,i,a,l){do{td()}while(null!==Pc);if(0!==(6&ec))throw Error(s(327));var c=e.finishedWork;if(o=e.finishedLanes,null===c)return null;if(e.finishedWork=null,e.finishedLanes=0,c===e.current)throw Error(s(177));e.callbackNode=null,e.callbackPriority=0,e.cancelPendingCommit=null;var d=c.lanes|c.childLanes;if(function(e,t,n,o,r,i){var s=e.pendingLanes;e.pendingLanes=n,e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0,e.expiredLanes&=n,e.entangledLanes&=n,e.errorRecoveryDisabledLanes&=n,e.shellSuspendCounter=0;var a=e.entanglements,l=e.expirationTimes,c=e.hiddenUpdates;for(n=s&~n;0<n;){var d=31-we(n),u=1<<d;a[d]=0,l[d]=-1;var h=c[d];if(null!==h)for(c[d]=null,d=0;d<h.length;d++){var p=h[d];null!==p&&(p.lane&=-536870913)}n&=~u}0!==o&&Oe(e,o,0),0!==i&&0===r&&0!==e.tag&&(e.suspendedLanes|=i&~(s&~t))}(e,o,d|=_o,i,a,l),e===tc&&(nc=tc=null,oc=0),0===(10256&c.subtreeFlags)&&0===(10256&c.flags)||kc||(kc=!0,_c=d,Ic=n,function(e,t){re(e,t)}(he,(function(){return td(),null}))),n=0!==(15990&c.flags),0!==(15990&c.subtreeFlags)||n?(n=T.T,T.T=null,i=H.p,H.p=2,a=ec,ec|=4,function(e,t){if(e=e.containerInfo,Yd=Vu,eo(e=Jn(e))){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{var o=(n=(n=e.ownerDocument)&&n.defaultView||window).getSelection&&n.getSelection();if(o&&0!==o.rangeCount){n=o.anchorNode;var r=o.anchorOffset,i=o.focusNode;o=o.focusOffset;try{n.nodeType,i.nodeType}catch(m){n=null;break e}var a=0,l=-1,c=-1,d=0,u=0,h=e,p=null;t:for(;;){for(var f;h!==n||0!==r&&3!==h.nodeType||(l=a+r),h!==i||0!==o&&3!==h.nodeType||(c=a+o),3===h.nodeType&&(a+=h.nodeValue.length),null!==(f=h.firstChild);)p=h,h=f;for(;;){if(h===e)break t;if(p===n&&++d===r&&(l=a),p===i&&++u===o&&(c=a),null!==(f=h.nextSibling))break;p=(h=p).parentNode}h=f}n=-1===l||-1===c?null:{start:l,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(Gd={focusedElem:e,selectionRange:n},Vu=!1,nl=t;null!==nl;)if(e=(t=nl).child,0!==(1028&t.subtreeFlags)&&null!==e)e.return=t,nl=e;else for(;null!==nl;){switch(i=(t=nl).alternate,e=t.flags,t.tag){case 0:case 11:case 15:case 5:case 26:case 27:case 6:case 4:case 17:break;case 1:if(0!==(1024&e)&&null!==i){e=void 0,n=t,r=i.memoizedProps,i=i.memoizedState,o=n.stateNode;try{var g=Os(n.type,r,(n.elementType,n.type));e=o.getSnapshotBeforeUpdate(g,i),o.__reactInternalSnapshotBeforeUpdate=e}catch(y){od(n,n.return,y)}}break;case 3:if(0!==(1024&e))if(9===(n=(e=t.stateNode.containerInfo).nodeType))su(e);else if(1===n)switch(e.nodeName){case"HEAD":case"HTML":case"BODY":su(e);break;default:e.textContent=""}break;default:if(0!==(1024&e))throw Error(s(163))}if(null!==(e=t.sibling)){e.return=t.return,nl=e;break}nl=t.return}g=ol,ol=!1}(e,c),fl(c,e),to(Gd,e.containerInfo),Vu=!!Yd,Gd=Yd=null,e.current=c,rl(e,c.alternate,c),ae(),ec=a,H.p=i,T.T=n):e.current=c,kc?(kc=!1,Pc=e,Cc=o):ed(e,d),d=e.pendingLanes,0===d&&(Sc=null),function(e){if(ve&&"function"===typeof ve.onCommitFiberRoot)try{ve.onCommitFiberRoot(ye,e,void 0,128===(128&e.current.flags))}catch(t){}}(c.stateNode),gd(e),null!==t)for(r=e.onRecoverableError,c=0;c<t.length;c++)d=t[c],r(d.value,{componentStack:d.stack});0!==(3&Cc)&&td(),d=e.pendingLanes,0!==(4194218&o)&&0!==(42&d)?e===jc?Ec++:(Ec=0,jc=e):Ec=0,md(0,!1)}(e,t,n,o,h,r,i,a)}finally{T.T=u,H.p=h}}function ed(e,t){0===(e.pooledCacheLanes&=t)&&(null!=(t=e.pooledCache)&&(e.pooledCache=null,Hr(t)))}function td(){if(null!==Pc){var e=Pc,t=_c;_c=0;var n=Re(Cc),o=T.T,r=H.p;try{if(H.p=32>n?32:n,T.T=null,null===Pc)var i=!1;else{n=Ic,Ic=null;var a=Pc,l=Cc;if(Pc=null,Cc=0,0!==(6&ec))throw Error(s(331));var c=ec;if(ec|=4,Ml(a.current),kl(a,a.current,l,n),ec=c,md(0,!1),ve&&"function"===typeof ve.onPostCommitFiberRoot)try{ve.onPostCommitFiberRoot(ye,a)}catch(d){}i=!0}return i}finally{H.p=r,T.T=o,ed(e,t)}}return!1}function nd(e,t,n){t=Ro(n,t),null!==(e=Aa(e,t=Bs(e.stateNode,t,2),2))&&(Ae(e,2),gd(e))}function od(e,t,n){if(3===e.tag)nd(e,e,n);else for(;null!==t;){if(3===t.tag){nd(t,e,n);break}if(1===t.tag){var o=t.stateNode;if("function"===typeof t.type.getDerivedStateFromError||"function"===typeof o.componentDidCatch&&(null===Sc||!Sc.has(o))){e=Ro(n,e),null!==(o=Aa(t,n=Us(2),2))&&(Hs(n,o,t,e),Ae(o,2),gd(o));break}}t=t.return}}function rd(e,t,n){var o=e.pingCache;if(null===o){o=e.pingCache=new Jl;var r=new Set;o.set(t,r)}else void 0===(r=o.get(t))&&(r=new Set,o.set(t,r));r.has(n)||(lc=!0,r.add(n),e=id.bind(null,e,t,n),t.then(e,e))}function id(e,t,n){var o=e.pingCache;null!==o&&o.delete(t),e.pingedLanes|=e.suspendedLanes&n,e.warmLanes&=~n,tc===e&&(oc&n)===n&&(4===dc||3===dc&&(62914560&oc)===oc&&300>le()-bc?0===(2&ec)&&Bc(e,0):pc|=n,gc===oc&&(gc=0)),gd(e)}function sd(e,t){0===t&&(t=Te()),null!==(e=To(e,t))&&(Ae(e,t),gd(e))}function ad(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),sd(e,n)}function ld(e,t){var n=0;switch(e.tag){case 13:var o=e.stateNode,r=e.memoizedState;null!==r&&(n=r.retryLane);break;case 19:o=e.stateNode;break;case 22:o=e.stateNode._retryCache;break;default:throw Error(s(314))}null!==o&&o.delete(t),sd(e,n)}var cd=null,dd=null,ud=!1,hd=!1,pd=!1,fd=0;function gd(e){var t;e!==dd&&null===e.next&&(null===dd?cd=dd=e:dd=dd.next=e),hd=!0,ud||(ud=!0,t=yd,ou((function(){0!==(6&ec)?re(de,t):t()})))}function md(e,t){if(!pd&&hd){pd=!0;do{for(var n=!1,o=cd;null!==o;){if(!t)if(0!==e){var r=o.pendingLanes;if(0===r)var i=0;else{var s=o.suspendedLanes,a=o.pingedLanes;i=(1<<31-we(42|e)+1)-1,i=201326677&(i&=r&~(s&~a))?201326677&i|1:i?2|i:0}0!==i&&(n=!0,wd(o,i))}else i=oc,0===(3&(i=_e(o,o===tc?i:0)))||Ie(o,i)||(n=!0,wd(o,i));o=o.next}}while(n);pd=!1}}function yd(){hd=ud=!1;var e=0;0!==fd&&(function(){var e=window.event;if(e&&"popstate"===e.type)return e!==Jd&&(Jd=e,!0);return Jd=null,!1}()&&(e=fd),fd=0);for(var t=le(),n=null,o=cd;null!==o;){var r=o.next,i=vd(o,t);0===i?(o.next=null,null===n?cd=r:n.next=r,null===r&&(dd=n)):(n=o,(0!==e||0!==(3&i))&&(hd=!0)),o=r}md(e,!1)}function vd(e,t){for(var n=e.suspendedLanes,o=e.pingedLanes,r=e.expirationTimes,i=-62914561&e.pendingLanes;0<i;){var s=31-we(i),a=1<<s,l=r[s];-1===l?0!==(a&n)&&0===(a&o)||(r[s]=Ee(a,t)):l<=t&&(e.expiredLanes|=a),i&=~a}if(n=oc,n=_e(e,e===(t=tc)?n:0),o=e.callbackNode,0===n||e===t&&2===rc||null!==e.cancelPendingCommit)return null!==o&&null!==o&&ie(o),e.callbackNode=null,e.callbackPriority=0;if(0===(3&n)||Ie(e,n)){if((t=n&-n)===e.callbackPriority)return t;switch(null!==o&&ie(o),Re(n)){case 2:case 8:n=ue;break;case 32:default:n=he;break;case 268435456:n=fe}return o=bd.bind(null,e),n=re(n,o),e.callbackPriority=t,e.callbackNode=n,t}return null!==o&&null!==o&&ie(o),e.callbackPriority=2,e.callbackNode=null,2}function bd(e,t){var n=e.callbackNode;if(td()&&e.callbackNode!==n)return null;var o=oc;return 0===(o=_e(e,e===tc?o:0))?null:(Oc(e,o,t),vd(e,le()),null!=e.callbackNode&&e.callbackNode===n?bd.bind(null,e):null)}function wd(e,t){if(td())return null;Oc(e,t,!0)}function xd(){return 0===fd&&(fd=je()),fd}function Sd(e){return null==e||"symbol"===typeof e||"boolean"===typeof e?null:"function"===typeof e?e:jt(""+e)}function kd(e,t){var n=t.ownerDocument.createElement("input");return n.name=t.name,n.value=t.value,e.id&&n.setAttribute("form",e.id),t.parentNode.insertBefore(n,t),e=new FormData(e),n.parentNode.removeChild(n),e}for(var Pd=0;Pd<So.length;Pd++){var Cd=So[Pd];ko(Cd.toLowerCase(),"on"+(Cd[0].toUpperCase()+Cd.slice(1)))}ko(fo,"onAnimationEnd"),ko(go,"onAnimationIteration"),ko(mo,"onAnimationStart"),ko("dblclick","onDoubleClick"),ko("focusin","onFocus"),ko("focusout","onBlur"),ko(yo,"onTransitionRun"),ko(vo,"onTransitionStart"),ko(bo,"onTransitionCancel"),ko(wo,"onTransitionEnd"),tt("onMouseEnter",["mouseout","mouseover"]),tt("onMouseLeave",["mouseout","mouseover"]),tt("onPointerEnter",["pointerout","pointerover"]),tt("onPointerLeave",["pointerout","pointerover"]),et("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),et("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),et("onBeforeInput",["compositionend","keypress","textInput","paste"]),et("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),et("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),et("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var _d="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Id=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(_d));function Ed(e,t){t=0!==(4&t);for(var n=0;n<e.length;n++){var o=e[n],r=o.event;o=o.listeners;e:{var i=void 0;if(t)for(var s=o.length-1;0<=s;s--){var a=o[s],l=a.instance,c=a.currentTarget;if(a=a.listener,l!==i&&r.isPropagationStopped())break e;i=a,r.currentTarget=c;try{i(r)}catch(d){Ds(d)}r.currentTarget=null,i=l}else for(s=0;s<o.length;s++){if(l=(a=o[s]).instance,c=a.currentTarget,a=a.listener,l!==i&&r.isPropagationStopped())break e;i=a,r.currentTarget=c;try{i(r)}catch(d){Ds(d)}r.currentTarget=null,i=l}}}}function jd(e,t){var n=t[Ue];void 0===n&&(n=t[Ue]=new Set);var o=e+"__bubble";n.has(o)||(Od(t,e,2,!1),n.add(o))}function Td(e,t,n){var o=0;t&&(o|=4),Od(n,e,o,t)}var Md="_reactListening"+Math.random().toString(36).slice(2);function Ad(e){if(!e[Md]){e[Md]=!0,Qe.forEach((function(t){"selectionchange"!==t&&(Id.has(t)||Td(t,!1,e),Td(t,!0,e))}));var t=9===e.nodeType?e:e.ownerDocument;null===t||t[Md]||(t[Md]=!0,Td("selectionchange",!1,t))}}function Od(e,t,n,o){switch(Zu(t)){case 2:var r=Wu;break;case 8:r=qu;break;default:r=Yu}n=r.bind(null,t,n,e),r=void 0,!Nt||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(r=!0),o?void 0!==r?e.addEventListener(t,n,{capture:!0,passive:r}):e.addEventListener(t,n,!0):void 0!==r?e.addEventListener(t,n,{passive:r}):e.addEventListener(t,n,!1)}function Dd(e,t,n,o,r){var i=o;if(0===(1&t)&&0===(2&t)&&null!==o)e:for(;;){if(null===o)return;var s=o.tag;if(3===s||4===s){var a=o.stateNode.containerInfo;if(a===r||8===a.nodeType&&a.parentNode===r)break;if(4===s)for(s=o.return;null!==s;){var l=s.tag;if((3===l||4===l)&&((l=s.stateNode.containerInfo)===r||8===l.nodeType&&l.parentNode===r))return;s=s.return}for(;null!==a;){if(null===(s=Ye(a)))return;if(5===(l=s.tag)||6===l||26===l||27===l){o=i=s;continue e}a=a.parentNode}}o=o.return}Lt((function(){var o=i,r=Mt(n),s=[];e:{var a=xo.get(e);if(void 0!==a){var l=Qt,c=e;switch(e){case"keypress":if(0===Vt(n))break e;case"keydown":case"keyup":l=fn;break;case"focusin":c="focus",l=rn;break;case"focusout":c="blur",l=rn;break;case"beforeblur":case"afterblur":l=rn;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":l=nn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":l=on;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":l=mn;break;case fo:case go:case mo:l=sn;break;case wo:l=yn;break;case"scroll":case"scrollend":l=en;break;case"wheel":l=vn;break;case"copy":case"cut":case"paste":l=an;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":l=gn;break;case"toggle":case"beforetoggle":l=bn}var d=0!==(4&t),u=!d&&("scroll"===e||"scrollend"===e),h=d?null!==a?a+"Capture":null:a;d=[];for(var p,f=o;null!==f;){var g=f;if(p=g.stateNode,5!==(g=g.tag)&&26!==g&&27!==g||null===p||null===h||null!=(g=zt(f,h))&&d.push(Rd(f,g,p)),u)break;f=f.return}0<d.length&&(a=new l(a,c,null,n,r),s.push({event:a,listeners:d}))}}if(0===(7&t)){if(l="mouseout"===e||"pointerout"===e,(!(a="mouseover"===e||"pointerover"===e)||n===Tt||!(c=n.relatedTarget||n.fromElement)||!Ye(c)&&!c[Be])&&(l||a)&&(a=r.window===r?r:(a=r.ownerDocument)?a.defaultView||a.parentWindow:window,l?(l=o,null!==(c=(c=n.relatedTarget||n.toElement)?Ye(c):null)&&(u=z(c),d=c.tag,c!==u||5!==d&&27!==d&&6!==d)&&(c=null)):(l=null,c=o),l!==c)){if(d=nn,g="onMouseLeave",h="onMouseEnter",f="mouse","pointerout"!==e&&"pointerover"!==e||(d=gn,g="onPointerLeave",h="onPointerEnter",f="pointer"),u=null==l?a:Xe(l),p=null==c?a:Xe(c),(a=new d(g,f+"leave",l,n,r)).target=u,a.relatedTarget=p,g=null,Ye(r)===o&&((d=new d(h,f+"enter",c,n,r)).target=p,d.relatedTarget=u,g=d),u=g,l&&c)e:{for(h=c,f=0,p=d=l;p;p=zd(p))f++;for(p=0,g=h;g;g=zd(g))p++;for(;0<f-p;)d=zd(d),f--;for(;0<p-f;)h=zd(h),p--;for(;f--;){if(d===h||null!==h&&d===h.alternate)break e;d=zd(d),h=zd(h)}d=null}else d=null;null!==l&&Nd(s,a,l,d,!1),null!==c&&null!==u&&Nd(s,u,c,d,!0)}if("select"===(l=(a=o?Xe(o):window).nodeName&&a.nodeName.toLowerCase())||"input"===l&&"file"===a.type)var m=zn;else if(Mn(a))if(Nn)m=Yn;else{m=Wn;var y=Vn}else!(l=a.nodeName)||"input"!==l.toLowerCase()||"checkbox"!==a.type&&"radio"!==a.type?o&&_t(o.elementType)&&(m=zn):m=qn;switch(m&&(m=m(e,o))?An(s,m,n,r):(y&&y(e,a,o),"focusout"===e&&o&&"number"===a.type&&null!=o.memoizedProps.value&&vt(a,"number",a.value)),y=o?Xe(o):window,e){case"focusin":(Mn(y)||"true"===y.contentEditable)&&(oo=y,ro=o,io=null);break;case"focusout":io=ro=oo=null;break;case"mousedown":so=!0;break;case"contextmenu":case"mouseup":case"dragend":so=!1,ao(s,n,r);break;case"selectionchange":if(no)break;case"keydown":case"keyup":ao(s,n,r)}var v;if(xn)e:{switch(e){case"compositionstart":var b="onCompositionStart";break e;case"compositionend":b="onCompositionEnd";break e;case"compositionupdate":b="onCompositionUpdate";break e}b=void 0}else jn?In(e,n)&&(b="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(b="onCompositionStart");b&&(Pn&&"ko"!==n.locale&&(jn||"onCompositionStart"!==b?"onCompositionEnd"===b&&jn&&(v=Kt()):(Ut="value"in(Bt=r)?Bt.value:Bt.textContent,jn=!0)),0<(y=Ld(o,b)).length&&(b=new ln(b,e,null,n,r),s.push({event:b,listeners:y}),v?b.data=v:null!==(v=En(n))&&(b.data=v))),(v=kn?function(e,t){switch(e){case"compositionend":return En(t);case"keypress":return 32!==t.which?null:(_n=!0,Cn);case"textInput":return(e=t.data)===Cn&&_n?null:e;default:return null}}(e,n):function(e,t){if(jn)return"compositionend"===e||!xn&&In(e,t)?(e=Kt(),Ht=Ut=Bt=null,jn=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Pn&&"ko"!==t.locale?null:t.data}}(e,n))&&(0<(b=Ld(o,"onBeforeInput")).length&&(y=new ln("onBeforeInput","beforeinput",null,n,r),s.push({event:y,listeners:b}),y.data=v)),function(e,t,n,o,r){if("submit"===t&&n&&n.stateNode===r){var i=Sd((r[Fe]||null).action),s=o.submitter;s&&null!==(t=(t=s[Fe]||null)?Sd(t.formAction):s.getAttribute("formAction"))&&(i=t,s=null);var a=new Qt("action","action",null,o,r);e.push({event:a,listeners:[{instance:null,listener:function(){if(o.defaultPrevented){if(0!==fd){var e=s?kd(r,s):new FormData(r);us(n,{pending:!0,data:e,method:r.method,action:i},null,e)}}else"function"===typeof i&&(a.preventDefault(),e=s?kd(r,s):new FormData(r),us(n,{pending:!0,data:e,method:r.method,action:i},i,e))},currentTarget:r}]})}}(s,e,o,n,r)}Ed(s,t)}))}function Rd(e,t,n){return{instance:e,listener:t,currentTarget:n}}function Ld(e,t){for(var n=t+"Capture",o=[];null!==e;){var r=e,i=r.stateNode;5!==(r=r.tag)&&26!==r&&27!==r||null===i||(null!=(r=zt(e,n))&&o.unshift(Rd(e,r,i)),null!=(r=zt(e,t))&&o.push(Rd(e,r,i))),e=e.return}return o}function zd(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag&&27!==e.tag);return e||null}function Nd(e,t,n,o,r){for(var i=t._reactName,s=[];null!==n&&n!==o;){var a=n,l=a.alternate,c=a.stateNode;if(a=a.tag,null!==l&&l===o)break;5!==a&&26!==a&&27!==a||null===c||(l=c,r?null!=(c=zt(n,i))&&s.unshift(Rd(n,c,l)):r||null!=(c=zt(n,i))&&s.push(Rd(n,c,l))),n=n.return}0!==s.length&&e.push({event:t,listeners:s})}var Fd=/\r\n?/g,Bd=/\u0000|\uFFFD/g;function Ud(e){return("string"===typeof e?e:""+e).replace(Fd,"\n").replace(Bd,"")}function Hd(e,t){return t=Ud(t),Ud(e)===t}function Kd(){}function Vd(e,t,n,o,r,i){switch(n){case"children":"string"===typeof o?"body"===t||"textarea"===t&&""===o||St(e,o):("number"===typeof o||"bigint"===typeof o)&&"body"!==t&&St(e,""+o);break;case"className":at(e,"class",o);break;case"tabIndex":at(e,"tabindex",o);break;case"dir":case"role":case"viewBox":case"width":case"height":at(e,n,o);break;case"style":Ct(e,o,i);break;case"data":if("object"!==t){at(e,"data",o);break}case"src":case"href":if(""===o&&("a"!==t||"href"!==n)){e.removeAttribute(n);break}if(null==o||"function"===typeof o||"symbol"===typeof o||"boolean"===typeof o){e.removeAttribute(n);break}o=jt(""+o),e.setAttribute(n,o);break;case"action":case"formAction":if("function"===typeof o){e.setAttribute(n,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}if("function"===typeof i&&("formAction"===n?("input"!==t&&Vd(e,t,"name",r.name,r,null),Vd(e,t,"formEncType",r.formEncType,r,null),Vd(e,t,"formMethod",r.formMethod,r,null),Vd(e,t,"formTarget",r.formTarget,r,null)):(Vd(e,t,"encType",r.encType,r,null),Vd(e,t,"method",r.method,r,null),Vd(e,t,"target",r.target,r,null))),null==o||"symbol"===typeof o||"boolean"===typeof o){e.removeAttribute(n);break}o=jt(""+o),e.setAttribute(n,o);break;case"onClick":null!=o&&(e.onclick=Kd);break;case"onScroll":null!=o&&jd("scroll",e);break;case"onScrollEnd":null!=o&&jd("scrollend",e);break;case"dangerouslySetInnerHTML":if(null!=o){if("object"!==typeof o||!("__html"in o))throw Error(s(61));if(null!=(n=o.__html)){if(null!=r.children)throw Error(s(60));e.innerHTML=n}}break;case"multiple":e.multiple=o&&"function"!==typeof o&&"symbol"!==typeof o;break;case"muted":e.muted=o&&"function"!==typeof o&&"symbol"!==typeof o;break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":case"autoFocus":break;case"xlinkHref":if(null==o||"function"===typeof o||"boolean"===typeof o||"symbol"===typeof o){e.removeAttribute("xlink:href");break}n=jt(""+o),e.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",n);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":null!=o&&"function"!==typeof o&&"symbol"!==typeof o?e.setAttribute(n,""+o):e.removeAttribute(n);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":o&&"function"!==typeof o&&"symbol"!==typeof o?e.setAttribute(n,""):e.removeAttribute(n);break;case"capture":case"download":!0===o?e.setAttribute(n,""):!1!==o&&null!=o&&"function"!==typeof o&&"symbol"!==typeof o?e.setAttribute(n,o):e.removeAttribute(n);break;case"cols":case"rows":case"size":case"span":null!=o&&"function"!==typeof o&&"symbol"!==typeof o&&!isNaN(o)&&1<=o?e.setAttribute(n,o):e.removeAttribute(n);break;case"rowSpan":case"start":null==o||"function"===typeof o||"symbol"===typeof o||isNaN(o)?e.removeAttribute(n):e.setAttribute(n,o);break;case"popover":jd("beforetoggle",e),jd("toggle",e),st(e,"popover",o);break;case"xlinkActuate":lt(e,"http://www.w3.org/1999/xlink","xlink:actuate",o);break;case"xlinkArcrole":lt(e,"http://www.w3.org/1999/xlink","xlink:arcrole",o);break;case"xlinkRole":lt(e,"http://www.w3.org/1999/xlink","xlink:role",o);break;case"xlinkShow":lt(e,"http://www.w3.org/1999/xlink","xlink:show",o);break;case"xlinkTitle":lt(e,"http://www.w3.org/1999/xlink","xlink:title",o);break;case"xlinkType":lt(e,"http://www.w3.org/1999/xlink","xlink:type",o);break;case"xmlBase":lt(e,"http://www.w3.org/XML/1998/namespace","xml:base",o);break;case"xmlLang":lt(e,"http://www.w3.org/XML/1998/namespace","xml:lang",o);break;case"xmlSpace":lt(e,"http://www.w3.org/XML/1998/namespace","xml:space",o);break;case"is":st(e,"is",o);break;case"innerText":case"textContent":break;default:(!(2<n.length)||"o"!==n[0]&&"O"!==n[0]||"n"!==n[1]&&"N"!==n[1])&&st(e,n=It.get(n)||n,o)}}function Wd(e,t,n,o,r,i){switch(n){case"style":Ct(e,o,i);break;case"dangerouslySetInnerHTML":if(null!=o){if("object"!==typeof o||!("__html"in o))throw Error(s(61));if(null!=(n=o.__html)){if(null!=r.children)throw Error(s(60));e.innerHTML=n}}break;case"children":"string"===typeof o?St(e,o):("number"===typeof o||"bigint"===typeof o)&&St(e,""+o);break;case"onScroll":null!=o&&jd("scroll",e);break;case"onScrollEnd":null!=o&&jd("scrollend",e);break;case"onClick":null!=o&&(e.onclick=Kd);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":case"innerText":case"textContent":break;default:Je.hasOwnProperty(n)||("o"!==n[0]||"n"!==n[1]||(r=n.endsWith("Capture"),t=n.slice(2,r?n.length-7:void 0),"function"===typeof(i=null!=(i=e[Fe]||null)?i[n]:null)&&e.removeEventListener(t,i,r),"function"!==typeof o)?n in e?e[n]=o:!0===o?e.setAttribute(n,""):st(e,n,o):("function"!==typeof i&&null!==i&&(n in e?e[n]=null:e.hasAttribute(n)&&e.removeAttribute(n)),e.addEventListener(t,o,r)))}}function qd(e,t,n){switch(t){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":jd("error",e),jd("load",e);var o,r=!1,i=!1;for(o in n)if(n.hasOwnProperty(o)){var a=n[o];if(null!=a)switch(o){case"src":r=!0;break;case"srcSet":i=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(s(137,t));default:Vd(e,t,o,a,n,null)}}return i&&Vd(e,t,"srcSet",n.srcSet,n,null),void(r&&Vd(e,t,"src",n.src,n,null));case"input":jd("invalid",e);var l=o=a=i=null,c=null,d=null;for(r in n)if(n.hasOwnProperty(r)){var u=n[r];if(null!=u)switch(r){case"name":i=u;break;case"type":a=u;break;case"checked":c=u;break;case"defaultChecked":d=u;break;case"value":o=u;break;case"defaultValue":l=u;break;case"children":case"dangerouslySetInnerHTML":if(null!=u)throw Error(s(137,t));break;default:Vd(e,t,r,u,n,null)}}return yt(e,o,l,c,d,a,i,!1),void ut(e);case"select":for(i in jd("invalid",e),r=a=o=null,n)if(n.hasOwnProperty(i)&&null!=(l=n[i]))switch(i){case"value":o=l;break;case"defaultValue":a=l;break;case"multiple":r=l;default:Vd(e,t,i,l,n,null)}return t=o,n=a,e.multiple=!!r,void(null!=t?bt(e,!!r,t,!1):null!=n&&bt(e,!!r,n,!0));case"textarea":for(a in jd("invalid",e),o=i=r=null,n)if(n.hasOwnProperty(a)&&null!=(l=n[a]))switch(a){case"value":r=l;break;case"defaultValue":i=l;break;case"children":o=l;break;case"dangerouslySetInnerHTML":if(null!=l)throw Error(s(91));break;default:Vd(e,t,a,l,n,null)}return xt(e,r,i,o),void ut(e);case"option":for(c in n)if(n.hasOwnProperty(c)&&null!=(r=n[c]))if("selected"===c)e.selected=r&&"function"!==typeof r&&"symbol"!==typeof r;else Vd(e,t,c,r,n,null);return;case"dialog":jd("cancel",e),jd("close",e);break;case"iframe":case"object":jd("load",e);break;case"video":case"audio":for(r=0;r<_d.length;r++)jd(_d[r],e);break;case"image":jd("error",e),jd("load",e);break;case"details":jd("toggle",e);break;case"embed":case"source":case"link":jd("error",e),jd("load",e);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(d in n)if(n.hasOwnProperty(d)&&null!=(r=n[d]))switch(d){case"children":case"dangerouslySetInnerHTML":throw Error(s(137,t));default:Vd(e,t,d,r,n,null)}return;default:if(_t(t)){for(u in n)n.hasOwnProperty(u)&&(void 0!==(r=n[u])&&Wd(e,t,u,r,n,void 0));return}}for(l in n)n.hasOwnProperty(l)&&(null!=(r=n[l])&&Vd(e,t,l,r,n,null))}var Yd=null,Gd=null;function Xd(e){return 9===e.nodeType?e:e.ownerDocument}function $d(e){switch(e){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function Zd(e,t){if(0===e)switch(t){case"svg":return 1;case"math":return 2;default:return 0}return 1===e&&"foreignObject"===t?0:e}function Qd(e,t){return"textarea"===e||"noscript"===e||"string"===typeof t.children||"number"===typeof t.children||"bigint"===typeof t.children||"object"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var Jd=null;var eu="function"===typeof setTimeout?setTimeout:void 0,tu="function"===typeof clearTimeout?clearTimeout:void 0,nu="function"===typeof Promise?Promise:void 0,ou="function"===typeof queueMicrotask?queueMicrotask:"undefined"!==typeof nu?function(e){return nu.resolve(null).then(e).catch(ru)}:eu;function ru(e){setTimeout((function(){throw e}))}function iu(e,t){var n=t,o=0;do{var r=n.nextSibling;if(e.removeChild(n),r&&8===r.nodeType)if("/$"===(n=r.data)){if(0===o)return e.removeChild(r),void gh(t);o--}else"$"!==n&&"$?"!==n&&"$!"!==n||o++;n=r}while(n);gh(t)}function su(e){var t=e.firstChild;for(t&&10===t.nodeType&&(t=t.nextSibling);t;){var n=t;switch(t=t.nextSibling,n.nodeName){case"HTML":case"HEAD":case"BODY":su(n),qe(n);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if("stylesheet"===n.rel.toLowerCase())continue}e.removeChild(n)}}function au(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t||"F!"===t||"F"===t)break;if("/$"===t)return null}}return e}function lu(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}function cu(e,t,n){switch(t=Xd(n),e){case"html":if(!(e=t.documentElement))throw Error(s(452));return e;case"head":if(!(e=t.head))throw Error(s(453));return e;case"body":if(!(e=t.body))throw Error(s(454));return e;default:throw Error(s(451))}}var du=new Map,uu=new Set;function hu(e){return"function"===typeof e.getRootNode?e.getRootNode():e.ownerDocument}var pu=H.d;H.d={f:function(){var e=pu.f(),t=Nc();return e||t},r:function(e){var t=Ge(e);null!==t&&5===t.tag&&"form"===t.type?ps(t):pu.r(e)},D:function(e){pu.D(e),gu("dns-prefetch",e,null)},C:function(e,t){pu.C(e,t),gu("preconnect",e,t)},L:function(e,t,n){pu.L(e,t,n);var o=fu;if(o&&e&&t){var r='link[rel="preload"][as="'+gt(t)+'"]';"image"===t&&n&&n.imageSrcSet?(r+='[imagesrcset="'+gt(n.imageSrcSet)+'"]',"string"===typeof n.imageSizes&&(r+='[imagesizes="'+gt(n.imageSizes)+'"]')):r+='[href="'+gt(e)+'"]';var i=r;switch(t){case"style":i=yu(e);break;case"script":i=wu(e)}du.has(i)||(e=M({rel:"preload",href:"image"===t&&n&&n.imageSrcSet?void 0:e,as:t},n),du.set(i,e),null!==o.querySelector(r)||"style"===t&&o.querySelector(vu(i))||"script"===t&&o.querySelector(xu(i))||(qd(t=o.createElement("link"),"link",e),Ze(t),o.head.appendChild(t)))}},m:function(e,t){pu.m(e,t);var n=fu;if(n&&e){var o=t&&"string"===typeof t.as?t.as:"script",r='link[rel="modulepreload"][as="'+gt(o)+'"][href="'+gt(e)+'"]',i=r;switch(o){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":i=wu(e)}if(!du.has(i)&&(e=M({rel:"modulepreload",href:e},t),du.set(i,e),null===n.querySelector(r))){switch(o){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(n.querySelector(xu(i)))return}qd(o=n.createElement("link"),"link",e),Ze(o),n.head.appendChild(o)}}},X:function(e,t){pu.X(e,t);var n=fu;if(n&&e){var o=$e(n).hoistableScripts,r=wu(e),i=o.get(r);i||((i=n.querySelector(xu(r)))||(e=M({src:e,async:!0},t),(t=du.get(r))&&Cu(e,t),Ze(i=n.createElement("script")),qd(i,"link",e),n.head.appendChild(i)),i={type:"script",instance:i,count:1,state:null},o.set(r,i))}},S:function(e,t,n){pu.S(e,t,n);var o=fu;if(o&&e){var r=$e(o).hoistableStyles,i=yu(e);t=t||"default";var s=r.get(i);if(!s){var a={loading:0,preload:null};if(s=o.querySelector(vu(i)))a.loading=5;else{e=M({rel:"stylesheet",href:e,"data-precedence":t},n),(n=du.get(i))&&Pu(e,n);var l=s=o.createElement("link");Ze(l),qd(l,"link",e),l._p=new Promise((function(e,t){l.onload=e,l.onerror=t})),l.addEventListener("load",(function(){a.loading|=1})),l.addEventListener("error",(function(){a.loading|=2})),a.loading|=4,ku(s,t,o)}s={type:"stylesheet",instance:s,count:1,state:a},r.set(i,s)}}},M:function(e,t){pu.M(e,t);var n=fu;if(n&&e){var o=$e(n).hoistableScripts,r=wu(e),i=o.get(r);i||((i=n.querySelector(xu(r)))||(e=M({src:e,async:!0,type:"module"},t),(t=du.get(r))&&Cu(e,t),Ze(i=n.createElement("script")),qd(i,"link",e),n.head.appendChild(i)),i={type:"script",instance:i,count:1,state:null},o.set(r,i))}}};var fu="undefined"===typeof document?null:document;function gu(e,t,n){var o=fu;if(o&&"string"===typeof t&&t){var r=gt(t);r='link[rel="'+e+'"][href="'+r+'"]',"string"===typeof n&&(r+='[crossorigin="'+n+'"]'),uu.has(r)||(uu.add(r),e={rel:e,crossOrigin:n,href:t},null===o.querySelector(r)&&(qd(t=o.createElement("link"),"link",e),Ze(t),o.head.appendChild(t)))}}function mu(e,t,n,o){var r,i,a,l,c=(c=Z.current)?hu(c):null;if(!c)throw Error(s(446));switch(e){case"meta":case"title":return null;case"style":return"string"===typeof n.precedence&&"string"===typeof n.href?(t=yu(n.href),(o=(n=$e(c).hoistableStyles).get(t))||(o={type:"style",instance:null,count:0,state:null},n.set(t,o)),o):{type:"void",instance:null,count:0,state:null};case"link":if("stylesheet"===n.rel&&"string"===typeof n.href&&"string"===typeof n.precedence){e=yu(n.href);var d=$e(c).hoistableStyles,u=d.get(e);if(u||(c=c.ownerDocument||c,u={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},d.set(e,u),(d=c.querySelector(vu(e)))&&!d._p&&(u.instance=d,u.state.loading=5),du.has(e)||(n={rel:"preload",as:"style",href:n.href,crossOrigin:n.crossOrigin,integrity:n.integrity,media:n.media,hrefLang:n.hrefLang,referrerPolicy:n.referrerPolicy},du.set(e,n),d||(r=c,i=e,a=n,l=u.state,r.querySelector('link[rel="preload"][as="style"]['+i+"]")?l.loading=1:(i=r.createElement("link"),l.preload=i,i.addEventListener("load",(function(){return l.loading|=1})),i.addEventListener("error",(function(){return l.loading|=2})),qd(i,"link",a),Ze(i),r.head.appendChild(i))))),t&&null===o)throw Error(s(528,""));return u}if(t&&null!==o)throw Error(s(529,""));return null;case"script":return t=n.async,"string"===typeof(n=n.src)&&t&&"function"!==typeof t&&"symbol"!==typeof t?(t=wu(n),(o=(n=$e(c).hoistableScripts).get(t))||(o={type:"script",instance:null,count:0,state:null},n.set(t,o)),o):{type:"void",instance:null,count:0,state:null};default:throw Error(s(444,e))}}function yu(e){return'href="'+gt(e)+'"'}function vu(e){return'link[rel="stylesheet"]['+e+"]"}function bu(e){return M({},e,{"data-precedence":e.precedence,precedence:null})}function wu(e){return'[src="'+gt(e)+'"]'}function xu(e){return"script[async]"+e}function Su(e,t,n){if(t.count++,null===t.instance)switch(t.type){case"style":var o=e.querySelector('style[data-href~="'+gt(n.href)+'"]');if(o)return t.instance=o,Ze(o),o;var r=M({},n,{"data-href":n.href,"data-precedence":n.precedence,href:null,precedence:null});return Ze(o=(e.ownerDocument||e).createElement("style")),qd(o,"style",r),ku(o,n.precedence,e),t.instance=o;case"stylesheet":r=yu(n.href);var i=e.querySelector(vu(r));if(i)return t.state.loading|=4,t.instance=i,Ze(i),i;o=bu(n),(r=du.get(r))&&Pu(o,r),Ze(i=(e.ownerDocument||e).createElement("link"));var a=i;return a._p=new Promise((function(e,t){a.onload=e,a.onerror=t})),qd(i,"link",o),t.state.loading|=4,ku(i,n.precedence,e),t.instance=i;case"script":return i=wu(n.src),(r=e.querySelector(xu(i)))?(t.instance=r,Ze(r),r):(o=n,(r=du.get(i))&&Cu(o=M({},n),r),Ze(r=(e=e.ownerDocument||e).createElement("script")),qd(r,"link",o),e.head.appendChild(r),t.instance=r);case"void":return null;default:throw Error(s(443,t.type))}else"stylesheet"===t.type&&0===(4&t.state.loading)&&(o=t.instance,t.state.loading|=4,ku(o,n.precedence,e));return t.instance}function ku(e,t,n){for(var o=n.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),r=o.length?o[o.length-1]:null,i=r,s=0;s<o.length;s++){var a=o[s];if(a.dataset.precedence===t)i=a;else if(i!==r)break}i?i.parentNode.insertBefore(e,i.nextSibling):(t=9===n.nodeType?n.head:n).insertBefore(e,t.firstChild)}function Pu(e,t){null==e.crossOrigin&&(e.crossOrigin=t.crossOrigin),null==e.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),null==e.title&&(e.title=t.title)}function Cu(e,t){null==e.crossOrigin&&(e.crossOrigin=t.crossOrigin),null==e.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),null==e.integrity&&(e.integrity=t.integrity)}var _u=null;function Iu(e,t,n){if(null===_u){var o=new Map,r=_u=new Map;r.set(n,o)}else(o=(r=_u).get(n))||(o=new Map,r.set(n,o));if(o.has(e))return o;for(o.set(e,null),n=n.getElementsByTagName(e),r=0;r<n.length;r++){var i=n[r];if(!(i[We]||i[Ne]||"link"===e&&"stylesheet"===i.getAttribute("rel"))&&"http://www.w3.org/2000/svg"!==i.namespaceURI){var s=i.getAttribute(t)||"";s=e+s;var a=o.get(s);a?a.push(i):o.set(s,[i])}}return o}function Eu(e,t,n){(e=e.ownerDocument||e).head.insertBefore(n,"title"===t?e.querySelector("head > title"):null)}function ju(e){return"stylesheet"!==e.type||0!==(3&e.state.loading)}var Tu=null;function Mu(){}function Au(){if(this.count--,0===this.count)if(this.stylesheets)Du(this,this.stylesheets);else if(this.unsuspend){var e=this.unsuspend;this.unsuspend=null,e()}}var Ou=null;function Du(e,t){e.stylesheets=null,null!==e.unsuspend&&(e.count++,Ou=new Map,t.forEach(Ru,e),Ou=null,Au.call(e))}function Ru(e,t){if(!(4&t.state.loading)){var n=Ou.get(e);if(n)var o=n.get(null);else{n=new Map,Ou.set(e,n);for(var r=e.querySelectorAll("link[data-precedence],style[data-precedence]"),i=0;i<r.length;i++){var s=r[i];"LINK"!==s.nodeName&&"not all"===s.getAttribute("media")||(n.set(s.dataset.precedence,s),o=s)}o&&n.set(null,o)}s=(r=t.instance).getAttribute("data-precedence"),(i=n.get(s)||o)===o&&n.set(null,r),n.set(s,r),this.count++,o=Au.bind(this),r.addEventListener("load",o),r.addEventListener("error",o),i?i.parentNode.insertBefore(r,i.nextSibling):(e=9===e.nodeType?e.head:e).insertBefore(r,e.firstChild),t.state.loading|=4}}var Lu={$$typeof:m,Provider:null,Consumer:null,_currentValue:K,_currentValue2:K,_threadCount:0};function zu(e,t,n,o,r,i,s,a){this.tag=1,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Me(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.finishedLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Me(0),this.hiddenUpdates=Me(null),this.identifierPrefix=o,this.onUncaughtError=r,this.onCaughtError=i,this.onRecoverableError=s,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=a,this.incompleteTransitions=new Map}function Nu(e,t,n,o,r,i,s,a,l,c,d,u){return e=new zu(e,t,n,s,a,l,c,u),t=1,!0===i&&(t|=24),i=Rl(3,null,null,t),e.current=i,i.stateNode=e,(t=Ur()).refCount++,e.pooledCache=t,t.refCount++,i.memoizedState={element:o,isDehydrated:n,cache:t},ja(i),e}function Fu(e){return e?e=Oo:Oo}function Bu(e,t,n,o,r,i){r=Fu(r),null===o.context?o.context=r:o.pendingContext=r,(o=Ma(t)).payload={element:n},null!==(i=void 0===i?null:i)&&(o.callback=i),null!==(n=Aa(e,o,t))&&(Ac(n,0,t),Oa(n,e,t))}function Uu(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function Hu(e,t){Uu(e,t),(e=e.alternate)&&Uu(e,t)}function Ku(e){if(13===e.tag){var t=To(e,67108864);null!==t&&Ac(t,0,67108864),Hu(e,67108864)}}var Vu=!0;function Wu(e,t,n,o){var r=T.T;T.T=null;var i=H.p;try{H.p=2,Yu(e,t,n,o)}finally{H.p=i,T.T=r}}function qu(e,t,n,o){var r=T.T;T.T=null;var i=H.p;try{H.p=8,Yu(e,t,n,o)}finally{H.p=i,T.T=r}}function Yu(e,t,n,o){if(Vu){var r=Gu(o);if(null===r)Dd(e,t,o,Xu,n),sh(e,o);else if(function(e,t,n,o,r){switch(t){case"focusin":return Ju=ah(Ju,e,t,n,o,r),!0;case"dragenter":return eh=ah(eh,e,t,n,o,r),!0;case"mouseover":return th=ah(th,e,t,n,o,r),!0;case"pointerover":var i=r.pointerId;return nh.set(i,ah(nh.get(i)||null,e,t,n,o,r)),!0;case"gotpointercapture":return i=r.pointerId,oh.set(i,ah(oh.get(i)||null,e,t,n,o,r)),!0}return!1}(r,e,t,n,o))o.stopPropagation();else if(sh(e,o),4&t&&-1<ih.indexOf(e)){for(;null!==r;){var i=Ge(r);if(null!==i)switch(i.tag){case 3:if((i=i.stateNode).current.memoizedState.isDehydrated){var s=Ce(i.pendingLanes);if(0!==s){var a=i;for(a.pendingLanes|=2,a.entangledLanes|=2;s;){var l=1<<31-we(s);a.entanglements[1]|=l,s&=~l}gd(i),0===(6&ec)&&(wc=le()+500,md(0,!1))}}break;case 13:null!==(a=To(i,2))&&Ac(a,0,2),Nc(),Hu(i,2)}if(null===(i=Gu(o))&&Dd(e,t,o,Xu,n),i===r)break;r=i}null!==r&&o.stopPropagation()}else Dd(e,t,o,null,n)}}function Gu(e){return $u(e=Mt(e))}var Xu=null;function $u(e){if(Xu=null,null!==(e=Ye(e))){var t=z(e);if(null===t)e=null;else{var n=t.tag;if(13===n){if(null!==(e=N(t)))return e;e=null}else if(3===n){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null)}}return Xu=e,null}function Zu(e){switch(e){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(ce()){case de:return 2;case ue:return 8;case he:case pe:return 32;case fe:return 268435456;default:return 32}default:return 32}}var Qu=!1,Ju=null,eh=null,th=null,nh=new Map,oh=new Map,rh=[],ih="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function sh(e,t){switch(e){case"focusin":case"focusout":Ju=null;break;case"dragenter":case"dragleave":eh=null;break;case"mouseover":case"mouseout":th=null;break;case"pointerover":case"pointerout":nh.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":oh.delete(t.pointerId)}}function ah(e,t,n,o,r,i){return null===e||e.nativeEvent!==i?(e={blockedOn:t,domEventName:n,eventSystemFlags:o,nativeEvent:i,targetContainers:[r]},null!==t&&(null!==(t=Ge(t))&&Ku(t)),e):(e.eventSystemFlags|=o,t=e.targetContainers,null!==r&&-1===t.indexOf(r)&&t.push(r),e)}function lh(e){var t=Ye(e.target);if(null!==t){var n=z(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=N(n)))return e.blockedOn=t,void function(e,t){var n=H.p;try{return H.p=e,t()}finally{H.p=n}}(e.priority,(function(){if(13===n.tag){var e=Tc(),t=To(n,e);null!==t&&Ac(t,0,e),Hu(n,e)}}))}else if(3===t&&n.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function ch(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=Gu(e.nativeEvent);if(null!==n)return null!==(t=Ge(n))&&Ku(t),e.blockedOn=n,!1;var o=new(n=e.nativeEvent).constructor(n.type,n);Tt=o,n.target.dispatchEvent(o),Tt=null,t.shift()}return!0}function dh(e,t,n){ch(e)&&n.delete(t)}function uh(){Qu=!1,null!==Ju&&ch(Ju)&&(Ju=null),null!==eh&&ch(eh)&&(eh=null),null!==th&&ch(th)&&(th=null),nh.forEach(dh),oh.forEach(dh)}function hh(e,t){e.blockedOn===t&&(e.blockedOn=null,Qu||(Qu=!0,o.unstable_scheduleCallback(o.unstable_NormalPriority,uh)))}var ph=null;function fh(e){ph!==e&&(ph=e,o.unstable_scheduleCallback(o.unstable_NormalPriority,(function(){ph===e&&(ph=null);for(var t=0;t<e.length;t+=3){var n=e[t],o=e[t+1],r=e[t+2];if("function"!==typeof o){if(null===$u(o||n))continue;break}var i=Ge(n);null!==i&&(e.splice(t,3),t-=3,us(i,{pending:!0,data:r,method:n.method,action:o},o,r))}})))}function gh(e){function t(t){return hh(t,e)}null!==Ju&&hh(Ju,e),null!==eh&&hh(eh,e),null!==th&&hh(th,e),nh.forEach(t),oh.forEach(t);for(var n=0;n<rh.length;n++){var o=rh[n];o.blockedOn===e&&(o.blockedOn=null)}for(;0<rh.length&&null===(n=rh[0]).blockedOn;)lh(n),null===n.blockedOn&&rh.shift();if(null!=(n=(e.ownerDocument||e).$$reactFormReplay))for(o=0;o<n.length;o+=3){var r=n[o],i=n[o+1],s=r[Fe]||null;if("function"===typeof i)s||fh(n);else if(s){var a=null;if(i&&i.hasAttribute("formAction")){if(r=i,s=i[Fe]||null)a=s.formAction;else if(null!==$u(r))continue}else a=s.action;"function"===typeof a?n[o+1]=a:(n.splice(o,3),o-=3),fh(n)}}}function mh(e){this._internalRoot=e}function yh(e){this._internalRoot=e}yh.prototype.render=mh.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(s(409));Bu(t.current,Tc(),e,t,null,null)},yh.prototype.unmount=mh.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;0===e.tag&&td(),Bu(e.current,2,null,e,null,null),Nc(),t[Be]=null}},yh.prototype.unstable_scheduleHydration=function(e){if(e){var t=Le();e={blockedOn:null,target:e,priority:t};for(var n=0;n<rh.length&&0!==t&&t<rh[n].priority;n++);rh.splice(n,0,e),0===n&&lh(e)}};var vh=r.version;if("19.0.0"!==vh)throw Error(s(527,vh,"19.0.0"));H.findDOMNode=function(e){var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(s(188));throw e=Object.keys(e).join(","),Error(s(268,e))}return e=function(e){var t=e.alternate;if(!t){if(null===(t=z(e)))throw Error(s(188));return t!==e?null:e}for(var n=e,o=t;;){var r=n.return;if(null===r)break;var i=r.alternate;if(null===i){if(null!==(o=r.return)){n=o;continue}break}if(r.child===i.child){for(i=r.child;i;){if(i===n)return F(r),e;if(i===o)return F(r),t;i=i.sibling}throw Error(s(188))}if(n.return!==o.return)n=r,o=i;else{for(var a=!1,l=r.child;l;){if(l===n){a=!0,n=r,o=i;break}if(l===o){a=!0,o=r,n=i;break}l=l.sibling}if(!a){for(l=i.child;l;){if(l===n){a=!0,n=i,o=r;break}if(l===o){a=!0,o=i,n=r;break}l=l.sibling}if(!a)throw Error(s(189))}}if(n.alternate!==o)throw Error(s(190))}if(3!==n.tag)throw Error(s(188));return n.stateNode.current===n?e:t}(t),e=null===(e=null!==e?B(e):null)?null:e.stateNode};var bh={bundleType:0,version:"19.0.0",rendererPackageName:"react-dom",currentDispatcherRef:T,findFiberByHostInstance:Ye,reconcilerVersion:"19.0.0"};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var wh=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!wh.isDisabled&&wh.supportsFiber)try{ye=wh.inject(bh),ve=wh}catch(Sh){}}t.createRoot=function(e,t){if(!a(e))throw Error(s(299));var n=!1,o="",r=Rs,i=Ls,l=zs;return null!==t&&void 0!==t&&(!0===t.unstable_strictMode&&(n=!0),void 0!==t.identifierPrefix&&(o=t.identifierPrefix),void 0!==t.onUncaughtError&&(r=t.onUncaughtError),void 0!==t.onCaughtError&&(i=t.onCaughtError),void 0!==t.onRecoverableError&&(l=t.onRecoverableError),void 0!==t.unstable_transitionCallbacks&&t.unstable_transitionCallbacks),t=Nu(e,1,!1,null,0,n,o,r,i,l,0,null),e[Be]=t.current,Ad(8===e.nodeType?e.parentNode:e),new mh(t)},t.hydrateRoot=function(e,t,n){if(!a(e))throw Error(s(299));var o=!1,r="",i=Rs,l=Ls,c=zs,d=null;return null!==n&&void 0!==n&&(!0===n.unstable_strictMode&&(o=!0),void 0!==n.identifierPrefix&&(r=n.identifierPrefix),void 0!==n.onUncaughtError&&(i=n.onUncaughtError),void 0!==n.onCaughtError&&(l=n.onCaughtError),void 0!==n.onRecoverableError&&(c=n.onRecoverableError),void 0!==n.unstable_transitionCallbacks&&n.unstable_transitionCallbacks,void 0!==n.formState&&(d=n.formState)),(t=Nu(e,1,!0,t,0,o,r,i,l,c,0,d)).context=Fu(null),n=t.current,(r=Ma(o=Tc())).callback=null,Aa(n,r,o),t.current.lanes=o,Ae(t,o),gd(t),e[Be]=t.current,Ad(e),new yh(t)},t.version="19.0.0"},6672:(e,t,n)=>{"use strict";var o=n(5043);function r(e){var t="https://react.dev/errors/"+e;if(1<arguments.length){t+="?args[]="+encodeURIComponent(arguments[1]);for(var n=2;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n])}return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function i(){}var s={d:{f:i,r:function(){throw Error(r(522))},D:i,C:i,L:i,m:i,X:i,S:i,M:i},p:0,findDOMNode:null},a=Symbol.for("react.portal");var l=o.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function c(e,t){return"font"===e?"":"string"===typeof t?"use-credentials"===t?t:"":void 0}t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=s,t.createPortal=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!t||1!==t.nodeType&&9!==t.nodeType&&11!==t.nodeType)throw Error(r(299));return function(e,t,n){var o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:a,key:null==o?null:""+o,children:e,containerInfo:t,implementation:n}}(e,t,null,n)},t.flushSync=function(e){var t=l.T,n=s.p;try{if(l.T=null,s.p=2,e)return e()}finally{l.T=t,s.p=n,s.d.f()}},t.preconnect=function(e,t){"string"===typeof e&&(t?t="string"===typeof(t=t.crossOrigin)?"use-credentials"===t?t:"":void 0:t=null,s.d.C(e,t))},t.prefetchDNS=function(e){"string"===typeof e&&s.d.D(e)},t.preinit=function(e,t){if("string"===typeof e&&t&&"string"===typeof t.as){var n=t.as,o=c(n,t.crossOrigin),r="string"===typeof t.integrity?t.integrity:void 0,i="string"===typeof t.fetchPriority?t.fetchPriority:void 0;"style"===n?s.d.S(e,"string"===typeof t.precedence?t.precedence:void 0,{crossOrigin:o,integrity:r,fetchPriority:i}):"script"===n&&s.d.X(e,{crossOrigin:o,integrity:r,fetchPriority:i,nonce:"string"===typeof t.nonce?t.nonce:void 0})}},t.preinitModule=function(e,t){if("string"===typeof e)if("object"===typeof t&&null!==t){if(null==t.as||"script"===t.as){var n=c(t.as,t.crossOrigin);s.d.M(e,{crossOrigin:n,integrity:"string"===typeof t.integrity?t.integrity:void 0,nonce:"string"===typeof t.nonce?t.nonce:void 0})}}else null==t&&s.d.M(e)},t.preload=function(e,t){if("string"===typeof e&&"object"===typeof t&&null!==t&&"string"===typeof t.as){var n=t.as,o=c(n,t.crossOrigin);s.d.L(e,n,{crossOrigin:o,integrity:"string"===typeof t.integrity?t.integrity:void 0,nonce:"string"===typeof t.nonce?t.nonce:void 0,type:"string"===typeof t.type?t.type:void 0,fetchPriority:"string"===typeof t.fetchPriority?t.fetchPriority:void 0,referrerPolicy:"string"===typeof t.referrerPolicy?t.referrerPolicy:void 0,imageSrcSet:"string"===typeof t.imageSrcSet?t.imageSrcSet:void 0,imageSizes:"string"===typeof t.imageSizes?t.imageSizes:void 0,media:"string"===typeof t.media?t.media:void 0})}},t.preloadModule=function(e,t){if("string"===typeof e)if(t){var n=c(t.as,t.crossOrigin);s.d.m(e,{as:"string"===typeof t.as&&"script"!==t.as?t.as:void 0,crossOrigin:n,integrity:"string"===typeof t.integrity?t.integrity:void 0})}else s.d.m(e)},t.requestFormReset=function(e){s.d.r(e)},t.unstable_batchedUpdates=function(e,t){return e(t)},t.useFormState=function(e,t,n){return l.H.useFormState(e,t,n)},t.useFormStatus=function(){return l.H.useHostTransitionStatus()},t.version="19.0.0"},4391:(e,t,n)=>{"use strict";!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=n(7004)},7950:(e,t,n)=>{"use strict";!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=n(6672)},2799:(e,t)=>{"use strict";var n=Symbol.for("react.transitional.element"),o=Symbol.for("react.fragment");function r(e,t,o){var r=null;if(void 0!==o&&(r=""+o),void 0!==t.key&&(r=""+t.key),"key"in t)for(var i in o={},t)"key"!==i&&(o[i]=t[i]);else o=t;return t=o.ref,{$$typeof:n,type:e,key:r,ref:void 0!==t?t:null,props:o}}t.Fragment=o,t.jsx=r,t.jsxs=r},4288:(e,t)=>{"use strict";var n=Symbol.for("react.transitional.element"),o=Symbol.for("react.portal"),r=Symbol.for("react.fragment"),i=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),a=Symbol.for("react.consumer"),l=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),d=Symbol.for("react.suspense"),u=Symbol.for("react.memo"),h=Symbol.for("react.lazy"),p=Symbol.iterator;var f={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},g=Object.assign,m={};function y(e,t,n){this.props=e,this.context=t,this.refs=m,this.updater=n||f}function v(){}function b(e,t,n){this.props=e,this.context=t,this.refs=m,this.updater=n||f}y.prototype.isReactComponent={},y.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},y.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},v.prototype=y.prototype;var w=b.prototype=new v;w.constructor=b,g(w,y.prototype),w.isPureReactComponent=!0;var x=Array.isArray,S={H:null,A:null,T:null,S:null},k=Object.prototype.hasOwnProperty;function P(e,t,o,r,i,s){return o=s.ref,{$$typeof:n,type:e,key:t,ref:void 0!==o?o:null,props:s}}function C(e){return"object"===typeof e&&null!==e&&e.$$typeof===n}var _=/\/+/g;function I(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,(function(e){return t[e]}))}(""+e.key):t.toString(36)}function E(){}function j(e,t,r,i,s){var a=typeof e;"undefined"!==a&&"boolean"!==a||(e=null);var l,c,d=!1;if(null===e)d=!0;else switch(a){case"bigint":case"string":case"number":d=!0;break;case"object":switch(e.$$typeof){case n:case o:d=!0;break;case h:return j((d=e._init)(e._payload),t,r,i,s)}}if(d)return s=s(e),d=""===i?"."+I(e,0):i,x(s)?(r="",null!=d&&(r=d.replace(_,"$&/")+"/"),j(s,t,r,"",(function(e){return e}))):null!=s&&(C(s)&&(l=s,c=r+(null==s.key||e&&e.key===s.key?"":(""+s.key).replace(_,"$&/")+"/")+d,s=P(l.type,c,void 0,0,0,l.props)),t.push(s)),1;d=0;var u,f=""===i?".":i+":";if(x(e))for(var g=0;g<e.length;g++)d+=j(i=e[g],t,r,a=f+I(i,g),s);else if("function"===typeof(g=null===(u=e)||"object"!==typeof u?null:"function"===typeof(u=p&&u[p]||u["@@iterator"])?u:null))for(e=g.call(e),g=0;!(i=e.next()).done;)d+=j(i=i.value,t,r,a=f+I(i,g++),s);else if("object"===a){if("function"===typeof e.then)return j(function(e){switch(e.status){case"fulfilled":return e.value;case"rejected":throw e.reason;default:switch("string"===typeof e.status?e.then(E,E):(e.status="pending",e.then((function(t){"pending"===e.status&&(e.status="fulfilled",e.value=t)}),(function(t){"pending"===e.status&&(e.status="rejected",e.reason=t)}))),e.status){case"fulfilled":return e.value;case"rejected":throw e.reason}}throw e}(e),t,r,i,s);throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.")}return d}function T(e,t,n){if(null==e)return e;var o=[],r=0;return j(e,o,"","",(function(e){return t.call(n,e,r++)})),o}function M(e){if(-1===e._status){var t=e._result;(t=t()).then((function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)}),(function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)})),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var A="function"===typeof reportError?reportError:function(e){if("object"===typeof window&&"function"===typeof window.ErrorEvent){var t=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:"object"===typeof e&&null!==e&&"string"===typeof e.message?String(e.message):String(e),error:e});if(!window.dispatchEvent(t))return}else if("object"===typeof process&&"function"===typeof process.emit)return void process.emit("uncaughtException",e);console.error(e)};function O(){}t.Children={map:T,forEach:function(e,t,n){T(e,(function(){t.apply(this,arguments)}),n)},count:function(e){var t=0;return T(e,(function(){t++})),t},toArray:function(e){return T(e,(function(e){return e}))||[]},only:function(e){if(!C(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=y,t.Fragment=r,t.Profiler=s,t.PureComponent=b,t.StrictMode=i,t.Suspense=d,t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=S,t.act=function(){throw Error("act(...) is not supported in production builds of React.")},t.cache=function(e){return function(){return e.apply(null,arguments)}},t.cloneElement=function(e,t,n){if(null===e||void 0===e)throw Error("The argument must be a React element, but you passed "+e+".");var o=g({},e.props),r=e.key;if(null!=t)for(i in void 0!==t.ref&&void 0,void 0!==t.key&&(r=""+t.key),t)!k.call(t,i)||"key"===i||"__self"===i||"__source"===i||"ref"===i&&void 0===t.ref||(o[i]=t[i]);var i=arguments.length-2;if(1===i)o.children=n;else if(1<i){for(var s=Array(i),a=0;a<i;a++)s[a]=arguments[a+2];o.children=s}return P(e.type,r,void 0,0,0,o)},t.createContext=function(e){return(e={$$typeof:l,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null}).Provider=e,e.Consumer={$$typeof:a,_context:e},e},t.createElement=function(e,t,n){var o,r={},i=null;if(null!=t)for(o in void 0!==t.key&&(i=""+t.key),t)k.call(t,o)&&"key"!==o&&"__self"!==o&&"__source"!==o&&(r[o]=t[o]);var s=arguments.length-2;if(1===s)r.children=n;else if(1<s){for(var a=Array(s),l=0;l<s;l++)a[l]=arguments[l+2];r.children=a}if(e&&e.defaultProps)for(o in s=e.defaultProps)void 0===r[o]&&(r[o]=s[o]);return P(e,i,void 0,0,0,r)},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:c,render:e}},t.isValidElement=C,t.lazy=function(e){return{$$typeof:h,_payload:{_status:-1,_result:e},_init:M}},t.memo=function(e,t){return{$$typeof:u,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=S.T,n={};S.T=n;try{var o=e(),r=S.S;null!==r&&r(n,o),"object"===typeof o&&null!==o&&"function"===typeof o.then&&o.then(O,A)}catch(i){A(i)}finally{S.T=t}},t.unstable_useCacheRefresh=function(){return S.H.useCacheRefresh()},t.use=function(e){return S.H.use(e)},t.useActionState=function(e,t,n){return S.H.useActionState(e,t,n)},t.useCallback=function(e,t){return S.H.useCallback(e,t)},t.useContext=function(e){return S.H.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e,t){return S.H.useDeferredValue(e,t)},t.useEffect=function(e,t){return S.H.useEffect(e,t)},t.useId=function(){return S.H.useId()},t.useImperativeHandle=function(e,t,n){return S.H.useImperativeHandle(e,t,n)},t.useInsertionEffect=function(e,t){return S.H.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return S.H.useLayoutEffect(e,t)},t.useMemo=function(e,t){return S.H.useMemo(e,t)},t.useOptimistic=function(e,t){return S.H.useOptimistic(e,t)},t.useReducer=function(e,t,n){return S.H.useReducer(e,t,n)},t.useRef=function(e){return S.H.useRef(e)},t.useState=function(e){return S.H.useState(e)},t.useSyncExternalStore=function(e,t,n){return S.H.useSyncExternalStore(e,t,n)},t.useTransition=function(){return S.H.useTransition()},t.version="19.0.0"},5043:(e,t,n)=>{"use strict";e.exports=n(4288)},579:(e,t,n)=>{"use strict";e.exports=n(2799)},5896:(e,t)=>{"use strict";function n(e,t){var n=e.length;e.push(t);e:for(;0<n;){var o=n-1>>>1,r=e[o];if(!(0<i(r,t)))break e;e[o]=t,e[n]=r,n=o}}function o(e){return 0===e.length?null:e[0]}function r(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var o=0,r=e.length,s=r>>>1;o<s;){var a=2*(o+1)-1,l=e[a],c=a+1,d=e[c];if(0>i(l,n))c<r&&0>i(d,l)?(e[o]=d,e[c]=n,o=c):(e[o]=l,e[a]=n,o=a);else{if(!(c<r&&0>i(d,n)))break e;e[o]=d,e[c]=n,o=c}}}return t}function i(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if(t.unstable_now=void 0,"object"===typeof performance&&"function"===typeof performance.now){var s=performance;t.unstable_now=function(){return s.now()}}else{var a=Date,l=a.now();t.unstable_now=function(){return a.now()-l}}var c=[],d=[],u=1,h=null,p=3,f=!1,g=!1,m=!1,y="function"===typeof setTimeout?setTimeout:null,v="function"===typeof clearTimeout?clearTimeout:null,b="undefined"!==typeof setImmediate?setImmediate:null;function w(e){for(var t=o(d);null!==t;){if(null===t.callback)r(d);else{if(!(t.startTime<=e))break;r(d),t.sortIndex=t.expirationTime,n(c,t)}t=o(d)}}function x(e){if(m=!1,w(e),!g)if(null!==o(c))g=!0,M();else{var t=o(d);null!==t&&A(x,t.startTime-e)}}var S,k=!1,P=-1,C=5,_=-1;function I(){return!(t.unstable_now()-_<C)}function E(){if(k){var e=t.unstable_now();_=e;var n=!0;try{e:{g=!1,m&&(m=!1,v(P),P=-1),f=!0;var i=p;try{t:{for(w(e),h=o(c);null!==h&&!(h.expirationTime>e&&I());){var s=h.callback;if("function"===typeof s){h.callback=null,p=h.priorityLevel;var a=s(h.expirationTime<=e);if(e=t.unstable_now(),"function"===typeof a){h.callback=a,w(e),n=!0;break t}h===o(c)&&r(c),w(e)}else r(c);h=o(c)}if(null!==h)n=!0;else{var l=o(d);null!==l&&A(x,l.startTime-e),n=!1}}break e}finally{h=null,p=i,f=!1}n=void 0}}finally{n?S():k=!1}}}if("function"===typeof b)S=function(){b(E)};else if("undefined"!==typeof MessageChannel){var j=new MessageChannel,T=j.port2;j.port1.onmessage=E,S=function(){T.postMessage(null)}}else S=function(){y(E,0)};function M(){k||(k=!0,S())}function A(e,n){P=y((function(){e(t.unstable_now())}),n)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){g||f||(g=!0,M())},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):C=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return p},t.unstable_getFirstCallbackNode=function(){return o(c)},t.unstable_next=function(e){switch(p){case 1:case 2:case 3:var t=3;break;default:t=p}var n=p;p=t;try{return e()}finally{p=n}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=p;p=e;try{return t()}finally{p=n}},t.unstable_scheduleCallback=function(e,r,i){var s=t.unstable_now();switch("object"===typeof i&&null!==i?i="number"===typeof(i=i.delay)&&0<i?s+i:s:i=s,e){case 1:var a=-1;break;case 2:a=250;break;case 5:a=1073741823;break;case 4:a=1e4;break;default:a=5e3}return e={id:u++,callback:r,priorityLevel:e,startTime:i,expirationTime:a=i+a,sortIndex:-1},i>s?(e.sortIndex=i,n(d,e),null===o(c)&&e===o(d)&&(m?(v(P),P=-1):m=!0,A(x,i-s))):(e.sortIndex=a,n(c,e),g||f||(g=!0,M())),e},t.unstable_shouldYield=I,t.unstable_wrapCallback=function(e){var t=p;return function(){var n=p;p=t;try{return e.apply(this,arguments)}finally{p=n}}}},8853:(e,t,n)=>{"use strict";e.exports=n(5896)},8139:(e,t)=>{var n;!function(){"use strict";var o={}.hasOwnProperty;function r(){for(var e="",t=0;t<arguments.length;t++){var n=arguments[t];n&&(e=s(e,i(n)))}return e}function i(e){if("string"===typeof e||"number"===typeof e)return e;if("object"!==typeof e)return"";if(Array.isArray(e))return r.apply(null,e);if(e.toString!==Object.prototype.toString&&!e.toString.toString().includes("[native code]"))return e.toString();var t="";for(var n in e)o.call(e,n)&&e[n]&&(t=s(t,n));return t}function s(e,t){return t?e?e+" "+t:e+t:e}e.exports?(r.default=r,e.exports=r):void 0===(n=function(){return r}.apply(t,[]))||(e.exports=n)}()},1239:(e,t,n)=>{"use strict";var o=n(4706),r=n(5464),i=TypeError;e.exports=function(e){if(o(e))return e;throw new i(r(e)+" is not a function")}},3348:(e,t,n)=>{"use strict";var o=n(4352),r=n(6115),i=n(3572).f,s=o("unscopables"),a=Array.prototype;void 0===a[s]&&i(a,s,{configurable:!0,value:r(null)}),e.exports=function(e){a[s][e]=!0}},880:(e,t,n)=>{"use strict";var o=n(7398).charAt;e.exports=function(e,t,n){return t+(n?o(e,t).length:1)}},1608:(e,t,n)=>{"use strict";var o=n(6821),r=String,i=TypeError;e.exports=function(e){if(o(e))return e;throw new i(r(e)+" is not an object")}},972:(e,t,n)=>{"use strict";var o=n(6774),r=n(2201),i=n(1591),s=function(e){return function(t,n,s){var a=o(t),l=i(a);if(0===l)return!e&&-1;var c,d=r(s,l);if(e&&n!==n){for(;l>d;)if((c=a[d++])!==c)return!0}else for(;l>d;d++)if((e||d in a)&&a[d]===n)return e||d||0;return!e&&-1}};e.exports={includes:s(!0),indexOf:s(!1)}},2530:(e,t,n)=>{"use strict";var o=n(4553),r=n(1012),i=n(6821),s=n(4352)("species"),a=Array;e.exports=function(e){var t;return o(e)&&(t=e.constructor,(r(t)&&(t===a||o(t.prototype))||i(t)&&null===(t=t[s]))&&(t=void 0)),void 0===t?a:t}},5184:(e,t,n)=>{"use strict";var o=n(2530);e.exports=function(e,t){return new(o(e))(0===t?0:t)}},5687:(e,t,n)=>{"use strict";var o=n(7707),r=o({}.toString),i=o("".slice);e.exports=function(e){return i(r(e),8,-1)}},7972:(e,t,n)=>{"use strict";var o=n(1415),r=n(4706),i=n(5687),s=n(4352)("toStringTag"),a=Object,l="Arguments"===i(function(){return arguments}());e.exports=o?i:function(e){var t,n,o;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=function(e,t){try{return e[t]}catch(n){}}(t=a(e),s))?n:l?i(t):"Object"===(o=i(t))&&r(t.callee)?"Arguments":o}},5555:(e,t,n)=>{"use strict";var o=n(6164),r=n(2682),i=n(5214),s=n(3572);e.exports=function(e,t,n){for(var a=r(t),l=s.f,c=i.f,d=0;d<a.length;d++){var u=a[d];o(e,u)||n&&o(n,u)||l(e,u,c(t,u))}}},9266:(e,t,n)=>{"use strict";var o=n(9519),r=n(3572),i=n(6369);e.exports=o?function(e,t,n){return r.f(e,t,i(1,n))}:function(e,t,n){return e[t]=n,e}},6369:e=>{"use strict";e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},5551:(e,t,n)=>{"use strict";var o=n(4706),r=n(3572),i=n(4416),s=n(3036);e.exports=function(e,t,n,a){a||(a={});var l=a.enumerable,c=void 0!==a.name?a.name:t;if(o(n)&&i(n,c,a),a.global)l?e[t]=n:s(t,n);else{try{a.unsafe?e[t]&&(l=!0):delete e[t]}catch(d){}l?e[t]=n:r.f(e,t,{value:n,enumerable:!1,configurable:!a.nonConfigurable,writable:!a.nonWritable})}return e}},3036:(e,t,n)=>{"use strict";var o=n(4823),r=Object.defineProperty;e.exports=function(e,t){try{r(o,e,{value:t,configurable:!0,writable:!0})}catch(n){o[e]=t}return t}},9519:(e,t,n)=>{"use strict";var o=n(8084);e.exports=!o((function(){return 7!==Object.defineProperty({},1,{get:function(){return 7}})[1]}))},2760:(e,t,n)=>{"use strict";var o=n(4823),r=n(6821),i=o.document,s=r(i)&&r(i.createElement);e.exports=function(e){return s?i.createElement(e):{}}},1520:e=>{"use strict";var t=TypeError;e.exports=function(e){if(e>9007199254740991)throw t("Maximum allowed index exceeded");return e}},4291:e=>{"use strict";e.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},498:(e,t,n)=>{"use strict";var o=n(4823).navigator,r=o&&o.userAgent;e.exports=r?String(r):""},166:(e,t,n)=>{"use strict";var o,r,i=n(4823),s=n(498),a=i.process,l=i.Deno,c=a&&a.versions||l&&l.version,d=c&&c.v8;d&&(r=(o=d.split("."))[0]>0&&o[0]<4?1:+(o[0]+o[1])),!r&&s&&(!(o=s.match(/Edge\/(\d+)/))||o[1]>=74)&&(o=s.match(/Chrome\/(\d+)/))&&(r=+o[1]),e.exports=r},6715:(e,t,n)=>{"use strict";var o=n(4823),r=n(5214).f,i=n(9266),s=n(5551),a=n(3036),l=n(5555),c=n(6079);e.exports=function(e,t){var n,d,u,h,p,f=e.target,g=e.global,m=e.stat;if(n=g?o:m?o[f]||a(f,{}):o[f]&&o[f].prototype)for(d in t){if(h=t[d],u=e.dontCallGetSet?(p=r(n,d))&&p.value:n[d],!c(g?d:f+(m?".":"#")+d,e.forced)&&void 0!==u){if(typeof h==typeof u)continue;l(h,u)}(e.sham||u&&u.sham)&&i(h,"sham",!0),s(n,d,h,e)}}},8084:e=>{"use strict";e.exports=function(e){try{return!!e()}catch(t){return!0}}},3589:(e,t,n)=>{"use strict";n(1054);var o=n(4850),r=n(5551),i=n(1180),s=n(8084),a=n(4352),l=n(9266),c=a("species"),d=RegExp.prototype;e.exports=function(e,t,n,u){var h=a(e),p=!s((function(){var t={};return t[h]=function(){return 7},7!==""[e](t)})),f=p&&!s((function(){var t=!1,n=/a/;return"split"===e&&((n={}).constructor={},n.constructor[c]=function(){return n},n.flags="",n[h]=/./[h]),n.exec=function(){return t=!0,null},n[h](""),!t}));if(!p||!f||n){var g=/./[h],m=t(h,""[e],(function(e,t,n,r,s){var a=t.exec;return a===i||a===d.exec?p&&!s?{done:!0,value:o(g,t,n,r)}:{done:!0,value:o(e,n,t,r)}:{done:!1}}));r(String.prototype,e,m[0]),r(d,h,m[1])}u&&l(d[h],"sham",!0)}},9406:(e,t,n)=>{"use strict";var o=n(4553),r=n(1591),i=n(1520),s=n(9055),a=function(e,t,n,l,c,d,u,h){for(var p,f,g=c,m=0,y=!!u&&s(u,h);m<l;)m in n&&(p=y?y(n[m],m,t):n[m],d>0&&o(p)?(f=r(p),g=a(e,t,p,f,g,d-1)-1):(i(g+1),e[g]=p),g++),m++;return g};e.exports=a},6464:(e,t,n)=>{"use strict";var o=n(5897),r=Function.prototype,i=r.apply,s=r.call;e.exports="object"==typeof Reflect&&Reflect.apply||(o?s.bind(i):function(){return s.apply(i,arguments)})},9055:(e,t,n)=>{"use strict";var o=n(8097),r=n(1239),i=n(5897),s=o(o.bind);e.exports=function(e,t){return r(e),void 0===t?e:i?s(e,t):function(){return e.apply(t,arguments)}}},5897:(e,t,n)=>{"use strict";var o=n(8084);e.exports=!o((function(){var e=function(){}.bind();return"function"!=typeof e||e.hasOwnProperty("prototype")}))},4850:(e,t,n)=>{"use strict";var o=n(5897),r=Function.prototype.call;e.exports=o?r.bind(r):function(){return r.apply(r,arguments)}},2345:(e,t,n)=>{"use strict";var o=n(9519),r=n(6164),i=Function.prototype,s=o&&Object.getOwnPropertyDescriptor,a=r(i,"name"),l=a&&"something"===function(){}.name,c=a&&(!o||o&&s(i,"name").configurable);e.exports={EXISTS:a,PROPER:l,CONFIGURABLE:c}},8097:(e,t,n)=>{"use strict";var o=n(5687),r=n(7707);e.exports=function(e){if("Function"===o(e))return r(e)}},7707:(e,t,n)=>{"use strict";var o=n(5897),r=Function.prototype,i=r.call,s=o&&r.bind.bind(i,i);e.exports=o?s:function(e){return function(){return i.apply(e,arguments)}}},3542:(e,t,n)=>{"use strict";var o=n(4823),r=n(4706);e.exports=function(e,t){return arguments.length<2?(n=o[e],r(n)?n:void 0):o[e]&&o[e][t];var n}},7151:(e,t,n)=>{"use strict";var o=n(1239),r=n(3192);e.exports=function(e,t){var n=e[t];return r(n)?void 0:o(n)}},6207:(e,t,n)=>{"use strict";var o=n(7707),r=n(2522),i=Math.floor,s=o("".charAt),a=o("".replace),l=o("".slice),c=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,d=/\$([$&'`]|\d{1,2})/g;e.exports=function(e,t,n,o,u,h){var p=n+e.length,f=o.length,g=d;return void 0!==u&&(u=r(u),g=c),a(h,g,(function(r,a){var c;switch(s(a,0)){case"$":return"$";case"&":return e;case"`":return l(t,0,n);case"'":return l(t,p);case"<":c=u[l(a,1,-1)];break;default:var d=+a;if(0===d)return r;if(d>f){var h=i(d/10);return 0===h?r:h<=f?void 0===o[h-1]?s(a,1):o[h-1]+s(a,1):r}c=o[d-1]}return void 0===c?"":c}))}},4823:function(e,t,n){"use strict";var o=function(e){return e&&e.Math===Math&&e};e.exports=o("object"==typeof globalThis&&globalThis)||o("object"==typeof window&&window)||o("object"==typeof self&&self)||o("object"==typeof n.g&&n.g)||o("object"==typeof this&&this)||function(){return this}()||Function("return this")()},6164:(e,t,n)=>{"use strict";var o=n(7707),r=n(2522),i=o({}.hasOwnProperty);e.exports=Object.hasOwn||function(e,t){return i(r(e),t)}},3114:e=>{"use strict";e.exports={}},904:(e,t,n)=>{"use strict";var o=n(3542);e.exports=o("document","documentElement")},9704:(e,t,n)=>{"use strict";var o=n(9519),r=n(8084),i=n(2760);e.exports=!o&&!r((function(){return 7!==Object.defineProperty(i("div"),"a",{get:function(){return 7}}).a}))},1178:(e,t,n)=>{"use strict";var o=n(7707),r=n(8084),i=n(5687),s=Object,a=o("".split);e.exports=r((function(){return!s("z").propertyIsEnumerable(0)}))?function(e){return"String"===i(e)?a(e,""):s(e)}:s},5167:(e,t,n)=>{"use strict";var o=n(7707),r=n(4706),i=n(5704),s=o(Function.toString);r(i.inspectSource)||(i.inspectSource=function(e){return s(e)}),e.exports=i.inspectSource},2428:(e,t,n)=>{"use strict";var o,r,i,s=n(9279),a=n(4823),l=n(6821),c=n(9266),d=n(6164),u=n(5704),h=n(4658),p=n(3114),f="Object already initialized",g=a.TypeError,m=a.WeakMap;if(s||u.state){var y=u.state||(u.state=new m);y.get=y.get,y.has=y.has,y.set=y.set,o=function(e,t){if(y.has(e))throw new g(f);return t.facade=e,y.set(e,t),t},r=function(e){return y.get(e)||{}},i=function(e){return y.has(e)}}else{var v=h("state");p[v]=!0,o=function(e,t){if(d(e,v))throw new g(f);return t.facade=e,c(e,v,t),t},r=function(e){return d(e,v)?e[v]:{}},i=function(e){return d(e,v)}}e.exports={set:o,get:r,has:i,enforce:function(e){return i(e)?r(e):o(e,{})},getterFor:function(e){return function(t){var n;if(!l(t)||(n=r(t)).type!==e)throw new g("Incompatible receiver, "+e+" required");return n}}}},4553:(e,t,n)=>{"use strict";var o=n(5687);e.exports=Array.isArray||function(e){return"Array"===o(e)}},4706:e=>{"use strict";var t="object"==typeof document&&document.all;e.exports="undefined"==typeof t&&void 0!==t?function(e){return"function"==typeof e||e===t}:function(e){return"function"==typeof e}},1012:(e,t,n)=>{"use strict";var o=n(7707),r=n(8084),i=n(4706),s=n(7972),a=n(3542),l=n(5167),c=function(){},d=a("Reflect","construct"),u=/^\s*(?:class|function)\b/,h=o(u.exec),p=!u.test(c),f=function(e){if(!i(e))return!1;try{return d(c,[],e),!0}catch(t){return!1}},g=function(e){if(!i(e))return!1;switch(s(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return p||!!h(u,l(e))}catch(t){return!0}};g.sham=!0,e.exports=!d||r((function(){var e;return f(f.call)||!f(Object)||!f((function(){e=!0}))||e}))?g:f},6079:(e,t,n)=>{"use strict";var o=n(8084),r=n(4706),i=/#|\.prototype\./,s=function(e,t){var n=l[a(e)];return n===d||n!==c&&(r(t)?o(t):!!t)},a=s.normalize=function(e){return String(e).replace(i,".").toLowerCase()},l=s.data={},c=s.NATIVE="N",d=s.POLYFILL="P";e.exports=s},3192:e=>{"use strict";e.exports=function(e){return null===e||void 0===e}},6821:(e,t,n)=>{"use strict";var o=n(4706);e.exports=function(e){return"object"==typeof e?null!==e:o(e)}},7592:e=>{"use strict";e.exports=!1},7970:(e,t,n)=>{"use strict";var o=n(3542),r=n(4706),i=n(6864),s=n(4111),a=Object;e.exports=s?function(e){return"symbol"==typeof e}:function(e){var t=o("Symbol");return r(t)&&i(t.prototype,a(e))}},1591:(e,t,n)=>{"use strict";var o=n(8249);e.exports=function(e){return o(e.length)}},4416:(e,t,n)=>{"use strict";var o=n(7707),r=n(8084),i=n(4706),s=n(6164),a=n(9519),l=n(2345).CONFIGURABLE,c=n(5167),d=n(2428),u=d.enforce,h=d.get,p=String,f=Object.defineProperty,g=o("".slice),m=o("".replace),y=o([].join),v=a&&!r((function(){return 8!==f((function(){}),"length",{value:8}).length})),b=String(String).split("String"),w=e.exports=function(e,t,n){"Symbol("===g(p(t),0,7)&&(t="["+m(p(t),/^Symbol\(([^)]*)\).*$/,"$1")+"]"),n&&n.getter&&(t="get "+t),n&&n.setter&&(t="set "+t),(!s(e,"name")||l&&e.name!==t)&&(a?f(e,"name",{value:t,configurable:!0}):e.name=t),v&&n&&s(n,"arity")&&e.length!==n.arity&&f(e,"length",{value:n.arity});try{n&&s(n,"constructor")&&n.constructor?a&&f(e,"prototype",{writable:!1}):e.prototype&&(e.prototype=void 0)}catch(r){}var o=u(e);return s(o,"source")||(o.source=y(b,"string"==typeof t?t:"")),e};Function.prototype.toString=w((function(){return i(this)&&h(this).source||c(this)}),"toString")},9344:e=>{"use strict";var t=Math.ceil,n=Math.floor;e.exports=Math.trunc||function(e){var o=+e;return(o>0?n:t)(o)}},6115:(e,t,n)=>{"use strict";var o,r=n(1608),i=n(8612),s=n(4291),a=n(3114),l=n(904),c=n(2760),d=n(4658),u="prototype",h="script",p=d("IE_PROTO"),f=function(){},g=function(e){return"<"+h+">"+e+"</"+h+">"},m=function(e){e.write(g("")),e.close();var t=e.parentWindow.Object;return e=null,t},y=function(){try{o=new ActiveXObject("htmlfile")}catch(t){}y="undefined"!=typeof document?document.domain&&o?m(o):function(){var e,t=c("iframe"),n="java"+h+":";return t.style.display="none",l.appendChild(t),t.src=String(n),(e=t.contentWindow.document).open(),e.write(g("document.F=Object")),e.close(),e.F}():m(o);for(var e=s.length;e--;)delete y[u][s[e]];return y()};a[p]=!0,e.exports=Object.create||function(e,t){var n;return null!==e?(f[u]=r(e),n=new f,f[u]=null,n[p]=e):n=y(),void 0===t?n:i.f(n,t)}},8612:(e,t,n)=>{"use strict";var o=n(9519),r=n(253),i=n(3572),s=n(1608),a=n(6774),l=n(1523);t.f=o&&!r?Object.defineProperties:function(e,t){s(e);for(var n,o=a(t),r=l(t),c=r.length,d=0;c>d;)i.f(e,n=r[d++],o[n]);return e}},3572:(e,t,n)=>{"use strict";var o=n(9519),r=n(9704),i=n(253),s=n(1608),a=n(3326),l=TypeError,c=Object.defineProperty,d=Object.getOwnPropertyDescriptor,u="enumerable",h="configurable",p="writable";t.f=o?i?function(e,t,n){if(s(e),t=a(t),s(n),"function"===typeof e&&"prototype"===t&&"value"in n&&p in n&&!n[p]){var o=d(e,t);o&&o[p]&&(e[t]=n.value,n={configurable:h in n?n[h]:o[h],enumerable:u in n?n[u]:o[u],writable:!1})}return c(e,t,n)}:c:function(e,t,n){if(s(e),t=a(t),s(n),r)try{return c(e,t,n)}catch(o){}if("get"in n||"set"in n)throw new l("Accessors not supported");return"value"in n&&(e[t]=n.value),e}},5214:(e,t,n)=>{"use strict";var o=n(9519),r=n(4850),i=n(4022),s=n(6369),a=n(6774),l=n(3326),c=n(6164),d=n(9704),u=Object.getOwnPropertyDescriptor;t.f=o?u:function(e,t){if(e=a(e),t=l(t),d)try{return u(e,t)}catch(n){}if(c(e,t))return s(!r(i.f,e,t),e[t])}},7251:(e,t,n)=>{"use strict";var o=n(4061),r=n(4291).concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return o(e,r)}},6842:(e,t)=>{"use strict";t.f=Object.getOwnPropertySymbols},6864:(e,t,n)=>{"use strict";var o=n(7707);e.exports=o({}.isPrototypeOf)},4061:(e,t,n)=>{"use strict";var o=n(7707),r=n(6164),i=n(6774),s=n(972).indexOf,a=n(3114),l=o([].push);e.exports=function(e,t){var n,o=i(e),c=0,d=[];for(n in o)!r(a,n)&&r(o,n)&&l(d,n);for(;t.length>c;)r(o,n=t[c++])&&(~s(d,n)||l(d,n));return d}},1523:(e,t,n)=>{"use strict";var o=n(4061),r=n(4291);e.exports=Object.keys||function(e){return o(e,r)}},4022:(e,t)=>{"use strict";var n={}.propertyIsEnumerable,o=Object.getOwnPropertyDescriptor,r=o&&!n.call({1:2},1);t.f=r?function(e){var t=o(this,e);return!!t&&t.enumerable}:n},2509:(e,t,n)=>{"use strict";var o=n(4850),r=n(4706),i=n(6821),s=TypeError;e.exports=function(e,t){var n,a;if("string"===t&&r(n=e.toString)&&!i(a=o(n,e)))return a;if(r(n=e.valueOf)&&!i(a=o(n,e)))return a;if("string"!==t&&r(n=e.toString)&&!i(a=o(n,e)))return a;throw new s("Can't convert object to primitive value")}},2682:(e,t,n)=>{"use strict";var o=n(3542),r=n(7707),i=n(7251),s=n(6842),a=n(1608),l=r([].concat);e.exports=o("Reflect","ownKeys")||function(e){var t=i.f(a(e)),n=s.f;return n?l(t,n(e)):t}},1107:(e,t,n)=>{"use strict";var o=n(4850),r=n(1608),i=n(4706),s=n(5687),a=n(1180),l=TypeError;e.exports=function(e,t){var n=e.exec;if(i(n)){var c=o(n,e,t);return null!==c&&r(c),c}if("RegExp"===s(e))return o(a,e,t);throw new l("RegExp#exec called on incompatible receiver")}},1180:(e,t,n)=>{"use strict";var o=n(4850),r=n(7707),i=n(4776),s=n(9550),a=n(3198),l=n(816),c=n(6115),d=n(2428).get,u=n(3118),h=n(9547),p=l("native-string-replace",String.prototype.replace),f=RegExp.prototype.exec,g=f,m=r("".charAt),y=r("".indexOf),v=r("".replace),b=r("".slice),w=function(){var e=/a/,t=/b*/g;return o(f,e,"a"),o(f,t,"a"),0!==e.lastIndex||0!==t.lastIndex}(),x=a.BROKEN_CARET,S=void 0!==/()??/.exec("")[1];(w||S||x||u||h)&&(g=function(e){var t,n,r,a,l,u,h,k=this,P=d(k),C=i(e),_=P.raw;if(_)return _.lastIndex=k.lastIndex,t=o(g,_,C),k.lastIndex=_.lastIndex,t;var I=P.groups,E=x&&k.sticky,j=o(s,k),T=k.source,M=0,A=C;if(E&&(j=v(j,"y",""),-1===y(j,"g")&&(j+="g"),A=b(C,k.lastIndex),k.lastIndex>0&&(!k.multiline||k.multiline&&"\n"!==m(C,k.lastIndex-1))&&(T="(?: "+T+")",A=" "+A,M++),n=new RegExp("^(?:"+T+")",j)),S&&(n=new RegExp("^"+T+"$(?!\\s)",j)),w&&(r=k.lastIndex),a=o(f,E?n:k,A),E?a?(a.input=b(a.input,M),a[0]=b(a[0],M),a.index=k.lastIndex,k.lastIndex+=a[0].length):k.lastIndex=0:w&&a&&(k.lastIndex=k.global?a.index+a[0].length:r),S&&a&&a.length>1&&o(p,a[0],n,(function(){for(l=1;l<arguments.length-2;l++)void 0===arguments[l]&&(a[l]=void 0)})),a&&I)for(a.groups=u=c(null),l=0;l<I.length;l++)u[(h=I[l])[0]]=a[h[1]];return a}),e.exports=g},9550:(e,t,n)=>{"use strict";var o=n(1608);e.exports=function(){var e=o(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t}},3198:(e,t,n)=>{"use strict";var o=n(8084),r=n(4823).RegExp,i=o((function(){var e=r("a","y");return e.lastIndex=2,null!==e.exec("abcd")})),s=i||o((function(){return!r("a","y").sticky})),a=i||o((function(){var e=r("^r","gy");return e.lastIndex=2,null!==e.exec("str")}));e.exports={BROKEN_CARET:a,MISSED_STICKY:s,UNSUPPORTED_Y:i}},3118:(e,t,n)=>{"use strict";var o=n(8084),r=n(4823).RegExp;e.exports=o((function(){var e=r(".","s");return!(e.dotAll&&e.test("\n")&&"s"===e.flags)}))},9547:(e,t,n)=>{"use strict";var o=n(8084),r=n(4823).RegExp;e.exports=o((function(){var e=r("(?<a>b)","g");return"b"!==e.exec("b").groups.a||"bc"!=="b".replace(e,"$<a>c")}))},327:(e,t,n)=>{"use strict";var o=n(3192),r=TypeError;e.exports=function(e){if(o(e))throw new r("Can't call method on "+e);return e}},4658:(e,t,n)=>{"use strict";var o=n(816),r=n(7899),i=o("keys");e.exports=function(e){return i[e]||(i[e]=r(e))}},5704:(e,t,n)=>{"use strict";var o=n(7592),r=n(4823),i=n(3036),s="__core-js_shared__",a=e.exports=r[s]||i(s,{});(a.versions||(a.versions=[])).push({version:"3.39.0",mode:o?"pure":"global",copyright:"\xa9 2014-2024 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.39.0/LICENSE",source:"https://github.com/zloirock/core-js"})},816:(e,t,n)=>{"use strict";var o=n(5704);e.exports=function(e,t){return o[e]||(o[e]=t||{})}},7398:(e,t,n)=>{"use strict";var o=n(7707),r=n(466),i=n(4776),s=n(327),a=o("".charAt),l=o("".charCodeAt),c=o("".slice),d=function(e){return function(t,n){var o,d,u=i(s(t)),h=r(n),p=u.length;return h<0||h>=p?e?"":void 0:(o=l(u,h))<55296||o>56319||h+1===p||(d=l(u,h+1))<56320||d>57343?e?a(u,h):o:e?c(u,h,h+2):d-56320+(o-55296<<10)+65536}};e.exports={codeAt:d(!1),charAt:d(!0)}},4030:(e,t,n)=>{"use strict";var o=n(166),r=n(8084),i=n(4823).String;e.exports=!!Object.getOwnPropertySymbols&&!r((function(){var e=Symbol("symbol detection");return!i(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&o&&o<41}))},2201:(e,t,n)=>{"use strict";var o=n(466),r=Math.max,i=Math.min;e.exports=function(e,t){var n=o(e);return n<0?r(n+t,0):i(n,t)}},6774:(e,t,n)=>{"use strict";var o=n(1178),r=n(327);e.exports=function(e){return o(r(e))}},466:(e,t,n)=>{"use strict";var o=n(9344);e.exports=function(e){var t=+e;return t!==t||0===t?0:o(t)}},8249:(e,t,n)=>{"use strict";var o=n(466),r=Math.min;e.exports=function(e){var t=o(e);return t>0?r(t,9007199254740991):0}},2522:(e,t,n)=>{"use strict";var o=n(327),r=Object;e.exports=function(e){return r(o(e))}},9140:(e,t,n)=>{"use strict";var o=n(4850),r=n(6821),i=n(7970),s=n(7151),a=n(2509),l=n(4352),c=TypeError,d=l("toPrimitive");e.exports=function(e,t){if(!r(e)||i(e))return e;var n,l=s(e,d);if(l){if(void 0===t&&(t="default"),n=o(l,e,t),!r(n)||i(n))return n;throw new c("Can't convert object to primitive value")}return void 0===t&&(t="number"),a(e,t)}},3326:(e,t,n)=>{"use strict";var o=n(9140),r=n(7970);e.exports=function(e){var t=o(e,"string");return r(t)?t:t+""}},1415:(e,t,n)=>{"use strict";var o={};o[n(4352)("toStringTag")]="z",e.exports="[object z]"===String(o)},4776:(e,t,n)=>{"use strict";var o=n(7972),r=String;e.exports=function(e){if("Symbol"===o(e))throw new TypeError("Cannot convert a Symbol value to a string");return r(e)}},5464:e=>{"use strict";var t=String;e.exports=function(e){try{return t(e)}catch(n){return"Object"}}},7899:(e,t,n)=>{"use strict";var o=n(7707),r=0,i=Math.random(),s=o(1..toString);e.exports=function(e){return"Symbol("+(void 0===e?"":e)+")_"+s(++r+i,36)}},4111:(e,t,n)=>{"use strict";var o=n(4030);e.exports=o&&!Symbol.sham&&"symbol"==typeof Symbol.iterator},253:(e,t,n)=>{"use strict";var o=n(9519),r=n(8084);e.exports=o&&r((function(){return 42!==Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype}))},9279:(e,t,n)=>{"use strict";var o=n(4823),r=n(4706),i=o.WeakMap;e.exports=r(i)&&/native code/.test(String(i))},4352:(e,t,n)=>{"use strict";var o=n(4823),r=n(816),i=n(6164),s=n(7899),a=n(4030),l=n(4111),c=o.Symbol,d=r("wks"),u=l?c.for||c:c&&c.withoutSetter||s;e.exports=function(e){return i(d,e)||(d[e]=a&&i(c,e)?c[e]:u("Symbol."+e)),d[e]}},1837:(e,t,n)=>{"use strict";var o=n(6715),r=n(9406),i=n(1239),s=n(2522),a=n(1591),l=n(5184);o({target:"Array",proto:!0},{flatMap:function(e){var t,n=s(this),o=a(n);return i(e),(t=l(n,0)).length=r(t,n,n,o,0,1,e,arguments.length>1?arguments[1]:void 0),t}})},4234:(e,t,n)=>{"use strict";var o=n(6715),r=n(9406),i=n(2522),s=n(1591),a=n(466),l=n(5184);o({target:"Array",proto:!0},{flat:function(){var e=arguments.length?arguments[0]:void 0,t=i(this),n=s(t),o=l(t,0);return o.length=r(o,t,t,n,0,void 0===e?1:a(e)),o}})},9494:(e,t,n)=>{"use strict";n(3348)("flatMap")},1001:(e,t,n)=>{"use strict";n(3348)("flat")},1054:(e,t,n)=>{"use strict";var o=n(6715),r=n(1180);o({target:"RegExp",proto:!0,forced:/./.exec!==r},{exec:r})},483:(e,t,n)=>{"use strict";var o=n(6464),r=n(4850),i=n(7707),s=n(3589),a=n(8084),l=n(1608),c=n(4706),d=n(3192),u=n(466),h=n(8249),p=n(4776),f=n(327),g=n(880),m=n(7151),y=n(6207),v=n(1107),b=n(4352)("replace"),w=Math.max,x=Math.min,S=i([].concat),k=i([].push),P=i("".indexOf),C=i("".slice),_="$0"==="a".replace(/./,"$0"),I=!!/./[b]&&""===/./[b]("a","$0");s("replace",(function(e,t,n){var i=I?"$":"$0";return[function(e,n){var o=f(this),i=d(e)?void 0:m(e,b);return i?r(i,e,o,n):r(t,p(o),e,n)},function(e,r){var s=l(this),a=p(e);if("string"==typeof r&&-1===P(r,i)&&-1===P(r,"$<")){var d=n(t,s,a,r);if(d.done)return d.value}var f=c(r);f||(r=p(r));var m,b=s.global;b&&(m=s.unicode,s.lastIndex=0);for(var _,I=[];null!==(_=v(s,a))&&(k(I,_),b);){""===p(_[0])&&(s.lastIndex=g(a,h(s.lastIndex),m))}for(var E,j="",T=0,M=0;M<I.length;M++){for(var A,O=p((_=I[M])[0]),D=w(x(u(_.index),a.length),0),R=[],L=1;L<_.length;L++)k(R,void 0===(E=_[L])?E:String(E));var z=_.groups;if(f){var N=S([O],R,D,a);void 0!==z&&k(N,z),A=p(o(r,void 0,N))}else A=y(O,a,D,R,z,r);D>=T&&(j+=C(a,T,D)+A,T=D+O.length)}return j+C(a,T)}]}),!!a((function(){var e=/./;return e.exec=function(){var e=[];return e.groups={a:"7"},e},"7"!=="".replace(e,"$<a>")}))||!_||I)}},t={};function n(o){var r=t[o];if(void 0!==r)return r.exports;var i=t[o]={id:o,loaded:!1,exports:{}};return e[o].call(i.exports,i,i.exports,n),i.loaded=!0,i.exports}n.m=e,(()=>{var e,t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__;n.t=function(o,r){if(1&r&&(o=this(o)),8&r)return o;if("object"===typeof o&&o){if(4&r&&o.__esModule)return o;if(16&r&&"function"===typeof o.then)return o}var i=Object.create(null);n.r(i);var s={};e=e||[null,t({}),t([]),t(t)];for(var a=2&r&&o;"object"==typeof a&&!~e.indexOf(a);a=t(a))Object.getOwnPropertyNames(a).forEach((e=>s[e]=()=>o[e]));return s.default=()=>o,n.d(i,s),i}})(),n.d=(e,t)=>{for(var o in t)n.o(t,o)&&!n.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},n.f={},n.e=e=>Promise.all(Object.keys(n.f).reduce(((t,o)=>(n.f[o](e,t),t)),[])),n.u=e=>"static/js/"+e+".4fa8e587.chunk.js",n.miniCssF=e=>{},n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={},t="whiteboard:";n.l=(o,r,i,s)=>{if(e[o])e[o].push(r);else{var a,l;if(void 0!==i)for(var c=document.getElementsByTagName("script"),d=0;d<c.length;d++){var u=c[d];if(u.getAttribute("src")==o||u.getAttribute("data-webpack")==t+i){a=u;break}}a||(l=!0,(a=document.createElement("script")).charset="utf-8",a.timeout=120,n.nc&&a.setAttribute("nonce",n.nc),a.setAttribute("data-webpack",t+i),a.src=o),e[o]=[r];var h=(t,n)=>{a.onerror=a.onload=null,clearTimeout(p);var r=e[o];if(delete e[o],a.parentNode&&a.parentNode.removeChild(a),r&&r.forEach((e=>e(n))),t)return t(n)},p=setTimeout(h.bind(null,void 0,{type:"timeout",target:a}),12e4);a.onerror=h.bind(null,a.onerror),a.onload=h.bind(null,a.onload),l&&document.head.appendChild(a)}}})(),n.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),n.p="/whiteboard/",(()=>{var e={792:0};n.f.j=(t,o)=>{var r=n.o(e,t)?e[t]:void 0;if(0!==r)if(r)o.push(r[2]);else{var i=new Promise(((n,o)=>r=e[t]=[n,o]));o.push(r[2]=i);var s=n.p+n.u(t),a=new Error;n.l(s,(o=>{if(n.o(e,t)&&(0!==(r=e[t])&&(e[t]=void 0),r)){var i=o&&("load"===o.type?"missing":o.type),s=o&&o.target&&o.target.src;a.message="Loading chunk "+t+" failed.\n("+i+": "+s+")",a.name="ChunkLoadError",a.type=i,a.request=s,r[1](a)}}),"chunk-"+t,t)}};var t=(t,o)=>{var r,i,s=o[0],a=o[1],l=o[2],c=0;if(s.some((t=>0!==e[t]))){for(r in a)n.o(a,r)&&(n.m[r]=a[r]);if(l)l(n)}for(t&&t(o);c<s.length;c++)i=s[c],n.o(e,i)&&e[i]&&e[i][0](),e[i]=0},o=self.webpackChunkwhiteboard=self.webpackChunkwhiteboard||[];o.forEach(t.bind(null,0)),o.push=t.bind(null,o.push.bind(o))})(),n.nc=void 0,(()=>{"use strict";var e=n(5043),t=n.t(e,2),o=n(4391);function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function i(e){var t=function(e,t){if("object"!=r(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,t||"default");if("object"!=r(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==r(t)?t:t+""}function s(e,t,n){return(t=i(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){s(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}n(4234),n(1837),n(1001),n(9494),n(1054),n(483);const c="__TLDRAW_LIBRARY_VERSIONS__";function d(){if(globalThis[c])return globalThis[c];const e={versions:[],didWarn:!1,scheduledNotice:null};return Object.defineProperty(globalThis,c,{value:e,writable:!1,configurable:!1,enumerable:!1}),e}function u(e,t,n){if(!e||!t||!n)throw new Error("Missing name/version/module system in built version of tldraw library");const o=d();if(o.versions.push({name:e,version:t,modules:n}),!o.scheduledNotice)try{o.scheduledNotice=setTimeout((()=>{o.scheduledNotice=null,h(o)}),100)}catch(r){h(o)}}function h(e){if(!e.versions.length)return;if(e.didWarn)return;const t=e.versions.sort(((e,t)=>p(e.version,t.version))),n=t[t.length-1].version,o=new Set,r=new Map;for(const a of t)r.has(a.name)?(o.delete(a.name),m(r,a.name,new Set).add(a.version)):a.version===n?o.add(a.name):(o.delete(a.name),m(r,a.name,new Set).add(a.version));if(r.size>0){const t=["".concat(g("[tldraw]",["bold","bgRed","textWhite"])," ").concat(g("You have multiple versions of tldraw libraries installed. This can lead to bugs and unexpected behavior.",["textRed","bold"])),"","The latest version you have installed is ".concat(g("v".concat(n),["bold","textBlue"]),". The following libraries are on the latest version:"),...Array.from(o,(e=>"  \u2022 \u2705 ".concat(g(e,["bold"])))),"","The following libraries are not on the latest version, or have multiple versions installed:",...Array.from(r,(e=>{let[t,o]=e;const r=Array.from(o).sort(p).map((e=>g("v".concat(e),e===n?["textGreen"]:["textRed"])));return"  \u2022 \u274c ".concat(g(t,["bold"])," (").concat(r.join(", "),")")}))];return console.log(t.join("\n")),void(e.didWarn=!0)}const i=new Map;for(const a of t)m(i,a.name,{version:a.version,modules:[]}).modules.push(a.modules);const s=new Map;for(const[a,l]of i)l.modules.length>1&&s.set(a,l);if(s.size>0){const t=["".concat(g("[tldraw]",["bold","bgRed","textWhite"])," ").concat(g("You have multiple instances of some tldraw libraries active. This can lead to bugs and unexpected behavior. ",["textRed","bold"])),"","This usually means that your bundler is misconfigured, and is importing the same library multiple times - usually once as an ES Module, and once as a CommonJS module.","","The following libraries have been imported multiple times:",...Array.from(s,(e=>{let[t,n]=e;const o=n.modules.map(((e,t)=>"      ".concat(t+1,"esm"===e?". ES Modules":". CommonJS"))).join("\n");return"  \u2022 \u274c ".concat(g(t,["bold"])," v").concat(n.version,": \n").concat(o)})),"","You should configure your bundler to only import one version of each library."];return console.log(t.join("\n")),void(e.didWarn=!0)}}function p(e,t){const n=e.match(/^(\d+)\.(\d+)\.(\d+)(?:-(\w+))?$/),o=t.match(/^(\d+)\.(\d+)\.(\d+)(?:-(\w+))?$/);return n&&o?n[1]!==o[1]?Number(n[1])-Number(o[1]):n[2]!==o[2]?Number(n[2])-Number(o[2]):n[3]!==o[3]?Number(n[3])-Number(o[3]):n[4]&&o[4]?n[4].localeCompare(o[4]):n[4]?1:o[4]?-1:0:e.localeCompare(t)}const f={bold:"1",textBlue:"94",textRed:"31",textGreen:"32",bgRed:"41",textWhite:"97"};function g(e){return"\x1b[".concat((arguments.length>1&&void 0!==arguments[1]?arguments[1]:[]).map((e=>f[e])).join(";"),"m").concat(e,"\x1b[m")}function m(e,t,n){return e.has(t)?e.get(t):(e.set(t,n),n)}var y=n(381),v=n(5040);const b="#40C057",w="#FFC078",x="#E03131",S=b;class k{constructor(){s(this,"startTime",0),s(this,"name",""),s(this,"frames",0),s(this,"started",!1),s(this,"frame",null),s(this,"recordFrame",(()=>{this.frames++,this.started&&(this.frame=requestAnimationFrame(this.recordFrame))}))}start(e){this.name=e,this.frames=0,this.started=!0,null!==this.frame&&cancelAnimationFrame(this.frame),this.frame=requestAnimationFrame(this.recordFrame),this.startTime=performance.now()}stop(){this.started=!1,null!==this.frame&&cancelAnimationFrame(this.frame);const e=(performance.now()-this.startTime)/1e3,t=0===e?0:Math.floor(this.frames/e),n=t>55?b:t>30?w:x,o=n===w?"black":"white",r=this.name[0].toUpperCase()+this.name.slice(1);console.debug("%cPerf%c ".concat(r," %c").concat(t,"%c fps"),"color: white; background: ".concat(S,";padding: 2px;border-radius: 3px;"),"font-weight: normal","font-weight: bold; padding: 2px; background: ".concat(n,";color: ").concat(o,";"),"font-weight: normal")}isStarted(){return this.started}}function P(e,t){const n=[];e:for(const o of e){for(const e of n)if(t?t(o,e):o===e)continue e;n.push(o)}return n}function C(e){return e.filter((e=>void 0!==e&&null!==e))}function _(e){return e[e.length-1]}function I(e){const t=function(){try{return e(...arguments)}catch(n){throw n instanceof Error&&Error.captureStackTrace&&Error.captureStackTrace(n,t),n}};return t}const E=()=>{},j={ok:e=>({ok:!0,value:e}),err:e=>({ok:!1,error:e})};function T(e,t){const n=t&&e&&"object"===typeof e&&t in e?e[t]:e;throw new Error("Unknown switch case ".concat(n))}const M=I(((e,t)=>{if(!e)throw new Error(t||"Assertion Error")})),A=I(((e,t)=>{if(null==e)throw new Error(null!==t&&void 0!==t?t:"value must be defined");return e}));function O(){let e,t;const n=new Promise(((n,o)=>{e=n,t=o}));return Object.assign(n,{resolve:e,reject:t})}function D(e){return new Promise((t=>setTimeout(t,e)))}function R(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(2!==t.length){const[e,n,o]=t;if(!o||"function"!==typeof o.value)throw new TypeError("Only methods can be decorated with @bind. <".concat(n,"> is not a method!"));return{configurable:!0,get(){const e=o.value.bind(this);return Object.defineProperty(this,n,{value:e,configurable:!0,writable:!0}),e}}}{const[e,n]=t;n.addInitializer((function(){M(Reflect.isExtensible(this),"Cannot bind to a non-extensible class.");const t=e.bind(this),o=Reflect.defineProperty(this,n.name,{value:t,writable:!0,configurable:!0});M(o,"Cannot bind a non-configurable class method.")}))}}class L{constructor(){s(this,"items",new WeakMap)}get(e,t){return this.items.has(e)||this.items.set(e,t(e)),this.items.get(e)}}function z(e,t){let n;const o=function(){n||(n={},n.promise=new Promise(((e,t)=>{n.resolve=e,n.reject=t}))),clearTimeout(n.timeout);for(var o=arguments.length,r=new Array(o),i=0;i<o;i++)r[i]=arguments[i];return n.latestArgs=r,n.timeout=setTimeout((()=>{const t=n;n=void 0;try{t.resolve(e(...t.latestArgs))}catch(o){t.reject(o)}}),t),n.promise};return o.cancel=()=>{n&&clearTimeout(n.timeout)},o}const N=new WeakMap;function F(e,t){if("object"!==typeof e||null===e)return;let n=N.get(e);n||(n={tags:{},extras:{}},N.set(e,n)),t.tags&&(n.tags=l(l({},n.tags),t.tags)),t.extras&&(n.extras=l(l({},n.extras),t.extras))}async function B(e,t){return window.fetch(e,l({referrerPolicy:"strict-origin-when-cross-origin"},t))}const U=(e,t)=>{const n=new window.Image(e,t);return n.referrerPolicy="strict-origin-when-cross-origin",n};class H{static async dataUrlToArrayBuffer(e){return B(e).then((function(e){return e.arrayBuffer()}))}static async blobToDataUrl(e){return await new Promise(((t,n)=>{if(e){const o=new FileReader;o.onload=()=>t(o.result),o.onerror=e=>n(e),o.onabort=e=>n(e),o.readAsDataURL(e)}}))}static async blobToText(e){return await new Promise(((t,n)=>{if(e){const o=new FileReader;o.onload=()=>t(o.result),o.onerror=e=>n(e),o.onabort=e=>n(e),o.readAsText(e)}}))}static rewriteMimeType(e,t){return e.type===t?e:e instanceof File?new File([e],e.name,{type:t}):new Blob([e],{type:t})}}function K(e){let t=0;for(let n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n),t|=0;return t+""}function V(e){const t=new DataView(e);let n=0;for(let o=0;o<t.byteLength;o++)n=(n<<5)-n+t.getUint8(o),n|=0;return n+""}const W=globalThis.crypto;let q,Y;function G(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:21;var t;t=e-=0,!q||q.length<t?(q=new Uint8Array(128*t),W.getRandomValues(q),Y=0):Y+t>q.length&&(W.getRandomValues(q),Y=0),Y+=t;let n="";for(let o=Y-e;o<Y;o++)n+="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict"[63&q[o]];return n}let X=G;function $(e){return X(e)}function Z(e,t){let n=0;for(;e[t+n];)n+=e[t+n]+1;return n+1}function Q(e){const t=new Uint8Array(e);let n,o,r=0,i=0;if(!function(e){return"GIF"===new TextDecoder("ascii").decode(e.slice(0,3))}(e))return!1;for(n=128&t[10],o=7&t[10],r+=6,r+=7,r+=n?3*Math.pow(2,o+1):0;i<2&&r<t.length;)switch(t[r]){case 44:i+=1,n=128&t[r+9],o=7&t[r+9],r+=10,r+=n?3*Math.pow(2,o+1):0,r+=Z(t,r+1)+1;break;case 33:r+=2,r+=Z(t,r);break;default:r=t.length}return i>1}let J=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117];"undefined"!==typeof Int32Array&&(J=new Int32Array(J));class ee{static isPng(e,t){return 137===e.getUint8(t+0)&&80===e.getUint8(t+1)&&78===e.getUint8(t+2)&&71===e.getUint8(t+3)&&13===e.getUint8(t+4)&&10===e.getUint8(t+5)&&26===e.getUint8(t+6)&&10===e.getUint8(t+7)}static getChunkType(e,t){return[String.fromCharCode(e.getUint8(t)),String.fromCharCode(e.getUint8(t+1)),String.fromCharCode(e.getUint8(t+2)),String.fromCharCode(e.getUint8(t+3))].join("")}static readChunks(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n={};if(!ee.isPng(e,t))throw new Error("Not a PNG");for(t+=8;t<=e.buffer.byteLength;){const o=t,r=e.getInt32(t);t+=4;const i=ee.getChunkType(e,t);if("IDAT"===i&&n[i])t+=r+4+4;else{if("IEND"===i)break;n[i]={start:o,dataOffset:t+4,size:r},t+=r+4+4}}return n}static parsePhys(e,t){return{ppux:e.getUint32(t),ppuy:e.getUint32(t+4),unit:e.getUint8(t+4)}}static findChunk(e,t){return ee.readChunks(e)[t]}static setPhysChunk(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2?arguments[2]:void 0,o=46,r=0;const i=ee.findChunk(e,"pHYs");i&&(o=i.start,r=i.size);const s=ee.findChunk(e,"IDAT");s&&(o=s.start,r=0);const a=new ArrayBuffer(21),l=new DataView(a);l.setUint32(0,9),l.setUint8(4,"p".charCodeAt(0)),l.setUint8(5,"H".charCodeAt(0)),l.setUint8(6,"Y".charCodeAt(0)),l.setUint8(7,"s".charCodeAt(0));const c=2835.5;l.setInt32(8,c*t),l.setInt32(12,c*t),l.setInt8(16,1);const d=new Uint8Array(a.slice(4,17));l.setInt32(17,((e,t)=>{let n=0===t?0:~t;for(let o=0;o<e.length;o++)n=J[255&(n^e[o])]^n>>>8;return~n})(d));const u=e.buffer.slice(0,o),h=e.buffer.slice(o+r);return new Blob([u,a,h],n)}}const te=Object.freeze(["image/svg+xml"]),ne=Object.freeze(["image/jpeg","image/png","image/webp"]),oe=Object.freeze(["image/gif","image/apng","image/avif"]),re=Object.freeze([...ne,...te,...oe]),ie=Object.freeze(["video/mp4","video/webm","video/quicktime"]),se=[...re,...ie].join(",");class ae{static loadVideo(e){return new Promise(((t,n)=>{const o=document.createElement("video");o.onloadeddata=()=>t(o),o.onerror=e=>{console.error(e),n(new Error("Could not load video"))},o.crossOrigin="anonymous",o.src=e}))}static async getVideoFrameAsDataUrl(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=O();let o=!1;const r=()=>{if(!o){if(!(e.readyState>=e.HAVE_METADATA))return;o=!0,e.currentTime=t}if(e.readyState>=e.HAVE_CURRENT_DATA){const t=document.createElement("canvas");t.width=e.videoWidth,t.height=e.videoHeight;const o=t.getContext("2d");if(!o)throw new Error("Could not get 2d context");o.drawImage(e,0,0),n.resolve(t.toDataURL())}},i=e=>{console.error(e),n.reject(new Error("Could not get video frame"))};e.addEventListener("loadedmetadata",r),e.addEventListener("loadeddata",r),e.addEventListener("canplay",r),e.addEventListener("seeked",r),e.addEventListener("error",i),e.addEventListener("stalled",i),r();try{return await n}finally{e.removeEventListener("loadedmetadata",r),e.removeEventListener("loadeddata",r),e.removeEventListener("canplay",r),e.removeEventListener("seeked",r),e.removeEventListener("error",i),e.removeEventListener("stalled",i)}}static loadImage(e){return new Promise(((t,n)=>{const o=U();o.onload=()=>t(o),o.onerror=e=>{console.error(e),n(new Error("Could not load image"))},o.crossOrigin="anonymous",o.referrerPolicy="strict-origin-when-cross-origin",o.src=e}))}static async getVideoSize(e){return ae.usingObjectURL(e,(async e=>{const t=await ae.loadVideo(e);return{w:t.videoWidth,h:t.videoHeight}}))}static async getImageSize(e){const t=await ae.usingObjectURL(e,ae.loadImage);try{if("image/png"===e.type){const n=new DataView(await e.arrayBuffer());if(ee.isPng(n,0)){const e=ee.findChunk(n,"pHYs");if(e){const o=ee.parsePhys(n,e.dataOffset);if(0===o.unit&&o.ppux===o.ppuy){const e=Math.max(o.ppux/2834.5,1);return{w:Math.round(t.naturalWidth/e),h:Math.round(t.naturalHeight/e)}}}}}}catch(n){return console.error(n),{w:t.naturalWidth,h:t.naturalHeight}}return{w:t.naturalWidth,h:t.naturalHeight}}static async isAnimated(e){return"image/gif"===e.type?Q(await e.arrayBuffer()):"image/avif"===e.type?(t=await e.arrayBuffer(),44===new Uint8Array(t)[3]):"image/webp"===e.type?function(e){const t=new Uint8Array(e);return!!function(e){return!(!e||e.length<12)&&87===e[8]&&69===e[9]&&66===e[10]&&80===e[11]}(t)&&!(!t||t.length<21)&&1===(t[20]>>1&1)}(await e.arrayBuffer()):"image/apng"===e.type&&function(e){const t=new Uint8Array(e);if(!t||!("undefined"!==typeof Buffer&&Buffer.isBuffer(t)||t instanceof Uint8Array)||t.length<16)return!1;if(137!==t[0]||80!==t[1]||78!==t[2]||71!==t[3]||13!==t[4]||10!==t[5]||26!==t[6]||10!==t[7])return!1;function n(e,t,n,o){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1024;if(!t)return-1;const i=(t=new RegExp(t,"g")).source.length,s=new TextDecoder,a=e.length;if("undefined"===typeof o&&(o=a),n>=a||o<=0||n>=o)return-1;e=e.subarray(n,o);let l=-1,c=0,d=0,u="";e:for(;c<e.length;){const n=c+r,o=e.subarray(c,n),a=s.decode(o,{stream:!0}),h=u+a;let p,f=-1;for(;null!==(p=t.exec(h));){f=p.index-u.length,l=d+f;break e}c=n,d+=a.length;const g=f>-1?f+i:a.length-i;u=a.slice(g)}return l>=0&&(l+=n>=0?n:a+n),l}const o=n(t,"IDAT",12);if(o>=12)return n(t,"acTL",8,o)>=8;return!1}(await e.arrayBuffer());var t}static isAnimatedImageType(e){return oe.includes(e||"")}static isStaticImageType(e){return ne.includes(e||"")}static isVectorImageType(e){return te.includes(e||"")}static isImageType(e){return re.includes(e)}static async usingObjectURL(e,t){const n=URL.createObjectURL(e);try{return await t(n)}finally{URL.revokeObjectURL(n)}}}function le(e,t,n){return e+(t-e)*n}function ce(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=0,n=0,o=0,r=0;function i(){const e=t^t<<11;return t=n,n=o,o=r,r^=(r>>>19^e^e>>>8)>>>0,r/4294967296*2}for(let s=0;s<e.length+64;s++)t^=0|e.charCodeAt(s),i();return i}function de(e,t,n){let o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const[r,i]=t,[s,a]=n,l=s+(e-r)/(i-r)*(a-s);return o?s<a?Math.max(Math.min(l,a),s):Math.max(Math.min(l,s),a):l}function ue(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function he(e,t){if(ue(e,t))return e[t]}function pe(e){return Object.keys(e)}function fe(e){return Object.values(e)}function ge(e){return Object.entries(e)}function me(e){return Object.fromEntries(e)}function ye(e,t){const n={};let o=!1;for(const[r,i]of ge(e))t(r,i)?n[r]=i:o=!0;return o?n:e}function ve(e,t){const n={};for(const[o,r]of ge(e)){const e=t(o,r);n[o]=e}return n}function be(e,t){if(e===t)return!0;const n=new Set(Object.keys(e)),o=new Set(Object.keys(t));if(n.size!==o.size)return!1;for(const r of n){if(!o.has(r))return!1;if(!Object.is(e[r],t[r]))return!1}return!0}function we(e){var t;const n=function(e){const t={},n={},o=e.length;for(let r=0;r<o;r++){const o=e[r];t[r]=o,n[o]=r}return{byCode:t,byChar:n,length:o}}(e.chars),o=function(e,t,n,o){const r=t?e.byChar[t]:Math.ceil(e.length/2),i=n?e.byChar[n]:e.length-1,s=o?e.byChar[o]:0;if(void 0===r||void 0===i||void 0===s)throw new Error("invalid charSet");if(i-r<3)throw new Error("mostPositive must be at least 3 characters away from neutral");if(r-s<3)throw new Error("mostNegative must be at least 3 characters away from neutral");return{firstPositive:e.byCode[r],mostPositive:e.byCode[i],firstNegative:e.byCode[r-1],mostNegative:e.byCode[s]}}(n,e.firstPositive,e.mostPositive,e.mostNegative),r=null!==(t=e.jitterRange)&&void 0!==t?t:Math.floor(Math.pow(n.length,3)/5),i=function(e,t){const n={};for(let o=0;o<100&&(n[o]=Math.pow(t,o),!(n[o]>e));o++);return n}(r,n.length);return{chars:e.chars,byChar:n.byChar,byCode:n.byCode,length:n.length,first:n.byCode[0],last:n.byCode[n.length-1],firstPositive:o.firstPositive,mostPositive:o.mostPositive,firstNegative:o.firstNegative,mostNegative:o.mostNegative,jitterRange:r,paddingDict:i}}var xe=null;function Se(){return xe||(xe=we({chars:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",firstPositive:"a",mostPositive:"z",mostNegative:"A"}))}function ke(e,t,n){const o=n.byChar[e],r=n.byChar[t];return Math.abs(o-r)}function Pe(e,t){const n=e[0];if(n>t.mostPositive||n<t.mostNegative)throw new Error("invalid firstChar on key");if(n===t.mostPositive){return ke(n,t.firstPositive,t)+1+Ce(e.slice(1),"positive",t)}if(n===t.mostNegative){return ke(n,t.firstNegative,t)+1+Ce(e.slice(1),"negative",t)}return n>=t.firstPositive?ke(n,t.firstPositive,t)+2:ke(n,t.firstNegative,t)+2}function Ce(e,t,n){const o=e[0];if(o>n.mostPositive||o<n.mostNegative)throw new Error("invalid firstChar on key");if(o===n.mostPositive&&"positive"===t){return ke(o,n.mostNegative,n)+1+Ce(e.slice(1),t,n)}if(o===n.mostNegative&&"negative"===t){return ke(o,n.mostPositive,n)+1+Ce(e.slice(1),t,n)}return"positive"===t?ke(o,n.mostNegative,n)+2:ke(o,n.mostPositive,n)+2}function _e(e,t,n,o,r){const i=null!==r&&void 0!==r?r:Math.max(e.length,t.length);return"start"===n?[e.padStart(i,o),t.padStart(i,o)]:[e.padEnd(i,o),t.padEnd(i,o)]}function Ie(e,t,n){const[o,r]=_e(e,t,"end",n.first).sort();return function(e,t){let n=0;const o=e.length,r=t.length;for(let i=0;i<o;i++)n+=t.byChar[e[i]]*Math.pow(r,o-i-1);return n}(je(r,o,n),n)}function Ee(e,t,n){const o=n.length,[r,i]=_e(e,t,"start",n.first),s=[];let a=0;for(let l=r.length-1;l>=0;l--){const e=n.byChar[r[l]]+n.byChar[i[l]]+a;a=Math.floor(e/o);const t=e%o;s.unshift(n.byCode[t])}return a>0&&s.unshift(n.byCode[a]),s.join("")}function je(e,t,n){const o=n.length,[r,i]=_e(e,t,"start",n.first),s=[];let a=0;for(let l=r.length-1;l>=0;l--){let e=n.byChar[r[l]];const t=n.byChar[i[l]]+a;e<t?(a=1,e+=o):a=0;const c=e-t;s.unshift(n.byCode[c])}if(a>0)throw new Error("Subtraction result is negative. Ensure a is greater than or equal to b.");for(;s.length>1&&s[0]===n.byCode[0];)s.shift();return s.join("")}function Te(e,t){return Ee(e,t.byCode[1],t)}function Me(e,t){return je(e,t.byCode[1],t)}function Ae(e,t){if(0===e)return t.byCode[0];let n="";const o=t.length;for(;e>0;)n=t.byCode[e%o]+n,e=Math.floor(e/o);return n}function Oe(e,t){De(e,t)}function De(e,t){const n=Pe(Ne(e,t),t);if(n>e.length)throw new Error("invalid order key length: "+e);return e.slice(0,n)}function Re(e,t){if(!function(e,t){return Pe(e,t)===e.length}(e,t))throw new Error("invalid integer length: "+e)}function Le(e,t){Re(e,t);const[n,o]=Fe(e,t);if(o.split("").some((e=>e!==t.byCode[t.length-1]))){return n+Te(o,t)}const r=function(e,t){const n=e>=t.firstPositive,o=Te(e,t),r=e[e.length-1]===t.mostPositive,i=o[o.length-1]===t.mostPositive;if(n&&i)return o+t.mostNegative;if(!n&&r)return e.slice(0,e.length-1);return o}(n,t);return Be(r,"lower",t)}function ze(e,t){Re(e,t);const[n,o]=Fe(e,t);if(o.split("").some((e=>e!==t.byCode[0]))){return n+Me(o,t)}const r=function(e,t){const n=e>=t.firstPositive,o=e[e.length-1]===t.mostNegative;if(n&&o){return Me(e.slice(0,e.length-1),t)}if(!n&&o)return e+t.mostPositive;return Me(e,t)}(n,t);return Be(r,"upper",t)}function Ne(e,t){let n=0;if(e[0]===t.mostPositive)for(;e[n]===t.mostPositive;)n+=1;if(e[0]===t.mostNegative)for(;e[n]===t.mostNegative;)n+=1;return e.slice(0,n+1)}function Fe(e,t){const n=Ne(e,t);return[n,e.slice(n.length)]}function Be(e,t,n){const o=Pe(e,n);return e+("upper"===t?n.byCode[n.length-1]:n.byCode[0]).repeat(o-e.length)}function Ue(e,t){return Ee(e,Ae(Math.floor(Math.random()*t.jitterRange),t),t)}function He(e,t){const n=t.jitterRange-e,o=Object.entries(t.paddingDict).find((e=>{let[t,o]=e;return o>n}));return o?parseInt(o[0]):0}function Ke(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Se();if(null!==e&&Oe(e,n),null!==t&&Oe(t,n),null===e&&null===t)return function(e){return e.firstPositive+e.byCode[0]}(n);if(null===e){return ze(De(t,n),n)}if(null===t){return Le(De(e,n),n)}if(e>=t)throw new Error(e+" >= "+t);return function(e,t,n){let[o,r]=_e(e,t,"end",n.first),i=Ie(o,r,n);return 1===i&&(o=o.padEnd(o.length+1,n.first),i=n.length),Ee(o,Ae(Math.floor(i/2),n),n)}(e,t,n)}function Ve(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Se();const o=Ke(e,t,n),r=function(e,t,n){const o=Le(De(e,n),n);let r=0;if(null!==t){const o=Ie(e,t,n);o<n.jitterRange+1&&(r=Math.max(r,He(o,n)))}const i=Ie(e,o,n);return i<n.jitterRange+1&&(r=Math.max(r,He(i,n))),r}(o,t,n);return r?function(e,t,n){return Ue(e.padEnd(e.length+t,n.first),n)}(o,r,n):Ue(o,n)}function We(e,t,n){return qe(e,t,n,arguments.length>3&&void 0!==arguments[3]?arguments[3]:Se(),Ve,We)}function qe(e,t,n,o,r,i){if(0===n)return[];if(1===n)return[r(e,t,o)];if(null==t){let i=r(e,t,o);const s=[i];for(let e=0;e<n-1;e++)i=r(i,t,o),s.push(i);return s}if(null==e){let i=r(e,t,o);const s=[i];for(let t=0;t<n-1;t++)i=r(e,i,o),s.push(i);return s.reverse(),s}const s=Math.floor(n/2),a=r(e,t,o);return[...i(e,a,s,o),a,...i(a,t,n-s-1,o)]}const Ye=We;function Ge(e,t,n){return Ye(null!==e&&void 0!==e?e:null,null!==t&&void 0!==t?t:null,n)}function Xe(e,t){return Ye(null!==e&&void 0!==e?e:null,null,t)}function $e(e,t){return Ye(null!==e&&void 0!==e?e:null,null!==t&&void 0!==t?t:null,1)[0]}function Ze(){return Ye(arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,null,1)[0]}function Qe(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"a1";return[t,...Ye(t,null,e)]}function Je(e,t){return e.index<t.index?-1:e.index>t.index?1:0}function et(e,t){return e.id>t.id?1:-1}function tt(e){try{return localStorage.getItem(e)}catch(t){return null}}function nt(e,t){try{localStorage.setItem(e,t)}catch(n){}}function ot(e){try{return sessionStorage.getItem(e)}catch(t){return null}}function rt(e,t){try{sessionStorage.setItem(e,t)}catch(n){}}function it(e){try{sessionStorage.removeItem(e)}catch(t){}}const st=()=>"undefined"!==typeof process&&!1,at=[],lt=Math.ceil(1e3/60);let ct,dt=0,ut=0;function ht(){if(ct)return;const e=Date.now(),t=e-ut;ct=dt+t<lt?requestAnimationFrame((()=>{ct=void 0,ht()})):requestAnimationFrame((()=>{ct=void 0,ut=e,dt=Math.min(dt+t-lt,10*lt),(()=>{const e=at.splice(0,at.length);for(const t of e)t()})()}))}let pt=!1;function ft(e){if(st())return e.cancel=()=>ct&&cancelAnimationFrame(ct),e;const t=()=>{at.includes(e)||(at.push(e),pt||(pt=!0,ut=Date.now()-lt-1),ht())};return t.cancel=()=>{const t=at.indexOf(e);t>-1&&at.splice(t,1)},t}function gt(e){return st()?(e(),()=>{}):(at.includes(e)||(at.push(e),pt||(pt=!0,ut=Date.now()-lt-1),ht()),()=>{const t=at.indexOf(e);t>-1&&at.splice(t,1)})}const mt=(e,t)=>{try{return new URL(e,t)}catch(n){return}};function yt(e){return void 0!==e}const vt="undefined"!==typeof globalThis&&globalThis.structuredClone?[globalThis.structuredClone,!0]:"undefined"!==typeof global&&global.structuredClone?[global.structuredClone,!0]:"undefined"!==typeof window&&window.structuredClone?[window.structuredClone,!0]:[e=>e?JSON.parse(JSON.stringify(e)):e,!1],bt=vt[0],wt=Object.getPrototypeOf(bt({})),xt=new Set;function St(e){xt.has(e)||(xt.add(e),console.warn("[tldraw] ".concat(e)))}function kt(e){return e&&"object"===typeof e&&"parents"in e}function Pt(e){for(let t=0,n=e.parents.length;t<n;t++)if(e.parents[t].__unsafe__getWithoutCapture(!0),e.parents[t].lastChangedEpoch!==e.parentEpochs[t])return!0;return!1}function Ct(e,t){if(e.children.remove(t)&&e.children.isEmpty&&kt(e))for(let n=0,o=e.parents.length;n<o;n++)Ct(e.parents[n],e)}function _t(e,t){if(e.children.add(t)&&kt(e))for(let n=0,o=e.parents.length;n<o;n++)_t(e.parents[n],e)}function It(e,t){return e===t||Object.is(e,t)||Boolean(e&&t&&"function"===typeof e.equals&&e.equals(t))}function Et(e,t){var n;const o=Symbol.for("com.tldraw.state/".concat(e)),r=globalThis;return null!==(n=r[o])&&void 0!==n||(r[o]=t()),r[o]}u("@tldraw/utils","3.6.1","esm");const jt=Et("empty_array",(()=>Object.freeze([])));class Tt{constructor(){s(this,"arraySize",0),s(this,"array",Array(8)),s(this,"set",null)}get isEmpty(){if(this.array)return 0===this.arraySize;if(this.set)return 0===this.set.size;throw new Error("no set or array")}add(e){if(this.array){return-1===this.array.indexOf(e)&&(this.arraySize<8?(this.array[this.arraySize]=e,this.arraySize++,!0):(this.set=new Set(this.array),this.array=null,this.set.add(e),!0))}if(this.set)return!this.set.has(e)&&(this.set.add(e),!0);throw new Error("no set or array")}remove(e){if(this.array){const t=this.array.indexOf(e);return-1!==t&&(this.array[t]=void 0,this.arraySize--,t!==this.arraySize&&(this.array[t]=this.array[this.arraySize],this.array[this.arraySize]=void 0),!0)}if(this.set)return!!this.set.has(e)&&(this.set.delete(e),!0);throw new Error("no set or array")}visit(e){if(this.array)for(let t=0;t<this.arraySize;t++){const n=this.array[t];"undefined"!==typeof n&&e(n)}else{if(!this.set)throw new Error("no set or array");this.set.forEach(e)}}has(e){return this.array?-1!==this.array.indexOf(e):this.set.has(e)}clear(){this.set?this.set.clear():(this.arraySize=0,this.array=[])}size(){return this.set?this.set.size:this.arraySize}}const Mt=Symbol.for("com.tldraw.state/RESET_VALUE");class At{constructor(e){s(this,"index",0),s(this,"buffer",void 0),this.capacity=e,this.buffer=new Array(e)}pushEntry(e,t,n){void 0!==n&&(n!==Mt?(this.buffer[this.index]=[e,t,n],this.index=(this.index+1)%this.capacity):this.clear())}clear(){this.index=0,this.buffer.fill(void 0)}getChangesSince(e){const{index:t,capacity:n,buffer:o}=this;for(let r=0;r<n;r++){const i=(t-1+n-r)%n,s=o[i];if(!s)return Mt;const[a,l]=s;if(0===r&&e>=l)return[];if(a<=e&&e<l){const e=r+1,t=new Array(e);for(let r=0;r<e;r++)t[r]=o[(i+r)%n][2];return t}}return Mt}}class Ot{constructor(e,t){s(this,"offset",0),s(this,"maybeRemoved",void 0),this.below=e,this.child=t}}const Dt=Et("capture",(()=>({stack:null})));function Rt(e){const t=Dt.stack;Dt.stack=null;try{return e()}finally{Dt.stack=t}}function Lt(e){Dt.stack=new Ot(Dt.stack,e),e.parentSet.clear()}function zt(){const e=Dt.stack;if(Dt.stack=e.below,e.offset<e.child.parents.length){for(let t=e.offset;t<e.child.parents.length;t++){const n=e.child.parents[t];e.child.parentSet.has(n)||Ct(n,e.child)}e.child.parents.length=e.offset,e.child.parentEpochs.length=e.offset}if(e.maybeRemoved)for(let t=0;t<e.maybeRemoved.length;t++){const n=e.maybeRemoved[t];e.child.parentSet.has(n)||Ct(n,e.child)}}function Nt(e){if(Dt.stack){if(Dt.stack.child.parentSet.has(e))return;if(Dt.stack.child.parentSet.add(e),Dt.stack.child.isActivelyListening&&_t(e,Dt.stack.child),Dt.stack.offset<Dt.stack.child.parents.length){const t=Dt.stack.child.parents[Dt.stack.offset];t!==e&&(Dt.stack.maybeRemoved?Dt.stack.maybeRemoved.push(t):Dt.stack.maybeRemoved=[t])}Dt.stack.child.parents[Dt.stack.offset]=e,Dt.stack.child.parentEpochs[Dt.stack.offset]=e.lastChangedEpoch,Dt.stack.offset++}}const Ft=-1;class Bt{constructor(e,t,n){s(this,"_isActivelyListening",!1),s(this,"lastTraversedEpoch",Ft),s(this,"lastReactedEpoch",Ft),s(this,"_scheduleCount",0),s(this,"parentSet",new Tt),s(this,"parentEpochs",[]),s(this,"parents",[]),s(this,"_scheduleEffect",void 0),s(this,"maybeExecute",(()=>{this._isActivelyListening&&this.execute()})),this.name=e,this.runEffect=t,this._scheduleEffect=null===n||void 0===n?void 0:n.scheduleEffect}get isActivelyListening(){return this._isActivelyListening}get scheduleCount(){return this._scheduleCount}maybeScheduleEffect(){this._isActivelyListening&&this.lastReactedEpoch!==Wt()&&(!this.parents.length||Pt(this)?this.scheduleEffect():this.lastReactedEpoch=Wt())}scheduleEffect(){this._scheduleCount++,this._scheduleEffect?this._scheduleEffect(this.maybeExecute):this.execute()}attach(){this._isActivelyListening=!0;for(let e=0,t=this.parents.length;e<t;e++)_t(this.parents[e],this)}detach(){this._isActivelyListening=!1;for(let e=0,t=this.parents.length;e<t;e++)Ct(this.parents[e],this)}execute(){try{Lt(this);const e=Wt(),t=this.runEffect(this.lastReactedEpoch);return this.lastReactedEpoch=e,t}finally{zt()}}}const Ut=Et("EffectScheduler",(()=>Bt));function Ht(e,t,n){const o=new Ut(e,t,n);return o.attach(),o.scheduleEffect(),()=>{o.detach()}}class Kt{constructor(e){s(this,"initialAtomValues",new Map),this.parent=e}get isRoot(){return null===this.parent}commit(){if(Vt.globalIsReacting)for(const e of this.initialAtomValues.keys())Gt(e);else this.isRoot?Yt(this.initialAtomValues.keys()):this.initialAtomValues.forEach(((e,t)=>{this.parent.initialAtomValues.has(t)||this.parent.initialAtomValues.set(t,e)}))}abort(){Vt.globalEpoch++,this.initialAtomValues.forEach(((e,t)=>{var n;t.set(e),null===(n=t.historyBuffer)||void 0===n||n.clear()})),this.commit()}}const Vt=Et("transactions",(()=>({globalEpoch:0,globalIsReacting:!1,currentTransaction:null,cleanupReactors:null,reactionEpoch:0})));function Wt(){return Vt.globalEpoch}function qt(e,t){t.lastTraversedEpoch!==Vt.globalEpoch&&(t.lastTraversedEpoch=Vt.globalEpoch,t instanceof Ut?e.add(t):t.children.visit((t=>qt(e,t))))}function Yt(e){if(Vt.globalIsReacting)throw new Error("flushChanges cannot be called during a reaction");const t=Vt.currentTransaction;try{Vt.currentTransaction=null,Vt.globalIsReacting=!0,Vt.reactionEpoch=Vt.globalEpoch;const t=new Set;for(const n of e)n.children.visit((e=>qt(t,e)));for(const e of t)e.maybeScheduleEffect();let o=0;for(;null!==(n=Vt.cleanupReactors)&&void 0!==n&&n.size;){var n;if(o++>1e3)throw new Error("Reaction update depth limit exceeded");const e=Vt.cleanupReactors;Vt.cleanupReactors=null;for(const t of e)t.maybeScheduleEffect()}}finally{Vt.cleanupReactors=null,Vt.globalIsReacting=!1,Vt.currentTransaction=t}}function Gt(e){var t;const n=null!==(t=Vt.cleanupReactors)&&void 0!==t?t:Vt.cleanupReactors=new Set;e.children.visit((e=>qt(n,e)))}function Xt(e){return Vt.currentTransaction?e():function(e){const t=new Kt(Vt.currentTransaction);Vt.currentTransaction=t;try{let o,r=!1;try{o=e((()=>r=!0))}catch(n){throw t.abort(),n}return r?t.abort():t.commit(),o}finally{Vt.currentTransaction=Vt.currentTransaction.parent}}(e)}class $t{constructor(e,t,n){var o;s(this,"isEqual",void 0),s(this,"computeDiff",void 0),s(this,"lastChangedEpoch",Wt()),s(this,"children",new Tt),s(this,"historyBuffer",void 0),this.name=e,this.current=t,this.isEqual=null!==(o=null===n||void 0===n?void 0:n.isEqual)&&void 0!==o?o:null,n&&(n.historyLength&&(this.historyBuffer=new At(n.historyLength)),this.computeDiff=n.computeDiff)}__unsafe__getWithoutCapture(e){return this.current}get(){return Nt(this),this.current}set(e,t){var n,o,r,i;if(null!==(n=null===(o=this.isEqual)||void 0===o?void 0:o.call(this,this.current,e))&&void 0!==n?n:It(this.current,e))return this.current;(Vt.globalEpoch++,this.historyBuffer)&&this.historyBuffer.pushEntry(this.lastChangedEpoch,Wt(),null!==(r=null!==t&&void 0!==t?t:null===(i=this.computeDiff)||void 0===i?void 0:i.call(this,this.current,e,this.lastChangedEpoch,Wt()))&&void 0!==r?r:Mt);this.lastChangedEpoch=Wt();const s=this.current;return this.current=e,function(e,t){Vt.currentTransaction?Vt.currentTransaction.initialAtomValues.has(e)||Vt.currentTransaction.initialAtomValues.set(e,t):Vt.globalIsReacting?Gt(e):Yt([e])}(this,s),e}update(e){return this.set(e(this.current))}getDiffSince(e){var t,n;return Nt(this),e>=this.lastChangedEpoch?jt:null!==(t=null===(n=this.historyBuffer)||void 0===n?void 0:n.getChangesSince(e))&&void 0!==t?t:Mt}}const Zt=Et("Atom",(()=>$t));function Qt(e,t,n){return new Zt(e,t,n)}let Jt=!1;const en=Symbol.for("com.tldraw.state/UNINITIALIZED");function tn(e){return e===en}const nn=Et("WithDiff",(()=>class{constructor(e,t){this.value=e,this.diff=t}}));function on(e,t){return new nn(e,t)}class rn{constructor(e,t,n){var o;s(this,"lastChangedEpoch",Ft),s(this,"lastTraversedEpoch",Ft),s(this,"lastCheckedEpoch",Ft),s(this,"parentSet",new Tt),s(this,"parents",[]),s(this,"parentEpochs",[]),s(this,"children",new Tt),s(this,"historyBuffer",void 0),s(this,"state",en),s(this,"error",null),s(this,"computeDiff",void 0),s(this,"isEqual",void 0),this.name=e,this.derive=t,null!==n&&void 0!==n&&n.historyLength&&(this.historyBuffer=new At(n.historyLength)),this.computeDiff=null===n||void 0===n?void 0:n.computeDiff,this.isEqual=null!==(o=null===n||void 0===n?void 0:n.isEqual)&&void 0!==o?o:It}get isActivelyListening(){return!this.children.isEmpty}__unsafe__getWithoutCapture(e){const t=this.lastChangedEpoch===Ft,n=Wt();if(!t&&(this.lastCheckedEpoch===n||this.isActivelyListening&&Vt.globalIsReacting&&this.lastTraversedEpoch<Vt.reactionEpoch||!Pt(this))){if(this.lastCheckedEpoch=n,this.error){if(e)return this.state;throw this.error.thrownValue}return this.state}try{Lt(this);const e=this.derive(this.state,this.lastCheckedEpoch),t=e instanceof nn?e.value:e,n=this.state===en;if(n||!this.isEqual(t,this.state)){if(this.historyBuffer&&!n){var o,r;const n=e instanceof nn?e.diff:void 0;this.historyBuffer.pushEntry(this.lastChangedEpoch,Wt(),null!==(o=null!==n&&void 0!==n?n:null===(r=this.computeDiff)||void 0===r?void 0:r.call(this,this.state,t,this.lastCheckedEpoch,Wt()))&&void 0!==o?o:Mt)}this.lastChangedEpoch=Wt(),this.state=t}return this.error=null,this.lastCheckedEpoch=Wt(),this.state}catch(i){if(this.state!==en&&(this.state=en,this.lastChangedEpoch=Wt()),this.lastCheckedEpoch=Wt(),this.historyBuffer&&this.historyBuffer.clear(),this.error={thrownValue:i},!e)throw i;return this.state}finally{zt()}}get(){try{return this.__unsafe__getWithoutCapture()}finally{Nt(this)}}getDiffSince(e){var t,n;return this.__unsafe__getWithoutCapture(!0),Nt(this),e>=this.lastChangedEpoch?jt:null!==(t=null===(n=this.historyBuffer)||void 0===n?void 0:n.getChangesSince(e))&&void 0!==t?t:Mt}}const sn=Et("Computed",(()=>rn));function an(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;if(2===t.length){const[n,o]=t;return function(e,t,n){M("method"===n.kind,"@computed can only be used on methods");const o=Symbol.for("__@tldraw/state__computed__"+String(n.name)),r=function(){let r=this[o];return r||(r=new sn(String(n.name),t.bind(this),e),Object.defineProperty(this,o,{enumerable:!1,configurable:!1,writable:!1,value:r})),r.get()};return r[ln]=!0,r}(e,n,o)}{const[n,o,r]=t;return r.get?(Jt||(Jt=!0,console.warn("Using `@computed` as a decorator for getters is deprecated and will be removed in the near future. Please refactor to use `@computed` as a decorator for methods.\n\n// Before\n@computed\nget foo() {\n\treturn 'foo'\n}\n\n// After\n@computed\ngetFoo() {\n\treturn 'foo'\n}\n")),function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0;const o=n.get,r=Symbol.for("__@tldraw/state__computed__"+t);return n.get=function(){let n=this[r];return n||(n=new sn(t,o.bind(this),e),Object.defineProperty(this,r,{enumerable:!1,configurable:!1,writable:!1,value:n})),n.get()},n}(e,n,o,r)):function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0;const o=n.value,r=Symbol.for("__@tldraw/state__computed__"+t);return n.value=function(){let n=this[r];return n||(n=new sn(t,o.bind(this),e),Object.defineProperty(this,r,{enumerable:!1,configurable:!1,writable:!1,value:n})),n.get()},n.value[ln]=!0,n}(e,n,o,r)}}const ln="@@__isComputedMethod__@@";function cn(){if(1===arguments.length){const e=arguments[0];return function(){for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return an(e,n)}}return"string"===typeof arguments[0]?new sn(arguments[0],arguments[1],arguments[2]):an(void 0,arguments)}if(1!==Et("apiVersion",(()=>1)))throw new Error("You have multiple incompatible versions of @tldraw/state in your app. Please deduplicate the package.");function dn(t,n){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];const r=e.useRef(n);r.current=n;const[i,s,a]=e.useMemo((()=>{let e=null;const n=new Ut("useStateTracking(".concat(t,")"),(()=>{var e;return null===(e=r.current)||void 0===e?void 0:e.call(r)}),{scheduleEffect(){var t;null===(t=e)||void 0===t||t()}});return[n,t=>(e=t,()=>{e=null}),()=>n.scheduleCount]}),[t,...o]);return e.useSyncExternalStore(s,a,a),e.useEffect((()=>(i.attach(),i.maybeScheduleEffect(),()=>{i.detach()})),[i]),i.execute()}u("@tldraw/state","3.6.1","esm");const un={apply(e,t,n){var o,r;return dn(null!==(o=null!==(r=e.displayName)&&void 0!==r?r:e.name)&&void 0!==o?o:"tracked(???)",(()=>e.apply(t,n)))}},hn=Symbol.for("react.memo"),pn=Symbol.for("react.forward_ref");function fn(t){let n=null;const o=t.$$typeof;return o===hn&&(n=(t=t.type).compare),o===pn?(0,e.memo)((0,e.forwardRef)(new Proxy(t.render,un))):(0,e.memo)(new Proxy(t,un),n)}function gn(t,n,o){return(0,e.useState)((()=>{const e="function"===typeof n?n():n;return Qt("useAtom(".concat(t,")"),e,o)}))[0]}function mn(t,n){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:jt;(0,e.useEffect)((()=>{const e=new Ut(t,n);return e.attach(),e.execute(),()=>{e.detach()}}),o)}function yn(){const t=arguments,n=3===t.length?t[2]:[t[0]],o=3===t.length?t[0]:"useValue(".concat(t[0].name,")"),r=(0,e.useRef)(!0);r.current=!0;const i=(0,e.useMemo)((()=>1===t.length?t[0]:cn(o,(()=>{if(r.current)return t[1]();try{return t[1]()}catch(e){return{}}}))),n);try{const{subscribe:t,getSnapshot:n}=(0,e.useMemo)((()=>({subscribe:e=>Ht("useValue(".concat(o,")"),(()=>{i.get(),e()})),getSnapshot:()=>i.get()})),[i]);return(0,e.useSyncExternalStore)(t,n,n)}finally{r.current=!1}}u("@tldraw/state-react","3.6.1","esm");class vn{constructor(e){s(this,"nextValue",void 0),s(this,"diff",void 0),this.previousValue=e}get(){var e,t,n,o;const r=null!==(e=null===(t=this.diff)||void 0===t||null===(t=t.removed)||void 0===t?void 0:t.size)&&void 0!==e?e:0,i=null!==(n=null===(o=this.diff)||void 0===o||null===(o=o.added)||void 0===o?void 0:o.size)&&void 0!==n?n:0;if(0!==r||0!==i)return{value:this.nextValue,diff:this.diff}}_add(e,t){var n,o,r,i,s;(null!==(n=this.nextValue)&&void 0!==n||(this.nextValue=new Set(this.previousValue)),this.nextValue.add(e),null!==(o=this.diff)&&void 0!==o||(this.diff={}),t)?null===(r=this.diff.removed)||void 0===r||r.delete(e):(null!==(s=(i=this.diff).added)&&void 0!==s||(i.added=new Set),this.diff.added.add(e))}add(e){var t;const n=this.previousValue.has(e);if(n){var o;if(!(null===(o=this.diff)||void 0===o||null===(o=o.removed)||void 0===o?void 0:o.has(e)))return;return this._add(e,n)}(null===(t=this.nextValue)||void 0===t?void 0:t.has(e))||this._add(e,n)}_remove(e,t){var n,o,r,i,s;(null!==(n=this.nextValue)&&void 0!==n||(this.nextValue=new Set(this.previousValue)),this.nextValue.delete(e),null!==(o=this.diff)&&void 0!==o||(this.diff={}),t)?(null!==(i=(r=this.diff).removed)&&void 0!==i||(r.removed=new Set),this.diff.removed.add(e)):null===(s=this.diff.added)||void 0===s||s.delete(e)}remove(e){var t;const n=this.previousValue.has(e);if(!n){var o;if(!(null===(o=this.diff)||void 0===o||null===(o=o.added)||void 0===o?void 0:o.has(e)))return;return this._remove(e,n)}(null===(t=this.diff)||void 0===t||null===(t=t.removed)||void 0===t?void 0:t.has(e))||this._remove(e,n)}}class bn{constructor(e,t){var n,o;s(this,"createDefaultProperties",void 0),s(this,"validator",void 0),s(this,"ephemeralKeys",void 0),s(this,"ephemeralKeySet",void 0),s(this,"scope",void 0),this.typeName=e,this.createDefaultProperties=t.createDefaultProperties,this.validator=null!==(n=t.validator)&&void 0!==n?n:{validate:e=>e},this.scope=null!==(o=t.scope)&&void 0!==o?o:"document",this.ephemeralKeys=t.ephemeralKeys;const r=new Set;if(t.ephemeralKeys)for(const[i,s]of ge(t.ephemeralKeys))s&&r.add(i);this.ephemeralKeySet=r}create(e){const t=l(l({},this.createDefaultProperties()),{},{id:this.createId()});for(const[n,o]of Object.entries(e))void 0!==o&&(t[n]=o);return t.typeName=this.typeName,t}clone(e){return l(l({},bt(e)),{},{id:this.createId()})}createId(e){return this.typeName+":"+(null!==e&&void 0!==e?e:$())}createCustomId(e){return this.typeName+":"+e}parseId(e){if(!this.isId(e))throw new Error('ID "'.concat(e,'" is not a valid ID for type "').concat(this.typeName,'"'));return e.slice(this.typeName.length+1)}isInstance(e){return(null===e||void 0===e?void 0:e.typeName)===this.typeName}isId(e){if(!e)return!1;for(let t=0;t<this.typeName.length;t++)if(e[t]!==this.typeName[t])return!1;return":"===e[this.typeName.length]}withDefaultProperties(e){return new bn(this.typeName,{createDefaultProperties:e,validator:this.validator,scope:this.scope,ephemeralKeys:this.ephemeralKeys})}validate(e,t){return t&&this.validator.validateUsingKnownGoodVersion?this.validator.validateUsingKnownGoodVersion(t,e):this.validator.validate(e)}}function wn(e,t){return new bn(e,{createDefaultProperties:()=>({}),validator:t.validator,scope:t.scope,ephemeralKeys:t.ephemeralKeys})}function xn(e){const t={added:e.removed,removed:e.added,updated:{}};for(const[n,o]of Object.values(e.updated))t.updated[n.id]=[o,n];return t}function Sn(e){return 0===Object.keys(e.added).length&&0===Object.keys(e.updated).length&&0===Object.keys(e.removed).length}function kn(e){const t={added:{},removed:{},updated:{}};return Pn(t,e),t}function Pn(e,t){for(const n of t){for(const[t,o]of ge(n.added))if(e.removed[t]){const n=e.removed[t];delete e.removed[t],n!==o&&(e.updated[t]=[n,o])}else e.added[t]=o;for(const[t,[o,r]]of ge(n.updated))e.added[t]?(e.added[t]=r,delete e.updated[t],delete e.removed[t]):e.updated[t]?(e.updated[t]=[e.updated[t][0],r],delete e.removed[t]):(e.updated[t]=n.updated[t],delete e.removed[t]);for(const[t,o]of ge(n.removed))e.added[t]?delete e.added[t]:e.updated[t]?(e.removed[t]=e.updated[t][0],delete e.updated[t]):e.removed[t]=o}}var Cn=n(67);function _n(e,t){for(const[n,o]of Object.entries(e)){const e=o,r=t[n];if("eq"in e&&r!==e.eq)return!1;if("neq"in e&&r===e.neq)return!1;if("gt"in e&&("number"!==typeof r||r<=e.gt))return!1}return!0}function In(e,t,n){const o=Object.fromEntries(Object.keys(n).map((e=>[e,new Set])));for(const[r,i]of Object.entries(n))if("eq"in i){const n=e.index(t,r).get().get(i.eq);if(n)for(const e of n)o[r].add(e)}else if("neq"in i){const n=e.index(t,r);for(const[e,t]of n.get())if(e!==i.neq)for(const n of t)o[r].add(n)}else if("gt"in i){const n=e.index(t,r);for(const[e,t]of n.get())if(e>i.gt)for(const n of t)o[r].add(n)}return function(e){if(0===e.length)return new Set;const t=e[0],n=e.slice(1),o=new Set;for(const r of t)n.every((e=>e.has(r)))&&o.add(r);return o}(Object.values(o))}class En{constructor(e,t){s(this,"indexCache",new Map),s(this,"historyCache",new Map),this.atoms=e,this.history=t}filterHistory(e){if(this.historyCache.has(e))return this.historyCache.get(e);const t=cn("filterHistory:"+e,((t,n)=>{if(tn(t))return this.history.get();const o=this.history.getDiffSince(n);if(o===Mt)return this.history.get();const r={added:{},removed:{},updated:{}};let i=0,s=0,a=0;for(const l of o){for(const t of fe(l.added))if(t.typeName===e)if(r.removed[t.id]){const e=r.removed[t.id];delete r.removed[t.id],s--,e!==t&&(r.updated[t.id]=[e,t],a++)}else r.added[t.id]=t,i++;for(const[t,n]of fe(l.updated))n.typeName===e&&(r.added[n.id]?r.added[n.id]=n:r.updated[n.id]?r.updated[n.id]=[r.updated[n.id][0],n]:(r.updated[n.id]=[t,n],a++));for(const t of fe(l.removed))t.typeName===e&&(r.added[t.id]?(delete r.added[t.id],i--):r.updated[t.id]?(r.removed[t.id]=r.updated[t.id][0],delete r.updated[t.id],a--,s++):(r.removed[t.id]=t,s++))}return i||s||a?on(this.history.get(),r):t}),{historyLength:100});return this.historyCache.set(e,t),t}index(e,t){const n=e+":"+t;if(this.indexCache.has(n))return this.indexCache.get(n);const o=this.__uncached_createIndex(e,t);return this.indexCache.set(n,o),o}__uncached_createIndex(e,t){const n=this.filterHistory(e),o=()=>{n.get();const o=new Map;for(const n of fe(this.atoms.get())){const r=n.get();if(r.typeName===e){const e=r[t];o.has(e)||o.set(e,new Set),o.get(e).add(r.id)}}return o};return cn("index:"+e+":"+t,((r,i)=>{if(tn(r))return o();const s=n.getDiffSince(i);if(s===Mt)return o();const a=new Map,l=(e,t)=>{var n;let o=a.get(e);o||(o=new vn(null!==(n=r.get(e))&&void 0!==n?n:new Set)),o.add(t),a.set(e,o)},c=(e,t)=>{var n;let o=a.get(e);o||(o=new vn(null!==(n=r.get(e))&&void 0!==n?n:new Set)),o.remove(t),a.set(e,o)};for(const n of s){for(const o of fe(n.added))if(o.typeName===e){l(o[t],o.id)}for(const[o,r]of fe(n.updated))if(r.typeName===e){const e=o[t],n=r[t];e!==n&&(c(e,r.id),l(n,r.id))}for(const o of fe(n.removed))if(o.typeName===e){c(o[t],o.id)}}let d,u;for(const[e,t]of a){const n=t.get();n&&(d||(d=new Map(r)),u||(u=new Map),0===n.value.size?d.delete(e):d.set(e,n.value),u.set(e,n.diff))}return d&&u?on(d,u):r}),{historyLength:100})}record(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:()=>({}),n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"record:"+e+(t?":"+t.toString():"");const o=this.ids(e,t,n);return cn(n,(()=>{for(const t of o.get()){var e;return null===(e=this.atoms.get()[t])||void 0===e?void 0:e.get()}}))}records(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:()=>({}),n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"records:"+e+(t?":"+t.toString():"");const o=this.ids(e,t,"ids:"+n);return cn(n,(()=>[...o.get()].map((e=>{const t=this.atoms.get()[e];if(!t)throw new Error("no atom found for record id: "+e);return t.get()}))))}ids(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:()=>({}),n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"ids:"+e+(t?":"+t.toString():"");const o=this.filterHistory(e),r=()=>{o.get();const n=t();return 0===Object.keys(n).length?new Set(fe(this.atoms.get()).flatMap((t=>{const n=t.get();return n.typeName===e?n.id:[]}))):In(this,e,n)},i=e=>{const t=r(),n=function(e,t){const n={};for(const i of t){var o;e.has(i)||(null!==(o=n.added)&&void 0!==o||(n.added=new Set),n.added.add(i))}for(const i of e){var r;t.has(i)||(null!==(r=n.removed)&&void 0!==r||(n.removed=new Set),n.removed.add(i))}return n.added||n.removed?n:void 0}(e,t);return n?on(t,n):e},s=cn("ids_query:"+n,t,{isEqual:Cn});return cn("query:"+n,((t,n)=>{const a=s.get();if(tn(t))return r();if(n<s.lastChangedEpoch)return i(t);const l=o.getDiffSince(n);if(l===Mt)return i(t);const c=new vn(t);for(const o of l){for(const t of fe(o.added))t.typeName===e&&_n(a,t)&&c.add(t.id);for(const[t,n]of fe(o.updated))n.typeName===e&&(_n(a,n)?c.add(n.id):c.remove(n.id));for(const t of fe(o.removed))t.typeName===e&&c.remove(t.id)}const d=c.get();return d?on(d.value,d.diff):t}),{historyLength:50})}exec(e,t){const n=In(this,e,t);if(0===n.size)return jt;const o=this.atoms.get();return[...n].map((e=>o[e].get()))}}class jn{constructor(e){s(this,"_beforeCreateHandlers",{}),s(this,"_afterCreateHandlers",{}),s(this,"_beforeChangeHandlers",{}),s(this,"_afterChangeHandlers",{}),s(this,"_beforeDeleteHandlers",{}),s(this,"_afterDeleteHandlers",{}),s(this,"_operationCompleteHandlers",[]),s(this,"_isEnabled",!0),this.store=e}isEnabled(){return this._isEnabled}setIsEnabled(e){this._isEnabled=e}handleBeforeCreate(e,t){if(!this._isEnabled)return e;const n=this._beforeCreateHandlers[e.typeName];if(n){let o=e;for(const e of n)o=e(o,t);return o}return e}handleAfterCreate(e,t){if(!this._isEnabled)return;const n=this._afterCreateHandlers[e.typeName];if(n)for(const o of n)o(e,t)}handleBeforeChange(e,t,n){if(!this._isEnabled)return t;const o=this._beforeChangeHandlers[t.typeName];if(o){let r=t;for(const t of o)r=t(e,r,n);return r}return t}handleAfterChange(e,t,n){if(!this._isEnabled)return;const o=this._afterChangeHandlers[t.typeName];if(o)for(const r of o)r(e,t,n)}handleBeforeDelete(e,t){if(!this._isEnabled)return!0;const n=this._beforeDeleteHandlers[e.typeName];if(n)for(const o of n)if(!1===o(e,t))return!1;return!0}handleAfterDelete(e,t){if(!this._isEnabled)return;const n=this._afterDeleteHandlers[e.typeName];if(n)for(const o of n)o(e,t)}handleOperationComplete(e){if(this._isEnabled)for(const t of this._operationCompleteHandlers)t(e)}register(e){const t=[];for(const[n,o]of Object.entries(e))null!==o&&void 0!==o&&o.beforeCreate&&t.push(this.registerBeforeCreateHandler(n,o.beforeCreate)),null!==o&&void 0!==o&&o.afterCreate&&t.push(this.registerAfterCreateHandler(n,o.afterCreate)),null!==o&&void 0!==o&&o.beforeChange&&t.push(this.registerBeforeChangeHandler(n,o.beforeChange)),null!==o&&void 0!==o&&o.afterChange&&t.push(this.registerAfterChangeHandler(n,o.afterChange)),null!==o&&void 0!==o&&o.beforeDelete&&t.push(this.registerBeforeDeleteHandler(n,o.beforeDelete)),null!==o&&void 0!==o&&o.afterDelete&&t.push(this.registerAfterDeleteHandler(n,o.afterDelete));return()=>{for(const e of t)e()}}registerBeforeCreateHandler(e,t){return this._beforeCreateHandlers[e]||(this._beforeCreateHandlers[e]=[]),this._beforeCreateHandlers[e].push(t),()=>Tn(this._beforeCreateHandlers[e],t)}registerAfterCreateHandler(e,t){return this._afterCreateHandlers[e]||(this._afterCreateHandlers[e]=[]),this._afterCreateHandlers[e].push(t),()=>Tn(this._afterCreateHandlers[e],t)}registerBeforeChangeHandler(e,t){return this._beforeChangeHandlers[e]||(this._beforeChangeHandlers[e]=[]),this._beforeChangeHandlers[e].push(t),()=>Tn(this._beforeChangeHandlers[e],t)}registerAfterChangeHandler(e,t){return this._afterChangeHandlers[e]||(this._afterChangeHandlers[e]=[]),this._afterChangeHandlers[e].push(t),()=>Tn(this._afterChangeHandlers[e],t)}registerBeforeDeleteHandler(e,t){return this._beforeDeleteHandlers[e]||(this._beforeDeleteHandlers[e]=[]),this._beforeDeleteHandlers[e].push(t),()=>Tn(this._beforeDeleteHandlers[e],t)}registerAfterDeleteHandler(e,t){return this._afterDeleteHandlers[e]||(this._afterDeleteHandlers[e]=[]),this._afterDeleteHandlers[e].push(t),()=>Tn(this._afterDeleteHandlers[e],t)}registerOperationCompleteHandler(e){return this._operationCompleteHandlers.push(e),()=>Tn(this._operationCompleteHandlers,e)}}function Tn(e,t){const n=e.indexOf(t);n>=0&&e.splice(n,1)}class Mn{cancelHistoryReactor(){}constructor(e){s(this,"id",void 0),s(this,"atoms",Qt("store_atoms",{})),s(this,"history",Qt("history",0,{historyLength:1e3})),s(this,"query",new En(this.atoms,this.history)),s(this,"listeners",new Set),s(this,"historyAccumulator",new An),s(this,"historyReactor",void 0),s(this,"schema",void 0),s(this,"props",void 0),s(this,"scopedTypes",void 0),s(this,"sideEffects",new jn(this)),s(this,"isMergingRemoteChanges",!1),s(this,"_integrityChecker",void 0),s(this,"_isPossiblyCorrupted",!1),s(this,"pendingAfterEvents",null),s(this,"_isInAtomicOp",!1);const{initialData:t,schema:n,id:o}=e;this.id=null!==o&&void 0!==o?o:$(),this.schema=n,this.props=e.props,t&&this.atoms.set(me(ge(t).map((e=>{let[t,n]=e;return[t,Qt("atom:"+t,this.schema.validateRecord(this,n,"initialize",null))]})))),this.historyReactor=function(e,t,n){const o=new Ut(e,t,n);return{scheduler:o,start:e=>{var t;const n=null!==(t=null===e||void 0===e?void 0:e.force)&&void 0!==t&&t;o.attach(),n?o.scheduleEffect():o.maybeScheduleEffect()},stop:()=>{o.detach()}}}("Store.historyReactor",(()=>{this.history.get(),this._flushHistory()}),{scheduleEffect:e=>this.cancelHistoryReactor=gt(e)}),this.scopedTypes={document:new Set(fe(this.schema.types).filter((e=>"document"===e.scope)).map((e=>e.typeName))),session:new Set(fe(this.schema.types).filter((e=>"session"===e.scope)).map((e=>e.typeName))),presence:new Set(fe(this.schema.types).filter((e=>"presence"===e.scope)).map((e=>e.typeName)))}}_flushHistory(){if(this.historyAccumulator.hasChanges()){const o=this.historyAccumulator.flush();for(const{changes:r,source:i}of o){let o=null,s=null,a=null;for(const{onHistory:l,filters:c}of this.listeners)if("all"===c.source||c.source===i)if("all"!==c.scope)if("document"===c.scope){var e;if(null!==(e=s)&&void 0!==e||(s=this.filterChangesByScope(r,"document")),!s)continue;l({changes:s,source:i})}else if("session"===c.scope){var t;if(null!==(t=o)&&void 0!==t||(o=this.filterChangesByScope(r,"session")),!o)continue;l({changes:o,source:i})}else{var n;if(null!==(n=a)&&void 0!==n||(a=this.filterChangesByScope(r,"presence")),!a)continue;l({changes:a,source:i})}else l({changes:r,source:i})}}}dispose(){this.cancelHistoryReactor()}filterChangesByScope(e,t){const n={added:ye(e.added,((e,n)=>this.scopedTypes[t].has(n.typeName))),updated:ye(e.updated,((e,n)=>this.scopedTypes[t].has(n[1].typeName))),removed:ye(e.removed,((e,n)=>this.scopedTypes[t].has(n.typeName)))};return 0===Object.keys(n.added).length&&0===Object.keys(n.updated).length&&0===Object.keys(n.removed).length?null:n}updateHistory(e){this.historyAccumulator.add({changes:e,source:this.isMergingRemoteChanges?"remote":"user"}),0===this.listeners.size&&this.historyAccumulator.clear(),this.history.set(this.history.get()+1,e)}validate(e){this.allRecords().forEach((t=>this.schema.validateRecord(this,t,e,null)))}put(e,t){this.atomic((()=>{const n={},o={},r=this.atoms.__unsafe__getWithoutCapture();let i,s=null,a=!1;const c=this.isMergingRemoteChanges?"remote":"user";for(let u=0,h=e.length;u<h;u++){var d;i=e[u];const h=(null!==(d=s)&&void 0!==d?d:r)[i.id];if(h){const e=h.__unsafe__getWithoutCapture();i=this.sideEffects.handleBeforeChange(e,i,c);if(this.schema.validateRecord(this,i,null!==t&&void 0!==t?t:"updateRecord",e)===e)continue;h.set(i),a=!0;const o=h.__unsafe__getWithoutCapture();n[i.id]=[e,o],this.addDiffForAfterEvent(e,o)}else i=this.sideEffects.handleBeforeCreate(i,c),a=!0,i=this.schema.validateRecord(this,i,null!==t&&void 0!==t?t:"createRecord",null),o[i.id]=i,this.addDiffForAfterEvent(null,i),s||(s=l({},r)),s[i.id]=Qt("atom:"+i.id,i)}s&&this.atoms.set(s),a&&this.updateHistory({added:o,updated:n,removed:{}})}))}remove(e){this.atomic((()=>{const t=new Set,n=this.isMergingRemoteChanges?"remote":"user";if(this.sideEffects.isEnabled())for(const r of e){const e=this.atoms.__unsafe__getWithoutCapture()[r];e&&(!1===this.sideEffects.handleBeforeDelete(e.get(),n)&&t.add(r))}let o;this.atoms.update((n=>{var r;let i;for(const s of e){if(t.has(s))continue;if(!(s in n))continue;i||(i=l({},n)),o||(o={}),delete i[s];const e=n[s].get();o[s]=e,this.addDiffForAfterEvent(e,null)}return null!==(r=i)&&void 0!==r?r:n})),o&&this.updateHistory({added:{},updated:{},removed:o})}))}get(e){var t;return null===(t=this.atoms.get()[e])||void 0===t?void 0:t.get()}unsafeGetWithoutCapture(e){var t;return null===(t=this.atoms.__unsafe__getWithoutCapture()[e])||void 0===t?void 0:t.__unsafe__getWithoutCapture()}serialize(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"document";const t={};for(const[n,o]of ge(this.atoms.get())){const r=o.get();("all"===e||this.scopedTypes[e].has(r.typeName))&&(t[n]=r)}return t}getStoreSnapshot(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"document";return{store:this.serialize(e),schema:this.schema.serialize()}}getSnapshot(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"document";return console.warn("[tldraw] `Store.getSnapshot` is deprecated and will be removed in a future release. Use `getSnapshot` from the `tldraw` package instead."),this.getStoreSnapshot(e)}migrateSnapshot(e){const t=this.schema.migrateStoreSnapshot(e);if("error"===t.type)throw new Error("Failed to migrate snapshot: ".concat(t.reason));return{store:t.value,schema:this.schema.serialize()}}loadStoreSnapshot(e){const t=this.schema.migrateStoreSnapshot(e);if("error"===t.type)throw new Error("Failed to migrate snapshot: ".concat(t.reason));const n=this.sideEffects.isEnabled();try{this.sideEffects.setIsEnabled(!1),this.atomic((()=>{this.clear(),this.put(Object.values(t.value)),this.ensureStoreIsUsable()}))}finally{this.sideEffects.setIsEnabled(n)}}loadSnapshot(e){console.warn("[tldraw] `Store.loadSnapshot` is deprecated and will be removed in a future release. Use `loadSnapshot` from the 'tldraw' package instead."),this.loadStoreSnapshot(e)}allRecords(){return fe(this.atoms.get()).map((e=>e.get()))}clear(){this.remove(pe(this.atoms.get()))}update(e,t){const n=this.atoms.get()[e];n?this.put([t(n.__unsafe__getWithoutCapture())]):console.error("Record ".concat(e," not found. This is probably an error"))}has(e){return!!this.atoms.get()[e]}listen(e,t){var n,o;this._flushHistory();const r={onHistory:e,filters:{source:null!==(n=null===t||void 0===t?void 0:t.source)&&void 0!==n?n:"all",scope:null!==(o=null===t||void 0===t?void 0:t.scope)&&void 0!==o?o:"all"}};return this.listeners.add(r),this.historyReactor.scheduler.isActivelyListening||this.historyReactor.start(),()=>{this.listeners.delete(r),0===this.listeners.size&&this.historyReactor.stop()}}mergeRemoteChanges(e){if(this.isMergingRemoteChanges)return e();if(this._isInAtomicOp)throw new Error("Cannot merge remote changes while in atomic operation");try{this.isMergingRemoteChanges=!0,Xt(e)}finally{this.isMergingRemoteChanges=!1,this.ensureStoreIsUsable()}}extractingChanges(e){const t=[],n=this.historyAccumulator.addInterceptor((e=>t.push(e.changes)));try{return Xt(e),kn(t)}finally{n()}}applyDiff(e){let{runCallbacks:t=!0,ignoreEphemeralKeys:n=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.atomic((()=>{const t=fe(e.added);for(const[r,i]of fe(e.updated)){const e=this.schema.getType(i.typeName);if(n&&e.ephemeralKeySet.size){const n=this.get(i.id);if(!n){t.push(i);continue}let o=null;for(const[t,r]of Object.entries(i))e.ephemeralKeySet.has(t)||Object.is(r,he(n,t))||(o||(o=l({},n)),o[t]=r);o&&t.push(o)}else t.push(i)}const o=pe(e.removed);t.length&&this.put(t),o.length&&this.remove(o)}),t)}createComputedCache(e,t,n){const o=new L;return{get:r=>{const i=this.atoms.get()[r];if(i)return o.get(i,(()=>{const o=n?cn(i.name+":equals",(()=>i.get()),{isEqual:n}):i;return cn(e+":"+r,(()=>t(o.get())))})).get()}}}createSelectedComputedCache(e,t,n){const o=new L;return{get:r=>{const i=this.atoms.get()[r];if(i)return o.get(i,(()=>{const o=cn(e+":"+r+":selector",(()=>t(i.get())));return cn(e+":"+r,(()=>n(o.get())))})).get()}}}ensureStoreIsUsable(){this.atomic((()=>{var e,t;null!==(e=this._integrityChecker)&&void 0!==e||(this._integrityChecker=this.schema.createIntegrityChecker(this)),null===(t=this._integrityChecker)||void 0===t||t.call(this)}))}markAsPossiblyCorrupted(){this._isPossiblyCorrupted=!0}isPossiblyCorrupted(){return this._isPossiblyCorrupted}addDiffForAfterEvent(e,t){if(M(this.pendingAfterEvents,"must be in event operation"),e===t)return;if(e&&t&&M(e.id===t.id),!e&&!t)return;const n=(e||t).id,o=this.pendingAfterEvents.get(n);o?o.after=t:this.pendingAfterEvents.set(n,{before:e,after:t})}flushAtomicCallbacks(){let e=0;const t=this.isMergingRemoteChanges?"remote":"user";for(;this.pendingAfterEvents;){const n=this.pendingAfterEvents;if(this.pendingAfterEvents=null,this.sideEffects.isEnabled()){if(e++,e>100)throw new Error("Maximum store update depth exceeded, bailing out");for(const{before:e,after:o}of n.values())e&&o?this.sideEffects.handleAfterChange(e,o,t):e&&!o?this.sideEffects.handleAfterDelete(e,t):!e&&o&&this.sideEffects.handleAfterCreate(o,t);this.pendingAfterEvents||this.sideEffects.handleOperationComplete(t)}}}atomic(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return Xt((()=>{if(this._isInAtomicOp)return this.pendingAfterEvents||(this.pendingAfterEvents=new Map),e();this.pendingAfterEvents=new Map;const n=this.sideEffects.isEnabled();this.sideEffects.setIsEnabled(null!==t&&void 0!==t?t:n),this._isInAtomicOp=!0;try{const t=e();return this.flushAtomicCallbacks(),t}finally{this.pendingAfterEvents=null,this.sideEffects.setIsEnabled(n),this._isInAtomicOp=!1}}))}addHistoryInterceptor(e){return this.historyAccumulator.addInterceptor((t=>e(t,this.isMergingRemoteChanges?"remote":"user")))}}class An{constructor(){s(this,"_history",[]),s(this,"_interceptors",new Set)}addInterceptor(e){return this._interceptors.add(e),()=>{this._interceptors.delete(e)}}add(e){this._history.push(e);for(const t of this._interceptors)t(e)}flush(){const e=function(e){if(0===e.length)return[];const t=[];let n,o=[e[0]];for(let r=1,i=e.length;r<i;r++)n=e[r],o[0].source!==n.source&&(t.push(o),o=[]),o.push(n);return t.push(o),t.map((e=>({source:e[0].source,changes:kn(e.map((e=>e.changes)))})))}(this._history);return this._history=[],e}clear(){this._history=[]}hasChanges(){return this._history.length>0}}function On(e){const t=[];for(let o=e.length-1;o>=0;o--){const r=e[o];if("id"in r)t.unshift(r);else{const e=r.dependsOn,o=t[0];var n;if(o)t[0]=l(l({},o),{},{dependsOn:e.concat(null!==(n=o.dependsOn)&&void 0!==n?n:[])})}}return t}function Dn(e){let{sequence:t,sequenceId:n,retroactive:o=!0}=e;const r={sequenceId:n,retroactive:o,sequence:On(t)};return Fn(r),r}function Rn(e,t){return Object.fromEntries(ge(t).map((t=>{let[n,o]=t;return[n,"".concat(e,"/").concat(o)]})))}function Ln(e){var t;return Dn({sequenceId:e.sequenceId,retroactive:null===(t=e.retroactive)||void 0===t||t,sequence:e.sequence.map((t=>"id"in t?l(l({},t),{},{scope:"record",filter:n=>{var o,r,i,s;return n.typeName===e.recordType&&(null===(o=null===(r=t.filter)||void 0===r?void 0:r.call(t,n))||void 0===o||o)&&(null===(i=null===(s=e.filter)||void 0===s?void 0:s.call(e,n))||void 0===i||i)}}):t))})}function zn(e){const[t,n]=e.split("/");return{sequenceId:t,version:parseInt(n)}}function Nn(e,t){t&&M(e.startsWith(t+"/"),"Every migration in sequence '".concat(t,"' must have an id starting with '").concat(t,"/'. Got invalid id: '").concat(e,"'")),M(e.match(/^(.*?)\/(0|[1-9]\d*)$/),"Invalid migration id: '".concat(e,"'"))}function Fn(e){if(M(!e.sequenceId.includes("/"),"sequenceId cannot contain a '/', got ".concat(e.sequenceId)),M(e.sequenceId.length,"sequenceId must be a non-empty string"),0===e.sequence.length)return;Nn(e.sequence[0].id,e.sequenceId);let t=zn(e.sequence[0].id).version;M(1===t,"Expected the first migrationId to be '".concat(e.sequenceId,"/1' but got '").concat(e.sequence[0].id,"'"));for(let n=1;n<e.sequence.length;n++){const o=e.sequence[n].id;Nn(o,e.sequenceId);const r=zn(o).version;M(r===t+1,"Migration id numbers must increase in increments of 1, expected ".concat(e.sequenceId,"/").concat(t+1," but got '").concat(e.sequence[n].id,"'")),t=r}}var Bn=(e=>(e.IncompatibleSubtype="incompatible-subtype",e.UnknownType="unknown-type",e.TargetVersionTooNew="target-version-too-new",e.TargetVersionTooOld="target-version-too-old",e.MigrationError="migration-error",e.UnrecognizedSubtype="unrecognized-subtype",e))(Bn||{});class Un{constructor(e,t){s(this,"migrations",{}),s(this,"sortedMigrations",void 0),this.types=e,this.options=t;for(const i of null!==(n=t.migrations)&&void 0!==n?n:[]){var n;M(!this.migrations[i.sequenceId],"Duplicate migration sequenceId ".concat(i.sequenceId)),Fn(i),this.migrations[i.sequenceId]=i}const o=Object.values(this.migrations).flatMap((e=>e.sequence));this.sortedMigrations=function(e){const t=new Map(e.map((e=>[e.id,e]))),n=new Set,o=[];function r(e){M(!n.has(e.id),"Circular dependency in migrations: ".concat(e.id)),n.add(e.id);const{version:i,sequenceId:s}=zn(e.id),a=t.get("".concat(s,"/").concat(i-1));if(a&&r(a),e.dependsOn)for(const n of e.dependsOn){const e=t.get(n);e&&r(e)}t.delete(e.id),o.push(e)}for(const i of t.values())r(i);return o}(o);for(const i of this.sortedMigrations){var r;if(null!==(r=i.dependsOn)&&void 0!==r&&r.length)for(const e of i.dependsOn){const t=o.find((t=>t.id===e));M(t,"Migration '".concat(i.id,"' depends on missing migration '").concat(e,"'"))}}}static create(e,t){return new Un(e,null!==t&&void 0!==t?t:{})}validateRecord(e,t,n,o){try{const e=he(this.types,t.typeName);if(!e)throw new Error("Missing definition for record type ".concat(t.typeName));return e.validate(t,null!==o&&void 0!==o?o:void 0)}catch(r){if(this.options.onValidationFailure)return this.options.onValidationFailure({store:e,record:t,phase:n,recordBefore:o,error:r});throw r}}getMigrationsSince(e){const t=function(e){if(e.schemaVersion>2||e.schemaVersion<1)return j.err("Bad schema version");if(2===e.schemaVersion)return j.ok(e);const t={schemaVersion:2,sequences:{"com.tldraw.store":e.storeVersion}};for(const[n,o]of Object.entries(e.recordVersions))if(t.sequences["com.tldraw.".concat(n)]=o.version,"subTypeKey"in o)for(const[e,r]of Object.entries(o.subTypeVersions))t.sequences["com.tldraw.".concat(n,".").concat(e)]=r;return j.ok(t)}(e);if(!t.ok)return t;const n=t.value,o=new Set(Object.keys(n.sequences).filter((e=>this.migrations[e])));for(const i in this.migrations)void 0===n.sequences[i]&&this.migrations[i].retroactive&&o.add(i);if(0===o.size)return j.ok([]);const r=new Set;for(const i of o){const e=n.sequences[i];if("number"!==typeof e&&this.migrations[i].retroactive||0===e){for(const e of this.migrations[i].sequence)r.add(e.id);continue}const t="".concat(i,"/").concat(e),o=this.migrations[i].sequence.findIndex((e=>e.id===t));if(-1===o)return j.err("Incompatible schema?");for(const n of this.migrations[i].sequence.slice(o+1))r.add(n.id)}return j.ok(this.sortedMigrations.filter((e=>{let{id:t}=e;return r.has(t)})))}migratePersistedRecord(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"up";const o=this.getMigrationsSince(t);if(!o.ok)return console.error("Error migrating record",o.error),{type:"error",reason:Bn.MigrationError};let r=o.value;if(0===r.length)return{type:"success",value:e};if(r.some((e=>"store"===e.scope)))return{type:"error",reason:"down"===n?Bn.TargetVersionTooOld:Bn.TargetVersionTooNew};if("down"===n){if(!r.every((e=>e.down)))return{type:"error",reason:Bn.TargetVersionTooOld};r=r.slice().reverse()}e=bt(e);try{for(const t of r){if("store"===t.scope)throw new Error;if(!(!t.filter||t.filter(e)))continue;const o=t[n](e);o&&(e=bt(o))}}catch(i){return console.error("Error migrating record",i),{type:"error",reason:Bn.MigrationError}}return{type:"success",value:e}}migrateStoreSnapshot(e){let{store:t}=e;const n=this.getMigrationsSince(e.schema);if(!n.ok)return console.error("Error migrating store",n.error),{type:"error",reason:Bn.MigrationError};const o=n.value;if(0===o.length)return{type:"success",value:t};t=bt(t);try{for(const e of o)if("record"===e.scope)for(const[n,o]of Object.entries(t)){if(!(!e.filter||e.filter(o)))continue;const r=e.up(o);r&&(t[n]=bt(r))}else if("store"===e.scope){const n=e.up(t);n&&(t=bt(n))}else T(e)}catch(r){return console.error("Error migrating store",r),{type:"error",reason:Bn.MigrationError}}return{type:"success",value:t}}createIntegrityChecker(e){var t,n,o;return null!==(t=null===(n=(o=this.options).createIntegrityChecker)||void 0===n?void 0:n.call(o,e))&&void 0!==t?t:void 0}serialize(){return{schemaVersion:2,sequences:Object.fromEntries(Object.values(this.migrations).map((e=>{let{sequenceId:t,sequence:n}=e;return[t,n.length?zn(n.at(-1).id).version:0]})))}}serializeEarliestVersion(){return{schemaVersion:2,sequences:Object.fromEntries(Object.values(this.migrations).map((e=>{let{sequenceId:t}=e;return[t,0]})))}}getType(e){const t=he(this.types,e);return M(t,"record type does not exists"),t}}u("@tldraw/store","3.6.1","esm");class Hn extends Error{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];const n=function(e){if(!e.length)return null;let t="";for(const n of e)"number"===typeof n?t+=".".concat(n):n.startsWith("(")?t.endsWith(")")?t="".concat(t.slice(0,-1),", ").concat(n.slice(1)):t+=n:t+=".".concat(n);return t=t.replace(/id = [^,]+, /,"").replace(/id = [^)]+/,""),t.startsWith(".")?t.slice(1):t}(t),o=e.split("\n").map(((e,t)=>0===t?e:"  ".concat(e))).join("\n");super(t?"At ".concat(n,": ").concat(o):o),s(this,"name","ValidationError"),this.rawMessage=e,this.path=t}}function Kn(e,t){try{return t()}catch(n){if(n instanceof Hn)throw new Hn(n.rawMessage,[e,...n.path]);throw new Hn(n.toString(),[e])}}function Vn(e){if(null===e)return"null";if(Array.isArray(e))return"an array";const t=typeof e;switch(t){case"bigint":case"boolean":case"function":case"number":case"string":case"symbol":return"a ".concat(t);case"object":return"an ".concat(t);case"undefined":return"undefined";default:T(t)}}class Wn{constructor(e,t){this.validationFn=e,this.validateUsingKnownGoodVersionFn=t}validate(e){return this.validationFn(e)}validateUsingKnownGoodVersion(e,t){return Object.is(e,t)?e:this.validateUsingKnownGoodVersionFn?this.validateUsingKnownGoodVersionFn(e,t):this.validate(t)}isValid(e){try{return this.validate(e),!0}catch(t){return!1}}nullable(){return e=this,new Wn((t=>null===t?null:e.validate(t)),((t,n)=>null===n?null:e.validateUsingKnownGoodVersion&&null!==t?e.validateUsingKnownGoodVersion(t,n):e.validate(n)));var e}optional(){return vo(this)}refine(e){return new Wn((t=>e(this.validate(t))),((t,n)=>{const o=this.validateUsingKnownGoodVersion(t,n);return Object.is(t,o)?t:e(o)}))}check(e,t){return"string"===typeof e?this.refine((n=>(Kn("(check ".concat(e,")"),(()=>t(n))),n))):this.refine((t=>(e(t),t)))}}class qn extends Wn{constructor(e){super((t=>{const n=ao.validate(t);for(let o=0;o<n.length;o++)Kn(o,(()=>e.validate(n[o])));return n}),((t,n)=>{if(!e.validateUsingKnownGoodVersion)return this.validate(n);const o=ao.validate(n);let r=t.length!==o.length;for(let i=0;i<o.length;i++){const n=o[i];if(i>=t.length){r=!0,Kn(i,(()=>e.validate(n)));continue}if(Object.is(t[i],n))continue;const s=Kn(i,(()=>e.validateUsingKnownGoodVersion(t[i],n)));Object.is(s,t[i])||(r=!0)}return r?n:t})),this.itemValidator=e}nonEmpty(){return this.check((e=>{if(0===e.length)throw new Hn("Expected a non-empty array")}))}lengthGreaterThan1(){return this.check((e=>{if(e.length<=1)throw new Hn("Expected an array with length greater than 1")}))}}class Yn extends Wn{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];super((n=>{if("object"!==typeof n||null===n)throw new Hn("Expected object, got ".concat(Vn(n)));for(const[t,o]of Object.entries(e))Kn(t,(()=>{o.validate(he(n,t))}));if(!t)for(const t of Object.keys(n))if(!ue(e,t))throw new Hn("Unexpected property",[t]);return n}),((n,o)=>{if("object"!==typeof o||null===o)throw new Hn("Expected object, got ".concat(Vn(o)));let r=!1;for(const[t,i]of Object.entries(e)){const e=he(n,t),s=he(o,t);if(Object.is(e,s))continue;const a=Kn(t,(()=>{const t=i;return t.validateUsingKnownGoodVersion?t.validateUsingKnownGoodVersion(e,s):t.validate(s)}));Object.is(a,e)||(r=!0)}if(!t)for(const t of Object.keys(o))if(!ue(e,t))throw new Hn("Unexpected property",[t]);for(const e of Object.keys(n))if(!ue(o,e)){r=!0;break}return r?o:n})),this.config=e,this.shouldAllowUnknownProperties=t}allowUnknownProperties(){return new Yn(this.config,!0)}extend(e){return new Yn(l(l({},this.config),e))}}class Gn extends Wn{constructor(e,t,n,o){super((t=>{this.expectObject(t);const{matchingSchema:n,variant:o}=this.getMatchingSchemaAndVariant(t);return void 0===n?this.unknownValueValidation(t,o):Kn("(".concat(e," = ").concat(o,")"),(()=>n.validate(t)))}),((t,n)=>{this.expectObject(n),this.expectObject(t);const{matchingSchema:o,variant:r}=this.getMatchingSchemaAndVariant(n);return void 0===o?this.unknownValueValidation(n,r):he(t,e)!==he(n,e)?Kn("(".concat(e," = ").concat(r,")"),(()=>o.validate(n))):Kn("(".concat(e," = ").concat(r,")"),(()=>o.validateUsingKnownGoodVersion?o.validateUsingKnownGoodVersion(t,n):o.validate(n)))})),this.key=e,this.config=t,this.unknownValueValidation=n,this.useNumberKeys=o}expectObject(e){if("object"!==typeof e||null===e)throw new Hn("Expected an object, got ".concat(Vn(e)),[])}getMatchingSchemaAndVariant(e){const t=he(e,this.key);if(!this.useNumberKeys&&"string"!==typeof t)throw new Hn('Expected a string for key "'.concat(this.key,'", got ').concat(Vn(t)));if(this.useNumberKeys&&!Number.isFinite(Number(t)))throw new Hn('Expected a number for key "'.concat(this.key,'", got "').concat(t,'"'));return{matchingSchema:ue(this.config,t)?this.config[t]:void 0,variant:t}}validateUnknownVariants(e){return new Gn(this.key,this.config,e,this.useNumberKeys)}}class Xn extends Wn{constructor(e,t){super((n=>{if("object"!==typeof n||null===n)throw new Hn("Expected object, got ".concat(Vn(n)));for(const[o,r]of Object.entries(n))Kn(o,(()=>{e.validate(o),t.validate(r)}));return n}),((n,o)=>{if("object"!==typeof o||null===o)throw new Hn("Expected object, got ".concat(Vn(o)));let r=!1;for(const[i,s]of Object.entries(o)){if(!ue(n,i)){r=!0,Kn(i,(()=>{e.validate(i),t.validate(s)}));continue}const o=he(n,i),a=s;if(Object.is(o,a))continue;const l=Kn(i,(()=>t.validateUsingKnownGoodVersion?t.validateUsingKnownGoodVersion(o,a):t.validate(a)));Object.is(l,o)||(r=!0)}for(const e of Object.keys(n))if(!ue(o,e)){r=!0;break}return r?o:n})),this.keyValidator=e,this.valueValidator=t}}function $n(e){return new Wn((t=>{if(typeof t!==e)throw new Hn("Expected ".concat(e,", got ").concat(Vn(t)));return t}))}new Wn((e=>e));const Zn=new Wn((e=>e)),Qn=$n("string"),Jn=$n("number").check((e=>{if(Number.isNaN(e))throw new Hn("Expected a number, got NaN");if(!Number.isFinite(e))throw new Hn("Expected a finite number, got ".concat(e))})),eo=Jn.check((e=>{if(e<0)throw new Hn("Expected a positive number, got ".concat(e))})),to=Jn.check((e=>{if(e<=0)throw new Hn("Expected a non-zero positive number, got ".concat(e))})),no=Jn.check((e=>{if(!Number.isInteger(e))throw new Hn("Expected an integer, got ".concat(e))})),oo=no.check((e=>{if(e<0)throw new Hn("Expected a positive integer, got ".concat(e))})),ro=no.check((e=>{if(e<=0)throw new Hn("Expected a non-zero positive integer, got ".concat(e))})),io=$n("boolean");$n("bigint");function so(e){return new Wn((t=>{if(t!==e)throw new Hn("Expected ".concat(e,", got ").concat(JSON.stringify(t)));return e}))}const ao=new Wn((e=>{if(!Array.isArray(e))throw new Hn("Expected an array, got ".concat(Vn(e)));return e}));function lo(e){return new qn(e)}new Wn((e=>{if("object"!==typeof e||null===e)throw new Hn("Expected object, got ".concat(Vn(e)));return e}));function co(e){return new Yn(e)}function uo(e){return"object"===typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e)||Object.getPrototypeOf(e)===wt)}function ho(e){return null===e||"number"===typeof e||"string"===typeof e||"boolean"===typeof e||(Array.isArray(e)?e.every(ho):!!uo(e)&&Object.values(e).every(ho))}const po=new Wn((e=>{if(ho(e))return e;throw new Hn("Expected json serializable value, got ".concat(typeof e))}),((e,t)=>{if(Array.isArray(e)&&Array.isArray(t)){let n=e.length!==t.length;for(let o=0;o<t.length;o++){if(o>=e.length){n=!0,po.validate(t[o]);continue}const r=e[o],i=t[o];if(Object.is(r,i))continue;const s=po.validateUsingKnownGoodVersion(r,i);Object.is(s,r)||(n=!0)}return n?t:e}if(uo(e)&&uo(t)){let n=!1;for(const o of Object.keys(t)){if(!ue(e,o)){n=!0,po.validate(t[o]);continue}const r=e[o],i=t[o];if(Object.is(r,i))continue;const s=po.validateUsingKnownGoodVersion(r,i);Object.is(s,r)||(n=!0)}for(const o of Object.keys(e))if(!ue(t,o)){n=!0;break}return n?t:e}return po.validate(t)}));function fo(e,t){return new Xn(e,t)}function go(e,t){return new Gn(e,t,((n,o)=>{throw new Hn("Expected one of ".concat(Object.keys(t).map((e=>JSON.stringify(e))).join(" or "),", got ").concat(JSON.stringify(o)),[e])}),!1)}function mo(e,t){return new Wn((n=>Kn(e,(()=>t.validate(n)))),((n,o)=>Kn(e,(()=>t.validateUsingKnownGoodVersion?t.validateUsingKnownGoodVersion(n,o):t.validate(o)))))}function yo(e){return new Wn((t=>{if(!e.has(t)){const n=Array.from(e,(e=>JSON.stringify(e))).join(" or ");throw new Hn("Expected ".concat(n,", got ").concat(t))}return t}))}function vo(e){return new Wn((t=>{if(void 0!==t)return e.validate(t)}),((t,n)=>{if((void 0!==t||void 0!==n)&&void 0!==n)return e.validateUsingKnownGoodVersion&&void 0!==t?e.validateUsingKnownGoodVersion(t,n):e.validate(n)}))}function bo(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return yo(new Set(t))}function wo(e){try{return new URL(e)}catch(t){if(e.startsWith("/")||e.startsWith("./"))try{return new URL(e,"http://example.com")}catch(n){throw new Hn("Expected a valid url, got ".concat(JSON.stringify(e)))}throw new Hn("Expected a valid url, got ".concat(JSON.stringify(e)))}}const xo=new Set(["http:","https:","mailto:"]),So=Qn.check((e=>{if(""===e)return;const t=wo(e);if(!xo.has(t.protocol.toLowerCase()))throw new Hn("Expected a valid url, got ".concat(JSON.stringify(e)," (invalid protocol)"))})),ko=new Set(["http:","https:","data:","asset:"]),Po=Qn.check((e=>{if(""===e)return;const t=wo(e);if(!ko.has(t.protocol.toLowerCase()))throw new Hn("Expected a valid url, got ".concat(JSON.stringify(e)," (invalid protocol)"))})),Co=(Qn.check((e=>{if(""===e)return;if(!wo(e).protocol.toLowerCase().match(/^https?:$/))throw new Hn("Expected a valid url, got ".concat(JSON.stringify(e)," (invalid protocol)"))})),Qn.refine((e=>{try{return function(e){try{Ve(e,null)}catch(t){throw new Error("invalid index: "+e)}}(e),e}catch(t){throw new Hn("Expected an index key, got ".concat(JSON.stringify(e)))}})));function _o(e){return Qn.refine((t=>{if(!t.startsWith("".concat(e,":")))throw new Error("".concat(e,' ID must start with "').concat(e,':"'));return t}))}u("@tldraw/validate","3.6.1","esm");const Io=_o("asset");function Eo(e,t){return co({id:Io,typeName:so("asset"),type:so(e),props:t,meta:po})}const jo=co({x:Jn,y:Jn,z:Jn.optional()}),To=co({x:Jn,y:Jn,w:Jn,h:Jn}),Mo=Jn.check((e=>{if(e<0||e>1)throw new Hn("Opacity must be between 0 and 1")})),Ao=Qn.refine((e=>{if(!e.startsWith("page:")&&!e.startsWith("shape:"))throw new Error('Parent ID must start with "page:" or "shape:"');return e})),Oo=_o("shape");const Do=_o("binding");Rn("com.tldraw.binding",{}),Ln({sequenceId:"com.tldraw.binding",recordType:"binding",sequence:[]});function Ro(e){return"binding:".concat(null!==e&&void 0!==e?e:$())}function Lo(e){return wn("binding",{scope:"document",validator:mo("binding",go("type",ve(e,((e,t)=>{let{props:n,meta:o}=t;return function(e,t,n){return co({id:Do,typeName:so("binding"),type:so(e),fromId:Oo,toId:Oo,props:t?co(t):po,meta:n?co(n):po})}(e,n,o)}))))}).withDefaultProperties((()=>({meta:{}})))}class zo{constructor(e,t,n){this.id=e,this.defaultValue=t,this.type=n}static define(e,t){const{defaultValue:n,type:o=Zn}=t;return new zo(e,n,o)}static defineEnum(e,t){const{defaultValue:n,values:o}=t;return new No(e,n,o)}setDefaultValue(e){this.defaultValue=e}validate(e){return this.type.validate(e)}validateUsingKnownGoodVersion(e,t){return this.type.validateUsingKnownGoodVersion?this.type.validateUsingKnownGoodVersion(e,t):this.validate(t)}}class No extends zo{constructor(e,t,n){super(e,t,bo(...n)),this.values=n}}const Fo=Rn("com.tldraw.shape",{AddIsLocked:1,HoistOpacity:2,AddMeta:3,AddWhite:4}),Bo=Ln({sequenceId:"com.tldraw.shape",recordType:"shape",sequence:[{id:Fo.AddIsLocked,up:e=>{e.isLocked=!1},down:e=>{delete e.isLocked}},{id:Fo.HoistOpacity,up:e=>{var t;e.opacity=Number(null!==(t=e.props.opacity)&&void 0!==t?t:"1"),delete e.props.opacity},down:e=>{const t=e.opacity;delete e.opacity,e.props.opacity=t<.175?"0.1":t<.375?"0.25":t<.625?"0.5":t<.875?"0.75":"1"}},{id:Fo.AddMeta,up:e=>{e.meta={}}},{id:Fo.AddWhite,up:e=>{},down:e=>{"white"===e.props.color&&(e.props.color="black")}}]});function Uo(e){return!!e&&"shape"===e.typeName}function Ho(e){return!!e&&e.startsWith("shape:")}function Ko(e){return"shape:".concat(null!==e&&void 0!==e?e:$())}function Vo(e){const t=new Map;for(const[n,o]of Object.entries(e))if(o instanceof zo){if(t.has(o))throw new Error("Duplicate style prop ".concat(o.id,". Each style prop can only be used once within a shape."));t.set(o,n)}return t}function Wo(e,t){return ve(t,((t,n)=>"com.tldraw.shape.".concat(e,"/").concat(n)))}function qo(e){return wn("shape",{scope:"document",validator:mo("shape",go("type",ve(e,((e,t)=>{let{props:n,meta:o}=t;return function(e,t,n){return co({id:Oo,typeName:so("shape"),x:Jn,y:Jn,rotation:Jn,index:Co,parentId:Ao,type:so(e),isLocked:io,opacity:Mo,props:t?co(t):po,meta:n?co(n):po})}(e,n,o)}))))}).withDefaultProperties((()=>({x:0,y:0,rotation:0,isLocked:!1,opacity:1,meta:{}})))}function Yo(e,t){const n=[];for(const[o,{migrations:r}]of Object.entries(t)){const t="com.tldraw.".concat(e,".").concat(o);r?"sequenceId"in r?(M(t===r.sequenceId,"sequenceId mismatch for ".concat(o," ").concat(bn," migrations. Expected '").concat(t,"', got '").concat(r.sequenceId,"'")),n.push(r)):"sequence"in r?n.push(Dn({sequenceId:t,retroactive:!1,sequence:r.sequence.map((t=>"id"in t?Go(e,o,t):t))})):n.push(Dn({sequenceId:t,retroactive:!1,sequence:Object.keys(r.migrators).map((e=>Number(e))).sort(((e,t)=>e-t)).map((n=>({id:"".concat(t,"/").concat(n),scope:"record",filter:t=>t.typeName===e&&t.type===o,up:e=>{const t=r.migrators[n].up(e);if(t)return t},down:e=>{const t=r.migrators[n].down(e);if(t)return t}})))})):n.push(Dn({sequenceId:t,retroactive:!1,sequence:[]}))}return n}function Go(e,t,n){return{id:n.id,dependsOn:n.dependsOn,scope:"record",filter:n=>n.typeName===e&&n.type===t,up:e=>{const t=n.up(e.props);t&&(e.props=t)},down:"function"===typeof n.down?e=>{const t=n.down(e.props);t&&(e.props=t)}:void 0}}const Xo=["black","grey","light-violet","violet","blue","light-blue","yellow","orange","green","light-green","light-red","red","white"],$o={lightMode:{id:"light",text:"#000000",background:"rgb(249, 250, 251)",solid:"#fcfffe",black:{solid:"#1d1d1d",fill:"#1d1d1d",note:{fill:"#FCE19C",text:"#000000"},semi:"#e8e8e8",pattern:"#494949",highlight:{srgb:"#fddd00",p3:"color(display-p3 0.972 0.8705 0.05)"}},blue:{solid:"#4465e9",fill:"#4465e9",note:{fill:"#8AA3FF",text:"#000000"},semi:"#dce1f8",pattern:"#6681ee",highlight:{srgb:"#10acff",p3:"color(display-p3 0.308 0.6632 0.9996)"}},green:{solid:"#099268",fill:"#099268",note:{fill:"#6FC896",text:"#000000"},semi:"#d3e9e3",pattern:"#39a785",highlight:{srgb:"#00ffc8",p3:"color(display-p3 0.2536 0.984 0.7981)"}},grey:{solid:"#9fa8b2",fill:"#9fa8b2",note:{fill:"#C0CAD3",text:"#000000"},semi:"#eceef0",pattern:"#bcc3c9",highlight:{srgb:"#cbe7f1",p3:"color(display-p3 0.8163 0.9023 0.9416)"}},"light-blue":{solid:"#4ba1f1",fill:"#4ba1f1",note:{fill:"#9BC4FD",text:"#000000"},semi:"#ddedfa",pattern:"#6fbbf8",highlight:{srgb:"#00f4ff",p3:"color(display-p3 0.1512 0.9414 0.9996)"}},"light-green":{solid:"#4cb05e",fill:"#4cb05e",note:{fill:"#98D08A",text:"#000000"},semi:"#dbf0e0",pattern:"#65cb78",highlight:{srgb:"#65f641",p3:"color(display-p3 0.563 0.9495 0.3857)"}},"light-red":{solid:"#f87777",fill:"#f87777",note:{fill:"#F7A5A1",text:"#000000"},semi:"#f4dadb",pattern:"#fe9e9e",highlight:{srgb:"#ff7fa3",p3:"color(display-p3 0.9988 0.5301 0.6397)"}},"light-violet":{solid:"#e085f4",fill:"#e085f4",note:{fill:"#DFB0F9",text:"#000000"},semi:"#f5eafa",pattern:"#e9acf8",highlight:{srgb:"#ff88ff",p3:"color(display-p3 0.9676 0.5652 0.9999)"}},orange:{solid:"#e16919",fill:"#e16919",note:{fill:"#FAA475",text:"#000000"},semi:"#f8e2d4",pattern:"#f78438",highlight:{srgb:"#ffa500",p3:"color(display-p3 0.9988 0.6905 0.266)"}},red:{solid:"#e03131",fill:"#e03131",note:{fill:"#FC8282",text:"#000000"},semi:"#f4dadb",pattern:"#e55959",highlight:{srgb:"#ff636e",p3:"color(display-p3 0.9992 0.4376 0.45)"}},violet:{solid:"#ae3ec9",fill:"#ae3ec9",note:{fill:"#DB91FD",text:"#000000"},semi:"#ecdcf2",pattern:"#bd63d3",highlight:{srgb:"#c77cff",p3:"color(display-p3 0.7469 0.5089 0.9995)"}},yellow:{solid:"#f1ac4b",fill:"#f1ac4b",note:{fill:"#FED49A",text:"#000000"},semi:"#f9f0e6",pattern:"#fecb92",highlight:{srgb:"#fddd00",p3:"color(display-p3 0.972 0.8705 0.05)"}},white:{solid:"#FFFFFF",fill:"#FFFFFF",semi:"#f5f5f5",pattern:"#f9f9f9",note:{fill:"#FFFFFF",text:"#000000"},highlight:{srgb:"#ffffff",p3:"color(display-p3 1 1 1)"}}},darkMode:{id:"dark",text:"hsl(210, 17%, 98%)",background:"hsl(240, 5%, 6.5%)",solid:"#010403",black:{solid:"#f2f2f2",fill:"#f2f2f2",note:{fill:"#2c2c2c",text:"#f2f2f2"},semi:"#2c3036",pattern:"#989898",highlight:{srgb:"#d2b700",p3:"color(display-p3 0.8078 0.7225 0.0312)"}},blue:{solid:"#4f72fc",fill:"#4f72fc",note:{fill:"#2A3F98",text:"#f2f2f2"},semi:"#262d40",pattern:"#3a4b9e",highlight:{srgb:"#0079d2",p3:"color(display-p3 0.0032 0.4655 0.7991)"}},green:{solid:"#099268",fill:"#099268",note:{fill:"#014429",text:"#f2f2f2"},semi:"#253231",pattern:"#366a53",highlight:{srgb:"#009774",p3:"color(display-p3 0.0085 0.582 0.4604)"}},grey:{solid:"#9398b0",fill:"#9398b0",note:{fill:"#56595F",text:"#f2f2f2"},semi:"#33373c",pattern:"#7c8187",highlight:{srgb:"#9cb4cb",p3:"color(display-p3 0.6299 0.7012 0.7856)"}},"light-blue":{solid:"#4dabf7",fill:"#4dabf7",note:{fill:"#1F5495",text:"#f2f2f2"},semi:"#2a3642",pattern:"#4d7aa9",highlight:{srgb:"#00bdc8",p3:"color(display-p3 0.0023 0.7259 0.7735)"}},"light-green":{solid:"#40c057",fill:"#40c057",note:{fill:"#21581D",text:"#f2f2f2"},semi:"#2a3830",pattern:"#4e874e",highlight:{srgb:"#00a000",p3:"color(display-p3 0.2711 0.6172 0.0195)"}},"light-red":{solid:"#ff8787",fill:"#ff8787",note:{fill:"#923632",text:"#f2f2f2"},semi:"#3b3235",pattern:"#a56767",highlight:{srgb:"#db005b",p3:"color(display-p3 0.7849 0.0585 0.3589)"}},"light-violet":{solid:"#e599f7",fill:"#e599f7",note:{fill:"#762F8E",text:"#f2f2f2"},semi:"#383442",pattern:"#9770a9",highlight:{srgb:"#c400c7",p3:"color(display-p3 0.7024 0.0403 0.753)"}},orange:{solid:"#f76707",fill:"#f76707",note:{fill:"#843906",text:"#f2f2f2"},semi:"#3a2e2a",pattern:"#9f552d",highlight:{srgb:"#d07a00",p3:"color(display-p3 0.7699 0.4937 0.0085)"}},red:{solid:"#e03131",fill:"#e03131",note:{fill:"#89231A",text:"#f2f2f2"},semi:"#36292b",pattern:"#8f3734",highlight:{srgb:"#de002c",p3:"color(display-p3 0.7978 0.0509 0.2035)"}},violet:{solid:"#ae3ec9",fill:"#ae3ec9",note:{fill:"#681683",text:"#f2f2f2"},semi:"#31293c",pattern:"#763a8b",highlight:{srgb:"#9e00ee",p3:"color(display-p3 0.5651 0.0079 0.8986)"}},yellow:{solid:"#ffc034",fill:"#ffc034",note:{fill:"#98571B",text:"#f2f2f2"},semi:"#3c3934",pattern:"#fecb92",highlight:{srgb:"#d2b700",p3:"color(display-p3 0.8078 0.7225 0.0312)"}},white:{solid:"#f3f3f3",fill:"#f3f3f3",semi:"#f5f5f5",pattern:"#f9f9f9",note:{fill:"#eaeaea",text:"#1d1d1d"},highlight:{srgb:"#ffffff",p3:"color(display-p3 1 1 1)"}}}};function Zo(e){return e.isDarkMode?$o.darkMode:$o.lightMode}const Qo=zo.defineEnum("tldraw:color",{defaultValue:"black",values:Xo}),Jo=zo.defineEnum("tldraw:labelColor",{defaultValue:"black",values:Xo}),er=zo.defineEnum("tldraw:dash",{defaultValue:"draw",values:["draw","solid","dashed","dotted"]}),tr=zo.defineEnum("tldraw:fill",{defaultValue:"none",values:["none","semi","solid","pattern","fill"]}),nr=zo.defineEnum("tldraw:font",{defaultValue:"draw",values:["draw","sans","serif","mono"]}),or={draw:"'tldraw_draw', sans-serif",sans:"'tldraw_sans', sans-serif",serif:"'tldraw_serif', serif",mono:"'tldraw_mono', monospace"},rr=zo.defineEnum("tldraw:size",{defaultValue:"m",values:["s","m","l","xl"]}),ir=["arrow","triangle","square","dot","pipe","diamond","inverted","bar","none"],sr=zo.defineEnum("tldraw:arrowheadStart",{defaultValue:"none",values:ir}),ar=zo.defineEnum("tldraw:arrowheadEnd",{defaultValue:"arrow",values:ir}),lr={labelColor:Jo,color:Qo,fill:tr,dash:er,size:rr,arrowheadStart:sr,arrowheadEnd:ar,font:nr,start:jo,end:jo,bend:Jn,text:Qn,labelPosition:Jn,scale:to},cr=Wo("arrow",{AddLabelColor:1,AddIsPrecise:2,AddLabelPosition:3,ExtractBindings:4,AddScale:5});function dr(e){return Go("shape","arrow",e)}const ur=Dn({sequenceId:"com.tldraw.shape.arrow",retroactive:!1,sequence:[dr({id:cr.AddLabelColor,up:e=>{e.labelColor="black"},down:"retired"}),dr({id:cr.AddIsPrecise,up:e=>{let{start:t,end:n}=e;"binding"===t.type&&(t.isPrecise=!(.5===t.normalizedAnchor.x&&.5===t.normalizedAnchor.y)),"binding"===n.type&&(n.isPrecise=!(.5===n.normalizedAnchor.x&&.5===n.normalizedAnchor.y))},down:e=>{let{start:t,end:n}=e;"binding"===t.type&&(t.isPrecise||(t.normalizedAnchor={x:.5,y:.5}),delete t.isPrecise),"binding"===n.type&&(n.isPrecise||(n.normalizedAnchor={x:.5,y:.5}),delete n.isPrecise)}}),dr({id:cr.AddLabelPosition,up:e=>{e.labelPosition=.5},down:e=>{delete e.labelPosition}}),{id:cr.ExtractBindings,scope:"store",up:e=>{const t=Object.values(e).filter((e=>"shape"===e.typeName&&"arrow"===e.type));for(const n of t){const{start:t,end:o}=n.props;if("binding"===t.type){const o=Ro(),r={typeName:"binding",id:o,type:"arrow",fromId:n.id,toId:t.boundShapeId,meta:{},props:{terminal:"start",normalizedAnchor:t.normalizedAnchor,isExact:t.isExact,isPrecise:t.isPrecise}};e[o]=r,n.props.start={x:0,y:0}}else delete n.props.start.type;if("binding"===o.type){const t=Ro(),r={typeName:"binding",id:t,type:"arrow",fromId:n.id,toId:o.boundShapeId,meta:{},props:{terminal:"end",normalizedAnchor:o.normalizedAnchor,isExact:o.isExact,isPrecise:o.isPrecise}};e[t]=r,n.props.end={x:0,y:0}}else delete n.props.end.type}}},dr({id:cr.AddScale,up:e=>{e.scale=1},down:e=>{delete e.scale}})]}),hr={terminal:bo("start","end"),normalizedAnchor:jo,isExact:io,isPrecise:io},pr={sequence:[{dependsOn:[cr.ExtractBindings]}]},fr=mo("camera",co({typeName:so("camera"),id:_o("camera"),x:Jn,y:Jn,z:Jn,meta:po})),gr=Ln({sequenceId:"com.tldraw.camera",recordType:"camera",sequence:[{id:Rn("com.tldraw.camera",{AddMeta:1}).AddMeta,up:e=>{e.meta={}}}]}),mr=wn("camera",{validator:fr,scope:"session"}).withDefaultProperties((()=>({x:0,y:0,z:1,meta:{}})));function yr(e,t){if(null==e)return{};var n,o,r=function(e,t){if(null==e)return{};var n={};for(var o in e)if({}.hasOwnProperty.call(e,o)){if(t.includes(o))continue;n[o]=e[o]}return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(o=0;o<i.length;o++)n=i[o],t.includes(n)||{}.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}const vr=yo(new Set(["none","default","pointer","cross","grab","rotate","grabbing","resize-edge","resize-corner","text","move","ew-resize","ns-resize","nesw-resize","nwse-resize","nesw-rotate","nwse-rotate","swne-rotate","senw-rotate","zoom-in","zoom-out"])),br=co({type:vr,rotation:Jn}),wr=yo(new Set(["accent","white","black","selection-stroke","selection-fill","laser","muted-1"])),xr=new Set(["starting","paused","active","stopping"]),Sr=co({id:Qn,points:lo(jo),size:eo,color:wr,opacity:Jn,state:yo(xr),delay:Jn,shrink:Jn,taper:io}),kr=_o("page"),Pr=mo("page",co({typeName:so("page"),id:kr,name:Qn,index:Co,meta:po})),Cr=Ln({sequenceId:"com.tldraw.page",recordType:"page",sequence:[{id:Rn("com.tldraw.page",{AddMeta:1}).AddMeta,up:e=>{e.meta={}}}]}),_r=wn("page",{validator:Pr,scope:"document"}).withDefaultProperties((()=>({meta:{}})));function Ir(e){return _r.isId(e)}const Er=["dialog"],jr=["propsForNextShape"],Tr=["propsForNextShape"],Mr=["userId"],Ar=["opacity"],Or=["propsForNextShape"],Dr=["propsForNextShape"],Rr=["color"],Lr=["isReadOnly"],zr=["scribble"],Nr=["insets"],Fr=["duplicateProps"],Br=["canMoveCamera"],Ur={id:!1,typeName:!1,currentPageId:!1,opacityForNextShape:!1,stylesForNextShape:!1,followingUserId:!1,highlightedUserIds:!1,brush:!1,cursor:!1,scribbles:!1,isFocusMode:!0,isDebugMode:!0,isToolLocked:!0,exportBackground:!0,screenBounds:!0,insets:!0,zoomBrush:!1,chatMessage:!1,isChatting:!1,isPenMode:!1,isGridMode:!0,isFocused:!0,devicePixelRatio:!0,isCoarsePointer:!0,isHoveringCanvas:!1,openMenus:!1,isChangingStyle:!1,isReadonly:!0,meta:!1,duplicateProps:!1};function Hr(e){return e?ye(e,(e=>Ur[e])):null}_o("instance");const Kr=Rn("com.tldraw.instance",{AddTransparentExportBgs:1,RemoveDialog:2,AddToolLockMode:3,RemoveExtraPropsForNextShape:4,AddLabelColor:5,AddFollowingUserId:6,RemoveAlignJustify:7,AddZoom:8,AddVerticalAlign:9,AddScribbleDelay:10,RemoveUserId:11,AddIsPenModeAndIsGridMode:12,HoistOpacity:13,AddChat:14,AddHighlightedUserIds:15,ReplacePropsForNextShapeWithStylesForNextShape:16,AddMeta:17,RemoveCursorColor:18,AddLonelyProperties:19,ReadOnlyReadonly:20,AddHoveringCanvas:21,AddScribbles:22,AddInset:23,AddDuplicateProps:24,RemoveCanMoveCamera:25}),Vr=Ln({sequenceId:"com.tldraw.instance",recordType:"instance",sequence:[{id:Kr.AddTransparentExportBgs,up:e=>l(l({},e),{},{exportBackground:!0})},{id:Kr.RemoveDialog,up:e=>{let{dialog:t}=e;return yr(e,Er)}},{id:Kr.AddToolLockMode,up:e=>l(l({},e),{},{isToolLocked:!1})},{id:Kr.RemoveExtraPropsForNextShape,up:e=>{let{propsForNextShape:t}=e;return l(l({},yr(e,jr)),{},{propsForNextShape:Object.fromEntries(Object.entries(t).filter((e=>{let[t]=e;return["color","labelColor","dash","fill","size","font","align","verticalAlign","icon","geo","arrowheadStart","arrowheadEnd","spline"].includes(t)})))})}},{id:Kr.AddLabelColor,up:e=>{let{propsForNextShape:t}=e;return l(l({},yr(e,Tr)),{},{propsForNextShape:l(l({},t),{},{labelColor:"black"})})}},{id:Kr.AddFollowingUserId,up:e=>l(l({},e),{},{followingUserId:null})},{id:Kr.RemoveAlignJustify,up:e=>{let t=e.propsForNextShape.align;return"justify"===t&&(t="start"),l(l({},e),{},{propsForNextShape:l(l({},e.propsForNextShape),{},{align:t})})}},{id:Kr.AddZoom,up:e=>l(l({},e),{},{zoomBrush:null})},{id:Kr.AddVerticalAlign,up:e=>l(l({},e),{},{propsForNextShape:l(l({},e.propsForNextShape),{},{verticalAlign:"middle"})})},{id:Kr.AddScribbleDelay,up:e=>null!==e.scribble?l(l({},e),{},{scribble:l(l({},e.scribble),{},{delay:0})}):l({},e)},{id:Kr.RemoveUserId,up:e=>{let{userId:t}=e;return yr(e,Mr)}},{id:Kr.AddIsPenModeAndIsGridMode,up:e=>l(l({},e),{},{isPenMode:!1,isGridMode:!1})},{id:Kr.HoistOpacity,up:e=>{let{propsForNextShape:{opacity:t}}=e,n=yr(e.propsForNextShape,Ar);return l(l({},yr(e,Or)),{},{opacityForNextShape:Number(null!==t&&void 0!==t?t:"1"),propsForNextShape:n})}},{id:Kr.AddChat,up:e=>l(l({},e),{},{chatMessage:"",isChatting:!1})},{id:Kr.AddHighlightedUserIds,up:e=>l(l({},e),{},{highlightedUserIds:[]})},{id:Kr.ReplacePropsForNextShapeWithStylesForNextShape,up:e=>{let{propsForNextShape:t}=e;return l(l({},yr(e,Dr)),{},{stylesForNextShape:{}})}},{id:Kr.AddMeta,up:e=>l(l({},e),{},{meta:{}})},{id:Kr.RemoveCursorColor,up:e=>{const t=e.cursor,{color:n}=t,o=yr(t,Rr);return l(l({},e),{},{cursor:o})}},{id:Kr.AddLonelyProperties,up:e=>l(l({},e),{},{canMoveCamera:!0,isFocused:!1,devicePixelRatio:1,isCoarsePointer:!1,openMenus:[],isChangingStyle:!1,isReadOnly:!1})},{id:Kr.ReadOnlyReadonly,up:e=>{let{isReadOnly:t}=e;return l(l({},yr(e,Lr)),{},{isReadonly:t})}},{id:Kr.AddHoveringCanvas,up:e=>l(l({},e),{},{isHoveringCanvas:null})},{id:Kr.AddScribbles,up:e=>{let{scribble:t}=e;return l(l({},yr(e,zr)),{},{scribbles:[]})}},{id:Kr.AddInset,up:e=>l(l({},e),{},{insets:[!1,!1,!1,!1]}),down:e=>{let{insets:t}=e;return l({},yr(e,Nr))}},{id:Kr.AddDuplicateProps,up:e=>l(l({},e),{},{duplicateProps:null}),down:e=>{let{duplicateProps:t}=e;return l({},yr(e,Fr))}},{id:Kr.RemoveCanMoveCamera,up:e=>{let{canMoveCamera:t}=e;return l({},yr(e,Br))},down:e=>l(l({},e),{},{canMoveCamera:!0})}]}),Wr="instance:instance",qr=mo("instance_page_state",co({typeName:so("instance_page_state"),id:_o("instance_page_state"),pageId:kr,selectedShapeIds:lo(Oo),hintingShapeIds:lo(Oo),erasingShapeIds:lo(Oo),hoveredShapeId:Oo.nullable(),editingShapeId:Oo.nullable(),croppingShapeId:Oo.nullable(),focusedGroupId:Oo.nullable(),meta:po})),Yr=Rn("com.tldraw.instance_page_state",{AddCroppingId:1,RemoveInstanceIdAndCameraId:2,AddMeta:3,RenameProperties:4,RenamePropertiesAgain:5}),Gr=Ln({sequenceId:"com.tldraw.instance_page_state",recordType:"instance_page_state",sequence:[{id:Yr.AddCroppingId,up(e){e.croppingShapeId=null}},{id:Yr.RemoveInstanceIdAndCameraId,up(e){delete e.instanceId,delete e.cameraId}},{id:Yr.AddMeta,up:e=>{e.meta={}}},{id:Yr.RenameProperties,up:e=>{},down:e=>{}},{id:Yr.RenamePropertiesAgain,up:e=>{var t,n;e.selectedShapeIds=e.selectedIds,delete e.selectedIds,e.hintingShapeIds=e.hintingIds,delete e.hintingIds,e.erasingShapeIds=e.erasingIds,delete e.erasingIds,e.hoveredShapeId=e.hoveredId,delete e.hoveredId,e.editingShapeId=e.editingId,delete e.editingId,e.croppingShapeId=null!==(t=null!==(n=e.croppingShapeId)&&void 0!==n?n:e.croppingId)&&void 0!==t?t:null,delete e.croppingId,e.focusedGroupId=e.focusLayerId,delete e.focusLayerId},down:e=>{e.selectedIds=e.selectedShapeIds,delete e.selectedShapeIds,e.hintingIds=e.hintingShapeIds,delete e.hintingShapeIds,e.erasingIds=e.erasingShapeIds,delete e.erasingShapeIds,e.hoveredId=e.hoveredShapeId,delete e.hoveredShapeId,e.editingId=e.editingShapeId,delete e.editingShapeId,e.croppingId=e.croppingShapeId,delete e.croppingShapeId,e.focusLayerId=e.focusedGroupId,delete e.focusedGroupId}}]}),Xr=wn("instance_page_state",{validator:qr,scope:"session",ephemeralKeys:{pageId:!1,selectedShapeIds:!1,editingShapeId:!1,croppingShapeId:!1,meta:!1,hintingShapeIds:!0,erasingShapeIds:!0,hoveredShapeId:!0,focusedGroupId:!0}}).withDefaultProperties((()=>({editingShapeId:null,croppingShapeId:null,selectedShapeIds:[],hoveredShapeId:null,erasingShapeIds:[],hintingShapeIds:[],focusedGroupId:null,meta:{}}))),$r=mo("pointer",co({typeName:so("pointer"),id:_o("pointer"),x:Jn,y:Jn,lastActivityTimestamp:Jn,meta:po})),Zr=Ln({sequenceId:"com.tldraw.pointer",recordType:"pointer",sequence:[{id:Rn("com.tldraw.pointer",{AddMeta:1}).AddMeta,up:e=>{e.meta={}}}]}),Qr=wn("pointer",{validator:$r,scope:"session"}).withDefaultProperties((()=>({x:0,y:0,lastActivityTimestamp:0,meta:{}}))),Jr=Qr.createId("pointer"),ei=mo("instance_presence",co({typeName:so("instance_presence"),id:_o("instance_presence"),userId:Qn,userName:Qn,lastActivityTimestamp:Jn,followingUserId:Qn.nullable(),cursor:co({x:Jn,y:Jn,type:vr,rotation:Jn}),color:Qn,camera:co({x:Jn,y:Jn,z:Jn}),screenBounds:To,selectedShapeIds:lo(_o("shape")),currentPageId:_o("page"),brush:To.nullable(),scribbles:lo(Sr),chatMessage:Qn,meta:po})),ti=Rn("com.tldraw.instance_presence",{AddScribbleDelay:1,RemoveInstanceId:2,AddChatMessage:3,AddMeta:4,RenameSelectedShapeIds:5}),ni=Ln({sequenceId:"com.tldraw.instance_presence",recordType:"instance_presence",sequence:[{id:ti.AddScribbleDelay,up:e=>{null!==e.scribble&&(e.scribble.delay=0)}},{id:ti.RemoveInstanceId,up:e=>{delete e.instanceId}},{id:ti.AddChatMessage,up:e=>{e.chatMessage=""}},{id:ti.AddMeta,up:e=>{e.meta={}}},{id:ti.RenameSelectedShapeIds,up:e=>{}}]}),oi=wn("instance_presence",{validator:ei,scope:"presence"}).withDefaultProperties((()=>({lastActivityTimestamp:0,followingUserId:null,color:"#FF0000",camera:{x:0,y:0,z:1},cursor:{x:0,y:0,type:"default",rotation:0},screenBounds:{x:0,y:0,w:1,h:1},selectedShapeIds:[],brush:null,scribbles:[],chatMessage:"",meta:{}})));const ri=mo("document",co({typeName:so("document"),id:so("document:document"),gridSize:Jn,name:Qn,meta:po}));const ii=Rn("com.tldraw.document",{AddName:1,AddMeta:2}),si=Ln({sequenceId:"com.tldraw.document",recordType:"document",sequence:[{id:ii.AddName,up:e=>{e.name=""},down:e=>{delete e.name}},{id:ii.AddMeta,up:e=>{e.meta={}}}]}),ai=wn("document",{validator:ri,scope:"document"}).withDefaultProperties((()=>({gridSize:10,name:"",meta:{}}))),li=ai.createId("document");function ci(e,t){return e.index<t.index?-1:e.index>t.index?1:0}function di(e){"asset"===e.typeName&&("src"in e&&(e.src="<redacted>"),"src"in e.props&&(e.props.src="<redacted>"))}function ui(e){let{error:t,phase:n,record:o,recordBefore:r}=e;throw F(t,{tags:{origin:"store.validateRecord",storePhase:n,isExistingValidationIssue:"initialize"===n},extras:{recordBefore:r?di(bt(r)):void 0,recordAfter:di(bt(o))}}),t}function hi(e){const t=e.query.ids("page"),n=e.query.records("instance_page_state"),o=()=>{if(!e.has(li))return e.put([ai.create({id:li,name:e.props.defaultName})]),o();if(!e.has(Jr))return e.put([Qr.create({id:Jr})]),o();const r=t.get();if(0===r.size)return e.put([_r.create({id:"page:page",name:"Page 1",index:"a1",meta:{}})]),o();const i=()=>[...r].map((t=>e.get(t))).sort(ci)[0].id,s=e.get(Wr);if(!s)return e.put([e.schema.types.instance.create({id:Wr,currentPageId:i(),exportBackground:!0})]),o();if(!r.has(s.currentPageId))return e.put([l(l({},s),{},{currentPageId:i()})]),o();const a=new Set,c=new Set;for(const t of r){const n=Xr.createId(t);e.get(n)||a.add(n);const o=mr.createId(t);e.has(o)||c.add(o)}a.size>0&&e.put([...a].map((e=>Xr.create({id:e,pageId:Xr.parseId(e)})))),c.size>0&&e.put([...c].map((e=>mr.create({id:e}))));const d=n.get();for(const t of d){if(!r.has(t.pageId)){e.remove([t.id]);continue}if(t.croppingShapeId&&!e.has(t.croppingShapeId))return e.put([l(l({},t),{},{croppingShapeId:null})]),o();if(t.focusedGroupId&&!e.has(t.focusedGroupId))return e.put([l(l({},t),{},{focusedGroupId:null})]),o();if(t.hoveredShapeId&&!e.has(t.hoveredShapeId))return e.put([l(l({},t),{},{hoveredShapeId:null})]),o();const n=t.selectedShapeIds.filter((t=>e.has(t)));if(n.length!==t.selectedShapeIds.length)return e.put([l(l({},t),{},{selectedShapeIds:n})]),o();const i=t.hintingShapeIds.filter((t=>e.has(t)));if(i.length!==t.hintingShapeIds.length)return e.put([l(l({},t),{},{hintingShapeIds:i})]),o();const s=t.erasingShapeIds.filter((t=>e.has(t)));if(s.length!==t.erasingShapeIds.length)return e.put([l(l({},t),{},{erasingShapeIds:s})]),o()}};return o}const pi=Eo("bookmark",co({title:Qn,description:Qn,image:Qn,favicon:Qn,src:Po.nullable()})),fi=Rn("com.tldraw.asset.bookmark",{MakeUrlsValid:1,AddFavicon:2}),gi=Ln({sequenceId:"com.tldraw.asset.bookmark",recordType:"asset",filter:e=>"bookmark"===e.type,sequence:[{id:fi.MakeUrlsValid,up:e=>{Po.isValid(e.props.src)||(e.props.src="")},down:e=>{}},{id:fi.AddFavicon,up:e=>{Po.isValid(e.props.favicon)||(e.props.favicon="")},down:e=>{delete e.props.favicon}}]}),mi=Eo("image",co({w:Jn,h:Jn,name:Qn,isAnimated:io,mimeType:Qn.nullable(),src:Po.nullable(),fileSize:to.optional()})),yi=Rn("com.tldraw.asset.image",{AddIsAnimated:1,RenameWidthHeight:2,MakeUrlsValid:3,AddFileSize:4,MakeFileSizeOptional:5}),vi=Ln({sequenceId:"com.tldraw.asset.image",recordType:"asset",filter:e=>"image"===e.type,sequence:[{id:yi.AddIsAnimated,up:e=>{e.props.isAnimated=!1},down:e=>{delete e.props.isAnimated}},{id:yi.RenameWidthHeight,up:e=>{e.props.w=e.props.width,e.props.h=e.props.height,delete e.props.width,delete e.props.height},down:e=>{e.props.width=e.props.w,e.props.height=e.props.h,delete e.props.w,delete e.props.h}},{id:yi.MakeUrlsValid,up:e=>{Po.isValid(e.props.src)||(e.props.src="")},down:e=>{}},{id:yi.AddFileSize,up:e=>{e.props.fileSize=-1},down:e=>{delete e.props.fileSize}},{id:yi.MakeFileSizeOptional,up:e=>{-1===e.props.fileSize&&(e.props.fileSize=void 0)},down:e=>{void 0===e.props.fileSize&&(e.props.fileSize=-1)}}]}),bi=Eo("video",co({w:Jn,h:Jn,name:Qn,isAnimated:io,mimeType:Qn.nullable(),src:Po.nullable(),fileSize:Jn.optional()})),wi=Rn("com.tldraw.asset.video",{AddIsAnimated:1,RenameWidthHeight:2,MakeUrlsValid:3,AddFileSize:4,MakeFileSizeOptional:5}),xi=Ln({sequenceId:"com.tldraw.asset.video",recordType:"asset",filter:e=>"video"===e.type,sequence:[{id:wi.AddIsAnimated,up:e=>{e.props.isAnimated=!1},down:e=>{delete e.props.isAnimated}},{id:wi.RenameWidthHeight,up:e=>{e.props.w=e.props.width,e.props.h=e.props.height,delete e.props.width,delete e.props.height},down:e=>{e.props.width=e.props.w,e.props.height=e.props.h,delete e.props.w,delete e.props.h}},{id:wi.MakeUrlsValid,up:e=>{Po.isValid(e.props.src)||(e.props.src="")},down:e=>{}},{id:wi.AddFileSize,up:e=>{e.props.fileSize=-1},down:e=>{delete e.props.fileSize}},{id:wi.MakeFileSizeOptional,up:e=>{-1===e.props.fileSize&&(e.props.fileSize=void 0)},down:e=>{void 0===e.props.fileSize&&(e.props.fileSize=-1)}}]}),Si=mo("asset",go("type",{image:mi,video:bi,bookmark:pi})),ki=Ln({sequenceId:"com.tldraw.asset",recordType:"asset",sequence:[{id:Rn("com.tldraw.asset",{AddMeta:1}).AddMeta,up:e=>{e.meta={}}}]}),Pi=wn("asset",{validator:Si,scope:"document"}).withDefaultProperties((()=>({meta:{}}))),Ci={w:to,h:to,assetId:Io.nullable(),url:So},_i=Wo("bookmark",{NullAssetId:1,MakeUrlsValid:2}),Ii={sequence:[{id:_i.NullAssetId,up:e=>{void 0===e.assetId&&(e.assetId=null)},down:"retired"},{id:_i.MakeUrlsValid,up:e=>{So.isValid(e.url)||(e.url="")},down:e=>{}}]},Ei=co({type:bo("free","straight"),points:lo(jo)}),ji={color:Qo,fill:tr,dash:er,size:rr,segments:lo(Ei),isComplete:io,isClosed:io,isPen:io,scale:to},Ti=Wo("draw",{AddInPen:1,AddScale:2}),Mi={sequence:[{id:Ti.AddInPen,up:e=>{const{points:t}=e.segments[0];if(0===t.length)return void(e.isPen=!1);let n=!(0===t[0].z||.5===t[0].z);t[1]&&(n=n&&!(0===t[1].z||.5===t[1].z)),e.isPen=n},down:"retired"},{id:Ti.AddScale,up:e=>{e.scale=1},down:e=>{delete e.scale}}]},Ai=/(^\/r\/[^/]+\/?$)/,Oi=[{hostnames:["beta.tldraw.com","tldraw.com","localhost:3000"],fromEmbedUrl:e=>{const t=mt(e);if(t&&t.pathname.match(Ai))return e}},{hostnames:["figma.com"],fromEmbedUrl:e=>{const t=mt(e);if(t&&t.pathname.match(/^\/embed\/?$/)){const e=t.searchParams.get("url");if(e)return e}}},{hostnames:["google.*"],fromEmbedUrl:e=>{const t=mt(e);if(!t)return;if(t.pathname.match(/^\/maps\/embed\/v1\/view\/?$/)&&t.searchParams.has("center")&&t.searchParams.get("zoom")){const e=t.searchParams.get("zoom"),[n,o]=t.searchParams.get("center").split(",");return"https://www.google.com/maps/@".concat(n,",").concat(o,",").concat(e,"z")}}},{hostnames:["val.town"],fromEmbedUrl:e=>{const t=mt(e),n=t&&t.pathname.match(/\/embed\/(.+)\/?/);if(n)return"https://www.val.town/v/".concat(n[1])}},{hostnames:["codesandbox.io"],fromEmbedUrl:e=>{const t=mt(e),n=t&&t.pathname.match(/\/embed\/([^/]+)\/?/);if(n)return"https://codesandbox.io/s/".concat(n[1])}},{hostnames:["codepen.io"],fromEmbedUrl:e=>{const t=e.match(/https:\/\/codepen.io\/([^/]+)\/embed\/([^/]+)/);if(t){const[e,n,o]=t;return"https://codepen.io/".concat(n,"/pen/").concat(o)}}},{hostnames:["scratch.mit.edu"],fromEmbedUrl:e=>{const t=e.match(/https:\/\/scratch.mit.edu\/projects\/embed\/([^/]+)/);if(t){const[e,n]=t;return"https://scratch.mit.edu/projects/".concat(n)}}},{hostnames:["*.youtube.com","youtube.com","youtu.be"],fromEmbedUrl:e=>{const t=mt(e);if(!t)return;if("youtube.com"===t.hostname.replace(/^www./,"")){const e=t.pathname.match(/^\/embed\/([^/]+)\/?/);if(e)return"https://www.youtube.com/watch?v=".concat(e[1])}}},{hostnames:["calendar.google.*"],fromEmbedUrl:e=>{const t=mt(e),n=null===t||void 0===t?void 0:t.searchParams.get("src");if(null!==t&&void 0!==t&&t.pathname.match(/\/calendar\/embed/)&&n){t.pathname="/calendar/u/0";const e=Array.from(t.searchParams.keys());for(const n of e)t.searchParams.delete(n);return t.searchParams.set("cid",n),t.href}}},{hostnames:["docs.google.*"],fromEmbedUrl:e=>{const t=mt(e);if(null!==t&&void 0!==t&&t.pathname.match(/^\/presentation/)&&null!==t&&void 0!==t&&t.pathname.match(/\/embed\/?$/)){t.pathname=t.pathname.replace(/\/embed$/,"/pub");const e=Array.from(t.searchParams.keys());for(const n of e)t.searchParams.delete(n);return t.href}}},{hostnames:["gist.github.com"],fromEmbedUrl:e=>{const t=mt(e);if(t&&t.pathname.match(/\/([^/]+)\/([^/]+)/)){if(!e.split("/").pop())return;return e}}},{hostnames:["replit.com"],fromEmbedUrl:e=>{const t=mt(e);if(t&&t.pathname.match(/\/@([^/]+)\/([^/]+)/)&&t.searchParams.has("embed"))return t.searchParams.delete("embed"),t.href}},{hostnames:["felt.com"],fromEmbedUrl:e=>{const t=mt(e);if(t&&t.pathname.match(/^\/embed\/map\//))return t.pathname=t.pathname.replace(/^\/embed/,""),t.href}},{hostnames:["open.spotify.com"],fromEmbedUrl:e=>{const t=mt(e);if(t&&t.pathname.match(/^\/embed\/(artist|album)\//))return t.origin+t.pathname.replace(/^\/embed/,"")}},{hostnames:["vimeo.com","player.vimeo.com"],fromEmbedUrl:e=>{const t=mt(e);if(t&&"player.vimeo.com"===t.hostname){const e=t.pathname.match(/^\/video\/([^/]+)\/?$/);if(e)return"https://vimeo.com/"+e[1]}}},{hostnames:["excalidraw.com"],fromEmbedUrl:e=>{const t=mt(e);if(t&&t.hash.match(/#room=/))return e}},{hostnames:["observablehq.com"],fromEmbedUrl:e=>{const t=mt(e);return t&&t.pathname.match(/^\/embed\/@([^/]+)\/([^/]+)\/?$/)?"".concat(t.origin).concat(t.pathname.replace("/embed",""),"#cell-*"):t&&t.pathname.match(/^\/embed\/([^/]+)\/?$/)?"".concat(t.origin).concat(t.pathname.replace("/embed","/d"),"#cell-*"):void 0}},{hostnames:["desmos.com"],fromEmbedUrl:e=>{const t=mt(e);if(t&&"www.desmos.com"===t.hostname&&t.pathname.match(/^\/calculator\/([^/]+)\/?$/)&&"?embed"===t.search&&""===t.hash)return e.replace("?embed","")}}],Di={w:to,h:to,url:Qn},Ri=Wo("embed",{GenOriginalUrlInEmbed:1,RemoveDoesResize:2,RemoveTmpOldUrl:3,RemovePermissionOverrides:4}),Li={sequence:[{id:Ri.GenOriginalUrlInEmbed,up:e=>{try{var t;const o=e.url,r=new URL(o).host.replace("www.","");let i;for(const e of Oi)if(e.hostnames.includes(r))try{i=e.fromEmbedUrl(o)}catch(n){console.warn(n)}e.tmpOldUrl=e.url,e.url=null!==(t=i)&&void 0!==t?t:""}catch(o){e.url="",e.tmpOldUrl=e.url}},down:"retired"},{id:Ri.RemoveDoesResize,up:e=>{delete e.doesResize},down:"retired"},{id:Ri.RemoveTmpOldUrl,up:e=>{delete e.tmpOldUrl},down:"retired"},{id:Ri.RemovePermissionOverrides,up:e=>{delete e.overridePermissions},down:"retired"}]},zi={w:to,h:to,name:Qn},Ni={sequence:[]},Fi=zo.defineEnum("tldraw:horizontalAlign",{defaultValue:"middle",values:["start","middle","end","start-legacy","end-legacy","middle-legacy"]}),Bi=zo.defineEnum("tldraw:verticalAlign",{defaultValue:"middle",values:["start","middle","end"]}),Ui=zo.defineEnum("tldraw:geo",{defaultValue:"rectangle",values:["cloud","rectangle","ellipse","triangle","diamond","pentagon","hexagon","octagon","star","rhombus","rhombus-2","oval","trapezoid","arrow-right","arrow-left","arrow-up","arrow-down","x-box","check-box","heart"]}),Hi={geo:Ui,labelColor:Jo,color:Qo,fill:tr,dash:er,size:rr,font:nr,align:Fi,verticalAlign:Bi,url:So,w:to,h:to,growY:eo,text:Qn,scale:to},Ki=Wo("geo",{AddUrlProp:1,AddLabelColor:2,RemoveJustify:3,AddCheckBox:4,AddVerticalAlign:5,MigrateLegacyAlign:6,AddCloud:7,MakeUrlsValid:8,AddScale:9}),Vi={sequence:[{id:Ki.AddUrlProp,up:e=>{e.url=""},down:"retired"},{id:Ki.AddLabelColor,up:e=>{e.labelColor="black"},down:"retired"},{id:Ki.RemoveJustify,up:e=>{"justify"===e.align&&(e.align="start")},down:"retired"},{id:Ki.AddCheckBox,up:e=>{},down:"retired"},{id:Ki.AddVerticalAlign,up:e=>{e.verticalAlign="middle"},down:"retired"},{id:Ki.MigrateLegacyAlign,up:e=>{let t;switch(e.align){case"start":t="start-legacy";break;case"end":t="end-legacy";break;default:t="middle-legacy"}e.align=t},down:"retired"},{id:Ki.AddCloud,up:e=>{},down:"retired"},{id:Ki.MakeUrlsValid,up:e=>{So.isValid(e.url)||(e.url="")},down:e=>{}},{id:Ki.AddScale,up:e=>{e.scale=1},down:e=>{delete e.scale}}]},Wi={},qi={sequence:[]},Yi={color:Qo,size:rr,segments:lo(Ei),isComplete:io,isPen:io,scale:to},Gi={sequence:[{id:Wo("highlight",{AddScale:1}).AddScale,up:e=>{e.scale=1},down:e=>{delete e.scale}}]},Xi=co({topLeft:jo,bottomRight:jo}),$i={w:to,h:to,playing:io,url:So,assetId:Io.nullable(),crop:Xi.nullable(),flipX:io,flipY:io},Zi=Wo("image",{AddUrlProp:1,AddCropProp:2,MakeUrlsValid:3,AddFlipProps:4}),Qi={sequence:[{id:Zi.AddUrlProp,up:e=>{e.url=""},down:"retired"},{id:Zi.AddCropProp,up:e=>{e.crop=null},down:e=>{delete e.crop}},{id:Zi.MakeUrlsValid,up:e=>{So.isValid(e.url)||(e.url="")},down:e=>{}},{id:Zi.AddFlipProps,up:e=>{e.flipX=!1,e.flipY=!1},down:e=>{delete e.flipX,delete e.flipY}}]},Ji=zo.defineEnum("tldraw:spline",{defaultValue:"line",values:["cubic","line"]}),es=co({id:Qn,index:Co,x:Jn,y:Jn}),ts={color:Qo,dash:er,size:rr,spline:Ji,points:fo(Qn,es),scale:to},ns=Wo("line",{AddSnapHandles:1,RemoveExtraHandleProps:2,HandlesToPoints:3,PointIndexIds:4,AddScale:5}),os={sequence:[{id:ns.AddSnapHandles,up:e=>{for(const t of Object.values(e.handles))t.canSnap=!0},down:"retired"},{id:ns.RemoveExtraHandleProps,up:e=>{e.handles=me(Object.values(e.handles).map((e=>[e.index,{x:e.x,y:e.y}])))},down:e=>{const t=Object.entries(e.handles).map((e=>{let[t,n]=e;return l({index:t},n)})).sort(Je);e.handles=Object.fromEntries(t.map(((e,n)=>{const o=0===n?"start":n===t.length-1?"end":"handle:".concat(e.index);return[o,{id:o,type:"vertex",canBind:!1,canSnap:!0,index:e.index,x:e.x,y:e.y}]})))}},{id:ns.HandlesToPoints,up:e=>{const t=Object.entries(e.handles).map((e=>{let[t,{x:n,y:o}]=e;return{x:n,y:o,index:t}})).sort(Je);e.points=t.map((e=>{let{x:t,y:n}=e;return{x:t,y:n}})),delete e.handles},down:e=>{const t=Qe(e.points.length);e.handles=Object.fromEntries(e.points.map(((e,n)=>[t[n],{x:e.x,y:e.y}]))),delete e.points}},{id:ns.PointIndexIds,up:e=>{const t=Qe(e.points.length);e.points=Object.fromEntries(e.points.map(((e,n)=>{const o=t[n];return[o,{id:o,index:o,x:e.x,y:e.y}]})))},down:e=>{const t=Object.values(e.points).sort(Je);e.points=t.map((e=>{let{x:t,y:n}=e;return{x:t,y:n}}))}},{id:ns.AddScale,up:e=>{e.scale=1},down:e=>{delete e.scale}}]},rs={color:Qo,labelColor:Jo,size:rr,font:nr,fontSizeAdjustment:eo,align:Fi,verticalAlign:Bi,growY:eo,url:So,text:Qn,scale:to},is=Wo("note",{AddUrlProp:1,RemoveJustify:2,MigrateLegacyAlign:3,AddVerticalAlign:4,MakeUrlsValid:5,AddFontSizeAdjustment:6,AddScale:7,AddLabelColor:8}),ss={sequence:[{id:is.AddUrlProp,up:e=>{e.url=""},down:"retired"},{id:is.RemoveJustify,up:e=>{"justify"===e.align&&(e.align="start")},down:"retired"},{id:is.MigrateLegacyAlign,up:e=>{switch(e.align){case"start":return void(e.align="start-legacy");case"end":return void(e.align="end-legacy");default:return void(e.align="middle-legacy")}},down:"retired"},{id:is.AddVerticalAlign,up:e=>{e.verticalAlign="middle"},down:"retired"},{id:is.MakeUrlsValid,up:e=>{So.isValid(e.url)||(e.url="")},down:e=>{}},{id:is.AddFontSizeAdjustment,up:e=>{e.fontSizeAdjustment=0},down:e=>{delete e.fontSizeAdjustment}},{id:is.AddScale,up:e=>{e.scale=1},down:e=>{delete e.scale}},{id:is.AddLabelColor,up:e=>{e.labelColor="black"},down:e=>{delete e.labelColor}}]},as=zo.defineEnum("tldraw:textAlign",{defaultValue:"start",values:["start","middle","end"]}),ls={color:Qo,size:rr,font:nr,textAlign:as,w:to,text:Qn,scale:to,autoSize:io},cs=Wo("text",{RemoveJustify:1,AddTextAlign:2}),ds={sequence:[{id:cs.RemoveJustify,up:e=>{"justify"===e.align&&(e.align="start")},down:"retired"},{id:cs.AddTextAlign,up:e=>{e.textAlign=e.align,delete e.align},down:e=>{e.align=e.textAlign,delete e.textAlign}}]},us={w:to,h:to,time:Jn,playing:io,url:So,assetId:Io.nullable()},hs=Wo("video",{AddUrlProp:1,MakeUrlsValid:2}),ps={sequence:[{id:hs.AddUrlProp,up:e=>{e.url=""},down:"retired"},{id:hs.MakeUrlsValid,up:e=>{So.isValid(e.url)||(e.url="")},down:e=>{}}]},fs=Rn("com.tldraw.store",{RemoveCodeAndIconShapeTypes:1,AddInstancePresenceType:2,RemoveTLUserAndPresenceAndAddPointer:3,RemoveUserDocument:4}),gs=Dn({sequenceId:"com.tldraw.store",retroactive:!1,sequence:[{id:fs.RemoveCodeAndIconShapeTypes,scope:"store",up:e=>{for(const[t,n]of ge(e))"shape"!==n.typeName||"icon"!==n.type&&"code"!==n.type||delete e[t]}},{id:fs.AddInstancePresenceType,scope:"store",up(e){}},{id:fs.RemoveTLUserAndPresenceAndAddPointer,scope:"store",up:e=>{for(const[t,n]of ge(e))n.typeName.match(/^(user|user_presence)$/)&&delete e[t]}},{id:fs.RemoveUserDocument,scope:"store",up:e=>{for(const[t,n]of ge(e))n.typeName.match("user_document")&&delete e[t]}}]}),ms={arrow:{migrations:ur,props:lr},bookmark:{migrations:Ii,props:Ci},draw:{migrations:Mi,props:ji},embed:{migrations:Li,props:Di},frame:{migrations:Ni,props:zi},geo:{migrations:Vi,props:Hi},group:{migrations:qi,props:Wi},highlight:{migrations:Gi,props:Yi},image:{migrations:Qi,props:$i},line:{migrations:os,props:ts},note:{migrations:ss,props:rs},text:{migrations:ds,props:ls},video:{migrations:ps,props:us}},ys={arrow:{migrations:pr,props:hr}};function vs(){let{shapes:e=ms,bindings:t=ys,migrations:n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const o=new Map;for(const l of fe(e))for(const e of Vo(null!==(r=l.props)&&void 0!==r?r:{}).keys()){var r;if(o.has(e.id)&&o.get(e.id)!==e)throw new Error("Multiple StyleProp instances with the same id: ".concat(e.id));o.set(e.id,e)}const i=qo(e),s=Lo(t),a=function(e){const t={};for(const[n,o]of e)t[n]=vo(o);return wn("instance",{validator:mo("instance",co({typeName:so("instance"),id:_o("instance"),currentPageId:kr,followingUserId:Qn.nullable(),brush:To.nullable(),opacityForNextShape:Mo,stylesForNextShape:co(t),cursor:br,scribbles:lo(Sr),isFocusMode:io,isDebugMode:io,isToolLocked:io,exportBackground:io,screenBounds:To,insets:lo(io),zoomBrush:To.nullable(),isPenMode:io,isGridMode:io,chatMessage:Qn,isChatting:io,highlightedUserIds:lo(Qn),isFocused:io,devicePixelRatio:Jn,isCoarsePointer:io,isHoveringCanvas:io.nullable(),openMenus:lo(Qn),isChangingStyle:io,isReadonly:io,meta:po,duplicateProps:co({shapeIds:lo(_o("shape")),offset:co({x:Jn,y:Jn})}).nullable()})),scope:"session",ephemeralKeys:{currentPageId:!1,meta:!1,followingUserId:!0,opacityForNextShape:!0,stylesForNextShape:!0,brush:!0,cursor:!0,scribbles:!0,isFocusMode:!0,isDebugMode:!0,isToolLocked:!0,exportBackground:!0,screenBounds:!0,insets:!0,zoomBrush:!0,isPenMode:!0,isGridMode:!0,chatMessage:!0,isChatting:!0,highlightedUserIds:!0,isFocused:!0,devicePixelRatio:!0,isCoarsePointer:!0,isHoveringCanvas:!0,openMenus:!0,isChangingStyle:!0,isReadonly:!0,duplicateProps:!0}}).withDefaultProperties((()=>({followingUserId:null,opacityForNextShape:1,stylesForNextShape:{},brush:null,scribbles:[],cursor:{type:"default",rotation:0},isFocusMode:!1,exportBackground:!1,isDebugMode:!1,isToolLocked:!1,screenBounds:{x:0,y:0,w:1080,h:720},insets:[!1,!1,!1,!1],zoomBrush:null,isGridMode:!1,isPenMode:!1,chatMessage:"",isChatting:!1,highlightedUserIds:[],isFocused:!1,devicePixelRatio:"undefined"===typeof window?1:window.devicePixelRatio,isCoarsePointer:!1,isHoveringCanvas:null,openMenus:[],isChangingStyle:!1,isReadonly:!1,meta:{},duplicateProps:null})))}(o);return Un.create({asset:Pi,binding:s,camera:mr,document:ai,instance:a,instance_page_state:Xr,page:_r,instance_presence:oi,pointer:Qr,shape:i},{migrations:[gs,ki,gr,si,Vr,Gr,Cr,ni,Zr,Bo,gi,vi,xi,...Yo("shape",e),...Yo("binding",t),...null!==n&&void 0!==n?n:[]],onValidationFailure:ui,createIntegrityChecker:hi})}const bs=[{locale:"id",label:"Bahasa Indonesia"},{locale:"ca",label:"Catal\xe0"},{locale:"cs",label:"\u010ce\u0161tina"},{locale:"da",label:"Danish"},{locale:"de",label:"Deutsch"},{locale:"en",label:"English"},{locale:"es",label:"Espa\xf1ol"},{locale:"fr",label:"Fran\xe7ais"},{locale:"gl",label:"Galego"},{locale:"hr",label:"Hrvatski"},{locale:"it",label:"Italiano"},{locale:"hu",label:"Magyar"},{locale:"no",label:"Norwegian"},{locale:"pl",label:"Polski"},{locale:"pt-br",label:"Portugu\xeas - Brasil"},{locale:"pt-pt",label:"Portugu\xeas - Europeu"},{locale:"ro",label:"Rom\xe2n\u0103"},{locale:"ru",label:"Russian"},{locale:"sl",label:"Sloven\u0161\u010dina"},{locale:"so",label:"Somali"},{locale:"fi",label:"Suomi"},{locale:"sv",label:"Svenska"},{locale:"vi",label:"Ti\u1ebfng Vi\u1ec7t"},{locale:"tr",label:"T\xfcrk\xe7e"},{locale:"uk",label:"Ukrainian"},{locale:"he",label:"\u05e2\u05d1\u05e8\u05d9\u05ea"},{locale:"ar",label:"\u0639\u0631\u0628\u064a"},{locale:"fa",label:"\u0641\u0627\u0631\u0633\u06cc"},{locale:"ku",label:"\u06a9\u0648\u0631\u062f\u06cc"},{locale:"ne",label:"\u0928\u0947\u092a\u093e\u0932\u0940"},{locale:"hi-in",label:"\u0939\u093f\u0928\u094d\u0926\u0940"},{locale:"te",label:"\u0c24\u0c46\u0c32\u0c41\u0c17\u0c41"},{locale:"th",label:"\u0e20\u0e32\u0e29\u0e32\u0e44\u0e17\u0e22"},{locale:"my",label:"\u1019\u103c\u1014\u103a\u1019\u102c\u1005\u102c"},{locale:"ko-kr",label:"\ud55c\uad6d\uc5b4"},{locale:"ja",label:"\u65e5\u672c\u8a9e"},{locale:"zh-cn",label:"\u7b80\u4f53\u4e2d\u6587"},{locale:"zh-tw",label:"\u7e41\u9ad4\u4e2d\u6587 (\u53f0\u7063)"}];const ws={zh:"zh-cn",pt:"pt-br",ko:"ko-kr",hi:"hi-in"};function xs(e){const t=bs.find((t=>t.locale===e.toLowerCase()));if(t)return t.locale;const[n,o]=e.split(/[-_]/).map((e=>e.toLowerCase()));if(o){const e=bs.find((e=>e.locale===n));if(e)return e.locale}return n in ws?ws[n]:null}u("@tldraw/tlschema","3.6.1","esm");var Ss=n(579),ks=n(8139);const Ps="3.6.1",Cs="2024-09-13T14:36:29.063Z",_s="2024-12-04T15:00:05.881Z",Is=["children","fallback"],Es={error:null};class js extends e.Component{constructor(){super(...arguments),s(this,"state",Es)}static getDerivedStateFromError(e){return{error:e}}componentDidCatch(e){var t,n;null===(t=(n=this.props).onError)||void 0===t||t.call(n,e)}render(){const{error:e}=this.state;if(null!==e){const{fallback:t}=this.props;return(0,Ss.jsx)(t,{error:e})}return this.props.children}}function Ts(e){let{children:t,fallback:n}=e,o=yr(e,Is);return null===n?t:(0,Ss.jsx)(js,l(l({fallback:n},o),{},{children:t}))}function Ms(e,t){return Ds("".concat(e,"_").concat(t))}function As(t){return Ds("".concat((0,e.useId)()).concat(null!==t&&void 0!==t?t:""))}function Os(t){const n=A((0,e.useContext)(Rs));return Ds("".concat(n,"_").concat(t))}function Ds(e){return e.replace(/:/g,"_")}const Rs=(0,e.createContext)(null);function Ls(e){let{children:t}=e;const n=As();return(0,Ss.jsx)(Rs.Provider,{value:n,children:t})}const zs=(0,e.createContext)(null);function Ns(){const t=e.useContext(zs);if(!t)throw new Error("useEditor must be used inside of the <Tldraw /> or <TldrawEditor /> components");return t}function Fs(){return e.useContext(zs)}function Bs(e){let{editor:t,children:n}=e;return(0,Ss.jsx)(zs.Provider,{value:t,children:(0,Ss.jsx)(Ls,{children:n})})}function Us(){return(0,Ss.jsx)("div",{className:"tl-background"})}function Hs(t,n,o,r,i,s){(0,e.useLayoutEffect)((()=>{const e=t.current;if(!e)return;if(void 0===n)return;let a="translate(".concat(n,"px, ").concat(o,"px)");void 0!==r&&(a+=" scale(".concat(r,")")),void 0!==i&&(a+=" rotate(".concat(i,"rad)")),s&&(a+=" translate(".concat(s.x,"px, ").concat(s.y,"px)")),e.style.transform=a}))}const Ks={linear:e=>e,easeInQuad:e=>e*e,easeOutQuad:e=>e*(2-e),easeInOutQuad:e=>e<.5?2*e*e:(4-2*e)*e-1,easeInCubic:e=>e*e*e,easeOutCubic:e=>--e*e*e+1,easeInOutCubic:e=>e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1,easeInQuart:e=>e*e*e*e,easeOutQuart:e=>1- --e*e*e*e,easeInOutQuart:e=>e<.5?8*e*e*e*e:1-8*--e*e*e*e,easeInQuint:e=>e*e*e*e*e,easeOutQuint:e=>1+--e*e*e*e*e,easeInOutQuint:e=>e<.5?16*e*e*e*e*e:1+16*--e*e*e*e*e,easeInSine:e=>1-Math.cos(e*Math.PI/2),easeOutSine:e=>Math.sin(e*Math.PI/2),easeInOutSine:e=>-(Math.cos(Math.PI*e)-1)/2,easeInExpo:e=>e<=0?0:Math.pow(2,10*e-10),easeOutExpo:e=>e>=1?1:1-Math.pow(2,-10*e),easeInOutExpo:e=>e<=0?0:e>=1?1:e<.5?Math.pow(2,20*e-10)/2:(2-Math.pow(2,-20*e+10))/2};class Vs{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;this.x=e,this.y=t,this.z=n}get pressure(){return this.z}set(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.x,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.y,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.z;return this.x=e,this.y=t,this.z=n,this}setTo(e){let{x:t=0,y:n=0,z:o=1}=e;return this.x=t,this.y=n,this.z=o,this}rot(e){if(0===e)return this;const{x:t,y:n}=this,o=Math.sin(e),r=Math.cos(e);return this.x=t*r-n*o,this.y=t*o+n*r,this}rotWith(e,t){if(0===t)return this;const n=this.x-e.x,o=this.y-e.y,r=Math.sin(t),i=Math.cos(t);return this.x=e.x+(n*i-o*r),this.y=e.y+(n*r+o*i),this}clone(){const{x:e,y:t,z:n}=this;return new Vs(e,t,n)}sub(e){return this.x-=e.x,this.y-=e.y,this}subXY(e,t){return this.x-=e,this.y-=t,this}subScalar(e){return this.x-=e,this.y-=e,this}add(e){return this.x+=e.x,this.y+=e.y,this}addXY(e,t){return this.x+=e,this.y+=t,this}addScalar(e){return this.x+=e,this.y+=e,this}clamp(e,t){return this.x=Math.max(this.x,e),this.y=Math.max(this.y,e),void 0!==t&&(this.x=Math.min(this.x,t),this.y=Math.min(this.y,t)),this}div(e){return this.x/=e,this.y/=e,this}divV(e){return this.x/=e.x,this.y/=e.y,this}mul(e){return this.x*=e,this.y*=e,this}mulV(e){return this.x*=e.x,this.y*=e.y,this}abs(){return this.x=Math.abs(this.x),this.y=Math.abs(this.y),this}nudge(e,t){const n=Vs.Tan(e,this);return this.add(n.mul(t))}neg(){return this.x*=-1,this.y*=-1,this}cross(e){return this.x=this.y*e.z-this.z*e.y,this.y=this.z*e.x-this.x*e.z,this}dpr(e){return Vs.Dpr(this,e)}cpr(e){return Vs.Cpr(this,e)}len2(){return Vs.Len2(this)}len(){return Vs.Len(this)}pry(e){return Vs.Pry(this,e)}per(){const{x:e,y:t}=this;return this.x=t,this.y=-e,this}uni(){return Vs.Uni(this)}tan(e){return Vs.Tan(this,e)}dist(e){return Vs.Dist(this,e)}distanceToLineSegment(e,t){return Vs.DistanceToLineSegment(e,t,this)}slope(e){return Vs.Slope(this,e)}snapToGrid(e){return this.x=Math.round(this.x/e)*e,this.y=Math.round(this.y/e)*e,this}angle(e){return Vs.Angle(this,e)}toAngle(){return Vs.ToAngle(this)}lrp(e,t){return this.x=this.x+(e.x-this.x)*t,this.y=this.y+(e.y-this.y)*t,this}equals(e){return Vs.Equals(this,e)}equalsXY(e,t){return Vs.EqualsXY(this,e,t)}norm(){const e=this.len();return this.x=0===e?0:this.x/e,this.y=0===e?0:this.y/e,this}toFixed(){return Vs.ToFixed(this)}toString(){return Vs.ToString(Vs.ToFixed(this))}toJson(){return Vs.ToJson(this)}toArray(){return Vs.ToArray(this)}static Add(e,t){return new Vs(e.x+t.x,e.y+t.y)}static AddXY(e,t,n){return new Vs(e.x+t,e.y+n)}static Sub(e,t){return new Vs(e.x-t.x,e.y-t.y)}static SubXY(e,t,n){return new Vs(e.x-t,e.y-n)}static AddScalar(e,t){return new Vs(e.x+t,e.y+t)}static SubScalar(e,t){return new Vs(e.x-t,e.y-t)}static Div(e,t){return new Vs(e.x/t,e.y/t)}static Mul(e,t){return new Vs(e.x*t,e.y*t)}static DivV(e,t){return new Vs(e.x/t.x,e.y/t.y)}static MulV(e,t){return new Vs(e.x*t.x,e.y*t.y)}static Neg(e){return new Vs(-e.x,-e.y)}static Per(e){return new Vs(e.y,-e.x)}static Abs(e){return new Vs(Math.abs(e.x),Math.abs(e.y))}static Dist(e,t){return((e.y-t.y)**2+(e.x-t.x)**2)**.5}static DistMin(e,t,n){return(e.x-t.x)*(e.x-t.x)+(e.y-t.y)*(e.y-t.y)<n**2}static Dist2(e,t){return(e.x-t.x)*(e.x-t.x)+(e.y-t.y)*(e.y-t.y)}static Dpr(e,t){return e.x*t.x+e.y*t.y}static Cross(e,t){return new Vs(e.y*t.z-e.z*t.y,e.z*t.x-e.x*t.z)}static Cpr(e,t){return e.x*t.y-t.x*e.y}static Len2(e){return e.x*e.x+e.y*e.y}static Len(e){return(e.x*e.x+e.y*e.y)**.5}static Pry(e,t){return Vs.Dpr(e,t)/Vs.Len(t)}static Uni(e){return Vs.Div(e,Vs.Len(e))}static Tan(e,t){return Vs.Uni(Vs.Sub(e,t))}static Min(e,t){return new Vs(Math.min(e.x,t.x),Math.min(e.y,t.y))}static Max(e,t){return new Vs(Math.max(e.x,t.x),Math.max(e.y,t.y))}static From(e){let{x:t,y:n,z:o=1}=e;return new Vs(t,n,o)}static FromArray(e){return new Vs(e[0],e[1])}static Rot(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=Math.sin(t),o=Math.cos(t);return new Vs(e.x*o-e.y*n,e.x*n+e.y*o)}static RotWith(e,t,n){const o=e.x-t.x,r=e.y-t.y,i=Math.sin(n),s=Math.cos(n);return new Vs(t.x+(o*s-r*i),t.y+(o*i+r*s))}static NearestPointOnLineThroughPoint(e,t,n){return Vs.Mul(t,Vs.Sub(n,e).pry(t)).add(e)}static NearestPointOnLineSegment(e,t,n){let o=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(Vs.Equals(e,n))return Vs.From(n);if(Vs.Equals(t,n))return Vs.From(n);const r=Vs.Tan(t,e),i=Vs.Add(e,Vs.Mul(r,Vs.Sub(n,e).pry(r)));if(o){if(i.x<Math.min(e.x,t.x))return Vs.Cast(e.x<t.x?e:t);if(i.x>Math.max(e.x,t.x))return Vs.Cast(e.x>t.x?e:t);if(i.y<Math.min(e.y,t.y))return Vs.Cast(e.y<t.y?e:t);if(i.y>Math.max(e.y,t.y))return Vs.Cast(e.y>t.y?e:t)}return i}static DistanceToLineThroughPoint(e,t,n){return Vs.Dist(n,Vs.NearestPointOnLineThroughPoint(e,t,n))}static DistanceToLineSegment(e,t,n){let o=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return Vs.Dist(n,Vs.NearestPointOnLineSegment(e,t,n,o))}static Snap(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new Vs(Math.round(e.x/t)*t,Math.round(e.y/t)*t)}static Cast(e){return e instanceof Vs?e:Vs.From(e)}static Slope(e,t){return e.x===t.y?NaN:(e.y-t.y)/(e.x-t.x)}static IsNaN(e){return isNaN(e.x)||isNaN(e.y)}static Angle(e,t){return Math.atan2(t.y-e.y,t.x-e.x)}static Lrp(e,t,n){return Vs.Sub(t,e).mul(n).add(e)}static Med(e,t){return new Vs((e.x+t.x)/2,(e.y+t.y)/2)}static Equals(e,t){return Math.abs(e.x-t.x)<1e-4&&Math.abs(e.y-t.y)<1e-4}static EqualsXY(e,t,n){return e.x===t&&e.y===n}static Clockwise(e,t,n){return(n.x-e.x)*(t.y-e.y)-(t.x-e.x)*(n.y-e.y)<0}static Rescale(e,t){const n=Vs.Len(e);return new Vs(t*e.x/n,t*e.y/n)}static ScaleWithOrigin(e,t,n){return Vs.Sub(e,n).mul(t).add(n)}static ToFixed(e){return new Vs(ma(e.x),ma(e.y))}static ToInt(e){var t;return new Vs(parseInt(e.x.toFixed(0)),parseInt(e.y.toFixed(0)),parseInt((null!==(t=e.z)&&void 0!==t?t:0).toFixed(0)))}static ToCss(e){return"".concat(e.x,",").concat(e.y)}static Nudge(e,t,n){return Vs.Add(e,Vs.Tan(t,e).mul(n))}static ToString(e){return"".concat(e.x,", ").concat(e.y)}static ToAngle(e){let t=Math.atan2(e.y,e.x);return t<0&&(t+=2*Math.PI),t}static FromAngle(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new Vs(Math.cos(e)*t,Math.sin(e)*t)}static ToArray(e){return[e.x,e.y,e.z]}static ToJson(e){const{x:t,y:n,z:o}=e;return{x:t,y:n,z:o}}static Average(e){const t=e.length,n=new Vs(0,0);if(0===t)return n;for(let o=0;o<t;o++)n.add(e[o]);return n.div(t)}static Clamp(e,t,n){return void 0===n?new Vs(Math.min(Math.max(e.x,t)),Math.min(Math.max(e.y,t))):new Vs(Math.min(Math.max(e.x,t),n),Math.min(Math.max(e.y,t),n))}static PointsBetween(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:6;const o=[];for(let r=0;r<n;r++){const i=Ks.easeInQuad(r/(n-1)),s=Vs.Lrp(e,t,i);s.z=Math.min(1,.5+.65*Math.abs(.5-Ws(i))),o.push(s)}return o}static SnapToGrid(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:8;return new Vs(Math.round(e.x/t)*t,Math.round(e.y/t)*t)}}const Ws=e=>e<.5?2*e*e:(4-2*e)*e-1;function qs(e){return"".concat(ga(e.x),",").concat(ga(e.y)," ")}function Ys(e,t){return"".concat(ga((e.x+t.x)/2),",").concat(ga((e.y+t.y)/2)," ")}const Gs=Math.PI,Xs=Gs/2,$s=2*Gs,Zs=Math.sin;function Qs(e,t,n){return Math.max(t,"undefined"!==typeof n?Math.min(e,n):e)}function Js(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e10;return e?Math.round(e*t)/t:0}function ea(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e-6;return Math.abs(e-t)<=n}function ta(e,t){const n=Math.pow(e-t,2)/Math.pow(e+t,2);return Gs*(e+t)*(1+3*n/(10+Math.sqrt(4-3*n)))}function na(e){return(e%=$s)<0?e+=$s:0===e&&(e=0),e}function oa(e,t){return(e=na(e))>(t=na(t))&&(t+=$s),t-e}function ra(e,t){return $s-oa(e,t)}function ia(e,t){const n=(t-e)%$s;return 2*n%$s-n}function sa(e){return($s+e)%$s}function aa(e,t){const n=$s/t;let o=Math.floor((sa(e)+n/2)/n)*n%$s;return o<Gs&&(o+=$s),o>Gs&&(o-=$s),o}function la(e,t){return e===t||ea(e%(Math.PI/2)-t%(Math.PI/2),0)}function ca(e,t,n){return new Vs(e.x,e.y).add(Vs.FromAngle(n,t))}function da(e,t,n){const o=e/2,r=t/2,i=[];let s=1/0,a=-1/0,l=1/0,c=-1/0;for(let h=0;h<n;h++){const e=h*($s/n)-Xs,t=o+o*Math.cos(e),d=r+r*Math.sin(e);t<s&&(s=t),d<l&&(l=d),t>a&&(a=t),d>c&&(c=d),i.push(new Vs(t,d))}const d=a-s,u=c-l;if(0!==e-d||0!==t-u)for(let h=0;h<i.length;h++){const n=i[h];n.x=(n.x-s)/d*e,n.y=(n.y-l)/u*t}return i}function ua(e,t,n,o){return e<o&&n<t}function ha(e,t,n,o){const r=Math.max(e,n),i=Math.min(t,o);return r<=i?[r,i]:null}function pa(e,t,n){return(t.x-e.x)*(n.y-e.y)-(n.x-e.x)*(t.y-e.y)}function fa(e,t){let n,o,r=0;for(let i=0;i<t.length;i++){if(n=t[i],n.x===e.x&&n.y===e.y)return!0;if(o=t[(i+1)%t.length],Vs.Dist(e,n)+Vs.Dist(e,o)===Vs.Dist(n,o))return!0;n.y<=e.y?o.y>e.y&&pa(n,o,e)>0&&(r+=1):o.y<=e.y&&pa(n,o,e)<0&&(r-=1)}return 0!==r}function ga(e){return Math.round(1e4*e)/1e4}function ma(e){return Math.round(100*e)/100}const ya=e=>Math.abs(e)<Number.MAX_SAFE_INTEGER;function va(e,t,n){return n<0?oa(e,t):ra(e,t)}function ba(e,t,n,o){let r;if(Math.abs(e)>Gs){r=ia(t,o);const i=ia(o,n);return Math.abs(r)<Math.abs(i)?r/e:(e-i)/e}{r=ia(t,o);const n=r/e;return Math.sign(r)!==Math.sign(e)?Math.abs(n)>.5?1:0:n}}function wa(e,t,n){const o=-2*(e.x*(t.y-n.y)-e.y*(t.x-n.x)+t.x*n.y-n.x*t.y),r=((e.x*e.x+e.y*e.y)*(n.y-t.y)+(t.x*t.x+t.y*t.y)*(e.y-n.y)+(n.x*n.x+n.y*n.y)*(t.y-e.y))/o,i=((e.x*e.x+e.y*e.y)*(t.x-n.x)+(t.x*t.x+t.y*t.y)*(n.x-e.x)+(n.x*n.x+n.y*n.y)*(e.x-t.x))/o;return Number.isFinite(r)&&Number.isFinite(i)?new Vs(r,i):null}function xa(e,t,n,o,r){if(null===n)return[Vs.From(e),Vs.From(t)];const i=[],s=Vs.Angle(n,e),a=oa(s,Vs.Angle(n,t));for(let l=0;l<r;l++){const e=ca(n,o,s+a*(l/(r-1)));i.push(e)}return i}const Sa=t=>{let{brush:n,color:o,opacity:r,className:i}=t;const s=(0,e.useRef)(null);Hs(s,n.x,n.y);const a=ga(Math.max(1,n.w)),l=ga(Math.max(1,n.h));return(0,Ss.jsx)("svg",{className:"tl-overlays__item",ref:s,children:o?(0,Ss.jsxs)("g",{className:"tl-brush",opacity:r,children:[(0,Ss.jsx)("rect",{width:a,height:l,fill:o,opacity:.75}),(0,Ss.jsx)("rect",{width:a,height:l,fill:"none",stroke:o,opacity:.1})]}):(0,Ss.jsx)("rect",{className:"tl-brush tl-brush__default ".concat(i),width:a,height:l})})},ka={isSafari:!1,isIos:!1,isChromeForIos:!1,isFirefox:!1,isAndroid:!1,isWebview:!1,isDarwin:!1};"undefined"!==typeof window&&"navigator"in window&&(ka.isSafari=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),ka.isIos=!!navigator.userAgent.match(/iPad/i)||!!navigator.userAgent.match(/iPhone/i),ka.isChromeForIos=/crios.*safari/i.test(navigator.userAgent),ka.isFirefox=/firefox/i.test(navigator.userAgent),ka.isAndroid=/android/i.test(navigator.userAgent),ka.isDarwin=window.navigator.userAgent.toLowerCase().indexOf("mac")>-1);const Pa={isLocked:!1,wheelBehavior:"pan",panSpeed:1,zoomSpeed:1,zoomSteps:[.1,.25,.5,1,2,4,8]},Ca={duration:0,easing:Ks.easeInOutCubic},_a=-10,Ia=["top","right","bottom","left"],Ea={},ja=Ma("pointerCaptureTrackingObject",{defaults:{all:new Map},shouldStoreForSession:!1}),Ta={logPreventDefaults:Ma("logPreventDefaults",{defaults:{all:!1}}),logPointerCaptures:Ma("logPointerCaptures",{defaults:{all:!1}}),logElementRemoves:Ma("logElementRemoves",{defaults:{all:!1}}),debugSvg:Ma("debugSvg",{defaults:{all:!1}}),showFps:Ma("showFps",{defaults:{all:!1}}),measurePerformance:Ma("measurePerformance",{defaults:{all:!1}}),throwToBlob:Ma("throwToBlob",{defaults:{all:!1}}),reconnectOnPing:Ma("reconnectOnPing",{defaults:{all:!1}}),debugCursors:Ma("debugCursors",{defaults:{all:!1}}),forceSrgb:Ma("forceSrgbColors",{defaults:{all:!1}}),debugGeometry:Ma("debugGeometry",{defaults:{all:!1}}),hideShapes:Ma("hideShapes",{defaults:{all:!1}}),editOnType:Ma("editOnType",{defaults:{all:!1}})};if("undefined"!==typeof Element){const e=Element.prototype.removeChild;Ht("element removal logging",(()=>{Ta.logElementRemoves.get()?Element.prototype.removeChild=function(t){return console.warn("[tldraw] removing child:",t),e.call(this,t)}:Element.prototype.removeChild=e}))}function Ma(e,t){let{defaults:n,shouldStoreForSession:o=!0}=t;return function(e){const t=function(e){var t,n,o,r,i,s;switch(null!==(t=null!==(n=null!==(o=Aa((()=>({NODE_ENV:"production",PUBLIC_URL:"/whiteboard",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.TLDRAW_ENV))))&&void 0!==o?o:Aa((()=>({NODE_ENV:"production",PUBLIC_URL:"/whiteboard",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.VERCEL_PUBLIC_TLDRAW_ENV))))&&void 0!==n?n:Aa((()=>({NODE_ENV:"production",PUBLIC_URL:"/whiteboard",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.NEXT_PUBLIC_TLDRAW_ENV))))&&void 0!==t?t:"production"){case"production":return null!==(r=e.defaults.production)&&void 0!==r?r:e.defaults.all;case"preview":case"staging":return null!==(i=e.defaults.staging)&&void 0!==i?i:e.defaults.all;default:return null!==(s=e.defaults.development)&&void 0!==s?s:e.defaults.all}}(e),n=e.shouldStoreForSession?function(e){try{var t;return JSON.parse(null!==(t=ot("tldraw_debug:".concat(e)))&&void 0!==t?t:"null")}catch(n){return null}}(e.name):null,o=Qt("debug:".concat(e.name),null!==n&&void 0!==n?n:t);"undefined"!==typeof window&&(e.shouldStoreForSession&&Ht("debug:".concat(e.name),(()=>{const n=o.get();n===t?it("tldraw_debug:".concat(e.name)):rt("tldraw_debug:".concat(e.name),JSON.stringify(n))})),Object.defineProperty(window,"tldraw".concat(e.name.replace(/^[a-z]/,(e=>e.toUpperCase()))),{get:()=>o.get(),set(e){o.set(e)},configurable:!0}));return Object.assign(o,e)}({name:e,defaults:n,shouldStoreForSession:o})}function Aa(e){try{return e()}catch(t){return null}}function Oa(e){if(e instanceof HTMLElement)return e;if(e.parentElement)return Oa(e.parentElement);throw Error("Could not find a parent element of an HTML type!")}function Da(e){e.preventDefault(),Ta.logPreventDefaults.get()&&console.warn("preventDefault called on event:",e)}function Ra(e,t){if(e.setPointerCapture(t.pointerId),Ta.logPointerCaptures.get()){var n;const o=ja.get();o.set(e,(null!==(n=o.get(e))&&void 0!==n?n:0)+1),console.warn("setPointerCapture called on element:",e,t)}}function La(e,t){if(e.hasPointerCapture(t.pointerId)&&(e.releasePointerCapture(t.pointerId),Ta.logPointerCaptures.get())){const n=ja.get();1===n.get(e)?n.delete(e):n.has(e)?n.set(e,n.get(e)-1):console.warn("Release without capture"),console.warn("releasePointerCapture called on element:",e,t)}}const za=e=>e.stopPropagation(),Na=(e,t,n)=>{e&&e.style.setProperty(t,n)},Fa=e=>ka.isDarwin?e.metaKey:e.ctrlKey||e.metaKey;function Ba(e){return e.isKilled=!0,{point:{x:e.clientX,y:e.clientY,z:e.pressure},shiftKey:e.shiftKey,altKey:e.altKey,ctrlKey:e.metaKey||e.ctrlKey,metaKey:e.metaKey,accelKey:Fa(e),pointerId:e.pointerId,button:e.button,isPen:"pen"===e.pointerType}}function Ua(){const t=Ns();return(0,e.useMemo)((function(){let e,n;return{onPointerDown:function(e){e.isKilled||(2!==e.button?0!==e.button&&1!==e.button&&5!==e.button||(Ra(e.currentTarget,e),t.dispatch(l({type:"pointer",target:"canvas",name:"pointer_down"},Ba(e)))):t.dispatch(l({type:"pointer",target:"canvas",name:"right_click"},Ba(e))))},onPointerMove:function(o){o.isKilled||o.clientX===e&&o.clientY===n||(e=o.clientX,n=o.clientY,t.dispatch(l({type:"pointer",target:"canvas",name:"pointer_move"},Ba(o))))},onPointerUp:function(o){o.isKilled||0!==o.button&&1!==o.button&&2!==o.button&&5!==o.button||(e=o.clientX,n=o.clientY,La(o.currentTarget,o),t.dispatch(l({type:"pointer",target:"canvas",name:"pointer_up"},Ba(o))))},onPointerEnter:function(e){if(e.isKilled)return;if(t.getInstanceState().isPenMode&&"pen"!==e.pointerType)return;const n="mouse"===e.pointerType||"pen"===e.pointerType;t.updateInstanceState({isHoveringCanvas:!!n||null})},onPointerLeave:function(e){if(e.isKilled)return;if(t.getInstanceState().isPenMode&&"pen"!==e.pointerType)return;const n="mouse"===e.pointerType||"pen"===e.pointerType;t.updateInstanceState({isHoveringCanvas:!n&&null})},onDragOver:function(e){Da(e)},onDrop:async function(e){var n;if(Da(e),za(e),null===(n=e.dataTransfer)||void 0===n||null===(n=n.files)||void 0===n||!n.length)return;const o=Array.from(e.dataTransfer.files);await t.putExternalContent({type:"files",files:o,point:t.screenToPage({x:e.clientX,y:e.clientY}),ignoreParent:!1})},onTouchStart:function(e){e.isKilled=!0,Da(e)},onTouchEnd:function(e){e.isKilled=!0,e.target instanceof HTMLElement&&("A"===e.target.tagName||"TEXTAREA"===e.target.tagName||t.getEditingShape()&&e.target.className.includes("tl-text-content")||Da(e))},onClick:function(e){za(e)}}}),[t])}const Ha=(0,e.createContext)(null);function Ka(e){let{container:t,children:n}=e;return(0,Ss.jsx)(Ha.Provider,{value:t,children:n})}function Va(){return A((0,e.useContext)(Ha),"useContainer used outside of <Tldraw />")}const Wa=["input","select","button","textarea"];function qa(e){const{activeElement:t}=document;return e.menus.hasOpenMenus()||t&&(t.getAttribute("contenteditable")||Wa.indexOf(t.tagName.toLowerCase())>-1)}const Ya=["textarea","input"];const Ga={toVector:(e,t)=>(void 0===e&&(e=t),Array.isArray(e)?e:[e,e]),add:(e,t)=>[e[0]+t[0],e[1]+t[1]],sub:(e,t)=>[e[0]-t[0],e[1]-t[1]],addTo(e,t){e[0]+=t[0],e[1]+=t[1]},subTo(e,t){e[0]-=t[0],e[1]-=t[1]}};function Xa(e,t,n){return 0===t||Math.abs(t)===1/0?Math.pow(e,5*n):e*t*n/(t+n*e)}function $a(e,t,n){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.15;return 0===o?function(e,t,n){return Math.max(t,Math.min(e,n))}(e,t,n):e<t?-Xa(t-e,n-t,o)+t:e>n?+Xa(e-n,n-t,o)+n:e}function Za(e){var t=function(e,t){if("object"!==typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,t||"default");if("object"!==typeof o)return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===typeof t?t:String(t)}function Qa(e,t,n){return(t=Za(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Ja(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function el(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ja(Object(n),!0).forEach((function(t){Qa(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ja(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const tl={pointer:{start:"down",change:"move",end:"up"},mouse:{start:"down",change:"move",end:"up"},touch:{start:"start",change:"move",end:"end"},gesture:{start:"start",change:"change",end:"end"}};function nl(e){return e?e[0].toUpperCase()+e.slice(1):""}const ol=["enter","leave"];function rl(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const o=tl[e],r=o&&o[t]||t;return"on"+nl(e)+nl(r)+(function(){let e=arguments.length>1?arguments[1]:void 0;return arguments.length>0&&void 0!==arguments[0]&&arguments[0]&&!ol.includes(e)}(n,r)?"Capture":"")}const il=["gotpointercapture","lostpointercapture"];function sl(e){let t=e.substring(2).toLowerCase();const n=!!~t.indexOf("passive");n&&(t=t.replace("passive",""));const o=il.includes(t)?"capturecapture":"capture",r=!!~t.indexOf(o);return r&&(t=t.replace("capture","")),{device:t,capture:r,passive:n}}function al(e){return"touches"in e}function ll(e){return al(e)?"touch":"pointerType"in e?e.pointerType:"mouse"}function cl(e,t){try{const n=t.clientX-e.clientX,o=t.clientY-e.clientY,r=(t.clientX+e.clientX)/2,i=(t.clientY+e.clientY)/2,s=Math.hypot(n,o),a=-180*Math.atan2(n,o)/Math.PI;return{angle:a,distance:s,origin:[r,i]}}catch(n){}return null}function dl(e){return function(e){return Array.from(e.touches).filter((t=>{var n,o;return t.target===e.currentTarget||(null===(n=e.currentTarget)||void 0===n||null===(o=n.contains)||void 0===o?void 0:o.call(n,t.target))}))}(e).map((e=>e.identifier))}function ul(e,t){const[n,o]=Array.from(e.touches).filter((e=>t.includes(e.identifier)));return cl(n,o)}function hl(e){let{deltaX:t,deltaY:n,deltaMode:o}=e;return 1===o?(t*=40,n*=40):2===o&&(t*=800,n*=800),[t,n]}function pl(e){if("function"===typeof e){for(var t=arguments.length,n=new Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];return e(...n)}return e}function fl(){}function gl(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return 0===t.length?fl:1===t.length?t[0]:function(){let e;for(const n of t)e=n.apply(this,arguments)||e;return e}}function ml(e,t){return Object.assign({},t,e||{})}class yl{constructor(e,t,n){this.ctrl=e,this.args=t,this.key=n,this.state||(this.state={},this.computeValues([0,0]),this.computeInitial(),this.init&&this.init(),this.reset())}get state(){return this.ctrl.state[this.key]}set state(e){this.ctrl.state[this.key]=e}get shared(){return this.ctrl.state.shared}get eventStore(){return this.ctrl.gestureEventStores[this.key]}get timeoutStore(){return this.ctrl.gestureTimeoutStores[this.key]}get config(){return this.ctrl.config[this.key]}get sharedConfig(){return this.ctrl.config.shared}get handler(){return this.ctrl.handlers[this.key]}reset(){const{state:e,shared:t,ingKey:n,args:o}=this;t[n]=e._active=e.active=e._blocked=e._force=!1,e._step=[!1,!1],e.intentional=!1,e._movement=[0,0],e._distance=[0,0],e._direction=[0,0],e._delta=[0,0],e._bounds=[[-1/0,1/0],[-1/0,1/0]],e.args=o,e.axis=void 0,e.memo=void 0,e.elapsedTime=e.timeDelta=0,e.direction=[0,0],e.distance=[0,0],e.overflow=[0,0],e._movementBound=[!1,!1],e.velocity=[0,0],e.movement=[0,0],e.delta=[0,0],e.timeStamp=0}start(e){const t=this.state,n=this.config;t._active||(this.reset(),this.computeInitial(),t._active=!0,t.target=e.target,t.currentTarget=e.currentTarget,t.lastOffset=n.from?pl(n.from,t):t.offset,t.offset=t.lastOffset,t.startTime=t.timeStamp=e.timeStamp)}computeValues(e){const t=this.state;t._values=e,t.values=this.config.transform(e)}computeInitial(){const e=this.state;e._initial=e._values,e.initial=e.values}compute(e){const{state:t,config:n,shared:o}=this;t.args=this.args;let r=0;if(e&&(t.event=e,n.preventDefault&&e.cancelable&&t.event.preventDefault(),t.type=e.type,o.touches=this.ctrl.pointerIds.size||this.ctrl.touchIds.size,o.locked=!!document.pointerLockElement,Object.assign(o,function(e){const t={};if("buttons"in e&&(t.buttons=e.buttons),"shiftKey"in e){const{shiftKey:n,altKey:o,metaKey:r,ctrlKey:i}=e;Object.assign(t,{shiftKey:n,altKey:o,metaKey:r,ctrlKey:i})}return t}(e)),o.down=o.pressed=o.buttons%2===1||o.touches>0,r=e.timeStamp-t.timeStamp,t.timeStamp=e.timeStamp,t.elapsedTime=t.timeStamp-t.startTime),t._active){const e=t._delta.map(Math.abs);Ga.addTo(t._distance,e)}this.axisIntent&&this.axisIntent(e);const[i,s]=t._movement,[a,l]=n.threshold,{_step:c,values:d}=t;if(n.hasCustomTransform?(!1===c[0]&&(c[0]=Math.abs(i)>=a&&d[0]),!1===c[1]&&(c[1]=Math.abs(s)>=l&&d[1])):(!1===c[0]&&(c[0]=Math.abs(i)>=a&&Math.sign(i)*a),!1===c[1]&&(c[1]=Math.abs(s)>=l&&Math.sign(s)*l)),t.intentional=!1!==c[0]||!1!==c[1],!t.intentional)return;const u=[0,0];if(n.hasCustomTransform){const[e,t]=d;u[0]=!1!==c[0]?e-c[0]:0,u[1]=!1!==c[1]?t-c[1]:0}else u[0]=!1!==c[0]?i-c[0]:0,u[1]=!1!==c[1]?s-c[1]:0;this.restrictToAxis&&!t._blocked&&this.restrictToAxis(u);const h=t.offset,p=t._active&&!t._blocked||t.active;p&&(t.first=t._active&&!t.active,t.last=!t._active&&t.active,t.active=o[this.ingKey]=t._active,e&&(t.first&&("bounds"in n&&(t._bounds=pl(n.bounds,t)),this.setup&&this.setup()),t.movement=u,this.computeOffset()));const[f,g]=t.offset,[[m,y],[v,b]]=t._bounds;t.overflow=[f<m?-1:f>y?1:0,g<v?-1:g>b?1:0],t._movementBound[0]=!!t.overflow[0]&&(!1===t._movementBound[0]?t._movement[0]:t._movementBound[0]),t._movementBound[1]=!!t.overflow[1]&&(!1===t._movementBound[1]?t._movement[1]:t._movementBound[1]);const w=t._active&&n.rubberband||[0,0];if(t.offset=function(e,t,n){let[o,r]=t,[i,s]=n;const[[a,l],[c,d]]=e;return[$a(o,a,l,i),$a(r,c,d,s)]}(t._bounds,t.offset,w),t.delta=Ga.sub(t.offset,h),this.computeMovement(),p&&(!t.last||r>32)){t.delta=Ga.sub(t.offset,h);const e=t.delta.map(Math.abs);Ga.addTo(t.distance,e),t.direction=t.delta.map(Math.sign),t._direction=t._delta.map(Math.sign),!t.first&&r>0&&(t.velocity=[e[0]/r,e[1]/r],t.timeDelta=r)}}emit(){const e=this.state,t=this.shared,n=this.config;if(e._active||this.clean(),(e._blocked||!e.intentional)&&!e._force&&!n.triggerAllEvents)return;const o=this.handler(el(el(el({},t),e),{},{[this.aliasKey]:e.values}));void 0!==o&&(e.memo=o)}clean(){this.eventStore.clean(),this.timeoutStore.clean()}}class vl extends yl{constructor(){super(...arguments),Qa(this,"aliasKey","xy")}reset(){super.reset(),this.state.axis=void 0}init(){this.state.offset=[0,0],this.state.lastOffset=[0,0]}computeOffset(){this.state.offset=Ga.add(this.state.lastOffset,this.state.movement)}computeMovement(){this.state.movement=Ga.sub(this.state.offset,this.state.lastOffset)}axisIntent(e){const t=this.state,n=this.config;if(!t.axis&&e){const o="object"===typeof n.axisThreshold?n.axisThreshold[ll(e)]:n.axisThreshold;t.axis=function(e,t){let[n,o]=e;const r=Math.abs(n),i=Math.abs(o);return r>i&&r>t?"x":i>r&&i>t?"y":void 0}(t._movement,o)}t._blocked=(n.lockDirection||!!n.axis)&&!t.axis||!!n.axis&&n.axis!==t.axis}restrictToAxis(e){if(this.config.axis||this.config.lockDirection)switch(this.state.axis){case"x":e[1]=0;break;case"y":e[0]=0}}}const bl=e=>e,wl={enabled(){return!(arguments.length>0&&void 0!==arguments[0])||arguments[0]},eventOptions:(e,t,n)=>el(el({},n.shared.eventOptions),e),preventDefault(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]},triggerAllEvents(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]},rubberband(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;switch(e){case!0:return[.15,.15];case!1:return[0,0];default:return Ga.toVector(e)}},from:e=>"function"===typeof e?e:null!=e?Ga.toVector(e):void 0,transform(e,t,n){const o=e||n.shared.transform;return this.hasCustomTransform=!!o,o||bl},threshold:e=>Ga.toVector(e,0)};const xl=el(el({},wl),{},{axis(e,t,n){let{axis:o}=n;if(this.lockDirection="lock"===o,!this.lockDirection)return o},axisThreshold(){return arguments.length>0&&void 0!==arguments[0]?arguments[0]:0},bounds(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if("function"===typeof e)return t=>xl.bounds(e(t));if("current"in e)return()=>e.current;if("function"===typeof HTMLElement&&e instanceof HTMLElement)return e;const{left:t=-1/0,right:n=1/0,top:o=-1/0,bottom:r=1/0}=e;return[[t,n],[o,r]]}});const Sl="undefined"!==typeof window&&window.document&&window.document.createElement;function kl(){return Sl&&"ontouchstart"in window}const Pl={isBrowser:Sl,gesture:function(){try{return"constructor"in GestureEvent}catch(e){return!1}}(),touch:kl(),touchscreen:kl()||Sl&&window.navigator.maxTouchPoints>1,pointer:Sl&&"onpointerdown"in window,pointerLock:Sl&&"exitPointerLock"in window.document},Cl=.5,_l=50,Il=250,El={mouse:0,touch:0,pen:8};el(el({},xl),{},{device(e,t,n){let{pointer:{touch:o=!1,lock:r=!1,mouse:i=!1}={}}=n;return this.pointerLock=r&&Pl.pointerLock,Pl.touch&&o?"touch":this.pointerLock?"mouse":Pl.pointer&&!i?"pointer":Pl.touch?"touch":"mouse"},preventScrollAxis(e,t,n){let{preventScroll:o}=n;if(this.preventScrollDelay="number"===typeof o?o:o||void 0===o&&e?250:void 0,Pl.touchscreen&&!1!==o)return e||(void 0!==o?"y":void 0)},pointerCapture(e,t,n){let{pointer:{capture:o=!0,buttons:r=1,keys:i=!0}={}}=n;return this.pointerButtons=r,this.keys=i,!this.pointerLock&&"pointer"===this.device&&o},threshold(e,t,n){let{filterTaps:o=!1,tapsThreshold:r=3,axis:i}=n;const s=Ga.toVector(e,o?r:i?1:0);return this.filterTaps=o,this.tapsThreshold=r,s},swipe(){let{velocity:e=Cl,distance:t=_l,duration:n=Il}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{velocity:this.transform(Ga.toVector(e)),distance:this.transform(Ga.toVector(t)),duration:n}},delay(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;switch(e){case!0:return 180;case!1:return 0;default:return e}},axisThreshold:e=>e?el(el({},El),e):El,keyboardDisplacement(){return arguments.length>0&&void 0!==arguments[0]?arguments[0]:10}});function jl(e){const[t,n]=e.overflow,[o,r]=e._delta,[i,s]=e._direction;(t<0&&o>0&&i<0||t>0&&o<0&&i>0)&&(e._movement[0]=e._movementBound[0]),(n<0&&r>0&&s<0||n>0&&r<0&&s>0)&&(e._movement[1]=e._movementBound[1])}const Tl=el(el({},wl),{},{device(e,t,n){let{shared:o,pointer:{touch:r=!1}={}}=n;if(o.target&&!Pl.touch&&Pl.gesture)return"gesture";if(Pl.touch&&r)return"touch";if(Pl.touchscreen){if(Pl.pointer)return"pointer";if(Pl.touch)return"touch"}},bounds(e,t,n){let{scaleBounds:o={},angleBounds:r={}}=n;const i=e=>{const t=ml(pl(o,e),{min:-1/0,max:1/0});return[t.min,t.max]},s=e=>{const t=ml(pl(r,e),{min:-1/0,max:1/0});return[t.min,t.max]};return"function"!==typeof o&&"function"!==typeof r?[i(),s()]:e=>[i(e),s(e)]},threshold(e,t,n){this.lockDirection="lock"===n.axis;return Ga.toVector(e,this.lockDirection?[.1,3]:0)},modifierKey:e=>void 0===e?"ctrlKey":e,pinchOnWheel(){return!(arguments.length>0&&void 0!==arguments[0])||arguments[0]}});el(el({},xl),{},{mouseOnly:function(){return!(arguments.length>0&&void 0!==arguments[0])||arguments[0]}});const Ml=xl;el(el({},xl),{},{mouseOnly:function(){return!(arguments.length>0&&void 0!==arguments[0])||arguments[0]}});const Al=new Map,Ol=new Map;function Dl(e){Al.set(e.key,e.engine),Ol.set(e.key,e.resolver)}const Rl={key:"pinch",engine:class extends yl{constructor(){super(...arguments),Qa(this,"ingKey","pinching"),Qa(this,"aliasKey","da")}init(){this.state.offset=[1,0],this.state.lastOffset=[1,0],this.state._pointerEvents=new Map}reset(){super.reset();const e=this.state;e._touchIds=[],e.canceled=!1,e.cancel=this.cancel.bind(this),e.turns=0}computeOffset(){const{type:e,movement:t,lastOffset:n}=this.state;this.state.offset="wheel"===e?Ga.add(t,n):[(1+t[0])*n[0],t[1]+n[1]]}computeMovement(){const{offset:e,lastOffset:t}=this.state;this.state.movement=[e[0]/t[0],e[1]-t[1]]}axisIntent(){const e=this.state,[t,n]=e._movement;if(!e.axis){const o=30*Math.abs(t)-Math.abs(n);o<0?e.axis="angle":o>0&&(e.axis="scale")}}restrictToAxis(e){this.config.lockDirection&&("scale"===this.state.axis?e[1]=0:"angle"===this.state.axis&&(e[0]=0))}cancel(){const e=this.state;e.canceled||setTimeout((()=>{e.canceled=!0,e._active=!1,this.compute(),this.emit()}),0)}touchStart(e){this.ctrl.setEventIds(e);const t=this.state,n=this.ctrl.touchIds;if(t._active&&t._touchIds.every((e=>n.has(e))))return;if(n.size<2)return;this.start(e),t._touchIds=Array.from(n).slice(0,2);const o=ul(e,t._touchIds);o&&this.pinchStart(e,o)}pointerStart(e){if(null!=e.buttons&&e.buttons%2!==1)return;this.ctrl.setEventIds(e),e.target.setPointerCapture(e.pointerId);const t=this.state,n=t._pointerEvents,o=this.ctrl.pointerIds;if(t._active&&Array.from(n.keys()).every((e=>o.has(e))))return;if(n.size<2&&n.set(e.pointerId,e),t._pointerEvents.size<2)return;this.start(e);const r=cl(...Array.from(n.values()));r&&this.pinchStart(e,r)}pinchStart(e,t){this.state.origin=t.origin,this.computeValues([t.distance,t.angle]),this.computeInitial(),this.compute(e),this.emit()}touchMove(e){if(!this.state._active)return;const t=ul(e,this.state._touchIds);t&&this.pinchMove(e,t)}pointerMove(e){const t=this.state._pointerEvents;if(t.has(e.pointerId)&&t.set(e.pointerId,e),!this.state._active)return;const n=cl(...Array.from(t.values()));n&&this.pinchMove(e,n)}pinchMove(e,t){const n=this.state,o=n._values[1],r=t.angle-o;let i=0;Math.abs(r)>270&&(i+=Math.sign(r)),this.computeValues([t.distance,t.angle-360*i]),n.origin=t.origin,n.turns=i,n._movement=[n._values[0]/n._initial[0]-1,n._values[1]-n._initial[1]],this.compute(e),this.emit()}touchEnd(e){this.ctrl.setEventIds(e),this.state._active&&this.state._touchIds.some((e=>!this.ctrl.touchIds.has(e)))&&(this.state._active=!1,this.compute(e),this.emit())}pointerEnd(e){const t=this.state;this.ctrl.setEventIds(e);try{e.target.releasePointerCapture(e.pointerId)}catch(n){}t._pointerEvents.has(e.pointerId)&&t._pointerEvents.delete(e.pointerId),t._active&&t._pointerEvents.size<2&&(t._active=!1,this.compute(e),this.emit())}gestureStart(e){e.cancelable&&e.preventDefault();const t=this.state;t._active||(this.start(e),this.computeValues([e.scale,e.rotation]),t.origin=[e.clientX,e.clientY],this.compute(e),this.emit())}gestureMove(e){if(e.cancelable&&e.preventDefault(),!this.state._active)return;const t=this.state;this.computeValues([e.scale,e.rotation]),t.origin=[e.clientX,e.clientY];const n=t._movement;t._movement=[e.scale-1,e.rotation],t._delta=Ga.sub(t._movement,n),this.compute(e),this.emit()}gestureEnd(e){this.state._active&&(this.state._active=!1,this.compute(e),this.emit())}wheel(e){const t=this.config.modifierKey;t&&!(Array.isArray(t)?t.find((t=>e[t])):e[t])||(this.state._active?this.wheelChange(e):this.wheelStart(e),this.timeoutStore.add("wheelEnd",this.wheelEnd.bind(this)))}wheelStart(e){this.start(e),this.wheelChange(e)}wheelChange(e){"uv"in e||e.cancelable&&e.preventDefault();const t=this.state;t._delta=[-hl(e)[1]/100*t.offset[0],0],Ga.addTo(t._movement,t._delta),jl(t),this.state.origin=[e.clientX,e.clientY],this.compute(e),this.emit()}wheelEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(e){const t=this.config.device;t&&(e(t,"start",this[t+"Start"].bind(this)),e(t,"change",this[t+"Move"].bind(this)),e(t,"end",this[t+"End"].bind(this)),e(t,"cancel",this[t+"End"].bind(this)),e("lostPointerCapture","",this[t+"End"].bind(this))),this.config.pinchOnWheel&&e("wheel","",this.wheel.bind(this),{passive:!1})}},resolver:Tl},Ll={key:"wheel",engine:class extends vl{constructor(){super(...arguments),Qa(this,"ingKey","wheeling")}wheel(e){this.state._active||this.start(e),this.wheelChange(e),this.timeoutStore.add("wheelEnd",this.wheelEnd.bind(this))}wheelChange(e){const t=this.state;t._delta=hl(e),Ga.addTo(t._movement,t._delta),jl(t),this.compute(e),this.emit()}wheelEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(e){e("wheel","",this.wheel.bind(this))}},resolver:Ml};function zl(e,t){if(null==e)return{};var n,o,r=function(e,t){if(null==e)return{};var n,o,r={},i=Object.keys(e);for(o=0;o<i.length;o++)n=i[o],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(o=0;o<i.length;o++)n=i[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}const Nl={target(e){if(e)return()=>"current"in e?e.current:e},enabled(){return!(arguments.length>0&&void 0!==arguments[0])||arguments[0]},window(){return arguments.length>0&&void 0!==arguments[0]?arguments[0]:Pl.isBrowser?window:void 0},eventOptions(){let{passive:e=!0,capture:t=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{passive:e,capture:t}},transform:e=>e},Fl=["target","eventOptions","window","enabled","transform"];function Bl(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;const n={};for(const[o,r]of Object.entries(t))switch(typeof r){case"function":n[o]=r.call(n,e[o],o,e);break;case"object":n[o]=Bl(e[o],r);break;case"boolean":r&&(n[o]=e[o])}return n}class Ul{constructor(e,t){Qa(this,"_listeners",new Set),this._ctrl=e,this._gestureKey=t}add(e,t,n,o,r){const i=this._listeners,s=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";const n=tl[e];return e+(n&&n[t]||t)}(t,n),a=el(el({},this._gestureKey?this._ctrl.config[this._gestureKey].eventOptions:{}),r);e.addEventListener(s,o,a);const l=()=>{e.removeEventListener(s,o,a),i.delete(l)};return i.add(l),l}clean(){this._listeners.forEach((e=>e())),this._listeners.clear()}}class Hl{constructor(){Qa(this,"_timeouts",new Map)}add(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:140;this.remove(e);for(var o=arguments.length,r=new Array(o>3?o-3:0),i=3;i<o;i++)r[i-3]=arguments[i];this._timeouts.set(e,window.setTimeout(t,n,...r))}remove(e){const t=this._timeouts.get(e);t&&window.clearTimeout(t)}clean(){this._timeouts.forEach((e=>{window.clearTimeout(e)})),this._timeouts.clear()}}class Kl{constructor(e){Qa(this,"gestures",new Set),Qa(this,"_targetEventStore",new Ul(this)),Qa(this,"gestureEventStores",{}),Qa(this,"gestureTimeoutStores",{}),Qa(this,"handlers",{}),Qa(this,"config",{}),Qa(this,"pointerIds",new Set),Qa(this,"touchIds",new Set),Qa(this,"state",{shared:{shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1}}),function(e,t){t.drag&&Vl(e,"drag");t.wheel&&Vl(e,"wheel");t.scroll&&Vl(e,"scroll");t.move&&Vl(e,"move");t.pinch&&Vl(e,"pinch");t.hover&&Vl(e,"hover")}(this,e)}setEventIds(e){return al(e)?(this.touchIds=new Set(dl(e)),this.touchIds):"pointerId"in e?("pointerup"===e.type||"pointercancel"===e.type?this.pointerIds.delete(e.pointerId):"pointerdown"===e.type&&this.pointerIds.add(e.pointerId),this.pointerIds):void 0}applyHandlers(e,t){this.handlers=e,this.nativeHandlers=t}applyConfig(e,t){this.config=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const o=e,{target:r,eventOptions:i,window:s,enabled:a,transform:l}=o,c=zl(o,Fl);if(n.shared=Bl({target:r,eventOptions:i,window:s,enabled:a,transform:l},Nl),t){const e=Ol.get(t);n[t]=Bl(el({shared:n.shared},c),e)}else for(const d in c){const e=Ol.get(d);e&&(n[d]=Bl(el({shared:n.shared},c[d]),e))}return n}(e,t,this.config)}clean(){this._targetEventStore.clean();for(const e of this.gestures)this.gestureEventStores[e].clean(),this.gestureTimeoutStores[e].clean()}effect(){return this.config.shared.target&&this.bind(),()=>this._targetEventStore.clean()}bind(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const o=this.config.shared,r={};let i;if(!o.target||(i=o.target(),i)){if(o.enabled){for(const n of this.gestures){const e=this.config[n],o=Wl(r,e.eventOptions,!!i);if(e.enabled){new(Al.get(n))(this,t,n).bind(o)}}const e=Wl(r,o.eventOptions,!!i);for(const n in this.nativeHandlers)e(n,"",(e=>this.nativeHandlers[n](el(el({},this.state.shared),{},{event:e,args:t}))),void 0,!0)}for(const e in r)r[e]=gl(...r[e]);if(!i)return r;for(const e in r){const{device:t,capture:n,passive:o}=sl(e);this._targetEventStore.add(i,t,"",r[e],{capture:n,passive:o})}}}}function Vl(e,t){e.gestures.add(t),e.gestureEventStores[t]=new Ul(e,t),e.gestureTimeoutStores[t]=new Hl}const Wl=(e,t,n)=>function(o,r,i){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];var l,c;const d=null!==(l=s.capture)&&void 0!==l?l:t.capture,u=null!==(c=s.passive)&&void 0!==c?c:t.passive;let h=a?o:rl(o,r,d);n&&u&&(h+="Passive"),e[h]=e[h]||[],e[h].push(i)},ql=/^on(Drag|Wheel|Scroll|Move|Pinch|Hover)/;function Yl(e,t,n,o,r,i){if(!e.has(n))return;if(!Al.has(o))return void 0;const s=n+"Start",a=n+"End";r[o]=e=>{let o;return e.first&&s in t&&t[s](e),n in t&&(o=t[n](e)),e.last&&a in t&&t[a](e),o},i[o]=i[o]||{}}function Gl(e,t){const[n,o,r]=function(e){const t={},n={},o=new Set;for(let r in e)ql.test(r)?(o.add(RegExp.lastMatch),n[r]=e[r]):t[r]=e[r];return[n,t,o]}(e),i={};return Yl(r,n,"onDrag","drag",i,t),Yl(r,n,"onWheel","wheel",i,t),Yl(r,n,"onScroll","scroll",i,t),Yl(r,n,"onPinch","pinch",i,t),Yl(r,n,"onMove","move",i,t),Yl(r,n,"onHover","hover",i,t),{handlers:i,config:t,nativeHandlers:o}}function Xl(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;const i=e.useMemo((()=>new Kl(t)),[]);if(i.applyHandlers(t,r),i.applyConfig(n,o),e.useEffect(i.effect.bind(i)),e.useEffect((()=>i.clean.bind(i)),[]),void 0===n.target)return i.bind.bind(i)}function $l(e){return e.forEach(Dl),function(e,t){const{handlers:n,nativeHandlers:o,config:r}=Gl(e,t||{});return Xl(n,r,void 0,o)}}const Zl=/Mac|iPod|iPhone|iPad/.test("undefined"===typeof window?"node":window.navigator.platform);function Ql(e){let{deltaY:t,deltaX:n}=e,o=0;return e.ctrlKey||e.altKey||e.metaKey?o=(Math.abs(t)>10?10*Math.sign(t):t)/100:e.shiftKey&&!Zl&&(n=t,t=0),{x:-n,y:-t,z:-o}}const Jl=$l([Ll,Rl]);let ec;function tc(t){const n=Ns(),o=e.useMemo((()=>{let e="not sure";let o=1,r=1,i=1,s=0;const a=new Vs,l=new Vs;return{onWheel:t=>{let{event:o}=t;if(!n.getInstanceState().isFocused)return;if(e="not sure",(e=>void 0===ec?(ec=e,!1):e-ec>120&&e-ec<160?(ec=e,!0):(ec=e,!1))(Date.now()))return;const r=n.getEditingShapeId();if(r){const e=n.getShape(r);if(e){if(n.getShapeUtil(e).canScroll(e)){const e=n.getShapePageBounds(r);if(null!==e&&void 0!==e&&e.containsPoint(n.inputs.currentPagePoint))return}}}Da(o),za(o);const i=Ql(o);if(0===i.x&&0===i.y)return;const s={type:"wheel",name:"wheel",delta:i,point:new Vs(o.clientX,o.clientY),shiftKey:o.shiftKey,altKey:o.altKey,ctrlKey:o.metaKey||o.ctrlKey,metaKey:o.metaKey,accelKey:Fa(o)};n.dispatch(s)},onPinchStart:i=>{const s=t.current;e="not sure";const{event:c,origin:d,da:u}=i;c instanceof WheelEvent||(c.target===s||null!==s&&void 0!==s&&s.contains(c.target))&&(l.x=d[0],l.y=d[1],a.x=d[0],a.y=d[1],o=u[0],r=n.getZoomLevel(),n.dispatch({type:"pinch",name:"pinch_start",point:{x:d[0],y:d[1],z:n.getZoomLevel()},delta:{x:0,y:0},shiftKey:c.shiftKey,altKey:c.altKey,ctrlKey:c.metaKey||c.ctrlKey,metaKey:c.metaKey,accelKey:Fa(c)}))},onPinchEnd:o=>{const r=t.current,{event:i,origin:s,offset:a}=o;if(i instanceof WheelEvent)return;if(!(i.target===r||null!==r&&void 0!==r&&r.contains(i.target)))return;const l=a[0];e="not sure",n.timers.requestAnimationFrame((()=>{n.dispatch({type:"pinch",name:"pinch_end",point:{x:s[0],y:s[1],z:l},delta:{x:s[0],y:s[1]},shiftKey:i.shiftKey,altKey:i.altKey,ctrlKey:i.metaKey||i.ctrlKey,metaKey:i.metaKey,accelKey:Fa(i)})}))},onPinch:c=>{const d=t.current,{event:u,origin:h,offset:p,da:f}=c;if(u instanceof WheelEvent)return;if(!(u.target===d||null!==d&&void 0!==d&&d.contains(u.target)))return;const g="gesturechange"===c.type||"gestureend"===c.type;s=f[0];const m=h[0]-l.x,y=h[1]-l.y;switch(l.x=h[0],l.y=h[1],(t=>{if(t&&(e="zooming"),"zooming"===e)return;const n=Math.abs(s-o),r=Vs.Dist(a,l);switch(e){case"not sure":n>24?e="zooming":r>16&&(e="panning");break;case"panning":n>64&&(e="zooming")}})(g),e){case"zooming":i=p[0],n.dispatch({type:"pinch",name:"pinch",point:{x:h[0],y:h[1],z:i},delta:{x:m,y:y},shiftKey:u.shiftKey,altKey:u.altKey,ctrlKey:u.metaKey||u.ctrlKey,metaKey:u.metaKey,accelKey:Fa(u)});break;case"panning":n.dispatch({type:"pinch",name:"pinch",point:{x:h[0],y:h[1],z:r},delta:{x:m,y:y},shiftKey:u.shiftKey,altKey:u.altKey,ctrlKey:u.metaKey||u.ctrlKey,metaKey:u.metaKey,accelKey:Fa(u)})}}}}),[n,t]);Jl(o,{target:t,eventOptions:{passive:!1},pinch:{from:()=>[n.getZoomLevel(),0],scaleBounds:()=>{const e=n.getBaseZoom(),t=n.getCameraOptions().zoomSteps,o=t[0]*e,r=t[t.length-1]*e;return{from:n.getZoomLevel(),max:r,min:o}}}})}function nc(e,t,n){const o=e.getShape(t);return{shape:o,handle:e.getShapeHandles(o).find((e=>e.id===n))}}const oc=e=>{let t=e.parentElement;for(;t;){if(t===document.body)return document;const{overflowY:e}=window.getComputedStyle(t);if(t.scrollHeight>t.clientHeight&&("auto"===e||"scroll"===e||"overlay"===e))return t;t=t.parentElement}return document};class rc{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;s(this,"x",0),s(this,"y",0),s(this,"w",0),s(this,"h",0),this.x=e,this.y=t,this.w=n,this.h=o}get point(){return new Vs(this.x,this.y)}set point(e){this.x=e.x,this.y=e.y}get minX(){return this.x}set minX(e){this.x=e}get midX(){return this.x+this.w/2}get maxX(){return this.x+this.w}get minY(){return this.y}set minY(e){this.y=e}get midY(){return this.y+this.h/2}get maxY(){return this.y+this.h}get width(){return this.w}set width(e){this.w=e}get height(){return this.h}set height(e){this.h=e}get aspectRatio(){return this.width/this.height}get center(){return new Vs(this.midX,this.midY)}set center(e){this.minX=e.x-this.width/2,this.minY=e.y-this.height/2}get corners(){return[new Vs(this.minX,this.minY),new Vs(this.maxX,this.minY),new Vs(this.maxX,this.maxY),new Vs(this.minX,this.maxY)]}get cornersAndCenter(){return[new Vs(this.minX,this.minY),new Vs(this.maxX,this.minY),new Vs(this.maxX,this.maxY),new Vs(this.minX,this.maxY),this.center]}get sides(){const{corners:e}=this;return[[e[0],e[1]],[e[1],e[2]],[e[2],e[3]],[e[3],e[0]]]}get size(){return new Vs(this.w,this.h)}toFixed(){return this.x=Js(this.x),this.y=Js(this.y),this.w=Js(this.w),this.h=Js(this.h),this}setTo(e){return this.x=e.x,this.y=e.y,this.w=e.w,this.h=e.h,this}set(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return this.x=e,this.y=t,this.w=n,this.h=o,this}expand(e){const t=Math.min(this.minX,e.minX),n=Math.min(this.minY,e.minY),o=Math.max(this.maxX,e.maxX),r=Math.max(this.maxY,e.maxY);return this.x=t,this.y=n,this.w=o-t,this.h=r-n,this}expandBy(e){return this.x-=e,this.y-=e,this.w+=2*e,this.h+=2*e,this}scale(e){return this.x/=e,this.y/=e,this.w/=e,this.h/=e,this}clone(){const{x:e,y:t,w:n,h:o}=this;return new rc(e,t,n,o)}translate(e){return this.x+=e.x,this.y+=e.y,this}snapToGrid(e){const t=Math.round(this.minX/e)*e,n=Math.round(this.minY/e)*e,o=Math.round(this.maxX/e)*e,r=Math.round(this.maxY/e)*e;this.minX=t,this.minY=n,this.width=Math.max(1,o-t),this.height=Math.max(1,r-n)}collides(e){return rc.Collides(this,e)}contains(e){return rc.Contains(this,e)}includes(e){return rc.Includes(this,e)}containsPoint(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return rc.ContainsPoint(this,e,t)}getHandlePoint(e){switch(e){case"top_left":return new Vs(this.minX,this.minY);case"top_right":return new Vs(this.maxX,this.minY);case"bottom_left":return new Vs(this.minX,this.maxY);case"bottom_right":return new Vs(this.maxX,this.maxY);case"top":return new Vs(this.midX,this.minY);case"right":return new Vs(this.maxX,this.midY);case"bottom":return new Vs(this.midX,this.maxY);case"left":return new Vs(this.minX,this.midY)}}toJson(){return{x:this.minX,y:this.minY,w:this.w,h:this.h}}resize(e,t,n){const{minX:o,minY:r,maxX:i,maxY:s}=this;let{minX:a,minY:l,maxX:c,maxY:d}=this;switch(e){case"left":case"top_left":case"bottom_left":a+=t;break;case"right":case"top_right":case"bottom_right":c+=t}switch(e){case"top":case"top_left":case"top_right":l+=n;break;case"bottom":case"bottom_left":case"bottom_right":d+=n}if((c-a)/(i-o)<0){const e=c;c=a,a=e}if((d-l)/(s-r)<0){const e=d;d=l,l=e}this.minX=a,this.minY=l,this.width=Math.abs(c-a),this.height=Math.abs(d-l)}union(e){const t=Math.min(this.minX,e.x),n=Math.min(this.minY,e.y),o=Math.max(this.maxX,e.w+e.x),r=Math.max(this.maxY,e.h+e.y);return this.x=t,this.y=n,this.width=o-t,this.height=r-n,this}static From(e){return new rc(e.x,e.y,e.w,e.h)}static FromCenter(e,t){return new rc(e.x-t.x/2,e.y-t.y/2,t.x,t.y)}static FromPoints(e){if(0===e.length)return new rc;let t,n=1/0,o=1/0,r=-1/0,i=-1/0;for(let s=0,a=e.length;s<a;s++)t=e[s],n=Math.min(t.x,n),o=Math.min(t.y,o),r=Math.max(t.x,r),i=Math.max(t.y,i);return new rc(n,o,r-n,i-o)}static Expand(e,t){const n=Math.min(t.minX,e.minX),o=Math.min(t.minY,e.minY),r=Math.max(t.maxX,e.maxX),i=Math.max(t.maxY,e.maxY);return new rc(n,o,r-n,i-o)}static ExpandBy(e,t){return new rc(e.minX-t,e.minY-t,e.width+2*t,e.height+2*t)}static Collides(e,t){return!(e.maxX<t.minX||e.minX>t.maxX||e.maxY<t.minY||e.minY>t.maxY)}static Contains(e,t){return e.minX<t.minX&&e.minY<t.minY&&e.maxY>t.maxY&&e.maxX>t.maxX}static Includes(e,t){return rc.Collides(e,t)||rc.Contains(e,t)}static ContainsPoint(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return!(t.x<e.minX-n||t.y<e.minY-n||t.x>e.maxX+n||t.y>e.maxY+n)}static Common(e){let t=1/0,n=1/0,o=-1/0,r=-1/0;for(let i=0;i<e.length;i++){const s=e[i];t=Math.min(t,s.minX),n=Math.min(n,s.minY),o=Math.max(o,s.maxX),r=Math.max(r,s.maxY)}return new rc(t,n,o-t,r-n)}static Sides(e){const{corners:t}=e;return[[t[0],t[1]],[t[1],t[2]],[t[2],t[3]],[t[3],t[0]]]}static Resize(e,t,n,o){let r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const{minX:i,minY:s,maxX:a,maxY:l}=e;let{minX:c,minY:d,maxX:u,maxY:h}=e;switch(t){case"left":case"top_left":case"bottom_left":c+=n;break;case"right":case"top_right":case"bottom_right":u+=n}switch(t){case"top":case"top_left":case"top_right":d+=o;break;case"bottom":case"bottom_left":case"bottom_right":h+=o}const p=(u-c)/(a-i),f=(h-d)/(l-s),g=p<0,m=f<0;if(r){const e=(a-i)/(l-s),n=Math.abs(u-c),o=Math.abs(h-d),r=n*(f<0?1:-1)*(1/e),g=o*(p<0?1:-1)*e,m=e<n/o;switch(t){case"top_left":m?d=h+r:c=u+g;break;case"top_right":m?d=h+r:u=c-g;break;case"bottom_right":m?h=d-r:u=c-g;break;case"bottom_left":m?h=d-r:c=u+g;break;case"bottom":case"top":{const t=(c+u)/2,n=o*e;c=t-n/2,u=t+n/2;break}case"left":case"right":{const t=(d+h)/2,o=n/e;d=t-o/2,h=t+o/2;break}}}if(g){const e=u;u=c,c=e}if(m){const e=h;h=d,d=e}const y=new rc(c,d,Math.abs(u-c),Math.abs(h-d));return{box:y,scaleX:+(y.width/e.width*(p>0?1:-1)).toFixed(5),scaleY:+(y.height/e.height*(f>0?1:-1)).toFixed(5)}}equals(e){return rc.Equals(this,e)}static Equals(e,t){return t.x===e.x&&t.y===e.y&&t.w===e.w&&t.h===e.h}zeroFix(){return this.w=Math.max(1,this.w),this.h=Math.max(1,this.h),this}static ZeroFix(e){return new rc(e.x,e.y,Math.max(1,e.w),Math.max(1,e.h))}}class ic{constructor(e,t,n,o,r,i){s(this,"a",1),s(this,"b",0),s(this,"c",0),s(this,"d",1),s(this,"e",0),s(this,"f",0),this.a=e,this.b=t,this.c=n,this.d=o,this.e=r,this.f=i}equals(e){return this===e||this.a===e.a&&this.b===e.b&&this.c===e.c&&this.d===e.d&&this.e===e.e&&this.f===e.f}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0,this}multiply(e){const t=e,{a:n,b:o,c:r,d:i,e:s,f:a}=this;return this.a=n*t.a+r*t.b,this.c=n*t.c+r*t.d,this.e=n*t.e+r*t.f+s,this.b=o*t.a+i*t.b,this.d=o*t.c+i*t.d,this.f=o*t.e+i*t.f+a,this}rotate(e,t,n){return 0===e?this:void 0===t?this.multiply(ic.Rotate(e)):this.translate(t,n).multiply(ic.Rotate(e)).translate(-t,-n)}translate(e,t){return this.multiply(ic.Translate(e,t))}scale(e,t){return this.multiply(ic.Scale(e,t))}invert(){const{a:e,b:t,c:n,d:o,e:r,f:i}=this,s=e*o-t*n;return this.a=o/s,this.b=t/-s,this.c=n/-s,this.d=e/s,this.e=(o*r-n*i)/-s,this.f=(t*r-e*i)/s,this}applyToPoint(e){return ic.applyToPoint(this,e)}applyToPoints(e){return ic.applyToPoints(this,e)}rotation(){return ic.Rotation(this)}point(){return ic.Point(this)}decomposed(){return ic.Decompose(this)}toCssString(){return ic.toCssString(this)}setTo(e){return Object.assign(this,e),this}decompose(){return ic.Decompose(this)}clone(){return new ic(this.a,this.b,this.c,this.d,this.e,this.f)}static Identity(){return new ic(1,0,0,1,0,0)}static Translate(e,t){return new ic(1,0,0,1,e,t)}static Rotate(e,t,n){if(0===e)return ic.Identity();const o=Math.cos(e),r=Math.sin(e),i=new ic(o,r,-r,o,0,0);return void 0===t?i:ic.Compose(ic.Translate(t,n),i,ic.Translate(-t,-n))}static Scale(e,t,n,o){const r=new ic(e,0,0,t,0,0);return void 0===n?r:ic.Compose(ic.Translate(n,o),r,ic.Translate(-n,-o))}static Multiply(e,t){return{a:e.a*t.a+e.c*t.b,c:e.a*t.c+e.c*t.d,e:e.a*t.e+e.c*t.f+e.e,b:e.b*t.a+e.d*t.b,d:e.b*t.c+e.d*t.d,f:e.b*t.e+e.d*t.f+e.f}}static Inverse(e){const t=e.a*e.d-e.b*e.c;return{a:e.d/t,b:e.b/-t,c:e.c/-t,d:e.a/t,e:(e.d*e.e-e.c*e.f)/-t,f:(e.b*e.e-e.a*e.f)/t}}static Absolute(e){const t=e.a*e.d-e.b*e.c;return{a:e.d/t,b:e.b/-t,c:e.c/-t,d:e.a/t,e:(e.d*e.e-e.c*e.f)/t,f:(e.b*e.e-e.a*e.f)/-t}}static Compose(){const e=ic.Identity();for(let t=0,n=arguments.length;t<n;t++)e.multiply(t<0||arguments.length<=t?void 0:arguments[t]);return e}static Point(e){return new Vs(e.e,e.f)}static Rotation(e){let t;if(0!==e.a||0!==e.c){const n=(e.a*e.a+e.c*e.c)**.5;t=Math.acos(e.a/n)*(e.c>0?-1:1)}else if(0!==e.b||0!==e.d){const n=(e.b*e.b+e.d*e.d)**.5;t=Xs+Math.acos(e.b/n)*(e.d>0?-1:1)}else t=0;return sa(t)}static Decompose(e){let t,n,o;if(0!==e.a||0!==e.c){const r=(e.a*e.a+e.c*e.c)**.5;t=r,n=(e.a*e.d-e.b*e.c)/r,o=Math.acos(e.a/r)*(e.c>0?-1:1)}else if(0!==e.b||0!==e.d){const r=(e.b*e.b+e.d*e.d)**.5;t=(e.a*e.d-e.b*e.c)/r,n=r,o=Xs+Math.acos(e.b/r)*(e.d>0?-1:1)}else t=0,n=0,o=0;return{x:e.e,y:e.f,scaleX:t,scaleY:n,rotation:sa(o)}}static Smooth(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e10;return e.a=Math.round(e.a*t)/t,e.b=Math.round(e.b*t)/t,e.c=Math.round(e.c*t)/t,e.d=Math.round(e.d*t)/t,e.e=Math.round(e.e*t)/t,e.f=Math.round(e.f*t)/t,e}static toCssString(e){return"matrix(".concat(ga(e.a),", ").concat(ga(e.b),", ").concat(ga(e.c),", ").concat(ga(e.d),", ").concat(ga(e.e),", ").concat(ga(e.f),")")}static applyToPoint(e,t){return new Vs(e.a*t.x+e.c*t.y+e.e,e.b*t.x+e.d*t.y+e.f,t.z)}static applyToXY(e,t,n){return[e.a*t+e.c*n+e.e,e.b*t+e.d*n+e.f]}static applyToPoints(e,t){return t.map((t=>new Vs(e.a*t.x+e.c*t.y+e.e,e.b*t.x+e.d*t.y+e.f,t.z)))}static applyToBounds(e,t){return new rc(e.e+t.minX,e.f+t.minY,t.width,t.height)}static From(e){return new ic(e.a,e.b,e.c,e.d,e.e,e.f)}static Cast(e){return e instanceof ic?e:ic.From(e)}}class sc{constructor(e){var t;s(this,"isFilled",!1),s(this,"isClosed",!0),s(this,"isLabel",!1),s(this,"debugColor",void 0),s(this,"ignore",void 0),s(this,"_vertices",void 0),s(this,"_bounds",void 0),s(this,"_area",void 0),s(this,"_length",void 0),this.isFilled=e.isFilled,this.isClosed=e.isClosed,this.isLabel=null!==(t=e.isLabel)&&void 0!==t&&t,this.debugColor=e.debugColor,this.ignore=e.ignore}hitTestPoint(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return!(!this.isClosed||!this.isFilled&&!n||!fa(e,this.vertices))||Vs.Dist2(e,this.nearestPoint(e))<=t*t}distanceToPoint(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return e.dist(this.nearestPoint(e))*(this.isClosed&&(this.isFilled||t)&&fa(e,this.vertices)?-1:1)}distanceToLineSegment(e,t){if(e.equals(t))return this.distanceToPoint(e);const{vertices:n}=this;let o,r,i,s,a=1/0;for(let l=0;l<n.length;l++)i=n[l],s=Vs.NearestPointOnLineSegment(e,t,i,!0),r=Vs.Dist2(i,s),r<a&&(a=r,o=s);if(!o)throw Error("nearest point not found");return this.isClosed&&this.isFilled&&fa(o,this.vertices)?-a:a}hitTestLineSegment(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return this.distanceToLineSegment(e,t)<=n}nearestPointOnLineSegment(e,t){const{vertices:n}=this;let o,r,i,s,a=1/0;for(let l=0;l<n.length;l++)i=n[l],s=Vs.NearestPointOnLineSegment(e,t,i,!0),r=Vs.Dist2(i,s),r<a&&(a=r,o=s);if(!o)throw Error("nearest point not found");return o}isPointInBounds(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const{bounds:n}=this;return!(e.x<n.minX-t||e.y<n.minY-t||e.x>n.maxX+t||e.y>n.maxY+t)}get vertices(){return this._vertices||(this._vertices=this.getVertices()),this._vertices}getBounds(){return rc.FromPoints(this.vertices)}get bounds(){return this._bounds||(this._bounds=this.getBounds()),this._bounds}get center(){return this.bounds.center}get area(){return this._area||(this._area=this.getArea()),this._area}getArea(){if(!this.isClosed)return 0;const{vertices:e}=this;let t=0;for(let n=0,o=e.length;n<o;n++){const r=e[n],i=e[(n+1)%o];t+=r.x*i.y-i.x*r.y}return t/2}toSimpleSvgPath(){let e="";const{vertices:t}=this,n=t.length;if(0===n)return e;e+="M".concat(t[0].x,",").concat(t[0].y);for(let o=1;o<n;o++)e+="L".concat(t[o].x,",").concat(t[o].y);return this.isClosed&&(e+="Z"),e}get length(){return this._length||(this._length=this.getLength()),this._length}getLength(){const{vertices:e}=this;let t,n=e[0],o=0;for(let r=1;r<e.length;r++)t=e[r],o+=Vs.Dist2(n,t),n=t;return Math.sqrt(o)}}class ac extends sc{constructor(e){super(l(l({},e),{},{isClosed:!0,isFilled:!1})),s(this,"children",[]),s(this,"ignoredChildren",[]);for(const t of e.children)t.ignore?this.ignoredChildren.push(t):this.children.push(t);if(0===this.children.length)throw Error("Group2d must have at least one child")}getVertices(){return this.children.filter((e=>!e.isLabel)).flatMap((e=>e.vertices))}nearestPoint(e){let t,n=1/0;const{children:o}=this;if(0===o.length)throw Error("no children");let r,i;for(const s of o)r=s.nearestPoint(e),i=Vs.Dist2(r,e),i<n&&(n=i,t=r);if(!t)throw Error("nearest point not found");return t}distanceToPoint(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return Math.min(...this.children.map(((n,o)=>n.distanceToPoint(e,t||o>0))))}hitTestPoint(e,t,n){return!!this.children.filter((e=>!e.isLabel)).find((o=>o.hitTestPoint(e,t,n)))}hitTestLineSegment(e,t,n){return!!this.children.filter((e=>!e.isLabel)).find((o=>o.hitTestLineSegment(e,t,n)))}getArea(){return this.children[0].area}toSimpleSvgPath(){let e="";for(const n of this.children)e+=n.toSimpleSvgPath();const t=rc.FromPoints(this.vertices).corners;for(let n=0,o=t.length;n<o;n++){const r=t[n],i=t[(n-1+o)%o],s=r.dist(i),a=t[(n+1)%o],l=r.dist(a),c=r.clone().lrp(i,4/s),d=r,u=r.clone().lrp(a,4/l);e+="M".concat(c.x,",").concat(c.y," L").concat(d.x,",").concat(d.y," L").concat(u.x,",").concat(u.y," ")}return e}getLength(){return this.children.reduce(((e,t)=>t.isLabel?e:e+t.length),0)}getSvgPathData(){return this.children.map(((e,t)=>e.isLabel?"":e.getSvgPathData(0===t))).join(" ")}}const lc=fn((function(t){let{showStroke:n=!0,showVertices:o=!0,showClosestPointOnOutline:r=!0}=t;const i=Ns();!function(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const[n,o]=(0,e.useState)(0),r=Ns();(0,e.useEffect)((()=>{if(!t)return;const e=()=>o((e=>e+1));return r.on("tick",e),()=>{r.off("tick",e)}}),[r,t])}(r);const s=i.getZoomLevel(),a=i.getRenderingShapes(),{inputs:{currentPagePoint:l}}=i;return(0,Ss.jsx)("svg",{style:{position:"absolute",pointerEvents:"none",zIndex:999999999,top:0,left:0,overflow:"visible"},children:a.map((e=>{var t;const a=i.getShape(e.id);if("group"===a.type)return null;const c=i.getShapeGeometry(a),d=i.getShapePageTransform(a),u=i.getPointInShapeSpace(a,l),h=c.nearestPoint(u),p=c.distanceToPoint(u,!0),f=Math.abs(p)*s,g=p<0,{vertices:m}=c;return(0,Ss.jsxs)("g",{transform:d.toCssString(),strokeLinecap:"round",strokeLinejoin:"round",children:[n&&(0,Ss.jsx)("g",{stroke:null!==(t=c.debugColor)&&void 0!==t?t:"red",opacity:"1",strokeWidth:2/s,fill:"none",children:(0,Ss.jsx)(cc,{geometry:c})}),o&&m.map(((e,t)=>(0,Ss.jsx)("circle",{cx:e.x,cy:e.y,r:2/s,fill:"hsl(".concat(de(t,[0,m.length-1],[120,200]),", 100%, 50%)"),stroke:"black",strokeWidth:1/s},"v".concat(t)))),r&&f<150&&(0,Ss.jsx)("line",{x1:h.x,y1:h.y,x2:u.x,y2:u.y,opacity:1-f/150,stroke:g?"goldenrod":"dodgerblue",strokeWidth:2/s})]},e.id+"_outline")}))})}));function cc(e){let{geometry:t}=e;return t instanceof ac?(0,Ss.jsx)(Ss.Fragment,{children:[...t.children,...t.ignoredChildren].map(((e,t)=>(0,Ss.jsx)(cc,{geometry:e},t)))}):(0,Ss.jsx)("path",{d:t.toSimpleSvgPath()})}function dc(e){return v(e)}function uc(){const t=Ns(),n=function(){const t=arguments[0],n=arguments[1],o=3===arguments.length?void 0:arguments[2],r=3===arguments.length?arguments[2]:arguments[3];return(0,e.useMemo)((()=>cn("useComputed(".concat(t,")"),n,o)),r)}("userIds",(()=>dc(t.getCollaborators().map((e=>e.userId))).sort()),{isEqual:(e,t)=>{var n;return e.join(",")===(null===(n=t.join)||void 0===n?void 0:n.call(t,","))}},[t]);return yn(n)}function hc(e){const t=Ns(),n=yn("latestPresence:".concat(e),(()=>t.getCollaborators().find((t=>t.userId===e))),[t,e]);return null!==n&&void 0!==n?n:null}const pc=fn((function(){return uc().map((e=>(0,Ss.jsx)(fc,{collaboratorId:e},e)))})),fc=fn((function(t){let{collaboratorId:n}=t;const o=Ns(),r=hc(n),i=function(t,n){var o;const r=(0,e.useRef)(null!==(o=null===n||void 0===n?void 0:n.lastActivityTimestamp)&&void 0!==o?o:-1),[i,s]=(0,e.useState)((()=>mc(t,Date.now()-r.current)));(0,e.useEffect)((()=>{const e=t.timers.setInterval((()=>{s(mc(t,Date.now()-r.current))}),t.options.collaboratorCheckIntervalMs);return()=>clearInterval(e)}),[t]),n&&(r.current=n.lastActivityTimestamp);return i}(o,r);if(!r||r.currentPageId!==o.getCurrentPageId())return null;switch(i){case"inactive":{const{followingUserId:e,highlightedUserIds:t}=o.getInstanceState();if(e!==r.userId&&!t.includes(r.userId))return null;break}case"idle":{const{highlightedUserIds:e}=o.getInstanceState();if(r.followingUserId===o.user.getId()&&!r.chatMessage&&!e.includes(r.userId))return null;break}}return(0,Ss.jsx)(gc,{latestPresence:r})})),gc=fn((function(e){let{latestPresence:t}=e;const n=Ns(),{CollaboratorBrush:o,CollaboratorScribble:r,CollaboratorCursor:i,CollaboratorHint:s,CollaboratorShapeIndicator:a}=md(),l=n.getZoomLevel(),c=n.getViewportPageBounds(),{userId:d,chatMessage:u,brush:h,scribbles:p,selectedShapeIds:f,userName:g,cursor:m,color:y}=t,v=!(m.x<c.minX-12/l||m.y<c.minY-16/l||m.x>c.maxX-12/l||m.y>c.maxY-16/l);return(0,Ss.jsxs)(Ss.Fragment,{children:[h&&o?(0,Ss.jsx)(o,{className:"tl-collaborator__brush",brush:h,color:y,opacity:.1},d+"_brush"):null,v&&i?(0,Ss.jsx)(i,{className:"tl-collaborator__cursor",point:m,color:y,zoom:l,name:"New User"!==g?g:null,chatMessage:null!==u&&void 0!==u?u:""},d+"_cursor"):s?(0,Ss.jsx)(s,{className:"tl-collaborator__cursor-hint",point:m,color:y,zoom:l,viewport:c},d+"_cursor_hint"):null,r&&p.length?(0,Ss.jsx)(Ss.Fragment,{children:p.map((e=>(0,Ss.jsx)(r,{className:"tl-collaborator__scribble",scribble:e,color:y,zoom:l,opacity:"laser"===e.color?.5:.1},d+"_scribble_"+e.id)))}):null,a&&f.filter((e=>!n.isShapeHidden(e))).map((e=>(0,Ss.jsx)(a,{className:"tl-collaborator__shape-indicator",shapeId:e,color:y,opacity:.5},d+"_"+e)))]})}));function mc(e,t){return t>e.options.collaboratorInactiveTimeoutMs?"inactive":t>e.options.collaboratorIdleTimeoutMs?"idle":"active"}function yc(){const t=Ns(),n=yn("is menu open",(()=>t.menus.hasAnyOpenMenus()),[t]),[o,r]=(0,e.useState)(!1),i=n||o,s=Ua(),a=(0,e.useRef)({isDown:!1,isDragging:!1,start:new Vs}),c=(0,e.useCallback)((e=>{0===e.button&&(r(!0),a.current={isDown:!0,isDragging:!1,start:new Vs(e.clientX,e.clientY)}),t.menus.clearOpenMenus()}),[t]),d=(0,e.useCallback)((e=>{var n;if(a.current.isDown)if(a.current.isDragging)null===(n=s.onPointerMove)||void 0===n||n.call(s,e);else if(Vs.Dist2(a.current.start,new Vs(e.clientX,e.clientY))>t.options.dragDistanceSquared){var o,r;a.current=l(l({},a.current),{},{isDown:!0,isDragging:!0});const{x:t,y:n}=a.current.start;null===(o=s.onPointerDown)||void 0===o||o.call(s,l(l({},e),{},{clientX:t,clientY:n,button:0})),null===(r=s.onPointerMove)||void 0===r||r.call(s,e)}}),[s,t]),u=(0,e.useCallback)((e=>{var t;null===(t=s.onPointerUp)||void 0===t||t.call(s,e),r(!1),a.current={isDown:!1,isDragging:!1,start:new Vs(e.clientX,e.clientY)}}),[s]);return i&&(0,Ss.jsx)("div",l(l({className:"tlui-menu-click-capture","data-testid":"menu-click-capture.content"},s),{},{onPointerDown:c,onPointerMove:d,onPointerUp:u}))}const vc=(0,e.memo)((function(t){let{id:n,shape:o,util:r,index:i,backgroundIndex:s,opacity:a}=t;const l=Ns(),{ShapeErrorFallback:c}=md(),d=(0,e.useRef)(null),u=(0,e.useRef)(null),h=(0,e.useRef)({transform:"",clipPath:"none",width:0,height:0,x:0,y:0,isCulled:!1});mn("set shape stuff",(()=>{var e;const t=l.getShape(n);if(!t)return;const o=h.current,r=null!==(e=l.getShapeClipPath(n))&&void 0!==e?e:"none";r!==o.clipPath&&(Na(d.current,"clip-path",r),Na(u.current,"clip-path",r),o.clipPath=r);const i=l.getShapePageTransform(n),s=ic.toCssString(i),a=l.getShapeGeometry(t).bounds;s!==o.transform&&(Na(d.current,"transform",s),Na(u.current,"transform",s),o.transform=s);const c=Math.max(a.width,1),p=Math.max(a.height,1);c===o.width&&p===o.height||(Na(d.current,"width",c+"px"),Na(d.current,"height",p+"px"),Na(u.current,"width",c+"px"),Na(u.current,"height",p+"px"),o.width=c,o.height=p)}),[l]),mn("set opacity and z-index",(()=>{const e=d.current,t=u.current;Na(e,"opacity",a),Na(t,"opacity",a),Na(e,"z-index",i),Na(t,"z-index",s)}),[a,i,s]),mn("set display",(()=>{if(!l.getShape(n))return;const e=l.getCulledShapes().has(n);e!==h.current.isCulled&&(Na(d.current,"display",e?"none":"block"),Na(u.current,"display",e?"none":"block"),h.current.isCulled=e)}),[l]);const p=(0,e.useCallback)((e=>l.annotateError(e,{origin:"shape",willCrashApp:!1})),[l]);if(!o)return null;const f="fill"in o.props&&"none"!==o.props.fill;return(0,Ss.jsxs)(Ss.Fragment,{children:[r.backgroundComponent&&(0,Ss.jsx)("div",{ref:u,className:"tl-shape tl-shape-background","data-shape-type":o.type,"data-shape-id":o.id,draggable:!1,children:(0,Ss.jsx)(Ts,{fallback:c,onError:p,children:(0,Ss.jsx)(wc,{shape:o,util:r})})}),(0,Ss.jsx)("div",{ref:d,className:"tl-shape","data-shape-type":o.type,"data-shape-is-filled":f,"data-shape-id":o.id,draggable:!1,children:(0,Ss.jsx)(Ts,{fallback:c,onError:p,children:(0,Ss.jsx)(bc,{shape:o,util:r})})})]})})),bc=(0,e.memo)((function(e){let{shape:t,util:n}=e;return dn("InnerShape:"+t.type,(()=>n.component(n.editor.store.unsafeGetWithoutCapture(t.id))),[n,t.id])}),((e,t)=>e.shape.props===t.shape.props&&e.shape.meta===t.shape.meta&&e.util===t.util)),wc=(0,e.memo)((function(e){let{shape:t,util:n}=e;return dn("InnerShape:"+t.type,(()=>{var e;return null===(e=n.backgroundComponent)||void 0===e?void 0:e.call(n,n.editor.store.unsafeGetWithoutCapture(t.id))}),[n,t.id])}),((e,t)=>e.shape.props===t.shape.props&&e.shape.meta===t.shape.meta&&e.util===t.util));function xc(t){let{className:n}=t;const o=Ns(),{Background:r,SvgDefs:i,ShapeIndicators:s}=md(),a=(0,e.useRef)(null),c=(0,e.useRef)(null),d=(0,e.useRef)(null),u=Va();!function(t){const n=Ns();(0,e.useLayoutEffect)((()=>{const e=y((()=>{t.current&&n.updateViewportScreenBounds(t.current)}),200,{trailing:!0}),o=n.timers.setInterval(e,1e3);window.addEventListener("resize",e);const r=new ResizeObserver((t=>{t[0].contentRect&&e()})),i=t.current;let s=null;return i&&(r.observe(i),s=oc(i),s.addEventListener("scroll",e)),()=>{var t;clearInterval(o),window.removeEventListener("resize",e),r.disconnect(),null===(t=s)||void 0===t||t.removeEventListener("scroll",e),e.cancel()}}),[n,t])}(a),function(){const t=Ns(),n=Va(),o=yn("isFocused",(()=>t.getIsFocused()),[t]);(0,e.useEffect)((()=>{if(n)return n.addEventListener("dragover",e),n.addEventListener("drop",e),()=>{n.removeEventListener("dragover",e),n.removeEventListener("drop",e)};function e(e){if(e.isSpecialRedispatchedEvent)return;Da(e),za(e);const t=n.querySelector(".tl-canvas");if(!t)return;const o=new DragEvent(e.type,e);o.isSpecialRedispatchedEvent=!0,t.dispatchEvent(o)}}),[n]),(0,e.useEffect)((()=>{if("undefined"===typeof window||!("matchMedia"in window))return;let e=null;const n=()=>{null!=e&&e();const o="(resolution: ".concat(window.devicePixelRatio,"dppx)"),r=matchMedia(o),i=e=>{"change"===e.type&&n()};r.addEventListener?r.addEventListener("change",n):r.addListener&&r.addListener(i),e=()=>{r.removeEventListener?r.removeEventListener("change",n):r.removeListener&&r.removeListener(i)},t.updateInstanceState({devicePixelRatio:window.devicePixelRatio})};return n(),()=>{var t;null===(t=e)||void 0===t||t()}}),[t]),(0,e.useEffect)((()=>{if(!o)return;const e=e=>{if(!e.altKey||!t.isIn("zoom")&&t.getPath().endsWith(".idle")||qa(t)||Da(e),e.isKilled)return;switch(e.isKilled=!0,e.key){case"=":case"-":case"0":if(e.metaKey||e.ctrlKey)return void Da(e);break;case"Tab":default:if(qa(t))return;break;case",":return;case"Escape":if((t.getEditingShape()||t.getSelectedShapeIds().length>0)&&Da(e),t.menus.getOpenMenus().length>0)return;return void(t.inputs.keys.has("Escape")||(t.inputs.keys.add("Escape"),t.cancel(),n.focus()))}const o={type:"keyboard",name:e.repeat?"key_repeat":"key_down",key:e.key,code:e.code,shiftKey:e.shiftKey,altKey:e.altKey,ctrlKey:e.metaKey||e.ctrlKey,metaKey:e.metaKey,accelKey:Fa(e)};t.dispatch(o)},r=e=>{if(e.isKilled)return;if(e.isKilled=!0,qa(t))return;if(","===e.key)return;const n={type:"keyboard",name:"key_up",key:e.key,code:e.code,shiftKey:e.shiftKey,altKey:e.altKey,ctrlKey:e.metaKey||e.ctrlKey,metaKey:e.metaKey,accelKey:Fa(e)};t.dispatch(n)};function i(e){if(n.contains(e.target)){const n=e.touches[0].pageX,i=e.touches[0].radiusX||0;var o,r;if(n-i<10||n+i>t.getViewportScreenBounds().width-10)"BUTTON"===(null===(o=e.target)||void 0===o?void 0:o.tagName)&&(null===(r=e.target)||void 0===r||r.click()),Da(e)}}const s=e=>{n.contains(e.target)&&(e.ctrlKey||e.metaKey)&&Da(e)};return n.addEventListener("touchstart",i,{passive:!1}),n.addEventListener("wheel",s,{passive:!1}),document.addEventListener("gesturestart",Da),document.addEventListener("gesturechange",Da),document.addEventListener("gestureend",Da),n.addEventListener("keydown",e),n.addEventListener("keyup",r),()=>{n.removeEventListener("touchstart",i),n.removeEventListener("wheel",s),document.removeEventListener("gesturestart",Da),document.removeEventListener("gesturechange",Da),document.removeEventListener("gestureend",Da),n.removeEventListener("keydown",e),n.removeEventListener("keyup",r)}}),[t,n,o])}(),function(){const t=Ns();(0,e.useEffect)((()=>{let e=t.getInstanceState().isCoarsePointer;const n=n=>{const o="mouse"!==n.pointerType;e!==o&&(e=o,t.updateInstanceState({isCoarsePointer:o}))};window.addEventListener("pointerdown",n,{capture:!0});const o=window.matchMedia&&window.matchMedia("(any-pointer: coarse)"),r=ka.isFirefox&&!ka.isAndroid&&!ka.isIos,i=()=>{const n=!r&&o.matches;e===n&&(e=n,t.updateInstanceState({isCoarsePointer:n}))};return o&&(o.addEventListener("change",i),i()),()=>{window.removeEventListener("pointerdown",n,{capture:!0}),o&&o.removeEventListener("change",i)}}),[t])}(),tc(a),function(t){const n=Ns();(0,e.useEffect)((()=>{const e=t.current;if(!e)return;const o=e=>{if(e instanceof PointerEvent&&"pen"===e.pointerType){var t;e.isKilled=!0;const{target:o}=e;if(Ya.includes(null===(t=o.tagName)||void 0===t?void 0:t.toLocaleLowerCase())||n.isIn("select.editing_shape"))return;Da(e)}};return e.addEventListener("touchstart",o),e.addEventListener("touchend",o),()=>{e.removeEventListener("touchstart",o),e.removeEventListener("touchend",o)}}),[n,t])}(a);const h=(0,e.useRef)({lodDisableTextOutline:!1,allowTextOutline:!0});mn("position layers",(function(){const{x:e,y:t,z:n}=o.getCamera();if(h.current.allowTextOutline&&ka.isSafari&&(u.style.setProperty("--tl-text-outline","none"),h.current.allowTextOutline=!1),h.current.allowTextOutline&&n<o.options.textShadowLod!==h.current.lodDisableTextOutline){const e=n<o.options.textShadowLod;u.style.setProperty("--tl-text-outline",e?"none":"var(--tl-text-outline-reference)"),h.current.lodDisableTextOutline=e}const r=n>=1?de(n,[1,8],[.125,.5],!0):de(n,[.1,1],[-2,.125],!0),i="scale(".concat(ga(n),") translate(").concat(ga(e+r),"px,").concat(ga(t+r),"px)");Na(c.current,"transform",i),Na(d.current,"transform",i)}),[o,u]);const p=Ua(),f=yn("shapeSvgDefs",(()=>{const e=new Map;for(const t of fe(o.shapeUtils)){if(!t)return;const n=t.getCanvasSvgDefs();for(const{key:t,component:o}of n)e.has(t)||e.set(t,(0,Ss.jsx)(o,{},t))}return[...e.values()]}),[o]),g=yn("debug_shapes",(()=>Ta.hideShapes.get()),[Ta]),m=yn("debug_svg",(()=>Ta.debugSvg.get()),[Ta]),v=yn("debug_geometry",(()=>Ta.debugGeometry.get()),[Ta]),b=yn("isEditingAnything",(()=>null!==o.getEditingShapeId()),[o]),w=yn("isSelectingAnything",(()=>!!o.getSelectedShapeIds().length),[o]);return(0,Ss.jsxs)(Ss.Fragment,{children:[(0,Ss.jsxs)("div",l(l({ref:a,draggable:!1,"data-iseditinganything":b,"data-isselectinganything":w,className:ks("tl-canvas",n),"data-testid":"canvas"},p),{},{children:[(0,Ss.jsx)("svg",{className:"tl-svg-context",children:(0,Ss.jsxs)("defs",{children:[f,(0,Ss.jsx)(Rc,{}),(0,Ss.jsx)(Lc,{}),i&&(0,Ss.jsx)(i,{})]})}),r&&(0,Ss.jsx)("div",{className:"tl-background__wrapper",children:(0,Ss.jsx)(r,{})}),(0,Ss.jsx)(kc,{}),(0,Ss.jsxs)("div",{ref:c,className:"tl-html-layer tl-shapes",draggable:!1,children:[(0,Ss.jsx)(Bc,{}),(0,Ss.jsx)(Fc,{}),g?null:m?(0,Ss.jsx)(Mc,{}):(0,Ss.jsx)(Oc,{})]}),(0,Ss.jsx)("div",{className:"tl-overlays",children:(0,Ss.jsxs)("div",{ref:d,className:"tl-html-layer",children:[v?(0,Ss.jsx)(lc,{}):null,(0,Ss.jsx)(Ec,{}),(0,Ss.jsx)(Cc,{}),(0,Ss.jsx)(Pc,{}),(0,Ss.jsx)(_c,{}),s&&(0,Ss.jsx)(s,{}),(0,Ss.jsx)(Dc,{}),(0,Ss.jsx)(Ic,{}),(0,Ss.jsx)(Nc,{}),(0,Ss.jsx)(pc,{})]})}),(0,Ss.jsx)(Uc,{})]})),(0,Ss.jsx)(yc,{}),(0,Ss.jsx)(Sc,{})]})}function Sc(){const{InFrontOfTheCanvas:e}=md();return e?(0,Ss.jsx)(e,{}):null}function kc(){const e=Ns(),t=yn("gridSize",(()=>e.getDocumentSettings().gridSize),[e]),{x:n,y:o,z:r}=yn("camera",(()=>e.getCamera()),[e]),i=yn("isGridMode",(()=>e.getInstanceState().isGridMode),[e]),{Grid:s}=md();return s&&i?(0,Ss.jsx)(s,{x:n,y:o,z:r,size:t}):null}function Pc(){const e=Ns(),t=yn("scribbles",(()=>e.getInstanceState().scribbles),[e]),n=yn("zoomLevel",(()=>e.getZoomLevel()),[e]),{Scribble:o}=md();return o&&t.length?t.map((e=>(0,Ss.jsx)(o,{className:"tl-user-scribble",scribble:e,zoom:n},e.id))):null}function Cc(){const e=Ns(),t=yn("brush",(()=>e.getInstanceState().brush),[e]),{Brush:n}=md();return n&&t?(0,Ss.jsx)(n,{className:"tl-user-brush",brush:t}):null}function _c(){const e=Ns(),t=yn("zoomBrush",(()=>e.getInstanceState().zoomBrush),[e]),{ZoomBrush:n}=md();return n&&t?(0,Ss.jsx)(n,{className:"tl-user-brush tl-zoom-brush",brush:t}):null}function Ic(){const e=Ns(),t=yn("snapLines",(()=>e.snaps.getIndicators()),[e]),n=yn("zoomLevel",(()=>e.getZoomLevel()),[e]),{SnapIndicator:o}=md();return o&&t.length>0?t.map((e=>(0,Ss.jsx)(o,{className:"tl-user-snapline",line:e,zoom:n},e.id))):null}function Ec(){const e=Ns(),t=yn("handles shapeIdWithHandles",(()=>{const{isReadonly:t,isChangingStyle:n}=e.getInstanceState();if(t||n)return!1;const o=e.getOnlySelectedShape();if(!o)return!1;return!!e.getShapeHandles(o)&&o.id}),[e]);return t?(0,Ss.jsx)(jc,{shapeId:t}):null}function jc(e){let{shapeId:t}=e;const n=Ns(),{Handles:o}=md(),r=yn("zoomLevel",(()=>n.getZoomLevel()),[n]),i=yn("coarse pointer",(()=>n.getInstanceState().isCoarsePointer),[n]),s=yn("handles transform",(()=>n.getShapePageTransform(t)),[n,t]),a=yn("handles",(()=>{const e=n.getShapeHandles(t);if(!e)return null;const o=(i?n.options.coarseHandleRadius:n.options.handleRadius)/r*2;return e.filter((t=>"virtual"!==t.type||!e.some((e=>e!==t&&"vertex"===e.type&&Vs.Dist(t,e)<o)))).sort((e=>"vertex"===e.type?1:-1))}),[n,r,i,t]),l=yn("isHidden",(()=>n.isShapeHidden(t)),[n,t]);return o&&a&&s&&!l?(0,Ss.jsx)(o,{children:(0,Ss.jsx)("g",{transform:ic.toCssString(s),children:a.map((e=>(0,Ss.jsx)(Tc,{shapeId:t,handle:e,zoom:r,isCoarse:i},e.id)))})}):null}function Tc(t){let{shapeId:n,handle:o,zoom:r,isCoarse:i}=t;const s=function(t,n){const o=Ns();return e.useMemo((()=>{let e,r;return{onPointerDown:e=>{if(e.isKilled)return;Ra(Oa(e.currentTarget),e);const{shape:r,handle:i}=nc(o,t,n);i&&o.dispatch(l({type:"pointer",target:"handle",handle:i,shape:r,name:"pointer_down"},Ba(e)))},onPointerMove:i=>{if(i.isKilled)return;if(i.clientX===e&&i.clientY===r)return;e=i.clientX,r=i.clientY;const{shape:s,handle:a}=nc(o,t,n);a&&o.dispatch(l({type:"pointer",target:"handle",handle:a,shape:s,name:"pointer_move"},Ba(i)))},onPointerUp:e=>{if(e.isKilled)return;La(Oa(e.currentTarget),e);const{shape:r,handle:i}=nc(o,t,n);i&&o.dispatch(l({type:"pointer",target:"handle",handle:i,shape:r,name:"pointer_up"},Ba(e)))}}}),[o,t,n])}(n,o.id),{Handle:a}=md();return a?(0,Ss.jsx)("g",l(l({"aria-label":"handle",transform:"translate(".concat(o.x,", ").concat(o.y,")")},s),{},{children:(0,Ss.jsx)(a,{shapeId:n,handle:o,zoom:r,isCoarse:i})})):null}function Mc(){const t=Ns();return yn("rendering shapes",(()=>t.getRenderingShapes()),[t]).map((t=>(0,Ss.jsxs)(e.Fragment,{children:[(0,Ss.jsx)(vc,l({},t)),(0,Ss.jsx)(zc,{id:t.id,mode:"iframe"})]},t.id+"_fragment")))}function Ac(){const t=Ns(),n=(0,e.useRef)(new Set);return mn("reflow for culled shapes",(()=>{const e=t.getCulledShapes();if(n.current.size===e.size&&[...e].every((e=>n.current.has(e))))return;n.current=e;const o=document.getElementsByClassName("tl-canvas");if(0===o.length)return;o[0].offsetHeight}),[t]),null}function Oc(){const e=Ns(),t=yn("rendering shapes",(()=>e.getRenderingShapes()),[e]);return(0,Ss.jsxs)(Ss.Fragment,{children:[t.map((e=>(0,Ss.jsx)(vc,l({},e),e.id+"_shape"))),ka.isSafari&&(0,Ss.jsx)(Ac,{})]})}function Dc(){const e=Ns(),{ShapeIndicator:t}=md(),n=yn("hinting shape ids",(()=>P(e.getHintingShapeIds())),[e]);return n.length&&t?n.map((e=>(0,Ss.jsx)(t,{className:"tl-user-indicator__hint",shapeId:e},e+"_hinting"))):null}function Rc(){return(0,Ss.jsxs)("g",{id:Os("cursor"),children:[(0,Ss.jsxs)("g",{fill:"rgba(0,0,0,.2)",transform:"translate(-11,-11)",children:[(0,Ss.jsx)("path",{d:"m12 24.4219v-16.015l11.591 11.619h-6.781l-.411.124z"}),(0,Ss.jsx)("path",{d:"m21.0845 25.0962-3.605 1.535-4.682-11.089 3.686-1.553z"})]}),(0,Ss.jsxs)("g",{fill:"white",transform:"translate(-12,-12)",children:[(0,Ss.jsx)("path",{d:"m12 24.4219v-16.015l11.591 11.619h-6.781l-.411.124z"}),(0,Ss.jsx)("path",{d:"m21.0845 25.0962-3.605 1.535-4.682-11.089 3.686-1.553z"})]}),(0,Ss.jsxs)("g",{fill:"currentColor",transform:"translate(-12,-12)",children:[(0,Ss.jsx)("path",{d:"m19.751 24.4155-1.844.774-3.1-7.374 1.841-.775z"}),(0,Ss.jsx)("path",{d:"m13 10.814v11.188l2.969-2.866.428-.139h4.768z"})]})]})}function Lc(){const e=Os("cursor_hint");return(0,Ss.jsx)("path",{id:e,fill:"currentColor",d:"M -2,-5 2,0 -2,5 Z"})}function zc(t){let{id:n,mode:o}=t;const r=Ns(),[i,s]=(0,e.useState)(null),a=yn("is in root",(()=>{const e=r.getShape(n);return(null===e||void 0===e?void 0:e.parentId)===r.getCurrentPageId()}),[r,n]);return(0,e.useEffect)((()=>{if(!a)return;let e=null;const t=Ht("shape to svg",(async()=>{const t=Math.random();e=t;const o=r.isShapeOfType(n,"frame")?0:10;let i=r.getShapePageBounds(n);if(!i)return;i=i.clone().expandBy(o);const a=await r.getSvgString([n],{padding:o,background:r.getInstanceState().exportBackground});if(e!==t||!a)return;const l="data:image/svg+xml;utf8,".concat(encodeURIComponent(a.svg));s({src:l,bounds:i})}));return()=>{e=null,t()}}),[r,n,a]),a&&i?"iframe"===o?(0,Ss.jsx)("iframe",{src:i.src,width:i.bounds.width,height:i.bounds.height,referrerPolicy:"no-referrer",style:{position:"absolute",top:0,left:0,border:"none",transform:"translate(".concat(i.bounds.x,"px, ").concat(i.bounds.maxY+12,"px)"),outline:"1px solid black",maxWidth:"none"}}):(0,Ss.jsx)("img",{src:i.src,width:i.bounds.width,height:i.bounds.height,referrerPolicy:"no-referrer",style:{position:"absolute",top:0,left:0,transform:"translate(".concat(i.bounds.x,"px, ").concat(i.bounds.maxY+12,"px)"),outline:"1px solid black",maxWidth:"none"}}):null}function Nc(){const e=Ns(),t=yn("selection rotation",(()=>e.getSelectionRotation()),[e]),n=yn("selection bounds",(()=>e.getSelectionRotatedPageBounds()),[e]),{SelectionForeground:o}=md();return n&&o?(0,Ss.jsx)(o,{bounds:n,rotation:t}):null}function Fc(){const e=Ns(),t=yn("selection rotation",(()=>e.getSelectionRotation()),[e]),n=yn("selection bounds",(()=>e.getSelectionRotatedPageBounds()),[e]),{SelectionBackground:o}=md();return n&&o?(0,Ss.jsx)(o,{bounds:n,rotation:t}):null}function Bc(){const{OnTheCanvas:e}=md();return e?(0,Ss.jsx)(e,{}):null}function Uc(){const e=Ns(),t=yn("camera state",(()=>e.getCameraState()),[e]);return(0,Ss.jsx)("div",{className:ks("tl-hit-test-blocker",{"tl-hit-test-blocker__hidden":"idle"===t})})}function Hc(t){let{className:n,zoom:o,point:r,color:i,viewport:s,opacity:a=1}=t;const l=(0,e.useRef)(null);Hs(l,Qs(r.x,s.minX+5/o,s.maxX-5/o),Qs(r.y,s.minY+5/o,s.maxY-5/o),1/o,Vs.Angle(s.center,r));const c=Os("cursor_hint");return(0,Ss.jsxs)("svg",{ref:l,className:ks("tl-overlays__item",n),children:[(0,Ss.jsx)("use",{href:"#".concat(c),color:i,strokeWidth:3,stroke:"var(--color-background)"}),(0,Ss.jsx)("use",{href:"#".concat(c),color:i,opacity:a})]})}const Kc=(0,e.memo)((function(t){let{className:n,zoom:o,point:r,color:i,name:s,chatMessage:a}=t;const l=(0,e.useRef)(null);Hs(l,null===r||void 0===r?void 0:r.x,null===r||void 0===r?void 0:r.y,1/o);const c=Os("cursor");return r?(0,Ss.jsxs)("div",{ref:l,className:ks("tl-overlays__item",n),children:[(0,Ss.jsx)("svg",{className:"tl-cursor",children:(0,Ss.jsx)("use",{href:"#".concat(c),color:i})}),a?(0,Ss.jsxs)(Ss.Fragment,{children:[s&&(0,Ss.jsx)("div",{className:"tl-nametag-title",style:{color:i},children:s}),(0,Ss.jsx)("div",{className:"tl-nametag-chat",style:{backgroundColor:i},children:a})]}):s&&(0,Ss.jsx)("div",{className:"tl-nametag",style:{backgroundColor:i},children:s})]}):null}));function Vc(e){let{x:t,y:n,z:o,size:r}=e;const i=As("grid"),s=Ns(),{gridSteps:a}=s.options;return(0,Ss.jsxs)("svg",{className:"tl-grid",version:"1.1",xmlns:"http://www.w3.org/2000/svg",children:[(0,Ss.jsx)("defs",{children:a.map(((e,s)=>{let{min:a,mid:l,step:c}=e;const d=c*r*o,u=.5+t*o,h=.5+n*o,p=u>0?u%d:d+u%d,f=h>0?h%d:d+h%d,g=o<l?de(o,[a,l],[0,1]):1;return(0,Ss.jsx)("pattern",{id:Ms(i,"".concat(c)),width:d,height:d,patternUnits:"userSpaceOnUse",children:(0,Ss.jsx)("circle",{className:"tl-grid-dot",cx:p,cy:f,r:1,opacity:g})},s)}))}),a.map(((e,t)=>{let{step:n}=e;return(0,Ss.jsx)("rect",{width:"100%",height:"100%",fill:"url(#".concat(i,"_").concat(n,")")},t)}))]})}function Wc(e){let{handle:t,isCoarse:n,className:o,zoom:r}=e;const i=Ns(),s=(n?i.options.coarseHandleRadius:i.options.handleRadius)/r;if("clone"===t.type){const e=3/r,n="M0,".concat(-e," A").concat(e,",").concat(e," 0 0,1 0,").concat(e),i=Ia.indexOf(t.id);return(0,Ss.jsxs)("g",{className:ks("tl-handle tl-handle__".concat(t.type),o),children:[(0,Ss.jsx)("circle",{className:"tl-handle__bg",r:s}),(0,Ss.jsx)("path",{className:"tl-handle__fg",d:n,transform:"rotate(".concat(90*i-90,")")})]})}const a=("create"===t.type&&n?3:4)/Math.max(r,.25);return(0,Ss.jsxs)("g",{className:ks("tl-handle tl-handle__".concat(t.type),o),children:[(0,Ss.jsx)("circle",{className:"tl-handle__bg",r:s}),(0,Ss.jsx)("circle",{className:"tl-handle__fg",r:a})]})}const qc=e=>{let{children:t}=e;return(0,Ss.jsx)("svg",{className:"tl-user-handles tl-overlays__item",children:t})},Yc=()=>{const{Spinner:e}=md();return(0,Ss.jsx)(Ib,{children:e?(0,Ss.jsx)(e,{}):null})};function Gc(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const n=e.length;if(n<2)return"";let o=e[0],r=e[1];if(2===n)return"M".concat(qs(o),"L").concat(qs(r));let i="";for(let s=2,a=n-1;s<a;s++)o=e[s],r=e[s+1],i+=Ys(o,r);return t?"M".concat(Ys(e[0],e[1]),"Q").concat(qs(e[1])).concat(Ys(e[1],e[2]),"T").concat(i).concat(Ys(e[n-1],e[0])).concat(Ys(e[0],e[1]),"Z"):"M".concat(qs(e[0]),"Q").concat(qs(e[1])).concat(Ys(e[1],e[2])).concat(e.length>3?"T":"").concat(i,"L").concat(qs(e[n-1]))}function Xc(e){let{scribble:t,zoom:n,color:o,opacity:r,className:i}=e;return t.points.length?(0,Ss.jsx)("svg",{className:i?ks("tl-overlays__item",i):i,children:(0,Ss.jsx)("path",{className:"tl-scribble",d:Gc(t.points,!1),stroke:null!==o&&void 0!==o?o:"var(--color-".concat(t.color,")"),fill:"none",strokeWidth:8/n,opacity:null!==r&&void 0!==r?r:t.opacity})}):null}function $c(t){let{bounds:n,rotation:o}=t;const r=e.useRef(null);return Hs(r,n.x,n.y,1,o),e.useLayoutEffect((()=>{const e=r.current;e&&(e.style.width=ga(Math.max(1,n.width))+"px",e.style.height=ga(Math.max(1,n.height))+"px")}),[n.width,n.height]),(0,Ss.jsx)("div",{ref:r,className:"tl-selection__bg",draggable:!1})}function Zc(t){var n,o;let{bounds:r,rotation:i}=t;const s=Ns(),a=(0,e.useRef)(null),l=yn("only selected shape",(()=>s.getOnlySelectedShape()),[s]),c=l?s.getShapeUtil(l).expandSelectionOutlinePx(l):0;return Hs(a,null===(n=r)||void 0===n?void 0:n.x,null===(o=r)||void 0===o?void 0:o.y,1,i,{x:-c,y:-c}),r=r.clone().expandBy(c).zeroFix(),(0,Ss.jsx)("svg",{ref:a,className:"tl-overlays__item tl-selection__fg","data-testid":"selection-foreground",children:(0,Ss.jsx)("rect",{className:ks("tl-selection__fg__outline"),width:ga(r.width),height:ga(r.height)})})}const Qc=()=>(0,Ss.jsx)("div",{className:"tl-shape-error-boundary"}),Jc=e=>{let{shape:t,util:n}=e;return dn("Indicator: "+t.type,(()=>n.indicator(n.editor.store.unsafeGetWithoutCapture(t.id))))},ed=e=>{let{editor:t,id:n}=e;const o=yn("shape for indicator",(()=>t.store.get(n)),[t,n]),{ShapeIndicatorErrorFallback:r}=md();return!o||o.isLocked?null:(0,Ss.jsx)(Ts,{fallback:r,onError:e=>t.annotateError(e,{origin:"react.shapeIndicator",willCrashApp:!1}),children:(0,Ss.jsx)(Jc,{shape:o,util:t.getShapeUtil(o)},o.id)})},td=(0,e.memo)((function(t){let{shapeId:n,className:o,color:r,hidden:i,opacity:s}=t;const a=Ns(),l=(0,e.useRef)(null);return mn("indicator transform",(()=>{const e=l.current;if(!e)return;const t=a.getShapePageTransform(n);t&&e.style.setProperty("transform",t.toCssString())}),[a,n]),(0,e.useLayoutEffect)((()=>{const e=l.current;e&&e.style.setProperty("display",i?"none":"block")}),[i]),(0,Ss.jsx)("svg",{ref:l,className:ks("tl-overlays__item",o),children:(0,Ss.jsx)("g",{className:"tl-shape-indicator",stroke:null!==r&&void 0!==r?r:"var(--color-selected)",opacity:s,children:(0,Ss.jsx)(ed,{editor:a,id:n})})})})),nd=()=>(0,Ss.jsx)("circle",{cx:4,cy:4,r:8,strokeWidth:"1",stroke:"red"}),od=(0,e.memo)((function(){const t=Ns(),n=(0,e.useRef)(new Set),o=yn("should display selected ids",(()=>{const e=n.current,o=new Set;if(t.isInAny("select.idle","select.brushing","select.scribble_brushing","select.editing_shape","select.pointing_shape","select.pointing_selection","select.pointing_handle")&&!t.getInstanceState().isChangingStyle){const e=t.getSelectedShapeIds();for(const t of e)o.add(t);if(t.isInAny("select.idle","select.editing_shape")){const e=t.getInstanceState();if(e.isHoveringCanvas&&!e.isCoarsePointer){const e=t.getHoveredShapeId();e&&o.add(e)}}}if(e.size!==o.size)return n.current=o,o;for(const t of o)if(!e.has(t))return n.current=o,o;return e}),[t]),r=yn("rendering shapes",(()=>t.getRenderingShapes()),[t]),{ShapeIndicator:i}=md();return i?r.map((e=>{let{id:t}=e;return(0,Ss.jsx)(i,{shapeId:t,hidden:!o.has(t)},t+"_indicator")})):null}));function rd(e){let{points:t,zoom:n}=e;const o=2.5/n,r=t.reduce(((e,t)=>Math.min(e,t.x)),1/0),i=t.reduce(((e,t)=>Math.max(e,t.x)),-1/0),s=t.reduce(((e,t)=>Math.min(e,t.y)),1/0),a=t.reduce(((e,t)=>Math.max(e,t.y)),-1/0);let l,c,d,u;return t.some((e=>e.x===r&&e.y===s))?(l=r,c=s,d=i,u=a):(l=r,c=a,d=i,u=s),(0,Ss.jsxs)("g",{className:"tl-snap-indicator",stroke:"lime",children:[(0,Ss.jsx)("line",{x1:l,y1:c,x2:d,y2:u}),t.map(((e,t)=>(0,Ss.jsx)("g",{transform:"translate(".concat(e.x,",").concat(e.y,")"),children:(0,Ss.jsx)("path",{className:"tl-snap-point",d:"M ".concat(-o,",").concat(-o," L ").concat(o,",").concat(o," M ").concat(-o,",").concat(o," L ").concat(o,",").concat(-o)})},t)))]})}function id(t){let{gaps:n,direction:o,zoom:r}=t;const i=3.5/r;let s=[-1/0,1/0],a=null;const l="horizontal"===o;for(const e of n)a=ha(s[0],s[1],l?e.startEdge[0].y:e.startEdge[0].x,l?e.startEdge[1].y:e.startEdge[1].x),a&&(s=a,a=ha(s[0],s[1],l?e.endEdge[0].y:e.endEdge[0].x,l?e.endEdge[1].y:e.endEdge[1].x),a&&(s=a));if(null===s)return null;const c=(s[0]+s[1])/2;return(0,Ss.jsx)("g",{className:"tl-snap-indicator",stroke:"cyan",children:n.map(((t,n)=>{let{startEdge:o,endEdge:r}=t;return(0,Ss.jsx)(e.Fragment,{children:l?(0,Ss.jsxs)(Ss.Fragment,{children:[(0,Ss.jsx)("line",{x1:o[0].x,y1:c-2*i,x2:o[1].x,y2:c+2*i}),(0,Ss.jsx)("line",{x1:r[0].x,y1:c-2*i,x2:r[1].x,y2:c+2*i}),(0,Ss.jsx)("line",{x1:o[0].x,y1:c,x2:r[0].x,y2:c}),(0,Ss.jsx)("line",{x1:(o[0].x+r[0].x)/2,y1:c-i,x2:(o[0].x+r[0].x)/2,y2:c+i})]}):(0,Ss.jsxs)(Ss.Fragment,{children:[(0,Ss.jsx)("line",{x1:c-2*i,y1:o[0].y,x2:c+2*i,y2:o[1].y}),(0,Ss.jsx)("line",{x1:c-2*i,y1:r[0].y,x2:c+2*i,y2:r[1].y}),(0,Ss.jsx)("line",{x1:c,y1:o[0].y,x2:c,y2:r[0].y}),(0,Ss.jsx)("line",{x1:c-i,y1:(o[0].y+r[0].y)/2,x2:c+i,y2:(o[0].y+r[0].y)/2})]})},n)}))})}function sd(e){let{className:t,line:n,zoom:o}=e;return(0,Ss.jsx)("svg",{className:ks("tl-overlays__item",t),children:"points"===n.type?(0,Ss.jsx)(rd,l(l({},n),{},{zoom:o})):"gaps"===n.type?(0,Ss.jsx)(id,l(l({},n),{},{zoom:o})):null})}function ad(){return(0,Ss.jsx)("svg",{width:16,height:16,viewBox:"0 0 16 16",children:(0,Ss.jsxs)("g",{strokeWidth:2,fill:"none",fillRule:"evenodd",children:[(0,Ss.jsx)("circle",{strokeOpacity:.25,cx:8,cy:8,r:7,stroke:"currentColor"}),(0,Ss.jsx)("path",{strokeLinecap:"round",d:"M15 8c0-4.5-4.5-7-7-7",stroke:"currentColor",children:(0,Ss.jsx)("animateTransform",{attributeName:"transform",type:"rotate",from:"0 8 8",to:"360 8 8",dur:"1s",repeatCount:"indefinite"})})]})})}const ld=()=>null;function cd(t,n){const o=(0,e.useRef)(t);return n(t,o.current)?o.current:(o.current=t,t)}const dd=(e,t)=>{var n,o;return null!==(n=e)&&void 0!==n||(e=null),null!==(o=t)&&void 0!==o||(t=null),e===t||!(!e||!t)&&function(e,t){if(e===t)return!0;if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!Object.is(e[n],t[n]))return!1;return!0}(e,t)};function ud(e){return cd(e,dd)}const hd=(e,t)=>{var n,o;return null!==(n=e)&&void 0!==n||(e=null),null!==(o=t)&&void 0!==o||(t=null),e===t||!(!e||!t)&&be(e,t)};function pd(e){return cd(e,hd)}const fd=(0,e.createContext)(null);function gd(t){let{overrides:n={},children:o}=t;const r=pd(n),i=(0,e.useMemo)((()=>l({Background:Us,SvgDefs:ld,Brush:Sa,ZoomBrush:Sa,CollaboratorBrush:Sa,Cursor:Kc,CollaboratorCursor:Kc,CollaboratorHint:Hc,CollaboratorShapeIndicator:td,Grid:Vc,Scribble:Xc,SnapIndicator:sd,Handles:qc,Handle:Wc,CollaboratorScribble:Xc,ErrorFallback:bd,ShapeErrorFallback:Qc,ShapeIndicatorErrorFallback:nd,Spinner:ad,SelectionBackground:$c,SelectionForeground:Zc,ShapeIndicators:od,ShapeIndicator:td,OnTheCanvas:null,InFrontOfTheCanvas:null,Canvas:xc,LoadingScreen:Yc},r)),[r]);return(0,Ss.jsx)(fd.Provider,{value:i,children:o})}function md(){const t=(0,e.useContext)(fd);if(!t)throw new Error("useEditorComponents must be used inside of <EditorComponentsProvider />");return t}const yd={openWindow(e,t){window.open(e,t,"noopener noreferrer")},refreshPage(){window.location.reload()},async hardReset(){var e,t;return await(null===(e=(t=window).__tldraw__hardReset)||void 0===e?void 0:e.call(t))}};function vd(){yd.hardReset()}const bd=t=>{let{error:n,editor:o}=t;const r=(0,e.useRef)(null),[i,s]=(0,e.useState)(!1),[a,l]=(0,e.useState)(!1),[c,d]=(0,e.useState)(!1);let u=null;try{var h;u=null!==(h=md().Canvas)&&void 0!==h?h:null}catch(b){}const p=n instanceof Error?n.message:String(n),f=n instanceof Error?n.stack:null,g=yn("isDarkMode",(()=>{try{if(o)return o.user.getIsDarkMode()}catch(e){}return null}),[o]),[m,y]=(0,e.useState)(null);(0,e.useLayoutEffect)((()=>{var e;null!==g&&y(g);let t=null===(e=r.current)||void 0===e?void 0:e.parentElement,n=!1;for(;t;){if(t.classList.contains("tl-theme__dark")||t.classList.contains("tl-theme__light")){n=!0;break}t=t.parentElement}n?y(null):"undefined"!==typeof window&&"matchMedia"in window&&y(window.matchMedia("(prefers-color-scheme: dark)").matches)}),[g]),(0,e.useEffect)((()=>{if(a){const e=null===o||void 0===o?void 0:o.timers.setTimeout((()=>{l(!1)}),2e3);return()=>clearTimeout(e)}}),[a,o]);const v=new URL("https://github.com/tldraw/tldraw/issues/new");return v.searchParams.set("title",p),v.searchParams.set("labels","bug"),v.searchParams.set("body","Hey, I ran into an error while using tldraw:\n\n```js\n".concat(null!==f&&void 0!==f?f:p,"\n```\n\nMy browser: ").concat(navigator.userAgent)),(0,Ss.jsxs)("div",{ref:r,className:ks("tl-container tl-error-boundary",null===m?"":m?"tl-theme__dark":"tl-theme__light"),children:[(0,Ss.jsx)("div",{className:"tl-error-boundary__overlay"}),o&&(0,Ss.jsx)(js,{onError:E,fallback:()=>null,children:(0,Ss.jsx)(Bs,{editor:o,children:(0,Ss.jsx)("div",{className:"tl-overlay tl-error-boundary__canvas",children:u?(0,Ss.jsx)(u,{}):null})})}),(0,Ss.jsx)("div",{className:ks("tl-modal","tl-error-boundary__content",{"tl-error-boundary__content__expanded":i&&!c}),children:c?(0,Ss.jsxs)(Ss.Fragment,{children:[(0,Ss.jsx)("h2",{children:"Are you sure?"}),(0,Ss.jsx)("p",{children:"Resetting your data will delete your drawing and cannot be undone."}),(0,Ss.jsxs)("div",{className:"tl-error-boundary__content__actions",children:[(0,Ss.jsx)("button",{onClick:()=>d(!1),children:"Cancel"}),(0,Ss.jsx)("button",{className:"tl-error-boundary__reset",onClick:async()=>{vd()},children:"Reset data"})]})]}):(0,Ss.jsxs)(Ss.Fragment,{children:[(0,Ss.jsx)("h2",{children:"Something went wrong"}),(0,Ss.jsx)("p",{children:"Please refresh the page to continue."}),(0,Ss.jsxs)("p",{children:["If you keep seeing this screen, you can create a"," ",(0,Ss.jsx)("a",{href:v.toString(),children:"GitHub issue"})," or ask for help on"," ",(0,Ss.jsx)("a",{href:"https://discord.gg/Cq6cPsTfNy",children:"Discord"}),". If you are still stuck, you can reset the tldraw data on your machine. This may erase the project you were working on, so try to get help first."]}),i&&(0,Ss.jsxs)(Ss.Fragment,{children:["Message:",(0,Ss.jsx)("h4",{children:(0,Ss.jsx)("code",{children:p})}),"Stack trace:",(0,Ss.jsxs)("div",{className:"tl-error-boundary__content__error",children:[(0,Ss.jsx)("pre",{children:(0,Ss.jsx)("code",{children:null!==f&&void 0!==f?f:p})}),(0,Ss.jsx)("button",{onClick:()=>{const e=document.createElement("textarea");e.value=null!==f&&void 0!==f?f:p,document.body.appendChild(e),e.select(),document.execCommand("copy"),e.remove(),l(!0)},children:a?"Copied!":"Copy"})]})]}),(0,Ss.jsxs)("div",{className:"tl-error-boundary__content__actions",children:[(0,Ss.jsx)("button",{onClick:()=>s(!i),children:i?"Hide details":"Show details"}),(0,Ss.jsxs)("div",{className:"tl-error-boundary__content__actions__group",children:[(0,Ss.jsx)("button",{className:"tl-error-boundary__reset",onClick:()=>d(!0),children:"Reset data"}),(0,Ss.jsx)("button",{className:"tl-error-boundary__refresh",onClick:()=>{yd.refreshPage()},children:"Refresh Page"})]})]})]})})]})},wd="TLDRAW_USER_DATA_v3",xd=co({id:Qn,name:Qn.nullable().optional(),color:Qn.nullable().optional(),locale:Qn.nullable().optional(),animationSpeed:Jn.nullable().optional(),edgeScrollSpeed:Jn.nullable().optional(),colorScheme:bo("light","dark","system").optional(),isSnapMode:io.nullable().optional(),isWrapMode:io.nullable().optional(),isDynamicSizeMode:io.nullable().optional(),isPasteAtCursorMode:io.nullable().optional()}),Sd={AddAnimationSpeed:1,AddIsSnapMode:2,MakeFieldsNullable:3,AddEdgeScrollSpeed:4,AddExcalidrawSelectMode:5,AddDynamicSizeMode:6,AllowSystemColorScheme:7,AddPasteAtCursor:8},kd=Math.max(...Object.values(Sd));const Pd=["#FF802B","#EC5E41","#F2555A","#F04F88","#E34BA9","#BD54C6","#9D5BD2","#7B66DC","#02B1CC","#11B3A3","#39B178","#55B467"];function Cd(){return Pd[Math.floor(Math.random()*Pd.length)]}const _d=Object.freeze({name:"New User",locale:function(){var e;return function(e){for(const t of e){const e=xs(t);if(e)return e}return"en"}("undefined"!==typeof window&&null!==(e=window.navigator.languages)&&void 0!==e?e:["en"])}(),color:Cd(),edgeScrollSpeed:1,animationSpeed:function(){var e,t,n;return"undefined"!==typeof window&&"matchMedia"in window&&(null!==(e=null===(t=(n=window).matchMedia)||void 0===t||null===(t=t.call(n,"(prefers-reduced-motion: reduce)"))||void 0===t?void 0:t.matches)&&void 0!==e&&e)}()?0:1,isSnapMode:!1,isWrapMode:!1,isDynamicSizeMode:!1,isPasteAtCursorMode:!1,colorScheme:"light"});function Id(){return{id:$(),color:Cd()}}function Ed(e){if(null===e||"object"!==typeof e)return Id();if(!("version"in e)||!("user"in e)||"number"!==typeof e.version)return Id();const t=bt(e);var n;(n=t).version<Sd.AddAnimationSpeed&&(n.user.animationSpeed=1),n.version<Sd.AddIsSnapMode&&(n.user.isSnapMode=!1),n.version,n.version<Sd.AddEdgeScrollSpeed&&(n.user.edgeScrollSpeed=1),n.version<Sd.AddExcalidrawSelectMode&&(n.user.isWrapMode=!1),n.version<Sd.AllowSystemColorScheme&&(!0===n.user.isDarkMode?n.user.colorScheme="dark":!1===n.user.isDarkMode&&(n.user.colorScheme="light"),delete n.user.isDarkMode),n.version<Sd.AddDynamicSizeMode&&(n.user.isDynamicSizeMode=!1),n.version<Sd.AddPasteAtCursor&&(n.user.isPasteAtCursorMode=!1),n.version=kd;try{return xd.validate(t.user)}catch(o){return Id()}}const jd=Qt("globalUserData",null);function Td(e){xd.validate(e),jd.set(e),nt(wd,JSON.stringify({version:kd,user:jd.get()})),null===Ad||void 0===Ad||Ad.postMessage({type:Rd,origin:Dd(),data:{user:Ld(),version:kd}})}const Md="undefined"!==typeof process&&!1,Ad="undefined"===typeof BroadcastChannel||Md?null:new BroadcastChannel("tldraw-user-sync");null===Ad||void 0===Ad||Ad.addEventListener("message",(e=>{const t=e.data;(null===t||void 0===t?void 0:t.type)===Rd&&(null===t||void 0===t?void 0:t.origin)!==Dd()&&jd.set(Ed(t.data))}));let Od=null;function Dd(){return null===Od&&(Od=$()),Od}const Rd="tldraw-user-preferences-change";function Ld(){let e=jd.get();return e||(e=function(){var e;return Ed(null!==(e=JSON.parse(tt(wd)||"null"))&&void 0!==e?e:null)}(),Td(e)),e}const zd=cn("defaultLocalStorageUserPrefs",(()=>Ld()));function Nd(){var e,t;let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{userPreferences:null!==(e=n.userPreferences)&&void 0!==e?e:zd,setUserPreferences:null!==(t=n.setUserPreferences)&&void 0!==t?t:Td}}var Fd,Bd,Ud=n(7283);const Hd="TLDRAW_TAB_ID_v2",Kd=globalThis.window;const Vd=Kd?null!==(Fd=null!==(Bd=Kd[Hd])&&void 0!==Bd?Bd:ot(Hd))&&void 0!==Fd?Fd:"TLDRAW_INSTANCE_STATE_V1_"+$():"<error>";Kd&&(Kd[Hd]=Vd,Kd&&(["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(Kd.navigator.platform)||ka.isDarwin&&"ontouchend"in document)?rt(Hd,Vd):it(Hd)),null===Kd||void 0===Kd||Kd.addEventListener("beforeunload",(()=>{rt(Hd,Vd)}));const Wd={Initial:0},qd=Math.max(...Object.values(Wd));const Yd=co({version:Jn,currentPageId:kr.optional(),isFocusMode:io.optional(),exportBackground:io.optional(),isDebugMode:io.optional(),isToolLocked:io.optional(),isGridMode:io.optional(),pageStates:lo(co({pageId:kr,camera:co({x:Jn,y:Jn,z:Jn}).optional(),selectedShapeIds:lo(Oo).optional(),focusedGroupId:Oo.nullable().optional()})).optional()});function Gd(e){if(!e||"object"!==typeof e)return console.warn("Invalid instance state"),null;if(!("version"in e)||"number"!==typeof e.version)return console.warn("No version in instance state"),null;var t;e.version!==qd&&(e=bt(e),(t=e).version,t.version=qd);try{return Yd.validate(e)}catch(n){return console.warn(n),null}}function Xd(e){const t=e.query.ids("page");return cn("sessionStateSnapshot",(()=>{const n=e.get(Wr);if(!n)return null;const o=[...t.get()];return{version:qd,currentPageId:n.currentPageId,exportBackground:n.exportBackground,isFocusMode:n.isFocusMode,isDebugMode:n.isDebugMode,isToolLocked:n.isToolLocked,isGridMode:n.isGridMode,pageStates:o.map((t=>{var n,o,r,i,s;const a=e.get(Xr.createId(t)),l=e.get(mr.createId(t));return{pageId:t,camera:{x:null!==(n=null===l||void 0===l?void 0:l.x)&&void 0!==n?n:0,y:null!==(o=null===l||void 0===l?void 0:l.y)&&void 0!==o?o:0,z:null!==(r=null===l||void 0===l?void 0:l.z)&&void 0!==r?r:1},selectedShapeIds:null!==(i=null===a||void 0===a?void 0:a.selectedShapeIds)&&void 0!==i?i:[],focusedGroupId:null!==(s=null===a||void 0===a?void 0:a.focusedGroupId)&&void 0!==s?s:null}}))}}),{isEqual:Cn})}function $d(e,t,n){var o,r,i,s,a;const c=Gd(t);if(!c)return;const d=Hr(e.get(Wr)),u=null!==n&&void 0!==n&&n.forceOverwrite?c:d,h=null!==n&&void 0!==n&&n.forceOverwrite?d:c,p=e.schema.types.instance.create(l(l({id:Wr},d),{},{currentPageId:c.currentPageId,isDebugMode:null!==(o=null===u||void 0===u?void 0:u.isDebugMode)&&void 0!==o?o:null===h||void 0===h?void 0:h.isDebugMode,isFocusMode:null!==(r=null===u||void 0===u?void 0:u.isFocusMode)&&void 0!==r?r:null===h||void 0===h?void 0:h.isFocusMode,isToolLocked:null!==(i=null===u||void 0===u?void 0:u.isToolLocked)&&void 0!==i?i:null===h||void 0===h?void 0:h.isToolLocked,isGridMode:null!==(s=null===u||void 0===u?void 0:u.isGridMode)&&void 0!==s?s:null===h||void 0===h?void 0:h.isGridMode,exportBackground:null!==(a=null===u||void 0===u?void 0:u.exportBackground)&&void 0!==a?a:null===h||void 0===h?void 0:h.exportBackground}));e.atomic((()=>{for(const u of null!==(t=c.pageStates)&&void 0!==t?t:[]){var t,n,o,r,i,s,a,l,d;if(!e.has(u.pageId))continue;const c=mr.createId(u.pageId),h=Xr.createId(u.pageId),p=e.get(c),f=e.get(h);e.put([mr.create({id:c,x:null!==(n=null===(o=u.camera)||void 0===o?void 0:o.x)&&void 0!==n?n:null===p||void 0===p?void 0:p.x,y:null!==(r=null===(i=u.camera)||void 0===i?void 0:i.y)&&void 0!==r?r:null===p||void 0===p?void 0:p.y,z:null!==(s=null===(a=u.camera)||void 0===a?void 0:a.z)&&void 0!==s?s:null===p||void 0===p?void 0:p.z}),Xr.create({id:h,pageId:u.pageId,selectedShapeIds:null!==(l=u.selectedShapeIds)&&void 0!==l?l:null===f||void 0===f?void 0:f.selectedShapeIds,focusedGroupId:null!==(d=u.focusedGroupId)&&void 0!==d?d:null===f||void 0===f?void 0:f.focusedGroupId})])}e.put([p]),e.ensureStoreIsUsable()}))}function Zd(e,t,n){let o={};if("store"in t){const n=e.schema.migrateStoreSnapshot(t);if("success"!==n.type)throw new Error("Failed to migrate store snapshot: "+n.reason);o.document={schema:e.schema.serialize(),store:ye(n.value,((t,n)=>{let{typeName:o}=n;return e.scopedTypes.document.has(o)}))}}else o=t;const r=Hr(e.get(Wr)),i=Qd.get(e,Xd).get();e.atomic((()=>{o.document&&e.loadStoreSnapshot(o.document),r&&e.update(Wr,(e=>l(l({},e),r))),i&&$d(e,i),o.session&&$d(e,o.session,{forceOverwrite:null===n||void 0===n?void 0:n.forceOverwriteSessionState})}))}const Qd=new L;function Jd(e){const t=[],n=new Set;for(const o of e){if(n.has(o.type))throw new Error('Binding type "'.concat(o.type,'" is defined more than once'));t.push(o),n.add(o.type)}return t}const eu=["children","className"];function tu(e){let{children:t,className:n=""}=e,o=yr(e,eu);return(0,Ss.jsx)("svg",l(l({},o),{},{className:ks("tl-svg-container",n),children:t}))}function nu(e,t,n,o){const r=e.x-n.x,i=e.y-n.y,s=o.x-n.x,a=o.y-n.y,l=t.x-e.x,c=t.y-e.y,d=s*i-a*r,u=l*i-c*r,h=a*l-s*c;if(0===d||0===u)return null;if(0===h)return null;if(0!==h){const t=d/h,n=u/h;if(0<=t&&t<=1&&0<=n&&n<=1)return Vs.AddXY(e,t*l,t*c)}return null}function ou(e,t,n,o){const r=(t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y),i=2*((t.x-e.x)*(e.x-n.x)+(t.y-e.y)*(e.y-n.y)),s=i*i-4*r*(n.x*n.x+n.y*n.y+e.x*e.x+e.y*e.y-2*(n.x*e.x+n.y*e.y)-o*o);if(s<0)return null;if(0===s)return null;const a=Math.sqrt(s),l=(-i+a)/(2*r),c=(-i-a)/(2*r);if((l<0||l>1)&&(c<0||c>1))return null;const d=[];return 0<=l&&l<=1&&d.push(Vs.Lrp(e,t,l)),0<=c&&c<=1&&d.push(Vs.Lrp(e,t,c)),0===d.length?null:d}function ru(e,t,n){const o=[];let r;for(let i=0,s=n.length-1;i<s;i++)r=nu(e,t,n[i],n[i+1]),r&&o.push(r);return 0===o.length?null:o}function iu(e,t,n){const o=[];let r;for(let i=1,s=n.length;i<s+1;i++)r=nu(e,t,n[i-1],n[i%n.length]),r&&o.push(r);return 0===o.length?null:o}function su(e,t,n){const o=[];let r,i,s;for(let a=0,l=n.length;a<l;a++)r=n[a],i=n[(a+1)%n.length],s=ou(r,i,e,t),s&&o.push(...s);return 0===o.length?null:o}function au(e,t,n){const o=[];let r,i,s;for(let a=1,l=n.length;a<l;a++)r=n[a-1],i=n[a],s=ou(r,i,e,t),s&&o.push(...s);return 0===o.length?null:o}function lu(e,t,n){return(n.y-e.y)*(t.x-e.x)>(t.y-e.y)*(n.x-e.x)}function cu(e,t,n,o){return lu(e,n,o)!==lu(t,n,o)&&lu(e,t,n)!==lu(e,t,o)}function du(e,t){const n=new Map;let o,r,i,s;for(let a=0,l=e.length;a<l;a++)if(o=e[a],fa(o,t)){const e=uu(o);n.has(e)||n.set(e,o)}for(let a=0,l=t.length;a<l;a++)if(o=t[a],fa(o,e)){const e=uu(o);n.has(e)||n.set(e,o)}for(let a=0,l=e.length;a<l;a++){o=e[a],r=e[(a+1)%e.length];for(let e=0,a=t.length;e<a;e++){i=t[e],s=t[(e+1)%t.length];const a=nu(o,r,i,s);if(null!==a){const e=uu(a);n.has(e)||n.set(e,a)}}}return 0===n.size?null:function(e){const t=Vs.Average(e);return e.sort(((e,n)=>Vs.Angle(t,e)-Vs.Angle(t,n)))}([...n.values()])}function uu(e){return"".concat(e.x,",").concat(e.y)}function hu(e,t){let n,o,r,i;for(let s=0,a=e.length;s<a;s++){n=e[s],o=e[(s+1)%a];for(let e=0,s=t.length;e<s;e++)if(r=t[e],i=t[(e+1)%s],cu(n,o,r,i))return!0}return!1}function pu(e,t){let n,o,r,i;for(let s=0,a=e.length;s<a;s++){n=e[s],o=e[(s+1)%a];for(let e=1,s=t.length;e<s;e++)if(r=t[e-1],i=t[e],cu(n,o,r,i))return!0}return!1}class fu extends sc{constructor(e){super(l(l({},e),{},{isClosed:!1,isFilled:!1})),s(this,"start",void 0),s(this,"end",void 0),s(this,"d",void 0),s(this,"u",void 0),s(this,"ul",void 0);const{start:t,end:n}=e;this.start=t,this.end=n,this.d=t.clone().sub(n),this.u=this.d.clone().uni(),this.ul=this.u.len()}getLength(){return this.d.len()}midPoint(){return this.start.lrp(this.end,.5)}getVertices(){return[this.start,this.end]}nearestPoint(e){const{start:t,end:n,d:o,u:r,ul:i}=this;if(0===o.len())return t;if(0===i)return t;const s=Vs.Sub(e,t).dpr(r)/i,a=t.x+r.x*s;if(a<Math.min(t.x,n.x))return t.x<n.x?t:n;if(a>Math.max(t.x,n.x))return t.x>n.x?t:n;const l=t.y+r.y*s;return l<Math.min(t.y,n.y)?t.y<n.y?t:n:l>Math.max(t.y,n.y)?t.y>n.y?t:n:new Vs(a,l)}hitTestLineSegment(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return cu(e,t,this.start,this.end)||this.distanceToLineSegment(e,t)<=n}getSvgPathData(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const{start:t,end:n}=this;return"".concat(e?"M".concat(t.toFixed()):""," L").concat(n.toFixed())}}class gu extends sc{constructor(e){super(l({isClosed:!1,isFilled:!1},e)),s(this,"points",void 0),s(this,"_segments",void 0);const{points:t}=e;this.points=t}get segments(){if(!this._segments){this._segments=[];const{vertices:e}=this;for(let t=0,n=e.length-1;t<n;t++){const n=e[t],o=e[t+1];this._segments.push(new fu({start:n,end:o}))}this.isClosed&&this._segments.push(new fu({start:e[e.length-1],end:e[0]}))}return this._segments}getLength(){return this.segments.reduce(((e,t)=>e+t.length),0)}getVertices(){return this.points}nearestPoint(e){const{segments:t}=this;let n,o,r=this.points[0],i=1/0;for(let s=0;s<t.length;s++)n=t[s].nearestPoint(e),o=Vs.Dist2(n,e),o<i&&(r=n,i=o);if(!r)throw Error("nearest point not found");return r}hitTestLineSegment(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const{segments:o}=this;for(let r=0,i=o.length;r<i;r++)if(o[r].hitTestLineSegment(e,t,n))return!0;return!1}getSvgPathData(){const{vertices:e}=this;return e.length<2?"":e.reduce(((e,t,n)=>0===n?"M ".concat(t.x," ").concat(t.y):"".concat(e," L ").concat(t.x," ").concat(t.y)),"")}}class mu extends gu{constructor(e){super(l({},e)),this.isClosed=!0}}class yu extends mu{constructor(e){const{x:t=0,y:n=0,width:o,height:r}=e;super(l(l({},e),{},{points:[new Vs(t,n),new Vs(t+o,n),new Vs(t+o,n+r),new Vs(t,n+r)]})),s(this,"x",void 0),s(this,"y",void 0),s(this,"w",void 0),s(this,"h",void 0),this.x=t,this.y=n,this.w=o,this.h=r}getBounds(){return new rc(this.x,this.y,this.w,this.h)}getSvgPathData(){const{x:e,y:t,w:n,h:o}=this;return"M".concat(e,",").concat(t," h").concat(n," v").concat(o," h-").concat(n,"z")}}class vu{constructor(e){this.editor=e}canSnap(e){return!0}canScroll(e){return!1}canBind(e){return!0}canEdit(e){return!1}canResize(e){return!0}canEditInReadOnly(e){return!1}canCrop(e){return!1}canBeLaidOut(e){return!0}providesBackgroundForChildren(e){return!1}hideResizeHandles(e){return!1}hideRotateHandle(e){return!1}hideSelectionBoundsBg(e){return!1}hideSelectionBoundsFg(e){return!1}isAspectRatioLocked(e){return!1}canReceiveNewChildrenOfType(e,t){return!1}canDropShapes(e,t){return!1}expandSelectionOutlinePx(e){return 0}getCanvasSvgDefs(){return[]}getBoundsSnapGeometry(e){return{}}getHandleSnapGeometry(e){return{}}getText(e){}}function bu(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const{closed:o=!1,snap:r=1,start:i="outset",end:s="outset",lengthRatio:a=2,style:l="dashed",forceSolid:c=!1}=n;let d=0,u=0,h=1,p=0,f=0;if(c)return{strokeDasharray:"none",strokeDashoffset:"none"};switch(l){case"dashed":h=1,d=Math.min(t*a,e/4);break;case"dotted":h=100,d=t/h;break;default:return{strokeDasharray:"none",strokeDashoffset:"none"}}return o||("outset"===i?(e+=d/2,f+=d/2):"skip"===i&&(e-=d,f-=d),"outset"===s?e+=d/2:"skip"===s&&(e-=d)),u=Math.floor(e/d/(2*h)),u-=u%r,u<3&&"dashed"===l?e/t<4?(d=e,u=1,p=0):(d=e*(1/3),p=e*(1/3)):(d=e/u/(2*h),o?(f=d/2,p=(e-u*d)/u):p=(e-u*d)/Math.max(1,u-1)),{strokeDasharray:[d,p].join(" "),strokeDashoffset:f.toString()}}function wu(e){let{bounds:t,className:n}=e;const o=Ns(),r=yn("zoom level",(()=>o.getZoomLevel()),[o]);return(0,Ss.jsx)("g",{className:n,pointerEvents:"none",strokeLinecap:"round",strokeLinejoin:"round",children:t.sides.map(((e,t)=>{const{strokeDasharray:n,strokeDashoffset:o}=bu(e[0].dist(e[1]),1/r,{style:"dashed",lengthRatio:4});return(0,Ss.jsx)("line",{x1:e[0].x,y1:e[0].y,x2:e[1].x,y2:e[1].y,strokeDasharray:n,strokeDashoffset:o},t)}))})}s(vu,"props",void 0),s(vu,"migrations",void 0),s(vu,"type",void 0);class xu extends vu{hideSelectionBoundsFg(){return!0}canBind(){return!1}getDefaultProps(){return{}}getGeometry(e){const t=this.editor.getSortedChildIdsForParent(e.id);return 0===t.length?new yu({width:1,height:1,isFilled:!1}):new ac({children:t.map((e=>{const t=this.editor.getShape(e),n=this.editor.getShapeGeometry(e),o=this.editor.getShapeLocalTransform(t).applyToPoints(n.vertices);return n.isClosed?new mu({points:o,isFilled:!0}):new gu({points:o})}))})}component(e){const t=this.editor.getErasingShapeIds().includes(e.id),{hintingShapeIds:n}=this.editor.getCurrentPageState(),o=n.length>0&&n.some((t=>t!==e.id&&this.editor.isShapeOfType(this.editor.getShape(t),"group"))),r=this.editor.getCurrentPageState().focusedGroupId!==e.id;if(!t&&(r||o))return null;const i=this.editor.getShapeGeometry(e).bounds;return(0,Ss.jsx)(tu,{children:(0,Ss.jsx)(wu,{className:"tl-group",bounds:i})})}indicator(e){const t=this.editor.getShapeGeometry(e).bounds;return(0,Ss.jsx)(wu,{className:"",bounds:t})}onChildrenChange(e){const t=this.editor.getSortedChildIdsForParent(e.id);return 0===t.length?(this.editor.getCurrentPageState().focusedGroupId===e.id&&this.editor.popFocusedGroupId(),void this.editor.deleteShapes([e.id])):1===t.length?(this.editor.getCurrentPageState().focusedGroupId===e.id&&this.editor.popFocusedGroupId(),this.editor.reparentShapes(t,e.parentId),void this.editor.deleteShapes([e.id])):void 0}}s(xu,"type","group"),s(xu,"props",Wi),s(xu,"migrations",qi);const Su=[xu],ku=new Set(Su.map((e=>e.type)));function Pu(e){const t=[...Su],n=new Set;for(const o of e){if(ku.has(o.type))throw new Error('Shape type "'.concat(o.type,'" is a core shapes type and cannot be overridden'));if(n.has(o.type))throw new Error('Shape type "'.concat(o.type,'" is defined more than once'));t.push(o),n.add(o.type)}return t}var Cu=n(7950);function _u(e,t){const n=new Map;return async function(o){const r=n.get(o);if(r)return r;const i=(async()=>{try{const n=await B(o,t);return M(n.ok),await e(n)}catch(n){return console.error(n),null}})();return n.set(o,i),i}}const Iu=_u((async e=>await H.blobToDataUrl(await e.blob()))),Eu=/@import\s+(?:"([^"]+)"|'([^']+)'|url\s*\(\s*(?:"([^"]+)"|'([^']+)'|([^'")]+))\s*\))([^;]+);/gi,ju=/@font-face\s*{([^}]+)}/gi,Tu=/url\s*\(\s*(?:"([^"]+)"|'([^']+)'|([^'")]+))\s*\)/gi,Mu=/(?:^|;)\s*font-family\s*:\s*(?:([^'"][^;\n]+)|"([^"]+)"|'([^']+)')\s*(?:;|$)/gi;function Au(e){return Array.from(e.matchAll(Eu),(e=>({url:e[1]||e[2]||e[3]||e[4]||e[5],extras:e[6]})))}function Ou(e,t){return Array.from(e.matchAll(ju),(e=>{const n=e[1],o=Array.from(n.matchAll(Tu),(e=>{var n,o;const r=e[1]||e[2]||e[3];return{original:r,resolved:null!==(n=null===(o=mt(r,t))||void 0===o?void 0:o.href)&&void 0!==n?n:null}})),r=new Set(Array.from(n.matchAll(Mu),(e=>(e[1]||e[2]||e[3]).toLowerCase())));return{fontFace:n,urls:o,fontFamilies:r}}))}function Du(e){return!e.startsWith("-")&&(!e.startsWith("animation")&&(!e.startsWith("transition")&&("cursor"!==e&&("pointer-events"!==e&&("user-select"!==e&&"touch-action"!==e)))))}function Ru(e){return Array.from(e.matchAll(Tu),(e=>({original:e[0],url:e[1]||e[2]||e[3]})))}const Lu=new Set(["border-collapse","border-spacing","caption-side","color","cursor","direction","empty-cells","font-family","font-size","font-style","font-variant","font-weight","font-size-adjust","font-stretch","font","letter-spacing","line-height","list-style-image","list-style-position","list-style-type","list-style","orphans","quotes","tab-size","text-align","text-align-last","text-decoration-color","text-indent","text-justify","text-shadow","text-transform","visibility","white-space","widows","word-break","word-spacing","word-wrap"]);function zu(e){return Lu.has(e)}var Nu,Fu,Bu=Object.create,Uu=Object.defineProperty,Hu=Object.getOwnPropertyDescriptor,Ku=(e,t)=>(t=Symbol[e])?t:Symbol.for("Symbol."+e),Vu=e=>{throw TypeError(e)},Wu=(e,t,n)=>t in e?Uu(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,qu=(e,t)=>Uu(e,"name",{value:t,configurable:!0}),Yu=["class","method","getter","setter","accessor","field","value","get","set"],Gu=e=>void 0!==e&&"function"!==typeof e?Vu("Function expected"):e,Xu=(e,t,n,o,r)=>({kind:Yu[e],name:t,metadata:o,addInitializer:e=>n._?Vu("Already initialized"):r.push(Gu(e||null))}),$u=(e,t)=>Wu(t,Ku("metadata"),e[3]),Zu=(e,t,n)=>Wu(e,"symbol"!==typeof t?t+"":t,n),Qu=(e,t,n)=>t.has(e)||Vu("Cannot "+n),Ju=(e,t)=>Object(t)!==t?Vu('Cannot use the "in" operator on this value'):e.has(t),eh=(e,t,n)=>(Qu(e,t,"read from private field"),n?n.call(e):t.get(e)),th=(e,t,n,o)=>(Qu(e,t,"write to private field"),o?o.call(e,n):t.set(e,n),n),nh=(e,t,n)=>(Qu(e,t,"access private method"),n);Nu=[R];class oh{constructor(){((e,t,n,o)=>{for(var r=0,i=e[t>>1],s=i&&i.length;r<s;r++)1&t?i[r].call(n):o=i[r].call(n,o)})(Fu,5,this),Zu(this,"fontFacesPromise",null),Zu(this,"foundFontNames",new Set),Zu(this,"fontFacesToEmbed",new Set),Zu(this,"pendingPromises",[])}startFindingCurrentDocumentFontFaces(){M(!this.fontFacesPromise,"FontEmbedder already started"),this.fontFacesPromise=async function(){const e=[];for(const o of document.styleSheets){let r;try{r=o.cssRules}catch(n){}if(r)for(const n of o.cssRules){var t;if(n instanceof CSSFontFaceRule)e.push(Ou(n.cssText,null!==(t=o.href)&&void 0!==t?t:document.baseURI));else n instanceof CSSImportRule&&e.push(rh(n.href))}else o.href&&e.push(rh(o.href))}return C(await Promise.all(e)).flat()}()}onFontFamilyValue(e){M(this.fontFacesPromise,"FontEmbedder not started");const t=function(e){const t=/\s*(?:([^'"][^;\n\s,]+)|"([^"]+)"|'([^']+)')\s*/gi,n=/\s*,\s*/gi,o=new Set;for(;;){const r=t.exec(e);if(!r)break;const i=r[1]||r[2]||r[3];if(o.add(i.toLowerCase()),n.lastIndex=t.lastIndex,!n.exec(e))break;t.lastIndex=n.lastIndex}return o}(e);for(const n of t){if(this.foundFontNames.has(n))return;this.foundFontNames.add(n),this.pendingPromises.push(this.fontFacesPromise.then((e=>{const t=e.filter((e=>e.fontFamilies.has(n)));for(const n of t)if(!this.fontFacesToEmbed.has(n)){this.fontFacesToEmbed.add(n);for(const e of n.urls)e.resolved&&!e.embedded&&(e.embedded=Iu(e.resolved))}})))}}async createCss(){await Promise.all(this.pendingPromises);let e="";for(const t of this.fontFacesToEmbed){let n="@font-face {".concat(t.fontFace,"}");for(const e of t.urls){if(!e.embedded)continue;const t=await e.embedded;t&&(n=n.replace(e.original,t))}e+=n}return e}}((e,t,n,o,r,i)=>{var s,a,l,c,d,u=7&t,h=!!(8&t),p=!!(16&t),f=u>3?e.length+1:u?h?1:2:0,g=Yu[u+5],m=u>3&&(e[f-1]=[]),y=e[f]||(e[f]=[]),v=u&&(!p&&!h&&(r=r.prototype),u<5&&(u>3||!p)&&Hu(u<4?r:{get[n](){return eh(this,i)},set[n](e){return th(this,i,e)}},n));u?p&&u<4&&qu(i,(u>2?"set ":u>1?"get ":"")+n):qu(r,n);for(var b=o.length-1;b>=0;b--)c=Xu(u,n,l={},e[3],y),u&&(c.static=h,c.private=p,d=c.access={has:p?e=>Ju(r,e):e=>n in e},3^u&&(d.get=p?e=>(1^u?eh:nh)(e,r,4^u?i:v.get):e=>e[n]),u>2&&(d.set=p?(e,t)=>th(e,r,t,4^u?i:v.set):(e,t)=>e[n]=t)),a=(0,o[b])(u?u<4?p?i:v[g]:u>4?void 0:{get:v.get,set:v.set}:r,c),l._=1,4^u||void 0===a?Gu(a)&&(u>4?m.unshift(a):u?p?i=a:v[g]=a:r=a):"object"!==typeof a||null===a?Vu("Object expected"):(Gu(s=a.get)&&(v.get=s),Gu(s=a.set)&&(v.set=s),Gu(s=a.init)&&m.unshift(s));u||$u(e,r),v&&Uu(r,n,v)})(Fu=(e=>{var t;return[,,,Bu(null!==(t=null===e||void 0===e?void 0:e[Ku("metadata")])&&void 0!==t?t:null)]})(null),1,"onFontFamilyValue",Nu,oh),$u(Fu,oh);const rh=_u((async e=>{const t=(n=await e.text(),o=e.url,{imports:Au(n),fontFaces:Ou(n,o)});var n,o;const r=await Promise.all(t.imports.map((t=>{let{url:n}=t;return rh(new URL(n,e.url).href)})));return[...t.fontFaces,...C(r).flat()]}));function ih(e){if(e.shadowRoot)return e.shadowRoot.childNodes;if(function(e){return function(e){return"getRootNode"in e&&function(e){return e instanceof ah(e).ShadowRoot}(e.getRootNode())}(e)&&e instanceof ah(e).HTMLSlotElement}(e)){const t=e.assignedNodes();if(null!==t&&void 0!==t&&t.length)return t}return e.childNodes}function*sh(e){for(const t of ih(e))lh(t)&&(yield t)}function ah(e){var t,n;return null!==(t=null===(n=e.ownerDocument)||void 0===n?void 0:n.defaultView)&&void 0!==t?t:globalThis}function lh(e){return e instanceof ah(e).Element}function ch(e){return e.style}function dh(e,t){return ah(e).getComputedStyle(e,t)}const uh={};class hh{constructor(e){s(this,"styles",new Map),s(this,"fonts",new oh),this.root=e}readRootElementStyles(e){this.readElementStyles(e,{shouldRespectDefaults:!1,shouldSkipInheritedParentStyles:!1});const t=Array.from(sh(e));for(;t.length;){const e=t.pop();t.push(...sh(e)),this.readElementStyles(e,{shouldRespectDefaults:!0,shouldSkipInheritedParentStyles:!0})}}readElementStyles(e,t){var n,o;let{shouldRespectDefaults:r=!0,shouldSkipInheritedParentStyles:i=!0}=t;const s=r?function(e){let t=bh[e];if(!t){const{foreignObject:n,document:o}=function(){if(!vh){const e=document.createElement("iframe");e.style.display="none",document.body.appendChild(e);const t=A(e.contentDocument,"frame must have a document"),n=document.createElementNS("http://www.w3.org/2000/svg","svg"),o=document.createElementNS("http://www.w3.org/2000/svg","foreignObject");n.appendChild(o),t.body.appendChild(n),vh={iframe:e,foreignObject:o,document:t}}return vh}(),r=o.createElement(e);n.appendChild(r),t=r.computedStyleMap?gh(r.computedStyleMap(),wh):mh(dh(r),wh),n.removeChild(r),bh[e]=t}return t}(e.tagName.toLowerCase()):uh,a={self:ph(e,{defaultStyles:s,parentStyles:i&&null!==(n=null===(o=this.styles.get(e.parentElement))||void 0===o?void 0:o.self)&&void 0!==n?n:uh}),before:fh(e,"::before"),after:fh(e,"::after")};this.styles.set(e,a)}fetchResources(){const e=[];for(const t of this.styles.values())for(const n of fe(t))if(n)for(const[t,o]of Object.entries(n)){if(!o)continue;"font-family"===t&&this.fonts.onFontFamilyValue(o);const r=Ru(o);0!==r.length&&e.push(...r.map((async e=>{var r;let{url:i,original:s}=e;const a=null!==(r=await Iu(i))&&void 0!==r?r:"data:";n[t]=o.replace(s,'url("'.concat(a,'")'))})))}return Promise.all(e)}unwrapCustomElements(){const e=new Set,t=(n,o)=>{if(e.has(n))return;e.add(n);const r=n.shadowRoot;if(r){const e=document.createElement("div");this.styles.set(e,this.styles.get(n)),e.setAttribute("data-tl-custom-element",n.tagName),(null!==o&&void 0!==o?o:n.parentElement).appendChild(e);for(const n of r.childNodes)n instanceof Element?t(n,e):e.appendChild(n.cloneNode(!0));n.remove()}else if(o){if("style"===n.tagName.toLowerCase())return;const e=n.cloneNode(!1);this.styles.set(e,this.styles.get(n)),o.appendChild(e);for(const o of ih(n))o instanceof Element?t(o,e):e.appendChild(o.cloneNode(!0))}};for(const n of this.styles.keys())t(n,null)}embedStyles(){let e="";for(const[t,n]of this.styles){if(n.after||n.before){const o="pseudo-".concat($());t.classList.add(o),n.before&&(e+=".".concat(o,"::before {").concat(yh(n.before),"}\n")),n.after&&(e+=".".concat(o,"::after {").concat(yh(n.after),"}\n"))}const o=ch(t);for(const[e,t]of Object.entries(n.self))t&&o.setProperty(e,t);"auto"===o.fontKerning&&(o.fontKerning="normal")}return e}async getFontFaceCss(){return await this.fonts.createCss()}dispose(){vh&&(document.body.removeChild(vh.iframe),vh=void 0)}}function ph(e,t){let{defaultStyles:n,parentStyles:o}=t;return e.computedStyleMap?gh(e.computedStyleMap(),{defaultStyles:n,parentStyles:o}):mh(dh(e),{defaultStyles:n,parentStyles:o})}function fh(e,t){const n=dh(e,t),o=n.getPropertyValue("content");if(""!==o&&"none"!==o)return mh(n,{defaultStyles:uh,parentStyles:uh})}function gh(e,t){let{defaultStyles:n,parentStyles:o}=t;const r={};for(const i of e.keys()){if(!Du(i))continue;const t=e.get(i).toString();n[i]!==t&&(o[i]===t&&zu(i)||(r[i]=t))}return r}function mh(e,t){let{defaultStyles:n,parentStyles:o}=t;const r={};for(const i of e){if(!Du(i))continue;const t=e.getPropertyValue(i);n[i]!==t&&(o[i]===t&&zu(i)||(r[i]=t))}return r}function yh(e){let t="";for(const[n,o]of Object.entries(e))t+="".concat(n,": ").concat(o,";");return t}let vh;const bh={};const wh={defaultStyles:uh,parentStyles:uh};function xh(e,t){return e.replaceWith(t),t}async function Sh(e,t){const n=document.createElement("img");var o,r;t&&(o=t,r=n,Array.from(o.attributes).forEach((e=>{r.setAttribute(e.name,e.value)}))),n.setAttribute("src",null!==e&&void 0!==e?e:"data:"),n.setAttribute("decoding","sync"),n.setAttribute("loading","eager");try{await n.decode()}catch(i){}return n}async function kh(e){if(e instanceof HTMLCanvasElement)return xh(e,await async function(e){try{const t=e.toDataURL();return await Sh(t,e)}catch(t){return await Sh(null,e)}}(e));if(e instanceof HTMLVideoElement)return xh(e,await async function(e){try{return Sh(await ae.getVideoFrameAsDataUrl(e),e)}catch(t){console.error("Could not get video frame",t)}if(e.poster)return Sh(await Iu(e.poster),e);return Sh(null,e)}(e));if(e instanceof HTMLImageElement){const n=e.currentSrc||e.src,o=await Iu(n);e.setAttribute("src",null!==o&&void 0!==o?o:"data:"),e.setAttribute("decoding","sync"),e.setAttribute("loading","eager");try{await e.decode()}catch(t){}return e}e instanceof HTMLInputElement?e.setAttribute("value",e.value):e instanceof HTMLTextAreaElement&&(e.textContent=e.value),await Promise.all(Array.from(sh(e),(e=>kh(e))))}function Ph(t){const n=(0,e.useRef)();return(0,e.useLayoutEffect)((()=>{n.current=t})),(0,e.useDebugValue)(t),(0,e.useCallback)((function(){const e=n.current;return M(e,"fn does not exist"),e(...arguments)}),[])}const Ch=(0,e.createContext)(null);function _h(e){let{context:t,editor:n,children:o}=e;const r=n.options.exportProvider;return(0,Ss.jsx)(Bs,{editor:n,children:(0,Ss.jsx)(Ka,{container:n.getContainer(),children:(0,Ss.jsx)(Ch.Provider,{value:t,children:(0,Ss.jsx)(r,{children:o})})})})}function Ih(){return(0,e.useContext)(Ch)}var Eh,jh,Th=Object.create,Mh=Object.defineProperty,Ah=Object.getOwnPropertyDescriptor,Oh=(e,t)=>(t=Symbol[e])?t:Symbol.for("Symbol."+e),Dh=e=>{throw TypeError(e)},Rh=(e,t,n)=>t in e?Mh(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Lh=(e,t)=>Mh(e,"name",{value:t,configurable:!0}),zh=["class","method","getter","setter","accessor","field","value","get","set"],Nh=e=>void 0!==e&&"function"!==typeof e?Dh("Function expected"):e,Fh=(e,t,n,o,r)=>({kind:zh[e],name:t,metadata:o,addInitializer:e=>n._?Dh("Already initialized"):r.push(Nh(e||null))}),Bh=(e,t)=>Rh(t,Oh("metadata"),e[3]),Uh=(e,t,n)=>Rh(e,"symbol"!==typeof t?t+"":t,n),Hh=(e,t,n)=>t.has(e)||Dh("Cannot "+n),Kh=(e,t)=>Object(t)!==t?Dh('Cannot use the "in" operator on this value'):e.has(t),Vh=(e,t,n)=>(Hh(e,t,"read from private field"),n?n.call(e):t.get(e)),Wh=(e,t,n,o)=>(Hh(e,t,"write to private field"),o?o.call(e,n):t.set(e,n),n),qh=(e,t,n)=>(Hh(e,t,"access private method"),n);Eh=[R];class Yh{constructor(e){this.maxDelayTimeMs=e,((e,t,n,o)=>{for(var r=0,i=e[t>>1],s=i&&i.length;r<s;r++)1&t?i[r].call(n):o=i[r].call(n,o)})(jh,5,this),Uh(this,"isResolved",!1),Uh(this,"promisesToWaitFor",[])}waitUntil(e){if(this.isResolved)throw new Error("Cannot `waitUntil` - the export has already been resolved. Make sure to call `waitUntil` as soon as possible during an export - ie within the first react effect after rendering.");this.promisesToWaitFor.push(e.catch((e=>console.error("Error whilst waiting for export:",e))))}async resolvePromises(){let e=null;for(;this.promisesToWaitFor.length!==e;)e=this.promisesToWaitFor.length,await Promise.allSettled(this.promisesToWaitFor),await D(0)}async resolve(){const e=D(this.maxDelayTimeMs).then((()=>"timeout")),t=this.resolvePromises().then((()=>"resolved"));"timeout"===await Promise.race([e,t])&&console.warn("[tldraw] Export delay timed out after ${this.maxDelayTimeMs}ms"),this.isResolved=!0}}function Gh(t){let{editor:n,preserveAspectRatio:o,scale:r,bbox:i,background:s,singleFrameShapeId:a,isDarkMode:c,renderingShapes:d,onMount:u,waitUntil:h}=t;const p=As(),f=Zo({isDarkMode:c}),g=gn("export state",{defsById:{},shapeElements:null}),{defsById:m,shapeElements:y}=yn(g),v=Ph((e=>{g.update((t=>{if(ue(t.defsById,e.key))return t;const n=Promise.resolve(e.getElement());return h(n.then((t=>{g.update((n=>l(l({},n),{},{defsById:l(l({},n.defsById),{},{[e.key]:{pending:!1,element:t}})})))}))),l(l({},t),{},{defsById:l(l({},t.defsById),{},{[e.key]:{pending:!0,element:n}})})}))})),b=(0,e.useMemo)((()=>({isDarkMode:c,waitUntil:h,addExportDef:v})),[c,h,v]),w=(0,e.useRef)(!1);return(0,e.useLayoutEffect)((()=>{if(w.current)throw new Error("SvgExport should only render once - do not use with react strict mode");w.current=!0,(async()=>{const e={},t=d.map((async t=>{let{id:o,opacity:r,index:s,backgroundIndex:l}=t;if(o===a)return[];const c=n.getShape(o);if(n.isShapeOfType(c,"group"))return[];const d=[],u=n.getShapeUtil(c);if(u.toSvg||u.toBackgroundSvg){var h,f;const[t,o]=await Promise.all([null===(h=u.toSvg)||void 0===h?void 0:h.call(u,c,b),null===(f=u.toBackgroundSvg)||void 0===f?void 0:f.call(u,c,b)]),i=n.getShapePageTransform(c);let a=i.toCssString(),g=1;"scale"in c.props&&1!==c.props.scale&&(g=c.props.scale,a="".concat(a," scale(").concat(c.props.scale,", ").concat(c.props.scale,")"));const m=n.getShapeMask(c.id),y=m?ic.From(ic.Inverse(i)).applyToPoints(m):null,v=Ms(p,c.id);y&&(e[v]={pending:!1,element:(0,Ss.jsx)("clipPath",{id:v,children:(0,Ss.jsx)("path",{d:"M".concat(y.map((e=>{let{x:t,y:n}=e;return"".concat(t/g,",").concat(n/g)})).join("L"),"Z")})})}),t&&d.push({zIndex:s,element:(0,Ss.jsx)("g",{transform:a,opacity:r,clipPath:m?"url(#".concat(v,")"):void 0,children:t},"fg_".concat(c.id))}),o&&d.push({zIndex:l,element:(0,Ss.jsx)("g",{transform:a,opacity:r,clipPath:m?"url(#".concat(v,")"):void 0,children:o},"bg_".concat(c.id))})}else d.push({zIndex:s,element:(0,Ss.jsx)(Xh,{shape:c,util:u,component:bc,className:"tl-shape",bbox:i,opacity:r},"fg_".concat(c.id))}),u.backgroundComponent&&d.push({zIndex:l,element:(0,Ss.jsx)(Xh,{shape:c,util:u,component:wc,className:"tl-shape tl-shape-background",bbox:i,opacity:r},"bg_".concat(c.id))});return d})),o=(await Promise.all(t)).flat();(0,Cu.flushSync)((()=>{g.update((t=>l(l({},t),{},{shapeElements:o.sort(((e,t)=>e.zIndex-t.zIndex)).map((e=>{let{element:t}=e;return t})),defsById:l(l({},t.defsById),e)})))}))})()}),[i,n,b,p,d,a,g]),(0,e.useEffect)((()=>{null!==y&&u()}),[u,y]),(0,Ss.jsx)(_h,{editor:n,context:b,children:(0,Ss.jsxs)("svg",{preserveAspectRatio:o,direction:"ltr",width:i.width*r,height:i.height*r,viewBox:"".concat(i.minX," ").concat(i.minY," ").concat(i.width," ").concat(i.height),strokeLinecap:"round",strokeLinejoin:"round",style:{backgroundColor:s?a?f.solid:f.background:"transparent"},"data-color-mode":c?"dark":"light",className:"tl-container tl-theme__force-sRGB ".concat(c?"tl-theme__dark":"tl-theme__light"),children:[(0,Ss.jsx)("defs",{children:Object.entries(m).map((t=>{let[n,o]=t;return o.pending?null:(0,Ss.jsx)(e.Fragment,{children:o.element},n)}))}),y]})})}function Xh(e){let{shape:t,util:n,className:o,component:r,bbox:i,opacity:s}=e;const a=Ns(),l=ic.Translate(-i.minX,-i.minY).multiply(a.getShapePageTransform(t.id)),c=a.getShapeGeometry(t.id).bounds,d=Math.max(c.width,1),u=Math.max(c.height,1);return(0,Ss.jsx)(js,{fallback:()=>null,children:(0,Ss.jsx)("foreignObject",{x:i.minX,y:i.minY,width:i.w,height:i.h,className:"tl-shape-foreign-object",children:(0,Ss.jsx)("div",{className:o,"data-shape-type":t.type,style:{clipPath:a.getShapeClipPath(t.id),transform:l.toCssString(),width:d,height:u,opacity:s},children:(0,Ss.jsx)(r,{shape:t,util:n})})})})}((e,t,n,o,r,i)=>{var s,a,l,c,d,u=7&t,h=!!(8&t),p=!!(16&t),f=u>3?e.length+1:u?h?1:2:0,g=zh[u+5],m=u>3&&(e[f-1]=[]),y=e[f]||(e[f]=[]),v=u&&(!p&&!h&&(r=r.prototype),u<5&&(u>3||!p)&&Ah(u<4?r:{get[n](){return Vh(this,i)},set[n](e){return Wh(this,i,e)}},n));u?p&&u<4&&Lh(i,(u>2?"set ":u>1?"get ":"")+n):Lh(r,n);for(var b=o.length-1;b>=0;b--)c=Fh(u,n,l={},e[3],y),u&&(c.static=h,c.private=p,d=c.access={has:p?e=>Kh(r,e):e=>n in e},3^u&&(d.get=p?e=>(1^u?Vh:qh)(e,r,4^u?i:v.get):e=>e[n]),u>2&&(d.set=p?(e,t)=>Wh(e,r,t,4^u?i:v.set):(e,t)=>e[n]=t)),a=(0,o[b])(u?u<4?p?i:v[g]:u>4?void 0:{get:v.get,set:v.set}:r,c),l._=1,4^u||void 0===a?Nh(a)&&(u>4?m.unshift(a):u?p?i=a:v[g]=a:r=a):"object"!==typeof a||null===a?Dh("Object expected"):(Nh(s=a.get)&&(v.get=s),Nh(s=a.set)&&(v.set=s),Nh(s=a.init)&&m.unshift(s));u||Bh(e,r),v&&Mh(r,n,v)})(jh=(e=>{var t;return[,,,Th(null!==(t=null===e||void 0===e?void 0:e[Oh("metadata")])&&void 0!==t?t:null)]})(null),1,"waitUntil",Eh,Yh),Bh(jh,Yh);let $h=1;async function Zh(e,t){const n=function(e,t){var n;let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!window.document)throw Error("No document");const{scale:r=1,background:i=!1,padding:s=e.options.defaultSvgPadding,preserveAspectRatio:a}=o,l=null!==(n=o.darkMode)&&void 0!==n?n:e.user.getIsDarkMode(),c=e.getShapeAndDescendantIds(t),d=e.getUnorderedRenderingShapes(!1).filter((e=>{let{id:t}=e;return c.has(t)}));let u=null;if(o.bounds)u=o.bounds;else for(const{id:w}of d){const t=e.getShapeMaskedPageBounds(w);t&&(u?u.union(t):u=t.clone())}if(!u)return;const h=1===t.length&&e.isShapeOfType(e.getShape(t[0]),"frame")?t[0]:null;h||u.expandBy(s);const p=u.width*r,f=u.height*r;try{var g,m;null===(g=(m=document.body).focus)||void 0===g||g.call(m)}catch(b){}const y=new Yh(e.options.maxExportDelayMs),v=O();return y.waitUntil(v),{jsx:(0,Ss.jsx)(Gh,{editor:e,preserveAspectRatio:a,scale:r,bbox:u,background:i,singleFrameShapeId:h,isDarkMode:l,renderingShapes:d,onMount:v.resolve,waitUntil:y.waitUntil}),width:p,height:f,exportDelay:y}}(e,t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:{});if(!n)return;const r=e.getContainer(),i=document.createElement("div");i.className="tldraw-svg-export",i.inert=!0,i.tabIndex=-1,Object.assign(i.style,{position:"absolute",top:"0px",left:"0px",width:n.width+"px",height:n.height+"px",pointerEvents:"none",opacity:0}),r.appendChild(i);const s=(0,o.createRoot)(i,{identifierPrefix:"export_".concat($h++,"_")});try{await Promise.resolve(),(0,Cu.flushSync)((()=>{s.render(n.jsx)})),await n.exportDelay.resolve();const e=i.firstElementChild;return M(e instanceof SVGSVGElement,"Expected an SVG element"),await async function(e){const t=[...e.querySelectorAll("foreignObject.tl-shape-foreign-object > *")];if(!t.length)return;const n=new hh(e);try{n.fonts.startFindingCurrentDocumentFontFaces(),await Promise.all(t.map((e=>kh(e))));for(const e of t)n.readRootElementStyles(e);await n.fetchResources();const o=await n.getFontFaceCss();n.unwrapCustomElements();const r=n.embedStyles();if(o||r){const t=document.createElementNS("http://www.w3.org/2000/svg","style");t.textContent="".concat(o,"\n").concat(r),e.prepend(t)}}finally{n.dispose()}}(e),{svg:e,width:n.width,height:n.height}}finally{setTimeout((()=>{s.unmount(),r.removeChild(i)}),0)}}const Qh={menus:Qt("open menus",[]),getOpenMenus(e){return e?this.menus.get().filter((t=>t.endsWith("-"+e))):this.menus.get()},addOpenMenu(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";const n=t?"".concat(e,"-").concat(t):e,o=new Set(this.menus.get());o.has(n)||(o.add(n),this.menus.set([...o]))},deleteOpenMenu(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";const n=t?"".concat(e,"-").concat(t):e,o=new Set(this.menus.get());o.has(n)&&(o.delete(n),this.menus.set([...o]))},clearOpenMenus(e){this.menus.set(e?this.menus.get().filter((t=>!t.endsWith("-"+e))):[])},_hiddenMenus:[],hideOpenMenus(e){if(this._hiddenMenus=[...this.getOpenMenus(e)],0!==this._hiddenMenus.length)for(const t of this._hiddenMenus)this.deleteOpenMenu(t,e)},showOpenMenus(e){if(0!==this._hiddenMenus.length){for(const t of this._hiddenMenus)this.addOpenMenu(t,e);this._hiddenMenus=[]}},isMenuOpen(e,t){return this.getOpenMenus(t).includes(e)},hasOpenMenus(e){return this.getOpenMenus(e).length>0},hasAnyOpenMenus(){return this.getOpenMenus().length>0},forContext(e){return{getOpenMenus:()=>this.getOpenMenus(e),addOpenMenu:t=>this.addOpenMenu(t,e),deleteOpenMenu:t=>this.deleteOpenMenu(t,e),clearOpenMenus:()=>this.clearOpenMenus(e),isMenuOpen:t=>this.isMenuOpen(t,e),hasOpenMenus:()=>this.hasOpenMenus(e),hasAnyOpenMenus:()=>this.hasAnyOpenMenus()}}},Jh=new class{constructor(){s(this,"timeouts",new Map),s(this,"intervals",new Map),s(this,"rafs",new Map),this.setTimeout=this.setTimeout.bind(this),this.setInterval=this.setInterval.bind(this),this.requestAnimationFrame=this.requestAnimationFrame.bind(this),this.dispose=this.dispose.bind(this)}setTimeout(e,t,n){for(var o,r=arguments.length,i=new Array(r>3?r-3:0),s=3;s<r;s++)i[s-3]=arguments[s];const a=window.setTimeout(t,n,i),l=null!==(o=this.timeouts.get(e))&&void 0!==o?o:[];return this.timeouts.set(e,[...l,a]),a}setInterval(e,t,n){for(var o,r=arguments.length,i=new Array(r>3?r-3:0),s=3;s<r;s++)i[s-3]=arguments[s];const a=window.setInterval(t,n,i),l=null!==(o=this.intervals.get(e))&&void 0!==o?o:[];return this.intervals.set(e,[...l,a]),a}requestAnimationFrame(e,t){var n;const o=window.requestAnimationFrame(t),r=null!==(n=this.rafs.get(e))&&void 0!==n?n:[];return this.rafs.set(e,[...r,o]),o}dispose(e){var t,n,o;null===(t=this.timeouts.get(e))||void 0===t||t.forEach((e=>clearTimeout(e))),null===(n=this.intervals.get(e))||void 0===n||n.forEach((e=>clearInterval(e))),null===(o=this.rafs.get(e))||void 0===o||o.forEach((e=>cancelAnimationFrame(e))),this.timeouts.delete(e),this.intervals.delete(e),this.rafs.delete(e)}disposeAll(){for(const e of this.timeouts.keys())this.dispose(e)}forContext(e){var t=this;return{setTimeout:function(n,o){for(var r=arguments.length,i=new Array(r>2?r-2:0),s=2;s<r;s++)i[s-2]=arguments[s];return t.setTimeout(e,n,o,i)},setInterval:function(n,o){for(var r=arguments.length,i=new Array(r>2?r-2:0),s=2;s<r;s++)i[s-2]=arguments[s];return t.setInterval(e,n,o,i)},requestAnimationFrame:t=>this.requestAnimationFrame(e,t),dispose:()=>this.dispose(e)}}},ep={maxShapesPerPage:4e3,maxFilesAtOnce:100,maxPages:40,animationMediumMs:320,followChaseViewportSnap:2,doubleClickDurationMs:450,multiClickDurationMs:200,coarseDragDistanceSquared:36,dragDistanceSquared:16,defaultSvgPadding:32,cameraSlideFriction:.09,maxPointsPerDrawShape:500,gridSteps:[{min:-1,mid:.15,step:64},{min:.05,mid:.375,step:16},{min:.15,mid:1,step:4},{min:.7,mid:2.5,step:1}],collaboratorInactiveTimeoutMs:6e4,collaboratorIdleTimeoutMs:3e3,collaboratorCheckIntervalMs:1200,cameraMovingTimeoutMs:64,hitTestMargin:8,edgeScrollDelay:200,edgeScrollEaseDuration:200,edgeScrollSpeed:25,edgeScrollDistance:8,coarsePointerWidth:12,coarseHandleRadius:20,handleRadius:12,longPressDurationMs:500,textShadowLod:.35,adjacentShapeMargin:10,flattenImageBoundsExpand:64,flattenImageBoundsPadding:16,laserDelayMs:1200,maxExportDelayMs:5e3,temporaryAssetPreviewLifetimeMs:18e4,actionShortcutsLocation:"swap",createTextOnCanvasDoubleClick:!0,exportProvider:e.Fragment};function tp(e,t){if(!t)return!1;switch(e.type){case"mixed":return"mixed"===t.type;case"shared":return"shared"===t.type&&e.value===t.value;default:throw T(e)}}class np{constructor(e){s(this,"map",void 0),this.map=new Map(e)}get(e){return this.map.get(e)}getAsKnownValue(e){const t=this.get(e);if(t&&"mixed"!==t.type)return t.value}get size(){return this.map.size}equals(e){if(this.size!==e.size)return!1;const t=new Set;for(const[n,o]of this){if(!tp(o,e.get(n)))return!1;t.add(n)}for(const[n,o]of e)if(!t.has(n)&&!tp(o,this.get(n)))return!1;return!0}keys(){return this.map.keys()}values(){return this.map.values()}entries(){return this.map.entries()}[Symbol.iterator](){return this.map[Symbol.iterator]()}}class op extends np{set(e,t){this.map.set(e,t)}applyValue(e,t){const n=this.get(e);if(n)switch(n.type){case"mixed":return;case"shared":return void(n.value!==t&&this.set(e,{type:"mixed"}));default:T(n,"type")}else this.set(e,{type:"shared",value:t})}}function rp(){return"".concat("https://cdn.tldraw.com","/").concat(Ps)}function ip(e){return encodeURIComponent(e).replace(/\./g,"%2E")}function sp(e,t,n,o){if(0===n.length)return[];const r=new Map;for(const s of C(n.map((t=>e.getShape(t))))){const{parentId:t}=s;r.has(t)||r.set(t,{children:C(e.getSortedChildIdsForParent(t).map((t=>e.getShape(t)))),moving:new Set}),r.get(t).moving.add(s)}const i=[];switch(t){case"toBack":r.forEach((e=>{let{moving:t,children:n}=e;return function(e,t,n){const o=t.length;if(e.size===o)return;let r,i;for(let s=0;s<o;s++){const n=t[s];if(!e.has(n)){i=n.index;break}r=n.index,e.delete(n)}if(0===e.size)return;{const t=Ge(r,i,e.size);n.push(...Array.from(e.values()).sort(Je).map(((e,n)=>l(l({},e),{},{index:t[n]}))))}}(t,n,i)}));break;case"toFront":r.forEach((e=>{let{moving:t,children:n}=e;return function(e,t,n){const o=t.length;if(e.size===o)return;let r,i;for(let s=o-1;s>-1;s--){const n=t[s];if(!e.has(n)){r=n.index;break}i=n.index,e.delete(n)}if(0===e.size)return;{const t=Ge(r,i,e.size);n.push(...Array.from(e.values()).sort(Je).map(((e,n)=>l(l({},e),{},{index:t[n]}))))}}(t,n,i)}));break;case"forward":r.forEach((t=>{let{moving:n,children:r}=t;return function(e,t,n,o,r){const i=lp(e,t),s=n.length;if(t.size===s)return;let a={name:"skipping"};for(let d=0;d<s;d++){const e=t.has(n[d]);switch(a.name){case"skipping":if(!e)continue;a={name:"selecting",selectIndex:d};break;case"selecting":{var c;if(e)continue;if((null===r||void 0===r||!r.considerAllShapes)&&!i(n[d]))continue;const{selectIndex:s}=a;Ge(n[d].index,null===(c=n[d+1])||void 0===c?void 0:c.index,d-s).forEach(((e,r)=>{const i=n[s+r];t.has(i)&&o.push(l(l({},i),{},{index:e}))})),a={name:"skipping"};break}}}}(e,n,r,i,o)}));break;case"backward":r.forEach((t=>{let{moving:n,children:r}=t;return function(e,t,n,o,r){const i=lp(e,t),s=n.length;if(t.size===s)return;let a={name:"skipping"};for(let d=s-1;d>-1;d--){const e=t.has(n[d]);switch(a.name){case"skipping":if(!e)continue;a={name:"selecting",selectIndex:d};break;case"selecting":var c;if(e)continue;if((null===r||void 0===r||!r.considerAllShapes)&&!i(n[d]))continue;Ge(null===(c=n[d-1])||void 0===c?void 0:c.index,n[d].index,a.selectIndex-d).forEach(((e,r)=>{const i=n[d+r+1];t.has(i)&&o.push(l(l({},i),{},{index:e}))})),a={name:"skipping"}}}}(e,n,r,i,o)}))}return i}function ap(e,t){const n=e.getShapeGeometry(t),o=e.getShapePageTransform(t);return n&&o?o.applyToPoints(n.vertices):null}function lp(e,t){const n=Array.from(t).map((t=>{const n=ap(e,t);return n?{shape:t,vertices:n}:null})).filter(Boolean);return t=>{const o=ap(e,t);return!!o&&n.some((e=>hu(e.vertices,o)))}}function cp(e){let{editor:t,ids:n}=e;const o=C(n.map((e=>t.getShape(e)))),r=t.getShapesSharedRotation(n),i=t.getShapesRotatedPageBounds(n);if(!i)return null;const s=i.center.clone().rotWith(i.point,r);return{pageCenter:s,initialCursorAngle:s.angle(t.inputs.originPagePoint),initialShapesRotation:r,shapeSnapshots:o.map((e=>({shape:e,initialPagePoint:t.getShapePageTransform(e.id).point()})))}}function dp(e){let{delta:t,editor:n,snapshot:o,stage:r,centerOverride:i}=e;const{pageCenter:s,shapeSnapshots:a}=o;n.updateShapes(a.map((e=>{let{shape:o,initialPagePoint:r}=e;const a=Ho(o.parentId)?n.getShapePageTransform(o.parentId):ic.Identity(),l=Vs.RotWith(r,null!==i&&void 0!==i?i:s,t),c=ic.applyToPoint(ic.Inverse(a),l),d=na(o.rotation+t);return{id:o.id,type:o.type,x:c.x,y:c.y,rotation:d}})));const l=[];a.forEach((e=>{var t;let{shape:o}=e;const i=n.getShape(o.id);if(!i)return;const s=n.getShapeUtil(o);if("start"===r||"one-off"===r){var a;const e=null===(a=s.onRotateStart)||void 0===a?void 0:a.call(s,o);e&&l.push(e)}const c=null===(t=s.onRotate)||void 0===t?void 0:t.call(s,o,i);if(c&&l.push(c),"end"===r||"one-off"===r){var d;const e=null===(d=s.onRotateEnd)||void 0===d?void 0:d.call(s,o,i);e&&l.push(e)}})),l.length>0&&n.updateShapes(l)}const up=(e,t,n)=>{for(;!Ir(n.parentId);){const t=e.get(n.parentId);if(!t)return!1;n=t}return n.parentId===t};var hp,pp,fp,gp=Object.create,mp=Object.defineProperty,yp=Object.getOwnPropertyDescriptor,vp=(e,t)=>(t=Symbol[e])?t:Symbol.for("Symbol."+e),bp=e=>{throw TypeError(e)},wp=(e,t,n)=>t in e?mp(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,xp=(e,t)=>mp(e,"name",{value:t,configurable:!0}),Sp=["class","method","getter","setter","accessor","field","value","get","set"],kp=e=>void 0!==e&&"function"!==typeof e?bp("Function expected"):e,Pp=(e,t,n,o,r)=>({kind:Sp[e],name:t,metadata:o,addInitializer:e=>n._?bp("Already initialized"):r.push(kp(e||null))}),Cp=(e,t)=>wp(t,vp("metadata"),e[3]),_p=(e,t,n,o,r,i)=>{var s,a,l,c,d,u=7&t,h=!!(8&t),p=!!(16&t),f=u>3?e.length+1:u?h?1:2:0,g=Sp[u+5],m=u>3&&(e[f-1]=[]),y=e[f]||(e[f]=[]),v=u&&(!p&&!h&&(r=r.prototype),u<5&&(u>3||!p)&&yp(u<4?r:{get[n](){return Tp(this,i)},set[n](e){return Mp(this,i,e)}},n));u?p&&u<4&&xp(i,(u>2?"set ":u>1?"get ":"")+n):xp(r,n);for(var b=o.length-1;b>=0;b--)c=Pp(u,n,l={},e[3],y),u&&(c.static=h,c.private=p,d=c.access={has:p?e=>jp(r,e):e=>n in e},3^u&&(d.get=p?e=>(1^u?Tp:Ap)(e,r,4^u?i:v.get):e=>e[n]),u>2&&(d.set=p?(e,t)=>Mp(e,r,t,4^u?i:v.set):(e,t)=>e[n]=t)),a=(0,o[b])(u?u<4?p?i:v[g]:u>4?void 0:{get:v.get,set:v.set}:r,c),l._=1,4^u||void 0===a?kp(a)&&(u>4?m.unshift(a):u?p?i=a:v[g]=a:r=a):"object"!==typeof a||null===a?bp("Object expected"):(kp(s=a.get)&&(v.get=s),kp(s=a.set)&&(v.set=s),kp(s=a.init)&&m.unshift(s));return u||Cp(e,r),v&&mp(r,n,v),p?4^u?i:v:r},Ip=(e,t,n)=>wp(e,"symbol"!==typeof t?t+"":t,n),Ep=(e,t,n)=>t.has(e)||bp("Cannot "+n),jp=(e,t)=>Object(t)!==t?bp('Cannot use the "in" operator on this value'):e.has(t),Tp=(e,t,n)=>(Ep(e,t,"read from private field"),n?n.call(e):t.get(e)),Mp=(e,t,n,o)=>(Ep(e,t,"write to private field"),o?o.call(e,n):t.set(e,n),n),Ap=(e,t,n)=>(Ep(e,t,"access private method"),n);pp=[R],hp=[R];class Op{constructor(e){this.editor=e,((e,t,n,o)=>{for(var r=0,i=e[t>>1],s=i&&i.length;r<s;r++)1&t?i[r].call(n):o=i[r].call(n,o)})(fp,5,this),Ip(this,"_clickId",""),Ip(this,"_clickTimeout"),Ip(this,"_clickScreenPoint"),Ip(this,"_previousScreenPoint"),Ip(this,"_clickState","idle"),Ip(this,"lastPointerInfo",{})}_getClickTimeout(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:$();this._clickId=t,clearTimeout(this._clickTimeout),this._clickTimeout=this.editor.timers.setTimeout((()=>{if(this._clickState===e&&this._clickId===t){switch(this._clickState){case"pendingTriple":this.editor.dispatch(l(l({},this.lastPointerInfo),{},{type:"click",name:"double_click",phase:"settle"}));break;case"pendingQuadruple":this.editor.dispatch(l(l({},this.lastPointerInfo),{},{type:"click",name:"triple_click",phase:"settle"}));break;case"pendingOverflow":this.editor.dispatch(l(l({},this.lastPointerInfo),{},{type:"click",name:"quadruple_click",phase:"settle"}))}this._clickState="idle"}}),"idle"===e||"pendingDouble"===e?this.editor.options.doubleClickDurationMs:this.editor.options.multiClickDurationMs)}get clickState(){return this._clickState}handlePointerEvent(e){switch(e.name){case"pointer_down":if(!this._clickState)return e;switch(this._clickScreenPoint=Vs.From(e.point),this._previousScreenPoint&&Vs.Dist2(this._previousScreenPoint,this._clickScreenPoint)>1600&&(this._clickState="idle"),this._previousScreenPoint=this._clickScreenPoint,this.lastPointerInfo=e,this._clickState){case"pendingDouble":return this._clickState="pendingTriple",this._clickTimeout=this._getClickTimeout(this._clickState),l(l({},e),{},{type:"click",name:"double_click",phase:"down"});case"pendingTriple":return this._clickState="pendingQuadruple",this._clickTimeout=this._getClickTimeout(this._clickState),l(l({},e),{},{type:"click",name:"triple_click",phase:"down"});case"pendingQuadruple":return this._clickState="pendingOverflow",this._clickTimeout=this._getClickTimeout(this._clickState),l(l({},e),{},{type:"click",name:"quadruple_click",phase:"down"});case"idle":this._clickState="pendingDouble";break;case"pendingOverflow":this._clickState="overflow"}return this._clickTimeout=this._getClickTimeout(this._clickState),e;case"pointer_up":if(!this._clickState)return e;switch(this._clickScreenPoint=Vs.From(e.point),this._clickState){case"pendingTriple":return l(l({},this.lastPointerInfo),{},{type:"click",name:"double_click",phase:"up"});case"pendingQuadruple":return l(l({},this.lastPointerInfo),{},{type:"click",name:"triple_click",phase:"up"});case"pendingOverflow":return l(l({},this.lastPointerInfo),{},{type:"click",name:"quadruple_click",phase:"up"})}return e;case"pointer_move":return"idle"!==this._clickState&&this._clickScreenPoint&&Vs.Dist2(this._clickScreenPoint,this.editor.inputs.currentScreenPoint)>(this.editor.getInstanceState().isCoarsePointer?this.editor.options.coarseDragDistanceSquared:this.editor.options.dragDistanceSquared)&&this.cancelDoubleClickTimeout(),e}return e}cancelDoubleClickTimeout(){this._clickTimeout=clearTimeout(this._clickTimeout),this._clickState="idle"}}_p(fp=(e=>{var t;return[,,,gp(null!==(t=null===e||void 0===e?void 0:e[vp("metadata")])&&void 0!==t?t:null)]})(null),1,"_getClickTimeout",pp,Op),_p(fp,1,"cancelDoubleClickTimeout",hp,Op),Cp(fp,Op);class Dp{constructor(e){s(this,"_isEdgeScrolling",!1),s(this,"_edgeScrollDuration",-1),this.editor=e}updateEdgeScrolling(e){const{editor:t}=this,n=this.getEdgeScroll();if(0===n.x&&0===n.y)this._isEdgeScrolling&&(this._isEdgeScrolling=!1,this._edgeScrollDuration=0);else if(this._isEdgeScrolling||(this._isEdgeScrolling=!0,this._edgeScrollDuration=0),this._edgeScrollDuration+=e,this._edgeScrollDuration>t.options.edgeScrollDelay){const e=t.options.edgeScrollEaseDuration>0?Ks.easeInCubic(Math.min(1,this._edgeScrollDuration/(t.options.edgeScrollDelay+t.options.edgeScrollEaseDuration))):1;this.moveCameraWhenCloseToEdge({x:n.x*e,y:n.y*e})}}getEdgeProximityFactors(e,t,n,o,r){const{editor:i}=this,s=i.options.edgeScrollDistance,a=n?i.options.coarsePointerWidth:0,l=e-a,c=e+a,d=o?0:s,u=r?t:t-s;return l<d?Math.min(1,(d-l)/s):c>u?-Math.min(1,(c-u)/s):0}getEdgeScroll(){const{editor:e}=this,{inputs:{currentScreenPoint:{x:t,y:n}}}=e,o=e.getViewportScreenBounds(),{isCoarsePointer:r,insets:[i,s,a,l]}=e.getInstanceState();return{x:this.getEdgeProximityFactors(t,o.w,r,l,s),y:this.getEdgeProximityFactors(n,o.h,r,i,a)}}moveCameraWhenCloseToEdge(e){const{editor:t}=this;if(!t.inputs.isDragging||t.inputs.isPanning||t.getCameraOptions().isLocked)return;if(0===e.x&&0===e.y)return;const n=t.getViewportScreenBounds(),o=n.w<1e3?.612:1,r=n.h<1e3?.612:1,i=t.getZoomLevel(),s=t.user.getEdgeScrollSpeed()*t.options.edgeScrollSpeed,a=s*e.x*o/i,l=s*e.y*r/i,{x:c,y:d,z:u}=t.getCamera();t.setCamera(new Vs(c+a,d+l,u))}}class Rp{constructor(e,t){s(this,"disposeSideEffectListener",void 0),this.editor=e,this.disposeSideEffectListener=e.sideEffects.registerAfterChangeHandler("instance",((e,t)=>{e.isFocused!==t.isFocused&&this.updateContainerClass()}));t!==e.getInstanceState().isFocused&&e.updateInstanceState({isFocused:!!t}),this.updateContainerClass()}updateContainerClass(){const e=this.editor.getContainer();this.editor.getInstanceState().isFocused?e.classList.add("tl-container__focused"):e.classList.remove("tl-container__focused")}focus(){this.editor.getContainer().focus()}blur(){this.editor.complete(),this.editor.getContainer().blur()}dispose(){var e;null===(e=this.disposeSideEffectListener)||void 0===e||e.call(this)}}function Lp(e){if(e){let t=Np;for(;e.length;)t=t.push(e.pop());return t}return Np}class zp{constructor(){s(this,"length",0),s(this,"head",null),s(this,"tail",this)}push(e){return new Fp(e,this)}toArray(){return jt}[Symbol.iterator](){return{next:()=>({value:void 0,done:!0})}}}const Np=new zp;class Fp{constructor(e,t){s(this,"length",void 0),this.head=e,this.tail=t,this.length=t.length+1}push(e){return new Fp(e,this)}toArray(){return Array.from(this)}[Symbol.iterator](){let e=this;return{next(){if(e.length){const t=e.head;return e=e.tail,{value:t,done:!1}}return{value:void 0,done:!0}}}}}class Bp{constructor(e){var t;s(this,"store",void 0),s(this,"dispose",void 0),s(this,"state","recording"),s(this,"pendingDiff",new Hp),s(this,"stacks",Qt("HistoryManager.stacks",{undos:Lp(),redos:Lp()},{isEqual:(e,t)=>e.undos===t.undos&&e.redos===t.redos})),s(this,"annotateError",void 0),s(this,"_isInBatch",!1),this.store=e.store,this.annotateError=null!==(t=e.annotateError)&&void 0!==t?t:E,this.dispose=this.store.addHistoryInterceptor(((e,t)=>{if("user"===t)switch(this.state){case"recording":this.pendingDiff.apply(e.changes),this.stacks.update((e=>{let{undos:t}=e;return{undos:t,redos:Lp()}}));break;case"recordingPreserveRedoStack":this.pendingDiff.apply(e.changes);break;case"paused":break;default:T(this.state)}}))}flushPendingDiff(){if(this.pendingDiff.isEmpty())return;const e=this.pendingDiff.clear();this.stacks.update((t=>{let{undos:n,redos:o}=t;return{undos:n.push({type:"diff",diff:e}),redos:o}}))}getNumUndos(){return this.stacks.get().undos.length+(this.pendingDiff.isEmpty()?0:1)}getNumRedos(){return this.stacks.get().redos.length}batch(e,t){const n=this.state;"paused"!==n&&null!==t&&void 0!==t&&t.history&&(this.state=Up[t.history]);try{if(this._isInBatch)return Xt(e),this;this._isInBatch=!0;try{Xt(e)}catch(o){throw this.annotateError(o),o}finally{this._isInBatch=!1}return this}finally{this.state=n}}_undo(e){let{pushToRedoStack:t,toMark:n}=e;const o=this.state;this.state="paused";try{let{undos:e,redos:o}=this.stacks.get();const i=this.pendingDiff.clear(),s=Sn(i),a=xn(i);t&&!s&&(o=o.push({type:"diff",diff:i}));let l=!1;if(s)for(;"stop"===(null===(r=e.head)||void 0===r?void 0:r.type);){var r;const i=e.head;if(e=e.tail,t&&(o=o.push(i)),i.id===n){l=!0;break}}if(!l)e:for(;e.head;){const r=e.head;switch(e=e.tail,t&&(o=o.push(r)),r.type){case"diff":Pn(a,[xn(r.diff)]);break;case"stop":if(!n)break e;if(r.id===n){l=!0;break e}break;default:T(r)}}if(!l&&n)return this;this.store.applyDiff(a,{ignoreEphemeralKeys:!0}),this.store.ensureStoreIsUsable(),this.stacks.set({undos:e,redos:o})}finally{this.state=o}return this}undo(){return this._undo({pushToRedoStack:!0}),this}redo(){const e=this.state;this.state="paused";try{this.flushPendingDiff();let{undos:e,redos:n}=this.stacks.get();if(0===n.length)return this;for(;"stop"===(null===(t=n.head)||void 0===t?void 0:t.type);){var t;e=e.push(n.head),n=n.tail}const o={added:{},updated:{},removed:{}};for(;n.head;){const t=n.head;if(e=e.push(t),n=n.tail,"diff"!==t.type)break;Pn(o,[t.diff])}this.store.applyDiff(o,{ignoreEphemeralKeys:!0}),this.store.ensureStoreIsUsable(),this.stacks.set({undos:e,redos:n})}finally{this.state=e}return this}bail(){return this._undo({pushToRedoStack:!1}),this}bailToMark(e){return this._undo({pushToRedoStack:!1,toMark:e}),this}squashToMark(e){var t;let n=this.stacks.get().undos;const o=[];for(;n.head&&("stop"!==n.head.type||n.head.id!==e);)"diff"===n.head.type&&o.push(n.head.diff),n=n.tail;if(!n.head||(null===(t=n.head)||void 0===t?void 0:t.id)!==e)return console.error("Could not find mark to squash to: ",e),this;if(0===o.length)return this;const r={added:{},updated:{},removed:{}};return Pn(r,o.reverse()),this.stacks.update((e=>{let{redos:t}=e;return{undos:n.push({type:"diff",diff:r}),redos:t}})),this}_mark(e){Xt((()=>{this.flushPendingDiff(),this.stacks.update((t=>{let{undos:n,redos:o}=t;return{undos:n.push({type:"stop",id:e}),redos:o}}))}))}clear(){this.stacks.set({undos:Lp(),redos:Lp()}),this.pendingDiff.clear()}getMarkIdMatching(e){let t=this.stacks.get().undos;for(;t.head;){if("stop"===t.head.type&&t.head.id.includes(e))return t.head.id;t=t.tail}return null}debug(){const{undos:e,redos:t}=this.stacks.get();return{undos:e.toArray(),redos:t.toArray(),pendingDiff:this.pendingDiff.debug(),state:this.state}}}const Up={record:"recording","record-preserveRedoStack":"recordingPreserveRedoStack",ignore:"paused"};class Hp{constructor(){s(this,"diff",{added:{},updated:{},removed:{}}),s(this,"isEmptyAtom",Qt("PendingDiff.isEmpty",!0))}clear(){const e=this.diff;return this.diff={added:{},updated:{},removed:{}},this.isEmptyAtom.set(!0),e}isEmpty(){return this.isEmptyAtom.get()}apply(e){Pn(this.diff,[e]),this.isEmptyAtom.set(Sn(this.diff))}debug(){return{diff:this.diff,isEmpty:this.isEmpty()}}}class Kp{constructor(e){s(this,"scribbleItems",new Map),s(this,"state","paused"),this.editor=e}addScribble(e){var t;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:$();const o={id:n,scribble:l(l({id:n,size:20,color:"accent",opacity:.8,delay:0,points:[],shrink:.1,taper:!0},e),{},{state:"starting"}),timeoutMs:0,delayRemaining:null!==(t=e.delay)&&void 0!==t?t:0,prev:null,next:null};return this.scribbleItems.set(n,o),o}reset(){this.editor.updateInstanceState({scribbles:[]}),this.scribbleItems.clear()}stop(e){const t=this.scribbleItems.get(e);if(!t)throw Error("Scribble with id ".concat(e," not found"));return t.delayRemaining=Math.min(t.delayRemaining,200),t.scribble.state="stopping",t}addPoint(e,t,n){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5;const r=this.scribbleItems.get(e);if(!r)throw Error("Scribble with id ".concat(e," not found"));const{prev:i}=r,s={x:t,y:n,z:o};return(!i||Vs.Dist(i,s)>=1)&&(r.next=s),r}tick(e){0!==this.scribbleItems.size&&this.editor.run((()=>{this.scribbleItems.forEach((t=>{if("starting"===t.scribble.state){const{next:e,prev:n}=t;return e&&e!==n&&(t.prev=e,t.scribble.points.push(e)),void(t.scribble.points.length>8&&(t.scribble.state="active"))}t.delayRemaining>0&&(t.delayRemaining=Math.max(0,t.delayRemaining-e)),t.timeoutMs+=e,t.timeoutMs>=16&&(t.timeoutMs=0);const{delayRemaining:n,timeoutMs:o,prev:r,next:i,scribble:s}=t;switch(s.state){case"active":i&&i!==r?(t.prev=i,s.points.push(i),0===n&&s.points.length>8&&s.points.shift()):0===o&&(s.points.length>1?s.points.shift():t.delayRemaining=s.delay);break;case"stopping":if(0===t.delayRemaining&&0===o){if(1===s.points.length)return void this.scribbleItems.delete(t.id);s.shrink&&(s.size=Math.max(1,s.size*(1-s.shrink))),s.points.shift()}}})),this.editor.updateInstanceState({scribbles:Array.from(this.scribbleItems.values()).map((e=>{let{scribble:t}=e;return l(l({},t),{},{points:[...t.points]})})).slice(-5)})}))}}var Vp,Wp,qp,Yp,Gp,Xp=Object.create,$p=Object.defineProperty,Zp=Object.getOwnPropertyDescriptor,Qp=(e,t)=>(t=Symbol[e])?t:Symbol.for("Symbol."+e),Jp=e=>{throw TypeError(e)},ef=(e,t,n)=>t in e?$p(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,tf=(e,t)=>$p(e,"name",{value:t,configurable:!0}),nf=["class","method","getter","setter","accessor","field","value","get","set"],of=e=>void 0!==e&&"function"!==typeof e?Jp("Function expected"):e,rf=(e,t,n,o,r)=>({kind:nf[e],name:t,metadata:o,addInitializer:e=>n._?Jp("Already initialized"):r.push(of(e||null))}),sf=(e,t)=>ef(t,Qp("metadata"),e[3]),af=(e,t,n,o,r,i)=>{var s,a,l,c,d,u=7&t,h=!!(8&t),p=!!(16&t),f=u>3?e.length+1:u?h?1:2:0,g=nf[u+5],m=u>3&&(e[f-1]=[]),y=e[f]||(e[f]=[]),v=u&&(!p&&!h&&(r=r.prototype),u<5&&(u>3||!p)&&Zp(u<4?r:{get[n](){return df(this,i)},set[n](e){return uf(this,i,e)}},n));u?p&&u<4&&tf(i,(u>2?"set ":u>1?"get ":"")+n):tf(r,n);for(var b=o.length-1;b>=0;b--)c=rf(u,n,l={},e[3],y),u&&(c.static=h,c.private=p,d=c.access={has:p?e=>cf(r,e):e=>n in e},3^u&&(d.get=p?e=>(1^u?df:hf)(e,r,4^u?i:v.get):e=>e[n]),u>2&&(d.set=p?(e,t)=>uf(e,r,t,4^u?i:v.set):(e,t)=>e[n]=t)),a=(0,o[b])(u?u<4?p?i:v[g]:u>4?void 0:{get:v.get,set:v.set}:r,c),l._=1,4^u||void 0===a?of(a)&&(u>4?m.unshift(a):u?p?i=a:v[g]=a:r=a):"object"!==typeof a||null===a?Jp("Object expected"):(of(s=a.get)&&(v.get=s),of(s=a.set)&&(v.set=s),of(s=a.init)&&m.unshift(s));return u||sf(e,r),v&&$p(r,n,v),p?4^u?i:v:r},lf=(e,t,n)=>t.has(e)||Jp("Cannot "+n),cf=(e,t)=>Object(t)!==t?Jp('Cannot use the "in" operator on this value'):e.has(t),df=(e,t,n)=>(lf(e,t,"read from private field"),n?n.call(e):t.get(e)),uf=(e,t,n,o)=>(lf(e,t,"write to private field"),o?o.call(e,n):t.set(e,n),n),hf=(e,t,n)=>(lf(e,t,"access private method"),n);const pf=e=>Math.round(e*10**8)/10**8;function ff(e,t,n,o,r){const i=e.filter((e=>("forward"===o?e.startNode.id===t:e.endNode.id===t)&&pf(e.length)===pf(n)&&ha(e.breadthIntersection[0],e.breadthIntersection[1],r[0],r[1])));if(0===i.length)return[];const s=new Set;return i.forEach((t=>{const a="forward"===o?t.endNode.id:t.startNode.id;if(!s.has(a)){s.add(a);const l=ff(e,a,n,o,ha(t.breadthIntersection[0],t.breadthIntersection[1],r[0],r[1]));i.push(...l)}})),i}Yp=[cn],qp=[cn],Wp=[cn],Vp=[cn];class gf{constructor(e){var t,n;this.manager=e,((e,t,n,o)=>{for(var r=0,i=e[t>>1],s=i&&i.length;r<s;r++)1&t?i[r].call(n):o=i[r].call(n,o)})(Gp,5,this),ef(this,"symbol"!==typeof(t="editor")?t+"":t,n),this.editor=e.editor}getSnapPointsCache(){const{editor:e}=this;return e.store.createComputedCache("snapPoints",(t=>{var n;const o=e.getShapePageTransform(t.id);if(!o)return;const r=null!==(n=e.getShapeUtil(t).getBoundsSnapGeometry(t).points)&&void 0!==n?n:e.getShapeGeometry(t).bounds.cornersAndCenter;return o&&r?r.map(((e,n)=>{const{x:r,y:i}=ic.applyToPoint(o,e);return{x:r,y:i,id:"".concat(t.id,":").concat(n)}})):void 0}))}getSnapPoints(e){var t;return null!==(t=this.getSnapPointsCache().get(e))&&void 0!==t?t:[]}getSnappablePoints(){const e=this.getSnapPointsCache(),t=this.manager.getSnappableShapes(),n=[];for(const o of t){const t=e.get(o);t&&n.push(...t)}return n}getSnappableGapNodes(){return Array.from(this.manager.getSnappableShapes(),(e=>({id:e,pageBounds:A(this.editor.getShapePageBounds(e))})))}getVisibleGaps(){const e=[],t=[];let n,o;const r=this.getSnappableGapNodes().sort(((e,t)=>e.pageBounds.minX-t.pageBounds.minX));for(let s=0;s<r.length;s++){n=r[s];for(let t=s+1;t<r.length;t++)o=r[t],n.pageBounds.maxX<o.pageBounds.minX&&ua(n.pageBounds.minY,n.pageBounds.maxY,o.pageBounds.minY,o.pageBounds.maxY)&&e.push({startNode:n,endNode:o,startEdge:[new Vs(n.pageBounds.maxX,n.pageBounds.minY),new Vs(n.pageBounds.maxX,n.pageBounds.maxY)],endEdge:[new Vs(o.pageBounds.minX,o.pageBounds.minY),new Vs(o.pageBounds.minX,o.pageBounds.maxY)],length:o.pageBounds.minX-n.pageBounds.maxX,breadthIntersection:ha(n.pageBounds.minY,n.pageBounds.maxY,o.pageBounds.minY,o.pageBounds.maxY)})}const i=r.sort(((e,t)=>e.pageBounds.minY-t.pageBounds.minY));for(let s=0;s<i.length;s++){n=i[s];for(let e=s+1;e<i.length;e++)o=i[e],n.pageBounds.maxY<o.pageBounds.minY&&ua(n.pageBounds.minX,n.pageBounds.maxX,o.pageBounds.minX,o.pageBounds.maxX)&&t.push({startNode:n,endNode:o,startEdge:[new Vs(n.pageBounds.minX,n.pageBounds.maxY),new Vs(n.pageBounds.maxX,n.pageBounds.maxY)],endEdge:[new Vs(o.pageBounds.minX,o.pageBounds.minY),new Vs(o.pageBounds.maxX,o.pageBounds.minY)],length:o.pageBounds.minY-n.pageBounds.maxY,breadthIntersection:ha(n.pageBounds.minX,n.pageBounds.maxX,o.pageBounds.minX,o.pageBounds.maxX)})}return{horizontal:e,vertical:t}}snapTranslateShapes(e){var t,n,o,r;let{lockedAxis:i,initialSelectionPageBounds:s,initialSelectionSnapPoints:a,dragDelta:l}=e;const c=this.manager.getSnapThreshold(),d=this.getSnappablePoints(),u=s.clone().translate(l),h=a.map(((e,t)=>{let{x:n,y:o}=e;return{id:"selection:"+t,x:n+l.x,y:o+l.y}})),p=d,f=[],g=[],m=new Vs(c,c);this.collectPointSnaps({minOffset:m,nearestSnapsX:f,nearestSnapsY:g,otherNodeSnapPoints:p,selectionSnapPoints:h}),this.collectGapSnaps({selectionPageBounds:u,nearestSnapsX:f,nearestSnapsY:g,minOffset:m});const y=new Vs("x"===i?0:null!==(t=null===(n=f[0])||void 0===n?void 0:n.nudge)&&void 0!==t?t:0,"y"===i?0:null!==(o=null===(r=g[0])||void 0===r?void 0:r.nudge)&&void 0!==o?o:0);m.x=0,m.y=0,f.length=0,g.length=0,h.forEach((e=>{e.x+=y.x,e.y+=y.y})),u.translate(y),this.collectPointSnaps({minOffset:m,nearestSnapsX:f,nearestSnapsY:g,otherNodeSnapPoints:p,selectionSnapPoints:h}),this.collectGapSnaps({selectionPageBounds:u,nearestSnapsX:f,nearestSnapsY:g,minOffset:m});const v=this.getPointSnapLines({nearestSnapsX:f,nearestSnapsY:g}),b=this.getGapSnapLines({selectionPageBounds:u,nearestSnapsX:f,nearestSnapsY:g});return this.manager.setIndicators([...b,...v]),{nudge:y}}snapResizeShapes(e){var t,n,o,r;let{initialSelectionPageBounds:i,dragDelta:s,handle:a,isAspectRatioLocked:l,isResizingFromCenter:c}=e;const d=this.manager.getSnapThreshold(),{box:u,scaleX:h,scaleY:p}=rc.Resize(i,a,c?2*s.x:s.x,c?2*s.y:s.y,l);let f=a;h<0&&(f=function(e){switch(e){case"left":return"right";case"right":return"left";case"top_left":return"top_right";case"top_right":return"top_left";case"bottom_left":return"bottom_right";case"bottom_right":return"bottom_left";default:return e}}(f)),p<0&&(f=function(e){switch(e){case"top":return"bottom";case"bottom":return"top";case"top_left":return"bottom_left";case"top_right":return"bottom_right";case"bottom_left":return"top_left";case"bottom_right":return"top_right";default:return e}}(f)),c&&(u.center=i.center);const g="top"===f||"bottom"===f,m="left"===f||"right"===f,y=mf(f,u),v=this.getSnappablePoints(),b=[],w=[],x=new Vs(d,d);this.collectPointSnaps({minOffset:x,nearestSnapsX:b,nearestSnapsY:w,otherNodeSnapPoints:v,selectionSnapPoints:y});const S=new Vs(g?0:null!==(t=null===(n=b[0])||void 0===n?void 0:n.nudge)&&void 0!==t?t:0,m?0:null!==(o=null===(r=w[0])||void 0===r?void 0:r.nudge)&&void 0!==o?o:0);if(l&&("top_left"===(k=f)||"top_right"===k||"bottom_right"===k||"bottom_left"===k)&&0!==S.len()){const e=b.length&&w.length?Math.abs(S.x)<Math.abs(S.y)?"x":"y":b.length?"x":"y",t=i.aspectRatio;"x"===e?(w.length=0,S.y=S.x/t,"bottom_left"!==f&&"top_right"!==f||(S.y=-S.y)):(b.length=0,S.x=S.y*t,"bottom_left"!==f&&"top_right"!==f||(S.x=-S.x))}var k;const P=Vs.Add(s,S),{box:C}=rc.Resize(i,a,c?2*P.x:P.x,c?2*P.y:P.y,l);c&&(C.center=i.center);const _=mf("any",C);b.length=0,w.length=0,x.x=0,x.y=0,this.collectPointSnaps({minOffset:x,nearestSnapsX:b,nearestSnapsY:w,otherNodeSnapPoints:v,selectionSnapPoints:_});const I=this.getPointSnapLines({nearestSnapsX:b,nearestSnapsY:w});return this.manager.setIndicators([...I]),{nudge:S}}collectPointSnaps(e){let{selectionSnapPoints:t,otherNodeSnapPoints:n,minOffset:o,nearestSnapsX:r,nearestSnapsY:i}=e;for(const s of t)for(const e of n){const t=Vs.Sub(s,e),n=Math.abs(t.x),a=Math.abs(t.y);pf(n)<=pf(o.x)&&(pf(n)<pf(o.x)&&(r.length=0),r.push({type:"points",points:{thisPoint:s,otherPoint:e},nudge:e.x-s.x}),o.x=n),pf(a)<=pf(o.y)&&(pf(a)<pf(o.y)&&(i.length=0),i.push({type:"points",points:{thisPoint:s,otherPoint:e},nudge:e.y-s.y}),o.y=a)}}collectGapSnaps(e){let{selectionPageBounds:t,minOffset:n,nearestSnapsX:o,nearestSnapsY:r}=e;const{horizontal:i,vertical:s}=this.getVisibleGaps();for(const a of i){if(!ua(a.breadthIntersection[0],a.breadthIntersection[1],t.minY,t.maxY))continue;const e=a.startEdge[0].x+a.length/2-t.center.x;if(a.length>t.width&&pf(Math.abs(e))<=pf(n.x)){pf(Math.abs(e))<pf(n.x)&&(o.length=0),n.x=Math.abs(e);const t={type:"gap_center",gap:a,nudge:e},r=o.find((e=>{let{type:t}=e;return"gap_center"===t})),i=r&&ha(a.breadthIntersection[0],a.breadthIntersection[1],r.gap.breadthIntersection[0],r.gap.breadthIntersection[1]);r&&r.gap.length>a.length&&i?o[o.indexOf(r)]=t:r&&i||o.push(t)}const r=a.startNode.pageBounds.minX-a.length-t.maxX;pf(Math.abs(r))<=pf(n.x)&&(pf(Math.abs(r))<pf(n.x)&&(o.length=0),n.x=Math.abs(r),o.push({type:"gap_duplicate",gap:a,protrusionDirection:"left",nudge:r}));const i=a.endNode.pageBounds.maxX+a.length-t.minX;pf(Math.abs(i))<=pf(n.x)&&(pf(Math.abs(i))<pf(n.x)&&(o.length=0),n.x=Math.abs(i),o.push({type:"gap_duplicate",gap:a,protrusionDirection:"right",nudge:i}))}for(const a of s){if(!ua(a.breadthIntersection[0],a.breadthIntersection[1],t.minX,t.maxX))continue;const e=a.startEdge[0].y+a.length/2-t.center.y;if(a.length>t.height&&pf(Math.abs(e))<=pf(n.y)){pf(Math.abs(e))<pf(n.y)&&(r.length=0),n.y=Math.abs(e);const t={type:"gap_center",gap:a,nudge:e},o=r.find((e=>{let{type:t}=e;return"gap_center"===t})),i=o&&ua(o.gap.breadthIntersection[0],o.gap.breadthIntersection[1],a.breadthIntersection[0],a.breadthIntersection[1]);o&&o.gap.length>a.length&&i?r[r.indexOf(o)]=t:o&&i||r.push(t);continue}const o=a.startNode.pageBounds.minY-a.length-t.maxY;pf(Math.abs(o))<=pf(n.y)&&(pf(Math.abs(o))<pf(n.y)&&(r.length=0),n.y=Math.abs(o),r.push({type:"gap_duplicate",gap:a,protrusionDirection:"top",nudge:o}));const i=a.endNode.pageBounds.maxY+a.length-t.minY;pf(Math.abs(i))<=pf(n.y)&&(pf(Math.abs(i))<pf(n.y)&&(r.length=0),n.y=Math.abs(i),r.push({type:"gap_duplicate",gap:a,protrusionDirection:"bottom",nudge:i}))}}getPointSnapLines(e){let{nearestSnapsX:t,nearestSnapsY:n}=e;const o={},r={};if(t.length>0)for(const i of t)if("points"===i.type){const e=pf(i.points.otherPoint.x);o[e]||(o[e]=[]),o[e].push(i.points)}if(n.length>0)for(const i of n)if("points"===i.type){const e=pf(i.points.otherPoint.y);r[e]||(r[e]=[]),r[e].push(i.points)}return Object.values(o).concat(Object.values(r)).map((e=>({id:$(),type:"points",points:P(e.map((e=>Vs.From(e.otherPoint))).concat(e.map((e=>Vs.From(e.thisPoint)))),((e,t)=>e.equals(t)))})))}getGapSnapLines(e){let{selectionPageBounds:t,nearestSnapsX:n,nearestSnapsY:o}=e;const{vertical:r,horizontal:i}=this.getVisibleGaps(),s={top:t.sides[0],right:t.sides[1],bottom:[t.corners[3],t.corners[2]],left:[t.corners[0],t.corners[3]]},a=[];if(n.length>0)for(const l of n){if("points"===l.type)continue;const{gap:{breadthIntersection:e,startEdge:n,startNode:o,endNode:r,length:c,endEdge:d}}=l;switch(l.type){case"gap_center":{const l=(c-t.width)/2,u=ha(e[0],e[1],t.minY,t.maxY);a.push({type:"gaps",direction:"horizontal",id:$(),gaps:[...ff(i,o.id,l,"backward",u),{startEdge:n,endEdge:s.left},{startEdge:s.right,endEdge:d},...ff(i,r.id,l,"forward",u)]});break}case"gap_duplicate":{const u=ha(e[0],e[1],t.minY,t.maxY);a.push({type:"gaps",direction:"horizontal",id:$(),gaps:"left"===l.protrusionDirection?[{startEdge:s.right,endEdge:n.map((e=>e.clone().addXY(-o.pageBounds.width,0)))},{startEdge:n,endEdge:d},...ff(i,r.id,c,"forward",u)]:[...ff(i,o.id,c,"backward",u),{startEdge:n,endEdge:d},{startEdge:d.map((e=>e.clone().addXY(l.gap.endNode.pageBounds.width,0))),endEdge:s.left}]});break}}}if(o.length>0)for(const l of o){if("points"===l.type)continue;const{gap:{breadthIntersection:e,startEdge:n,startNode:o,endNode:i,length:c,endEdge:d}}=l;switch(l.type){case"gap_center":{const i=(c-t.height)/2,u=ha(e[0],e[1],t.minX,t.maxX);a.push({type:"gaps",direction:"vertical",id:$(),gaps:[...ff(r,o.id,i,"backward",u),{startEdge:n,endEdge:s.top},{startEdge:s.bottom,endEdge:d},...ff(r,l.gap.endNode.id,i,"forward",u)]});break}case"gap_duplicate":{const u=ha(e[0],e[1],t.minX,t.maxX);a.push({type:"gaps",direction:"vertical",id:$(),gaps:"top"===l.protrusionDirection?[{startEdge:s.bottom,endEdge:n.map((e=>e.clone().addXY(0,-o.pageBounds.height)))},{startEdge:n,endEdge:d},...ff(r,i.id,c,"forward",u)]:[...ff(r,o.id,c,"backward",u),{startEdge:n,endEdge:d},{startEdge:d.map((e=>e.clone().addXY(0,i.pageBounds.height))),endEdge:s.top}]})}}}return function(e){e.sort(((e,t)=>t.gaps.length-e.gaps.length));for(let t=e.length-1;t>0;t--){const n=e[t];for(let o=t-1;o>=0;o--){const r=e[o];if(r.direction===n.direction&&n.gaps.every((e=>r.gaps.some((t=>pf(e.startEdge[0].x)===pf(t.startEdge[0].x)&&pf(e.startEdge[0].y)===pf(t.startEdge[0].y)&&pf(e.startEdge[1].x)===pf(t.startEdge[1].x)&&pf(e.startEdge[1].y)===pf(t.startEdge[1].y)))&&r.gaps.some((t=>pf(e.endEdge[0].x)===pf(t.endEdge[0].x)&&pf(e.endEdge[0].y)===pf(t.endEdge[0].y)&&pf(e.endEdge[1].x)===pf(t.endEdge[1].x)&&pf(e.endEdge[1].y)===pf(t.endEdge[1].y)))))){e.splice(t,1);break}}}}(a),a}}function mf(e,t){const{minX:n,maxX:o,minY:r,maxY:i}=t,s=[];switch(e){case"top":case"left":case"top_left":case"any":s.push({id:"top_left",handle:"top_left",x:n,y:r})}switch(e){case"top":case"right":case"top_right":case"any":s.push({id:"top_right",handle:"top_right",x:o,y:r})}switch(e){case"bottom":case"right":case"bottom_right":case"any":s.push({id:"bottom_right",handle:"bottom_right",x:o,y:i})}switch(e){case"bottom":case"left":case"bottom_left":case"any":s.push({id:"bottom_left",handle:"bottom_left",x:n,y:i})}return s}af(Gp=(e=>{var t;return[,,,Xp(null!==(t=null===e||void 0===e?void 0:e[Qp("metadata")])&&void 0!==t?t:null)]})(null),1,"getSnapPointsCache",Yp,gf),af(Gp,1,"getSnappablePoints",qp,gf),af(Gp,1,"getSnappableGapNodes",Wp,gf),af(Gp,1,"getVisibleGaps",Vp,gf),sf(Gp,gf);var yf,vf,bf=Object.create,wf=Object.defineProperty,xf=Object.getOwnPropertyDescriptor,Sf=(e,t)=>(t=Symbol[e])?t:Symbol.for("Symbol."+e),kf=e=>{throw TypeError(e)},Pf=(e,t,n)=>t in e?wf(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Cf=(e,t)=>wf(e,"name",{value:t,configurable:!0}),_f=["class","method","getter","setter","accessor","field","value","get","set"],If=e=>void 0!==e&&"function"!==typeof e?kf("Function expected"):e,Ef=(e,t,n,o,r)=>({kind:_f[e],name:t,metadata:o,addInitializer:e=>n._?kf("Already initialized"):r.push(If(e||null))}),jf=(e,t)=>Pf(t,Sf("metadata"),e[3]),Tf=(e,t,n)=>t.has(e)||kf("Cannot "+n),Mf=(e,t)=>Object(t)!==t?kf('Cannot use the "in" operator on this value'):e.has(t),Af=(e,t,n)=>(Tf(e,t,"read from private field"),n?n.call(e):t.get(e)),Of=(e,t,n,o)=>(Tf(e,t,"write to private field"),o?o.call(e,n):t.set(e,n),n),Df=(e,t,n)=>(Tf(e,t,"access private method"),n);const Rf=()=>null,Lf=()=>[];yf=[cn];class zf{constructor(e){var t,n;this.manager=e,((e,t,n,o)=>{for(var r=0,i=e[t>>1],s=i&&i.length;r<s;r++)1&t?i[r].call(n):o=i[r].call(n,o)})(vf,5,this),Pf(this,"symbol"!==typeof(t="editor")?t+"":t,n),this.editor=e.editor}getSnapGeometryCache(){const{editor:e}=this;return e.store.createComputedCache("handle snap geometry",(t=>{var n;const o=e.getShapeUtil(t).getHandleSnapGeometry(t),r=o.getSelfSnapOutline?o.getSelfSnapOutline.bind(o):Rf,i=o.getSelfSnapPoints?o.getSelfSnapPoints.bind(o):Lf;return{outline:void 0===o.outline?e.getShapeGeometry(t):o.outline,points:null!==(n=o.points)&&void 0!==n?n:[],getSelfSnapOutline:r,getSelfSnapPoints:i}}))}*iterateSnapPointsInPageSpace(e,t){var n;const o=null===(n=this.getSnapGeometryCache().get(e))||void 0===n?void 0:n.getSelfSnapPoints(t);if(o&&o.length){const t=A(this.editor.getShapePageTransform(e));for(const e of o)yield t.applyToPoint(e)}for(const i of this.manager.getSnappableShapes()){var r;if(i===e)continue;const t=null===(r=this.getSnapGeometryCache().get(i))||void 0===r?void 0:r.points;if(!t||!t.length)continue;const n=A(this.editor.getShapePageTransform(i));for(const e of t)yield n.applyToPoint(e)}}*iterateSnapOutlines(e,t){var n;const o=null===(n=this.getSnapGeometryCache().get(e))||void 0===n?void 0:n.getSelfSnapOutline(t);o&&(yield{shapeId:e,outline:o});for(const i of this.manager.getSnappableShapes()){var r;if(i===e)continue;const t=null===(r=this.getSnapGeometryCache().get(i))||void 0===r?void 0:r.outline;t&&(yield{shapeId:i,outline:t})}}getHandleSnapPosition(e){let{currentShapeId:t,handle:n,handleInPageSpace:o}=e;const r=this.manager.getSnapThreshold();let i=r,s=null;for(const c of this.iterateSnapPointsInPageSpace(t,n))Vs.DistMin(o,c,i)&&(i=Vs.Dist(o,c),s=c);if(s)return s;let a=r,l=null;for(const{shapeId:c,outline:d}of this.iterateSnapOutlines(t,n)){const e=A(this.editor.getShapePageTransform(c)),t=this.editor.getPointInShapeSpace(c,o),n=d.nearestPoint(t),r=e.applyToPoint(n);Vs.DistMin(o,r,a)&&(a=Vs.Dist(o,r),l=r)}return l||null}snapHandle(e){let{currentShapeId:t,handle:n}=e;const o=A(this.editor.getShapePageTransform(t)).applyToPoint(n),r=this.getHandleSnapPosition({currentShapeId:t,handle:n,handleInPageSpace:o});return r?(this.manager.setIndicators([{id:$(),type:"points",points:[r]}]),{nudge:Vs.Sub(r,o)}):null}}((e,t,n,o,r,i)=>{var s,a,l,c,d,u=7&t,h=!!(8&t),p=!!(16&t),f=u>3?e.length+1:u?h?1:2:0,g=_f[u+5],m=u>3&&(e[f-1]=[]),y=e[f]||(e[f]=[]),v=u&&(!p&&!h&&(r=r.prototype),u<5&&(u>3||!p)&&xf(u<4?r:{get[n](){return Af(this,i)},set[n](e){return Of(this,i,e)}},n));u?p&&u<4&&Cf(i,(u>2?"set ":u>1?"get ":"")+n):Cf(r,n);for(var b=o.length-1;b>=0;b--)c=Ef(u,n,l={},e[3],y),u&&(c.static=h,c.private=p,d=c.access={has:p?e=>Mf(r,e):e=>n in e},3^u&&(d.get=p?e=>(1^u?Af:Df)(e,r,4^u?i:v.get):e=>e[n]),u>2&&(d.set=p?(e,t)=>Of(e,r,t,4^u?i:v.set):(e,t)=>e[n]=t)),a=(0,o[b])(u?u<4?p?i:v[g]:u>4?void 0:{get:v.get,set:v.set}:r,c),l._=1,4^u||void 0===a?If(a)&&(u>4?m.unshift(a):u?p?i=a:v[g]=a:r=a):"object"!==typeof a||null===a?kf("Object expected"):(If(s=a.get)&&(v.get=s),If(s=a.set)&&(v.set=s),If(s=a.init)&&m.unshift(s));u||jf(e,r),v&&wf(r,n,v)})(vf=(e=>{var t;return[,,,bf(null!==(t=null===e||void 0===e?void 0:e[Sf("metadata")])&&void 0!==t?t:null)]})(null),1,"getSnapGeometryCache",yf,zf),jf(vf,zf);var Nf,Ff,Bf,Uf,Hf=Object.create,Kf=Object.defineProperty,Vf=Object.getOwnPropertyDescriptor,Wf=(e,t)=>(t=Symbol[e])?t:Symbol.for("Symbol."+e),qf=e=>{throw TypeError(e)},Yf=(e,t,n)=>t in e?Kf(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Gf=(e,t)=>Kf(e,"name",{value:t,configurable:!0}),Xf=["class","method","getter","setter","accessor","field","value","get","set"],$f=e=>void 0!==e&&"function"!==typeof e?qf("Function expected"):e,Zf=(e,t,n,o,r)=>({kind:Xf[e],name:t,metadata:o,addInitializer:e=>n._?qf("Already initialized"):r.push($f(e||null))}),Qf=(e,t)=>Yf(t,Wf("metadata"),e[3]),Jf=(e,t,n,o,r,i)=>{var s,a,l,c,d,u=7&t,h=!!(8&t),p=!!(16&t),f=u>3?e.length+1:u?h?1:2:0,g=Xf[u+5],m=u>3&&(e[f-1]=[]),y=e[f]||(e[f]=[]),v=u&&(!p&&!h&&(r=r.prototype),u<5&&(u>3||!p)&&Vf(u<4?r:{get[n](){return og(this,i)},set[n](e){return rg(this,i,e)}},n));u?p&&u<4&&Gf(i,(u>2?"set ":u>1?"get ":"")+n):Gf(r,n);for(var b=o.length-1;b>=0;b--)c=Zf(u,n,l={},e[3],y),u&&(c.static=h,c.private=p,d=c.access={has:p?e=>ng(r,e):e=>n in e},3^u&&(d.get=p?e=>(1^u?og:ig)(e,r,4^u?i:v.get):e=>e[n]),u>2&&(d.set=p?(e,t)=>rg(e,r,t,4^u?i:v.set):(e,t)=>e[n]=t)),a=(0,o[b])(u?u<4?p?i:v[g]:u>4?void 0:{get:v.get,set:v.set}:r,c),l._=1,4^u||void 0===a?$f(a)&&(u>4?m.unshift(a):u?p?i=a:v[g]=a:r=a):"object"!==typeof a||null===a?qf("Object expected"):($f(s=a.get)&&(v.get=s),$f(s=a.set)&&(v.set=s),$f(s=a.init)&&m.unshift(s));return u||Qf(e,r),v&&Kf(r,n,v),p?4^u?i:v:r},eg=(e,t,n)=>Yf(e,"symbol"!==typeof t?t+"":t,n),tg=(e,t,n)=>t.has(e)||qf("Cannot "+n),ng=(e,t)=>Object(t)!==t?qf('Cannot use the "in" operator on this value'):e.has(t),og=(e,t,n)=>(tg(e,t,"read from private field"),n?n.call(e):t.get(e)),rg=(e,t,n,o)=>(tg(e,t,"write to private field"),o?o.call(e,n):t.set(e,n),n),ig=(e,t,n)=>(tg(e,t,"access private method"),n);Bf=[cn],Ff=[cn],Nf=[cn];class sg{constructor(e){this.editor=e,((e,t,n,o)=>{for(var r=0,i=e[t>>1],s=i&&i.length;r<s;r++)1&t?i[r].call(n):o=i[r].call(n,o)})(Uf,5,this),eg(this,"shapeBounds"),eg(this,"handles"),eg(this,"_snapIndicators",Qt("snapLines",void 0)),this.shapeBounds=new gf(this),this.handles=new zf(this)}getIndicators(){var e;return null!==(e=this._snapIndicators.get())&&void 0!==e?e:jt}clearIndicators(){this.getIndicators().length&&this._snapIndicators.set(void 0)}setIndicators(e){this._snapIndicators.set(e)}getSnapThreshold(){return 8/this.editor.getZoomLevel()}getSnappableShapes(){var e;const{editor:t}=this,n=t.getViewportPageBounds(),o=t.getSelectedShapeIds(),r=new Set,i=e=>{if(Ho(e)){const n=t.getShape(e);n&&t.isShapeOfType(n,"frame")&&r.add(e)}const s=t.getSortedChildIdsForParent(e);for(const a of s){if(o.includes(a))continue;const e=t.getShape(a);if(!e)continue;if(!t.getShapeUtil(e).canSnap(e))continue;const s=t.getShapePageBounds(a);s&&n.includes(s)&&(t.isShapeOfType(e,"group")?i(a):r.add(a))}};return i(null!==(e=this.getCurrentCommonAncestor())&&void 0!==e?e:t.getCurrentPageId()),r}getCurrentCommonAncestor(){return this.editor.findCommonAncestor(this.editor.getSelectedShapes())}}Jf(Uf=(e=>{var t;return[,,,Hf(null!==(t=null===e||void 0===e?void 0:e[Wf("metadata")])&&void 0!==t?t:null)]})(null),1,"getSnapThreshold",Bf,sg),Jf(Uf,1,"getSnappableShapes",Ff,sg),Jf(Uf,1,"getCurrentCommonAncestor",Nf,sg),Qf(Uf,sg);const ag=/\r?\n|\r/g;function lg(e){return e.replace(ag,"\n").split("\n").map((e=>e||" ")).join("\n")}const cg={start:"left","start-legacy":"left",middle:"center","middle-legacy":"center",end:"right","end-legacy":"right"},dg=/\s/;class ug{constructor(e){s(this,"baseElem",void 0),this.editor=e,this.baseElem=document.createElement("div"),this.baseElem.classList.add("tl-text"),this.baseElem.classList.add("tl-text-measure"),this.baseElem.tabIndex=-1}measureText(e,t){const n=this.baseElem.cloneNode();this.editor.getContainer().appendChild(n),n.setAttribute("dir","auto"),n.style.setProperty("unicode-bidi","plaintext"),n.style.setProperty("font-family",t.fontFamily),n.style.setProperty("font-style",t.fontStyle),n.style.setProperty("font-weight",t.fontWeight),n.style.setProperty("font-size",t.fontSize+"px"),n.style.setProperty("line-height",t.lineHeight*t.fontSize+"px"),n.style.setProperty("max-width",null===t.maxWidth?null:t.maxWidth+"px"),n.style.setProperty("min-width",null===t.minWidth?null:t.minWidth+"px"),n.style.setProperty("padding",t.padding),n.style.setProperty("overflow-wrap",t.disableOverflowWrapBreaking?"normal":"break-word"),n.textContent=lg(e);const o=n.scrollWidth,r=n.getBoundingClientRect();return n.remove(),{x:0,y:0,w:r.width,h:r.height,scrollWidth:o}}measureElementTextNodeSpans(e){let{shouldTruncateToFirstLine:t=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=[],o=e.getBoundingClientRect(),r=-o.left,i=-o.top,s=new Range,a=e.childNodes[0];let l=0,c=null,d=null,u=0,h=0,p=!1;for(const g of e.childNodes)if(g.nodeType===Node.TEXT_NODE)for(const e of null!==(f=g.textContent)&&void 0!==f?f:""){var f;s.setStart(a,l),s.setEnd(a,l+e.length);const o=s.getClientRects(),g=o[o.length-1],m=g.top+i,y=g.left+r,v=g.right+r,b=y<h,w=dg.test(e);if(w===d&&m===u&&c)b&&(c.box.x=y),c.box.w=b?c.box.w+g.width:v-c.box.x,c.text+=e;else{if(c){if(t&&m!==u){p=!0;break}n.push(c)}c={box:{x:y,y:m,w:g.width,h:g.height},text:e},h=y}"\n"===e&&(h=0),d=w,u=m,l+=e.length}return c&&n.push(c),{spans:n,didTruncate:p}}measureTextSpans(e,t){if(""===e)return[];const n=this.baseElem.cloneNode();this.editor.getContainer().appendChild(n);const o=Math.ceil(t.width-2*t.padding);n.setAttribute("dir","auto"),n.style.setProperty("unicode-bidi","plaintext"),n.style.setProperty("width","".concat(o,"px")),n.style.setProperty("height","min-content"),n.style.setProperty("font-size","".concat(t.fontSize,"px")),n.style.setProperty("font-family",t.fontFamily),n.style.setProperty("font-weight",t.fontWeight),n.style.setProperty("line-height","".concat(t.lineHeight*t.fontSize,"px")),n.style.setProperty("text-align",cg[t.textAlign]);const r="truncate-ellipsis"===t.overflow||"truncate-clip"===t.overflow;r&&(n.style.setProperty("overflow-wrap","anywhere"),n.style.setProperty("word-break","break-all"));const i=lg(e);n.textContent=i;const{spans:s,didTruncate:a}=this.measureElementTextNodeSpans(n,{shouldTruncateToFirstLine:r});if("truncate-ellipsis"===t.overflow&&a){n.textContent="\u2026";const e=Math.ceil(this.measureElementTextNodeSpans(n).spans[0].box.w);n.style.setProperty("width","".concat(o-e,"px")),n.textContent=i;const r=this.measureElementTextNodeSpans(n,{shouldTruncateToFirstLine:!0}).spans,s=r[r.length-1];return r.push({text:"\u2026",box:{x:Math.min(s.box.x+s.box.w,t.width-t.padding-e),y:s.box.y,w:e,h:s.box.h}}),r}return n.remove(),s}}var hg,pg,fg,gg=Object.create,mg=Object.defineProperty,yg=Object.getOwnPropertyDescriptor,vg=(e,t)=>(t=Symbol[e])?t:Symbol.for("Symbol."+e),bg=e=>{throw TypeError(e)},wg=(e,t,n)=>t in e?mg(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,xg=(e,t)=>mg(e,"name",{value:t,configurable:!0}),Sg=["class","method","getter","setter","accessor","field","value","get","set"],kg=e=>void 0!==e&&"function"!==typeof e?bg("Function expected"):e,Pg=(e,t,n,o,r)=>({kind:Sg[e],name:t,metadata:o,addInitializer:e=>n._?bg("Already initialized"):r.push(kg(e||null))}),Cg=(e,t)=>wg(t,vg("metadata"),e[3]),_g=(e,t,n,o,r,i)=>{var s,a,l,c,d,u=7&t,h=!!(8&t),p=!!(16&t),f=u>3?e.length+1:u?h?1:2:0,g=Sg[u+5],m=u>3&&(e[f-1]=[]),y=e[f]||(e[f]=[]),v=u&&(!p&&!h&&(r=r.prototype),u<5&&(u>3||!p)&&yg(u<4?r:{get[n](){return Tg(this,i)},set[n](e){return Mg(this,i,e)}},n));u?p&&u<4&&xg(i,(u>2?"set ":u>1?"get ":"")+n):xg(r,n);for(var b=o.length-1;b>=0;b--)c=Pg(u,n,l={},e[3],y),u&&(c.static=h,c.private=p,d=c.access={has:p?e=>jg(r,e):e=>n in e},3^u&&(d.get=p?e=>(1^u?Tg:Ag)(e,r,4^u?i:v.get):e=>e[n]),u>2&&(d.set=p?(e,t)=>Mg(e,r,t,4^u?i:v.set):(e,t)=>e[n]=t)),a=(0,o[b])(u?u<4?p?i:v[g]:u>4?void 0:{get:v.get,set:v.set}:r,c),l._=1,4^u||void 0===a?kg(a)&&(u>4?m.unshift(a):u?p?i=a:v[g]=a:r=a):"object"!==typeof a||null===a?bg("Object expected"):(kg(s=a.get)&&(v.get=s),kg(s=a.set)&&(v.set=s),kg(s=a.init)&&m.unshift(s));return u||Cg(e,r),v&&mg(r,n,v),p?4^u?i:v:r},Ig=(e,t,n)=>wg(e,"symbol"!==typeof t?t+"":t,n),Eg=(e,t,n)=>t.has(e)||bg("Cannot "+n),jg=(e,t)=>Object(t)!==t?bg('Cannot use the "in" operator on this value'):e.has(t),Tg=(e,t,n)=>(Eg(e,t,"read from private field"),n?n.call(e):t.get(e)),Mg=(e,t,n,o)=>(Eg(e,t,"write to private field"),o?o.call(e,n):t.set(e,n),n),Ag=(e,t,n)=>(Eg(e,t,"access private method"),n);const Og=gt;pg=[R],hg=[R];class Dg{constructor(e){this.editor=e,((e,t,n,o)=>{for(var r=0,i=e[t>>1],s=i&&i.length;r<s;r++)1&t?i[r].call(n):o=i[r].call(n,o)})(fg,5,this),Ig(this,"cancelRaf"),Ig(this,"isPaused",!0),Ig(this,"now",0),Ig(this,"prevPoint",new Vs),this.editor.disposables.add(this.dispose),this.start()}start(){var e;this.isPaused=!1,null===(e=this.cancelRaf)||void 0===e||e.call(this),this.cancelRaf=Og(this.tick),this.now=Date.now()}tick(){if(this.isPaused)return;const e=Date.now(),t=e-this.now;this.now=e,this.updatePointerVelocity(t),this.editor.emit("frame",t),this.editor.emit("tick",t),this.cancelRaf=Og(this.tick)}dispose(){var e;this.isPaused=!0,null===(e=this.cancelRaf)||void 0===e||e.call(this)}updatePointerVelocity(e){const{prevPoint:t,editor:{inputs:{currentScreenPoint:n,pointerVelocity:o}}}=this;if(0===e)return;const r=Vs.Sub(n,t);this.prevPoint=n.clone();const i=r.len(),s=i?r.div(i):new Vs(0,0),a=o.clone().lrp(s.mul(i/e),.5);Math.abs(a.x)<.01&&(a.x=0),Math.abs(a.y)<.01&&(a.y=0),o.equals(a)||(this.editor.inputs.pointerVelocity=a)}}_g(fg=(e=>{var t;return[,,,gg(null!==(t=null===e||void 0===e?void 0:e[vg("metadata")])&&void 0!==t?t:null)]})(null),1,"tick",pg,Dg),_g(fg,1,"dispose",hg,Dg),Cg(fg,Dg);var Rg,Lg,zg,Ng,Fg,Bg,Ug,Hg,Kg,Vg,Wg,qg,Yg,Gg=Object.create,Xg=Object.defineProperty,$g=Object.getOwnPropertyDescriptor,Zg=(e,t)=>(t=Symbol[e])?t:Symbol.for("Symbol."+e),Qg=e=>{throw TypeError(e)},Jg=(e,t,n)=>t in e?Xg(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,em=(e,t)=>Xg(e,"name",{value:t,configurable:!0}),tm=["class","method","getter","setter","accessor","field","value","get","set"],nm=e=>void 0!==e&&"function"!==typeof e?Qg("Function expected"):e,om=(e,t,n,o,r)=>({kind:tm[e],name:t,metadata:o,addInitializer:e=>n._?Qg("Already initialized"):r.push(nm(e||null))}),rm=(e,t)=>Jg(t,Zg("metadata"),e[3]),im=(e,t,n,o,r,i)=>{var s,a,l,c,d,u=7&t,h=!!(8&t),p=!!(16&t),f=u>3?e.length+1:u?h?1:2:0,g=tm[u+5],m=u>3&&(e[f-1]=[]),y=e[f]||(e[f]=[]),v=u&&(!p&&!h&&(r=r.prototype),u<5&&(u>3||!p)&&$g(u<4?r:{get[n](){return cm(this,i)},set[n](e){return dm(this,i,e)}},n));u?p&&u<4&&em(i,(u>2?"set ":u>1?"get ":"")+n):em(r,n);for(var b=o.length-1;b>=0;b--)c=om(u,n,l={},e[3],y),u&&(c.static=h,c.private=p,d=c.access={has:p?e=>lm(r,e):e=>n in e},3^u&&(d.get=p?e=>(1^u?cm:um)(e,r,4^u?i:v.get):e=>e[n]),u>2&&(d.set=p?(e,t)=>dm(e,r,t,4^u?i:v.set):(e,t)=>e[n]=t)),a=(0,o[b])(u?u<4?p?i:v[g]:u>4?void 0:{get:v.get,set:v.set}:r,c),l._=1,4^u||void 0===a?nm(a)&&(u>4?m.unshift(a):u?p?i=a:v[g]=a:r=a):"object"!==typeof a||null===a?Qg("Object expected"):(nm(s=a.get)&&(v.get=s),nm(s=a.set)&&(v.set=s),nm(s=a.init)&&m.unshift(s));return u||rm(e,r),v&&Xg(r,n,v),p?4^u?i:v:r},sm=(e,t,n)=>Jg(e,"symbol"!==typeof t?t+"":t,n),am=(e,t,n)=>t.has(e)||Qg("Cannot "+n),lm=(e,t)=>Object(t)!==t?Qg('Cannot use the "in" operator on this value'):e.has(t),cm=(e,t,n)=>(am(e,t,"read from private field"),n?n.call(e):t.get(e)),dm=(e,t,n,o)=>(am(e,t,"write to private field"),o?o.call(e,n):t.set(e,n),n),um=(e,t,n)=>(am(e,t,"access private method"),n);qg=[cn],Wg=[cn],Vg=[cn],Kg=[cn],Hg=[cn],Ug=[cn],Bg=[cn],Fg=[cn],Ng=[cn],zg=[cn],Lg=[cn],Rg=[cn];class hm{constructor(e,t){if(this.user=e,this.inferDarkMode=t,((e,t,n,o)=>{for(var r=0,i=e[t>>1],s=i&&i.length;r<s;r++)1&t?i[r].call(n):o=i[r].call(n,o)})(Yg,5,this),sm(this,"systemColorScheme",Qt("systemColorScheme","light")),sm(this,"disposables",new Set),"undefined"===typeof window||!("matchMedia"in window))return;const n=window.matchMedia("(prefers-color-scheme: dark)");null!==n&&void 0!==n&&n.matches&&this.systemColorScheme.set("dark");const o=e=>{e.matches?this.systemColorScheme.set("dark"):this.systemColorScheme.set("light")};null===n||void 0===n||n.addEventListener("change",o),this.disposables.add((()=>null===n||void 0===n?void 0:n.removeEventListener("change",o)))}dispose(){this.disposables.forEach((e=>e()))}updateUserPreferences(e){this.user.setUserPreferences(l(l({},this.user.userPreferences.get()),e))}getUserPreferences(){return{id:this.getId(),name:this.getName(),locale:this.getLocale(),color:this.getColor(),animationSpeed:this.getAnimationSpeed(),isSnapMode:this.getIsSnapMode(),colorScheme:this.user.userPreferences.get().colorScheme,isDarkMode:this.getIsDarkMode(),isWrapMode:this.getIsWrapMode(),isDynamicResizeMode:this.getIsDynamicResizeMode()}}getIsDarkMode(){switch(this.user.userPreferences.get().colorScheme){case"dark":return!0;case"light":return!1;case"system":return"dark"===this.systemColorScheme.get();default:return!!this.inferDarkMode&&"dark"===this.systemColorScheme.get()}}getEdgeScrollSpeed(){var e;return null!==(e=this.user.userPreferences.get().edgeScrollSpeed)&&void 0!==e?e:_d.edgeScrollSpeed}getAnimationSpeed(){var e;return null!==(e=this.user.userPreferences.get().animationSpeed)&&void 0!==e?e:_d.animationSpeed}getId(){return this.user.userPreferences.get().id}getName(){var e;return null!==(e=this.user.userPreferences.get().name)&&void 0!==e?e:_d.name}getLocale(){var e;return null!==(e=this.user.userPreferences.get().locale)&&void 0!==e?e:_d.locale}getColor(){var e;return null!==(e=this.user.userPreferences.get().color)&&void 0!==e?e:_d.color}getIsSnapMode(){var e;return null!==(e=this.user.userPreferences.get().isSnapMode)&&void 0!==e?e:_d.isSnapMode}getIsWrapMode(){var e;return null!==(e=this.user.userPreferences.get().isWrapMode)&&void 0!==e?e:_d.isWrapMode}getIsDynamicResizeMode(){var e;return null!==(e=this.user.userPreferences.get().isDynamicSizeMode)&&void 0!==e?e:_d.isDynamicSizeMode}getIsPasteAtCursorMode(){var e;return null!==(e=this.user.userPreferences.get().isPasteAtCursorMode)&&void 0!==e?e:_d.isPasteAtCursorMode}}im(Yg=(e=>{var t;return[,,,Gg(null!==(t=null===e||void 0===e?void 0:e[Zg("metadata")])&&void 0!==t?t:null)]})(null),1,"getUserPreferences",qg,hm),im(Yg,1,"getIsDarkMode",Wg,hm),im(Yg,1,"getEdgeScrollSpeed",Vg,hm),im(Yg,1,"getAnimationSpeed",Kg,hm),im(Yg,1,"getId",Hg,hm),im(Yg,1,"getName",Ug,hm),im(Yg,1,"getLocale",Bg,hm),im(Yg,1,"getColor",Fg,hm),im(Yg,1,"getIsSnapMode",Ng,hm),im(Yg,1,"getIsWrapMode",zg,hm),im(Yg,1,"getIsDynamicResizeMode",Lg,hm),im(Yg,1,"getIsPasteAtCursorMode",Rg,hm),rm(Yg,hm);const pm={wheel:"onWheel",pointer_down:"onPointerDown",pointer_move:"onPointerMove",long_press:"onLongPress",pointer_up:"onPointerUp",right_click:"onRightClick",middle_click:"onMiddleClick",key_down:"onKeyDown",key_up:"onKeyUp",key_repeat:"onKeyRepeat",cancel:"onCancel",complete:"onComplete",interrupt:"onInterrupt",double_click:"onDoubleClick",triple_click:"onTripleClick",quadruple_click:"onQuadrupleClick",tick:"onTick"},fm=["brushing","cropping","dragging","dragging_handle","drawing","erasing","lasering","resizing","rotating","scribble_brushing","translating"];class gm{constructor(e,t){s(this,"performanceTracker",void 0),s(this,"id",void 0),s(this,"type",void 0),s(this,"shapeType",void 0),s(this,"initial",void 0),s(this,"children",void 0),s(this,"isLockable",void 0),s(this,"parent",void 0),s(this,"_path",void 0),s(this,"_current",void 0),s(this,"_isActive",void 0),s(this,"_currentToolIdMask",Qt("curent tool id mask",void 0)),this.editor=e;const{id:n,children:o,initial:r,isLockable:i}=this.constructor;this.id=n,this._isActive=Qt("toolIsActive"+this.id,!1),this._current=Qt("toolState"+this.id,void 0),this._path=cn("toolPath"+this.id,(()=>{const e=this.getCurrent();return this.id+(e?".".concat(e.getPath()):"")})),this.parent=null!==t&&void 0!==t?t:{},this.parent?o&&r?(this.type="branch",this.initial=r,this.children=Object.fromEntries(o().map((e=>[e.id,new e(this.editor,this)]))),this._current.set(this.children[this.initial])):this.type="leaf":(this.type="root",o&&r&&(this.initial=r,this.children=Object.fromEntries(o().map((e=>[e.id,new e(this.editor,this)]))),this._current.set(this.children[this.initial]))),this.isLockable=i,this.performanceTracker=new k}getPath(){return this._path.get()}getCurrent(){return this._current.get()}getIsActive(){return this._isActive.get()}transition(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=e.split(".");let o=this;for(let i=0;i<n.length;i++){var r;const e=n[i],s=o.getCurrent(),a=null===(r=o.children)||void 0===r?void 0:r[e];if(!a)throw Error("".concat(o.id," - no child state exists with the id ").concat(e,"."));if((null===s||void 0===s?void 0:s.id)!==a.id&&(null===s||void 0===s||s.exit(t,e),o._current.set(a),a.enter(t,(null===s||void 0===s?void 0:s.id)||"initial"),!a.getIsActive()))break;o=a}return this}handleEvent(e){var t;const n=pm[e.name],o=this._current.__unsafe__getWithoutCapture();null===(t=this[n])||void 0===t||t.call(this,e),this._isActive.__unsafe__getWithoutCapture()&&o&&o===this._current.__unsafe__getWithoutCapture()&&o.handleEvent(e)}enter(e,t){var n;if(Ta.measurePerformance.get()&&fm.includes(this.id)&&this.performanceTracker.start(this.id),this._isActive.set(!0),null===(n=this.onEnter)||void 0===n||n.call(this,e,t),this.children&&this.initial&&this.getIsActive()){const n=this.children[this.initial];this._current.set(n),n.enter(e,t)}}exit(e,t){var n,o;(Ta.measurePerformance.get()&&this.performanceTracker.isStarted()&&this.performanceTracker.stop(),this._isActive.set(!1),null===(n=this.onExit)||void 0===n||n.call(this,e,t),this.getIsActive())||(null===(o=this.getCurrent())||void 0===o||o.exit(e,t))}getCurrentToolIdMask(){return this._currentToolIdMask.get()}setCurrentToolIdMask(e){this._currentToolIdMask.set(e)}}s(gm,"id",void 0),s(gm,"initial",void 0),s(gm,"children",void 0),s(gm,"isLockable",!0);class mm extends gm{static children(){return[]}onKeyDown(e){if("KeyZ"===e.code)if(!e.shiftKey&&!e.ctrlKey){var t;const n=this.getCurrent();n&&"idle"===(null===(t=n.getCurrent())||void 0===t?void 0:t.id)&&this.children.zoom&&this.editor.setCurrentTool("zoom",l(l({},e),{},{onInteractionEnd:n.id}))}}}s(mm,"id","root"),s(mm,"initial","");const ym=["animation"];var vm,bm,wm,xm,Sm,km,Pm,Cm,_m,Im,Em,jm,Tm,Mm,Am,Om,Dm,Rm,Lm,zm,Nm,Fm,Bm,Um,Hm,Km,Vm,Wm,qm,Ym,Gm,Xm,$m,Zm,Qm,Jm,ey,ty,ny,oy,ry,iy,sy,ay,ly,cy,dy,uy,hy,py,fy,gy,my,yy,vy,by,wy,xy,Sy,ky,Py,Cy,_y,Iy,Ey,jy,Ty,My,Ay,Oy,Dy,Ry,Ly,zy,Ny=Object.create,Fy=Object.defineProperty,By=Object.getOwnPropertyDescriptor,Uy=(e,t)=>(t=Symbol[e])?t:Symbol.for("Symbol."+e),Hy=e=>{throw TypeError(e)},Ky=(e,t,n)=>t in e?Fy(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Vy=(e,t)=>Fy(e,"name",{value:t,configurable:!0}),Wy=["class","method","getter","setter","accessor","field","value","get","set"],qy=e=>void 0!==e&&"function"!==typeof e?Hy("Function expected"):e,Yy=(e,t,n,o,r)=>({kind:Wy[e],name:t,metadata:o,addInitializer:e=>n._?Hy("Already initialized"):r.push(qy(e||null))}),Gy=(e,t)=>Ky(t,Uy("metadata"),e[3]),Xy=(e,t,n,o,r,i)=>{var s,a,l,c,d,u=7&t,h=!!(8&t),p=!!(16&t),f=u>3?e.length+1:u?h?1:2:0,g=Wy[u+5],m=u>3&&(e[f-1]=[]),y=e[f]||(e[f]=[]),v=u&&(!p&&!h&&(r=r.prototype),u<5&&(u>3||!p)&&By(u<4?r:{get[n](){return Jy(this,i)},set[n](e){return ev(this,i,e)}},n));u?p&&u<4&&Vy(i,(u>2?"set ":u>1?"get ":"")+n):Vy(r,n);for(var b=o.length-1;b>=0;b--)c=Yy(u,n,l={},e[3],y),u&&(c.static=h,c.private=p,d=c.access={has:p?e=>Qy(r,e):e=>n in e},3^u&&(d.get=p?e=>(1^u?Jy:tv)(e,r,4^u?i:v.get):e=>e[n]),u>2&&(d.set=p?(e,t)=>ev(e,r,t,4^u?i:v.set):(e,t)=>e[n]=t)),a=(0,o[b])(u?u<4?p?i:v[g]:u>4?void 0:{get:v.get,set:v.set}:r,c),l._=1,4^u||void 0===a?qy(a)&&(u>4?m.unshift(a):u?p?i=a:v[g]=a:r=a):"object"!==typeof a||null===a?Hy("Object expected"):(qy(s=a.get)&&(v.get=s),qy(s=a.set)&&(v.set=s),qy(s=a.init)&&m.unshift(s));return u||Gy(e,r),v&&Fy(r,n,v),p?4^u?i:v:r},$y=(e,t,n)=>Ky(e,"symbol"!==typeof t?t+"":t,n),Zy=(e,t,n)=>t.has(e)||Hy("Cannot "+n),Qy=(e,t)=>Object(t)!==t?Hy('Cannot use the "in" operator on this value'):e.has(t),Jy=(e,t,n)=>(Zy(e,t,"read from private field"),n?n.call(e):t.get(e)),ev=(e,t,n,o)=>(Zy(e,t,"write to private field"),o?o.call(e,n):t.set(e,n),n),tv=(e,t,n)=>(Zy(e,t,"access private method"),n);class nv extends(Ly=Ud,Ry=[cn],Dy=[cn],Oy=[cn],Ay=[cn],My=[cn],Ty=[cn],jy=[cn],Ey=[cn],Iy=[cn],_y=[cn],Cy=[cn],Py=[cn],ky=[cn],Sy=[cn],xy=[cn],wy=[cn],by=[cn],vy=[cn],yy=[cn],my=[cn],gy=[cn],fy=[cn],py=[cn],hy=[cn],uy=[cn],dy=[cn],cy=[cn],ly=[cn],ay=[cn],sy=[cn],iy=[cn],ry=[cn],oy=[cn],ny=[cn],ty=[cn],ey=[cn],Jm=[cn],Qm=[cn],Zm=[cn],$m=[cn],Xm=[cn],Gm=[cn],Ym=[cn],qm=[cn],Wm=[cn],Vm=[cn],Km=[cn],Hm=[cn],Um=[cn],Bm=[cn],Fm=[cn],Nm=[cn],zm=[cn],Lm=[cn],Rm=[cn],Dm=[cn],Om=[cn],Am=[cn],Mm=[cn],Tm=[cn],jm=[cn],Em=[cn],Im=[cn],_m=[cn],Cm=[cn({isEqual:(e,t)=>e.equals(t)})],Pm=[cn],km=[cn],Sm=[cn],xm=[R],wm=[R],bm=[R],vm=[R],Ly){constructor(e){var t;let{store:n,user:o,shapeUtils:r,bindingUtils:i,tools:a,getContainer:c,cameraOptions:d,initialState:u,autoFocus:h,inferDarkMode:p,options:f,isShapeHidden:g}=e;super(),((e,t,n,o)=>{for(var r=0,i=e[t>>1],s=i&&i.length;r<s;r++)1&t?i[r].call(n):o=i[r].call(n,o)})(zy,5,this),$y(this,"_isShapeHiddenPredicate"),$y(this,"options"),$y(this,"contextId",$()),$y(this,"store"),$y(this,"root"),$y(this,"disposables",new Set),$y(this,"isDisposed",!1),$y(this,"_tickManager"),$y(this,"snaps"),$y(this,"timers",Jh.forContext(this.contextId)),$y(this,"user"),$y(this,"textMeasure"),$y(this,"environment",ka),$y(this,"scribbles"),$y(this,"sideEffects"),$y(this,"edgeScrollManager"),$y(this,"focusManager"),$y(this,"getContainer"),$y(this,"shapeUtils"),$y(this,"styleProps"),$y(this,"bindingUtils"),$y(this,"history"),$y(this,"_shouldIgnoreShapeLock",!1),$y(this,"_crashingError",null),$y(this,"_isChangingStyleTimeout",-1),$y(this,"menus",Qh.forContext(this.contextId)),$y(this,"_cameraOptions",Qt("camera options",Pa)),$y(this,"_viewportAnimation",null),$y(this,"_willSetInitialBounds",!0),$y(this,"_isLockedOnFollowingUser",Qt("isLockedOnFollowingUser",!1)),$y(this,"_cameraState",Qt("camera state","idle")),$y(this,"_cameraStateTimeoutRemaining",0),$y(this,"_currentPageShapeIds"),$y(this,"_parentIdsToChildIds"),$y(this,"animatingShapes",new Map),$y(this,"externalAssetContentHandlers",{file:null,url:null}),$y(this,"temporaryAssetPreview",new Map),$y(this,"externalContentHandlers",{text:null,files:null,embed:null,"svg-text":null,url:null}),$y(this,"inputs",{originPagePoint:new Vs,originScreenPoint:new Vs,previousPagePoint:new Vs,previousScreenPoint:new Vs,currentPagePoint:new Vs,currentScreenPoint:new Vs,keys:new Set,buttons:new Set,isPen:!1,shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1,isDragging:!1,isPointing:!1,isPinching:!1,isEditing:!1,isPanning:!1,isSpacebarPanning:!1,pointerVelocity:new Vs}),$y(this,"_clickManager",new Op(this)),$y(this,"_prevCursor","default"),$y(this,"_shiftKeyTimeout",-1),$y(this,"_altKeyTimeout",-1),$y(this,"_ctrlKeyTimeout",-1),$y(this,"_metaKeyTimeout",-1),$y(this,"_restoreToolId","select"),$y(this,"_pinchStart",1),$y(this,"_didPinch",!1),$y(this,"_selectedShapeIdsAtPointerDown",[]),$y(this,"_longPressTimeout",-1),$y(this,"capturedPointerId",null),$y(this,"performanceTracker"),$y(this,"performanceTrackerTimeout",-1),$y(this,"_pendingEventsForNextTick",[]),this._isShapeHiddenPredicate=g,this.options=l(l({},ep),f),this.store=n,this.disposables.add(this.store.dispose.bind(this.store)),this.history=new Bp({store:n,annotateError:e=>{this.annotateError(e,{origin:"history.batch",willCrashApp:!0}),this.crash(e)}}),this.snaps=new sg(this),this.disposables.add(this.timers.dispose),this._cameraOptions.set(l(l({},Pa),d)),this.user=new hm(null!==o&&void 0!==o?o:Nd(),null!==p&&void 0!==p&&p),this.disposables.add((()=>this.user.dispose())),this.getContainer=c,this.textMeasure=new ug(this),this._tickManager=new Dg(this);class m extends mm{}s(m,"initial",null!==u&&void 0!==u?u:""),this.root=new m(this),this.root.children={};const y=Pu(r),v={},b={},w=new Map;for(const s of y){var x;const e=new s(this);v[s.type]=e;const t=Vo(null!==(x=s.props)&&void 0!==x?x:{});b[s.type]=t;for(const n of t.keys())if(w.has(n.id)){if(w.get(n.id)!==n)throw Error('Multiple style props with id "'.concat(n.id,'" in use. Style prop IDs must be unique.'))}else w.set(n.id,n)}this.shapeUtils=v,this.styleProps=b;const S=Jd(i),P={};for(const s of S){const e=new s(this);P[s.type]=e}this.bindingUtils=P;for(const s of[...a]){if(ue(this.root.children,s.id))throw Error("Can't override tool with id \"".concat(s.id,'"'));this.root.children[s.id]=new s(this,this.root)}this.scribbles=new Kp(this);const _=(e,t)=>{let n=null;const o=e.selectedShapeIds.filter((e=>!t.has(e)));o.length!==e.selectedShapeIds.length&&(n||(n=l({},e)),n.selectedShapeIds=o);const r=e.erasingShapeIds.filter((e=>!t.has(e)));r.length!==e.erasingShapeIds.length&&(n||(n=l({},e)),n.erasingShapeIds=r),e.hoveredShapeId&&t.has(e.hoveredShapeId)&&(n||(n=l({},e)),n.hoveredShapeId=null),e.editingShapeId&&t.has(e.editingShapeId)&&(n||(n=l({},e)),n.editingShapeId=null);const i=e.hintingShapeIds.filter((e=>!t.has(e)));return i.length!==e.hintingShapeIds.length&&(n||(n=l({},e)),n.hintingShapeIds=i),e.focusedGroupId&&t.has(e.focusedGroupId)&&(n||(n=l({},e)),n.focusedGroupId=null),n};this.sideEffects=this.store.sideEffects;let I=new Map;const E=new Set,j=new Set;let T=new Set;if(this.disposables.add(this.sideEffects.registerOperationCompleteHandler((()=>{E.clear();for(const r of j){var e;j.delete(r);const t=this.getShape(r);if(!t)continue;const n=this.getShapeUtil(t),o=null===(e=n.onChildrenChange)||void 0===e?void 0:e.call(n,t);null!==o&&void 0!==o&&o.length&&this.updateShapes(o)}if(T.size){const e=T;T=new Set;for(const n of e){var t;const e=this.getBindingUtil(n);null===(t=e.onOperationComplete)||void 0===t||t.call(e)}}if(I.size){const e=I;I=new Map;for(const t of e.values()){var n,o;null===(n=(o=this.getBindingUtil(t.binding)).onAfterDelete)||void 0===n||n.call(o,t)}}this.emit("update")}))),this.disposables.add(this.sideEffects.register({shape:{afterChange:(e,t)=>{for(const s of this.getBindingsInvolvingShape(t)){var n,o,r,i;if(T.add(s.type),s.fromId===t.id)null===(n=(o=this.getBindingUtil(s)).onAfterChangeFromShape)||void 0===n||n.call(o,{binding:s,shapeBefore:e,shapeAfter:t});if(s.toId===t.id)null===(r=(i=this.getBindingUtil(s)).onAfterChangeToShape)||void 0===r||r.call(i,{binding:s,shapeBefore:e,shapeAfter:t})}if(e.parentId!==t.parentId){const e=e=>{const t=this.getShape(e);if(t)for(const s of this.getBindingsInvolvingShape(t)){var n,o,r,i;if(T.add(s.type),s.fromId===t.id)null===(n=(o=this.getBindingUtil(s)).onAfterChangeFromShape)||void 0===n||n.call(o,{binding:s,shapeBefore:t,shapeAfter:t});if(s.toId===t.id)null===(r=(i=this.getBindingUtil(s)).onAfterChangeToShape)||void 0===r||r.call(i,{binding:s,shapeBefore:t,shapeAfter:t})}};e(t.id),this.visitDescendants(t.id,e)}if(e.parentId!==t.parentId&&Ir(t.parentId)){const n=new Set([e.id]);this.visitDescendants(e.id,(e=>{n.add(e)}));for(const e of this.getPageStates()){if(e.pageId===t.parentId)continue;const o=_(e,n);o&&this.store.put([o])}}e.parentId&&Ho(e.parentId)&&j.add(e.parentId),t.parentId!==e.parentId&&Ho(t.parentId)&&j.add(t.parentId)},beforeDelete:e=>{if(E.has(e.id))return;e.parentId&&Ho(e.parentId)&&j.add(e.parentId),E.add(e.id);const t=[];for(const l of this.getBindingsInvolvingShape(e)){T.add(l.type),t.push(l.id);const s=this.getBindingUtil(l);var n,o,r,i;if(l.fromId===e.id)null===(n=s.onBeforeIsolateToShape)||void 0===n||n.call(s,{binding:l,removedShape:e}),null===(o=s.onBeforeDeleteFromShape)||void 0===o||o.call(s,{binding:l,shape:e});else null===(r=s.onBeforeIsolateFromShape)||void 0===r||r.call(s,{binding:l,removedShape:e}),null===(i=s.onBeforeDeleteToShape)||void 0===i||i.call(s,{binding:l,shape:e})}t.length&&this.deleteBindings(t);const s=new Set([e.id]),a=C(this.getPageStates().map((e=>_(e,s))));a.length&&this.store.put(a)}},binding:{beforeCreate:e=>{var t,n;const o=null===(t=(n=this.getBindingUtil(e)).onBeforeCreate)||void 0===t?void 0:t.call(n,{binding:e});return o||e},afterCreate:e=>{var t,n;T.add(e.type),null===(t=(n=this.getBindingUtil(e)).onAfterCreate)||void 0===t||t.call(n,{binding:e})},beforeChange:(e,t)=>{var n,o;const r=null===(n=(o=this.getBindingUtil(t)).onBeforeChange)||void 0===n?void 0:n.call(o,{bindingBefore:e,bindingAfter:t});return r||t},afterChange:(e,t)=>{var n,o;T.add(t.type),null===(n=(o=this.getBindingUtil(t)).onAfterChange)||void 0===n||n.call(o,{bindingBefore:e,bindingAfter:t})},beforeDelete:e=>{var t,n;null===(t=(n=this.getBindingUtil(e)).onBeforeDelete)||void 0===t||t.call(n,{binding:e})},afterDelete:e=>{var t,n;null===(t=(n=this.getBindingUtil(e)).onAfterDelete)||void 0===t||t.call(n,{binding:e}),T.add(e.type)}},page:{afterCreate:e=>{const t=mr.createId(e.id),n=Xr.createId(e.id);this.store.has(t)||this.store.put([mr.create({id:t})]),this.store.has(n)||this.store.put([Xr.create({id:n,pageId:e.id})])},afterDelete:(e,t)=>{var n;if((null===(n=this.getInstanceState())||void 0===n?void 0:n.currentPageId)===e.id){var o;const n=null===(o=this.getPages().find((t=>t.id!==e.id)))||void 0===o?void 0:o.id;n?this.store.put([l(l({},this.getInstanceState()),{},{currentPageId:n})]):"user"===t&&this.store.ensureStoreIsUsable()}const r=mr.createId(e.id),i=Xr.createId(e.id);this.store.remove([r,i])}},instance:{afterChange:(e,t,n)=>{if(!this.store.has(t.currentPageId)){var o;const r=this.store.has(e.currentPageId)?e.currentPageId:null===(o=this.getPages()[0])||void 0===o?void 0:o.id;r?this.store.update(t.id,(e=>l(l({},e),{},{currentPageId:r}))):"user"===n&&this.store.ensureStoreIsUsable()}}},instance_page_state:{afterChange:(e,t)=>{if((null===e||void 0===e?void 0:e.selectedShapeIds)!==(null===t||void 0===t?void 0:t.selectedShapeIds)){const e=t.selectedShapeIds.filter((e=>{var n;let o=null===(n=this.getShape(e))||void 0===n?void 0:n.parentId;for(;Ho(o);){var r;if(t.selectedShapeIds.includes(o))return!1;o=null===(r=this.getShape(o))||void 0===r?void 0:r.parentId}return!0}));let o=null;if(e.length>0){const t=this.findCommonAncestor(C(e.map((e=>this.getShape(e)))),(e=>this.isShapeOfType(e,"group")));t&&(o=t)}else null!==t&&void 0!==t&&t.focusedGroupId&&(o=t.focusedGroupId);var n;if(e.length!==t.selectedShapeIds.length||o!==t.focusedGroupId)this.store.put([l(l({},t),{},{selectedShapeIds:e,focusedGroupId:null!==(n=o)&&void 0!==n?n:null})])}}}})),this._currentPageShapeIds=((e,t)=>{const n=e.query.ids("shape");let o=null;function r(){const r=t();return o=r,new Set([...n.get()].filter((t=>up(e,r,e.get(t)))))}return cn("_shapeIdsInCurrentPage",((n,i)=>{if(tn(n))return r();const s=t();if(s!==o)return r();const a=e.history.getDiffSince(i);if(a===Mt)return r();const l=new vn(n);for(const t of a){for(const n of Object.values(t.added))Uo(n)&&up(e,s,n)&&l.add(n.id);for(const[n,o]of Object.values(t.updated))Uo(o)&&(up(e,s,o)?l.add(o.id):l.remove(o.id));for(const e of Object.keys(t.removed))Ho(e)&&l.remove(e)}const c=l.get();return c?on(c.value,c.diff):n}))})(this.store,(()=>this.getCurrentPageId())),this._parentIdsToChildIds=(e=>{const t=e.query.ids("shape"),n=e.query.filterHistory("shape");function o(){const n={},o=t.get(),r=Array(o.size);return o.forEach((t=>r.push(e.get(t)))),r.sort(Je),r.forEach((e=>{n[e.parentId]||(n[e.parentId]=[]),n[e.parentId].push(e.id)})),n}return cn("parentsToChildrenWithIndexes",((t,r)=>{var i;if(tn(t))return o();const s=n.getDiffSince(r);if(s===Mt)return o();if(0===s.length)return t;let a=null;const c=e=>{a||(a=l({},t)),a[e]?a[e]===t[e]&&(a[e]=[...a[e]]):a[e]=[]},d=new Set;let u;for(let e=0,n=s.length;e<n;e++){u=s[e];for(const e of Object.values(u.added))Uo(e)&&(c(e.parentId),a[e.parentId].push(e.id),d.add(a[e.parentId]));for(const[e,t]of Object.values(u.updated))if(Uo(t)&&Uo(e))if(e.parentId!==t.parentId)c(e.parentId),c(t.parentId),a[e.parentId].splice(a[e.parentId].indexOf(t.id),1),a[t.parentId].push(t.id),d.add(a[t.parentId]);else if(e.index!==t.index){c(t.parentId);const e=a[t.parentId].indexOf(t.id);a[t.parentId][e]=t.id,d.add(a[t.parentId])}for(const e of Object.values(u.removed))Uo(e)&&(c(e.parentId),a[e.parentId].splice(a[e.parentId].indexOf(e.id),1))}for(const n of d){const t=C(n.map((t=>e.get(t))));t.sort(Je),n.splice(0,n.length,...t.map((e=>e.id)))}return null!==(i=a)&&void 0!==i?i:t}))})(this.store),this.disposables.add(this.store.listen((e=>{this.emit("change",e)}))),this.disposables.add(this.history.dispose),this.run((()=>{this.store.ensureStoreIsUsable(),this._updateCurrentPageState({editingShapeId:null,hoveredShapeId:null,erasingShapeIds:[]})}),{history:"ignore"}),u&&void 0===this.root.children[u])throw Error('No state found for initialState "'.concat(u,'".'));if(this.root.enter(void 0,"initial"),this.edgeScrollManager=new Dp(this),this.focusManager=new Rp(this,h),this.disposables.add(this.focusManager.dispose.bind(this.focusManager)),this.getInstanceState().followingUserId&&this.stopFollowingUser(),this.on("tick",this._flushEventsForTick),this.timers.requestAnimationFrame((()=>{this._tickManager.start()})),this.performanceTracker=new k,null!==(t=this.store.props.collaboration)&&void 0!==t&&t.mode){const e=this.store.props.collaboration.mode;this.disposables.add(Ht("update collaboration mode",(()=>{this.store.put([l(l({},this.getInstanceState()),{},{isReadonly:"readonly"===e.get()})])})))}}getIsShapeHiddenCache(){return this._isShapeHiddenPredicate?this.store.createComputedCache("isShapeHidden",(e=>{var t;return!!this.findShapeAncestor(e,(e=>this.isShapeHidden(e)))||null!==(t=this._isShapeHiddenPredicate(e,this))&&void 0!==t&&t})):null}isShapeHidden(e){return!!this._isShapeHiddenPredicate&&!!this.getIsShapeHiddenCache().get("string"===typeof e?e:e.id)}dispose(){this.disposables.forEach((e=>e())),this.disposables.clear(),this.isDisposed=!0}getShapeUtil(e){const t="string"===typeof e?e:e.type,n=he(this.shapeUtils,t);return M(n,'No shape util found for type "'.concat(t,'"')),n}getBindingUtil(e){const t="string"===typeof e?e:e.type,n=he(this.bindingUtils,t);return M(n,'No binding util found for type "'.concat(t,'"')),n}undo(){return this._flushEventsForTick(0),this.complete(),this.history.undo(),this}getCanUndo(){return this.history.getNumUndos()>0}redo(){return this._flushEventsForTick(0),this.complete(),this.history.redo(),this}clearHistory(){return this.history.clear(),this}getCanRedo(){return this.history.getNumRedos()>0}mark(e){return"string"===typeof e?console.warn('[tldraw] `editor.history.mark("'.concat(e,'")` is deprecated. Please use `const myMarkId = editor.markHistoryStoppingPoint()` instead.')):console.warn("[tldraw] `editor.mark()` is deprecated. Use `editor.markHistoryStoppingPoint()` instead."),this.history._mark(null!==e&&void 0!==e?e:$()),this}markHistoryStoppingPoint(e){const t="[".concat(null!==e&&void 0!==e?e:"stop","]_").concat($());return this.history._mark(t),t}getMarkIdMatching(e){return this.history.getMarkIdMatching(e)}squashToMark(e){return this.history.squashToMark(e),this}bail(){return this.history.bail(),this}bailToMark(e){return this.history.bailToMark(e),this}run(e,t){var n;const o=this._shouldIgnoreShapeLock;this._shouldIgnoreShapeLock=null!==(n=null===t||void 0===t?void 0:t.ignoreShapeLock)&&void 0!==n?n:o;try{this.history.batch(e,t)}finally{this._shouldIgnoreShapeLock=o}return this}batch(e,t){return this.run(e,t)}annotateError(e,t){let{origin:n,willCrashApp:o,tags:r,extras:i}=t;const s=this.createErrorAnnotations(n,o);return F(e,{tags:l(l({},s.tags),r),extras:l(l({},s.extras),i)}),o&&this.store.markAsPossiblyCorrupted(),this}createErrorAnnotations(e,t){try{const n=this.getEditingShapeId();return{tags:{origin:e,willCrashApp:t},extras:{activeStateNode:this.root.getPath(),selectedShapes:this.getSelectedShapes(),editingShape:n?this.getShape(n):void 0,inputs:this.inputs}}}catch(n){return{tags:{origin:e,willCrashApp:t},extras:{}}}}getCrashingError(){return this._crashingError}crash(e){return this._crashingError=e,this.store.markAsPossiblyCorrupted(),this.emit("crash",{error:e}),this}getPath(){return this.root.getPath().split("root.")[1]}isIn(e){const t=e.split(".").reverse();let n=this.root;for(;t.length>0;){const e=t.pop();if(!e)return!0;const o=n.getCurrent();if((null===o||void 0===o?void 0:o.id)!==e)return!1;if(0===t.length)return!0;n=o}return!1}isInAny(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.some((e=>this.isIn(e)))}setCurrentTool(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.root.transition(e,t),this}getCurrentTool(){return this.root.getCurrent()}getCurrentToolId(){var e;const t=this.getCurrentTool();return t?null!==(e=t.getCurrentToolIdMask())&&void 0!==e?e:t.id:""}getStateDescendant(e){const t=e.split(".").reverse();let n=this.root;for(;t.length>0;){var o;const e=t.pop();if(!e)return n;const r=null===(o=n.children)||void 0===o?void 0:o[e];if(!r)return;n=r}return n}getDocumentSettings(){return this.store.get(li)}updateDocumentSettings(e){return this.run((()=>{this.store.put([l(l({},this.getDocumentSettings()),e)])}),{history:"ignore"}),this}getInstanceState(){return this.store.get(Wr)}updateInstanceState(e,t){return this._updateInstanceState(e,l({history:"ignore"},t)),void 0!==e.isChangingStyle&&(clearTimeout(this._isChangingStyleTimeout),!0===e.isChangingStyle&&(this._isChangingStyleTimeout=this.timers.setTimeout((()=>{this._updateInstanceState({isChangingStyle:!1},{history:"ignore"})}),2e3))),this}_updateInstanceState(e,t){this.run((()=>{this.store.put([l(l({},this.getInstanceState()),e)])}),t)}getOpenMenus(){return this.menus.getOpenMenus()}addOpenMenu(e){return this.menus.addOpenMenu(e),this}deleteOpenMenu(e){return this.menus.deleteOpenMenu(e),this}clearOpenMenus(){return this.menus.clearOpenMenus(),this}getIsMenuOpen(){return this.menus.hasAnyOpenMenus()}setCursor(e){return this.updateInstanceState({cursor:l(l({},this.getInstanceState().cursor),e)}),this}getPageStates(){return this._getPageStatesQuery().get()}_getPageStatesQuery(){return this.store.query.records("instance_page_state")}getCurrentPageState(){return this.store.get(this._getCurrentPageStateId())}_getCurrentPageStateId(){return Xr.createId(this.getCurrentPageId())}updateCurrentPageState(e){return this._updateCurrentPageState(e),this}_updateCurrentPageState(e){var t;this.store.update(null!==(t=e.id)&&void 0!==t?t:this.getCurrentPageState().id,(t=>l(l({},t),e)))}getSelectedShapeIds(){return this.getCurrentPageState().selectedShapeIds}getSelectedShapes(){const{selectedShapeIds:e}=this.getCurrentPageState();return C(e.map((e=>this.store.get(e))))}setSelectedShapes(e){return this.run((()=>{const t=e.map((e=>"string"===typeof e?e:e.id)),{selectedShapeIds:n}=this.getCurrentPageState(),o=new Set(n);if(t.length===o.size&&t.every((e=>o.has(e))))return null;this.store.put([l(l({},this.getCurrentPageState()),{},{selectedShapeIds:t})])}),{history:"record-preserveRedoStack"})}isAncestorSelected(e){var t;const n="string"===typeof e?e:null!==(t=null===e||void 0===e?void 0:e.id)&&void 0!==t?t:null,o=this.getShape(n);if(!o)return!1;const r=this.getSelectedShapeIds();return!!this.findShapeAncestor(o,(e=>r.includes(e.id)))}select(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const o="string"===typeof t[0]?t:t.map((e=>e.id));return this.setSelectedShapes(o),this}deselect(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const o="string"===typeof t[0]?t:t.map((e=>e.id)),r=this.getSelectedShapeIds();return r.length>0&&o.length>0&&this.setSelectedShapes(r.filter((e=>!o.includes(e)))),this}selectAll(){const e=this.getSortedChildIdsForParent(this.getCurrentPageId());return e.length<=0||this.setSelectedShapes(this._getUnlockedShapeIds(e)),this}selectNone(){return this.getSelectedShapeIds().length>0&&this.setSelectedShapes([]),this}getOnlySelectedShapeId(){var e,t;return null!==(e=null===(t=this.getOnlySelectedShape())||void 0===t?void 0:t.id)&&void 0!==e?e:null}getOnlySelectedShape(){const e=this.getSelectedShapes();return 1===e.length?e[0]:null}getShapesPageBounds(e){const t=C(e.map((e=>this.getShapePageBounds(e))));return 0===t.length?null:rc.Common(t)}getSelectionPageBounds(){return this.getShapesPageBounds(this.getSelectedShapeIds())}getShapesSharedRotation(e){let t=!1,n=0;for(let o=0,r=e.length;o<r;o++){const r=this.getShapePageTransform(e[o]);if(r)if(t){if(r.rotation()!==n)return 0}else t=!0,n=r.rotation()}return n}getSelectionRotation(){return this.getShapesSharedRotation(this.getSelectedShapeIds())}getShapesRotatedPageBounds(e){if(0===e.length)return;const t=this.getShapesSharedRotation(e);var n;if(0===t)return null!==(n=this.getShapesPageBounds(e))&&void 0!==n?n:void 0;if(1===e.length){const t=this.getShapeGeometry(e[0]).bounds.clone(),n=this.getShapePageTransform(e[0]);return t.point=n.applyToPoint(t.point),t}const o=rc.FromPoints(e.flatMap((e=>{const t=this.getShapePageTransform(e);return t?t.applyToPoints(this.getShapeGeometry(e).bounds.corners):[]})).map((e=>e.rot(-t))));return o.point=o.point.rot(t),o}getSelectionRotatedPageBounds(){return this.getShapesRotatedPageBounds(this.getSelectedShapeIds())}getSelectionRotatedScreenBounds(){const e=this.getSelectionRotatedPageBounds();if(!e)return;const{x:t,y:n}=this.pageToScreen(e.point),o=this.getZoomLevel();return new rc(t,n,e.width*o,e.height*o)}getFocusedGroupId(){var e;return null!==(e=this.getCurrentPageState().focusedGroupId)&&void 0!==e?e:this.getCurrentPageId()}getFocusedGroup(){const e=this.getFocusedGroupId();return e?this.getShape(e):void 0}setFocusedGroup(e){var t;const n="string"===typeof e?e:null!==(t=null===e||void 0===e?void 0:e.id)&&void 0!==t?t:null;if(null!==n){const e=this.getShape(n);if(!e)throw Error("Editor.setFocusedGroup: Shape with id ".concat(n," does not exist"));if(!this.isShapeOfType(e,"group"))throw Error("Editor.setFocusedGroup: Cannot set focused group to shape of type ".concat(e.type))}return n===this.getFocusedGroupId()?this:this.run((()=>{this.store.update(this.getCurrentPageState().id,(e=>l(l({},e),{},{focusedGroupId:n})))}),{history:"record-preserveRedoStack"})}popFocusedGroupId(){const e=this.getFocusedGroup();if(e){var t;const n=this.findShapeAncestor(e,(e=>this.isShapeOfType(e,"group")));this.setFocusedGroup(null!==(t=null===n||void 0===n?void 0:n.id)&&void 0!==t?t:null),this.select(e.id)}else this.setFocusedGroup(null),this.selectNone();return this}getEditingShapeId(){return this.getCurrentPageState().editingShapeId}getEditingShape(){const e=this.getEditingShapeId();return e?this.getShape(e):void 0}setEditingShape(e){var t;const n="string"===typeof e?e:null!==(t=null===e||void 0===e?void 0:e.id)&&void 0!==t?t:null;if(n!==this.getEditingShapeId()){if(n){const e=this.getShape(n);if(e&&this.getShapeUtil(e).canEdit(e))return this.run((()=>{this._updateCurrentPageState({editingShapeId:n})}),{history:"ignore"}),this}this.run((()=>{this._updateCurrentPageState({editingShapeId:null})}),{history:"ignore"})}return this}getHoveredShapeId(){return this.getCurrentPageState().hoveredShapeId}getHoveredShape(){const e=this.getHoveredShapeId();return e?this.getShape(e):void 0}setHoveredShape(e){var t;const n="string"===typeof e?e:null!==(t=null===e||void 0===e?void 0:e.id)&&void 0!==t?t:null;return n===this.getHoveredShapeId()||this.run((()=>{this.updateCurrentPageState({hoveredShapeId:n})}),{history:"ignore"}),this}getHintingShapeIds(){return this.getCurrentPageState().hintingShapeIds}getHintingShape(){return C(this.getHintingShapeIds().map((e=>this.getShape(e))))}setHintingShapes(e){const t="string"===typeof e[0]?e:e.map((e=>e.id));return this.run((()=>{this._updateCurrentPageState({hintingShapeIds:P(t)})}),{history:"ignore"}),this}getErasingShapeIds(){return this.getCurrentPageState().erasingShapeIds}getErasingShapes(){return C(this.getErasingShapeIds().map((e=>this.getShape(e))))}setErasingShapes(e){const t="string"===typeof e[0]?e:e.map((e=>e.id));t.sort();const n=this.getErasingShapeIds();return this.run((()=>{if(t.length===n.length){for(let e=0;e<t.length;e++)if(t[e]!==n[e]){this._updateCurrentPageState({erasingShapeIds:t});break}}else this._updateCurrentPageState({erasingShapeIds:t})}),{history:"ignore"}),this}getCroppingShapeId(){return this.getCurrentPageState().croppingShapeId}setCroppingShape(e){var t;const n="string"===typeof e?e:null!==(t=null===e||void 0===e?void 0:e.id)&&void 0!==t?t:null;return n!==this.getCroppingShapeId()&&this.run((()=>{if(n){const e=this.getShape(n),t=this.getShapeUtil(e);e&&t.canCrop(e)&&this.updateCurrentPageState({croppingShapeId:n})}else this.updateCurrentPageState({croppingShapeId:null})}),{history:"ignore"}),this}_unsafe_getCameraId(){return mr.createId(this.getCurrentPageId())}getCamera(){const e=this.store.get(this._unsafe_getCameraId());if(this._isLockedOnFollowingUser.get()){const t=this.getCameraForFollowing();if(t)return l(l({},e),t)}return e}getViewportPageBoundsForFollowing(){const e=this.getInstanceState().followingUserId;if(!e)return null;const t=this.getCollaborators().find((t=>t.userId===e));if(!t)return null;const{w:n,h:o}=t.screenBounds,{x:r,y:i,z:s}=t.camera,a=new rc(-r,-i,n/s,o/s),l=this.getViewportScreenBounds().clone(),c=l.width/l.height;return l.width=a.width,l.height=l.width/c,l.height<a.height&&(l.height=a.height,l.width=l.height*c),l.center=a.center,l}getCameraForFollowing(){const e=this.getViewportPageBoundsForFollowing();return e?{x:-e.x,y:-e.y,z:this.getViewportScreenBounds().w/e.width}:null}getZoomLevel(){return this.getCamera().z}getInitialZoom(){const e=this.getCameraOptions();if(!e.constraints)return 1;if("default"===e.constraints.initialZoom)return 1;const{zx:t,zy:n}=av(this,e);switch(e.constraints.initialZoom){case"fit-min":return Math.max(t,n);case"fit-max":return Math.min(t,n);case"fit-x":return t;case"fit-y":return n;case"fit-min-100":return Math.min(1,Math.max(t,n));case"fit-max-100":return Math.min(1,Math.min(t,n));case"fit-x-100":return Math.min(1,t);case"fit-y-100":return Math.min(1,n);default:throw T(e.constraints.initialZoom)}}getBaseZoom(){const e=this.getCameraOptions();if(!e.constraints)return 1;if("default"===e.constraints.baseZoom)return 1;const{zx:t,zy:n}=av(this,e);switch(e.constraints.baseZoom){case"fit-min":return Math.max(t,n);case"fit-max":return Math.min(t,n);case"fit-x":return t;case"fit-y":return n;case"fit-min-100":return Math.min(1,Math.max(t,n));case"fit-max-100":return Math.min(1,Math.min(t,n));case"fit-x-100":return Math.min(1,t);case"fit-y-100":return Math.min(1,n);default:throw T(e.constraints.baseZoom)}}getCameraOptions(){return this._cameraOptions.get()}setCameraOptions(e){var t;const n=bt(l(l({},this._cameraOptions.__unsafe__getWithoutCapture()),e));return(null===(t=n.zoomSteps)||void 0===t?void 0:t.length)<1&&(n.zoomSteps=[1]),this._cameraOptions.set(n),this.setCamera(this.getCamera()),this}getConstrainedCamera(e,t){const n=this.getCamera();let{x:o,y:r,z:i=n.z}=e;if(null===t||void 0===t||!t.force){const e=this.getCameraOptions(),s=e.zoomSteps[0],a=_(e.zoomSteps),l=this.getViewportScreenBounds();if(e.constraints){const{constraints:c}=e,d=Math.min(c.padding.y,l.w/2),u=Math.min(c.padding.x,l.h/2),h=rc.From(e.constraints.bounds),p=(l.w-2*u)/h.w,f=(l.h-2*d)/h.h,g=this.getBaseZoom(),m=a*g,y=s*g;if(null!==t&&void 0!==t&&t.reset&&(i=this.getInitialZoom()),i<y||i>m){const{x:e,y:t,z:s}=n,a=-e+l.w/s/2,c=-t+l.h/s/2;i=Qs(i,y,m);o=e+(-e+l.w/i/2)-a,r=t+(-t+l.h/i/2)-c}const v=u/i-h.x,b=d/i-h.y,w=(l.w-2*u)/i-h.w,x=(l.h-2*d)/i-h.h,S=v+w*c.origin.x,k=b+x*c.origin.y,P="string"===typeof c.behavior?c.behavior:c.behavior.x,C="string"===typeof c.behavior?c.behavior:c.behavior.y;if(null!==t&&void 0!==t&&t.reset)o=S,r=k;else{switch(P){case"fixed":o=S;break;case"contain":o=i<p?S:Qs(o,v+w,v);break;case"inside":o=i<p?Qs(o,v,(l.w-u)/i-h.w):Qs(o,v+w,v);break;case"outside":o=Qs(o,u/i-h.w,(l.w-u)/i);break;case"free":break;default:throw T(P)}switch(C){case"fixed":r=k;break;case"contain":r=i<f?k:Qs(r,b+x,b);break;case"inside":r=i<f?Qs(r,b,(l.h-d)/i-h.h):Qs(r,b+x,b);break;case"outside":r=Qs(r,d/i-h.h,(l.h-d)/i);break;case"free":break;default:throw T(C)}}}else if(i>a||i<s){const{x:e,y:t,z:c}=n;i=Qs(i,s,a),o=e+(-e+l.w/i/2)-(-e+l.w/c/2),r=t+(-t+l.h/i/2)-(-t+l.h/c/2)}}return{x:o,y:r,z:i}}_setCamera(e,t){const n=this.getCamera(),{x:o,y:r,z:i}=this.getConstrainedCamera(e,t);return n.x===o&&n.y===r&&n.z===i||Xt((()=>{const e=l(l({},n),{},{x:o,y:r,z:i});this.run((()=>{this.store.put([e])}),{history:"ignore"});const{currentScreenPoint:s,currentPagePoint:a}=this.inputs,{screenBounds:c}=this.store.unsafeGetWithoutCapture(Wr);if(s.x/i-o!==a.x||s.y/i-r!==a.y){var d;const e={type:"pointer",target:"canvas",name:"pointer_move",point:Vs.AddXY(s,c.x,c.y),pointerId:_a,ctrlKey:this.inputs.ctrlKey,altKey:this.inputs.altKey,shiftKey:this.inputs.shiftKey,metaKey:this.inputs.metaKey,accelKey:Fa(this.inputs),button:0,isPen:null!==(d=this.getInstanceState().isPenMode)&&void 0!==d&&d};null!==t&&void 0!==t&&t.immediate?this._flushEventForTick(e):this.dispatch(e)}this._tickCameraState()})),this}setCamera(e,t){const{isLocked:n}=this._cameraOptions.__unsafe__getWithoutCapture();if(n&&(null===t||void 0===t||!t.force))return this;this.stopCameraAnimation(),this.getInstanceState().followingUserId&&this.stopFollowingUser();const o=Vs.Cast(e);Number.isFinite(o.x)||(o.x=0),Number.isFinite(o.y)||(o.y=0),void 0!==o.z&&Number.isFinite(o.z)||(e.z=this.getZoomLevel());const r=this.getConstrainedCamera(o,t);if(null!==t&&void 0!==t&&t.animation){const{width:e,height:n}=this.getViewportScreenBounds();this._animateToViewport(new rc(-r.x,-r.y,e/r.z,n/r.z),t)}else this._setCamera(r,l(l({},t),{},{force:!0}));return this}centerOnPoint(e,t){const{isLocked:n}=this.getCameraOptions();if(n&&(null===t||void 0===t||!t.force))return this;const{width:o,height:r}=this.getViewportPageBounds();return this.setCamera(new Vs(-(e.x-o/2),-(e.y-r/2),this.getCamera().z),t),this}zoomToFit(e){const t=[...this.getCurrentPageShapeIds()];if(t.length<=0)return this;const n=rc.Common(C(t.map((e=>this.getShapePageBounds(e)))));return this.zoomToBounds(n,e),this}resetZoom(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getViewportScreenCenter(),t=arguments.length>1?arguments[1]:void 0;const{isLocked:n,constraints:o}=this.getCameraOptions();if(n&&(null===t||void 0===t||!t.force))return this;const r=this.getCamera(),{x:i,y:s,z:a}=r,{x:l,y:c}=e;let d=1;if(o){const e=this.getInitialZoom();a!==e&&(d=e)}return this.setCamera(new Vs(i+(l/d-l)-(l/a-l),s+(c/d-c)-(c/a-c),d),t),this}zoomIn(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getViewportScreenCenter(),t=arguments.length>1?arguments[1]:void 0;const{isLocked:n}=this.getCameraOptions();if(n&&(null===t||void 0===t||!t.force))return this;const{x:o,y:r,z:i}=this.getCamera(),{zoomSteps:s}=this.getCameraOptions();if(null!==s&&s.length>1){const n=this.getBaseZoom();let a=_(s)*n;for(let e=1;e<s.length;e++){const t=s[e-1]*n,o=s[e]*n;if(!(o-i<=(o-t)/2)){a=o;break}}this.setCamera(new Vs(o+(e.x/a-e.x)-(e.x/i-e.x),r+(e.y/a-e.y)-(e.y/i-e.y),a),t)}return this}zoomOut(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getViewportScreenCenter(),t=arguments.length>1?arguments[1]:void 0;const{isLocked:n}=this.getCameraOptions();if(n&&(null===t||void 0===t||!t.force))return this;const{zoomSteps:o}=this.getCameraOptions();if(null!==o&&o.length>1){const n=this.getBaseZoom(),{x:r,y:i,z:s}=this.getCamera();let a=o[0]*n;for(let e=o.length-1;e>0;e--){const t=o[e-1]*n,r=o[e]*n;if(!(r-s>=(r-t)/2)){a=t;break}}this.setCamera(new Vs(r+(e.x/a-e.x)-(e.x/s-e.x),i+(e.y/a-e.y)-(e.y/s-e.y),a),t)}return this}zoomToSelection(e){const{isLocked:t}=this.getCameraOptions();if(t&&(null===e||void 0===e||!e.force))return this;const n=this.getSelectionPageBounds();return n&&this.zoomToBounds(n,l({targetZoom:Math.max(1,this.getZoomLevel())},e)),this}zoomToBounds(e,t){var n;const o=this._cameraOptions.__unsafe__getWithoutCapture();if(o.isLocked&&(null===t||void 0===t||!t.force))return this;const r=this.getViewportScreenBounds(),i=null!==(n=null===t||void 0===t?void 0:t.inset)&&void 0!==n?n:Math.min(128,.28*r.width),s=this.getBaseZoom(),a=o.zoomSteps[0],l=_(o.zoomSteps);let c=Qs(Math.min((r.width-i)/e.w,(r.height-i)/e.h),a*s,l*s);return void 0!==(null===t||void 0===t?void 0:t.targetZoom)&&(c=Math.min(t.targetZoom,c)),this.setCamera(new Vs(-e.x+(r.width-e.w*c)/2/c,-e.y+(r.height-e.h*c)/2/c,c),t),this}stopCameraAnimation(){return this.emit("stop-camera-animation"),this}_animateViewport(e){if(!this._viewportAnimation)return;this._viewportAnimation.elapsed+=e;const{elapsed:t,easing:n,duration:o,start:r,end:i}=this._viewportAnimation;if(t>o)return this.off("tick",this._animateViewport),this._viewportAnimation=null,void this._setCamera(new Vs(-i.x,-i.y,this.getViewportScreenBounds().width/i.width));const s=n(1-(o-t)/o),a=r.minX+(i.minX-r.minX)*s,l=r.minY+(i.minY-r.minY)*s,c=r.maxX+(i.maxX-r.maxX)*s;this._setCamera(new Vs(-a,-l,this.getViewportScreenBounds().width/(c-a)),{force:!0})}_animateToViewport(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{animation:Ca};const{animation:n}=t,o=yr(t,ym);if(!n)return;const{duration:r=0,easing:i=Ks.easeInOutCubic}=n,s=this.user.getAnimationSpeed(),a=this.getViewportPageBounds();return this.stopCameraAnimation(),this.getInstanceState().followingUserId&&this.stopFollowingUser(),0===r||0===s?this._setCamera(new Vs(-e.x,-e.y,this.getViewportScreenBounds().width/e.width),l({},o)):(this._viewportAnimation={elapsed:0,duration:r/s,easing:i,start:a.clone(),end:e.clone()},this.once("stop-camera-animation",(()=>{this.off("tick",this._animateViewport),this._viewportAnimation=null})),this.on("tick",this._animateViewport),this)}slideCamera(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{isLocked:t}=this.getCameraOptions();if(t&&(null===e||void 0===e||!e.force))return this;if(0===this.user.getAnimationSpeed())return this;this.stopCameraAnimation();const{speed:n,friction:o=this.options.cameraSlideFriction,direction:r,speedThreshold:i=.01}=e;let s=Math.min(n,1);const a=()=>{this.off("tick",l),this.off("stop-camera-animation",a)};this.once("stop-camera-animation",a);const l=e=>{const{x:t,y:n,z:l}=this.getCamera(),c=Vs.Mul(r,s*e/l);s*=1-o,s<i?a():this._setCamera(new Vs(t+c.x,n+c.y,l))};return this.on("tick",l),this}zoomToUser(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{animation:{duration:500}};const n=this.getCollaborators().find((t=>t.userId===e));return n?(this.run((()=>{null!==this.getInstanceState().followingUserId&&this.stopFollowingUser();const o=n.currentPageId===this.getCurrentPageId();o||this.setCurrentPage(n.currentPageId),t&&t.animation&&!o&&(t.animation=void 0),this.centerOnPoint(n.cursor,t);const{highlightedUserIds:r}=this.getInstanceState();this.updateInstanceState({highlightedUserIds:[...r,e]}),this.timers.setTimeout((()=>{const t=[...this.getInstanceState().highlightedUserIds],n=t.indexOf(e);n<0||(t.splice(n,1),this.updateInstanceState({highlightedUserIds:t}))}),this.options.collaboratorIdleTimeoutMs)})),this):this}updateViewportScreenBounds(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e instanceof HTMLElement){const t=e.getBoundingClientRect();e=new rc(t.left||t.x,t.top||t.y,Math.max(t.width,1),Math.max(t.height,1))}else e.width=Math.max(e.width,1),e.height=Math.max(e.height,1);const n=[0!==e.minY,!ea(document.body.scrollWidth,e.maxX,1),!ea(document.body.scrollHeight,e.maxY,1),0!==e.minX],{_willSetInitialBounds:o}=this;this._willSetInitialBounds=!1;const{screenBounds:r,insets:i}=this.getInstanceState();if(e.equals(r)&&n.every(((e,t)=>e===i[t])))return this;if(o)this.updateInstanceState({screenBounds:e.toJson(),insets:n}),this.setCamera(this.getCamera());else if(t&&!this.getInstanceState().followingUserId){const t=this.getViewportPageBounds().center;this.updateInstanceState({screenBounds:e.toJson(),insets:n}),this.centerOnPoint(t)}else this.updateInstanceState({screenBounds:e.toJson(),insets:n}),this._setCamera(Vs.From(l({},this.getCamera())));return this._tickCameraState(),this}getViewportScreenBounds(){const{x:e,y:t,w:n,h:o}=this.getInstanceState().screenBounds;return new rc(e,t,n,o)}getViewportScreenCenter(){const e=this.getViewportScreenBounds();return new Vs(e.midX-e.minX,e.midY-e.minY)}getViewportPageBounds(){const{w:e,h:t}=this.getViewportScreenBounds(),{x:n,y:o,z:r}=this.getCamera();return new rc(-n,-o,e/r,t/r)}screenToPage(e){var t;const{screenBounds:n}=this.store.unsafeGetWithoutCapture(Wr),{x:o,y:r,z:i=1}=this.getCamera();return new Vs((e.x-n.x)/i-o,(e.y-n.y)/i-r,null!==(t=e.z)&&void 0!==t?t:.5)}pageToScreen(e){var t;const{screenBounds:n}=this.store.unsafeGetWithoutCapture(Wr),{x:o,y:r,z:i=1}=this.getCamera();return new Vs((e.x+o)*i+n.x,(e.y+r)*i+n.y,null!==(t=e.z)&&void 0!==t?t:.5)}pageToViewport(e){var t;const{x:n,y:o,z:r=1}=this.getCamera();return new Vs((e.x+n)*r,(e.y+o)*r,null!==(t=e.z)&&void 0!==t?t:.5)}_getCollaboratorsQuery(){return this.store.query.records("instance_presence",(()=>({userId:{neq:this.user.getId()}})))}getCollaborators(){const e=this._getCollaboratorsQuery().get();if(!e.length)return jt;return[...new Set(e.map((e=>e.userId)))].sort().map((t=>e.filter((e=>e.userId===t)).sort(((e,t)=>t.lastActivityTimestamp-e.lastActivityTimestamp))[0]))}getCollaboratorsOnCurrentPage(){const e=this.getCurrentPageId();return this.getCollaborators().filter((t=>t.currentPageId===e))}startFollowingUser(e){this.stopFollowingUser();const t=this._getCollaboratorsQuery().get().filter((t=>t.userId===e));if(!t.length)return console.warn("User not found"),this;const n=this.user.getId();if(n||console.warn("You should set the userId for the current instance before following a user"),t.some((e=>e.followingUserId===n)))return this;const o=cn("latestLeaderPresence",(()=>this.getCollaborators().find((t=>t.userId===e))));return Xt((()=>{this.updateInstanceState({followingUserId:e},{history:"ignore"});const t=Ht("update current page",(()=>{const e=o.get();e?e.currentPageId!==this.getCurrentPageId()&&this.getPage(e.currentPageId)&&this.run((()=>{this.store.put([l(l({},this.getInstanceState()),{},{currentPageId:e.currentPageId})]),this._isLockedOnFollowingUser.set(!0)}),{history:"ignore"}):this.stopFollowingUser()})),n=()=>{t(),this._isLockedOnFollowingUser.set(!1),this.off("frame",r),this.off("stop-following",n)},r=()=>{if(!o.get())return void this.stopFollowingUser();if(this._isLockedOnFollowingUser.get())return;const e=this.user.getAnimationSpeed();if(0===e)return void this._isLockedOnFollowingUser.set(!0);const t=this.getViewportPageBoundsForFollowing();if(!t)return void this.stopFollowingUser();const n=this.getViewportPageBounds(),r=Math.abs(t.minX-n.minX)+Math.abs(t.maxX-n.maxX),i=Math.abs(t.minY-n.minY)+Math.abs(t.maxY-n.maxY);if(r<this.options.followChaseViewportSnap&&i<this.options.followChaseViewportSnap)return void this._isLockedOnFollowingUser.set(!0);const s=Qs(.5*e,.1,.8),a=new rc(le(n.minX,t.minX,s),le(n.minY,t.minY,s),le(n.width,t.width,s),le(n.height,t.height,s)),l=new Vs(-a.x,-a.y,this.getViewportScreenBounds().width/a.width);this.stopCameraAnimation(),this._setCamera(l)};this.once("stop-following",n),this.addListener("frame",r),r()})),this}stopFollowingUser(){return this.run((()=>{this.store.put([this.getCamera()]),this._isLockedOnFollowingUser.set(!1),this.updateInstanceState({followingUserId:null}),this.emit("stop-following")}),{history:"ignore"}),this}getUnorderedRenderingShapes(e){const t=[];let n=2*this.options.maxShapesPerPage,o=this.options.maxShapesPerPage;const r=this.getErasingShapeIds(),i=(s,a,l)=>{const c=this.getShape(s);if(!c)return;if(this.isShapeHidden(c))return;a*=c.opacity;let d=!1;const u=this.getShapeUtil(c);e&&(d=!l&&r.includes(s),d&&(a*=.32)),t.push({id:s,shape:c,util:u,index:n,backgroundIndex:o,opacity:a}),n+=1,o+=1;const h=this.getSortedChildIdsForParent(s);if(!h.length)return;let p=null;u.providesBackgroundForChildren(c)&&(p=o,o=n,n+=this.options.maxShapesPerPage);for(const e of h)i(e,a,l||d);null!==p&&(o=p)},s=e?[this.getCurrentPage()]:this.getPages();for(const a of s)for(const e of this.getSortedChildIdsForParent(a.id))i(e,1,!1);return t}_decayCameraStateTimeout(e){this._cameraStateTimeoutRemaining-=e,this._cameraStateTimeoutRemaining>0||(this.off("tick",this._decayCameraStateTimeout),this._cameraState.set("idle"))}_tickCameraState(){this._cameraStateTimeoutRemaining=this.options.cameraMovingTimeoutMs,"idle"===this._cameraState.__unsafe__getWithoutCapture()&&(this._cameraState.set("moving"),this.on("tick",this._decayCameraStateTimeout))}getCameraState(){return this._cameraState.get()}getRenderingShapes(){return this.getUnorderedRenderingShapes(!0).sort(et)}_getAllPagesQuery(){return this.store.query.records("page")}getPages(){return this._getAllPagesQuery().get().sort(Je)}getCurrentPage(){return this.getPage(this.getCurrentPageId())}getCurrentPageId(){return this.getInstanceState().currentPageId}getPage(e){return this.store.get("string"===typeof e?e:e.id)}getCurrentPageShapeIds(){return this._currentPageShapeIds.get()}getCurrentPageShapeIdsSorted(){return Array.from(this.getCurrentPageShapeIds()).sort()}getPageShapeIds(e){const t="string"===typeof e?e:e.id,n=this.store.query.exec("shape",{parentId:{eq:t}});return this.getShapeAndDescendantIds(n.map((e=>e.id)))}setCurrentPage(e){const t="string"===typeof e?e:e.id;return this.store.has(t)?(this.stopFollowingUser(),this.complete(),this.run((()=>{this.store.put([l(l({},this.getInstanceState()),{},{currentPageId:t})]),this.setCamera(this.getCamera())}),{history:"record-preserveRedoStack"})):(console.error("Tried to set the current page id to a page that doesn't exist."),this)}updatePage(e){if(this.getIsReadonly())return this;return this.getPage(e.id)?this.run((()=>this.store.update(e.id,(t=>l(l({},t),e))))):this}createPage(e){return this.run((()=>{var t;if(this.getIsReadonly())return;if(this.getPages().length>=this.options.maxPages)return;const n=this.getPages(),o=function(e,t){let n=e;const o=new Set(t);for(;o.has(n);){var r;n=null!==(r=/^.*(\d+)$/.exec(n))&&void 0!==r&&r[1]?n.replace(/(\d+)(?=\D?)$/,(e=>(+e+1).toString())):"".concat(n," 1")}return n}(null!==(t=e.name)&&void 0!==t?t:"Page 1",n.map((e=>e.name)));let r=e.index;r&&!n.some((e=>e.index===r))||(r=Ze(n[n.length-1].index));const i=_r.create(l(l({meta:{}},e),{},{name:o,index:r}));this.store.put([i])})),this}deletePage(e){const t="string"===typeof e?e:e.id;return this.run((()=>{if(this.getIsReadonly())return;const e=this.getPages();if(1===e.length)return;const n=this.getPage(t);if(n){if(t===this.getCurrentPageId()){var o;const n=e.findIndex((e=>e.id===t)),r=null!==(o=e[n-1])&&void 0!==o?o:e[n+1];this.setCurrentPage(r.id)}this.store.remove([n.id])}})),this}duplicatePage(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:_r.createId();if(this.getPages().length>=this.options.maxPages)return this;const n="string"===typeof e?e:e.id,o=this.getPage(n);if(!o)return this;const r=l({},this.getCamera()),i=this.getContentFromCurrentPage(this.getSortedChildIdsForParent(o.id));return this.run((()=>{var e;const n=this.getPages(),s=$e(o.index,null===(e=n[n.indexOf(o)+1])||void 0===e?void 0:e.index);if(this.createPage({name:o.name+" Copy",id:t,index:s}),this.setCurrentPage(t),this.setCamera(r),i)return this.putContentOntoCurrentPage(i)})),this}renamePage(e,t){const n="string"===typeof e?e:e.id;return this.getIsReadonly()||this.updatePage({id:n,name:t}),this}_getAllAssetsQuery(){return this.store.query.records("asset")}getAssets(){return this._getAllAssetsQuery().get()}createAssets(e){return this.getIsReadonly()||e.length<=0||this.run((()=>this.store.put(e)),{history:"ignore"}),this}updateAssets(e){return this.getIsReadonly()||e.length<=0||this.run((()=>{this.store.put(e.map((e=>l(l({},this.store.get(e.id)),e))))}),{history:"ignore"}),this}deleteAssets(e){if(this.getIsReadonly())return this;const t="string"===typeof e[0]?e:e.map((e=>e.id));return t.length<=0||this.run((()=>this.store.remove(t)),{history:"ignore"}),this}getAsset(e){return this.store.get("string"===typeof e?e:e.id)}async resolveAssetUrl(e,t){if(!e)return null;const n=this.getAsset(e);if(!n)return null;const{screenScale:o=1,shouldResolveToOriginal:r=!1}=t,i=Math.max(.125,(s=o,Math.pow(2,Math.ceil(Math.log2(s)))));var s;const a="connection"in navigator?navigator.connection.effectiveType:null,l=this.getInstanceState().devicePixelRatio;return await this.store.props.assets.resolve(n,{screenScale:o||1,steppedScreenScale:i,dpr:l,networkEffectiveType:a,shouldResolveToOriginal:r})}async uploadAsset(e,t){return await this.store.props.assets.upload(e,t)}_getShapeGeometryCache(){return this.store.createComputedCache("bounds",(e=>this.getShapeUtil(e).getGeometry(e)),((e,t)=>e.props===t.props))}getShapeGeometry(e){return this._getShapeGeometryCache().get("string"===typeof e?e:e.id)}_getShapeHandlesCache(){return this.store.createComputedCache("handles",(e=>{var t,n;return null===(t=(n=this.getShapeUtil(e)).getHandles)||void 0===t?void 0:t.call(n,e)}))}getShapeHandles(e){return this._getShapeHandlesCache().get("string"===typeof e?e:e.id)}getShapeLocalTransform(e){const t="string"===typeof e?e:e.id,n=this.getShape(t);if(!n)throw Error("Editor.getTransform: shape not found");return ic.Identity().translate(n.x,n.y).rotate(n.rotation)}_getShapePageTransformCache(){return this.store.createComputedCache("pageTransformCache",(e=>{var t;if(Ir(e.parentId))return this.getShapeLocalTransform(e);const n=null!==(t=this._getShapePageTransformCache().get(e.parentId))&&void 0!==t?t:ic.Identity();return ic.Compose(n,this.getShapeLocalTransform(e))}))}getShapeParentTransform(e){var t;const n="string"===typeof e?e:e.id,o=this.getShape(n);return!o||Ir(o.parentId)?ic.Identity():null!==(t=this._getShapePageTransformCache().get(o.parentId))&&void 0!==t?t:ic.Identity()}getShapePageTransform(e){var t;const n="string"===typeof e?e:e.id;return null!==(t=this._getShapePageTransformCache().get(n))&&void 0!==t?t:ic.Identity()}_getShapePageBoundsCache(){return this.store.createComputedCache("pageBoundsCache",(e=>{const t=this._getShapePageTransformCache().get(e.id);if(!t)return new rc;return rc.FromPoints(ic.applyToPoints(t,this.getShapeGeometry(e).vertices))}))}getShapePageBounds(e){return this._getShapePageBoundsCache().get("string"===typeof e?e:e.id)}_getShapeClipPathCache(){return this.store.createComputedCache("clipPathCache",(e=>{const t=this._getShapeMaskCache().get(e.id);if(!t)return;if(0===t.length)return"polygon(0px 0px, 0px 0px, 0px 0px)";const n=this._getShapePageTransformCache().get(e.id);if(!n)return;const o=ic.applyToPoints(ic.Inverse(n),t);return"polygon(".concat(o.map((e=>"".concat(e.x,"px ").concat(e.y,"px"))).join(","),")")}))}getShapeClipPath(e){return this._getShapeClipPathCache().get("string"===typeof e?e:e.id)}_getShapeMaskCache(){return this.store.createComputedCache("pageMaskCache",(e=>{if(Ir(e.parentId))return;const t=this.getShapeAncestors(e.id).filter((e=>this.isShapeOfType(e,"frame")));if(0===t.length)return;return t.map((e=>this._getShapePageTransformCache().get(e.id).applyToPoints(this.getShapeGeometry(e).vertices))).reduce(((e,t)=>{if(!t||!e)return;const n=du(e,t);return n?n.map(Vs.Cast):[]}))}))}getShapeMask(e){return this._getShapeMaskCache().get("string"===typeof e?e:e.id)}getShapeMaskedPageBounds(e){return"string"!==typeof e&&(e=e.id),this._getShapeMaskedPageBoundsCache().get(e)}_getShapeMaskedPageBoundsCache(){return this.store.createComputedCache("shapeMaskedPageBoundsCache",(e=>{const t=this._getShapePageBoundsCache().get(e.id);if(!t)return;const n=this._getShapeMaskCache().get(e.id);if(n){if(0===n.length)return;const{corners:e}=t;if(e.every(((e,t)=>e&&Vs.Equals(e,n[t]))))return t.clone();const o=du(n,e);if(!o)return;return rc.FromPoints(o)}return t}))}getShapeAncestors(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];const n="string"===typeof e?e:e.id,o=this.getShape(n);if(!o)return t;const r=o.parentId;if(Ir(r))return t.reverse(),t;const i=this.store.get(r);return i?(t.push(i),this.getShapeAncestors(i,t)):t}findShapeAncestor(e,t){const n="string"===typeof e?e:e.id,o=this.getShape(n);if(!o)return;const r=o.parentId;if(Ir(r))return;const i=this.getShape(r);return i?t(i)?i:this.findShapeAncestor(i,t):void 0}hasAncestor(e,t){const n="string"===typeof e?e:null===e||void 0===e?void 0:e.id,o=n&&this.getShape(n);return!!o&&(o.parentId===t||this.hasAncestor(this.getShapeParent(o),t))}findCommonAncestor(e,t){if(0===e.length)return;const n=C(("string"===typeof e[0]?e:e.map((e=>e.id))).map((e=>this.getShape(e))));if(1===n.length){var o;const e=n[0].parentId;if(Ir(e))return;return t?null===(o=this.findShapeAncestor(n[0],t))||void 0===o?void 0:o.id:e}const[r,...i]=n;let s=this.getShapeParent(r);for(;s;)if(!t||t(s)){if(i.every((e=>this.hasAncestor(e,s.id))))return s.id;s=this.getShapeParent(s)}else s=this.getShapeParent(s)}isShapeOrAncestorLocked(e){const t="string"===typeof e?this.getShape(e):e;return void 0!==t&&(!!t.isLocked||this.isShapeOrAncestorLocked(this.getShapeParent(t)))}_notVisibleShapes(){return(e=>{function t(e){const t=e.getCurrentPageShapeIds(),n=e.getViewportPageBounds(),o=new Set;return t.forEach((t=>{(function(e,t,n){const o=e.getShapeMaskedPageBounds(t);return void 0===o||!n.includes(o)})(e,t,n)&&o.add(t)})),o}return cn("getCulledShapes",(n=>{if(tn(n))return t(e);const o=t(e);if(n.size!==o.size)return o;for(const e of n)if(!o.has(e))return o;return n}))})(this)}getCulledShapes(){const e=this._notVisibleShapes().get(),t=this.getSelectedShapeIds(),n=this.getEditingShapeId(),o=new Set(e);return n&&o.delete(n),t.forEach((e=>{o.delete(e)})),o}getCurrentPageBounds(){let e;return this.getCurrentPageShapeIdsSorted().forEach((t=>{const n=this.getShapeMaskedPageBounds(t);n&&(e=e?e.expand(n):n.clone())})),e}getSelectedShapeAtPoint(e){const t=this.getSelectedShapeIds();return this.getCurrentPageShapesSorted().filter((e=>"group"!==e.type&&t.includes(e.id))).reverse().find((t=>this.isPointInShape(t,e,{hitInside:!0,margin:0})))}getShapeAtPoint(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=this.getZoomLevel(),o=this.getViewportPageBounds(),{filter:r,margin:i=0,hitLocked:s=!1,hitLabels:a=!1,hitInside:l=!1,hitFrameInside:c=!1}=t;let d=1/0,u=null,h=1/0,p=null;const f=(t.renderingOnly?this.getCurrentPageRenderingShapesSorted():this.getCurrentPageShapesSorted()).filter((t=>{if(t.isLocked&&!s||this.isShapeHidden(t)||this.isShapeOfType(t,"group"))return!1;const n=this.getShapeMask(t);return!(n&&!fa(e,n))&&(!r||r(t))}));for(let g=f.length-1;g>=0;g--){const t=f[g],r=this.getShapeGeometry(t),s=r instanceof ac,m=this.getPointInShapeSpace(t,e);if(this.isShapeOfType(t,"frame")||(this.isShapeOfType(t,"arrow")||this.isShapeOfType(t,"geo")&&"none"===t.props.fill)&&t.props.text.trim())for(const e of r.children)if(e.isLabel&&e.isPointInBounds(m))return t;if(this.isShapeOfType(t,"frame")){const e=r.distanceToPoint(m,l);if(Math.abs(e)<=i)return p||t;if(r.hitTestPoint(m,0,!0))return p||u||(c?t:void 0);continue}let y;if(s){let e=1/0;for(const t of r.children){if(t.isLabel&&!a)continue;const n=t.distanceToPoint(m,l);n<e&&(e=n)}y=e}else y=0===i&&(r.bounds.w<1||r.bounds.h<1)||r.bounds.containsPoint(m,i)?r.distanceToPoint(m,l):1/0;if(r.isClosed){if(y<=i){if(r.isFilled||s&&r.children[0].isFilled)return p||t;if(this.getShapePageBounds(t).contains(o))continue;if(Math.abs(y)<i)Math.abs(y)<h&&(h=Math.abs(y),p=t);else if(!p){const{area:e}=r;e<d&&(d=e,u=t)}}}else if(y<this.options.hitTestMargin/n)return t}return p||u||void 0}getShapesAtPoint(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.getCurrentPageShapes().filter((n=>!this.isShapeHidden(n)&&this.isPointInShape(n,e,t)))}isPointInShape(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const{hitInside:o=!1,margin:r=0}=n,i="string"===typeof e?e:e.id,s=this.getShapeMask(i);return!(s&&!fa(t,s))&&this.getShapeGeometry(i).hitTestPoint(this.getPointInShapeSpace(e,t),r,o)}getPointInShapeSpace(e,t){const n="string"===typeof e?e:e.id;return this._getShapePageTransformCache().get(n).clone().invert().applyToPoint(t)}getPointInParentSpace(e,t){const n="string"===typeof e?e:e.id,o=this.getShape(n);if(!o)return new Vs(0,0);if(Ir(o.parentId))return Vs.From(t);const r=this.getShapePageTransform(o.parentId);return r?r.clone().invert().applyToPoint(t):Vs.From(t)}getCurrentPageShapes(){return Array.from(this.getCurrentPageShapeIds(),(e=>this.store.get(e)))}getCurrentPageShapesSorted(){const e=[],t=this.getSortedChildIdsForParent(this.getCurrentPageId());for(let n=0,o=t.length;n<o;n++)iv(this,t[n],e);return e}getCurrentPageRenderingShapesSorted(){const e=this.getCulledShapes();return this.getCurrentPageShapesSorted().filter((t=>{let{id:n}=t;return!e.has(n)&&!this.isShapeHidden(n)}))}isShapeOfType(e,t){const n="string"===typeof e?this.getShape(e):e;return!!n&&n.type===t}getShape(e){const t="string"===typeof e?e:e.id;if(Ho(t))return this.store.get(t)}getShapeParent(e){const t="string"===typeof e?e:null===e||void 0===e?void 0:e.id;if(!t)return;const n=this.getShape(t);return void 0!==n&&Ho(n.parentId)?this.store.get(n.parentId):void 0}getShapeNearestSibling(e,t){if(!t)return;if(t.parentId===e.parentId)return t;return this.findShapeAncestor(t,(t=>t.parentId===e.parentId))}isShapeInPage(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.getCurrentPageId();const n="string"===typeof e?e:e.id,o=this.getShape(n);if(!o)return!1;let r=!1;if(o.parentId===t)r=!0;else{let e=this.getShape(o.parentId);e:for(;e;){if(e.parentId===t){r=!0;break e}e=this.getShape(e.parentId)}}return r}getAncestorPageId(e){const t="string"===typeof e?e:null===e||void 0===e?void 0:e.id,n=t&&this.getShape(t);if(n)return Ir(n.parentId)?n.parentId:this.getAncestorPageId(this.getShape(n.parentId))}reparentShapes(e,t,n){const o="string"===typeof e[0]?e:e.map((e=>e.id));if(0===o.length)return this;const r=[],i=Ir(t)?ic.Identity():this.getShapePageTransform(t),s=i.rotation();let a=[];const l=C(this.getSortedChildIdsForParent(t).map((e=>this.getShape(e))));if(n){const e=l.find((e=>e.index===n));if(e){const t=l[l.indexOf(e)+1];a=t?Ge(n,t.index,o.length):Xe(n,o.length)}else{const e=l.sort(Je).find((e=>e.index>n));a=e?Ge(n,e.index,o.length):Xe(n,o.length)}}else{const e=l.length&&l[l.length-1];a=e?Xe(e.index,o.length):Qe(o.length)}const c=i.clone().invert(),d=C(o.map((e=>this.getShape(e))));return this.run((()=>{for(let e=0;e<d.length;e++){const n=d[e],o=this.getShapePageTransform(n);if(!o)continue;const i=o.point();if(!i)continue;const l=c.applyToPoint(i),u=o.rotation()-s;r.push({id:n.id,type:n.type,parentId:t,x:l.x,y:l.y,rotation:u,index:a[e]})}this.updateShapes(r)}),{ignoreShapeLock:!0}),this}getHighestIndexForParent(e){const t="string"===typeof e?e:e.id,n=this._parentIdsToChildIds.get()[t];if(!n||0===n.length)return"a1";return Ze(this.getShape(n[n.length-1]).index)}getSortedChildIdsForParent(e){const t="string"===typeof e?e:e.id,n=this._parentIdsToChildIds.get()[t];return n||jt}visitDescendants(e,t){const n="string"===typeof e?e:e.id,o=this.getSortedChildIdsForParent(n);for(const r of o)!1!==t(r)&&this.visitDescendants(r,t);return this}getShapeAndDescendantIds(e){const t=new Set;for(const n of e.map((e=>this.getShape(e))).sort(Je))t.add(n.id),this.visitDescendants(n,(e=>{t.add(e)}));return t}getDroppingOverShape(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];const n=this.getCurrentPageShapesSorted();for(let o=n.length-1;o>=0;o--){const r=n[o];if(this.isShapeHidden(r)||this.getSelectedShapeIds().includes(r.id)||!this.getShapeUtil(r).canDropShapes(r,t)||t.find((e=>e.id===r.id||this.hasAncestor(r,e.id))))continue;const i=this.getShapeMaskedPageBounds(r.id);if(i&&i.containsPoint(e)&&this.getShapeGeometry(r).hitTestPoint(this.getPointInShapeSpace(r,e),0,!0))return r}}getOutermostSelectableShape(e,t){const n="string"===typeof e?e:e.id,o=this.getShape(n);let r=o,i=o;const s=this.getFocusedGroup();for(;i;){var a;if(!this.isShapeOfType(i,"group")||(null===s||void 0===s?void 0:s.id)===i.id||this.hasAncestor(s,i.id)||null!==(a=null===t||void 0===t?void 0:t(i))&&void 0!==a&&!a){if((null===s||void 0===s?void 0:s.id)===i.id)break}else r=i;i=this.getShapeParent(i)}return r}_getBindingsIndexCache(){const e=(e=>{const{store:t}=e,n=t.query.filterHistory("binding"),o=t.query.records("binding");function r(){const e=o.get(),t=new Map;for(const n of e){const{fromId:e,toId:o}=n,r=t.get(e);r?r.push(n):t.set(e,[n]);const i=t.get(o);i?i.push(n):t.set(o,[n])}return t}return cn("arrowBindingsIndex",((e,t)=>{var o;if(tn(e))return r();const i=e,s=n.getDiffSince(t);if(s===Mt)return r();let a;function l(e){var t;null!==(t=a)&&void 0!==t||(a=new Map(i));const n=a.get(e.fromId),o=null===n||void 0===n?void 0:n.filter((t=>t.id!==e.id));null!==o&&void 0!==o&&o.length?a.set(e.fromId,o):a.delete(e.fromId);const r=a.get(e.toId),s=null===r||void 0===r?void 0:r.filter((t=>t.id!==e.id));null!==s&&void 0!==s&&s.length?a.set(e.toId,s):a.delete(e.toId)}function c(e){var t;null!==(t=a)&&void 0!==t||(a=new Map(i));let n=a.get(e);return n?n===i.get(e)&&(n=n.slice(0),a.set(e,n)):(n=[],a.set(e,n)),n}function d(e){c(e.fromId).push(e),c(e.toId).push(e)}for(const n of s){for(const e of fe(n.added))d(e);for(const[e,t]of fe(n.updated))l(e),d(t);for(const e of fe(n.removed))l(e)}return null!==(o=a)&&void 0!==o?o:i}))})(this);return this.store.createComputedCache("bindingsIndex",(t=>e.get().get(t.id)))}getBinding(e){return this.store.get(e)}getBindingsFromShape(e,t){const n="string"===typeof e?e:e.id;return this.getBindingsInvolvingShape(n).filter((e=>e.fromId===n&&e.type===t))}getBindingsToShape(e,t){const n="string"===typeof e?e:e.id;return this.getBindingsInvolvingShape(n).filter((e=>e.toId===n&&e.type===t))}getBindingsInvolvingShape(e,t){var n;const o="string"===typeof e?e:e.id,r=null!==(n=this._getBindingsIndexCache().get(o))&&void 0!==n?n:jt;return t?r.filter((e=>e.type===t)):r}createBindings(e){const t=[];for(const o of e){var n;const e=this.getShape(o.fromId),r=this.getShape(o.toId);if(!e||!r)continue;if(!this.canBindShapes({fromShape:e,toShape:r,binding:o}))continue;const i=this.getBindingUtil(o.type).getDefaultProps(),s=this.store.schema.types.binding.create(l(l({},o),{},{id:null!==(n=o.id)&&void 0!==n?n:Ro(),props:l(l({},i),o.props)}));t.push(s)}return this.store.put(t),this}createBinding(e){return this.createBindings([e])}updateBindings(e){const t=[];for(const n of e){if(!n)continue;const e=this.getBinding(n.id);if(!e)continue;const o=rv(e,n);if(o===e)continue;const r=this.getShape(o.fromId),i=this.getShape(o.toId);r&&i&&(this.canBindShapes({fromShape:r,toShape:i,binding:o})&&t.push(o))}return this.store.put(t),this}updateBinding(e){return this.updateBindings([e])}deleteBindings(e){let{isolateShapes:t=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=e.map((e=>"string"===typeof e?e:e.id));return t?this.store.atomic((()=>{for(const o of n){var e,t;const n=this.getBinding(o);if(!n)continue;const r=this.getBindingUtil(n);null===(e=r.onBeforeIsolateFromShape)||void 0===e||e.call(r,{binding:n,removedShape:this.getShape(n.toId)}),null===(t=r.onBeforeIsolateToShape)||void 0===t||t.call(r,{binding:n,removedShape:this.getShape(n.fromId)}),this.store.remove([o])}})):this.store.remove(n),this}deleteBinding(e,t){return this.deleteBindings([e],t)}canBindShapes(e){let{fromShape:t,toShape:n,binding:o}=e;const r="string"===typeof t?t:t.type,i="string"===typeof n?n:n.type,s={fromShapeType:r,toShapeType:i,bindingType:"string"===typeof o?o:o.type};return r===i?this.getShapeUtil(r).canBind(s):this.getShapeUtil(r).canBind(s)&&this.getShapeUtil(i).canBind(s)}rotateShapesBy(e,t,n){const o="string"===typeof e[0]?e:e.map((e=>e.id));if(o.length<=0)return this;const r=cp({editor:this,ids:o});return r?(dp({delta:t,snapshot:r,editor:this,stage:"one-off",centerOverride:null===n||void 0===n?void 0:n.center}),this):this}getChangesToTranslateShape(e,t){var n,o,r,i,s,a;let l=e;const c=this.getShapeUtil(e);return l=rv(l,null!==(n=null===(o=c.onTranslateStart)||void 0===o?void 0:o.call(c,l))&&void 0!==n?n:void 0),l=rv(l,{id:e.id,type:e.type,x:t.x,y:t.y}),l=rv(l,null!==(r=null===(i=c.onTranslate)||void 0===i?void 0:i.call(c,e,l))&&void 0!==r?r:void 0),l=rv(l,null!==(s=null===(a=c.onTranslateEnd)||void 0===a?void 0:a.call(c,e,l))&&void 0!==s?s:void 0),l}nudgeShapes(e,t){const n="string"===typeof e[0]?e:e.map((e=>e.id));if(n.length<=0)return this;const o=[];for(const r of n){const e=this.getShape(r),n=Vs.From(t),i=this.getShapeParentTransform(e);i&&n.rot(-i.rotation()),o.push(this.getChangesToTranslateShape(e,n.add(e)))}return this.updateShapes(o),this}duplicateShapes(e,t){return this.run((()=>{const n="string"===typeof e[0]?e:e.map((e=>e.id));if(n.length<=0)return this;const o=new Set(n),r=this.getShapeAndDescendantIds(n),i=[...r].reverse(),s=new Map;for(const e of r)s.set(e,Ko());const{shapesToCreateWithOriginals:a,bindingsToCreate:c}=sv(this,r,(e=>{const n=[];for(const t of e){const e=this.getBinding(t);if(!e)continue;const o=Ro();n.push(l(l({},e),{},{id:o,fromId:A(s.get(e.fromId)),toId:A(s.get(e.toId))}))}const r=[];for(const c of i){var a;const e=A(s.get(c)),n=this.getShape(c);if(!n)continue;let i=0,d=0;if(t&&o.has(c)){const e=this.getShapeParentTransform(n),o=new Vs(t.x,t.y).rot(-e.rotation());i=o.x,d=o.y}r.push({shape:l(l({},n),{},{id:e,x:n.x+i,y:n.y+d,index:"a1",parentId:null!==(a=s.get(n.parentId))&&void 0!==a?a:n.parentId}),originalShape:n})}return{shapesToCreateWithOriginals:r,bindingsToCreate:n}}));a.forEach((e=>{let{shape:t,originalShape:n}=e;const o=n.parentId,r=this.getSortedChildIdsForParent(o),i=r.indexOf(n.id),s=r[i+1],a=s?this.getShape(s):void 0,l=$e(n.index,null===a||void 0===a?void 0:a.index);t.index=l}));const d=a.map((e=>{let{shape:t}=e;return t}));if(d.length+this.getCurrentPageShapeIds().size>this.options.maxShapesPerPage)ov(this);else if(this.createShapes(d),this.createBindings(c),this.setSelectedShapes(C(n.map((e=>s.get(e))))),void 0!==t){const e=this.getSelectionPageBounds(),t=this.getViewportPageBounds();e&&!t.contains(e)&&this.centerOnPoint(e.center,{animation:{duration:this.options.animationMediumMs}})}})),this}moveShapesToPage(e,t){const n="string"===typeof e[0]?e:e.map((e=>e.id));if(0===n.length)return this;if(this.getIsReadonly())return this;const o=this.getCurrentPageId();if(t===o)return this;if(!this.store.has(t))return this;const r=this.getContentFromCurrentPage(n);if(!r)return this;if(this.getPageShapeIds(t).size+r.shapes.length>this.options.maxShapesPerPage)return ov(this,t),this;const i=this.getCamera().z;return this.run((()=>{this.deleteShapes(n),this.setCurrentPage(t),this.setFocusedGroup(null),this.selectNone(),this.putContentOntoCurrentPage(r,{select:!0,preserveIds:!0,preservePosition:!0}),this.setCamera(l(l({},this.getCamera()),{},{z:i})),this.centerOnPoint(this.getSelectionRotatedPageBounds().center)})),this}toggleLock(e){const t="string"===typeof e[0]?e:e.map((e=>e.id));if(this.getIsReadonly()||0===t.length)return this;let n=!0,o=!0;const r=[];for(const i of t){const e=this.getShape(i);e&&(r.push(e),e.isLocked?o=!1:n=!1)}return this.run((()=>{o?(this.updateShapes(r.map((e=>({id:e.id,type:e.type,isLocked:!0})))),this.setSelectedShapes([])):n?this.updateShapes(r.map((e=>({id:e.id,type:e.type,isLocked:!1})))):this.updateShapes(r.map((e=>({id:e.id,type:e.type,isLocked:!0}))))})),this}sendToBack(e){const t=sp(this,"toBack","string"===typeof e[0]?e:e.map((e=>e.id)),{considerAllShapes:!0});return t&&this.updateShapes(t),this}sendBackward(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=sp(this,"backward","string"===typeof e[0]?e:e.map((e=>e.id)),t);return n&&this.updateShapes(n),this}bringForward(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=sp(this,"forward","string"===typeof e[0]?e:e.map((e=>e.id)),t);return n&&this.updateShapes(n),this}bringToFront(e){const t=sp(this,"toFront","string"===typeof e[0]?e:e.map((e=>e.id)));return t&&this.updateShapes(t),this}flipShapes(e,t){const n="string"===typeof e[0]?e:e.map((e=>e.id));if(this.getIsReadonly())return this;let o=C(n.map((e=>this.getShape(e))));if(!o.length)return this;o=C(o.map((e=>this.isShapeOfType(e,"group")?this.getSortedChildIdsForParent(e.id).map((e=>this.getShape(e))):e)).flat());const r=rc.Common(C(o.map((e=>this.getShapePageBounds(e))))).center;return this.run((()=>{for(const e of o){const n=this.getShapeGeometry(e).bounds,o=this.getShapePageTransform(e.id);o&&this.resizeShape(e.id,{x:"horizontal"===t?-1:1,y:"vertical"===t?-1:1},{initialBounds:n,initialPageTransform:o,initialShape:e,mode:"scale_shape",isAspectRatioLocked:this.getShapeUtil(e).isAspectRatioLocked(e),scaleOrigin:r,scaleAxisRotation:0})}})),this}stackShapes(e,t,n){const o="string"===typeof e[0]?e:e.map((e=>e.id));if(this.getIsReadonly())return this;const r=o.map((e=>this.getShape(e))).filter((e=>!!e&&this.getShapeUtil(e).canBeLaidOut(e))),i=r.length;if(0===n&&i<3||i<2)return this;const s=Object.fromEntries(r.map((e=>[e.id,this.getShapePageBounds(e)])));let a,c,d,u,h;if("horizontal"===t?(a="x",c="minX",d="maxX",u="width"):(a="y",c="minY",d="maxY",u="height"),0===n){const e=[];r.sort(((e,t)=>s[e.id][c]-s[t.id][c]));for(let n=0;n<i-1;n++){const t=r[n],o=r[n+1],i=s[t.id],a=s[o.id][c]-i[d],l=e.find((e=>e.gap===a));l?l.count++:e.push({gap:a,count:1})}let t=0;e.forEach((e=>{e.count>t&&(t=e.count,h=e.gap)})),1===t&&(h=Math.max(0,e.reduce(((e,t)=>e+t.gap*t.count),0)/(i-1)))}else h=n;const p=[];let f=s[r[0].id][d];return r.forEach(((e,t)=>{var n,o;if(0===t)return;const r={x:0,y:0};r[a]=f+h-s[e.id][a];const i=this.getShapeParent(e),c=i?Vs.Rot(r,-this.getShapePageTransform(i).decompose().rotation):r,d=null===(n=(o=this.getShapeUtil(e)).onTranslateStart)||void 0===n?void 0:n.call(o,e);p.push(d?l(l({},d),{},{[a]:e[a]+c[a]}):{id:e.id,type:e.type,[a]:e[a]+c[a]}),f+=s[e.id][u]+h})),this.updateShapes(p),this}packShapes(e,t){const n="string"===typeof e[0]?e:e.map((e=>e.id));if(this.getIsReadonly())return this;if(n.length<2)return this;const o=n.map((e=>this.getShape(e))).filter((e=>!!e&&this.getShapeUtil(e).canBeLaidOut(e))),r={},i={};let s,a,c=0;for(let l=0;l<o.length;l++)s=o[l],a=this.getShapePageBounds(s),r[s.id]=a,i[s.id]=a.clone(),c+=a.width*a.height;const d=rc.Common(C(Object.values(r))),u=d.width;o.sort(((e,t)=>r[t.id].height-r[e.id].height));const h=Math.max(Math.ceil(Math.sqrt(c/.95)),u),p=[new rc(d.x,d.y,h,1/0)];let f,g,m=0,y=0;for(let l=0;l<o.length;l++){s=o[l],a=i[s.id];for(let e=p.length-1;e>=0;e--)if(f=p[e],!(a.width>f.width||a.height>f.height)){a.x=f.x,a.y=f.y,y=Math.max(y,a.maxY),m=Math.max(m,a.maxX),a.width===f.width&&a.height===f.height?(g=p.pop(),e<p.length&&(p[e]=g)):a.height===f.height?(f.x+=a.width+t,f.width-=a.width+t):a.width===f.width?(f.y+=a.height+t,f.height-=a.height+t):(p.push(new rc(f.x+(a.width+t),f.y,f.width-(a.width+t),a.height)),f.y+=a.height+t,f.height-=a.height+t);break}}const v=rc.Common(Object.values(i)),b=Vs.Sub(d.center,v.center);let w;const x=[];for(let P=0;P<o.length;P++){var S,k;s=o[P],a=r[s.id],w=i[s.id];const e=Vs.Sub(w.point,a.point).add(b),t=this.getShapeParentTransform(s);t&&e.rot(-t.rotation());const n={id:s.id,type:s.type,x:s.x+e.x,y:s.y+e.y},c=null===(S=(k=this.getShapeUtil(s)).onTranslateStart)||void 0===S?void 0:S.call(k,l(l({},s),n));c?x.push(l(l({},n),c)):x.push(n)}return x.length&&this.updateShapes(x),this}alignShapes(e,t){const n="string"===typeof e[0]?e:e.map((e=>e.id));if(this.getIsReadonly())return this;if(n.length<2)return this;const o=C(n.map((e=>this.getShape(e)))),r=Object.fromEntries(o.map((e=>[e.id,this.getShapePageBounds(e)]))),i=rc.Common(C(Object.values(r))),s=[];return o.forEach((e=>{const n=r[e.id];if(!n)return;const o={x:0,y:0};switch(t){case"top":o.y=i.minY-n.minY;break;case"center-vertical":o.y=i.midY-n.minY-n.height/2;break;case"bottom":o.y=i.maxY-n.minY-n.height;break;case"left":o.x=i.minX-n.minX;break;case"center-horizontal":o.x=i.midX-n.minX-n.width/2;break;case"right":o.x=i.maxX-n.minX-n.width}const a=this.getShapeParent(e),l=a?Vs.Rot(o,-this.getShapePageTransform(a).decompose().rotation):o;s.push(this.getChangesToTranslateShape(e,Vs.Add(e,l)))})),this.updateShapes(s),this}distributeShapes(e,t){const n="string"===typeof e[0]?e:e.map((e=>e.id));if(this.getIsReadonly())return this;if(n.length<3)return this;const o=n.length,r=C(n.map((e=>this.getShape(e)))),i=Object.fromEntries(r.map((e=>[e.id,this.getShapePageBounds(e)])));let s,a,l,c,d;"horizontal"===t?(s="x",a="minX",l="maxX",c="midX",d="width"):(s="y",a="minY",l="maxY",c="midY",d="height");const u=[],h=r.sort(((e,t)=>i[e.id][a]-i[t.id][a]))[0],p=r.sort(((e,t)=>i[t.id][l]-i[e.id][l]))[0],f=i[h.id][c],g=(i[p.id][c]-f)/(o-1),m=f+g;return r.filter((e=>e!==h&&e!==p)).sort(((e,t)=>i[e.id][c]-i[t.id][c])).forEach(((e,t)=>{const n={x:0,y:0};n[s]=m+g*t-i[e.id][d]/2-i[e.id][s];const o=this.getShapeParent(e),r=o?Vs.Rot(n,-this.getShapePageTransform(o).rotation()):n;u.push(this.getChangesToTranslateShape(e,Vs.Add(e,r)))})),this.updateShapes(u),this}stretchShapes(e,t){const n="string"===typeof e[0]?e:e.map((e=>e.id));if(this.getIsReadonly())return this;if(n.length<2)return this;const o=C(n.map((e=>this.getShape(e)))),r=Object.fromEntries(n.map((e=>[e,this.getShapeGeometry(e).bounds]))),i=Object.fromEntries(n.map((e=>[e,this.getShapePageBounds(e)]))),s=rc.Common(C(Object.values(i)));switch(t){case"vertical":this.run((()=>{for(const e of o){if(this.getShapePageTransform(e).rotation()%$s)continue;const t=r[e.id],n=i[e.id],o=new Vs(0,s.minY-n.minY),a=this.getShapeParentTransform(e);a&&o.rot(-a.rotation());const{x:l,y:c}=Vs.Add(o,e);this.updateShapes([{id:e.id,type:e.type,x:l,y:c}]);const d=new Vs(1,s.height/n.height);this.resizeShape(e.id,d,{initialBounds:t,scaleOrigin:new Vs(n.center.x,s.minY),isAspectRatioLocked:this.getShapeUtil(e).isAspectRatioLocked(e),scaleAxisRotation:0})}}));break;case"horizontal":this.run((()=>{for(const e of o){const t=r[e.id],n=i[e.id];if(this.getShapePageTransform(e).rotation()%$s)continue;const o=new Vs(s.minX-n.minX,0),a=this.getShapeParentTransform(e);a&&o.rot(-a.rotation());const{x:l,y:c}=Vs.Add(o,e);this.updateShapes([{id:e.id,type:e.type,x:l,y:c}]);const d=new Vs(s.width/n.width,1);this.resizeShape(e.id,d,{initialBounds:t,scaleOrigin:new Vs(s.minX,n.center.y),isAspectRatioLocked:this.getShapeUtil(e).isAspectRatioLocked(e),scaleAxisRotation:0})}}))}return this}resizeShape(e,t){var n,o,r,i,s,a;let c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const d="string"===typeof e?e:e.id;if(this.getIsReadonly())return this;Number.isFinite(t.x)||(t=new Vs(1,t.y)),Number.isFinite(t.y)||(t=new Vs(t.x,1));const u=null!==(n=c.initialShape)&&void 0!==n?n:this.getShape(d);if(!u)return this;const h=null!==(o=c.scaleOrigin)&&void 0!==o?o:null===(r=this.getShapePageBounds(d))||void 0===r?void 0:r.center;if(!h)return this;const p=c.initialPageTransform?ic.Cast(c.initialPageTransform):this.getShapePageTransform(d);if(!p)return this;const f=p.rotation();if(null==f)return this;const g=null!==(i=c.scaleAxisRotation)&&void 0!==i?i:f,m=null!==(s=c.initialBounds)&&void 0!==s?s:this.getShapeGeometry(d).bounds;if(!m)return this;const y=null!==(a=c.isAspectRatioLocked)&&void 0!==a?a:this.getShapeUtil(u).isAspectRatioLocked(u);if(!la(f,g))return this._resizeUnalignedShape(d,t,l(l({},c),{},{initialBounds:m,scaleOrigin:h,scaleAxisRotation:g,initialPageTransform:p,isAspectRatioLocked:y,initialShape:u}));const v=this.getShapeUtil(u);if(y&&(t=Math.abs(t.x)>Math.abs(t.y)?new Vs(t.x,Math.sign(t.y)*Math.abs(t.x)):new Vs(Math.sign(t.x)*Math.abs(t.y),t.y)),v.onResize&&v.canResize(u)){var b,w;const e=this._scalePagePoint(ic.applyToPoint(p,new Vs(0,0)),h,t,g),n=this.getPointInParentSpace(u.id,e),o=new Vs(t.x,t.y),r=ea((f-g)%Math.PI,0);o.x=r?t.x:t.y,o.y=r?t.y:t.x;const i=ic.applyToPoint(p,new Vs),{x:s,y:a}=this.getPointInParentSpace(u.id,i);let y=u;var x,S,k,P;if(!c.skipStartAndEndCallbacks)y=rv(u,null!==(x=null===(S=v.onResizeStart)||void 0===S?void 0:S.call(v,u))&&void 0!==x?x:void 0);if(y=rv(y,l({id:d,type:u.type,x:n.x,y:n.y},v.onResize(l(l({},u),{},{x:s,y:a}),{newPoint:n,handle:null!==(b=c.dragHandle)&&void 0!==b?b:"bottom_right",mode:null!==(w=c.mode)&&void 0!==w?w:"scale_shape",scaleX:o.x,scaleY:o.y,initialBounds:m,initialShape:u}))),!c.skipStartAndEndCallbacks)y=rv(y,null!==(k=null===(P=v.onResizeEnd)||void 0===P?void 0:P.call(v,u,y))&&void 0!==k?k:void 0);this.updateShapes([y])}else{const e=ic.applyToPoint(p,m.center),n=this._scalePagePoint(e,h,t,g),o=this.getPointInParentSpace(u.id,e),r=this.getPointInParentSpace(u.id,n),i=Vs.Sub(r,o);this.updateShapes([{id:d,type:u.type,x:u.x+i.x,y:u.y+i.y}])}return this}_scalePagePoint(e,t,n,o){const r=Vs.RotWith(e,t,-o).sub(t),i=Vs.MulV(r,n);return Vs.Add(i,t).rotWith(t,o)}_resizeUnalignedShape(e,t,n){const{type:o}=n.initialShape,r=new Vs(t.x,t.y);if(Math.abs(t.x)>Math.abs(t.y)?r.x=Math.sign(t.x)*Math.abs(t.y):r.y=Math.sign(t.y)*Math.abs(t.x),this.resizeShape(e,r,{initialShape:n.initialShape,initialBounds:n.initialBounds,isAspectRatioLocked:n.isAspectRatioLocked}),Math.sign(t.x)*Math.sign(t.y)<0){let{rotation:t}=ic.Decompose(n.initialPageTransform);t-=2*t,this.updateShapes([{id:e,type:o,rotation:t}])}const i=ic.applyToPoint(n.initialPageTransform,n.initialBounds.center),s=this._scalePagePoint(i,n.scaleOrigin,t,n.scaleAxisRotation),a=this.getShapePageBounds(e),l=this.getShapePageTransform(e),c=a.center,d=l.point();if(!c||!d)return this;const u=Vs.Sub(s,c),h=Vs.Add(d,u),{x:p,y:f}=this.getPointInParentSpace(e,h);return this.updateShapes([{id:e,type:o,x:p,y:f}]),this}getInitialMetaForShape(e){return{}}createShape(e){return this.createShapes([e]),this}createShapes(e){if(!Array.isArray(e))throw Error("Editor.createShapes: must provide an array of shapes or shape partials");if(this.getIsReadonly())return this;if(e.length<=0)return this;const t=this.getCurrentPageShapeIds();if(e.length+t.size>this.options.maxShapesPerPage)return ov(this),this;const n=this.getFocusedGroupId();return this.run((()=>{const t=this.getCurrentPageShapesSorted(),o=e.map((o=>{if(o.id||(o=l({id:Ko()},o)),!o.parentId||!this.store.has(o.parentId)&&!e.some((e=>e.id===o.parentId))){let e=this.getFocusedGroupId();for(let n=t.length-1;n>=0;n--){var r,i;const s=t[n];if(!this.isShapeHidden(s)&&this.getShapeUtil(s).canReceiveNewChildrenOfType(s,o.type)&&this.isPointInShape(s,{x:null!==(r=o.x)&&void 0!==r?r:0,y:null!==(i=o.y)&&void 0!==i?i:0},{margin:0,hitInside:!0})){e=s.id;break}}const d=o.parentId;if(e===o.id&&(e=n),e!==d&&((o=l({},o)).parentId=e,Ho(e))){var s,a,c;const t=this.getPointInShapeSpace(this.getShape(e),{x:null!==(s=o.x)&&void 0!==s?s:0,y:null!==(a=o.y)&&void 0!==a?a:0});o.x=t.x,o.y=t.y,o.rotation=-this.getShapePageTransform(e).rotation()+(null!==(c=o.rotation)&&void 0!==c?c:0)}}return o})),r=new Map,i=[],{opacityForNextShape:s}=this.getInstanceState();for(const e of o){var a,c,d,u;const t=this.getShapeUtil(e);let o=e.index;if(!o){var h;const t=null!==(h=e.parentId)&&void 0!==h?h:n;r.has(t)||r.set(t,this.getHighestIndexForParent(t)),o=r.get(t),r.set(t,Ze(o))}const p=t.getDefaultProps();for(const[n,r]of this.styleProps[e.type])p[r]=this.getStyleForNextShape(n);let f=this.store.schema.types.shape.create(l(l({},e),{},{index:o,opacity:null!==(a=e.opacity)&&void 0!==a?a:s,parentId:null!==(c=e.parentId)&&void 0!==c?c:n,props:"props"in e?l(l({},p),e.props):p}));if(void 0===f.index)throw Error("no index!");const g=null===(d=(u=this.getShapeUtil(f)).onBeforeCreate)||void 0===d?void 0:d.call(u,f);g&&(f=g),i.push(f)}i.forEach((e=>{e.meta=l(l({},this.getInitialMetaForShape(e)),e.meta)})),this.store.put(i)})),this}animateShape(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{animation:Ca};return this.animateShapes([e],t)}animateShapes(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{animation:Ca};if(!t.animation)return this;const{duration:n=500,easing:o=Ks.linear}=t.animation,r=$();let i,s=n;const a=[];let c,d;for(let l=0,h=e.length;l<h;l++){if(c=e[l],!c)continue;const t=this.getShape(c.id);t&&(d={start:bt(t),end:rv(bt(t),c)},a.push(d),this.animatingShapes.set(t.id,r))}const u=t=>{if(s-=t,s<0){const{animatingShapes:t}=this,n=e.filter((e=>e&&t.get(e.id)===r));return n.length&&this.updateShapes(n),void this.off("tick",u)}i=o(1-s/n);const{animatingShapes:c}=this,d=[];let h;for(let e=0,n=a.length;e<n;e++){var p,f,g;const{start:t,end:n}=a[e];h=c.get(t.id),h===r&&d.push(l(l({},n),{},{x:t.x+(n.x-t.x)*i,y:t.y+(n.y-t.y)*i,opacity:t.opacity+(n.opacity-t.opacity)*i,rotation:t.rotation+(n.rotation-t.rotation)*i,props:null!==(p=null===(f=(g=this.getShapeUtil(n)).getInterpolatedProps)||void 0===f?void 0:f.call(g,t,n,i))&&void 0!==p?p:n.props}))}this._updateShapes(d)};return this.on("tick",u),this}groupShapes(e){var t,n;let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{groupId:r=Ko(),select:i=!0}=o;if(!Array.isArray(e))throw Error("Editor.groupShapes: must provide an array of shapes or shape ids");if(this.getIsReadonly())return this;const s="string"===typeof e[0]?e:e.map((e=>e.id));if(s.length<=1)return this;const a=C((this._shouldIgnoreShapeLock?s:this._getUnlockedShapeIds(s)).map((e=>this.getShape(e)))),l=a.sort(Je).map((e=>e.id)),c=rc.Common(C(a.map((e=>this.getShapePageBounds(e))))),{x:d,y:u}=c.point,h=null!==(t=this.findCommonAncestor(a))&&void 0!==t?t:this.getCurrentPageId();if("select"!==this.getCurrentToolId())return this;this.isIn("select.idle")||this.cancel();const p=a.filter((e=>e.parentId===h)).sort(Je),f=null===(n=p[p.length-1])||void 0===n?void 0:n.index;return this.run((()=>{this.createShapes([{id:r,type:"group",parentId:h,index:f,x:d,y:u,opacity:1,props:{}}]),this.reparentShapes(l,r),i&&this.select(r)})),this}ungroupShapes(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.getIsReadonly())return this;const{select:n=!0}=t,o="string"===typeof e[0]?e:e.map((e=>e.id)),r=C((this._shouldIgnoreShapeLock?o:this._getUnlockedShapeIds(o)).map((e=>this.getShape(e))));if(0===r.length)return this;if("select"!==this.getCurrentToolId())return this;this.isIn("select.idle")||this.cancel();const i=new Set,s=[];return r.forEach((e=>{this.isShapeOfType(e,"group")?s.push(e):i.add(e.id)})),0===s.length||this.run((()=>{let e;for(let t=0,n=s.length;t<n;t++){e=s[t];const n=this.getSortedChildIdsForParent(e.id);for(let e=0,t=n.length;e<t;e++)i.add(n[e]);this.reparentShapes(n,e.parentId,e.index)}this.deleteShapes(s.map((e=>e.id))),n&&this.select(...i)})),this}updateShape(e){return this.updateShapes([e]),this}updateShapes(e){const t=Array(e.length);for(let n=0,o=e.length;n<o;n++){const o=e[n];if(!o)continue;const r=this.getShape(o.id);if(r){if(!this._shouldIgnoreShapeLock)if(r.isLocked){if(!Object.hasOwn(o,"isLocked")||o.isLocked)continue}else if(this.isShapeOrAncestorLocked(r))continue;this.animatingShapes.delete(o.id),t.push(o)}}return this._updateShapes(t),this}_updateShapes(e){this.getIsReadonly()||this.run((()=>{const t=[];let n,o;for(let a=0,l=e.length;a<l;a++){var r,i,s;const l=e[a];l&&(n=this.getShape(l.id),n&&(o=rv(n,l),o!==n&&(o=null!==(r=null===(i=(s=this.getShapeUtil(n)).onBeforeUpdate)||void 0===i?void 0:i.call(s,n,o))&&void 0!==r?r:o,t.push(o))))}this.store.put(t)}))}_getUnlockedShapeIds(e){return e.filter((e=>{var t;return!(null!==(t=this.getShape(e))&&void 0!==t&&t.isLocked)}))}deleteShapes(e){if(this.getIsReadonly())return this;if(!Array.isArray(e))throw Error("Editor.deleteShapes: must provide an array of shapes or shapeIds");const t="string"===typeof e[0]?e:e.map((e=>e.id)),n=this._shouldIgnoreShapeLock?t:this._getUnlockedShapeIds(t);if(0===n.length)return this;const o=new Set(n);for(const r of n)this.visitDescendants(r,(e=>{o.add(e)}));return this.run((()=>this.store.remove([...o])))}deleteShape(e){return this.deleteShapes(["string"===typeof e?e:e.id]),this}_extractSharedStyles(e,t){if(this.isShapeOfType(e,"group")){const n=this._parentIdsToChildIds.get()[e.id];if(!n)return;for(let e=0,o=n.length;e<o;e++)this._extractSharedStyles(this.getShape(n[e]),t)}else for(const[n,o]of this.styleProps[e.type])t.applyValue(n,he(e.props,o))}_getSelectionSharedStyles(){const e=this.getSelectedShapes(),t=new op;for(const n of e)this._extractSharedStyles(n,t);return t}getStyleForNextShape(e){const t=this.getInstanceState().stylesForNextShape[e.id];return void 0===t?e.defaultValue:t}getShapeStyleIfExists(e,t){const n=this.styleProps[e.type].get(t);if(void 0!==n)return he(e.props,n)}getSharedStyles(){if(this.isIn("select")&&this.getSelectedShapeIds().length>0)return this._getSelectionSharedStyles();const e=this.root.getCurrent(),t=new op;if(!e)return t;if(e.shapeType)for(const n of this.styleProps[e.shapeType].keys())t.applyValue(n,this.getStyleForNextShape(n));return t}getSharedOpacity(){if(this.isIn("select")&&this.getSelectedShapeIds().length>0){const e=[],t=n=>{const o=this.getShape(n);if(o)if(this.isShapeOfType(o,"group"))for(const e of this.getSortedChildIdsForParent(o.id))t(e);else e.push(o)};for(const o of this.getSelectedShapeIds())t(o);let n=null;for(const o of e)if(null===n)n=o.opacity;else if(n!==o.opacity)return{type:"mixed"};if(null!==n)return{type:"shared",value:n}}return{type:"shared",value:this.getInstanceState().opacityForNextShape}}setOpacityForNextShapes(e,t){return this.updateInstanceState({opacityForNextShape:e},t),this}setOpacityForSelectedShapes(e){const t=this.getSelectedShapes();if(t.length>0){const n=[],o=e=>{if(this.isShapeOfType(e,"group")){const t=this.getSortedChildIdsForParent(e);for(const e of t)o(this.getShape(e))}else n.push(e)};for(const e of t)o(e);this.updateShapes(n.map((t=>({id:t.id,type:t.type,opacity:e}))))}return this}setStyleForNextShapes(e,t,n){const o=this.getInstanceState().stylesForNextShape;return this.updateInstanceState({stylesForNextShape:l(l({},o),{},{[e.id]:t})},n),this}setStyleForSelectedShapes(e,t){const n=this.getSelectedShapes();if(n.length>0){const o=[],r=n=>{if(this.isShapeOfType(n,"group")){const e=this.getSortedChildIdsForParent(n.id);for(const t of e)r(this.getShape(t))}else{const r=this.getShapeUtil(n),i=this.styleProps[n.type].get(e);if(i){const e={id:n.id,type:n.type,props:{[i]:t}};o.push({util:r,originalShape:n,updatePartial:e})}}};for(const e of n)r(e);this.updateShapes(o.map((e=>{let{updatePartial:t}=e;return t})))}return this}registerExternalAssetHandler(e,t){return this.externalAssetContentHandlers[e]=t,this}createTemporaryAssetPreview(e,t){if(this.temporaryAssetPreview.has(e))return this.temporaryAssetPreview.get(e);const n=URL.createObjectURL(t);return this.temporaryAssetPreview.set(e,n),setTimeout((()=>{this.temporaryAssetPreview.delete(e),URL.revokeObjectURL(n)}),this.options.temporaryAssetPreviewLifetimeMs),n}getTemporaryAssetPreview(e){return this.temporaryAssetPreview.get(e)}async getAssetForExternalContent(e){var t,n;return await(null===(t=(n=this.externalAssetContentHandlers)[e.type])||void 0===t?void 0:t.call(n,e))}hasExternalAssetHandler(e){return!!this.externalAssetContentHandlers[e]}registerExternalContentHandler(e,t){return this.externalContentHandlers[e]=t,this}async putExternalContent(e){var t,n;return null===(t=(n=this.externalContentHandlers)[e.type])||void 0===t?void 0:t.call(n,e)}getContentFromCurrentPage(e){const t="string"===typeof e[0]?e:e.map((e=>e.id));if(!t)return;if(0===t.length)return;const n=this.getShapeAndDescendantIds(t);return sv(this,n,(e=>{const t=[];for(const n of e){const e=this.getBinding(n);e&&t.push(e)}const o=[],r=[];for(const a of n){const e=this.getShape(a);if(!e)continue;if(!n.has(e.parentId)){const t=this.getShapePageTransform(e.id),n=t.point();r.push(l(l({},e),{},{x:n.x,y:n.y,rotation:t.rotation(),parentId:this.getCurrentPageId()})),o.push(e.id)}else r.push(e)}const i=[],s=new Set;for(const n of r){if(!("assetId"in n.props))continue;const e=n.props.assetId;if(!e||s.has(e))continue;s.add(e);const t=this.getAsset(e);t&&i.push(t)}return{schema:this.store.schema.serialize(),shapes:r,rootShapeIds:o,bindings:t,assets:i}}))}async resolveAssetsInContent(e){if(!e)return;const t=[];return await Promise.allSettled(e.assets.map((async e=>{var n,o,r;if("image"!==e.type&&"video"!==e.type||null!==(n=e.props.src)&&void 0!==n&&n.startsWith("data:image")||null!==(o=e.props.src)&&void 0!==o&&o.startsWith("data:video")||null!==(r=e.props.src)&&void 0!==r&&r.startsWith("http"))t.push(e);else{const n=bt(e),o=await this.store.props.assets.resolve(e,{screenScale:1,steppedScreenScale:1,dpr:1,networkEffectiveType:null,shouldResolveToOriginal:!0});n.props.src=await H.blobToDataUrl(await B(o).then((e=>e.blob()))),t.push(n)}}))),e.assets=t,e}putContentOntoCurrentPage(e){var t,n;let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.getIsReadonly())return this;if(!e.schema)throw Error("Could not put content:\ncontent is missing a schema.");const{select:r=!1,preserveIds:i=!1,preservePosition:s=!1}=o;let{point:a}=o;const c=this.getCurrentPageId(),{rootShapeIds:d}=e,u=[],h=[],p=[],f={store:l(l(l({},Object.fromEntries(e.assets.map((e=>[e.id,e])))),Object.fromEntries(e.shapes.map((e=>[e.id,e])))),Object.fromEntries(null!==(t=null===(n=e.bindings)||void 0===n?void 0:n.map((e=>[e.id,e])))&&void 0!==t?t:[])),schema:e.schema},g=this.store.schema.migrateStoreSnapshot(f);if("error"===g.type)throw Error("Could not put content: could not migrate content");for(const l of Object.values(g.value))switch(l.typeName){case"asset":u.push(l);break;case"shape":h.push(l);break;case"binding":p.push(l)}const m=new Map(i?h.map((e=>[e.id,e.id])):h.map((e=>[e.id,Ko()]))),y=new Map(i?p.map((e=>[e.id,e.id])):p.map((e=>[e.id,Ro()])));let v=this.getCurrentPageId(),b=1/0,w=[];for(const l of this.getSelectedShapes()){if(0===b)break;const e=this.isShapeOfType(l,"frame"),t=this.getShapeAncestors(l);e&&t.push(l);const n=e?t.length+1:t.length;if(n<b)b=n,w=t,v=e?l.id:l.parentId;else if(n===b){if(w.length!==t.length)throw Error("Ancestors: ".concat(w.length," !== ").concat(t.length));if(0===w.length){v=c;break}v=c;for(let e=0;e<w.length&&t[e]===w[e];e++)v=t[e].id}}let x=!1;if(!Ir(v)){const e=this.getShape(v);if(e)if(this.getViewportPageBounds().includes(this.getShapePageBounds(e))){if(1===d.length){const t=h.find((e=>e.id===d[0]));this.isShapeOfType(e,"frame")&&this.isShapeOfType(t,"frame")&&t.props.w===(null===e||void 0===e?void 0:e.props.w)&&t.props.h===(null===e||void 0===e?void 0:e.props.h)&&(x=!0)}}else v=c;else v=c}x||(x=m.has(v)),x&&(v=this.getShape(v).parentId);let S=this.getHighestIndexForParent(v);const k=[],P=h.map((e=>{const t=m.get(e.id),n=l(l({},e),{},{id:t});return d.includes(e.id)&&(n.parentId=c,k.push(n)),m.has(n.parentId)?n.parentId=m.get(e.parentId):(d.push(n.id),n.index=S,S=Ze(S)),n}));if(P.length+this.getCurrentPageShapeIds().size>this.options.maxShapesPerPage)return ov(this),this;const _=p.map((e=>l(l({},e),{},{id:A(y.get(e.id)),fromId:A(m.get(e.fromId)),toId:A(m.get(e.toId))}))),I=[],E=[];for(const l of u){var j,T;this.store.has(l.id)||(("image"===l.type&&null!==(j=l.props.src)&&void 0!==j&&j.startsWith("data:image")||"video"===l.type&&null!==(T=l.props.src)&&void 0!==T&&T.startsWith("data:video"))&&(E.push(bt(l)),l.props.src=null),I.push(l))}return Promise.allSettled(E.map((async e=>{var t;const n=await(o=e.props.src,r=e.props.name,i=null!==(t=e.props.mimeType)&&void 0!==t?t:"image/png",B(o).then((function(e){return e.arrayBuffer()})).then((function(e){return new File([e],r,{type:i})})));var o,r,i;const s=await this.getAssetForExternalContent({type:"file",file:n,assetId:e.id});s?this.updateAssets([l(l({},s),{},{id:e.id})]):this.deleteAssets([e.id])}))),this.run((()=>{I.length>0&&this.createAssets(I),this.createShapes(P),this.createBindings(_),r&&this.select(...k.map((e=>e.id))),v!==c&&this.reparentShapes(k.map((e=>e.id)),v);const e=P.map((e=>this.getShape(e.id))),t=rc.Common(e.map((e=>this.getShapePageBounds(e))));if(void 0===a)if(Ir(v)){const e=this.getViewportPageBounds();a=s||e.includes(rc.From(t))?t.center:e.center}else{const e=this.getShape(v);a=ic.applyToPoint(this.getShapePageTransform(e),this.getShapeGeometry(e).bounds.center)}if(1===k.length){const e=k[0];if(this.isShapeOfType(e,"frame"))for(;this.getShapesAtPoint(a).some((t=>this.isShapeOfType(t,"frame")&&t.props.w===e.props.w&&t.props.h===e.props.h));)a.x+=t.w+16}const n=rc.Common(C(k.map((e=>{let{id:t}=e;return this.getShapePageBounds(t)})))).center,o=Vs.Sub(a,n);this.updateShapes(k.map((e=>{let{id:t}=e;const n=this.getShape(t),r=this.getShapeParentTransform(t).decompose().rotation,i=Vs.Rot(o,-r);return{id:n.id,type:n.type,x:n.x+i.x,y:n.y+i.y}})))})),this}async getSvgElement(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n="string"===typeof e[0]?e:e.map((e=>e.id));if(0!==n.length)return Zh(this,n,t)}async getSvgString(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=await this.getSvgElement(e,t);if(!n)return;return{svg:(new XMLSerializer).serializeToString(n.svg),width:n.width,height:n.height}}async getSvg(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=await this.getSvgElement(e,t);if(n)return n.svg}_updateInputsFromEvent(e){var t;const{pointerVelocity:n,previousScreenPoint:o,previousPagePoint:r,currentScreenPoint:i,currentPagePoint:s}=this.inputs,{screenBounds:a}=this.store.unsafeGetWithoutCapture(Wr),{x:l,y:c,z:d}=Rt((()=>this.getCamera())),u=e.point.x-a.x,h=e.point.y-a.y,p=null!==(t=e.point.z)&&void 0!==t?t:.5;o.setTo(i),r.setTo(s),i.set(u,h);const f=u/d-l,g=h/d-c;isFinite(f)&&isFinite(g)&&s.set(f,g,p),this.inputs.isPen="pointer"===e.type&&e.isPen,("pointer_down"===e.name||this.inputs.isPinching)&&(n.set(0,0),this.inputs.originScreenPoint.setTo(i),this.inputs.originPagePoint.setTo(s)),this.run((()=>{var t,n;this.store.put([{id:Jr,typeName:"pointer",x:s.x,y:s.y,lastActivityTimestamp:"pointer"===e.type&&e.pointerId===_a&&null!==(t=null===(n=this.store.unsafeGetWithoutCapture(Jr))||void 0===n?void 0:n.lastActivityTimestamp)&&void 0!==t?t:this._tickManager.now,meta:{}}])}),{history:"ignore"})}cancel(){return this.dispatch({type:"misc",name:"cancel"}),this}interrupt(){return this.dispatch({type:"misc",name:"interrupt"}),this}complete(){return this.dispatch({type:"misc",name:"complete"}),this}focus(){let{focusContainer:e=!0}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.getIsFocused()||(e&&this.focusManager.focus(),this.updateInstanceState({isFocused:!0})),this}blur(){let{blurContainer:e=!0}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.getIsFocused()?(e?this.focusManager.blur():this.complete(),this.updateInstanceState({isFocused:!1}),this):this}getIsFocused(){return this.getInstanceState().isFocused}getIsReadonly(){return this.getInstanceState().isReadonly}getSnapshot(){return function(e){const t=Qd.get(e,Xd).get();if(!t)throw new Error("Session state is not ready yet");return{document:e.getStoreSnapshot(),session:t}}(this.store)}loadSnapshot(e,t){return Zd(this.store,e,t),this}_zoomToFitPageContentAt100Percent(){const e=this.getCurrentPageBounds();e&&this.zoomToBounds(e,{immediate:!0,targetZoom:this.getBaseZoom()})}_navigateToDeepLink(e){this.run((()=>{switch(e.type){case"page":{const t=this.getPage(e.pageId);return t&&this.setCurrentPage(t),void this._zoomToFitPageContentAt100Percent()}case"shapes":{var t;const o=C(e.shapeIds.map((e=>this.getShape(e)))),r={};for(const e of o){var n;const t=this.getAncestorPageId(e);t&&(null!==(n=r[t])&&void 0!==n||(r[t]=[]),r[t].push(e))}const[i,s]=null!==(t=Object.entries(r).sort(((e,t)=>{let[n,o]=e,[r,i]=t;return i.length-o.length}))[0])&&void 0!==t?t:["",[]];if(i&&s.length){this.setCurrentPage(i);const e=rc.Common(s.map((e=>this.getShapePageBounds(e))));this.zoomToBounds(e,{immediate:!0,targetZoom:this.getBaseZoom()})}else this._zoomToFitPageContentAt100Percent();return}case"viewport":if(e.pageId){if(!this.getPage(e.pageId))return void this._zoomToFitPageContentAt100Percent();this.setCurrentPage(e.pageId)}return void this.zoomToBounds(e.bounds,{immediate:!0,inset:0});default:T(e)}}))}navigateToDeepLink(e){var t,n;if(e&&"type"in e)return this._navigateToDeepLink(e),this;const o=new URL(null!==(t=null===e||void 0===e?void 0:e.url)&&void 0!==t?t:window.location.href).searchParams.get(null!==(n=null===e||void 0===e?void 0:e.param)&&void 0!==n?n:"d");if(!o)return this._zoomToFitPageContentAt100Percent(),this;try{this._navigateToDeepLink(function(e){switch(e[0]){case"s":return{type:"shapes",shapeIds:e.slice(1).split(".").filter(Boolean).map((e=>Ko(decodeURIComponent(e))))};case"p":return{type:"page",pageId:_r.createId(decodeURIComponent(e.slice(1)))};case"v":{const[t,n,o,r,i]=e.slice(1).split(".");return{type:"viewport",bounds:new rc(Number(t),Number(n),Number(o),Number(r)),pageId:i?_r.createId(decodeURIComponent(i)):void 0}}default:throw Error("Invalid deep link string")}}(o))}catch(r){console.warn(r),this._zoomToFitPageContentAt100Percent()}return this}createDeepLink(e){var t,n,o;const r=new URL(null!==(t=null===e||void 0===e?void 0:e.url)&&void 0!==t?t:window.location.href);return r.searchParams.set(null!==(n=null===e||void 0===e?void 0:e.param)&&void 0!==n?n:"d",function(e){switch(e.type){case"shapes":{const t=e.shapeIds.map((e=>ip(e.slice(6))));return"s".concat(t.join("."))}case"page":return"p"+ip(_r.parseId(e.pageId));case"viewport":{const{bounds:t,pageId:n}=e;let o="v".concat(Math.round(t.x),".").concat(Math.round(t.y),".").concat(Math.round(t.w),".").concat(Math.round(t.h));return n&&(o+="."+ip(_r.parseId(n))),o}default:T(e)}}(null!==(o=null===e||void 0===e?void 0:e.to)&&void 0!==o?o:{type:"viewport",pageId:1===this.options.maxPages?void 0:this.getCurrentPageId(),bounds:this.getViewportPageBounds()})),r}registerDeepLinkListener(e){var t,n;if(null!==e&&void 0!==e&&e.getUrl&&(null===e||void 0===e||!e.onChange))throw Error("[tldraw:urlStateSync] If you specify getUrl, you must also specify the onChange callback.");const o=cn("url with state",(()=>{var t,n,o;const r=null!==(t=null===e||void 0===e||null===(n=e.getUrl)||void 0===n?void 0:n.call(e,this))&&void 0!==t?t:window.location.href;return this.createDeepLink({param:null===e||void 0===e?void 0:e.param,url:r,to:null===e||void 0===e||null===(o=e.getTarget)||void 0===o?void 0:o.call(e,this)}).toString()})),r=null!==(t=null===e||void 0===e?void 0:e.onChange)&&void 0!==t?t:()=>{var t;const n=this.createDeepLink({param:null===e||void 0===e?void 0:e.param,to:null===e||void 0===e||null===(t=e.getTarget)||void 0===t?void 0:t.call(e,this)});window.history.replaceState({},document.title,n.toString())},i=z((e=>e()),null!==(n=null===e||void 0===e?void 0:e.debounceMs)&&void 0!==n?n:500),s=Ht("update url on state change",(()=>r(new URL(o.get()),this)),{scheduleEffect:i});return()=>{s(),i.cancel()}}cancelDoubleClick(){this._clickManager.cancelDoubleClickTimeout()}_setShiftKeyTimeout(){this.inputs.shiftKey=!1,this.dispatch({type:"keyboard",name:"key_up",key:"Shift",shiftKey:this.inputs.shiftKey,ctrlKey:this.inputs.ctrlKey,altKey:this.inputs.altKey,metaKey:this.inputs.metaKey,accelKey:Fa(this.inputs),code:"ShiftLeft"})}_setAltKeyTimeout(){this.inputs.altKey=!1,this.dispatch({type:"keyboard",name:"key_up",key:"Alt",shiftKey:this.inputs.shiftKey,ctrlKey:this.inputs.ctrlKey,altKey:this.inputs.altKey,metaKey:this.inputs.metaKey,accelKey:Fa(this.inputs),code:"AltLeft"})}_setCtrlKeyTimeout(){this.inputs.ctrlKey=!1,this.dispatch({type:"keyboard",name:"key_up",key:"Ctrl",shiftKey:this.inputs.shiftKey,ctrlKey:this.inputs.ctrlKey,altKey:this.inputs.altKey,metaKey:this.inputs.metaKey,accelKey:Fa(this.inputs),code:"ControlLeft"})}_setMetaKeyTimeout(){this.inputs.metaKey=!1,this.dispatch({type:"keyboard",name:"key_up",key:"Meta",shiftKey:this.inputs.shiftKey,ctrlKey:this.inputs.ctrlKey,altKey:this.inputs.altKey,metaKey:this.inputs.metaKey,accelKey:Fa(this.inputs),code:"MetaLeft"})}dispatch(e){return this._pendingEventsForNextTick.push(e),"pointer"===e.type&&"pointer_move"===e.name||"wheel"===e.type||"pinch"===e.type||this._flushEventsForTick(0),this}_flushEventsForTick(e){this.run((()=>{if(this._pendingEventsForNextTick.length>0){const e=[...this._pendingEventsForNextTick];this._pendingEventsForNextTick.length=0;for(const t of e)this._flushEventForTick(t)}e>0&&this.root.handleEvent({type:"misc",name:"tick",elapsed:e}),this.scribbles.tick(e)}))}_flushEventForTick(e){if(this.getCrashingError())return this;const{inputs:t}=this,{type:n}=e;if("misc"===e.type)return"cancel"!==e.name&&"complete"!==e.name||(this.inputs.isDragging=!1,this.inputs.isPanning&&(this.inputs.isPanning=!1,this.inputs.isSpacebarPanning=!1,this.setCursor({type:this._prevCursor,rotation:0}))),void this.root.handleEvent(e);e.shiftKey?(clearTimeout(this._shiftKeyTimeout),this._shiftKeyTimeout=-1,t.shiftKey=!0):!e.shiftKey&&t.shiftKey&&-1===this._shiftKeyTimeout&&(this._shiftKeyTimeout=this.timers.setTimeout(this._setShiftKeyTimeout,150)),e.altKey?(clearTimeout(this._altKeyTimeout),this._altKeyTimeout=-1,t.altKey=!0):!e.altKey&&t.altKey&&-1===this._altKeyTimeout&&(this._altKeyTimeout=this.timers.setTimeout(this._setAltKeyTimeout,150)),e.ctrlKey?(clearTimeout(this._ctrlKeyTimeout),this._ctrlKeyTimeout=-1,t.ctrlKey=!0):!e.ctrlKey&&t.ctrlKey&&-1===this._ctrlKeyTimeout&&(this._ctrlKeyTimeout=this.timers.setTimeout(this._setCtrlKeyTimeout,150)),e.metaKey?(clearTimeout(this._metaKeyTimeout),this._metaKeyTimeout=-1,t.metaKey=!0):!e.metaKey&&t.metaKey&&-1===this._metaKeyTimeout&&(this._metaKeyTimeout=this.timers.setTimeout(this._setMetaKeyTimeout,150));const{originPagePoint:o,currentPagePoint:r}=t;t.isPointing||(t.isDragging=!1);const i=this.store.unsafeGetWithoutCapture(Wr),s=this.store.get(this._getCurrentPageStateId()),a=this._cameraOptions.__unsafe__getWithoutCapture();switch(n){case"pinch":if(a.isLocked)return;switch(clearTimeout(this._longPressTimeout),this._updateInputsFromEvent(e),e.name){case"pinch_start":if(t.isPinching)return;return void(t.isEditing||(this._pinchStart=this.getCamera().z,this._selectedShapeIdsAtPointerDown.length||(this._selectedShapeIdsAtPointerDown=[...s.selectedShapeIds]),this._didPinch=!0,t.isPinching=!0,this.interrupt()));case"pinch":{if(!t.isPinching)return;const{point:{z:n=1},delta:{x:o,y:r}}=e,{x:s,y:l}=Vs.SubXY(e.point,i.screenBounds.x,i.screenBounds.y);this.stopCameraAnimation(),i.followingUserId&&this.stopFollowingUser();const{x:c,y:d,z:u}=Rt((()=>this.getCamera())),{panSpeed:h,zoomSpeed:p}=a;return void this._setCamera(new Vs(c+o*h/u-s/u+s/(n*p),d+r*h/u-l/u+l/(n*p),n*p),{immediate:!0})}case"pinch_end":{if(!t.isPinching)return this;t.isPinching=!1;const{_selectedShapeIdsAtPointerDown:e}=this;return this.setSelectedShapes(this._selectedShapeIdsAtPointerDown),this._selectedShapeIdsAtPointerDown=[],void(this._didPinch&&(this._didPinch=!1,e.length>0&&this.once("tick",(()=>{this._didPinch||this.setSelectedShapes(e)}))))}}case"wheel":{if(a.isLocked)return;this._updateInputsFromEvent(e);const{panSpeed:n,zoomSpeed:o,wheelBehavior:r}=a;if("none"!==r){this.stopCameraAnimation(),i.followingUserId&&this.stopFollowingUser();const{x:s,y:a,z:l}=Rt((()=>this.getCamera())),{x:d,y:u,z:h=0}=e.delta;let p=r;switch(t.ctrlKey&&(p="pan"===r?"zoom":"pan"),p){case"zoom":{var c;const{x:e,y:t}=this.inputs.currentScreenPoint;let n=h;"zoom"===r&&(n=Math.abs(u)>10?10*Math.sign(u)/100:u/100);const i=l+(null!==(c=n)&&void 0!==c?c:0)*o*l;return this._setCamera(new Vs(s+(e/i-e)-(e/l-e),a+(t/i-t)-(t/l-t),i),{immediate:!0}),void this.maybeTrackPerformance("Zooming")}case"pan":return this._setCamera(new Vs(s+d*n/l,a+u*n/l,l),{immediate:!0}),void this.maybeTrackPerformance("Panning")}}break}case"pointer":{if(t.isPinching)return;this._updateInputsFromEvent(e);const{isPen:n}=e,{isPenMode:s}=i;switch(e.name){case"pointer_down":if(s&&!n)return;if(this.inputs.isPanning||(this._longPressTimeout=this.timers.setTimeout((()=>{const t=this.getViewportScreenBounds();this.dispatch(l(l({},e),{},{point:this.inputs.originScreenPoint.clone().addXY(t.x,t.y),name:"long_press"}))}),this.options.longPressDurationMs)),this._selectedShapeIdsAtPointerDown=this.getSelectedShapeIds(),0===e.button&&(this.capturedPointerId=e.pointerId),t.buttons.add(e.button),t.isPointing=!0,t.isDragging=!1,!s&&n&&this.updateInstanceState({isPenMode:!0}),5===e.button?(this._restoreToolId=this.getCurrentToolId(),this.complete(),this.setCurrentTool("eraser")):1===e.button&&(this.inputs.isPanning||(this._prevCursor=this.getInstanceState().cursor.type),this.inputs.isPanning=!0,clearTimeout(this._longPressTimeout)),this.inputs.isPanning)return this.stopCameraAnimation(),this.setCursor({type:"grabbing",rotation:0}),this;break;case"pointer_move":{if(!n&&s)return;const{x:e,y:l,z:c}=Rt((()=>this.getCamera()));if(this.inputs.isPanning&&this.inputs.isPointing){const{currentScreenPoint:t,previousScreenPoint:n}=this.inputs,{panSpeed:o}=a,r=Vs.Sub(t,n);return this.setCamera(new Vs(e+r.x*o/c,l+r.y*o/c,c),{immediate:!0}),void this.maybeTrackPerformance("Panning")}t.isPointing&&!t.isDragging&&Vs.Dist2(o,r)*this.getZoomLevel()>(i.isCoarsePointer?this.options.coarseDragDistanceSquared:this.options.dragDistanceSquared)/c&&(t.isDragging=!0,clearTimeout(this._longPressTimeout));break}case"pointer_up":if(t.isDragging=!1,t.isPointing=!1,clearTimeout(this._longPressTimeout),t.buttons.delete(e.button),i.isPenMode&&!n)return;if(this.capturedPointerId===e.pointerId&&(this.capturedPointerId=null,e.button=0),t.isPanning){t.keys.has("Space")||(t.isPanning=!1,t.isSpacebarPanning=!1);const n=this.inputs.pointerVelocity,o=Math.min(2,n.len());switch(e.button){case 0:this.setCursor({type:"grab",rotation:0});break;case 1:this.inputs.keys.has(" ")?this.setCursor({type:"grab",rotation:0}):this.setCursor({type:this._prevCursor,rotation:0})}o>0&&this.slideCamera({speed:o,direction:n})}else 5===e.button&&(this.complete(),this.setCurrentTool(this._restoreToolId))}break}case"keyboard":switch("ShiftRight"===e.key&&(e.key="ShiftLeft"),"AltRight"===e.key&&(e.key="AltLeft"),"ControlRight"===e.code&&(e.code="ControlLeft"),"MetaRight"===e.code&&(e.code="MetaLeft"),e.name){case"key_down":if(t.keys.add(e.code),"Space"!==e.code||e.ctrlKey||(this.inputs.isPanning||(this._prevCursor=i.cursor.type),this.inputs.isPanning=!0,this.inputs.isSpacebarPanning=!0,clearTimeout(this._longPressTimeout),this.setCursor({type:this.inputs.isPointing?"grabbing":"grab",rotation:0})),this.inputs.isSpacebarPanning){let t;switch(e.code){case"ArrowUp":t=new Vs(0,-1);break;case"ArrowRight":t=new Vs(1,0);break;case"ArrowDown":t=new Vs(0,1);break;case"ArrowLeft":t=new Vs(-1,0)}if(t){const e=this.getViewportPageBounds(),n=e.clone().translate(t.mulV({x:e.w,y:e.h}));this._animateToViewport(n,{animation:{duration:320}})}}break;case"key_up":t.keys.delete(e.code),"Space"===e.code&&(this.inputs.buttons.has(1)||(this.inputs.isPanning=!1,this.inputs.isSpacebarPanning=!1,this.setCursor({type:this._prevCursor,rotation:0})))}}if("pointer"===e.type){1===e.button?e.name="middle_click":2===e.button&&(e.name="right_click");const{isPenMode:t}=this.store.unsafeGetWithoutCapture(Wr);if(e.isPen===t){const t=this._clickManager.handlePointerEvent(e);if(e.name!==t.name)return this.root.handleEvent(e),this.emit("event",e),this.root.handleEvent(t),void this.emit("event",t)}}return this.root.handleEvent(e),this.emit("event",e),"pointer"===e.type&&"pointer_down"===e.name&&this.menus.clearOpenMenus(),this}maybeTrackPerformance(e){Ta.measurePerformance.get()&&(this.performanceTracker.isStarted()?clearTimeout(this.performanceTrackerTimeout):this.performanceTracker.start(e),this.performanceTrackerTimeout=this.timers.setTimeout((()=>{this.performanceTracker.stop()}),50))}}function ov(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.getCurrentPageId();const n=e.getPage(t).name;e.emit("max-shapes",{name:n,pageId:t,count:e.options.maxShapesPerPage})}function rv(e,t){if(!t)return e;let n=null;const o=Object.entries(t);for(let r=0,i=o.length;r<i;r++){const[t,i]=o[r];if(void 0!==i&&("id"!==t&&"type"!==t&&"typeName"!==t&&i!==e[t]))if(n||(n=l({},e)),"props"!==t&&"meta"!==t)n[t]=i;else{n[t]=l({},e[t]);for(const[e,o]of Object.entries(i))n[t][e]=o}}return n||e}function iv(e,t,n){const o=e.getShape(t);if(!o)return;n.push(o);const r=e.getSortedChildIdsForParent(t);for(let i=0,s=r.length;i<s;i++)iv(e,r[i],n)}function sv(e,t,n){let o;if(e.run((()=>{const r=e.store.extractingChanges((()=>{const r=new Set,i=new Set;for(const n of t){if(e.getShape(n))for(const o of e.getBindingsInvolvingShape(n)){const e=t.has(o.fromId),n=t.has(o.toId);e&&n?r.add(o.id):e&&n||i.add(o.id)}}e.deleteBindings([...i],{isolateShapes:!0});try{o=j.ok(n(r))}catch(s){o=j.err(s)}}));e.store.applyDiff(xn(r))}),{history:"ignore"}),o.ok)return o.value;throw o.error}function av(e,t){if(!t.constraints)throw Error("Should have constraints here");const{padding:{x:n,y:o}}=t.constraints,r=e.getViewportScreenBounds(),i=rc.From(t.constraints.bounds);return{zx:(r.w-2*n)/i.w,zy:(r.h-2*o)/i.h}}function lv(){const e=Ns(),t=Ih();return yn("isDarkMode",(()=>{var n;return null!==(n=null===t||void 0===t?void 0:t.isDarkMode)&&void 0!==n?n:e.user.getIsDarkMode()}),[t,e])}Xy(zy=(e=>{var t;return[,,,Ny(null!==(t=null===e||void 0===e?void 0:e[Uy("metadata")])&&void 0!==t?t:null)]})(Ly),1,"getIsShapeHiddenCache",Ry,nv),Xy(zy,1,"getCanUndo",Dy,nv),Xy(zy,1,"getCanRedo",Oy,nv),Xy(zy,1,"getPath",Ay,nv),Xy(zy,1,"getCurrentTool",My,nv),Xy(zy,1,"getCurrentToolId",Ty,nv),Xy(zy,1,"getDocumentSettings",jy,nv),Xy(zy,1,"getInstanceState",Ey,nv),Xy(zy,1,"getOpenMenus",Iy,nv),Xy(zy,1,"getIsMenuOpen",_y,nv),Xy(zy,1,"getPageStates",Cy,nv),Xy(zy,1,"_getPageStatesQuery",Py,nv),Xy(zy,1,"getCurrentPageState",ky,nv),Xy(zy,1,"_getCurrentPageStateId",Sy,nv),Xy(zy,1,"getSelectedShapeIds",xy,nv),Xy(zy,1,"getSelectedShapes",wy,nv),Xy(zy,1,"getOnlySelectedShapeId",by,nv),Xy(zy,1,"getOnlySelectedShape",vy,nv),Xy(zy,1,"getSelectionPageBounds",yy,nv),Xy(zy,1,"getSelectionRotation",my,nv),Xy(zy,1,"getSelectionRotatedPageBounds",gy,nv),Xy(zy,1,"getSelectionRotatedScreenBounds",fy,nv),Xy(zy,1,"getFocusedGroupId",py,nv),Xy(zy,1,"getFocusedGroup",hy,nv),Xy(zy,1,"getEditingShapeId",uy,nv),Xy(zy,1,"getEditingShape",dy,nv),Xy(zy,1,"getHoveredShapeId",cy,nv),Xy(zy,1,"getHoveredShape",ly,nv),Xy(zy,1,"getHintingShapeIds",ay,nv),Xy(zy,1,"getHintingShape",sy,nv),Xy(zy,1,"getErasingShapeIds",iy,nv),Xy(zy,1,"getErasingShapes",ry,nv),Xy(zy,1,"_unsafe_getCameraId",oy,nv),Xy(zy,1,"getCamera",ny,nv),Xy(zy,1,"getViewportPageBoundsForFollowing",ty,nv),Xy(zy,1,"getCameraForFollowing",ey,nv),Xy(zy,1,"getZoomLevel",Jm,nv),Xy(zy,1,"getViewportScreenBounds",Qm,nv),Xy(zy,1,"getViewportScreenCenter",Zm,nv),Xy(zy,1,"getViewportPageBounds",$m,nv),Xy(zy,1,"_getCollaboratorsQuery",Xm,nv),Xy(zy,1,"getCollaborators",Gm,nv),Xy(zy,1,"getCollaboratorsOnCurrentPage",Ym,nv),Xy(zy,1,"getRenderingShapes",qm,nv),Xy(zy,1,"_getAllPagesQuery",Wm,nv),Xy(zy,1,"getPages",Vm,nv),Xy(zy,1,"getCurrentPageId",Km,nv),Xy(zy,1,"getCurrentPageShapeIdsSorted",Hm,nv),Xy(zy,1,"_getAllAssetsQuery",Um,nv),Xy(zy,1,"_getShapeGeometryCache",Bm,nv),Xy(zy,1,"_getShapeHandlesCache",Fm,nv),Xy(zy,1,"_getShapePageTransformCache",Nm,nv),Xy(zy,1,"_getShapePageBoundsCache",zm,nv),Xy(zy,1,"_getShapeClipPathCache",Lm,nv),Xy(zy,1,"_getShapeMaskCache",Rm,nv),Xy(zy,1,"_getShapeMaskedPageBoundsCache",Dm,nv),Xy(zy,1,"_notVisibleShapes",Om,nv),Xy(zy,1,"getCulledShapes",Am,nv),Xy(zy,1,"getCurrentPageBounds",Mm,nv),Xy(zy,1,"getCurrentPageShapes",Tm,nv),Xy(zy,1,"getCurrentPageShapesSorted",jm,nv),Xy(zy,1,"getCurrentPageRenderingShapesSorted",Em,nv),Xy(zy,1,"_getBindingsIndexCache",Im,nv),Xy(zy,1,"_getSelectionSharedStyles",_m,nv),Xy(zy,1,"getSharedStyles",Cm,nv),Xy(zy,1,"getSharedOpacity",Pm,nv),Xy(zy,1,"getIsFocused",km,nv),Xy(zy,1,"getIsReadonly",Sm,nv),Xy(zy,1,"_setShiftKeyTimeout",xm,nv),Xy(zy,1,"_setAltKeyTimeout",wm,nv),Xy(zy,1,"_setCtrlKeyTimeout",bm,nv),Xy(zy,1,"_setMetaKeyTimeout",vm,nv),Gy(zy,nv);const cv="<path d='m19.7432 17.0869-4.072 4.068 2.829 2.828-8.473-.013-.013-8.47 2.841 2.842 4.075-4.068 1.414-1.415-2.844-2.842h8.486v8.484l-2.83-2.827z' fill='%23fff'/><path d='m18.6826 16.7334-4.427 4.424 1.828 1.828-5.056-.016-.014-5.054 1.842 1.841 4.428-4.422 2.474-2.475-1.844-1.843h5.073v5.071l-1.83-1.828z' fill='%23000'/>",dv="<path d='m9 17.9907v.005l5.997 5.996.001-3.999h1.999 2.02v4l5.98-6.001-5.98-5.999.001 4.019-2.021.002h-2l.001-4.022zm1.411.003 3.587-3.588-.001 2.587h3.5 2.521v-2.585l3.565 3.586-3.564 3.585-.001-2.585h-2.521l-3.499-.001-.001 2.586z' fill='%23fff'/><path d='m17.4971 18.9932h2.521v2.586l3.565-3.586-3.565-3.585v2.605h-2.521-3.5v-2.607l-3.586 3.587 3.586 3.586v-2.587z' fill='%23000'/>",uv='<path d="M22.4789 9.45728L25.9935 12.9942L22.4789 16.5283V14.1032C18.126 14.1502 14.6071 17.6737 14.5675 22.0283H17.05L13.513 25.543L9.97889 22.0283H12.5674C12.6071 16.5691 17.0214 12.1503 22.4789 12.1031L22.4789 9.45728Z" fill="black"/><path fill-rule="evenodd" clip-rule="evenodd" d="M21.4789 7.03223L27.4035 12.9945L21.4789 18.9521V15.1868C18.4798 15.6549 16.1113 18.0273 15.649 21.0284H19.475L13.5128 26.953L7.55519 21.0284H11.6189C12.1243 15.8155 16.2679 11.6677 21.4789 11.1559L21.4789 7.03223ZM22.4789 12.1031C17.0214 12.1503 12.6071 16.5691 12.5674 22.0284H9.97889L13.513 25.543L17.05 22.0284H14.5675C14.5705 21.6896 14.5947 21.3558 14.6386 21.0284C15.1157 17.4741 17.9266 14.6592 21.4789 14.1761C21.8063 14.1316 22.1401 14.1069 22.4789 14.1032V16.5284L25.9935 12.9942L22.4789 9.45729L22.4789 12.1031Z" fill="white"/>';function hv(e,t,n,o,r){let i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:16,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:16;const a=Gs/180*(-n-t),l=Math.sin(a),c=Math.cos(a),d=1*c-1*l,u=1*l+1*c;return"url(\"data:image/svg+xml,<svg height='32' width='32' viewBox='0 0 32 32' xmlns='http://www.w3.org/2000/svg' style='color: ".concat(r,";'><defs><filter id='shadow' y='-40%' x='-40%' width='180px' height='180%' color-interpolation-filters='sRGB'><feDropShadow dx='").concat(d,"' dy='").concat(u,"' stdDeviation='1.2' flood-opacity='.5'/></filter></defs><g fill='none' transform='rotate(").concat(t+n," 16 16)").concat(o?" scale(-1,-1) translate(0, -32)":"","' filter='url(%23shadow)'>")+e.replaceAll('"',"'")+'</g></svg>") '.concat(i," ").concat(s,", pointer")}const pv=["default","pointer","cross","move","grab","grabbing","text","zoom-in","zoom-out"],fv={none:()=>"none","ew-resize":(e,t,n)=>hv(dv,e,0,t,n),"ns-resize":(e,t,n)=>hv(dv,e,90,t,n),"nesw-resize":(e,t,n)=>hv(cv,e,0,t,n),"nwse-resize":(e,t,n)=>hv(cv,e,90,t,n),"nwse-rotate":(e,t,n)=>hv(uv,e,0,t,n),"nesw-rotate":(e,t,n)=>hv(uv,e,90,t,n),"senw-rotate":(e,t,n)=>hv(uv,e,180,t,n),"swne-rotate":(e,t,n)=>hv(uv,e,270,t,n)};function gv(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"black";return fv[e](180*t/Gs,!1,n)}const mv=["initialData","defaultName","id","assets","onMount","collaboration"],yv=e=>e.props.src,vv={upload:(e,t)=>H.blobToDataUrl(t)};function bv(e){return"schema"in e&&e.schema?e.schema:vs({shapes:"shapeUtils"in e&&e.shapeUtils?xv(Pu(e.shapeUtils)):void 0,bindings:"bindingUtils"in e&&e.bindingUtils?xv(Jd(e.bindingUtils)):void 0,migrations:"migrations"in e?e.migrations:void 0})}function wv(){var e;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{initialData:n,defaultName:o="",id:r,assets:i=vv,onMount:s,collaboration:a}=t,l=yr(t,mv);const c=bv(l),d=new Mn({id:r,schema:c,initialData:n,props:{defaultName:o,assets:{upload:i.upload,resolve:null!==(e=i.resolve)&&void 0!==e?e:yv},onMount:e=>{M(e instanceof nv),null===s||void 0===s||s(e)},collaboration:a}});if(l.snapshot){if(n)throw new Error("Cannot provide both initialData and snapshot");Zd(d,l.snapshot)}return d}function xv(e){return Object.fromEntries(e.map((e=>[e.type,{props:e.props,migrations:e.migrations}])))}let Sv,kv;const Pv=new WeakMap,Cv=new WeakMap,_v=new WeakMap,Iv=new WeakMap,Ev=new WeakMap;let jv={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return Cv.get(e);if("objectStoreNames"===t)return e.objectStoreNames||_v.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return Av(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function Tv(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(kv||(kv=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(){for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return e.apply(Ov(this),n),Av(Pv.get(this))}:function(){for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return Av(e.apply(Ov(this),n))}:function(t){for(var n=arguments.length,o=new Array(n>1?n-1:0),r=1;r<n;r++)o[r-1]=arguments[r];const i=e.call(Ov(this),t,...o);return _v.set(i,t.sort?t.sort():[t]),Av(i)}}function Mv(e){return"function"===typeof e?Tv(e):(e instanceof IDBTransaction&&function(e){if(Cv.has(e))return;const t=new Promise(((t,n)=>{const o=()=>{e.removeEventListener("complete",r),e.removeEventListener("error",i),e.removeEventListener("abort",i)},r=()=>{t(),o()},i=()=>{n(e.error||new DOMException("AbortError","AbortError")),o()};e.addEventListener("complete",r),e.addEventListener("error",i),e.addEventListener("abort",i)}));Cv.set(e,t)}(e),((e,t)=>t.some((t=>e instanceof t)))(e,Sv||(Sv=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(e,jv):e)}function Av(e){if(e instanceof IDBRequest)return function(e){const t=new Promise(((t,n)=>{const o=()=>{e.removeEventListener("success",r),e.removeEventListener("error",i)},r=()=>{t(Av(e.result)),o()},i=()=>{n(e.error),o()};e.addEventListener("success",r),e.addEventListener("error",i)}));return t.then((t=>{t instanceof IDBCursor&&Pv.set(t,e)})).catch((()=>{})),Ev.set(t,e),t}(e);if(Iv.has(e))return Iv.get(e);const t=Mv(e);return t!==e&&(Iv.set(e,t),Ev.set(t,e)),t}const Ov=e=>Ev.get(e);function Dv(e,t){let{blocked:n,upgrade:o,blocking:r,terminated:i}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const s=indexedDB.open(e,t),a=Av(s);return o&&s.addEventListener("upgradeneeded",(e=>{o(Av(s.result),e.oldVersion,e.newVersion,Av(s.transaction),e)})),n&&s.addEventListener("blocked",(e=>n(e.oldVersion,e.newVersion,e))),a.then((e=>{i&&e.addEventListener("close",(()=>i())),r&&e.addEventListener("versionchange",(e=>r(e.oldVersion,e.newVersion,e)))})).catch((()=>{})),a}function Rv(e){let{blocked:t}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=indexedDB.deleteDatabase(e);return t&&n.addEventListener("blocked",(e=>t(e.oldVersion,e))),Av(n).then((()=>{}))}const Lv=["get","getKey","getAll","getAllKeys","count"],zv=["put","add","delete","clear"],Nv=new Map;function Fv(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!==typeof t)return;if(Nv.get(t))return Nv.get(t);const n=t.replace(/FromIndex$/,""),o=t!==n,r=zv.includes(n);if(!(n in(o?IDBIndex:IDBObjectStore).prototype)||!r&&!Lv.includes(n))return;const i=async function(e){const t=this.transaction(e,r?"readwrite":"readonly");let i=t.store;for(var s=arguments.length,a=new Array(s>1?s-1:0),l=1;l<s;l++)a[l-1]=arguments[l];return o&&(i=i.index(a.shift())),(await Promise.all([i[n](...a),r&&t.done]))[0]};return Nv.set(t,i),i}jv=(e=>l(l({},e),{},{get:(t,n,o)=>Fv(t,n)||e.get(t,n,o),has:(t,n)=>!!Fv(t,n)||e.has(t,n)}))(jv);const Bv="TLDRAW_DB_NAME_INDEX_v2",Uv="records",Hv="schema",Kv="session_state",Vv="assets";async function Wv(e){const t="TLDRAW_DOCUMENT_v2"+e;return function(e){const t=new Set(Yv());t.add(e),nt(Bv,JSON.stringify([...t]))}(t),await Dv(t,4,{upgrade(e){e.objectStoreNames.contains(Uv)||e.createObjectStore(Uv),e.objectStoreNames.contains(Hv)||e.createObjectStore(Hv),e.objectStoreNames.contains(Kv)||e.createObjectStore(Kv),e.objectStoreNames.contains(Vv)||e.createObjectStore(Vv)}})}class qv{constructor(e){s(this,"getDbPromise",void 0),s(this,"isClosed",!1),s(this,"pendingTransactionSet",new Set),qv.connectedInstances.add(this),this.getDbPromise=(async()=>(await async function(e){const t=window.indexedDB.databases?(await window.indexedDB.databases()).map((e=>e.name)):Yv(),n="TLDRAW_ASSET_STORE_v1"+e;if(!t.find((e=>e===n)))return;const o=await Dv(n,1,{upgrade(e){e.objectStoreNames.contains("assets")||e.createObjectStore("assets")}});if(!o.objectStoreNames.contains("assets"))return;const r=o.transaction(["assets"],"readonly"),i=r.objectStore("assets"),s=await i.getAllKeys(),a=await Promise.all(s.map((async e=>[e,await i.get(e)])));await r.done;const l=await Wv(e),c=l.transaction([Vv],"readwrite"),d=c.objectStore(Vv);for(const[u,h]of a)d.put(h,u);await c.done,o.close(),l.close(),await Rv(n)}(e),await Wv(e)))()}getDb(){return this.getDbPromise}pending(){return Promise.allSettled([this.getDbPromise,...this.pendingTransactionSet]).then(E)}async close(){this.isClosed||(this.isClosed=!0,await this.pending(),(await this.getDb()).close(),qv.connectedInstances.delete(this))}tx(e,t,n){const o=(async()=>{M(!this.isClosed,"db is closed");const o=(await this.getDb()).transaction(t,e),r=o.done.catch((e=>{if(!this.isClosed)throw e}));try{return await n(o)}finally{this.isClosed?o.abort():await r}})();return this.pendingTransactionSet.add(o),o.finally((()=>this.pendingTransactionSet.delete(o))),o}async load(){let{sessionId:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return await this.tx("readonly",[Uv,Hv,Kv],(async t=>{var n;const o=t.objectStore(Uv),r=t.objectStore(Hv),i=t.objectStore(Kv);let s=e?null===(n=await i.get(e))||void 0===n?void 0:n.snapshot:null;if(!s){var a;s=null===(a=(await i.getAll()).sort(((e,t)=>e.updatedAt-t.updatedAt)).pop())||void 0===a?void 0:a.snapshot}return{records:await o.getAll(),schema:await r.get(Hv),sessionStateSnapshot:s}}))}async storeChanges(e){let{schema:t,changes:n,sessionId:o,sessionStateSnapshot:r}=e;await this.tx("readwrite",[Uv,Hv,Kv],(async e=>{const i=e.objectStore(Uv),s=e.objectStore(Hv),a=e.objectStore(Kv);for(const[t,o]of Object.entries(n.added))await i.put(o,t);for(const[t,o]of Object.values(n.updated))await i.put(o,o.id);for(const t of Object.keys(n.removed))await i.delete(t);s.put(t.serialize(),Hv),r&&o?a.put({snapshot:r,updatedAt:Date.now(),id:o},o):(r||o)&&console.error("sessionStateSnapshot and instanceId must be provided together")}))}async storeSnapshot(e){let{schema:t,snapshot:n,sessionId:o,sessionStateSnapshot:r}=e;await this.tx("readwrite",[Uv,Hv,Kv],(async e=>{const i=e.objectStore(Uv),s=e.objectStore(Hv),a=e.objectStore(Kv);await i.clear();for(const[t,o]of Object.entries(n))await i.put(o,t);s.put(t.serialize(),Hv),r&&o?a.put({snapshot:r,updatedAt:Date.now(),id:o},o):(r||o)&&console.error("sessionStateSnapshot and instanceId must be provided together")}))}async pruneSessions(){await this.tx("readwrite",[Kv],(async e=>{const t=e.objectStore(Kv),n=(await t.getAll()).sort(((e,t)=>e.updatedAt-t.updatedAt));if(n.length<10)return void await e.done;const o=n.slice(0,n.length-10);for(const{id:r}of o)await t.delete(r)}))}async getAsset(e){return await this.tx("readonly",[Vv],(async t=>{const n=t.objectStore(Vv);return await n.get(e)}))}async storeAsset(e,t){await this.tx("readwrite",[Vv],(async n=>{const o=n.objectStore(Vv);await o.put(t,e)}))}}function Yv(){var e;const t=null!==(e=JSON.parse(tt(Bv)||"[]"))&&void 0!==e?e:[];return Array.isArray(t)?t:[]}s(qv,"connectedInstances",new Set);const Gv=Symbol("UPDATE_INSTANCE_STATE");const Xv="undefined"===typeof BroadcastChannel?class{constructor(e){s(this,"onmessage",void 0)}postMessage(e){}close(){}}:BroadcastChannel;class $v{constructor(e,t){let{persistenceKey:n,sessionId:o=Vd,onLoad:r,onLoadError:i}=t,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Xv("tldraw-tab-sync-".concat(n));s(this,"disposables",new Set),s(this,"diffQueue",[]),s(this,"didDispose",!1),s(this,"shouldDoFullDBWrite",!0),s(this,"isReloading",!1),s(this,"persistenceKey",void 0),s(this,"sessionId",void 0),s(this,"serializedSchema",void 0),s(this,"isDebugging",!1),s(this,"documentTypes",void 0),s(this,"$sessionStateSnapshot",void 0),s(this,"db",void 0),s(this,"initTime",Date.now()),s(this,"isPersisting",!1),s(this,"didLastWriteError",!1),s(this,"scheduledPersistTimeout",null),this.store=e,this.channel=a,"undefined"!==typeof window&&(window.tlsync=this),this.persistenceKey=n,this.sessionId=o,this.db=new qv(n),this.disposables.add((()=>this.db.close())),this.serializedSchema=this.store.schema.serialize(),this.$sessionStateSnapshot=Xd(this.store),this.disposables.add(e.listen((e=>{let{changes:t}=e;this.diffQueue.push(t),this.channel.postMessage({type:"diff",storeId:this.store.id,changes:t,schema:this.serializedSchema}),this.schedulePersist()}),{source:"user",scope:"document"})),this.disposables.add(e.listen((()=>{this.diffQueue.push(Gv),this.schedulePersist()}),{scope:"session"})),this.connect(r,i),this.documentTypes=new Set(Object.values(this.store.schema.types).filter((e=>"document"===e.scope)).map((e=>e.typeName)))}debug(){this.isDebugging&&console.debug(...arguments)}async connect(e,t){let n;this.debug("connecting");try{n=await this.db.load({sessionId:this.sessionId})}catch(i){return t(i),void window.alert("Oops! We could not access your browser's storage\u2014and the app won't work correctly without that. We now need to reload the page and try again.\n\nKeep seeing this message?\n\u2022 If you're using tldraw in a private or \"incognito\" window, try loading tldraw in a regular window or in a different browser.")}if(this.debug("loaded data from store",n,"didDispose",this.didDispose),!this.didDispose)try{if(n){var o,r;const e=Object.fromEntries(n.records.map((e=>[e.id,e]))),i=null!==(o=n.sessionStateSnapshot)&&void 0!==o?o:function(e){const t=[];for(const s of Object.values(e)){var n;null!==(n=s.typeName)&&void 0!==n&&n.match(/^(instance.*|pointer|camera)$/)&&t.push(s)}const o=t.filter((e=>"instance"===e.typeName&&e.id!==Wr))[0];if(!o)return null;const r={version:qd,currentPageId:o.currentPageId,exportBackground:!!o.exportBackground,isFocusMode:!!o.isFocusMode,isDebugMode:!!o.isDebugMode,isToolLocked:!!o.isToolLocked,isGridMode:!1,pageStates:t.filter((e=>"instance_page_state"===e.typeName&&e.instanceId===o.id)).map((t=>{var n;const o=null!==(n=e[t.cameraId])&&void 0!==n?n:{x:0,y:0,z:1};return{pageId:t.pageId,camera:{x:o.x,y:o.y,z:o.z},selectedShapeIds:t.selectedShapeIds,focusedGroupId:t.focusedGroupId}}))};try{return Yd.validate(r),r}catch(i){return null}}(e),s=this.store.schema.migrateStoreSnapshot({store:e,schema:null!==(r=n.schema)&&void 0!==r?r:this.store.schema.serializeEarliestVersion()});if("error"===s.type)return console.error("failed to migrate store",s),void t(new Error("Failed to migrate store: ".concat(s.reason)));const a=Object.values(s.value).filter((e=>this.documentTypes.has(e.typeName)));a.length>0&&this.store.mergeRemoteChanges((()=>{this.store.put(a,"initialize")})),i&&$d(this.store,i)}this.channel.onmessage=e=>{let{data:n}=e;this.debug("got message",n);const o=n,r=this.store.schema.getMigrationsSince(o.schema);if(!r.ok){var i,s;return Date.now()-this.initTime<5e3?void t(new Error("Schema mismatch, please close other tabs and reload the page")):(this.debug("reloading"),this.isReloading=!0,void(null===(i=window)||void 0===i||null===(i=i.location)||void 0===i||null===(s=i.reload)||void 0===s||s.call(i)))}if(r.value.length>0)return this.debug("telling them to reload"),this.channel.postMessage({type:"announce",schema:this.serializedSchema}),this.shouldDoFullDBWrite=!0,void this.persistIfNeeded();"diff"===o.type&&(this.debug("applying diff"),Xt((()=>{this.store.mergeRemoteChanges((()=>{this.store.applyDiff(o.changes)}))})))},this.channel.postMessage({type:"announce",schema:this.serializedSchema}),this.disposables.add((()=>{this.channel.close()})),e(this)}catch(s){if(this.debug("error loading data from store",s),this.didDispose)return;return void t(s)}}close(){this.debug("closing"),this.didDispose=!0,this.disposables.forEach((e=>e()))}schedulePersist(){this.debug("schedulePersist",this.scheduledPersistTimeout),this.scheduledPersistTimeout||(this.scheduledPersistTimeout=setTimeout((()=>{this.scheduledPersistTimeout=null,this.persistIfNeeded()}),this.didLastWriteError?1e4:350))}persistIfNeeded(){this.debug("persistIfNeeded",{isPersisting:this.isPersisting,isReloading:this.isReloading,shouldDoFullDBWrite:this.shouldDoFullDBWrite,diffQueueLength:this.diffQueue.length,storeIsPossiblyCorrupt:this.store.isPossiblyCorrupted()}),this.scheduledPersistTimeout&&(clearTimeout(this.scheduledPersistTimeout),this.scheduledPersistTimeout=null),this.isPersisting||this.isReloading||this.store.isPossiblyCorrupted()||(this.shouldDoFullDBWrite||this.diffQueue.length>0)&&this.doPersist()}async doPersist(){if(M(!this.isPersisting,"persist already in progress"),this.didDispose)return;this.isPersisting=!0,this.debug("doPersist start");const e=this.diffQueue;this.diffQueue=[];try{if(this.shouldDoFullDBWrite)this.shouldDoFullDBWrite=!1,await this.db.storeSnapshot({schema:this.store.schema,snapshot:this.store.serialize(),sessionId:this.sessionId,sessionStateSnapshot:this.$sessionStateSnapshot.get()});else{const t=kn(e.filter((e=>e!==Gv)));await this.db.storeChanges({changes:t,schema:this.store.schema,sessionId:this.sessionId,sessionStateSnapshot:this.$sessionStateSnapshot.get()})}this.didLastWriteError=!1}catch(t){this.shouldDoFullDBWrite=!0,this.didLastWriteError=!0,console.error("failed to store changes in indexed db",t),window.alert("Oops! We could not save changes to your browser's storage. We now need to reload the page and try again.\n\nKeep seeing this message?\n\u2022 If you're using tldraw in a private or \"incognito\" window, try loading tldraw in a regular window or in a different browser.\n\u2022 If your hard disk is full, try clearing up some space and then reload the page."),"undefined"!==typeof window&&window.location.reload()}this.isPersisting=!1,this.debug("doPersist end"),this.schedulePersist()}}function Zv(t){const n=(0,e.useRef)(t),[o,r]=(0,e.useState)(t);o!==n.current&&r(n.current);return[o,(0,e.useCallback)((e=>{n.current="function"===typeof e?e(n.current):e,r(n.current)}),[])]}const Qv=["persistenceKey","sessionId"];function Jv(e){const t=new ArrayBuffer(e.length),n=new Uint8Array(t);for(let o=0,r=e.length;o<r;o++)n[o]=e.charCodeAt(o);return t}const eb={ANNUAL_LICENSE:1,PERPETUAL_LICENSE:2,INTERNAL_LICENSE:4,WITH_WATERMARK:8},tb=Math.max(...Object.values(eb)),nb={ID:0,HOSTS:1,FLAGS:2,EXPIRY_DATE:3},ob=Object.keys(nb).length,rb="sales@tldraw.com",ib="".concat(rp(),"/watermarks/watermark-track.svg");class sb{constructor(e,t,n){s(this,"publicKey","MFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAEHJh0uUfxHtCGyerXmmatE368Hd9rI6LH9oPDQihnaCryRFWEVeOvf9U/SPbyxX74LFyJs5tYeAHq5Nc0Ax25LQ"),s(this,"isDevelopment",void 0),s(this,"isTest",void 0),s(this,"isCryptoAvailable",void 0),s(this,"state",Qt("license state","pending")),s(this,"verbose",!0),this.isTest=!1,this.isDevelopment=this.getIsDevelopment(n),this.publicKey=t||this.publicKey,this.isCryptoAvailable=!!crypto.subtle,this.getLicenseFromKey(e).then((e=>{const t=function(e){if(!e.isLicenseParseable)return!0;if(!e.isDomainValid&&!e.isDevelopment)return!0;if(e.isPerpetualLicenseExpired||e.isAnnualLicenseExpired){if(e.isInternalLicense)throw new Error("License: Internal license expired.");return!0}return!1}(e);!this.isDevelopment&&t&&B(ib),t?this.state.set("unlicensed"):e.isLicensedWithWatermark?this.state.set("licensed-with-watermark"):this.state.set("licensed")}))}getIsDevelopment(e){return"development"===e||"production"!==e&&"https:"!==window.location.protocol}async extractLicenseKey(e){const[t,n]=e.split("."),[o,r]=t.split("/");if(!o.startsWith("tldraw-"))throw new Error("Unsupported prefix '".concat(o,"'"));const i=await function(e){const t=Jv(atob(e));return crypto.subtle.importKey("spki",new Uint8Array(t),{name:"ECDSA",namedCurve:"P-256"},!0,["verify"])}(this.publicKey);let s,a;try{s=await crypto.subtle.verify({name:"ECDSA",hash:{name:"SHA-256"}},i,new Uint8Array(Jv(atob(n))),new Uint8Array(Jv(atob(r))))}catch(l){throw console.error(l),new Error("Could not perform signature validation")}if(!s)throw new Error("Invalid signature");try{a=JSON.parse(atob(r))}catch(c){throw new Error("Could not parse object")}return a.length>ob&&this.outputMessages(["License key contains some unknown properties.","You may want to update tldraw packages to a newer version to get access to new functionality."]),{id:a[nb.ID],hosts:a[nb.HOSTS],flags:a[nb.FLAGS],expiryDate:a[nb.EXPIRY_DATE]}}async getLicenseFromKey(e){if(!e)return this.isDevelopment||this.outputNoLicenseKeyProvided(),{isLicenseParseable:!1,reason:"no-key-provided"};if(this.isDevelopment&&!this.isCryptoAvailable)return this.verbose&&(console.log("tldraw: you seem to be in a development environment that does not support crypto. License not verified."),console.log("You should check that this works in production separately.")),{isLicenseParseable:!1,reason:"has-key-development-mode"};let t=e.replace(/[\u200B-\u200D\uFEFF]/g,"");t=t.replace(/\r?\n|\r/g,"");try{const e=await this.extractLicenseKey(t),n=new Date(e.expiryDate),o=this.isFlagEnabled(e.flags,eb.ANNUAL_LICENSE),r=this.isFlagEnabled(e.flags,eb.PERPETUAL_LICENSE),i={license:e,isLicenseParseable:!0,isDevelopment:this.isDevelopment,isDomainValid:this.isDomainValid(e),expiryDate:n,isAnnualLicense:o,isAnnualLicenseExpired:o&&this.isAnnualLicenseExpired(n),isPerpetualLicense:r,isPerpetualLicenseExpired:r&&this.isPerpetualLicenseExpired(n),isInternalLicense:this.isFlagEnabled(e.flags,eb.INTERNAL_LICENSE),isLicensedWithWatermark:this.isFlagEnabled(e.flags,eb.WITH_WATERMARK)};return this.outputLicenseInfoIfNeeded(i),i}catch(n){return this.outputInvalidLicenseKey(n.message),{isLicenseParseable:!1,reason:"invalid-license-key"}}}isDomainValid(e){const t=window.location.hostname.toLowerCase();return e.hosts.some((e=>{const n=e.toLowerCase().trim();if(n===t||"www.".concat(n)===t||n==="www.".concat(t))return!0;if("*"===e)return!0;if(e.includes("*")){const n=new RegExp(e.replace(/\*/g,".*?"));return n.test(t)||n.test("www.".concat(t))}return!1}))}getExpirationDateWithoutGracePeriod(e){return new Date(e.getFullYear(),e.getMonth(),e.getDate())}getExpirationDateWithGracePeriod(e){return new Date(e.getFullYear(),e.getMonth(),e.getDate()+5+1)}isAnnualLicenseExpired(e){const t=this.getExpirationDateWithGracePeriod(e),n=new Date>=t;return!n&&new Date>=this.getExpirationDateWithoutGracePeriod(e)&&this.outputMessages(["tldraw license is about to expire, you are in a grace period.","Please reach out to ".concat(rb," if you would like to renew your license.")]),n}isPerpetualLicenseExpired(e){const t=this.getExpirationDateWithGracePeriod(e),n=new Date(Cs),o=new Date(_s);return n>=t||o>=t}isFlagEnabled(e,t){return(e&t)===t}outputNoLicenseKeyProvided(){}outputInvalidLicenseKey(e){this.outputMessages(["Invalid tldraw license key","Reason: ".concat(e)])}outputLicenseInfoIfNeeded(e){e.isAnnualLicenseExpired&&this.outputMessages(["Your tldraw license has expired!","Please reach out to ".concat(rb," to renew.")]),e.isDomainValid||e.isDevelopment||this.outputMessages(["This tldraw license key is not valid for this domain!","Please reach out to ".concat(rb," if you would like to use tldraw on other domains.")]),e.license.flags>=2*tb&&this.outputMessages(["This tldraw license contains some unknown flags.","You may want to update tldraw packages to a newer version to get access to new functionality."])}outputMessages(e){if(!this.isTest&&this.verbose){this.outputDelimiter();for(const t of e)console.log("%c".concat(t),"color: white; background: crimson; padding: 2px; border-radius: 3px;");this.outputDelimiter()}}outputDelimiter(){console.log("%c-------------------------------------------------------------------","color: white; background: crimson; padding: 2px; border-radius: 3px;")}}s(sb,"className","tl-watermark_SEE-LICENSE");const ab=(0,e.createContext)({});function lb(t){let{licenseKey:n,children:o}=t;const[r]=(0,e.useState)((()=>new sb(n)));return(0,Ss.jsx)(ab.Provider,{value:r,children:o})}function cb(t){if(!t)throw Error("usePassThroughWheelEvents must be passed a ref");const n=Va();(0,e.useEffect)((()=>{function e(e){if(e.isSpecialRedispatchedEvent)return;Da(e);const t=n.querySelector(".tl-canvas");if(!t)return;const o=new WheelEvent("wheel",e);o.isSpecialRedispatchedEvent=!0,t.dispatchEvent(o)}const o=t.current;if(o)return o.addEventListener("wheel",e,{passive:!1}),()=>{o.removeEventListener("wheel",e)}}),[n,t])}const db="data:image/svg+xml;utf8,".concat(encodeURIComponent('<svg xmlns="http://www.w3.org/2000/svg" width="3001" height="1000" fill="none"><path fill="#000" d="M590.656 300.449c0 49.706-40.294 90-90 90-49.705 0-90-40.294-90-90 0-49.705 40.295-90 90-90 49.706 0 90 40.295 90 90M569.431 719.011c-15.247 32.821-56.006 91.589-98.338 91.438-32.004-.115-38.642-30.904-17.414-50.856 17.381-16.337 28.246-48.075 31.995-72.719.415-2.728-1.556-5.197-4.272-5.679-39.666-7.04-70.746-40.877-70.746-83.417 0-48.23 38.983-87.329 87.07-87.329 39.936 0 70.172 22.237 83.369 52.397 18.839 43.055 7.117 115.733-11.664 156.165M2613.29 385.681V239.319c0-11.363 9.22-20.569 20.59-20.569h8.26c11.37 0 20.59 9.206 20.59 20.569v36.911c0 8.629 7 15.625 15.63 15.625h35.25c8.63 0 15.63-6.996 15.63-15.625v-36.911c0-11.363 9.22-20.569 20.59-20.569h8.17c11.37 0 20.59 9.206 20.59 20.569v146.362c0 11.363-9.22 20.569-20.59 20.569h-8.17c-11.37 0-20.59-9.206-20.59-20.569v-36.999c0-8.63-7-15.625-15.63-15.625h-35.25c-8.63 0-15.63 6.995-15.63 15.625v36.999c0 11.363-9.22 20.569-20.59 20.569h-8.26c-11.37 0-20.59-9.206-20.59-20.569M2391.97 239.319v146.362c0 11.348-9.16 20.569-20.49 20.569h-8.2c-11.33 0-20.49-9.221-20.49-20.569V239.319c0-11.348 9.16-20.569 20.49-20.569h8.2c11.33 0 20.49 9.221 20.49 20.569M2098.23 391.43l-42.69-146.361c-3.85-13.171 6.06-26.319 19.79-26.319h10.6c9.59 0 17.93 6.611 20.08 15.952l17.01 73.045c1.48 6.348 10.47 6.478 12.14.176l19.47-73.838c2.38-9.04 10.57-15.335 19.93-15.335h12.1c9.37 0 17.56 6.3 19.94 15.346l19.49 74.067c1.66 6.305 10.65 6.178 12.13-.171l17.09-73.294c2.15-9.339 10.49-15.948 20.08-15.948h10.53c13.72 0 23.63 13.141 19.79 26.31l-42.63 146.361c-2.56 8.789-10.63 14.829-19.79 14.829h-15.68c-9.12 0-17.16-5.98-19.76-14.709l-21.17-71.059c-1.77-5.948-10.19-5.957-11.97-.012l-21.33 71.071c-2.6 8.729-10.64 14.709-19.76 14.709h-15.59c-9.17 0-17.23-6.035-19.8-14.82M2443.23 218.75h118.59c11.38 0 20.62 9.195 20.62 20.557s-9.24 20.556-20.62 20.556h-24.79c-5.53 0-10 4.477-10 10v115.818c0 11.368-9.25 20.569-20.63 20.569h-7.65c-11.39 0-20.63-9.201-20.63-20.569V269.863c0-5.523-4.48-10-10-10h-24.89c-11.37 0-20.61-9.195-20.61-20.556s9.24-20.557 20.61-20.557M1174.15 218.75h24.64c8.35 0 15.88 5.042 19.04 12.764l34.61 83.942c2.13 5.161 9.44 5.155 11.56-.01l34.43-83.932a20.58 20.58 0 0 1 19.04-12.764h24.64c11.37 0 20.58 9.208 20.58 20.569v146.362c0 11.361-9.21 20.569-20.58 20.569h-7.09c-11.36 0-20.58-9.208-20.58-20.569l-.12-50.645c-.01-6.888-9.53-8.688-12.06-2.283l-23.46 59.332a20.57 20.57 0 0 1-19.14 13.009h-3.03a20.57 20.57 0 0 1-19.15-13.046l-23.47-59.68c-2.52-6.416-12.05-4.623-12.06 2.271l-.13 51.042c0 11.361-9.21 20.569-20.57 20.569h-7.1c-11.36 0-20.57-9.208-20.57-20.569V239.319c0-11.361 9.21-20.569 20.57-20.569"/><path fill="#000" fill-rule="evenodd" d="m1449.94 391.836 6.12-19.392a6.255 6.255 0 0 1 5.96-4.369l50.22-.061a6.24 6.24 0 0 1 5.96 4.348l6.23 19.486c2.71 8.581 10.71 14.402 19.74 14.402h9.34c14.13 0 24.15-13.791 19.61-27.151l-49.74-146.361c-2.85-8.37-10.74-13.988-19.61-13.988h-33.16c-8.87 0-16.77 5.618-19.61 13.988l-49.74 146.361c-4.54 13.36 5.48 27.151 19.61 27.151h9.32c9.04 0 17.04-5.827 19.75-14.414m31.1-98.858c1.85-5.807 10.08-5.796 11.91.016l8.83 27.916c1.28 4.028-1.73 8.134-5.96 8.134h-17.74c-4.23 0-7.24-4.119-5.95-8.151zM1681.81 406.25c18.91 0 35.39-3.686 49.36-11.168 13.97-7.544 24.73-18.394 32.24-32.489 7.56-14.105 11.29-30.866 11.29-50.182 0-19.256-3.73-35.957-11.29-50.004-7.57-14.094-18.35-24.912-32.32-32.397-13.91-7.545-30.4-11.26-49.37-11.26h-49.5c-11.38 0-20.63 9.201-20.63 20.569v146.362c0 11.368 9.25 20.569 20.63 20.569zm23.13-47.701c-6.62 3.215-14.85 4.886-24.79 4.886-10.49 0-19-8.507-19-19v-64.34c0-10.149 8.23-18.376 18.38-18.376 10.18 0 18.56 1.703 25.23 4.974 6.59 3.149 11.63 8.315 15.08 15.633 3.45 7.269 5.28 17.268 5.28 30.162 0 12.891-1.82 22.951-5.28 30.347-3.39 7.319-8.36 12.509-14.9 15.714" clip-rule="evenodd"/><path fill="#000" d="M1804.21 385.681V239.319c0-11.361 9.21-20.569 20.58-20.569h91.28c11.36 0 20.57 9.202 20.57 20.557s-9.21 20.556-20.57 20.556h-54.64a7.807 7.807 0 0 0-7.81 7.813v16.366a7.806 7.806 0 0 0 7.81 7.812h48.13c11.37 0 20.58 9.246 20.58 20.602s-9.21 20.601-20.58 20.601h-48.13a7.806 7.806 0 0 0-7.81 7.812v16.455a7.807 7.807 0 0 0 7.81 7.813h54.64c11.36 0 20.57 9.202 20.57 20.556s-9.21 20.557-20.57 20.557h-91.28c-11.37 0-20.58-9.208-20.58-20.569"/><path fill="#000" fill-rule="evenodd" d="M2875.5 68.75h-2750c-31.066 0-56.25 25.184-56.25 56.25v750c0 31.066 25.184 56.25 56.25 56.25h2750c31.07 0 56.25-25.184 56.25-56.25V125c0-31.066-25.18-56.25-56.25-56.25M125.5 0C56.464 0 .5 55.964.5 125v750c0 69.036 55.965 125 125 125h2750c69.04 0 125-55.964 125-125V125c0-69.036-55.96-125-125-125z" clip-rule="evenodd"/><path fill="#000" d="M2476.06 804.813c-10.54 0-19.82-6.947-22.81-17.068L2390.79 575.7c-4.49-15.248 6.92-30.534 22.8-30.534h27.75c11.1 0 20.72 7.686 23.18 18.52L2489 671.402c2.07 9.093 14.93 9.321 17.32.308l28.83-108.844c2.76-10.435 12.19-17.7 22.98-17.7h25.17c10.8 0 20.25 7.293 22.99 17.755l28.27 107.739c2.36 9.001 15.18 8.829 17.3-.232l25.01-106.888c2.51-10.763 12.1-18.374 23.14-18.374h27.87c15.88 0 27.29 15.286 22.8 30.534l-62.46 212.045a23.78 23.78 0 0 1-22.81 17.068h-32.12c-10.39 0-19.58-6.763-22.69-16.696l-32.08-102.694c-2.62-8.397-14.51-8.331-17.04.095l-30.74 102.346c-3.02 10.061-12.27 16.949-22.76 16.949zM1742.44 804.813h-75.81c-13.09 0-23.71-10.656-23.71-23.801V568.967c0-13.145 10.62-23.801 23.71-23.801h74.8c26.6 0 49.59 5.198 68.95 15.594 19.45 10.312 34.44 25.187 44.96 44.627 10.61 19.355 15.91 42.556 15.91 69.602q0 40.57-15.78 69.73c-10.53 19.355-25.43 34.231-44.71 44.627-19.28 10.311-42.05 15.467-68.32 15.467m-29.3-83.642c0 13.145 10.61 23.801 23.71 23.801h3.06c12.8 0 23.7-2.07 32.71-6.212 9.09-4.141 16-11.283 20.71-21.426q7.2-15.213 7.2-42.345 0-27.13-7.32-42.344c-4.8-10.143-11.87-17.285-21.22-21.426-9.26-4.142-20.63-6.212-34.1-6.212h-1.04c-13.1 0-23.71 10.656-23.71 23.801zM1460.86 804.813c-13.12 0-23.76-10.656-23.76-23.801V568.967c0-13.145 10.64-23.801 23.76-23.801h22.84c13.13 0 23.76 10.656 23.76 23.801v155.247c0 13.145 10.64 23.801 23.76 23.801h57.27c13.12 0 23.76 10.656 23.76 23.801v9.196c0 13.145-10.64 23.801-23.76 23.801zM1204.45 601.964c-13.13 0-23.77-10.656-23.77-23.801v-9.196c0-13.145 10.64-23.801 23.77-23.801h177.89c13.13 0 23.78 10.656 23.78 23.801v9.196c0 13.145-10.65 23.801-23.78 23.801h-39.38c-8.21 0-14.86 6.66-14.86 14.875v164.173c0 13.145-10.64 23.801-23.78 23.801h-21.85c-13.13 0-23.78-10.656-23.78-23.801V616.839c0-8.215-6.65-14.875-14.86-14.875z"/><path fill="#000" fill-rule="evenodd" d="M2223.05 787.891c-3.02 10.047-12.27 16.922-22.74 16.922h-25.43c-16.19 0-27.64-15.862-22.57-31.261l69.88-212.045c3.21-9.753 12.31-16.341 22.56-16.341h61.84c10.25 0 19.35 6.588 22.56 16.341l69.87 212.045c5.08 15.399-6.37 31.261-22.56 31.261h-25.43c-10.48 0-19.72-6.875-22.74-16.922l-6.7-22.2a14.84 14.84 0 0 0-14.21-10.576h-63.42c-6.55 0-12.32 4.296-14.22 10.576zm76.13-96.945-14.13-48.436c-2.46-8.451-14.36-8.602-17.04-.217l-15.46 48.436c-1.84 5.759 2.45 11.645 8.48 11.645h29.6c5.94 0 10.22-5.715 8.55-11.428" clip-rule="evenodd"/><path fill="#000" d="M1939.6 804.813c-13.13 0-23.77-10.656-23.77-23.801V568.967c0-13.145 10.64-23.801 23.77-23.801h88.13c19.24 0 36.08 3.508 50.51 10.523s25.65 17.115 33.67 30.3q12.03 19.779 12.03 47.416c0 18.595-4.14 34.273-12.41 47.036-7.64 11.913-18.18 21.101-31.63 27.564-16.98 8.159-36 11.104-54.7 11.104h-43.07c-76.56 0 4.08-135.84 4.08-84.706v7.996c0 12.117 9.81 21.941 21.91 21.941 8.12 0 16.3-.345 24.04-3.043 5.91-2.113 10.43-5.451 13.55-10.015 3.2-4.565 4.81-10.523 4.81-17.877 0-7.437-1.61-13.481-4.81-18.129-3.12-4.733-7.64-8.199-13.55-10.396-7.05-2.766-14.67-3.423-22.18-3.423-13.13 0-23.77 10.656-23.77 23.801v47.71c0 11.825 11.14 16.003 19.91 20.752 12.31 6.671 7.58 25.389-6.42 25.389-7.45 0-13.49 6.048-13.49 13.508v48.395c0 13.145-10.63 23.801-23.76 23.801zm134.89-106.758 5.41 9.95 33.51 61.622c8.62 15.86-2.84 35.186-20.87 35.186h-22.27c-8.74 0-16.77-4.798-20.92-12.496l-35.05-65.04a15.52 15.52 0 0 0-13.66-8.168c-42.24 0 40.62-82.154 73.85-21.054M931.652 0h68.748v1000h-68.748z"/></svg>')),ub="data:image/svg+xml;utf8,".concat(encodeURIComponent('<svg xmlns="http://www.w3.org/2000/svg" width="400" height="1601" fill="none"><path fill="#000" d="M72 1319.8c0-10.73 7.071-20.18 17.372-23.22l215.823-63.62c15.519-4.57 31.078 7.05 31.078 23.22v28.26c0 11.31-7.824 21.1-18.85 23.61l-109.636 24.94c-9.254 2.1-9.487 15.2-.313 17.63l110.784 29.37a24.21 24.21 0 0 1 18.015 23.4v25.64c0 11-7.423 20.62-18.071 23.41l-109.659 28.79c-9.162 2.41-8.986 15.47.236 17.63l108.792 25.46c10.955 2.56 18.702 12.33 18.702 23.57v28.39c0 16.17-15.559 27.79-31.078 23.22l-215.823-63.62c-10.3-3.04-17.372-12.49-17.372-23.22v-32.72c0-10.59 6.883-19.95 16.994-23.11l104.523-32.67c8.547-2.67 8.479-14.79-.096-17.36l-104.17-31.3C79.01 1372.42 72 1363 72 1352.31zM72 572.638V495.43c0-13.336 10.846-24.147 24.225-24.147h215.823c13.379 0 24.225 10.811 24.225 24.147v76.179q0 40.645-15.872 70.228-15.743 29.712-45.422 45.79-29.55 16.206-70.843 16.206-41.292 0-70.971-16.078-29.55-16.077-45.422-45.532Q72 612.767 72 572.638m85.132-29.84c-13.379 0-24.225 10.81-24.225 24.146v3.122q0 19.55 6.323 33.313 6.323 13.89 21.807 21.094 15.485 7.332 43.099 7.331t43.1-7.46q15.484-7.33 21.807-21.608 6.323-14.15 6.323-34.728v-1.064c0-13.336-10.846-24.146-24.225-24.146zM72 285.858c0-13.363 10.846-24.197 24.225-24.197h215.823c13.379 0 24.225 10.834 24.225 24.197v23.27c0 13.364-10.846 24.197-24.225 24.197H154.035c-13.379 0-24.225 10.834-24.225 24.197v58.328c0 13.364-10.846 24.197-24.225 24.197h-9.36C82.845 440.047 72 429.214 72 415.85zM278.463 24.72c0-13.374 10.846-24.216 24.225-24.216h9.36c13.379 0 24.225 10.842 24.225 24.216v181.174c0 13.374-10.846 24.216-24.225 24.216h-9.36c-13.379 0-24.225-10.842-24.225-24.216v-40.108c0-8.359-6.779-15.135-15.141-15.135H96.225c-13.38 0-24.225-10.842-24.225-24.216v-22.256c0-13.374 10.846-24.216 24.225-24.216h167.097c8.362 0 15.141-6.776 15.141-15.135z"/><path fill="#000" fill-rule="evenodd" d="M89.224 1062.13C78.997 1059.04 72 1049.63 72 1038.96v-25.9c0-16.486 16.145-28.147 31.818-22.979l215.823 71.169a24.19 24.19 0 0 1 16.632 22.98v62.97c0 10.45-6.706 19.71-16.632 22.98l-215.823 71.17C88.145 1246.51 72 1234.86 72 1218.37v-25.9c0-10.67 6.997-20.08 17.224-23.17l22.595-6.81a15.13 15.13 0 0 0 10.765-14.48v-64.59a15.13 15.13 0 0 0-10.765-14.48zm98.672 77.53 49.299-14.39c8.601-2.51 8.755-14.62.22-17.35l-49.299-15.75c-5.861-1.88-11.852 2.49-11.852 8.64v30.14c0 6.05 5.817 10.41 11.632 8.71" clip-rule="evenodd"/><path fill="#000" d="M72 773.439c0-13.367 10.846-24.203 24.225-24.203h215.823c13.379 0 24.225 10.836 24.225 24.203v89.762q0 29.395-10.711 51.439-10.71 22.046-30.84 34.293t-48.261 12.248q-28.388 0-47.873-12.635-18.187-11.672-28.056-32.218c-8.303-17.289-11.301-36.661-11.301-55.705v-43.867c0-77.976 138.26 4.16 86.215 4.16h-8.138c-12.334 0-22.332 9.989-22.332 22.311 0 8.269.351 16.6 3.097 24.487q3.225 9.024 10.194 13.794 6.968 4.899 18.194 4.899 11.356 0 18.453-4.899 7.226-4.77 10.581-13.794c2.815-7.188 3.484-14.944 3.484-22.596 0-13.366-10.846-24.202-24.225-24.202h-48.56c-12.036 0-16.288 11.345-21.122 20.272-6.79 12.539-25.841 7.72-25.841-6.536 0-7.586-6.156-13.736-13.749-13.736H96.225C82.845 820.916 72 810.08 72 796.714zm108.66 137.378-10.128 5.511-62.72 34.131C91.67 959.243 72 947.569 72 929.205V906.52a24.2 24.2 0 0 1 12.719-21.299l66.199-35.696a15.82 15.82 0 0 0 8.313-13.921c0-43.012 83.618 41.371 21.429 75.213"/></svg>')),hb=(0,e.memo)((function(){const t=(0,e.useContext)(ab),n=Ns(),o=yn("is mobile",(()=>n.getViewportScreenBounds().width<700),[n]),r=function(e){return yn("watermarkState",(()=>e.state.get()),[e])}(t);return["licensed-with-watermark","unlicensed"].includes(r)?(0,Ss.jsxs)(Ss.Fragment,{children:[(0,Ss.jsx)(fb,{}),(0,Ss.jsx)(pb,{src:o?ub:db})]}):null})),pb=(0,e.memo)((function(t){let{src:n}=t;const o=Ns(),r=yn("debug mode",(()=>o.getInstanceState().isDebugMode),[o]),i=yn("is mobile",(()=>o.getViewportScreenBounds().width<700),[o]),s=Ua(),a=(0,e.useRef)(null);cb(a);const c="url('".concat(n,"') center 100% / 100% no-repeat"),d="https://tldraw.dev";return(0,Ss.jsx)("div",l(l({ref:a,className:sb.className,"data-debug":r,"data-mobile":i,draggable:!1},s),{},{children:ka.isWebview?(0,Ss.jsx)("a",{draggable:!1,role:"button",onPointerDown:e=>{za(e),Da(e)},onClick:()=>yd.openWindow(d,"_blank"),style:{mask:c,WebkitMask:c}}):(0,Ss.jsx)("a",{href:d,target:"_blank",rel:"noreferrer",draggable:!1,onPointerDown:e=>{za(e)},style:{mask:c,WebkitMask:c}})}))})),fb=(0,e.memo)((function(){const e=sb.className,t="/* ------------------- SEE LICENSE -------------------\nThe tldraw watermark is part of tldraw's license. It is shown for unlicensed\nor \"licensed-with-watermark\" users. By using this library, you agree to\npreserve the watermark's behavior, keeping it visible, unobscured, and\navailable to user-interaction.\n\nTo remove the watermark, please purchase a license at tldraw.dev.\n*/\n\n\t.".concat(e," {\n\t\tposition: absolute;\n\t\tbottom: var(--space-2);\n\t\tright: var(--space-2);\n\t\twidth: 96px;\n\t\theight: 32px;\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t\tz-index: var(--layer-watermark) !important;\n\t\tbackground-color: color-mix(in srgb, var(--color-background) 62%, transparent);\n\t\topacity: 1;\n\t\tborder-radius: 5px;\n\t\tpointer-events: all;\n\t\tpadding: 2px;\n\t\tbox-sizing: content-box;\n\t}\n\n\t.").concat(e," > a {\n\t\tposition: absolute;\n\t\twidth: 96px;\n\t\theight: 32px;\n\t\tpointer-events: all;\n\t\tcursor: inherit;\n\t\tcolor: var(--color-text);\n\t\topacity: .38;\n\t\tbackground-color: currentColor;\n\t}\n\n\t.").concat(e,"[data-debug='true'] {\n\t\tbottom: 46px;\n\t}\n\n\t.").concat(e,"[data-mobile='true'] {\n\t\tborder-radius: 4px 0px 0px 4px;\n\t\tright: -2px;\n\t\twidth: 8px;\n\t\theight: 48px;\n\t}\n\n\t.").concat(e,"[data-mobile='true'] > a {\n\t\twidth: 8px;\n\t\theight: 32px;\n\t}\n\n\t@media (hover: hover) {\n\t\t.").concat(e," > a {\n\t\t\tpointer-events: none;\n\t\t}\n\n\t\t.").concat(e,":hover {\n\t\t\tbackground-color: var(--color-background);\n\t\t\ttransition: background-color 0.2s ease-in-out;\n\t\t\ttransition-delay: 0.32s;\n\t\t}\n\n\t\t.").concat(e,":hover > a {\n\t\t\tanimation: delayed_link 0.2s forwards ease-in-out;\n\t\t\tanimation-delay: 0.32s;\n\t\t}\n\t}\n\n\t@keyframes delayed_link {\n\t\t0% {\n\t\t\tcursor: inherit;\n\t\t\topacity: .38;\n\t\t\tpointer-events: none;\n\t\t}\n\t\t100% {\n\t\t\tcursor: pointer;\n\t\t\topacity: 1;\n\t\t\tpointer-events: all;\n\t\t}\n\t}");return(0,Ss.jsx)("style",{children:t})})),gb=["store","components","className","user","options"],mb=["store","user"],yb=[],vb=[],bb=[],wb=(0,e.memo)((function(t){var n,o,r;let{store:i,components:s,className:a,user:c,options:d}=t,u=yr(t,gb);const[h,p]=(0,e.useState)(null),f=(0,e.useMemo)((()=>null!==c&&void 0!==c?c:Nd()),[c]),g=void 0===(null===s||void 0===s?void 0:s.ErrorFallback)?bd:null===s||void 0===s?void 0:s.ErrorFallback,m=l(l({},u),{},{shapeUtils:null!==(n=u.shapeUtils)&&void 0!==n?n:yb,bindingUtils:null!==(o=u.bindingUtils)&&void 0!==o?o:vb,tools:null!==(r=u.tools)&&void 0!==r?r:bb,components:s,options:pd(d)});return(0,Ss.jsx)("div",{ref:p,"data-tldraw":Ps,draggable:!1,className:ks("".concat("tl-container"," tl-theme__light"),a),onPointerDown:za,tabIndex:-1,children:(0,Ss.jsx)(Ts,{fallback:g,onError:e=>F(e,{tags:{origin:"react.tldraw-before-app"}}),children:h&&(0,Ss.jsx)(lb,{licenseKey:u.licenseKey,children:(0,Ss.jsx)(Ka,{container:h,children:(0,Ss.jsx)(gd,{overrides:s,children:i?i instanceof Mn?(0,Ss.jsx)(Pb,l(l({},m),{},{store:i,user:f})):(0,Ss.jsx)(Sb,l(l({},m),{},{store:i,user:f})):(0,Ss.jsx)(xb,l(l({},m),{},{store:i,user:f}))})})})})})}));function xb(t){const{defaultName:n,snapshot:o,initialData:r,shapeUtils:i,bindingUtils:s,persistenceKey:a,sessionId:c,user:d,assets:u}=t,h=function(t){const[n,o]=Zv({status:"loading"});return t=pd(t),(0,e.useEffect)((()=>{const{persistenceKey:e,sessionId:n}=t,r=yr(t,Qv);if(!e)return void o({status:"not-synced",store:wv(r)});o({status:"loading"});const i=new L,s=l({upload:async(e,t)=>(await d.db.storeAsset(e.id,t),e.id),resolve:async e=>e.props.src?e.props.src.startsWith("asset:")?await i.get(e,(async()=>{const t=await d.db.getAsset(e.id);return t?URL.createObjectURL(t):null})):e.props.src:null},r.assets),a=wv(l(l({},r),{},{assets:s}));let c=!1;const d=new $v(a,{sessionId:n,persistenceKey:e,onLoad(){c||o({store:a,status:"synced-local"})},onLoadError(e){c||o({status:"error",error:e})}});return()=>{c=!0,d.close()}}),[t,o]),n}({shapeUtils:i,bindingUtils:s,initialData:r,persistenceKey:a,sessionId:c,defaultName:n,snapshot:o,assets:u});return(0,Ss.jsx)(Sb,l(l({},t),{},{store:h,user:d}))}const Sb=(0,e.memo)((function(t){let{store:n,user:o}=t,r=yr(t,mb);const i=Va();(0,e.useLayoutEffect)((()=>{"dark"===o.userPreferences.get().colorScheme&&(i.classList.remove("tl-theme__light"),i.classList.add("tl-theme__dark"))}),[i,o]);const{LoadingScreen:s}=md();switch(n.status){case"error":throw n.error;case"loading":return s?(0,Ss.jsx)(s,{}):null}return(0,Ss.jsx)(Pb,l(l({},r),{},{store:n.store,user:o}))})),kb=()=>document.location.search.includes("tldraw_preserve_focus");function Pb(t){let{onMount:n,children:o,store:r,tools:i,shapeUtils:s,bindingUtils:a,user:c,initialState:d,autoFocus:u=!0,inferDarkMode:h,cameraOptions:p,options:f,licenseKey:g,deepLinks:m,isShapeHidden:y}=t;const{ErrorFallback:v}=md(),b=Va(),[w,x]=Zv(null),S=(0,e.useRef)(null),k=pd(!0===m?{}:m),P=(0,e.useRef)({autoFocus:u&&!kb(),inferDarkMode:h,initialState:d,cameraOptions:p,deepLinks:k});(0,e.useLayoutEffect)((()=>{P.current={autoFocus:u&&!kb(),inferDarkMode:h,initialState:d,cameraOptions:p,deepLinks:k}}),[u,h,d,p,k]),(0,e.useLayoutEffect)((()=>{var e;const{autoFocus:t,inferDarkMode:n,initialState:o,cameraOptions:d,deepLinks:u}=P.current,h=new nv({store:r,shapeUtils:s,bindingUtils:a,tools:i,getContainer:()=>b,user:c,initialState:o,autoFocus:t,inferDarkMode:n,cameraOptions:d,options:f,licenseKey:g,isShapeHidden:y});return h.updateViewportScreenBounds(null!==(e=S.current)&&void 0!==e?e:b),u&&(null!==u&&void 0!==u&&u.getUrl?h.navigateToDeepLink(l(l({},u),{},{url:u.getUrl(h)})):h.navigateToDeepLink(u)),x(h),()=>{h.dispose()}}),[a,b,f,s,r,i,c,x,g,y]),(0,e.useLayoutEffect)((()=>{if(w)return k?w.registerDeepLinkListener(k):void 0}),[w,k]),(0,e.useLayoutEffect)((()=>{w&&p&&w.setCameraOptions(p)}),[w,p]);const C=(0,e.useSyncExternalStore)((0,e.useCallback)((e=>w?(w.on("crash",e),()=>w.off("crash",e)):()=>{}),[w]),(()=>{var e;return null!==(e=null===w||void 0===w?void 0:w.getCrashingError())&&void 0!==e?e:null}));(0,e.useEffect)((function(){if(w)return u&&kb()?(w.getContainer().addEventListener("pointerdown",e),document.body.addEventListener("pointerdown",t),()=>{var n;null===(n=w.getContainer())||void 0===n||n.removeEventListener("pointerdown",e),document.body.removeEventListener("pointerdown",t)}):void 0;function e(){w&&w.focus()}function t(){w&&w.blur()}}),[w,u]);const{Canvas:_}=md();return w?(0,Ss.jsx)(Ts,{fallback:v,onError:e=>w.annotateError(e,{origin:"react.tldraw",willCrashApp:!0}),children:C?(0,Ss.jsx)(_b,{crashingError:C}):(0,Ss.jsx)(Bs,{editor:w,children:(0,Ss.jsxs)(Cb,{onMount:n,children:[null!==o&&void 0!==o?o:_?(0,Ss.jsx)(_,{},w.contextId):null,(0,Ss.jsx)(hb,{})]})})}):(0,Ss.jsx)("div",{className:"tl-canvas",ref:S})}function Cb(t){let{children:n,onMount:o}=t;return function(){const t=Ns(),n=Va();e.useEffect((()=>{const e=e=>n.style.setProperty("--tl-zoom",e.toString()),o=z(e,100),r=new Ut("useZoomCss",(()=>{t.getCurrentPageShapeIds().size<300?e(t.getZoomLevel()):o(t.getZoomLevel())}));return r.attach(),r.execute(),()=>{r.detach(),o.cancel()}}),[t,n])}(),function(){const e=Ns(),t=Va(),n=lv();mn("useCursor",(()=>{const{type:o,rotation:r}=e.getInstanceState().cursor;pv.includes(o)?t.style.setProperty("--tl-cursor","var(--tl-cursor-".concat(o,")")):t.style.setProperty("--tl-cursor",gv(o,r,n?"white":"black"))}),[e,t,n])}(),function(){const t=Ns(),n=Va(),o=lv(),r=yn(Ta.forceSrgb);e.useEffect((()=>{o?(n.setAttribute("data-color-mode","dark"),n.classList.remove("tl-theme__light"),n.classList.add("tl-theme__dark")):(n.setAttribute("data-color-mode","light"),n.classList.remove("tl-theme__dark"),n.classList.add("tl-theme__light")),r?n.classList.add("tl-theme__force-sRGB"):n.classList.remove("tl-theme__force-sRGB")}),[t,n,r,o])}(),function(){const[t,n]=(0,e.useState)(0);(0,e.useEffect)((()=>n((e=>e+1))),[])}(),jb((e=>{const t=e.store.props.onMount(e),n=null===o||void 0===o?void 0:o(e);return()=>{null===t||void 0===t||t(),null===n||void 0===n||n()}})),n}function _b(e){let{crashingError:t}=e;throw t}function Ib(e){let{children:t}=e;return(0,Ss.jsx)("div",{className:"tl-loading",children:t})}function Eb(e){let{children:t}=e;return(0,Ss.jsx)("div",{className:"tl-loading",children:t})}function jb(t){const n=Ns(),o=Ph((e=>{let n;return e.run((()=>{n=null===t||void 0===t?void 0:t(e),e.emit("mount")}),{history:"ignore"}),window.tldrawReady=!0,n}));e.useLayoutEffect((()=>{if(n)return null===o||void 0===o?void 0:o(n)}),[n,o])}const Tb=["children","className"];function Mb(e){let{children:t,className:n=""}=e,o=yr(e,Tb);return(0,Ss.jsx)("div",l(l({},o),{},{className:ks("tl-html-container",n),children:t}))}class Ab{constructor(e){this.editor=e}}function Ob(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const{newPoint:o,handle:r,scaleX:i,scaleY:s}=t,{minWidth:a=1,maxWidth:c=1/0,minHeight:d=1,maxHeight:u=1/0}=n;let h=e.props.w*i,p=e.props.h*s;const f=new Vs(0,0);if(h>0){if(h<a){switch(r){case"top_left":case"left":case"bottom_left":f.x=h-a;break;case"top":case"bottom":f.x=(h-a)/2;break;default:f.x=0}h=a}}else if(f.x=h,h=-h,h<a){switch(r){case"top_left":case"left":case"bottom_left":f.x=-h;break;default:f.x=-a}h=a}if(p>0){if(p<d){switch(r){case"top_left":case"top":case"top_right":f.y=p-d;break;case"right":case"left":f.y=(p-d)/2;break;default:f.y=0}p=d}}else if(f.y=p,p=-p,p<d){switch(r){case"top_left":case"top":case"top_right":f.y=-p;break;default:f.y=-d}p=d}const{x:g,y:m}=f.rot(e.rotation).add(o);return l(l({},e),{},{x:g,y:m,props:{w:Math.min(c,h),h:Math.min(u,p)}})}s(Ab,"props",void 0),s(Ab,"migrations",void 0),s(Ab,"type",void 0);class Db extends vu{getGeometry(e){return new yu({width:e.props.w,height:e.props.h,isFilled:!0})}onResize(e,t){return Ob(e,t)}getHandleSnapGeometry(e){return{points:this.getGeometry(e).bounds.cornersAndCenter}}getInterpolatedProps(e,t,n){return l(l({},t.props),{},{w:le(e.props.w,t.props.w,n),h:le(e.props.h,t.props.h,n)})}}class Rb extends gm{onPointerDown(e){this.parent.transition("pointing",e)}onEnter(){this.editor.setCursor({type:"cross",rotation:0})}onCancel(){this.editor.setCurrentTool("select")}}s(Rb,"id","idle");class Lb extends gm{onPointerMove(e){if(this.editor.inputs.isDragging){const{originPagePoint:t}=this.editor.inputs,n=this.parent.shapeType,o=Ko(),r=this.editor.markHistoryStoppingPoint("creating_box:".concat(o)),i=zb(t,this.editor);this.editor.createShapes([{id:o,type:n,x:i.x,y:i.y,props:{w:1,h:1}}]).select(o);const s=this.parent;this.editor.setCurrentTool("select.resizing",l(l({},e),{},{target:"selection",handle:"bottom_right",isCreating:!0,creatingMarkId:r,creationCursorOffset:{x:1,y:1},onInteractionEnd:this.parent.id,onCreate:s.onCreate?e=>{var t;return null===(t=s.onCreate)||void 0===t?void 0:t.call(s,e)}:void 0}))}}onPointerUp(){this.complete()}onCancel(){this.cancel()}onComplete(){this.complete()}onInterrupt(){this.cancel()}complete(){const{originPagePoint:e}=this.editor.inputs,t=this.parent.shapeType,n=Ko();this.editor.markHistoryStoppingPoint("creating_box:".concat(n)),this.editor.createShapes([{id:n,type:t,x:e.x,y:e.y}]);const o=this.editor.getShape(n);if(!o)return void this.cancel();let{w:r,h:i}=o.props;const s=new Vs(r/2,i/2),a=this.editor.getShapeParentTransform(o);a&&s.rot(-a.rotation());let l=1;this.editor.user.getIsDynamicResizeMode()&&(l=1/this.editor.getZoomLevel(),r*=l,i*=l,s.mul(l));const c=bt(o),d=zb(new Vs(o.x-s.x,o.y-s.y),this.editor);c.x=d.x,c.y=d.y,c.props.w=r,c.props.h=i,"scale"in o.props&&(c.props.scale=l),this.editor.updateShape(c),this.editor.setSelectedShapes([n]),this.editor.getInstanceState().isToolLocked?this.parent.transition("idle"):this.editor.setCurrentTool("select.idle")}cancel(){this.parent.transition("idle")}}function zb(e,t){const n=t.getInstanceState().isGridMode,o=t.getDocumentSettings().gridSize;return n?e.clone().snapToGrid(o):e.clone()}s(Lb,"id","pointing");class Nb extends gm{static children(){return[Rb,Lb]}}function Fb(e){const t=Ns();return yn("isEditing",(()=>t.getEditingShapeId()===e),[t,e])}function Bb(t){const n=Ns();return(0,e.useMemo)((function(){let e,o;return{onPointerDown:e=>{if(e.isKilled)return;if(2===e.button)return void n.dispatch(l({type:"pointer",target:"selection",handle:t,name:"right_click"},Ba(e)));if(0!==e.button)return;const o=Oa(e.currentTarget);Ra(o,e),o.addEventListener("pointerup",(function t(){o.removeEventListener("pointerup",t),La(o,e)})),n.dispatch(l({name:"pointer_down",type:"pointer",target:"selection",handle:t},Ba(e))),za(e)},onPointerMove:function(r){r.isKilled||0===r.button&&(r.clientX===e&&r.clientY===o||(e=r.clientX,o=r.clientY,n.dispatch(l({name:"pointer_move",type:"pointer",target:"selection",handle:t},Ba(r)))))},onPointerUp:e=>{e.isKilled||0===e.button&&n.dispatch(l({name:"pointer_up",type:"pointer",target:"selection",handle:t},Ba(e)))}}}),[n,t])}s(Nb,"id","box"),s(Nb,"initial","idle");function Ub(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20;return Math.max(8,Math.ceil(e/t))}class Hb extends sc{constructor(e){super(l(l({},e),{},{isFilled:!1,isClosed:!1})),s(this,"_center",void 0),s(this,"radius",void 0),s(this,"start",void 0),s(this,"end",void 0),s(this,"largeArcFlag",void 0),s(this,"sweepFlag",void 0),s(this,"measure",void 0),s(this,"angleStart",void 0),s(this,"angleEnd",void 0);const{center:t,sweepFlag:n,largeArcFlag:o,start:r,end:i}=e;if(r.equals(i))throw Error("Arc must have different start and end points.");this.angleStart=Vs.Angle(t,r),this.angleEnd=Vs.Angle(t,i),this.radius=Vs.Dist(t,r),this.measure=function(e,t,n,o){const r=(t-e)%$s*2%$s-(t-e)%$s;return o?($s-Math.abs(r))*(n?1:-1):r}(this.angleStart,this.angleEnd,n,o),this.start=r,this.end=i,this.sweepFlag=n,this.largeArcFlag=o,this._center=t}nearestPoint(e){const{_center:t,measure:n,radius:o,angleEnd:r,angleStart:i,start:s,end:a}=this,l=ba(n,i,r,t.angle(e));if(l<=0)return s;if(l>=1)return a;const c=t.clone().add(e.clone().sub(t).uni().mul(o));let d,u,h=1/0;for(const p of[s,a,c])u=Vs.Dist2(e,p),u<h&&(d=p,h=u);if(!d)throw Error("nearest point not found");return d}hitTestLineSegment(e,t){const{_center:n,radius:o,measure:r,angleStart:i,angleEnd:s}=this,a=ou(e,t,n,o);return null!==a&&a.some((e=>{const t=ba(r,i,s,n.angle(e));return t>=0&&t<=1}))}getVertices(){const{_center:e,measure:t,length:n,radius:o,angleStart:r}=this,i=[];for(let s=0,a=Ub(Math.abs(n));s<a+1;s++){const n=r+s/a*t;i.push(ca(e,o,n))}return i}getSvgPathData(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const{start:t,end:n,radius:o,largeArcFlag:r,sweepFlag:i}=this;return"".concat(e?"M".concat(t.toFixed()):""," A").concat(o," ").concat(o," 0 ").concat(r," ").concat(i," ").concat(n.toFixed())}getLength(){return this.measure*this.radius}}class Kb extends sc{constructor(e){super(l({isClosed:!0},e)),s(this,"_center",void 0),s(this,"radius",void 0),s(this,"x",void 0),s(this,"y",void 0),this.config=e;const{x:t=0,y:n=0,radius:o}=e;this.x=t,this.y=n,this._center=new Vs(o+t,o+n),this.radius=o}getBounds(){return new rc(this.x,this.y,2*this.radius,2*this.radius)}getVertices(){const{_center:e,radius:t}=this,n=[];for(let o=0,r=Ub($s*t);o<r;o++){const i=o/r*$s;n.push(ca(e,t,i))}return n}nearestPoint(e){const{_center:t,radius:n}=this;return t.equals(e)?Vs.AddXY(t,n,0):t.clone().add(e.clone().sub(t).uni().mul(n))}hitTestLineSegment(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const{_center:o,radius:r}=this;return null!==ou(e,t,o,r+n)}getSvgPathData(){const{_center:e,radius:t}=this;return"M".concat(e.x+t,",").concat(e.y," a").concat(t,",").concat(t," 0 1,0 ").concat(2*t,",0a").concat(t,",").concat(t," 0 1,0 -").concat(2*t,",0")}}class Vb extends gu{constructor(e){const{start:t,cp1:n,cp2:o,end:r}=e;super(l(l({},e),{},{points:[t,r]})),s(this,"a",void 0),s(this,"b",void 0),s(this,"c",void 0),s(this,"d",void 0),this.a=t,this.b=n,this.c=o,this.d=r}getVertices(){const e=[],{a:t,b:n,c:o,d:r}=this;for(let i=0,s=10;i<=s;i++){const a=i/s;e.push(new Vs((1-a)*(1-a)*(1-a)*t.x+(1-a)*(1-a)*3*a*n.x+3*(1-a)*(a*a)*o.x+a*a*a*r.x,(1-a)*(1-a)*(1-a)*t.y+(1-a)*(1-a)*3*a*n.y+3*(1-a)*(a*a)*o.y+a*a*a*r.y))}return e}midPoint(){return Vb.GetAtT(this,.5)}nearestPoint(e){let t,n,o,r=1/0;for(const i of this.segments)o=i.nearestPoint(e),n=Vs.Dist2(o,e),n<r&&(t=o,r=n);if(!t)throw Error("nearest point not found");return t}getSvgPathData(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const{a:t,b:n,c:o,d:r}=this;return"".concat(e?"M ".concat(t.toFixed()," "):""," C").concat(n.toFixed()," ").concat(o.toFixed()," ").concat(r.toFixed())}static GetAtT(e,t){const{a:n,b:o,c:r,d:i}=e;return new Vs((1-t)*(1-t)*(1-t)*n.x+(1-t)*(1-t)*3*t*o.x+3*(1-t)*(t*t)*r.x+t*t*t*i.x,(1-t)*(1-t)*(1-t)*n.y+(1-t)*(1-t)*3*t*o.y+3*(1-t)*(t*t)*r.y+t*t*t*i.y)}getLength(){let e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:32,n=this.a,o=0;for(let r=1;r<=t;r++)e=Vb.GetAtT(this,r/t),o+=Vs.Dist(n,e),n=e;return o}}class Wb extends sc{constructor(e){super(l(l({},e),{},{isClosed:!1,isFilled:!1})),s(this,"points",void 0),s(this,"_segments",void 0);const{points:t}=e;this.points=t}get segments(){if(!this._segments){this._segments=[];const{points:e}=this,t=e.length,n=t-2,o=1.25;for(let r=0;r<t-1;r++){const t=0===r?e[0]:e[r-1],i=e[r],s=e[r+1],a=r===n?s:e[r+2],l=i,c=0===r?t:new Vs(i.x+(s.x-t.x)/6*o,i.y+(s.y-t.y)/6*o),d=r===n?s:new Vs(s.x-(a.x-i.x)/6*o,s.y-(a.y-i.y)/6*o),u=s;this._segments.push(new Vb({start:l,cp1:c,cp2:d,end:u}))}}return this._segments}getLength(){return this.segments.reduce(((e,t)=>e+t.length),0)}getVertices(){const e=this.segments.reduce(((e,t)=>e.concat(t.vertices)),[]);return e.push(this.points[this.points.length-1]),e}nearestPoint(e){let t,n,o,r=1/0;for(const i of this.segments)o=i.nearestPoint(e),n=Vs.Dist2(o,e),n<r&&(t=o,r=n);if(!t)throw Error("nearest point not found");return t}hitTestLineSegment(e,t){return this.segments.some((n=>n.hitTestLineSegment(e,t)))}getSvgPathData(){let e=this.segments.reduce(((e,t,n)=>e+t.getSvgPathData(0===n)),"");return this.isClosed&&(e+="Z"),e}}class qb extends sc{constructor(e){super(l(l({},e),{},{isClosed:!0})),s(this,"w",void 0),s(this,"h",void 0),s(this,"_edges",void 0),this.config=e;const{width:t,height:n}=e;this.w=t,this.h=n}get edges(){if(!this._edges){const{vertices:e}=this;this._edges=[];for(let t=0,n=e.length;t<n;t++){const o=e[t],r=e[(t+1)%n];this._edges.push(new fu({start:o,end:r}))}}return this._edges}getVertices(){const e=Math.max(1,this.w)/2,t=Math.max(1,this.h)/2,n=Math.pow(e-t,2)/Math.pow(e+t,2),o=Ub(Gs*(e+t)*(1+3*n/(10+Math.sqrt(4-3*n)))),r=$s/o,i=Math.cos(r),s=Math.sin(r);let a=0,l=1,c=0,d=1;const u=Array(o);for(let h=0;h<o;h++)u[h]=new Vs(e+e*l,t+t*a),c=s*l+i*a,d=i*l-s*a,a=c,l=d;return u}nearestPoint(e){let t,n,o,r=1/0;for(const i of this.edges)o=i.nearestPoint(e),n=Vs.Dist2(o,e),n<r&&(t=o,r=n);if(!t)throw Error("nearest point not found");return t}hitTestLineSegment(e,t){return this.edges.some((n=>n.hitTestLineSegment(e,t)))}getBounds(){return new rc(0,0,this.w,this.h)}getLength(){const{w:e,h:t}=this,n=e/2,o=t/2;return ta(Math.max(0,n),Math.max(0,o))}getSvgPathData(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const{w:t,h:n}=this,o=t/2,r=n/2,i=Math.max(0,o),s=Math.max(0,r);return"".concat(e?"M".concat(o-i,",").concat(r):""," a").concat(i,",").concat(s,",0,1,1,").concat(2*i,",0a").concat(i,",").concat(s,",0,1,1,-").concat(2*i,",0")}}class Yb extends sc{constructor(e){super(l(l({},e),{},{isClosed:!0})),s(this,"w",void 0),s(this,"h",void 0),s(this,"a",void 0),s(this,"b",void 0),s(this,"c",void 0),s(this,"d",void 0),this.config=e;const{width:t,height:n}=e;if(this.w=t,this.h=n,n>t){const e=t/2;this.a=new Hb({start:new Vs(0,e),end:new Vs(t,e),center:new Vs(t/2,e),sweepFlag:1,largeArcFlag:1}),this.b=new fu({start:new Vs(t,e),end:new Vs(t,n-e)}),this.c=new Hb({start:new Vs(t,n-e),end:new Vs(0,n-e),center:new Vs(t/2,n-e),sweepFlag:1,largeArcFlag:1}),this.d=new fu({start:new Vs(0,n-e),end:new Vs(0,e)})}else{const e=n/2;this.a=new Hb({start:new Vs(e,n),end:new Vs(e,0),center:new Vs(e,e),sweepFlag:1,largeArcFlag:1}),this.b=new fu({start:new Vs(e,0),end:new Vs(t-e,0)}),this.c=new Hb({start:new Vs(t-e,0),end:new Vs(t-e,n),center:new Vs(t-e,e),sweepFlag:1,largeArcFlag:1}),this.d=new fu({start:new Vs(t-e,n),end:new Vs(e,n)})}}nearestPoint(e){let t,n,o,r=1/0;const{a:i,b:s,c:a,d:l}=this;for(const c of[i,s,a,l])o=c.nearestPoint(e),n=Vs.Dist2(o,e),n<r&&(t=o,r=n);if(!t)throw Error("nearest point not found");return t}hitTestLineSegment(e,t){const{a:n,b:o,c:r,d:i}=this;return[n,o,r,i].some((n=>n.hitTestLineSegment(e,t)))}getVertices(){const{a:e,b:t,c:n,d:o}=this;return[e,t,n,o].reduce(((e,t)=>(e.push(...t.vertices),e)),[])}getBounds(){return new rc(0,0,this.w,this.h)}getLength(){const{h:e,w:t}=this;return e>t?2*(Gs*(t/2)+(e-t)):2*(Gs*(e/2)+(t-e))}getSvgPathData(){const{a:e,b:t,c:n,d:o}=this;return[e,t,n,o].map(((e,t)=>e.getSvgPathData(0===t))).join(" ")+" Z"}}"undefined"!==typeof window&&(window.__tldraw__hardReset=async function(){let{shouldReload:e=!0}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(){try{sessionStorage.clear()}catch(e){}}();for(const t of qv.connectedInstances)await t.close();await Promise.all(Yv().map((e=>Rv(e)))),function(){try{localStorage.clear()}catch(e){}}(),e&&window.location.reload()}),u("@tldraw/editor","3.6.1","esm");const Gb=()=>{},Xb=e.createContext(null);function $b(e){let{onEvent:t,children:n}=e;return(0,Ss.jsx)(Xb.Provider,{value:null!==t&&void 0!==t?t:Gb,children:n})}function Zb(){const t=e.useContext(Xb);return null!==t&&void 0!==t?t:Gb}function Qb(e,t){let{checkForDefaultPrevented:n=!0}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return function(o){if(null===e||void 0===e||e(o),!1===n||!o.defaultPrevented)return null===t||void 0===t?void 0:t(o)}}const Jb=["children"],ew=["scope","children"];function tw(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],o=[];const r=()=>{const n=o.map((t=>e.createContext(t)));return function(o){const r=(null===o||void 0===o?void 0:o[t])||n;return e.useMemo((()=>({["__scope".concat(t)]:l(l({},o),{},{[t]:r})})),[o,r])}};return r.scopeName=t,[function(n,r){const i=e.createContext(r),s=o.length;o=[...o,r];const a=n=>{var o;const{scope:r,children:a}=n,l=yr(n,ew),c=(null===r||void 0===r||null===(o=r[t])||void 0===o?void 0:o[s])||i,d=e.useMemo((()=>l),Object.values(l));return(0,Ss.jsx)(c.Provider,{value:d,children:a})};return a.displayName=n+"Provider",[a,function(o,a){var l;const c=(null===a||void 0===a||null===(l=a[t])||void 0===l?void 0:l[s])||i,d=e.useContext(c);if(d)return d;if(void 0!==r)return r;throw new Error("`".concat(o,"` must be used within `").concat(n,"`"))}]},nw(r,...n)]}function nw(){for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];const r=n[0];if(1===n.length)return r;const i=()=>{const t=n.map((e=>({useScope:e(),scopeName:e.scopeName})));return function(n){const o=t.reduce(((e,t)=>{let{useScope:o,scopeName:r}=t;const i=o(n)["__scope".concat(r)];return l(l({},e),i)}),{});return e.useMemo((()=>({["__scope".concat(r.scopeName)]:o})),[o])}};return i.scopeName=r.scopeName,i}function ow(e,t){if("function"===typeof e)return e(t);null!==e&&void 0!==e&&(e.current=t)}function rw(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return e=>{let n=!1;const o=t.map((t=>{const o=ow(t,e);return n||"function"!=typeof o||(n=!0),o}));if(n)return()=>{for(let e=0;e<o.length;e++){const n=o[e];"function"==typeof n?n():ow(t[e],null)}}}}function iw(){for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return e.useCallback(rw(...n),n)}const sw=["children"],aw=["children"];var lw=e.forwardRef(((t,n)=>{const{children:o}=t,r=yr(t,sw),i=e.Children.toArray(o),s=i.find(uw);if(s){const t=s.props.children,o=i.map((n=>n===s?e.Children.count(t)>1?e.Children.only(null):e.isValidElement(t)?t.props.children:null:n));return(0,Ss.jsx)(cw,l(l({},r),{},{ref:n,children:e.isValidElement(t)?e.cloneElement(t,void 0,o):null}))}return(0,Ss.jsx)(cw,l(l({},r),{},{ref:n,children:o}))}));lw.displayName="Slot";var cw=e.forwardRef(((t,n)=>{const{children:o}=t,r=yr(t,aw);if(e.isValidElement(o)){const t=function(e){var t,n;let o=null===(t=Object.getOwnPropertyDescriptor(e.props,"ref"))||void 0===t?void 0:t.get,r=o&&"isReactWarning"in o&&o.isReactWarning;if(r)return e.ref;if(o=null===(n=Object.getOwnPropertyDescriptor(e,"ref"))||void 0===n?void 0:n.get,r=o&&"isReactWarning"in o&&o.isReactWarning,r)return e.props.ref;return e.props.ref||e.ref}(o);return e.cloneElement(o,l(l({},function(e,t){const n=l({},t);for(const o in t){const r=e[o],i=t[o];/^on[A-Z]/.test(o)?r&&i?n[o]=function(){i(...arguments),r(...arguments)}:r&&(n[o]=r):"style"===o?n[o]=l(l({},r),i):"className"===o&&(n[o]=[r,i].filter(Boolean).join(" "))}return l(l({},e),n)}(r,o.props)),{},{ref:n?rw(n,t):t}))}return e.Children.count(o)>1?e.Children.only(null):null}));cw.displayName="SlotClone";var dw=e=>{let{children:t}=e;return(0,Ss.jsx)(Ss.Fragment,{children:t})};function uw(t){return e.isValidElement(t)&&t.type===dw}const hw=["asChild"];var pw=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"].reduce(((t,n)=>{const o=e.forwardRef(((e,t)=>{const{asChild:o}=e,r=yr(e,hw),i=o?lw:n;return"undefined"!==typeof window&&(window[Symbol.for("radix-ui")]=!0),(0,Ss.jsx)(i,l(l({},r),{},{ref:t}))}));return o.displayName="Primitive.".concat(n),l(l({},t),{},{[n]:o})}),{});function fw(e,t){e&&Cu.flushSync((()=>e.dispatchEvent(t)))}const gw=["scope","children"];function mw(t){const n=t+"CollectionProvider",[o,r]=tw(n),[i,s]=o(n,{collectionRef:{current:null},itemMap:new Map}),a=t=>{const{scope:n,children:o}=t,r=e.useRef(null),s=e.useRef(new Map).current;return(0,Ss.jsx)(i,{scope:n,itemMap:s,collectionRef:r,children:o})};a.displayName=n;const c=t+"CollectionSlot",d=e.forwardRef(((e,t)=>{const{scope:n,children:o}=e,r=iw(t,s(c,n).collectionRef);return(0,Ss.jsx)(lw,{ref:r,children:o})}));d.displayName=c;const u=t+"CollectionItemSlot",h="data-radix-collection-item",p=e.forwardRef(((t,n)=>{const{scope:o,children:r}=t,i=yr(t,gw),a=e.useRef(null),c=iw(n,a),d=s(u,o);return e.useEffect((()=>(d.itemMap.set(a,l({ref:a},i)),()=>{d.itemMap.delete(a)}))),(0,Ss.jsx)(lw,l(l({},{[h]:""}),{},{ref:c,children:r}))}));return p.displayName=u,[{Provider:a,Slot:d,ItemSlot:p},function(n){const o=s(t+"CollectionConsumer",n);return e.useCallback((()=>{const e=o.collectionRef.current;if(!e)return[];const t=Array.from(e.querySelectorAll("[".concat(h,"]")));return Array.from(o.itemMap.values()).sort(((e,n)=>t.indexOf(e.ref.current)-t.indexOf(n.ref.current)))}),[o.collectionRef,o.itemMap])},r]}var yw=e.createContext(void 0);function vw(t){const n=e.useContext(yw);return t||n||"ltr"}function bw(t){const n=e.useRef(t);return e.useEffect((()=>{n.current=t})),e.useMemo((()=>function(){for(var e,t=arguments.length,o=new Array(t),r=0;r<t;r++)o[r]=arguments[r];return null===(e=n.current)||void 0===e?void 0:e.call(n,...o)}),[])}const ww=["disableOutsidePointerEvents","onEscapeKeyDown","onPointerDownOutside","onFocusOutside","onInteractOutside","onDismiss"];var xw,Sw="dismissableLayer.update",kw="dismissableLayer.pointerDownOutside",Pw="dismissableLayer.focusOutside",Cw=e.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),_w=e.forwardRef(((t,n)=>{var o;const{disableOutsidePointerEvents:r=!1,onEscapeKeyDown:i,onPointerDownOutside:s,onFocusOutside:a,onInteractOutside:c,onDismiss:d}=t,u=yr(t,ww),h=e.useContext(Cw),[p,f]=e.useState(null),g=null!==(o=null===p||void 0===p?void 0:p.ownerDocument)&&void 0!==o?o:null===globalThis||void 0===globalThis?void 0:globalThis.document,[,m]=e.useState({}),y=iw(n,(e=>f(e))),v=Array.from(h.layers),[b]=[...h.layersWithOutsidePointerEventsDisabled].slice(-1),w=v.indexOf(b),x=p?v.indexOf(p):-1,S=h.layersWithOutsidePointerEventsDisabled.size>0,k=x>=w,P=function(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null===globalThis||void 0===globalThis?void 0:globalThis.document;const o=bw(t),r=e.useRef(!1),i=e.useRef((()=>{}));return e.useEffect((()=>{const e=e=>{if(e.target&&!r.current){let t=function(){jw(kw,o,r,{discrete:!0})};const r={originalEvent:e};"touch"===e.pointerType?(n.removeEventListener("click",i.current),i.current=t,n.addEventListener("click",i.current,{once:!0})):t()}else n.removeEventListener("click",i.current);r.current=!1},t=window.setTimeout((()=>{n.addEventListener("pointerdown",e)}),0);return()=>{window.clearTimeout(t),n.removeEventListener("pointerdown",e),n.removeEventListener("click",i.current)}}),[n,o]),{onPointerDownCapture:()=>r.current=!0}}((e=>{const t=e.target,n=[...h.branches].some((e=>e.contains(t)));k&&!n&&(null===s||void 0===s||s(e),null===c||void 0===c||c(e),e.defaultPrevented||null===d||void 0===d||d())}),g),C=function(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null===globalThis||void 0===globalThis?void 0:globalThis.document;const o=bw(t),r=e.useRef(!1);return e.useEffect((()=>{const e=e=>{if(e.target&&!r.current){jw(Pw,o,{originalEvent:e},{discrete:!1})}};return n.addEventListener("focusin",e),()=>n.removeEventListener("focusin",e)}),[n,o]),{onFocusCapture:()=>r.current=!0,onBlurCapture:()=>r.current=!1}}((e=>{const t=e.target;[...h.branches].some((e=>e.contains(t)))||(null===a||void 0===a||a(e),null===c||void 0===c||c(e),e.defaultPrevented||null===d||void 0===d||d())}),g);return function(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null===globalThis||void 0===globalThis?void 0:globalThis.document;const o=bw(t);e.useEffect((()=>{const e=e=>{"Escape"===e.key&&o(e)};return n.addEventListener("keydown",e,{capture:!0}),()=>n.removeEventListener("keydown",e,{capture:!0})}),[o,n])}((e=>{x===h.layers.size-1&&(null===i||void 0===i||i(e),!e.defaultPrevented&&d&&(e.preventDefault(),d()))}),g),e.useEffect((()=>{if(p)return r&&(0===h.layersWithOutsidePointerEventsDisabled.size&&(xw=g.body.style.pointerEvents,g.body.style.pointerEvents="none"),h.layersWithOutsidePointerEventsDisabled.add(p)),h.layers.add(p),Ew(),()=>{r&&1===h.layersWithOutsidePointerEventsDisabled.size&&(g.body.style.pointerEvents=xw)}}),[p,g,r,h]),e.useEffect((()=>()=>{p&&(h.layers.delete(p),h.layersWithOutsidePointerEventsDisabled.delete(p),Ew())}),[p,h]),e.useEffect((()=>{const e=()=>m({});return document.addEventListener(Sw,e),()=>document.removeEventListener(Sw,e)}),[]),(0,Ss.jsx)(pw.div,l(l({},u),{},{ref:y,style:l({pointerEvents:S?k?"auto":"none":void 0},t.style),onFocusCapture:Qb(t.onFocusCapture,C.onFocusCapture),onBlurCapture:Qb(t.onBlurCapture,C.onBlurCapture),onPointerDownCapture:Qb(t.onPointerDownCapture,P.onPointerDownCapture)}))}));_w.displayName="DismissableLayer";var Iw=e.forwardRef(((t,n)=>{const o=e.useContext(Cw),r=e.useRef(null),i=iw(n,r);return e.useEffect((()=>{const e=r.current;if(e)return o.branches.add(e),()=>{o.branches.delete(e)}}),[o.branches]),(0,Ss.jsx)(pw.div,l(l({},t),{},{ref:i}))}));function Ew(){const e=new CustomEvent(Sw);document.dispatchEvent(e)}function jw(e,t,n,o){let{discrete:r}=o;const i=n.originalEvent.target,s=new CustomEvent(e,{bubbles:!1,cancelable:!0,detail:n});t&&i.addEventListener(e,t,{once:!0}),r?fw(i,s):i.dispatchEvent(s)}Iw.displayName="DismissableLayerBranch";var Tw=_w,Mw=Iw,Aw=0;function Ow(){e.useEffect((()=>{var e,t;const n=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",null!==(e=n[0])&&void 0!==e?e:Dw()),document.body.insertAdjacentElement("beforeend",null!==(t=n[1])&&void 0!==t?t:Dw()),Aw++,()=>{1===Aw&&document.querySelectorAll("[data-radix-focus-guard]").forEach((e=>e.remove())),Aw--}}),[])}function Dw(){const e=document.createElement("span");return e.setAttribute("data-radix-focus-guard",""),e.tabIndex=0,e.style.outline="none",e.style.opacity="0",e.style.position="fixed",e.style.pointerEvents="none",e}const Rw=["loop","trapped","onMountAutoFocus","onUnmountAutoFocus"];var Lw="focusScope.autoFocusOnMount",zw="focusScope.autoFocusOnUnmount",Nw={bubbles:!1,cancelable:!0},Fw=e.forwardRef(((t,n)=>{const{loop:o=!1,trapped:r=!1,onMountAutoFocus:i,onUnmountAutoFocus:s}=t,a=yr(t,Rw),[c,d]=e.useState(null),u=bw(i),h=bw(s),p=e.useRef(null),f=iw(n,(e=>d(e))),g=e.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;e.useEffect((()=>{if(r){let e=function(e){if(g.paused||!c)return;const t=e.target;c.contains(t)?p.current=t:Kw(p.current,{select:!0})},t=function(e){if(g.paused||!c)return;const t=e.relatedTarget;null!==t&&(c.contains(t)||Kw(p.current,{select:!0}))},n=function(e){if(document.activeElement===document.body)for(const t of e)t.removedNodes.length>0&&Kw(c)};document.addEventListener("focusin",e),document.addEventListener("focusout",t);const o=new MutationObserver(n);return c&&o.observe(c,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",e),document.removeEventListener("focusout",t),o.disconnect()}}}),[r,c,g.paused]),e.useEffect((()=>{if(c){Vw.add(g);const t=document.activeElement;if(!c.contains(t)){const n=new CustomEvent(Lw,Nw);c.addEventListener(Lw,u),c.dispatchEvent(n),n.defaultPrevented||(!function(e){let{select:t=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=document.activeElement;for(const o of e)if(Kw(o,{select:t}),document.activeElement!==n)return}((e=Bw(c),e.filter((e=>"A"!==e.tagName))),{select:!0}),document.activeElement===t&&Kw(c))}return()=>{c.removeEventListener(Lw,u),setTimeout((()=>{const e=new CustomEvent(zw,Nw);c.addEventListener(zw,h),c.dispatchEvent(e),e.defaultPrevented||Kw(null!==t&&void 0!==t?t:document.body,{select:!0}),c.removeEventListener(zw,h),Vw.remove(g)}),0)}}var e}),[c,u,h,g]);const m=e.useCallback((e=>{if(!o&&!r)return;if(g.paused)return;const t="Tab"===e.key&&!e.altKey&&!e.ctrlKey&&!e.metaKey,n=document.activeElement;if(t&&n){const t=e.currentTarget,[r,i]=function(e){const t=Bw(e),n=Uw(t,e),o=Uw(t.reverse(),e);return[n,o]}(t);r&&i?e.shiftKey||n!==i?e.shiftKey&&n===r&&(e.preventDefault(),o&&Kw(i,{select:!0})):(e.preventDefault(),o&&Kw(r,{select:!0})):n===t&&e.preventDefault()}}),[o,r,g.paused]);return(0,Ss.jsx)(pw.div,l(l({tabIndex:-1},a),{},{ref:f,onKeyDown:m}))}));function Bw(e){const t=[],n=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:e=>{const t="INPUT"===e.tagName&&"hidden"===e.type;return e.disabled||e.hidden||t?NodeFilter.FILTER_SKIP:e.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)t.push(n.currentNode);return t}function Uw(e,t){for(const n of e)if(!Hw(n,{upTo:t}))return n}function Hw(e,t){let{upTo:n}=t;if("hidden"===getComputedStyle(e).visibility)return!0;for(;e;){if(void 0!==n&&e===n)return!1;if("none"===getComputedStyle(e).display)return!0;e=e.parentElement}return!1}function Kw(e){let{select:t=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(e&&e.focus){const n=document.activeElement;e.focus({preventScroll:!0}),e!==n&&function(e){return e instanceof HTMLInputElement&&"select"in e}(e)&&t&&e.select()}}Fw.displayName="FocusScope";var Vw=function(){let e=[];return{add(t){const n=e[0];t!==n&&(null===n||void 0===n||n.pause()),e=Ww(e,t),e.unshift(t)},remove(t){var n;e=Ww(e,t),null===(n=e[0])||void 0===n||n.resume()}}}();function Ww(e,t){const n=[...e],o=n.indexOf(t);return-1!==o&&n.splice(o,1),n}var qw=Boolean(null===globalThis||void 0===globalThis?void 0:globalThis.document)?e.useLayoutEffect:()=>{},Yw=t["useId".toString()]||(()=>{}),Gw=0;function Xw(t){const[n,o]=e.useState(Yw());return qw((()=>{t||o((e=>null!==e&&void 0!==e?e:String(Gw++)))}),[t]),t||(n?"radix-".concat(n):"")}const $w=["top","right","bottom","left"],Zw=Math.min,Qw=Math.max,Jw=Math.round,ex=Math.floor,tx=e=>({x:e,y:e}),nx={left:"right",right:"left",bottom:"top",top:"bottom"},ox={start:"end",end:"start"};function rx(e,t,n){return Qw(e,Zw(t,n))}function ix(e,t){return"function"===typeof e?e(t):e}function sx(e){return e.split("-")[0]}function ax(e){return e.split("-")[1]}function lx(e){return"x"===e?"y":"x"}function cx(e){return"y"===e?"height":"width"}function dx(e){return["top","bottom"].includes(sx(e))?"y":"x"}function ux(e){return lx(dx(e))}function hx(e){return e.replace(/start|end/g,(e=>ox[e]))}function px(e){return e.replace(/left|right|bottom|top/g,(e=>nx[e]))}function fx(e){return"number"!==typeof e?function(e){return l({top:0,right:0,bottom:0,left:0},e)}(e):{top:e,right:e,bottom:e,left:e}}function gx(e){const{x:t,y:n,width:o,height:r}=e;return{width:o,height:r,top:n,left:t,right:t+o,bottom:n+r,x:t,y:n}}const mx=["mainAxis","crossAxis","fallbackPlacements","fallbackStrategy","fallbackAxisSideDirection","flipAlignment"],yx=["strategy"],vx=["mainAxis","crossAxis","limiter"],bx=["apply"];function wx(e,t,n){let{reference:o,floating:r}=e;const i=dx(t),s=ux(t),a=cx(s),l=sx(t),c="y"===i,d=o.x+o.width/2-r.width/2,u=o.y+o.height/2-r.height/2,h=o[a]/2-r[a]/2;let p;switch(l){case"top":p={x:d,y:o.y-r.height};break;case"bottom":p={x:d,y:o.y+o.height};break;case"right":p={x:o.x+o.width,y:u};break;case"left":p={x:o.x-r.width,y:u};break;default:p={x:o.x,y:o.y}}switch(ax(t)){case"start":p[s]-=h*(n&&c?-1:1);break;case"end":p[s]+=h*(n&&c?-1:1)}return p}async function xx(e,t){var n;void 0===t&&(t={});const{x:o,y:r,platform:i,rects:s,elements:a,strategy:l}=e,{boundary:c="clippingAncestors",rootBoundary:d="viewport",elementContext:u="floating",altBoundary:h=!1,padding:p=0}=ix(t,e),f=fx(p),g=a[h?"floating"===u?"reference":"floating":u],m=gx(await i.getClippingRect({element:null==(n=await(null==i.isElement?void 0:i.isElement(g)))||n?g:g.contextElement||await(null==i.getDocumentElement?void 0:i.getDocumentElement(a.floating)),boundary:c,rootBoundary:d,strategy:l})),y="floating"===u?{x:o,y:r,width:s.floating.width,height:s.floating.height}:s.reference,v=await(null==i.getOffsetParent?void 0:i.getOffsetParent(a.floating)),b=await(null==i.isElement?void 0:i.isElement(v))&&await(null==i.getScale?void 0:i.getScale(v))||{x:1,y:1},w=gx(i.convertOffsetParentRelativeRectToViewportRelativeRect?await i.convertOffsetParentRelativeRectToViewportRelativeRect({elements:a,rect:y,offsetParent:v,strategy:l}):y);return{top:(m.top-w.top+f.top)/b.y,bottom:(w.bottom-m.bottom+f.bottom)/b.y,left:(m.left-w.left+f.left)/b.x,right:(w.right-m.right+f.right)/b.x}}function Sx(e,t){return{top:e.top-t.height,right:e.right-t.width,bottom:e.bottom-t.height,left:e.left-t.width}}function kx(e){return $w.some((t=>e[t]>=0))}function Px(){return"undefined"!==typeof window}function Cx(e){return Ex(e)?(e.nodeName||"").toLowerCase():"#document"}function _x(e){var t;return(null==e||null==(t=e.ownerDocument)?void 0:t.defaultView)||window}function Ix(e){var t;return null==(t=(Ex(e)?e.ownerDocument:e.document)||window.document)?void 0:t.documentElement}function Ex(e){return!!Px()&&(e instanceof Node||e instanceof _x(e).Node)}function jx(e){return!!Px()&&(e instanceof Element||e instanceof _x(e).Element)}function Tx(e){return!!Px()&&(e instanceof HTMLElement||e instanceof _x(e).HTMLElement)}function Mx(e){return!(!Px()||"undefined"===typeof ShadowRoot)&&(e instanceof ShadowRoot||e instanceof _x(e).ShadowRoot)}function Ax(e){const{overflow:t,overflowX:n,overflowY:o,display:r}=Nx(e);return/auto|scroll|overlay|hidden|clip/.test(t+o+n)&&!["inline","contents"].includes(r)}function Ox(e){return["table","td","th"].includes(Cx(e))}function Dx(e){return[":popover-open",":modal"].some((t=>{try{return e.matches(t)}catch(n){return!1}}))}function Rx(e){const t=Lx(),n=jx(e)?Nx(e):e;return"none"!==n.transform||"none"!==n.perspective||!!n.containerType&&"normal"!==n.containerType||!t&&!!n.backdropFilter&&"none"!==n.backdropFilter||!t&&!!n.filter&&"none"!==n.filter||["transform","perspective","filter"].some((e=>(n.willChange||"").includes(e)))||["paint","layout","strict","content"].some((e=>(n.contain||"").includes(e)))}function Lx(){return!("undefined"===typeof CSS||!CSS.supports)&&CSS.supports("-webkit-backdrop-filter","none")}function zx(e){return["html","body","#document"].includes(Cx(e))}function Nx(e){return _x(e).getComputedStyle(e)}function Fx(e){return jx(e)?{scrollLeft:e.scrollLeft,scrollTop:e.scrollTop}:{scrollLeft:e.scrollX,scrollTop:e.scrollY}}function Bx(e){if("html"===Cx(e))return e;const t=e.assignedSlot||e.parentNode||Mx(e)&&e.host||Ix(e);return Mx(t)?t.host:t}function Ux(e){const t=Bx(e);return zx(t)?e.ownerDocument?e.ownerDocument.body:e.body:Tx(t)&&Ax(t)?t:Ux(t)}function Hx(e,t,n){var o;void 0===t&&(t=[]),void 0===n&&(n=!0);const r=Ux(e),i=r===(null==(o=e.ownerDocument)?void 0:o.body),s=_x(r);if(i){const e=Kx(s);return t.concat(s,s.visualViewport||[],Ax(r)?r:[],e&&n?Hx(e):[])}return t.concat(r,Hx(r,[],n))}function Kx(e){return e.parent&&Object.getPrototypeOf(e.parent)?e.frameElement:null}function Vx(e){const t=Nx(e);let n=parseFloat(t.width)||0,o=parseFloat(t.height)||0;const r=Tx(e),i=r?e.offsetWidth:n,s=r?e.offsetHeight:o,a=Jw(n)!==i||Jw(o)!==s;return a&&(n=i,o=s),{width:n,height:o,$:a}}function Wx(e){return jx(e)?e:e.contextElement}function qx(e){const t=Wx(e);if(!Tx(t))return tx(1);const n=t.getBoundingClientRect(),{width:o,height:r,$:i}=Vx(t);let s=(i?Jw(n.width):n.width)/o,a=(i?Jw(n.height):n.height)/r;return s&&Number.isFinite(s)||(s=1),a&&Number.isFinite(a)||(a=1),{x:s,y:a}}const Yx=tx(0);function Gx(e){const t=_x(e);return Lx()&&t.visualViewport?{x:t.visualViewport.offsetLeft,y:t.visualViewport.offsetTop}:Yx}function Xx(e,t,n,o){void 0===t&&(t=!1),void 0===n&&(n=!1);const r=e.getBoundingClientRect(),i=Wx(e);let s=tx(1);t&&(o?jx(o)&&(s=qx(o)):s=qx(e));const a=function(e,t,n){return void 0===t&&(t=!1),!(!n||t&&n!==_x(e))&&t}(i,n,o)?Gx(i):tx(0);let l=(r.left+a.x)/s.x,c=(r.top+a.y)/s.y,d=r.width/s.x,u=r.height/s.y;if(i){const e=_x(i),t=o&&jx(o)?_x(o):o;let n=e,r=Kx(n);for(;r&&o&&t!==n;){const e=qx(r),t=r.getBoundingClientRect(),o=Nx(r),i=t.left+(r.clientLeft+parseFloat(o.paddingLeft))*e.x,s=t.top+(r.clientTop+parseFloat(o.paddingTop))*e.y;l*=e.x,c*=e.y,d*=e.x,u*=e.y,l+=i,c+=s,n=_x(r),r=Kx(n)}}return gx({width:d,height:u,x:l,y:c})}function $x(e,t){const n=Fx(e).scrollLeft;return t?t.left+n:Xx(Ix(e)).left+n}function Zx(e,t,n){void 0===n&&(n=!1);const o=e.getBoundingClientRect();return{x:o.left+t.scrollLeft-(n?0:$x(e,o)),y:o.top+t.scrollTop}}function Qx(e,t,n){let o;if("viewport"===t)o=function(e,t){const n=_x(e),o=Ix(e),r=n.visualViewport;let i=o.clientWidth,s=o.clientHeight,a=0,l=0;if(r){i=r.width,s=r.height;const e=Lx();(!e||e&&"fixed"===t)&&(a=r.offsetLeft,l=r.offsetTop)}return{width:i,height:s,x:a,y:l}}(e,n);else if("document"===t)o=function(e){const t=Ix(e),n=Fx(e),o=e.ownerDocument.body,r=Qw(t.scrollWidth,t.clientWidth,o.scrollWidth,o.clientWidth),i=Qw(t.scrollHeight,t.clientHeight,o.scrollHeight,o.clientHeight);let s=-n.scrollLeft+$x(e);const a=-n.scrollTop;return"rtl"===Nx(o).direction&&(s+=Qw(t.clientWidth,o.clientWidth)-r),{width:r,height:i,x:s,y:a}}(Ix(e));else if(jx(t))o=function(e,t){const n=Xx(e,!0,"fixed"===t),o=n.top+e.clientTop,r=n.left+e.clientLeft,i=Tx(e)?qx(e):tx(1);return{width:e.clientWidth*i.x,height:e.clientHeight*i.y,x:r*i.x,y:o*i.y}}(t,n);else{const n=Gx(e);o={x:t.x-n.x,y:t.y-n.y,width:t.width,height:t.height}}return gx(o)}function Jx(e,t){const n=Bx(e);return!(n===t||!jx(n)||zx(n))&&("fixed"===Nx(n).position||Jx(n,t))}function eS(e,t,n){const o=Tx(t),r=Ix(t),i="fixed"===n,s=Xx(e,!0,i,t);let a={scrollLeft:0,scrollTop:0};const l=tx(0);if(o||!o&&!i)if(("body"!==Cx(t)||Ax(r))&&(a=Fx(t)),o){const e=Xx(t,!0,i,t);l.x=e.x+t.clientLeft,l.y=e.y+t.clientTop}else r&&(l.x=$x(r));const c=!r||o||i?tx(0):Zx(r,a);return{x:s.left+a.scrollLeft-l.x-c.x,y:s.top+a.scrollTop-l.y-c.y,width:s.width,height:s.height}}function tS(e){return"static"===Nx(e).position}function nS(e,t){if(!Tx(e)||"fixed"===Nx(e).position)return null;if(t)return t(e);let n=e.offsetParent;return Ix(e)===n&&(n=n.ownerDocument.body),n}function oS(e,t){const n=_x(e);if(Dx(e))return n;if(!Tx(e)){let t=Bx(e);for(;t&&!zx(t);){if(jx(t)&&!tS(t))return t;t=Bx(t)}return n}let o=nS(e,t);for(;o&&Ox(o)&&tS(o);)o=nS(o,t);return o&&zx(o)&&tS(o)&&!Rx(o)?n:o||function(e){let t=Bx(e);for(;Tx(t)&&!zx(t);){if(Rx(t))return t;if(Dx(t))return null;t=Bx(t)}return null}(e)||n}const rS={convertOffsetParentRelativeRectToViewportRelativeRect:function(e){let{elements:t,rect:n,offsetParent:o,strategy:r}=e;const i="fixed"===r,s=Ix(o),a=!!t&&Dx(t.floating);if(o===s||a&&i)return n;let l={scrollLeft:0,scrollTop:0},c=tx(1);const d=tx(0),u=Tx(o);if((u||!u&&!i)&&(("body"!==Cx(o)||Ax(s))&&(l=Fx(o)),Tx(o))){const e=Xx(o);c=qx(o),d.x=e.x+o.clientLeft,d.y=e.y+o.clientTop}const h=!s||u||i?tx(0):Zx(s,l,!0);return{width:n.width*c.x,height:n.height*c.y,x:n.x*c.x-l.scrollLeft*c.x+d.x+h.x,y:n.y*c.y-l.scrollTop*c.y+d.y+h.y}},getDocumentElement:Ix,getClippingRect:function(e){let{element:t,boundary:n,rootBoundary:o,strategy:r}=e;const i=[..."clippingAncestors"===n?Dx(t)?[]:function(e,t){const n=t.get(e);if(n)return n;let o=Hx(e,[],!1).filter((e=>jx(e)&&"body"!==Cx(e))),r=null;const i="fixed"===Nx(e).position;let s=i?Bx(e):e;for(;jx(s)&&!zx(s);){const t=Nx(s),n=Rx(s);n||"fixed"!==t.position||(r=null),(i?!n&&!r:!n&&"static"===t.position&&r&&["absolute","fixed"].includes(r.position)||Ax(s)&&!n&&Jx(e,s))?o=o.filter((e=>e!==s)):r=t,s=Bx(s)}return t.set(e,o),o}(t,this._c):[].concat(n),o],s=i[0],a=i.reduce(((e,n)=>{const o=Qx(t,n,r);return e.top=Qw(o.top,e.top),e.right=Zw(o.right,e.right),e.bottom=Zw(o.bottom,e.bottom),e.left=Qw(o.left,e.left),e}),Qx(t,s,r));return{width:a.right-a.left,height:a.bottom-a.top,x:a.left,y:a.top}},getOffsetParent:oS,getElementRects:async function(e){const t=this.getOffsetParent||oS,n=this.getDimensions,o=await n(e.floating);return{reference:eS(e.reference,await t(e.floating),e.strategy),floating:{x:0,y:0,width:o.width,height:o.height}}},getClientRects:function(e){return Array.from(e.getClientRects())},getDimensions:function(e){const{width:t,height:n}=Vx(e);return{width:t,height:n}},getScale:qx,isElement:jx,isRTL:function(e){return"rtl"===Nx(e).direction}};function iS(e,t,n,o){void 0===o&&(o={});const{ancestorScroll:r=!0,ancestorResize:i=!0,elementResize:s="function"===typeof ResizeObserver,layoutShift:a="function"===typeof IntersectionObserver,animationFrame:c=!1}=o,d=Wx(e),u=r||i?[...d?Hx(d):[],...Hx(t)]:[];u.forEach((e=>{r&&e.addEventListener("scroll",n,{passive:!0}),i&&e.addEventListener("resize",n)}));const h=d&&a?function(e,t){let n,o=null;const r=Ix(e);function i(){var e;clearTimeout(n),null==(e=o)||e.disconnect(),o=null}return function s(a,c){void 0===a&&(a=!1),void 0===c&&(c=1),i();const{left:d,top:u,width:h,height:p}=e.getBoundingClientRect();if(a||t(),!h||!p)return;const f={rootMargin:-ex(u)+"px "+-ex(r.clientWidth-(d+h))+"px "+-ex(r.clientHeight-(u+p))+"px "+-ex(d)+"px",threshold:Qw(0,Zw(1,c))||1};let g=!0;function m(e){const t=e[0].intersectionRatio;if(t!==c){if(!g)return s();t?s(!1,t):n=setTimeout((()=>{s(!1,1e-7)}),1e3)}g=!1}try{o=new IntersectionObserver(m,l(l({},f),{},{root:r.ownerDocument}))}catch(y){o=new IntersectionObserver(m,f)}o.observe(e)}(!0),i}(d,n):null;let p,f=-1,g=null;s&&(g=new ResizeObserver((e=>{let[o]=e;o&&o.target===d&&g&&(g.unobserve(t),cancelAnimationFrame(f),f=requestAnimationFrame((()=>{var e;null==(e=g)||e.observe(t)}))),n()})),d&&!c&&g.observe(d),g.observe(t));let m=c?Xx(e):null;return c&&function t(){const o=Xx(e);!m||o.x===m.x&&o.y===m.y&&o.width===m.width&&o.height===m.height||n();m=o,p=requestAnimationFrame(t)}(),n(),()=>{var e;u.forEach((e=>{r&&e.removeEventListener("scroll",n),i&&e.removeEventListener("resize",n)})),null==h||h(),null==(e=g)||e.disconnect(),g=null,c&&cancelAnimationFrame(p)}}const sS=function(e){return void 0===e&&(e=0),{name:"offset",options:e,async fn(t){var n,o;const{x:r,y:i,placement:s,middlewareData:a}=t,c=await async function(e,t){const{placement:n,platform:o,elements:r}=e,i=await(null==o.isRTL?void 0:o.isRTL(r.floating)),s=sx(n),a=ax(n),l="y"===dx(n),c=["left","top"].includes(s)?-1:1,d=i&&l?-1:1,u=ix(t,e);let{mainAxis:h,crossAxis:p,alignmentAxis:f}="number"===typeof u?{mainAxis:u,crossAxis:0,alignmentAxis:null}:{mainAxis:u.mainAxis||0,crossAxis:u.crossAxis||0,alignmentAxis:u.alignmentAxis};return a&&"number"===typeof f&&(p="end"===a?-1*f:f),l?{x:p*d,y:h*c}:{x:h*c,y:p*d}}(t,e);return s===(null==(n=a.offset)?void 0:n.placement)&&null!=(o=a.arrow)&&o.alignmentOffset?{}:{x:r+c.x,y:i+c.y,data:l(l({},c),{},{placement:s})}}}},aS=function(e){return void 0===e&&(e={}),{name:"shift",options:e,async fn(t){const{x:n,y:o,placement:r}=t,i=ix(e,t),{mainAxis:s=!0,crossAxis:a=!1,limiter:c={fn:e=>{let{x:t,y:n}=e;return{x:t,y:n}}}}=i,d=yr(i,vx),u={x:n,y:o},h=await xx(t,d),p=dx(sx(r)),f=lx(p);let g=u[f],m=u[p];if(s){const e="y"===f?"bottom":"right";g=rx(g+h["y"===f?"top":"left"],g,g-h[e])}if(a){const e="y"===p?"bottom":"right";m=rx(m+h["y"===p?"top":"left"],m,m-h[e])}const y=c.fn(l(l({},t),{},{[f]:g,[p]:m}));return l(l({},y),{},{data:{x:y.x-n,y:y.y-o,enabled:{[f]:s,[p]:a}}})}}},lS=function(e){return void 0===e&&(e={}),{name:"flip",options:e,async fn(t){var n,o;const{placement:r,middlewareData:i,rects:s,initialPlacement:a,platform:l,elements:c}=t,d=ix(e,t),{mainAxis:u=!0,crossAxis:h=!0,fallbackPlacements:p,fallbackStrategy:f="bestFit",fallbackAxisSideDirection:g="none",flipAlignment:m=!0}=d,y=yr(d,mx);if(null!=(n=i.arrow)&&n.alignmentOffset)return{};const v=sx(r),b=dx(a),w=sx(a)===a,x=await(null==l.isRTL?void 0:l.isRTL(c.floating)),S=p||(w||!m?[px(a)]:function(e){const t=px(e);return[hx(e),t,hx(t)]}(a)),k="none"!==g;!p&&k&&S.push(...function(e,t,n,o){const r=ax(e);let i=function(e,t,n){const o=["left","right"],r=["right","left"],i=["top","bottom"],s=["bottom","top"];switch(e){case"top":case"bottom":return n?t?r:o:t?o:r;case"left":case"right":return t?i:s;default:return[]}}(sx(e),"start"===n,o);return r&&(i=i.map((e=>e+"-"+r)),t&&(i=i.concat(i.map(hx)))),i}(a,m,g,x));const P=[a,...S],C=await xx(t,y),_=[];let I=(null==(o=i.flip)?void 0:o.overflows)||[];if(u&&_.push(C[v]),h){const e=function(e,t,n){void 0===n&&(n=!1);const o=ax(e),r=ux(e),i=cx(r);let s="x"===r?o===(n?"end":"start")?"right":"left":"start"===o?"bottom":"top";return t.reference[i]>t.floating[i]&&(s=px(s)),[s,px(s)]}(r,s,x);_.push(C[e[0]],C[e[1]])}if(I=[...I,{placement:r,overflows:_}],!_.every((e=>e<=0))){var E,j;const e=((null==(E=i.flip)?void 0:E.index)||0)+1,t=P[e];if(t)return{data:{index:e,overflows:I},reset:{placement:t}};let n=null==(j=I.filter((e=>e.overflows[0]<=0)).sort(((e,t)=>e.overflows[1]-t.overflows[1]))[0])?void 0:j.placement;if(!n)switch(f){case"bestFit":{var T;const e=null==(T=I.filter((e=>{if(k){const t=dx(e.placement);return t===b||"y"===t}return!0})).map((e=>[e.placement,e.overflows.filter((e=>e>0)).reduce(((e,t)=>e+t),0)])).sort(((e,t)=>e[1]-t[1]))[0])?void 0:T[0];e&&(n=e);break}case"initialPlacement":n=a}if(r!==n)return{reset:{placement:n}}}return{}}}},cS=function(e){return void 0===e&&(e={}),{name:"size",options:e,async fn(t){var n,o;const{placement:r,rects:i,platform:s,elements:a}=t,c=ix(e,t),{apply:d=()=>{}}=c,u=yr(c,bx),h=await xx(t,u),p=sx(r),f=ax(r),g="y"===dx(r),{width:m,height:y}=i.floating;let v,b;"top"===p||"bottom"===p?(v=p,b=f===(await(null==s.isRTL?void 0:s.isRTL(a.floating))?"start":"end")?"left":"right"):(b=p,v="end"===f?"top":"bottom");const w=y-h.top-h.bottom,x=m-h.left-h.right,S=Zw(y-h[v],w),k=Zw(m-h[b],x),P=!t.middlewareData.shift;let C=S,_=k;if(null!=(n=t.middlewareData.shift)&&n.enabled.x&&(_=x),null!=(o=t.middlewareData.shift)&&o.enabled.y&&(C=w),P&&!f){const e=Qw(h.left,0),t=Qw(h.right,0),n=Qw(h.top,0),o=Qw(h.bottom,0);g?_=m-2*(0!==e||0!==t?e+t:Qw(h.left,h.right)):C=y-2*(0!==n||0!==o?n+o:Qw(h.top,h.bottom))}await d(l(l({},t),{},{availableWidth:_,availableHeight:C}));const I=await s.getDimensions(a.floating);return m!==I.width||y!==I.height?{reset:{rects:!0}}:{}}}},dS=function(e){return void 0===e&&(e={}),{name:"hide",options:e,async fn(t){const{rects:n}=t,o=ix(e,t),{strategy:r="referenceHidden"}=o,i=yr(o,yx);switch(r){case"referenceHidden":{const e=Sx(await xx(t,l(l({},i),{},{elementContext:"reference"})),n.reference);return{data:{referenceHiddenOffsets:e,referenceHidden:kx(e)}}}case"escaped":{const e=Sx(await xx(t,l(l({},i),{},{altBoundary:!0})),n.floating);return{data:{escapedOffsets:e,escaped:kx(e)}}}default:return{}}}}},uS=e=>({name:"arrow",options:e,async fn(t){const{x:n,y:o,placement:r,rects:i,platform:s,elements:a,middlewareData:c}=t,{element:d,padding:u=0}=ix(e,t)||{};if(null==d)return{};const h=fx(u),p={x:n,y:o},f=ux(r),g=cx(f),m=await s.getDimensions(d),y="y"===f,v=y?"top":"left",b=y?"bottom":"right",w=y?"clientHeight":"clientWidth",x=i.reference[g]+i.reference[f]-p[f]-i.floating[g],S=p[f]-i.reference[f],k=await(null==s.getOffsetParent?void 0:s.getOffsetParent(d));let P=k?k[w]:0;P&&await(null==s.isElement?void 0:s.isElement(k))||(P=a.floating[w]||i.floating[g]);const C=x/2-S/2,_=P/2-m[g]/2-1,I=Zw(h[v],_),E=Zw(h[b],_),j=I,T=P-m[g]-E,M=P/2-m[g]/2+C,A=rx(j,M,T),O=!c.arrow&&null!=ax(r)&&M!==A&&i.reference[g]/2-(M<j?I:E)-m[g]/2<0,D=O?M<j?M-j:M-T:0;return{[f]:p[f]+D,data:l({[f]:A,centerOffset:M-A-D},O&&{alignmentOffset:D}),reset:O}}}),hS=function(e){return void 0===e&&(e={}),{options:e,fn(t){const{x:n,y:o,placement:r,rects:i,middlewareData:s}=t,{offset:a=0,mainAxis:c=!0,crossAxis:d=!0}=ix(e,t),u={x:n,y:o},h=dx(r),p=lx(h);let f=u[p],g=u[h];const m=ix(a,t),y="number"===typeof m?{mainAxis:m,crossAxis:0}:l({mainAxis:0,crossAxis:0},m);if(c){const e="y"===p?"height":"width",t=i.reference[p]-i.floating[e]+y.mainAxis,n=i.reference[p]+i.reference[e]-y.mainAxis;f<t?f=t:f>n&&(f=n)}if(d){var v,b;const e="y"===p?"width":"height",t=["top","left"].includes(sx(r)),n=i.reference[h]-i.floating[e]+(t&&(null==(v=s.offset)?void 0:v[h])||0)+(t?0:y.crossAxis),o=i.reference[h]+i.reference[e]+(t?0:(null==(b=s.offset)?void 0:b[h])||0)-(t?y.crossAxis:0);g<n?g=n:g>o&&(g=o)}return{[p]:f,[h]:g}}}},pS=(e,t,n)=>{const o=new Map,r=l({platform:rS},n),i=l(l({},r.platform),{},{_c:o});return(async(e,t,n)=>{const{placement:o="bottom",strategy:r="absolute",middleware:i=[],platform:s}=n,a=i.filter(Boolean),c=await(null==s.isRTL?void 0:s.isRTL(t));let d=await s.getElementRects({reference:e,floating:t,strategy:r}),{x:u,y:h}=wx(d,o,c),p=o,f={},g=0;for(let m=0;m<a.length;m++){const{name:n,fn:i}=a[m],{x:y,y:v,data:b,reset:w}=await i({x:u,y:h,initialPlacement:o,placement:p,strategy:r,middlewareData:f,rects:d,platform:s,elements:{reference:e,floating:t}});u=null!=y?y:u,h=null!=v?v:h,f=l(l({},f),{},{[n]:l(l({},f[n]),b)}),w&&g<=50&&(g++,"object"===typeof w&&(w.placement&&(p=w.placement),w.rects&&(d=!0===w.rects?await s.getElementRects({reference:e,floating:t,strategy:r}):w.rects),({x:u,y:h}=wx(d,p,c))),m=-1)}return{x:u,y:h,placement:p,strategy:r,middlewareData:f}})(e,t,l(l({},r),{},{platform:i}))};var fS="undefined"!==typeof document?e.useLayoutEffect:e.useEffect;function gS(e,t){if(e===t)return!0;if(typeof e!==typeof t)return!1;if("function"===typeof e&&e.toString()===t.toString())return!0;let n,o,r;if(e&&t&&"object"===typeof e){if(Array.isArray(e)){if(n=e.length,n!==t.length)return!1;for(o=n;0!==o--;)if(!gS(e[o],t[o]))return!1;return!0}if(r=Object.keys(e),n=r.length,n!==Object.keys(t).length)return!1;for(o=n;0!==o--;)if(!{}.hasOwnProperty.call(t,r[o]))return!1;for(o=n;0!==o--;){const n=r[o];if(("_owner"!==n||!e.$$typeof)&&!gS(e[n],t[n]))return!1}return!0}return e!==e&&t!==t}function mS(e){if("undefined"===typeof window)return 1;return(e.ownerDocument.defaultView||window).devicePixelRatio||1}function yS(e,t){const n=mS(e);return Math.round(t*n)/n}function vS(t){const n=e.useRef(t);return fS((()=>{n.current=t})),n}const bS=(e,t)=>l(l({},sS(e)),{},{options:[e,t]}),wS=(e,t)=>l(l({},aS(e)),{},{options:[e,t]}),xS=(e,t)=>l(l({},hS(e)),{},{options:[e,t]}),SS=(e,t)=>l(l({},lS(e)),{},{options:[e,t]}),kS=(e,t)=>l(l({},cS(e)),{},{options:[e,t]}),PS=(e,t)=>l(l({},dS(e)),{},{options:[e,t]}),CS=(e,t)=>l(l({},(e=>({name:"arrow",options:e,fn(t){const{element:n,padding:o}="function"===typeof e?e(t):e;return n&&(r=n,{}.hasOwnProperty.call(r,"current"))?null!=n.current?uS({element:n.current,padding:o}).fn(t):{}:n?uS({element:n,padding:o}).fn(t):{};var r}}))(e)),{},{options:[e,t]}),_S=["children","width","height"];var IS=e.forwardRef(((e,t)=>{const{children:n,width:o=10,height:r=5}=e,i=yr(e,_S);return(0,Ss.jsx)(pw.svg,l(l({},i),{},{ref:t,width:o,height:r,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:e.asChild?n:(0,Ss.jsx)("polygon",{points:"0,0 30,0 15,10"})}))}));IS.displayName="Arrow";var ES=IS;function jS(t){const[n,o]=e.useState(void 0);return qw((()=>{if(t){o({width:t.offsetWidth,height:t.offsetHeight});const e=new ResizeObserver((e=>{if(!Array.isArray(e))return;if(!e.length)return;const n=e[0];let r,i;if("borderBoxSize"in n){const e=n.borderBoxSize,t=Array.isArray(e)?e[0]:e;r=t.inlineSize,i=t.blockSize}else r=t.offsetWidth,i=t.offsetHeight;o({width:r,height:i})}));return e.observe(t,{box:"border-box"}),()=>e.unobserve(t)}o(void 0)}),[t]),n}const TS=["__scopePopper","virtualRef"],MS=["__scopePopper","side","sideOffset","align","alignOffset","arrowPadding","avoidCollisions","collisionBoundary","collisionPadding","sticky","hideWhenDetached","updatePositionStrategy","onPlaced"],AS=["__scopePopper"];var OS="Popper",[DS,RS]=tw(OS),[LS,zS]=DS(OS),NS=t=>{const{__scopePopper:n,children:o}=t,[r,i]=e.useState(null);return(0,Ss.jsx)(LS,{scope:n,anchor:r,onAnchorChange:i,children:o})};NS.displayName=OS;var FS="PopperAnchor",BS=e.forwardRef(((t,n)=>{const{__scopePopper:o,virtualRef:r}=t,i=yr(t,TS),s=zS(FS,o),a=e.useRef(null),c=iw(n,a);return e.useEffect((()=>{s.onAnchorChange((null===r||void 0===r?void 0:r.current)||a.current)})),r?null:(0,Ss.jsx)(pw.div,l(l({},i),{},{ref:c}))}));BS.displayName=FS;var US="PopperContent",[HS,KS]=DS(US),VS=e.forwardRef(((t,n)=>{var o,r,i,s,a,c,d,u;const{__scopePopper:h,side:p="bottom",sideOffset:f=0,align:g="center",alignOffset:m=0,arrowPadding:y=0,avoidCollisions:v=!0,collisionBoundary:b=[],collisionPadding:w=0,sticky:x="partial",hideWhenDetached:S=!1,updatePositionStrategy:k="optimized",onPlaced:P}=t,C=yr(t,MS),_=zS(US,h),[I,E]=e.useState(null),j=iw(n,(e=>E(e))),[T,M]=e.useState(null),A=jS(T),O=null!==(o=null===A||void 0===A?void 0:A.width)&&void 0!==o?o:0,D=null!==(r=null===A||void 0===A?void 0:A.height)&&void 0!==r?r:0,R=p+("center"!==g?"-"+g:""),L="number"===typeof w?w:l({top:0,right:0,bottom:0,left:0},w),z=Array.isArray(b)?b:[b],N=z.length>0,F={padding:L,boundary:z.filter(GS),altBoundary:N},{refs:B,floatingStyles:U,placement:H,isPositioned:K,middlewareData:V}=function(t){void 0===t&&(t={});const{placement:n="bottom",strategy:o="absolute",middleware:r=[],platform:i,elements:{reference:s,floating:a}={},transform:c=!0,whileElementsMounted:d,open:u}=t,[h,p]=e.useState({x:0,y:0,strategy:o,placement:n,middlewareData:{},isPositioned:!1}),[f,g]=e.useState(r);gS(f,r)||g(r);const[m,y]=e.useState(null),[v,b]=e.useState(null),w=e.useCallback((e=>{e!==P.current&&(P.current=e,y(e))}),[]),x=e.useCallback((e=>{e!==C.current&&(C.current=e,b(e))}),[]),S=s||m,k=a||v,P=e.useRef(null),C=e.useRef(null),_=e.useRef(h),I=null!=d,E=vS(d),j=vS(i),T=vS(u),M=e.useCallback((()=>{if(!P.current||!C.current)return;const e={placement:n,strategy:o,middleware:f};j.current&&(e.platform=j.current),pS(P.current,C.current,e).then((e=>{const t=l(l({},e),{},{isPositioned:!1!==T.current});A.current&&!gS(_.current,t)&&(_.current=t,Cu.flushSync((()=>{p(t)})))}))}),[f,n,o,j,T]);fS((()=>{!1===u&&_.current.isPositioned&&(_.current.isPositioned=!1,p((e=>l(l({},e),{},{isPositioned:!1}))))}),[u]);const A=e.useRef(!1);fS((()=>(A.current=!0,()=>{A.current=!1})),[]),fS((()=>{if(S&&(P.current=S),k&&(C.current=k),S&&k){if(E.current)return E.current(S,k,M);M()}}),[S,k,M,E,I]);const O=e.useMemo((()=>({reference:P,floating:C,setReference:w,setFloating:x})),[w,x]),D=e.useMemo((()=>({reference:S,floating:k})),[S,k]),R=e.useMemo((()=>{const e={position:o,left:0,top:0};if(!D.floating)return e;const t=yS(D.floating,h.x),n=yS(D.floating,h.y);return c?l(l({},e),{},{transform:"translate("+t+"px, "+n+"px)"},mS(D.floating)>=1.5&&{willChange:"transform"}):{position:o,left:t,top:n}}),[o,c,D.floating,h.x,h.y]);return e.useMemo((()=>l(l({},h),{},{update:M,refs:O,elements:D,floatingStyles:R})),[h,M,O,D,R])}({strategy:"fixed",placement:R,whileElementsMounted:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return iS(...t,{animationFrame:"always"===k})},elements:{reference:_.anchor},middleware:[bS({mainAxis:f+D,alignmentAxis:m}),v&&wS(l({mainAxis:!0,crossAxis:!1,limiter:"partial"===x?xS():void 0},F)),v&&SS(l({},F)),kS(l(l({},F),{},{apply:e=>{let{elements:t,rects:n,availableWidth:o,availableHeight:r}=e;const{width:i,height:s}=n.reference,a=t.floating.style;a.setProperty("--radix-popper-available-width","".concat(o,"px")),a.setProperty("--radix-popper-available-height","".concat(r,"px")),a.setProperty("--radix-popper-anchor-width","".concat(i,"px")),a.setProperty("--radix-popper-anchor-height","".concat(s,"px"))}})),T&&CS({element:T,padding:y}),XS({arrowWidth:O,arrowHeight:D}),S&&PS(l({strategy:"referenceHidden"},F))]}),[W,q]=$S(H),Y=bw(P);qw((()=>{K&&(null===Y||void 0===Y||Y())}),[K,Y]);const G=null===(i=V.arrow)||void 0===i?void 0:i.x,X=null===(s=V.arrow)||void 0===s?void 0:s.y,$=0!==(null===(a=V.arrow)||void 0===a?void 0:a.centerOffset),[Z,Q]=e.useState();return qw((()=>{I&&Q(window.getComputedStyle(I).zIndex)}),[I]),(0,Ss.jsx)("div",{ref:B.setFloating,"data-radix-popper-content-wrapper":"",style:l(l({},U),{},{transform:K?U.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:Z,"--radix-popper-transform-origin":[null===(c=V.transformOrigin)||void 0===c?void 0:c.x,null===(d=V.transformOrigin)||void 0===d?void 0:d.y].join(" ")},(null===(u=V.hide)||void 0===u?void 0:u.referenceHidden)&&{visibility:"hidden",pointerEvents:"none"}),dir:t.dir,children:(0,Ss.jsx)(HS,{scope:h,placedSide:W,onArrowChange:M,arrowX:G,arrowY:X,shouldHideArrow:$,children:(0,Ss.jsx)(pw.div,l(l({"data-side":W,"data-align":q},C),{},{ref:j,style:l(l({},C.style),{},{animation:K?void 0:"none"})}))})})}));VS.displayName=US;var WS="PopperArrow",qS={top:"bottom",right:"left",bottom:"top",left:"right"},YS=e.forwardRef((function(e,t){const{__scopePopper:n}=e,o=yr(e,AS),r=KS(WS,n),i=qS[r.placedSide];return(0,Ss.jsx)("span",{ref:r.onArrowChange,style:{position:"absolute",left:r.arrowX,top:r.arrowY,[i]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[r.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[r.placedSide],visibility:r.shouldHideArrow?"hidden":void 0},children:(0,Ss.jsx)(ES,l(l({},o),{},{ref:t,style:l(l({},o.style),{},{display:"block"})}))})}));function GS(e){return null!==e}YS.displayName=WS;var XS=e=>({name:"transformOrigin",options:e,fn(t){var n,o,r,i,s;const{placement:a,rects:l,middlewareData:c}=t,d=0!==(null===(n=c.arrow)||void 0===n?void 0:n.centerOffset),u=d?0:e.arrowWidth,h=d?0:e.arrowHeight,[p,f]=$S(a),g={start:"0%",center:"50%",end:"100%"}[f],m=(null!==(o=null===(r=c.arrow)||void 0===r?void 0:r.x)&&void 0!==o?o:0)+u/2,y=(null!==(i=null===(s=c.arrow)||void 0===s?void 0:s.y)&&void 0!==i?i:0)+h/2;let v="",b="";return"bottom"===p?(v=d?g:"".concat(m,"px"),b="".concat(-h,"px")):"top"===p?(v=d?g:"".concat(m,"px"),b="".concat(l.floating.height+h,"px")):"right"===p?(v="".concat(-h,"px"),b=d?g:"".concat(y,"px")):"left"===p&&(v="".concat(l.floating.width+h,"px"),b=d?g:"".concat(y,"px")),{data:{x:v,y:b}}}});function $S(e){const[t,n="center"]=e.split("-");return[t,n]}var ZS=NS,QS=BS,JS=VS,ek=YS;const tk=["container"];var nk=e.forwardRef(((t,n)=>{var o;const{container:r}=t,i=yr(t,tk),[s,a]=e.useState(!1);qw((()=>a(!0)),[]);const c=r||s&&(null===globalThis||void 0===globalThis||null===(o=globalThis.document)||void 0===o?void 0:o.body);return c?Cu.createPortal((0,Ss.jsx)(pw.div,l(l({},i),{},{ref:n})),c):null}));nk.displayName="Portal";var ok=t=>{const{present:n,children:o}=t,r=function(t){const[n,o]=e.useState(),r=e.useRef({}),i=e.useRef(t),s=e.useRef("none"),a=t?"mounted":"unmounted",[l,c]=function(t,n){return e.useReducer(((e,t)=>{const o=n[e][t];return null!==o&&void 0!==o?o:e}),t)}(a,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return e.useEffect((()=>{const e=rk(r.current);s.current="mounted"===l?e:"none"}),[l]),qw((()=>{const e=r.current,n=i.current;if(n!==t){const o=s.current,r=rk(e);if(t)c("MOUNT");else if("none"===r||"none"===(null===e||void 0===e?void 0:e.display))c("UNMOUNT");else{c(n&&o!==r?"ANIMATION_OUT":"UNMOUNT")}i.current=t}}),[t,c]),qw((()=>{if(n){var e;let t;const o=null!==(e=n.ownerDocument.defaultView)&&void 0!==e?e:window,a=e=>{const s=rk(r.current).includes(e.animationName);if(e.target===n&&s&&(c("ANIMATION_END"),!i.current)){const e=n.style.animationFillMode;n.style.animationFillMode="forwards",t=o.setTimeout((()=>{"forwards"===n.style.animationFillMode&&(n.style.animationFillMode=e)}))}},l=e=>{e.target===n&&(s.current=rk(r.current))};return n.addEventListener("animationstart",l),n.addEventListener("animationcancel",a),n.addEventListener("animationend",a),()=>{o.clearTimeout(t),n.removeEventListener("animationstart",l),n.removeEventListener("animationcancel",a),n.removeEventListener("animationend",a)}}c("ANIMATION_END")}),[n,c]),{isPresent:["mounted","unmountSuspended"].includes(l),ref:e.useCallback((e=>{e&&(r.current=getComputedStyle(e)),o(e)}),[])}}(n),i="function"===typeof o?o({present:r.isPresent}):e.Children.only(o),s=iw(r.ref,function(e){var t,n;let o=null===(t=Object.getOwnPropertyDescriptor(e.props,"ref"))||void 0===t?void 0:t.get,r=o&&"isReactWarning"in o&&o.isReactWarning;if(r)return e.ref;if(o=null===(n=Object.getOwnPropertyDescriptor(e,"ref"))||void 0===n?void 0:n.get,r=o&&"isReactWarning"in o&&o.isReactWarning,r)return e.props.ref;return e.props.ref||e.ref}(i));return"function"===typeof o||r.isPresent?e.cloneElement(i,{ref:s}):null};function rk(e){return(null===e||void 0===e?void 0:e.animationName)||"none"}function ik(t){let{prop:n,defaultProp:o,onChange:r=()=>{}}=t;const[i,s]=function(t){let{defaultProp:n,onChange:o}=t;const r=e.useState(n),[i]=r,s=e.useRef(i),a=bw(o);return e.useEffect((()=>{s.current!==i&&(a(i),s.current=i)}),[i,s,a]),r}({defaultProp:o,onChange:r}),a=void 0!==n,l=a?n:i,c=bw(r);return[l,e.useCallback((e=>{if(a){const t="function"===typeof e?e(n):e;t!==n&&c(t)}else s(e)}),[a,n,s,c])]}ok.displayName="Presence";const sk=["__scopeRovingFocusGroup","orientation","loop","dir","currentTabStopId","defaultCurrentTabStopId","onCurrentTabStopIdChange","onEntryFocus","preventScrollOnEntryFocus"],ak=["__scopeRovingFocusGroup","focusable","active","tabStopId"];var lk="rovingFocusGroup.onEntryFocus",ck={bubbles:!1,cancelable:!0},dk="RovingFocusGroup",[uk,hk,pk]=mw(dk),[fk,gk]=tw(dk,[pk]),[mk,yk]=fk(dk),vk=e.forwardRef(((e,t)=>(0,Ss.jsx)(uk.Provider,{scope:e.__scopeRovingFocusGroup,children:(0,Ss.jsx)(uk.Slot,{scope:e.__scopeRovingFocusGroup,children:(0,Ss.jsx)(bk,l(l({},e),{},{ref:t}))})})));vk.displayName=dk;var bk=e.forwardRef(((t,n)=>{const{__scopeRovingFocusGroup:o,orientation:r,loop:i=!1,dir:s,currentTabStopId:a,defaultCurrentTabStopId:c,onCurrentTabStopIdChange:d,onEntryFocus:u,preventScrollOnEntryFocus:h=!1}=t,p=yr(t,sk),f=e.useRef(null),g=iw(n,f),m=vw(s),[y=null,v]=ik({prop:a,defaultProp:c,onChange:d}),[b,w]=e.useState(!1),x=bw(u),S=hk(o),k=e.useRef(!1),[P,C]=e.useState(0);return e.useEffect((()=>{const e=f.current;if(e)return e.addEventListener(lk,x),()=>e.removeEventListener(lk,x)}),[x]),(0,Ss.jsx)(mk,{scope:o,orientation:r,dir:m,loop:i,currentTabStopId:y,onItemFocus:e.useCallback((e=>v(e)),[v]),onItemShiftTab:e.useCallback((()=>w(!0)),[]),onFocusableItemAdd:e.useCallback((()=>C((e=>e+1))),[]),onFocusableItemRemove:e.useCallback((()=>C((e=>e-1))),[]),children:(0,Ss.jsx)(pw.div,l(l({tabIndex:b||0===P?-1:0,"data-orientation":r},p),{},{ref:g,style:l({outline:"none"},t.style),onMouseDown:Qb(t.onMouseDown,(()=>{k.current=!0})),onFocus:Qb(t.onFocus,(e=>{const t=!k.current;if(e.target===e.currentTarget&&t&&!b){const t=new CustomEvent(lk,ck);if(e.currentTarget.dispatchEvent(t),!t.defaultPrevented){const e=S().filter((e=>e.focusable));kk([e.find((e=>e.active)),e.find((e=>e.id===y)),...e].filter(Boolean).map((e=>e.ref.current)),h)}}k.current=!1})),onBlur:Qb(t.onBlur,(()=>w(!1)))}))})})),wk="RovingFocusGroupItem",xk=e.forwardRef(((t,n)=>{const{__scopeRovingFocusGroup:o,focusable:r=!0,active:i=!1,tabStopId:s}=t,a=yr(t,ak),c=Xw(),d=s||c,u=yk(wk,o),h=u.currentTabStopId===d,p=hk(o),{onFocusableItemAdd:f,onFocusableItemRemove:g}=u;return e.useEffect((()=>{if(r)return f(),()=>g()}),[r,f,g]),(0,Ss.jsx)(uk.ItemSlot,{scope:o,id:d,focusable:r,active:i,children:(0,Ss.jsx)(pw.span,l(l({tabIndex:h?0:-1,"data-orientation":u.orientation},a),{},{ref:n,onMouseDown:Qb(t.onMouseDown,(e=>{r?u.onItemFocus(d):e.preventDefault()})),onFocus:Qb(t.onFocus,(()=>u.onItemFocus(d))),onKeyDown:Qb(t.onKeyDown,(e=>{if("Tab"===e.key&&e.shiftKey)return void u.onItemShiftTab();if(e.target!==e.currentTarget)return;const t=function(e,t,n){const o=function(e,t){return"rtl"!==t?e:"ArrowLeft"===e?"ArrowRight":"ArrowRight"===e?"ArrowLeft":e}(e.key,n);return"vertical"===t&&["ArrowLeft","ArrowRight"].includes(o)||"horizontal"===t&&["ArrowUp","ArrowDown"].includes(o)?void 0:Sk[o]}(e,u.orientation,u.dir);if(void 0!==t){if(e.metaKey||e.ctrlKey||e.altKey||e.shiftKey)return;e.preventDefault();let n=p().filter((e=>e.focusable)).map((e=>e.ref.current));if("last"===t)n.reverse();else if("prev"===t||"next"===t){"prev"===t&&n.reverse();const o=n.indexOf(e.currentTarget);n=u.loop?function(e,t){return e.map(((n,o)=>e[(t+o)%e.length]))}(n,o+1):n.slice(o+1)}setTimeout((()=>kk(n)))}}))}))})}));xk.displayName=wk;var Sk={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function kk(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=document.activeElement;for(const o of e){if(o===n)return;if(o.focus({preventScroll:t}),document.activeElement!==n)return}}var Pk=vk,Ck=xk,_k=function(e){return"undefined"===typeof document?null:(Array.isArray(e)?e[0]:e).ownerDocument.body},Ik=new WeakMap,Ek=new WeakMap,jk={},Tk=0,Mk=function(e){return e&&(e.host||Mk(e.parentNode))},Ak=function(e,t,n,o){var r=function(e,t){return t.map((function(t){if(e.contains(t))return t;var n=Mk(t);return n&&e.contains(n)?n:(console.error("aria-hidden",t,"in not contained inside",e,". Doing nothing"),null)})).filter((function(e){return Boolean(e)}))}(t,Array.isArray(e)?e:[e]);jk[n]||(jk[n]=new WeakMap);var i=jk[n],s=[],a=new Set,l=new Set(r),c=function(e){e&&!a.has(e)&&(a.add(e),c(e.parentNode))};r.forEach(c);var d=function(e){e&&!l.has(e)&&Array.prototype.forEach.call(e.children,(function(e){if(a.has(e))d(e);else try{var t=e.getAttribute(o),r=null!==t&&"false"!==t,l=(Ik.get(e)||0)+1,c=(i.get(e)||0)+1;Ik.set(e,l),i.set(e,c),s.push(e),1===l&&r&&Ek.set(e,!0),1===c&&e.setAttribute(n,"true"),r||e.setAttribute(o,"true")}catch(u){console.error("aria-hidden: cannot operate on ",e,u)}}))};return d(t),a.clear(),Tk++,function(){s.forEach((function(e){var t=Ik.get(e)-1,r=i.get(e)-1;Ik.set(e,t),i.set(e,r),t||(Ek.has(e)||e.removeAttribute(o),Ek.delete(e)),r||e.removeAttribute(n)})),--Tk||(Ik=new WeakMap,Ik=new WeakMap,Ek=new WeakMap,jk={})}},Ok=function(e,t,n){void 0===n&&(n="data-aria-hidden");var o=Array.from(Array.isArray(e)?e:[e]),r=t||_k(e);return r?(o.push.apply(o,Array.from(r.querySelectorAll("[aria-live]"))),Ak(o,r,n,"aria-hidden")):function(){return null}};var Dk=function(){return Dk=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},Dk.apply(this,arguments)};function Rk(e,t){var n={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var r=0;for(o=Object.getOwnPropertySymbols(e);r<o.length;r++)t.indexOf(o[r])<0&&Object.prototype.propertyIsEnumerable.call(e,o[r])&&(n[o[r]]=e[o[r]])}return n}Object.create;function Lk(e,t,n){if(n||2===arguments.length)for(var o,r=0,i=t.length;r<i;r++)!o&&r in t||(o||(o=Array.prototype.slice.call(t,0,r)),o[r]=t[r]);return e.concat(o||Array.prototype.slice.call(t))}Object.create;"function"===typeof SuppressedError&&SuppressedError;var zk="right-scroll-bar-position",Nk="width-before-scroll-bar";function Fk(e,t){return"function"===typeof e?e(t):e&&(e.current=t),e}var Bk="undefined"!==typeof window?e.useLayoutEffect:e.useEffect,Uk=new WeakMap;function Hk(t,n){var o=function(t,n){var o=(0,e.useState)((function(){return{value:t,callback:n,facade:{get current(){return o.value},set current(e){var t=o.value;t!==e&&(o.value=e,o.callback(e,t))}}}}))[0];return o.callback=n,o.facade}(n||null,(function(e){return t.forEach((function(t){return Fk(t,e)}))}));return Bk((function(){var e=Uk.get(o);if(e){var n=new Set(e),r=new Set(t),i=o.current;n.forEach((function(e){r.has(e)||Fk(e,null)})),r.forEach((function(e){n.has(e)||Fk(e,i)}))}Uk.set(o,t)}),[t]),o}function Kk(e){return e}function Vk(e,t){void 0===t&&(t=Kk);var n=[],o=!1,r={read:function(){if(o)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return n.length?n[n.length-1]:e},useMedium:function(e){var r=t(e,o);return n.push(r),function(){n=n.filter((function(e){return e!==r}))}},assignSyncMedium:function(e){for(o=!0;n.length;){var t=n;n=[],t.forEach(e)}n={push:function(t){return e(t)},filter:function(){return n}}},assignMedium:function(e){o=!0;var t=[];if(n.length){var r=n;n=[],r.forEach(e),t=n}var i=function(){var n=t;t=[],n.forEach(e)},s=function(){return Promise.resolve().then(i)};s(),n={push:function(e){t.push(e),s()},filter:function(e){return t=t.filter(e),n}}}};return r}var Wk=function(e){void 0===e&&(e={});var t=Vk(null);return t.options=Dk({async:!0,ssr:!1},e),t}(),qk=function(){},Yk=e.forwardRef((function(t,n){var o=e.useRef(null),r=e.useState({onScrollCapture:qk,onWheelCapture:qk,onTouchMoveCapture:qk}),i=r[0],s=r[1],a=t.forwardProps,l=t.children,c=t.className,d=t.removeScrollBar,u=t.enabled,h=t.shards,p=t.sideCar,f=t.noIsolation,g=t.inert,m=t.allowPinchZoom,y=t.as,v=void 0===y?"div":y,b=t.gapMode,w=Rk(t,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as","gapMode"]),x=p,S=Hk([o,n]),k=Dk(Dk({},w),i);return e.createElement(e.Fragment,null,u&&e.createElement(x,{sideCar:Wk,removeScrollBar:d,shards:h,noIsolation:f,inert:g,setCallbacks:s,allowPinchZoom:!!m,lockRef:o,gapMode:b}),a?e.cloneElement(e.Children.only(l),Dk(Dk({},k),{ref:S})):e.createElement(v,Dk({},k,{className:c,ref:S}),l))}));Yk.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1},Yk.classNames={fullWidth:Nk,zeroRight:zk};var Gk,Xk=function(t){var n=t.sideCar,o=Rk(t,["sideCar"]);if(!n)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var r=n.read();if(!r)throw new Error("Sidecar medium not found");return e.createElement(r,Dk({},o))};Xk.isSideCarExport=!0;function $k(){if(!document)return null;var e=document.createElement("style");e.type="text/css";var t=Gk||n.nc;return t&&e.setAttribute("nonce",t),e}var Zk=function(){var e=0,t=null;return{add:function(n){var o,r;0==e&&(t=$k())&&(r=n,(o=t).styleSheet?o.styleSheet.cssText=r:o.appendChild(document.createTextNode(r)),function(e){(document.head||document.getElementsByTagName("head")[0]).appendChild(e)}(t)),e++},remove:function(){! --e&&t&&(t.parentNode&&t.parentNode.removeChild(t),t=null)}}},Qk=function(){var t=function(){var t=Zk();return function(n,o){e.useEffect((function(){return t.add(n),function(){t.remove()}}),[n&&o])}}();return function(e){var n=e.styles,o=e.dynamic;return t(n,o),null}},Jk={left:0,top:0,right:0,gap:0},eP=function(e){return parseInt(e||"",10)||0},tP=function(e){if(void 0===e&&(e="margin"),"undefined"===typeof window)return Jk;var t=function(e){var t=window.getComputedStyle(document.body),n=t["padding"===e?"paddingLeft":"marginLeft"],o=t["padding"===e?"paddingTop":"marginTop"],r=t["padding"===e?"paddingRight":"marginRight"];return[eP(n),eP(o),eP(r)]}(e),n=document.documentElement.clientWidth,o=window.innerWidth;return{left:t[0],top:t[1],right:t[2],gap:Math.max(0,o-n+t[2]-t[0])}},nP=Qk(),oP="data-scroll-locked",rP=function(e,t,n,o){var r=e.left,i=e.top,s=e.right,a=e.gap;return void 0===n&&(n="margin"),"\n  .".concat("with-scroll-bars-hidden"," {\n   overflow: hidden ").concat(o,";\n   padding-right: ").concat(a,"px ").concat(o,";\n  }\n  body[").concat(oP,"] {\n    overflow: hidden ").concat(o,";\n    overscroll-behavior: contain;\n    ").concat([t&&"position: relative ".concat(o,";"),"margin"===n&&"\n    padding-left: ".concat(r,"px;\n    padding-top: ").concat(i,"px;\n    padding-right: ").concat(s,"px;\n    margin-left:0;\n    margin-top:0;\n    margin-right: ").concat(a,"px ").concat(o,";\n    "),"padding"===n&&"padding-right: ".concat(a,"px ").concat(o,";")].filter(Boolean).join(""),"\n  }\n  \n  .").concat(zk," {\n    right: ").concat(a,"px ").concat(o,";\n  }\n  \n  .").concat(Nk," {\n    margin-right: ").concat(a,"px ").concat(o,";\n  }\n  \n  .").concat(zk," .").concat(zk," {\n    right: 0 ").concat(o,";\n  }\n  \n  .").concat(Nk," .").concat(Nk," {\n    margin-right: 0 ").concat(o,";\n  }\n  \n  body[").concat(oP,"] {\n    ").concat("--removed-body-scroll-bar-size",": ").concat(a,"px;\n  }\n")},iP=function(){var e=parseInt(document.body.getAttribute(oP)||"0",10);return isFinite(e)?e:0},sP=function(t){var n=t.noRelative,o=t.noImportant,r=t.gapMode,i=void 0===r?"margin":r;e.useEffect((function(){return document.body.setAttribute(oP,(iP()+1).toString()),function(){var e=iP()-1;e<=0?document.body.removeAttribute(oP):document.body.setAttribute(oP,e.toString())}}),[]);var s=e.useMemo((function(){return tP(i)}),[i]);return e.createElement(nP,{styles:rP(s,!n,i,o?"":"!important")})},aP=!1;if("undefined"!==typeof window)try{var lP=Object.defineProperty({},"passive",{get:function(){return aP=!0,!0}});window.addEventListener("test",lP,lP),window.removeEventListener("test",lP,lP)}catch(EW){aP=!1}var cP=!!aP&&{passive:!1},dP=function(e,t){if(!(e instanceof Element))return!1;var n=window.getComputedStyle(e);return"hidden"!==n[t]&&!(n.overflowY===n.overflowX&&!function(e){return"TEXTAREA"===e.tagName}(e)&&"visible"===n[t])},uP=function(e,t){var n=t.ownerDocument,o=t;do{if("undefined"!==typeof ShadowRoot&&o instanceof ShadowRoot&&(o=o.host),hP(e,o)){var r=pP(e,o);if(r[1]>r[2])return!0}o=o.parentNode}while(o&&o!==n.body);return!1},hP=function(e,t){return"v"===e?function(e){return dP(e,"overflowY")}(t):function(e){return dP(e,"overflowX")}(t)},pP=function(e,t){return"v"===e?function(e){return[e.scrollTop,e.scrollHeight,e.clientHeight]}(t):function(e){return[e.scrollLeft,e.scrollWidth,e.clientWidth]}(t)},fP=function(e){return"changedTouches"in e?[e.changedTouches[0].clientX,e.changedTouches[0].clientY]:[0,0]},gP=function(e){return[e.deltaX,e.deltaY]},mP=function(e){return e&&"current"in e?e.current:e},yP=function(e){return"\n  .block-interactivity-".concat(e," {pointer-events: none;}\n  .allow-interactivity-").concat(e," {pointer-events: all;}\n")},vP=0,bP=[];function wP(e){for(var t=null;null!==e;)e instanceof ShadowRoot&&(t=e.host,e=e.host),e=e.parentNode;return t}const xP=(SP=function(t){var n=e.useRef([]),o=e.useRef([0,0]),r=e.useRef(),i=e.useState(vP++)[0],s=e.useState(Qk)[0],a=e.useRef(t);e.useEffect((function(){a.current=t}),[t]),e.useEffect((function(){if(t.inert){document.body.classList.add("block-interactivity-".concat(i));var e=Lk([t.lockRef.current],(t.shards||[]).map(mP),!0).filter(Boolean);return e.forEach((function(e){return e.classList.add("allow-interactivity-".concat(i))})),function(){document.body.classList.remove("block-interactivity-".concat(i)),e.forEach((function(e){return e.classList.remove("allow-interactivity-".concat(i))}))}}}),[t.inert,t.lockRef.current,t.shards]);var l=e.useCallback((function(e,t){if("touches"in e&&2===e.touches.length||"wheel"===e.type&&e.ctrlKey)return!a.current.allowPinchZoom;var n,i=fP(e),s=o.current,l="deltaX"in e?e.deltaX:s[0]-i[0],c="deltaY"in e?e.deltaY:s[1]-i[1],d=e.target,u=Math.abs(l)>Math.abs(c)?"h":"v";if("touches"in e&&"h"===u&&"range"===d.type)return!1;var h=uP(u,d);if(!h)return!0;if(h?n=u:(n="v"===u?"h":"v",h=uP(u,d)),!h)return!1;if(!r.current&&"changedTouches"in e&&(l||c)&&(r.current=n),!n)return!0;var p=r.current||n;return function(e,t,n,o,r){var i=function(e,t){return"h"===e&&"rtl"===t?-1:1}(e,window.getComputedStyle(t).direction),s=i*o,a=n.target,l=t.contains(a),c=!1,d=s>0,u=0,h=0;do{var p=pP(e,a),f=p[0],g=p[1]-p[2]-i*f;(f||g)&&hP(e,a)&&(u+=g,h+=f),a=a instanceof ShadowRoot?a.host:a.parentNode}while(!l&&a!==document.body||l&&(t.contains(a)||t===a));return(d&&(r&&Math.abs(u)<1||!r&&s>u)||!d&&(r&&Math.abs(h)<1||!r&&-s>h))&&(c=!0),c}(p,t,e,"h"===p?l:c,!0)}),[]),c=e.useCallback((function(e){var t=e;if(bP.length&&bP[bP.length-1]===s){var o="deltaY"in t?gP(t):fP(t),r=n.current.filter((function(e){return e.name===t.type&&(e.target===t.target||t.target===e.shadowParent)&&(n=e.delta,r=o,n[0]===r[0]&&n[1]===r[1]);var n,r}))[0];if(r&&r.should)t.cancelable&&t.preventDefault();else if(!r){var i=(a.current.shards||[]).map(mP).filter(Boolean).filter((function(e){return e.contains(t.target)}));(i.length>0?l(t,i[0]):!a.current.noIsolation)&&t.cancelable&&t.preventDefault()}}}),[]),d=e.useCallback((function(e,t,o,r){var i={name:e,delta:t,target:o,should:r,shadowParent:wP(o)};n.current.push(i),setTimeout((function(){n.current=n.current.filter((function(e){return e!==i}))}),1)}),[]),u=e.useCallback((function(e){o.current=fP(e),r.current=void 0}),[]),h=e.useCallback((function(e){d(e.type,gP(e),e.target,l(e,t.lockRef.current))}),[]),p=e.useCallback((function(e){d(e.type,fP(e),e.target,l(e,t.lockRef.current))}),[]);e.useEffect((function(){return bP.push(s),t.setCallbacks({onScrollCapture:h,onWheelCapture:h,onTouchMoveCapture:p}),document.addEventListener("wheel",c,cP),document.addEventListener("touchmove",c,cP),document.addEventListener("touchstart",u,cP),function(){bP=bP.filter((function(e){return e!==s})),document.removeEventListener("wheel",c,cP),document.removeEventListener("touchmove",c,cP),document.removeEventListener("touchstart",u,cP)}}),[]);var f=t.removeScrollBar,g=t.inert;return e.createElement(e.Fragment,null,g?e.createElement(s,{styles:yP(i)}):null,f?e.createElement(sP,{gapMode:t.gapMode}):null)},Wk.useMedium(SP),Xk);var SP,kP=e.forwardRef((function(t,n){return e.createElement(Yk,Dk({},t,{ref:n,sideCar:xP}))}));kP.classNames=Yk.classNames;const PP=kP,CP=["__scopeMenu"],_P=["forceMount"],IP=["__scopeMenu","loop","trapFocus","onOpenAutoFocus","onCloseAutoFocus","disableOutsidePointerEvents","onEntryFocus","onEscapeKeyDown","onPointerDownOutside","onFocusOutside","onInteractOutside","onDismiss","disableOutsideScroll"],EP=["__scopeMenu"],jP=["__scopeMenu"],TP=["disabled","onSelect"],MP=["__scopeMenu","disabled","textValue"],AP=["checked","onCheckedChange"],OP=["value","onValueChange"],DP=["value"],RP=["__scopeMenu","forceMount"],LP=["__scopeMenu"],zP=["__scopeMenu"],NP=["forceMount"];var FP=["Enter"," "],BP=["ArrowUp","PageDown","End"],UP=["ArrowDown","PageUp","Home",...BP],HP={ltr:[...FP,"ArrowRight"],rtl:[...FP,"ArrowLeft"]},KP={ltr:["ArrowLeft"],rtl:["ArrowRight"]},VP="Menu",[WP,qP,YP]=mw(VP),[GP,XP]=tw(VP,[YP,RS,gk]),$P=RS(),ZP=gk(),[QP,JP]=GP(VP),[eC,tC]=GP(VP),nC=t=>{const{__scopeMenu:n,open:o=!1,children:r,dir:i,onOpenChange:s,modal:a=!0}=t,c=$P(n),[d,u]=e.useState(null),h=e.useRef(!1),p=bw(s),f=vw(i);return e.useEffect((()=>{const e=()=>{h.current=!0,document.addEventListener("pointerdown",t,{capture:!0,once:!0}),document.addEventListener("pointermove",t,{capture:!0,once:!0})},t=()=>h.current=!1;return document.addEventListener("keydown",e,{capture:!0}),()=>{document.removeEventListener("keydown",e,{capture:!0}),document.removeEventListener("pointerdown",t,{capture:!0}),document.removeEventListener("pointermove",t,{capture:!0})}}),[]),(0,Ss.jsx)(ZS,l(l({},c),{},{children:(0,Ss.jsx)(QP,{scope:n,open:o,onOpenChange:p,content:d,onContentChange:u,children:(0,Ss.jsx)(eC,{scope:n,onClose:e.useCallback((()=>p(!1)),[p]),isUsingKeyboardRef:h,dir:f,modal:a,children:r})})}))};nC.displayName=VP;var oC=e.forwardRef(((e,t)=>{const{__scopeMenu:n}=e,o=yr(e,CP),r=$P(n);return(0,Ss.jsx)(QS,l(l(l({},r),o),{},{ref:t}))}));oC.displayName="MenuAnchor";var rC="MenuPortal",[iC,sC]=GP(rC,{forceMount:void 0}),aC=e=>{const{__scopeMenu:t,forceMount:n,children:o,container:r}=e,i=JP(rC,t);return(0,Ss.jsx)(iC,{scope:t,forceMount:n,children:(0,Ss.jsx)(ok,{present:n||i.open,children:(0,Ss.jsx)(nk,{asChild:!0,container:r,children:o})})})};aC.displayName=rC;var lC="MenuContent",[cC,dC]=GP(lC),uC=e.forwardRef(((e,t)=>{const n=sC(lC,e.__scopeMenu),{forceMount:o=n.forceMount}=e,r=yr(e,_P),i=JP(lC,e.__scopeMenu),s=tC(lC,e.__scopeMenu);return(0,Ss.jsx)(WP.Provider,{scope:e.__scopeMenu,children:(0,Ss.jsx)(ok,{present:o||i.open,children:(0,Ss.jsx)(WP.Slot,{scope:e.__scopeMenu,children:s.modal?(0,Ss.jsx)(hC,l(l({},r),{},{ref:t})):(0,Ss.jsx)(pC,l(l({},r),{},{ref:t}))})})})})),hC=e.forwardRef(((t,n)=>{const o=JP(lC,t.__scopeMenu),r=e.useRef(null),i=iw(n,r);return e.useEffect((()=>{const e=r.current;if(e)return Ok(e)}),[]),(0,Ss.jsx)(fC,l(l({},t),{},{ref:i,trapFocus:o.open,disableOutsidePointerEvents:o.open,disableOutsideScroll:!0,onFocusOutside:Qb(t.onFocusOutside,(e=>e.preventDefault()),{checkForDefaultPrevented:!1}),onDismiss:()=>o.onOpenChange(!1)}))})),pC=e.forwardRef(((e,t)=>{const n=JP(lC,e.__scopeMenu);return(0,Ss.jsx)(fC,l(l({},e),{},{ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>n.onOpenChange(!1)}))})),fC=e.forwardRef(((t,n)=>{const{__scopeMenu:o,loop:r=!1,trapFocus:i,onOpenAutoFocus:s,onCloseAutoFocus:a,disableOutsidePointerEvents:c,onEntryFocus:d,onEscapeKeyDown:u,onPointerDownOutside:h,onFocusOutside:p,onInteractOutside:f,onDismiss:g,disableOutsideScroll:m}=t,y=yr(t,IP),v=JP(lC,o),b=tC(lC,o),w=$P(o),x=ZP(o),S=qP(o),[k,P]=e.useState(null),C=e.useRef(null),_=iw(n,C,v.onContentChange),I=e.useRef(0),E=e.useRef(""),j=e.useRef(0),T=e.useRef(null),M=e.useRef("right"),A=e.useRef(0),O=m?PP:e.Fragment,D=m?{as:lw,allowPinchZoom:!0}:void 0,R=e=>{var t,n;const o=E.current+e,r=S().filter((e=>!e.disabled)),i=document.activeElement,s=null===(t=r.find((e=>e.ref.current===i)))||void 0===t?void 0:t.textValue,a=function(e,t,n){const o=t.length>1&&Array.from(t).every((e=>e===t[0])),r=o?t[0]:t,i=n?e.indexOf(n):-1;let s=function(e,t){return e.map(((n,o)=>e[(t+o)%e.length]))}(e,Math.max(i,0));1===r.length&&(s=s.filter((e=>e!==n)));const a=s.find((e=>e.toLowerCase().startsWith(r.toLowerCase())));return a!==n?a:void 0}(r.map((e=>e.textValue)),o,s),l=null===(n=r.find((e=>e.textValue===a)))||void 0===n?void 0:n.ref.current;!function e(t){E.current=t,window.clearTimeout(I.current),""!==t&&(I.current=window.setTimeout((()=>e("")),1e3))}(o),l&&setTimeout((()=>l.focus()))};e.useEffect((()=>()=>window.clearTimeout(I.current)),[]),Ow();const L=e.useCallback((e=>{var t,n;return M.current===(null===(t=T.current)||void 0===t?void 0:t.side)&&function(e,t){if(!t)return!1;const n={x:e.clientX,y:e.clientY};return function(e,t){const{x:n,y:o}=e;let r=!1;for(let i=0,s=t.length-1;i<t.length;s=i++){const e=t[i].x,a=t[i].y,l=t[s].x,c=t[s].y;a>o!==c>o&&n<(l-e)*(o-a)/(c-a)+e&&(r=!r)}return r}(n,t)}(e,null===(n=T.current)||void 0===n?void 0:n.area)}),[]);return(0,Ss.jsx)(cC,{scope:o,searchRef:E,onItemEnter:e.useCallback((e=>{L(e)&&e.preventDefault()}),[L]),onItemLeave:e.useCallback((e=>{var t;L(e)||(null===(t=C.current)||void 0===t||t.focus(),P(null))}),[L]),onTriggerLeave:e.useCallback((e=>{L(e)&&e.preventDefault()}),[L]),pointerGraceTimerRef:j,onPointerGraceIntentChange:e.useCallback((e=>{T.current=e}),[]),children:(0,Ss.jsx)(O,l(l({},D),{},{children:(0,Ss.jsx)(Fw,{asChild:!0,trapped:i,onMountAutoFocus:Qb(s,(e=>{var t;e.preventDefault(),null===(t=C.current)||void 0===t||t.focus({preventScroll:!0})})),onUnmountAutoFocus:a,children:(0,Ss.jsx)(_w,{asChild:!0,disableOutsidePointerEvents:c,onEscapeKeyDown:u,onPointerDownOutside:h,onFocusOutside:p,onInteractOutside:f,onDismiss:g,children:(0,Ss.jsx)(Pk,l(l({asChild:!0},x),{},{dir:b.dir,orientation:"vertical",loop:r,currentTabStopId:k,onCurrentTabStopIdChange:P,onEntryFocus:Qb(d,(e=>{b.isUsingKeyboardRef.current||e.preventDefault()})),preventScrollOnEntryFocus:!0,children:(0,Ss.jsx)(JS,l(l(l({role:"menu","aria-orientation":"vertical","data-state":HC(v.open),"data-radix-menu-content":"",dir:b.dir},w),y),{},{ref:_,style:l({outline:"none"},y.style),onKeyDown:Qb(y.onKeyDown,(e=>{const t=e.target.closest("[data-radix-menu-content]")===e.currentTarget,n=e.ctrlKey||e.altKey||e.metaKey,o=1===e.key.length;t&&("Tab"===e.key&&e.preventDefault(),!n&&o&&R(e.key));const r=C.current;if(e.target!==r)return;if(!UP.includes(e.key))return;e.preventDefault();const i=S().filter((e=>!e.disabled)).map((e=>e.ref.current));BP.includes(e.key)&&i.reverse(),function(e){const t=document.activeElement;for(const n of e){if(n===t)return;if(n.focus(),document.activeElement!==t)return}}(i)})),onBlur:Qb(t.onBlur,(e=>{e.currentTarget.contains(e.target)||(window.clearTimeout(I.current),E.current="")})),onPointerMove:Qb(t.onPointerMove,WC((e=>{const t=e.target,n=A.current!==e.clientX;if(e.currentTarget.contains(t)&&n){const t=e.clientX>A.current?"right":"left";M.current=t,A.current=e.clientX}})))}))}))})})}))})}));uC.displayName=lC;var gC=e.forwardRef(((e,t)=>{const{__scopeMenu:n}=e,o=yr(e,EP);return(0,Ss.jsx)(pw.div,l(l({role:"group"},o),{},{ref:t}))}));gC.displayName="MenuGroup";var mC=e.forwardRef(((e,t)=>{const{__scopeMenu:n}=e,o=yr(e,jP);return(0,Ss.jsx)(pw.div,l(l({},o),{},{ref:t}))}));mC.displayName="MenuLabel";var yC="MenuItem",vC="menu.itemSelect",bC=e.forwardRef(((t,n)=>{const{disabled:o=!1,onSelect:r}=t,i=yr(t,TP),s=e.useRef(null),a=tC(yC,t.__scopeMenu),c=dC(yC,t.__scopeMenu),d=iw(n,s),u=e.useRef(!1);return(0,Ss.jsx)(wC,l(l({},i),{},{ref:d,disabled:o,onClick:Qb(t.onClick,(()=>{const e=s.current;if(!o&&e){const t=new CustomEvent(vC,{bubbles:!0,cancelable:!0});e.addEventListener(vC,(e=>null===r||void 0===r?void 0:r(e)),{once:!0}),fw(e,t),t.defaultPrevented?u.current=!1:a.onClose()}})),onPointerDown:e=>{var n;null===(n=t.onPointerDown)||void 0===n||n.call(t,e),u.current=!0},onPointerUp:Qb(t.onPointerUp,(e=>{var t;u.current||null===(t=e.currentTarget)||void 0===t||t.click()})),onKeyDown:Qb(t.onKeyDown,(e=>{const t=""!==c.searchRef.current;o||t&&" "===e.key||FP.includes(e.key)&&(e.currentTarget.click(),e.preventDefault())}))}))}));bC.displayName=yC;var wC=e.forwardRef(((t,n)=>{const{__scopeMenu:o,disabled:r=!1,textValue:i}=t,s=yr(t,MP),a=dC(yC,o),c=ZP(o),d=e.useRef(null),u=iw(n,d),[h,p]=e.useState(!1),[f,g]=e.useState("");return e.useEffect((()=>{const e=d.current;var t;e&&g((null!==(t=e.textContent)&&void 0!==t?t:"").trim())}),[s.children]),(0,Ss.jsx)(WP.ItemSlot,{scope:o,disabled:r,textValue:null!==i&&void 0!==i?i:f,children:(0,Ss.jsx)(Ck,l(l({asChild:!0},c),{},{focusable:!r,children:(0,Ss.jsx)(pw.div,l(l({role:"menuitem","data-highlighted":h?"":void 0,"aria-disabled":r||void 0,"data-disabled":r?"":void 0},s),{},{ref:u,onPointerMove:Qb(t.onPointerMove,WC((e=>{if(r)a.onItemLeave(e);else if(a.onItemEnter(e),!e.defaultPrevented){e.currentTarget.focus({preventScroll:!0})}}))),onPointerLeave:Qb(t.onPointerLeave,WC((e=>a.onItemLeave(e)))),onFocus:Qb(t.onFocus,(()=>p(!0))),onBlur:Qb(t.onBlur,(()=>p(!1)))}))}))})})),xC=e.forwardRef(((e,t)=>{const{checked:n=!1,onCheckedChange:o}=e,r=yr(e,AP);return(0,Ss.jsx)(jC,{scope:e.__scopeMenu,checked:n,children:(0,Ss.jsx)(bC,l(l({role:"menuitemcheckbox","aria-checked":KC(n)?"mixed":n},r),{},{ref:t,"data-state":VC(n),onSelect:Qb(r.onSelect,(()=>null===o||void 0===o?void 0:o(!!KC(n)||!n)),{checkForDefaultPrevented:!1})}))})}));xC.displayName="MenuCheckboxItem";var SC="MenuRadioGroup",[kC,PC]=GP(SC,{value:void 0,onValueChange:()=>{}}),CC=e.forwardRef(((e,t)=>{const{value:n,onValueChange:o}=e,r=yr(e,OP),i=bw(o);return(0,Ss.jsx)(kC,{scope:e.__scopeMenu,value:n,onValueChange:i,children:(0,Ss.jsx)(gC,l(l({},r),{},{ref:t}))})}));CC.displayName=SC;var _C="MenuRadioItem",IC=e.forwardRef(((e,t)=>{const{value:n}=e,o=yr(e,DP),r=PC(_C,e.__scopeMenu),i=n===r.value;return(0,Ss.jsx)(jC,{scope:e.__scopeMenu,checked:i,children:(0,Ss.jsx)(bC,l(l({role:"menuitemradio","aria-checked":i},o),{},{ref:t,"data-state":VC(i),onSelect:Qb(o.onSelect,(()=>{var e;return null===(e=r.onValueChange)||void 0===e?void 0:e.call(r,n)}),{checkForDefaultPrevented:!1})}))})}));IC.displayName=_C;var EC="MenuItemIndicator",[jC,TC]=GP(EC,{checked:!1}),MC=e.forwardRef(((e,t)=>{const{__scopeMenu:n,forceMount:o}=e,r=yr(e,RP),i=TC(EC,n);return(0,Ss.jsx)(ok,{present:o||KC(i.checked)||!0===i.checked,children:(0,Ss.jsx)(pw.span,l(l({},r),{},{ref:t,"data-state":VC(i.checked)}))})}));MC.displayName=EC;var AC=e.forwardRef(((e,t)=>{const{__scopeMenu:n}=e,o=yr(e,LP);return(0,Ss.jsx)(pw.div,l(l({role:"separator","aria-orientation":"horizontal"},o),{},{ref:t}))}));AC.displayName="MenuSeparator";var OC=e.forwardRef(((e,t)=>{const{__scopeMenu:n}=e,o=yr(e,zP),r=$P(n);return(0,Ss.jsx)(ek,l(l(l({},r),o),{},{ref:t}))}));OC.displayName="MenuArrow";var DC="MenuSub",[RC,LC]=GP(DC),zC=t=>{const{__scopeMenu:n,children:o,open:r=!1,onOpenChange:i}=t,s=JP(DC,n),a=$P(n),[c,d]=e.useState(null),[u,h]=e.useState(null),p=bw(i);return e.useEffect((()=>(!1===s.open&&p(!1),()=>p(!1))),[s.open,p]),(0,Ss.jsx)(ZS,l(l({},a),{},{children:(0,Ss.jsx)(QP,{scope:n,open:r,onOpenChange:p,content:u,onContentChange:h,children:(0,Ss.jsx)(RC,{scope:n,contentId:Xw(),triggerId:Xw(),trigger:c,onTriggerChange:d,children:o})})}))};zC.displayName=DC;var NC="MenuSubTrigger",FC=e.forwardRef(((t,n)=>{const o=JP(NC,t.__scopeMenu),r=tC(NC,t.__scopeMenu),i=LC(NC,t.__scopeMenu),s=dC(NC,t.__scopeMenu),a=e.useRef(null),{pointerGraceTimerRef:c,onPointerGraceIntentChange:d}=s,u={__scopeMenu:t.__scopeMenu},h=e.useCallback((()=>{a.current&&window.clearTimeout(a.current),a.current=null}),[]);return e.useEffect((()=>h),[h]),e.useEffect((()=>{const e=c.current;return()=>{window.clearTimeout(e),d(null)}}),[c,d]),(0,Ss.jsx)(oC,l(l({asChild:!0},u),{},{children:(0,Ss.jsx)(wC,l(l({id:i.triggerId,"aria-haspopup":"menu","aria-expanded":o.open,"aria-controls":i.contentId,"data-state":HC(o.open)},t),{},{ref:rw(n,i.onTriggerChange),onClick:e=>{var n;null===(n=t.onClick)||void 0===n||n.call(t,e),t.disabled||e.defaultPrevented||(e.currentTarget.focus(),o.open||o.onOpenChange(!0))},onPointerMove:Qb(t.onPointerMove,WC((e=>{s.onItemEnter(e),e.defaultPrevented||t.disabled||o.open||a.current||(s.onPointerGraceIntentChange(null),a.current=window.setTimeout((()=>{o.onOpenChange(!0),h()}),100))}))),onPointerLeave:Qb(t.onPointerLeave,WC((e=>{var t;h();const n=null===(t=o.content)||void 0===t?void 0:t.getBoundingClientRect();if(n){var r;const t=null===(r=o.content)||void 0===r?void 0:r.dataset.side,i="right"===t,a=i?-5:5,l=n[i?"left":"right"],d=n[i?"right":"left"];s.onPointerGraceIntentChange({area:[{x:e.clientX+a,y:e.clientY},{x:l,y:n.top},{x:d,y:n.top},{x:d,y:n.bottom},{x:l,y:n.bottom}],side:t}),window.clearTimeout(c.current),c.current=window.setTimeout((()=>s.onPointerGraceIntentChange(null)),300)}else{if(s.onTriggerLeave(e),e.defaultPrevented)return;s.onPointerGraceIntentChange(null)}}))),onKeyDown:Qb(t.onKeyDown,(e=>{const n=""!==s.searchRef.current;var i;t.disabled||n&&" "===e.key||HP[r.dir].includes(e.key)&&(o.onOpenChange(!0),null===(i=o.content)||void 0===i||i.focus(),e.preventDefault())}))}))}))}));FC.displayName=NC;var BC="MenuSubContent",UC=e.forwardRef(((t,n)=>{const o=sC(lC,t.__scopeMenu),{forceMount:r=o.forceMount}=t,i=yr(t,NP),s=JP(lC,t.__scopeMenu),a=tC(lC,t.__scopeMenu),c=LC(BC,t.__scopeMenu),d=e.useRef(null),u=iw(n,d);return(0,Ss.jsx)(WP.Provider,{scope:t.__scopeMenu,children:(0,Ss.jsx)(ok,{present:r||s.open,children:(0,Ss.jsx)(WP.Slot,{scope:t.__scopeMenu,children:(0,Ss.jsx)(fC,l(l({id:c.contentId,"aria-labelledby":c.triggerId},i),{},{ref:u,align:"start",side:"rtl"===a.dir?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:e=>{var t;a.isUsingKeyboardRef.current&&(null===(t=d.current)||void 0===t||t.focus()),e.preventDefault()},onCloseAutoFocus:e=>e.preventDefault(),onFocusOutside:Qb(t.onFocusOutside,(e=>{e.target!==c.trigger&&s.onOpenChange(!1)})),onEscapeKeyDown:Qb(t.onEscapeKeyDown,(e=>{a.onClose(),e.preventDefault()})),onKeyDown:Qb(t.onKeyDown,(e=>{const t=e.currentTarget.contains(e.target),n=KP[a.dir].includes(e.key);var o;t&&n&&(s.onOpenChange(!1),null===(o=c.trigger)||void 0===o||o.focus(),e.preventDefault())}))}))})})})}));function HC(e){return e?"open":"closed"}function KC(e){return"indeterminate"===e}function VC(e){return KC(e)?"indeterminate":e?"checked":"unchecked"}function WC(e){return t=>"mouse"===t.pointerType?e(t):void 0}UC.displayName=BC;var qC=nC,YC=oC,GC=aC,XC=uC,$C=gC,ZC=mC,QC=bC,JC=xC,e_=CC,t_=IC,n_=MC,o_=AC,r_=OC,i_=zC,s_=FC,a_=UC;const l_=["__scopeContextMenu","disabled"],c_=["__scopeContextMenu"],d_=["__scopeContextMenu"],u_=["__scopeContextMenu"],h_=["__scopeContextMenu"],p_=["__scopeContextMenu"],f_=["__scopeContextMenu"],g_=["__scopeContextMenu"],m_=["__scopeContextMenu"],y_=["__scopeContextMenu"],v_=["__scopeContextMenu"],b_=["__scopeContextMenu"],w_=["__scopeContextMenu"],x_=["__scopeContextMenu"];var S_="ContextMenu",[k_,P_]=tw(S_,[XP]),C_=XP(),[__,I_]=k_(S_),E_=t=>{const{__scopeContextMenu:n,children:o,onOpenChange:r,dir:i,modal:s=!0}=t,[a,c]=e.useState(!1),d=C_(n),u=bw(r),h=e.useCallback((e=>{c(e),u(e)}),[u]);return(0,Ss.jsx)(__,{scope:n,open:a,onOpenChange:h,modal:s,children:(0,Ss.jsx)(qC,l(l({},d),{},{dir:i,open:a,onOpenChange:h,modal:s,children:o}))})};E_.displayName=S_;var j_="ContextMenuTrigger",T_=e.forwardRef(((t,n)=>{const{__scopeContextMenu:o,disabled:r=!1}=t,i=yr(t,l_),s=I_(j_,o),a=C_(o),c=e.useRef({x:0,y:0}),d=e.useRef({getBoundingClientRect:()=>DOMRect.fromRect(l({width:0,height:0},c.current))}),u=e.useRef(0),h=e.useCallback((()=>window.clearTimeout(u.current)),[]),p=e=>{c.current={x:e.clientX,y:e.clientY},s.onOpenChange(!0)};return e.useEffect((()=>h),[h]),e.useEffect((()=>{r&&h()}),[r,h]),(0,Ss.jsxs)(Ss.Fragment,{children:[(0,Ss.jsx)(YC,l(l({},a),{},{virtualRef:d})),(0,Ss.jsx)(pw.span,l(l({"data-state":s.open?"open":"closed","data-disabled":r?"":void 0},i),{},{ref:n,style:l({WebkitTouchCallout:"none"},t.style),onContextMenu:r?t.onContextMenu:Qb(t.onContextMenu,(e=>{h(),p(e),e.preventDefault()})),onPointerDown:r?t.onPointerDown:Qb(t.onPointerDown,q_((e=>{h(),u.current=window.setTimeout((()=>p(e)),700)}))),onPointerMove:r?t.onPointerMove:Qb(t.onPointerMove,q_(h)),onPointerCancel:r?t.onPointerCancel:Qb(t.onPointerCancel,q_(h)),onPointerUp:r?t.onPointerUp:Qb(t.onPointerUp,q_(h))}))]})}));T_.displayName=j_;var M_=e=>{const{__scopeContextMenu:t}=e,n=yr(e,c_),o=C_(t);return(0,Ss.jsx)(GC,l(l({},o),n))};M_.displayName="ContextMenuPortal";var A_="ContextMenuContent",O_=e.forwardRef(((t,n)=>{const{__scopeContextMenu:o}=t,r=yr(t,d_),i=I_(A_,o),s=C_(o),a=e.useRef(!1);return(0,Ss.jsx)(XC,l(l(l({},s),r),{},{ref:n,side:"right",sideOffset:2,align:"start",onCloseAutoFocus:e=>{var n;null===(n=t.onCloseAutoFocus)||void 0===n||n.call(t,e),!e.defaultPrevented&&a.current&&e.preventDefault(),a.current=!1},onInteractOutside:e=>{var n;null===(n=t.onInteractOutside)||void 0===n||n.call(t,e),e.defaultPrevented||i.modal||(a.current=!0)},style:l(l({},t.style),{"--radix-context-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-context-menu-content-available-width":"var(--radix-popper-available-width)","--radix-context-menu-content-available-height":"var(--radix-popper-available-height)","--radix-context-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-context-menu-trigger-height":"var(--radix-popper-anchor-height)"})}))}));O_.displayName=A_;var D_=e.forwardRef(((e,t)=>{const{__scopeContextMenu:n}=e,o=yr(e,u_),r=C_(n);return(0,Ss.jsx)($C,l(l(l({},r),o),{},{ref:t}))}));D_.displayName="ContextMenuGroup";var R_=e.forwardRef(((e,t)=>{const{__scopeContextMenu:n}=e,o=yr(e,h_),r=C_(n);return(0,Ss.jsx)(ZC,l(l(l({},r),o),{},{ref:t}))}));R_.displayName="ContextMenuLabel";var L_=e.forwardRef(((e,t)=>{const{__scopeContextMenu:n}=e,o=yr(e,p_),r=C_(n);return(0,Ss.jsx)(QC,l(l(l({},r),o),{},{ref:t}))}));L_.displayName="ContextMenuItem";var z_=e.forwardRef(((e,t)=>{const{__scopeContextMenu:n}=e,o=yr(e,f_),r=C_(n);return(0,Ss.jsx)(JC,l(l(l({},r),o),{},{ref:t}))}));z_.displayName="ContextMenuCheckboxItem";var N_=e.forwardRef(((e,t)=>{const{__scopeContextMenu:n}=e,o=yr(e,g_),r=C_(n);return(0,Ss.jsx)(e_,l(l(l({},r),o),{},{ref:t}))}));N_.displayName="ContextMenuRadioGroup";var F_=e.forwardRef(((e,t)=>{const{__scopeContextMenu:n}=e,o=yr(e,m_),r=C_(n);return(0,Ss.jsx)(t_,l(l(l({},r),o),{},{ref:t}))}));F_.displayName="ContextMenuRadioItem";var B_=e.forwardRef(((e,t)=>{const{__scopeContextMenu:n}=e,o=yr(e,y_),r=C_(n);return(0,Ss.jsx)(n_,l(l(l({},r),o),{},{ref:t}))}));B_.displayName="ContextMenuItemIndicator";var U_=e.forwardRef(((e,t)=>{const{__scopeContextMenu:n}=e,o=yr(e,v_),r=C_(n);return(0,Ss.jsx)(o_,l(l(l({},r),o),{},{ref:t}))}));U_.displayName="ContextMenuSeparator";var H_=e.forwardRef(((e,t)=>{const{__scopeContextMenu:n}=e,o=yr(e,b_),r=C_(n);return(0,Ss.jsx)(r_,l(l(l({},r),o),{},{ref:t}))}));H_.displayName="ContextMenuArrow";var K_=e=>{const{__scopeContextMenu:t,children:n,onOpenChange:o,open:r,defaultOpen:i}=e,s=C_(t),[a,c]=ik({prop:r,defaultProp:i,onChange:o});return(0,Ss.jsx)(i_,l(l({},s),{},{open:a,onOpenChange:c,children:n}))};K_.displayName="ContextMenuSub";var V_=e.forwardRef(((e,t)=>{const{__scopeContextMenu:n}=e,o=yr(e,w_),r=C_(n);return(0,Ss.jsx)(s_,l(l(l({},r),o),{},{ref:t}))}));V_.displayName="ContextMenuSubTrigger";var W_=e.forwardRef(((e,t)=>{const{__scopeContextMenu:n}=e,o=yr(e,x_),r=C_(n);return(0,Ss.jsx)(a_,l(l(l({},r),o),{},{ref:t,style:l(l({},e.style),{"--radix-context-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-context-menu-content-available-width":"var(--radix-popper-available-width)","--radix-context-menu-content-available-height":"var(--radix-popper-available-height)","--radix-context-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-context-menu-trigger-height":"var(--radix-popper-anchor-height)"})}))}));function q_(e){return t=>"mouse"!==t.pointerType?e(t):void 0}W_.displayName="ContextMenuSubContent";var Y_=E_,G_=T_,X_=M_,$_=O_,Z_=z_;const Q_=["__scopeDropdownMenu","disabled"],J_=["__scopeDropdownMenu"],eI=["__scopeDropdownMenu"],tI=["__scopeDropdownMenu"],nI=["__scopeDropdownMenu"],oI=["__scopeDropdownMenu"],rI=["__scopeDropdownMenu"],iI=["__scopeDropdownMenu"],sI=["__scopeDropdownMenu"],aI=["__scopeDropdownMenu"],lI=["__scopeDropdownMenu"],cI=["__scopeDropdownMenu"],dI=["__scopeDropdownMenu"],uI=["__scopeDropdownMenu"];var hI="DropdownMenu",[pI,fI]=tw(hI,[XP]),gI=XP(),[mI,yI]=pI(hI),vI=t=>{const{__scopeDropdownMenu:n,children:o,dir:r,open:i,defaultOpen:s,onOpenChange:a,modal:c=!0}=t,d=gI(n),u=e.useRef(null),[h=!1,p]=ik({prop:i,defaultProp:s,onChange:a});return(0,Ss.jsx)(mI,{scope:n,triggerId:Xw(),triggerRef:u,contentId:Xw(),open:h,onOpenChange:p,onOpenToggle:e.useCallback((()=>p((e=>!e))),[p]),modal:c,children:(0,Ss.jsx)(qC,l(l({},d),{},{open:h,onOpenChange:p,dir:r,modal:c,children:o}))})};vI.displayName=hI;var bI="DropdownMenuTrigger",wI=e.forwardRef(((e,t)=>{const{__scopeDropdownMenu:n,disabled:o=!1}=e,r=yr(e,Q_),i=yI(bI,n),s=gI(n);return(0,Ss.jsx)(YC,l(l({asChild:!0},s),{},{children:(0,Ss.jsx)(pw.button,l(l({type:"button",id:i.triggerId,"aria-haspopup":"menu","aria-expanded":i.open,"aria-controls":i.open?i.contentId:void 0,"data-state":i.open?"open":"closed","data-disabled":o?"":void 0,disabled:o},r),{},{ref:rw(t,i.triggerRef),onPointerDown:Qb(e.onPointerDown,(e=>{o||0!==e.button||!1!==e.ctrlKey||(i.onOpenToggle(),i.open||e.preventDefault())})),onKeyDown:Qb(e.onKeyDown,(e=>{o||(["Enter"," "].includes(e.key)&&i.onOpenToggle(),"ArrowDown"===e.key&&i.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(e.key)&&e.preventDefault())}))}))}))}));wI.displayName=bI;var xI=e=>{const{__scopeDropdownMenu:t}=e,n=yr(e,J_),o=gI(t);return(0,Ss.jsx)(GC,l(l({},o),n))};xI.displayName="DropdownMenuPortal";var SI="DropdownMenuContent",kI=e.forwardRef(((t,n)=>{const{__scopeDropdownMenu:o}=t,r=yr(t,eI),i=yI(SI,o),s=gI(o),a=e.useRef(!1);return(0,Ss.jsx)(XC,l(l(l({id:i.contentId,"aria-labelledby":i.triggerId},s),r),{},{ref:n,onCloseAutoFocus:Qb(t.onCloseAutoFocus,(e=>{var t;a.current||null===(t=i.triggerRef.current)||void 0===t||t.focus(),a.current=!1,e.preventDefault()})),onInteractOutside:Qb(t.onInteractOutside,(e=>{const t=e.detail.originalEvent,n=0===t.button&&!0===t.ctrlKey,o=2===t.button||n;i.modal&&!o||(a.current=!0)})),style:l(l({},t.style),{"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"})}))}));kI.displayName=SI;var PI=e.forwardRef(((e,t)=>{const{__scopeDropdownMenu:n}=e,o=yr(e,tI),r=gI(n);return(0,Ss.jsx)($C,l(l(l({},r),o),{},{ref:t}))}));PI.displayName="DropdownMenuGroup";var CI=e.forwardRef(((e,t)=>{const{__scopeDropdownMenu:n}=e,o=yr(e,nI),r=gI(n);return(0,Ss.jsx)(ZC,l(l(l({},r),o),{},{ref:t}))}));CI.displayName="DropdownMenuLabel";var _I=e.forwardRef(((e,t)=>{const{__scopeDropdownMenu:n}=e,o=yr(e,oI),r=gI(n);return(0,Ss.jsx)(QC,l(l(l({},r),o),{},{ref:t}))}));_I.displayName="DropdownMenuItem";var II=e.forwardRef(((e,t)=>{const{__scopeDropdownMenu:n}=e,o=yr(e,rI),r=gI(n);return(0,Ss.jsx)(JC,l(l(l({},r),o),{},{ref:t}))}));II.displayName="DropdownMenuCheckboxItem";var EI=e.forwardRef(((e,t)=>{const{__scopeDropdownMenu:n}=e,o=yr(e,iI),r=gI(n);return(0,Ss.jsx)(e_,l(l(l({},r),o),{},{ref:t}))}));EI.displayName="DropdownMenuRadioGroup";var jI=e.forwardRef(((e,t)=>{const{__scopeDropdownMenu:n}=e,o=yr(e,sI),r=gI(n);return(0,Ss.jsx)(t_,l(l(l({},r),o),{},{ref:t}))}));jI.displayName="DropdownMenuRadioItem";var TI=e.forwardRef(((e,t)=>{const{__scopeDropdownMenu:n}=e,o=yr(e,aI),r=gI(n);return(0,Ss.jsx)(n_,l(l(l({},r),o),{},{ref:t}))}));TI.displayName="DropdownMenuItemIndicator";var MI=e.forwardRef(((e,t)=>{const{__scopeDropdownMenu:n}=e,o=yr(e,lI),r=gI(n);return(0,Ss.jsx)(o_,l(l(l({},r),o),{},{ref:t}))}));MI.displayName="DropdownMenuSeparator";var AI=e.forwardRef(((e,t)=>{const{__scopeDropdownMenu:n}=e,o=yr(e,cI),r=gI(n);return(0,Ss.jsx)(r_,l(l(l({},r),o),{},{ref:t}))}));AI.displayName="DropdownMenuArrow";var OI=e.forwardRef(((e,t)=>{const{__scopeDropdownMenu:n}=e,o=yr(e,dI),r=gI(n);return(0,Ss.jsx)(s_,l(l(l({},r),o),{},{ref:t}))}));OI.displayName="DropdownMenuSubTrigger";var DI=e.forwardRef(((e,t)=>{const{__scopeDropdownMenu:n}=e,o=yr(e,uI),r=gI(n);return(0,Ss.jsx)(a_,l(l(l({},r),o),{},{ref:t,style:l(l({},e.style),{"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"})}))}));DI.displayName="DropdownMenuSubContent";var RI=vI,LI=wI,zI=xI,NI=kI,FI=PI,BI=_I,UI=II,HI=e=>{const{__scopeDropdownMenu:t,children:n,open:o,onOpenChange:r,defaultOpen:i}=e,s=gI(t),[a=!1,c]=ik({prop:o,defaultProp:i,onChange:r});return(0,Ss.jsx)(i_,l(l({},s),{},{open:a,onOpenChange:c,children:n}))},KI=OI,VI=DI;function WI(e,t){const n=new Set;for(const i of t){const t=e.getShape(i);if(!t)continue;e.getShapeUtil(t).onDragShapesOut&&n.add(t);const o=e.getShape(t.parentId);o&&(e.getShapeUtil(o).onDragShapesOut&&n.add(o))}const o=new Map;for(const i of n){const t=qI(e,i);t.length&&o.set(i,t)}for(const[i,s]of o){var r;const t=e.getShapeUtil(i),n=C(s.map((t=>e.getShape(t))));null===(r=t.onDragShapesOut)||void 0===r||r.call(t,i,n)}}function qI(e,t){const n=e.getSortedChildIdsForParent(t.id);if(0===n.length)return[];const o=e.getShapePageBounds(t);if(!o)return[];let r,i,s;const a=[];for(const u of n){var l,c,d;const n=e.getShapePageBounds(u);if(!n)continue;if(!o.includes(n)){a.push(u);continue}null!==(l=r)&&void 0!==l||(r=e.getShapeGeometry(t)),null!==(c=i)&&void 0!==c||(i=e.getShapePageTransform(t)),null!==(d=s)&&void 0!==d||(s=i.applyToPoints(r.vertices));const h=e.getShapePageTransform(u).clone().invert().applyToPoints(s),{vertices:p,isClosed:f}=e.getShapeGeometry(u);if(!p.some((e=>fa(e,h)))){if(f){if(hu(h,p))continue}else if(pu(h,p))continue;a.push(u)}}return a}function YI(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];e.select(t),e.setEditingShape(t),e.setCurrentTool("select.editing_shape",{target:"shape",shape:t}),n&&e.emit("select-all-text",{shapeId:t.id})}const GI=50;const XI=(0,e.createContext)(null);function $I(t){let{assetUrls:n,children:o}=t;return(0,e.useEffect)((()=>{for(const e of Object.values(n.icons)){const t=U();t.src=e,t.decode()}for(const e of Object.values(n.embedIcons)){const t=U();t.src=e,t.decode()}}),[n]),(0,Ss.jsx)(XI.Provider,{value:n,children:o})}function ZI(){const t=(0,e.useContext)(XI);if(!t)throw new Error("useAssetUrls must be used within an AssetUrlsProvider");return t}const QI={"action.convert-to-bookmark":"Convert to Bookmark","action.convert-to-embed":"Convert to Embed","action.open-embed-link":"Open link","action.align-bottom":"Align bottom","action.align-center-horizontal":"Align horizontally","action.align-center-vertical":"Align vertically","action.align-center-horizontal.short":"Align H","action.align-center-vertical.short":"Align V","action.align-left":"Align left","action.align-right":"Align right","action.align-top":"Align top","action.back-to-content":"Back to content","action.bring-forward":"Bring forward","action.bring-to-front":"Bring to front","action.copy-as-json.short":"JSON","action.copy-as-json":"Copy as JSON","action.copy-as-png.short":"PNG","action.copy-as-png":"Copy as PNG","action.copy-as-svg.short":"SVG","action.copy-as-svg":"Copy as SVG","action.copy":"Copy","action.cut":"Cut","action.delete":"Delete","action.unlock-all":"Unlock all","action.distribute-horizontal":"Distribute horizontally","action.distribute-vertical":"Distribute vertically","action.distribute-horizontal.short":"Distribute H","action.distribute-vertical.short":"Distribute V","action.duplicate":"Duplicate","action.edit-link":"Edit link","action.exit-pen-mode":"Exit pen mode","action.export-as-json.short":"JSON","action.export-as-json":"Export as JSON","action.export-as-png.short":"PNG","action.export-as-png":"Export as PNG","action.export-as-svg.short":"SVG","action.export-as-svg":"Export as SVG","action.export-all-as-json.short":"JSON","action.export-all-as-json":"Export as JSON","action.export-all-as-png.short":"PNG","action.export-all-as-png":"Export as PNG","action.export-all-as-svg.short":"SVG","action.export-all-as-svg":"Export as SVG","action.fit-frame-to-content":"Fit to content","action.flip-horizontal":"Flip horizontally","action.flip-vertical":"Flip vertically","action.flip-horizontal.short":"Flip H","action.flip-vertical.short":"Flip V","action.fork-project":"Fork this project","action.fork-project-on-tldraw":"Fork project on tldraw","action.group":"Group","action.insert-embed":"Insert embed","action.insert-media":"Upload media","action.leave-shared-project":"Leave shared project","action.new-project":"New project","action.new-shared-project":"New shared project","action.open-cursor-chat":"Cursor chat","action.open-file":"Open file","action.pack":"Pack","action.paste":"Paste","action.paste-error-title":"Pasting failed","action.paste-error-description":"Could not paste due to missing clipboard permissions. Please enable the permissions and try again.","action.print":"Print","action.redo":"Redo","action.remove-frame":"Remove frame","action.rename":"Rename","action.rotate-ccw":"Rotate counterclockwise","action.rotate-cw":"Rotate clockwise","action.save-copy":"Save a copy","action.select-all":"Select all","action.select-none":"Select none","action.send-backward":"Send backward","action.send-to-back":"Send to back","action.share-project":"Share this project","action.stack-horizontal":"Stack horizontally","action.stack-vertical":"Stack vertically","action.stack-horizontal.short":"Stack H","action.stack-vertical.short":"Stack V","action.stop-following":"Stop following","action.stretch-horizontal":"Stretch horizontally","action.stretch-vertical":"Stretch vertically","action.stretch-horizontal.short":"Stretch H","action.stretch-vertical.short":"Stretch V","action.toggle-auto-size":"Toggle auto size","action.toggle-dark-mode.menu":"Dark mode","action.toggle-dark-mode":"Toggle dark mode","action.toggle-paste-at-cursor.menu":"Paste at cursor","action.toggle-paste-at-cursor":"Toggle paste at cursor","action.toggle-wrap-mode.menu":"Select on wrap","action.toggle-wrap-mode":"Toggle Select on wrap","action.toggle-reduce-motion.menu":"Reduce motion","action.toggle-reduce-motion":"Toggle reduce motion","action.toggle-edge-scrolling.menu":"Edge scrolling","action.toggle-edge-scrolling":"Toggle edge scrolling","action.toggle-debug-mode.menu":"Debug mode","action.toggle-debug-mode":"Toggle debug mode","action.toggle-focus-mode.menu":"Focus mode","action.toggle-focus-mode":"Toggle focus mode","action.toggle-dynamic-size-mode.menu":"Dynamic size","action.toggle-dynamic-size-mode":"Toggle dynamic size","action.toggle-grid.menu":"Show grid","action.toggle-grid":"Toggle grid","action.toggle-lock":"Toggle locked","action.flatten-to-image":"Flatten","action.toggle-snap-mode.menu":"Always snap","action.toggle-snap-mode":"Toggle always snap","action.toggle-tool-lock.menu":"Tool lock","action.toggle-tool-lock":"Toggle tool lock","action.toggle-transparent.context-menu":"Transparent","action.toggle-transparent.menu":"Transparent","action.toggle-transparent":"Toggle transparent background","action.undo":"Undo","action.ungroup":"Ungroup","action.zoom-in":"Zoom in","action.zoom-out":"Zoom out","action.zoom-to-100":"Zoom to 100%","action.zoom-to-fit":"Zoom to fit","action.zoom-to-selection":"Zoom to selection","assets.files.size-too-big":"File size is too big","assets.files.type-not-allowed":"File type is not allowed","assets.files.upload-failed":"Upload failed","assets.url.failed":"Couldn't load URL preview","theme.dark":"Dark","theme.light":"Light","theme.system":"System","color-style.white":"White","color-style.black":"Black","color-style.blue":"Blue","color-style.green":"Green","color-style.grey":"Grey","color-style.light-blue":"Light blue","color-style.light-green":"Light green","color-style.light-red":"Light red","color-style.light-violet":"Light violet","color-style.orange":"Orange","color-style.red":"Red","color-style.violet":"Violet","color-style.yellow":"Yellow","fill-style.none":"None","document.default-name":"Untitled","fill-style.semi":"Semi","fill-style.solid":"Solid","fill-style.pattern":"Pattern","fill-style.fill":"Fill","dash-style.dashed":"Dashed","dash-style.dotted":"Dotted","dash-style.draw":"Draw","dash-style.solid":"Solid","size-style.s":"Small","size-style.m":"Medium","size-style.l":"Large","size-style.xl":"Extra large","opacity-style.0.1":"10%","opacity-style.0.25":"25%","opacity-style.0.5":"50%","opacity-style.0.75":"75%","opacity-style.1":"100%","font-style.draw":"Draw","font-style.sans":"Sans","font-style.serif":"Serif","font-style.mono":"Mono","align-style.start":"Start","align-style.middle":"Middle","align-style.end":"End","align-style.justify":"Justify","verticalAlign-style.start":"Top","verticalAlign-style.middle":"Middle","verticalAlign-style.end":"Bottom","geo-style.arrow-down":"Arrow down","geo-style.arrow-left":"Arrow left","geo-style.arrow-right":"Arrow right","geo-style.arrow-up":"Arrow up","geo-style.diamond":"Diamond","geo-style.ellipse":"Ellipse","geo-style.hexagon":"Hexagon","geo-style.octagon":"Octagon","geo-style.oval":"Oval","geo-style.cloud":"Cloud","geo-style.pentagon":"Pentagon","geo-style.rectangle":"Rectangle","geo-style.rhombus-2":"Rhombus 2","geo-style.rhombus":"Rhombus","geo-style.star":"Star","geo-style.trapezoid":"Trapezoid","geo-style.triangle":"Triangle","geo-style.x-box":"X box","geo-style.check-box":"Check box","arrowheadStart-style.none":"None","arrowheadStart-style.arrow":"Arrow","arrowheadStart-style.bar":"Bar","arrowheadStart-style.diamond":"Diamond","arrowheadStart-style.dot":"Dot","arrowheadStart-style.inverted":"Inverted","arrowheadStart-style.pipe":"Pipe","arrowheadStart-style.square":"Square","arrowheadStart-style.triangle":"Triangle","arrowheadEnd-style.none":"None","arrowheadEnd-style.arrow":"Arrow","arrowheadEnd-style.bar":"Bar","arrowheadEnd-style.diamond":"Diamond","arrowheadEnd-style.dot":"Dot","arrowheadEnd-style.inverted":"Inverted","arrowheadEnd-style.pipe":"Pipe","arrowheadEnd-style.square":"Square","arrowheadEnd-style.triangle":"Triangle","spline-style.line":"Line","spline-style.cubic":"Cubic","tool.select":"Select","tool.hand":"Hand","tool.draw":"Draw","tool.eraser":"Eraser","tool.arrow-down":"Arrow down","tool.arrow-left":"Arrow left","tool.arrow-right":"Arrow right","tool.arrow-up":"Arrow up","tool.arrow":"Arrow","tool.cloud":"Cloud","tool.diamond":"Diamond","tool.ellipse":"Ellipse","tool.hexagon":"Hexagon","tool.highlight":"Highlight","tool.line":"Line","tool.octagon":"Octagon","tool.oval":"Oval","tool.pentagon":"Pentagon","tool.rectangle":"Rectangle","tool.rhombus":"Rhombus","tool.star":"Star","tool.trapezoid":"Trapezoid","tool.triangle":"Triangle","tool.x-box":"X box","tool.check-box":"Check box","tool.asset":"Asset","tool.frame":"Frame","tool.note":"Note","tool.laser":"Laser","tool.embed":"Embed","tool.text":"Text","tool.pointer-down":"Pointer down","menu.title":"Menu","menu.theme":"Theme","menu.copy-as":"Copy as","menu.edit":"Edit","menu.export-as":"Export as","menu.file":"File","menu.language":"Language","menu.preferences":"Preferences","menu.help":"Help","menu.view":"View","context-menu.edit":"Edit","context-menu.arrange":"Arrange","context-menu.copy-as":"Copy as","context-menu.export-as":"Export as","context-menu.export-all-as":"Export","context-menu.move-to-page":"Move to page","context-menu.reorder":"Reorder","page-menu.title":"Pages","page-menu.create-new-page":"Create new page","page-menu.max-page-count-reached":"Max pages reached","page-menu.new-page-initial-name":"Page 1","page-menu.edit-start":"Edit","page-menu.edit-done":"Done","page-menu.go-to-page":"Go to page","page-menu.submenu.rename":"Rename","page-menu.submenu.duplicate-page":"Duplicate","page-menu.submenu.title":"Menu","page-menu.submenu.move-down":"Move down","page-menu.submenu.move-up":"Move up","page-menu.submenu.delete":"Delete","share-menu.title":"Share","share-menu.save-note":"Download this project to your computer as a .tldr file.","share-menu.fork-note":"Create a new shared project based on this snapshot.","share-menu.share-project":"Share this project","share-menu.default-project-name":"Shared Project","share-menu.copy-link":"Copy editor link","share-menu.readonly-link":"Read-only","share-menu.create-snapshot-link":"Copy snapshot link","share-menu.snapshot-link-note":"Capture and share this project as a read-only snapshot link.","share-menu.copy-readonly-link":"Copy viewer link","share-menu.offline-note":"Create a new shared project based on your current project.","share-menu.copy-link-note":"Anyone with the link will be able to view and edit this project.","share-menu.copy-readonly-link-note":"Anyone with the link will be able to access this project.","share-menu.project-too-large":"Sorry, this project can't be shared because it's too large. We're working on it!","share-menu.upload-failed":"Sorry, we couldn't upload your project at the moment. Please try again or let us know if the problem persists.","share-menu.creating-project":"Creating the new project\u2026","share-menu.copied":"Copied link","document-name-menu.copy-link":"Copy link","status.offline":"Offline","status.online":"Online","people-menu.title":"People","people-menu.change-name":"Change name","people-menu.change-color":"Change color","people-menu.follow":"Following","people-menu.following":"Following","people-menu.leading":"Following You","people-menu.user":"(You)","people-menu.invite":"Invite others","help-menu.import-tldr-file":"Import file...","help-menu.title":"Help and resources","help-menu.about":"About tldraw","help-menu.docs":"Documentation & API","help-menu.discord":"Discord","help-menu.github":"GitHub","help-menu.keyboard-shortcuts":"Keyboard shortcuts","help-menu.twitter":"Twitter","help-menu.terms":"Terms of service","help-menu.privacy":"Privacy policy","actions-menu.title":"Actions","edit-link-dialog.title":"Edit link","edit-link-dialog.invalid-url":"A link must be a valid URL.","edit-link-dialog.detail":"Links will open in a new tab.","edit-link-dialog.url":"URL","edit-link-dialog.clear":"Clear","edit-link-dialog.save":"Continue","edit-link-dialog.cancel":"Cancel","embed-dialog.title":"Insert embed","embed-dialog.back":"Back","embed-dialog.create":"Create","embed-dialog.cancel":"Cancel","embed-dialog.url":"URL","embed-dialog.instruction":"Paste in the site's URL to create the embed.","embed-dialog.invalid-url":"We could not create an embed from that URL.","edit-pages-dialog.move-down":"Move down","edit-pages-dialog.move-up":"Move up","shortcuts-dialog.title":"Keyboard shortcuts","shortcuts-dialog.edit":"Edit","shortcuts-dialog.file":"File","shortcuts-dialog.preferences":"Preferences","shortcuts-dialog.tools":"Tools","shortcuts-dialog.transform":"Transform","shortcuts-dialog.view":"View","shortcuts-dialog.collaboration":"Collaboration","home-project-dialog.title":"Home project","home-project-dialog.description":"This is your local home project. It's just for you!","rename-project-dialog.title":"Rename project","rename-project-dialog.cancel":"Cancel","rename-project-dialog.rename":"Rename","home-project-dialog.ok":"Ok","style-panel.title":"Styles","style-panel.align":"Align","style-panel.label-align":"Label align","style-panel.vertical-align":"Vertical align","style-panel.position":"Position","style-panel.arrowheads":"Arrows","style-panel.arrowhead-start":"Start","style-panel.arrowhead-end":"End","style-panel.color":"Color","style-panel.dash":"Dash","style-panel.fill":"Fill","style-panel.font":"Font","style-panel.geo":"Shape","style-panel.mixed":"Mixed","style-panel.opacity":"Opacity","style-panel.size":"Size","style-panel.spline":"Spline","tool-panel.drawing":"Drawing","tool-panel.shapes":"Shapes","tool-panel.more":"More","debug-panel.more":"More","navigation-zone.toggle-minimap":"Toggle minimap","navigation-zone.zoom":"Zoom","focus-mode.toggle-focus-mode":"Toggle focus mode","toast.close":"Close","file-system.file-open-error.title":"Could not open file","file-system.file-open-error.not-a-tldraw-file":"The file you tried to open doesn't look like a tldraw file.","file-system.file-open-error.file-format-version-too-new":"The file you tried to open is from a newer version of tldraw. Please reload the page and try again.","file-system.file-open-error.generic-corrupted-file":"The file you tried to open is corrupted.","file-system.confirm-open.title":"Overwrite current project?","file-system.confirm-open.description":"Opening a file will replace your current project and any unsaved changes will be lost. Are you sure you want to continue?","file-system.confirm-open.cancel":"Cancel","file-system.confirm-open.open":"Open file","file-system.confirm-open.dont-show-again":"Don't ask again","file-system.confirm-clear.title":"Clear current project?","file-system.confirm-clear.description":"Creating a new project will clear your current project and any unsaved changes will be lost. Are you sure you want to continue?","file-system.confirm-clear.cancel":"Cancel","file-system.confirm-clear.continue":"Continue","file-system.confirm-clear.dont-show-again":"Don't ask again","file-system.shared-document-file-open-error.title":"Could not open file","file-system.shared-document-file-open-error.description":"Opening files from shared projects is not supported.","sharing.confirm-leave.title":"Leave current project?","sharing.confirm-leave.description":"Are you sure you want to leave this shared project? You can return to it by navigating to its URL.","sharing.confirm-leave.cancel":"Cancel","sharing.confirm-leave.leave":"Leave","sharing.confirm-leave.dont-show-again":"Don't ask again","toast.error.export-fail.title":"Failed export","toast.error.export-fail.desc":"Failed to export image","toast.error.copy-fail.title":"Failed copy","toast.error.copy-fail.desc":"Failed to copy image","context.pages.new-page":"New page","vscode.file-open.desc":"We've updated this document to work with the current version of tldraw. If you'd like to keep the original version (which will work on old.tldraw.com), click below to create a backup.","vscode.file-open.open":"Continue","vscode.file-open.backup":"Backup","vscode.file-open.backup-saved":"Backup saved","vscode.file-open.backup-failed":"Backup failed: this is not a .tldr file.","vscode.file-open.dont-show-again":"Don't ask again","cursor-chat.type-to-chat":"Type to chat..."},JI=new Set(["ar","fa","he","ur","ku"]),eE={locale:"en",label:"English",messages:QI,dir:"ltr"};const tE=e.createContext(null);function nE(){const t=e.useContext(tE);if(!t)throw new Error("useCurrentTranslation must be used inside of <TldrawUiContextProvider />");return t}function oE(t){let{overrides:n,locale:o,children:r}=t;const i=ZI(),[s,a]=e.useState((()=>n&&n.en?{locale:"en",label:"English",dir:"ltr",messages:l(l({},QI),n.en)}:{locale:"en",label:"English",dir:"ltr",messages:QI}));return e.useEffect((()=>{let e=!1;return async function(){const t=await async function(e,t){if(!(await B(t.translations.en)).ok)return console.warn("No main translations found."),eE;if("en"===e)return eE;const n=bs.find((t=>t.locale===e));if(!n)return console.warn("No translation found for locale ".concat(e)),eE;const o=await B(t.translations[n.locale]),r=await o.json();if(!r)return console.warn("No messages found for locale ".concat(e)),eE;const i=[];for(const s in eE.messages)r[s]||i.push(s);return i.length,{locale:e,label:n.label,dir:JI.has(n.locale)?"rtl":"ltr",messages:l(l({},eE.messages),r)}}(o,i);t&&!e&&(n&&n[o]?a(l(l({},t),{},{messages:l(l({},t.messages),n[o])})):a(t))}(),()=>{e=!0}}),[i,o,n]),(0,Ss.jsx)(tE.Provider,{value:s,children:r})}function rE(){const t=nE();return e.useCallback((function(e){var n;return null!==(n=t.messages[e])&&void 0!==n?n:e}),[t])}const iE=["children","type"],sE=e.forwardRef((function(e,t){let{children:n,type:o}=e,r=yr(e,iE);return(0,Ss.jsx)("button",l(l({ref:t,type:"button",draggable:!1},r),{},{className:ks("tlui-button","tlui-button__".concat(o),r.className),children:n}))}));function aE(e){let{children:t}=e;return(0,Ss.jsx)("span",{className:"tlui-button__label",children:t})}const lE=["__scopeDialog"],cE=["forceMount"],dE=["__scopeDialog"],uE=["forceMount"],hE=["__scopeDialog","trapFocus","onOpenAutoFocus","onCloseAutoFocus"],pE=["__scopeDialog"],fE=["__scopeDialog"],gE=["__scopeDialog"];var mE="Dialog",[yE,vE]=tw(mE),[bE,wE]=yE(mE),xE=t=>{const{__scopeDialog:n,children:o,open:r,defaultOpen:i,onOpenChange:s,modal:a=!0}=t,l=e.useRef(null),c=e.useRef(null),[d=!1,u]=ik({prop:r,defaultProp:i,onChange:s});return(0,Ss.jsx)(bE,{scope:n,triggerRef:l,contentRef:c,contentId:Xw(),titleId:Xw(),descriptionId:Xw(),open:d,onOpenChange:u,onOpenToggle:e.useCallback((()=>u((e=>!e))),[u]),modal:a,children:o})};xE.displayName=mE;var SE="DialogTrigger",kE=e.forwardRef(((e,t)=>{const{__scopeDialog:n}=e,o=yr(e,lE),r=wE(SE,n),i=iw(t,r.triggerRef);return(0,Ss.jsx)(pw.button,l(l({type:"button","aria-haspopup":"dialog","aria-expanded":r.open,"aria-controls":r.contentId,"data-state":HE(r.open)},o),{},{ref:i,onClick:Qb(e.onClick,r.onOpenToggle)}))}));kE.displayName=SE;var PE="DialogPortal",[CE,_E]=yE(PE,{forceMount:void 0}),IE=t=>{const{__scopeDialog:n,forceMount:o,children:r,container:i}=t,s=wE(PE,n);return(0,Ss.jsx)(CE,{scope:n,forceMount:o,children:e.Children.map(r,(e=>(0,Ss.jsx)(ok,{present:o||s.open,children:(0,Ss.jsx)(nk,{asChild:!0,container:i,children:e})})))})};IE.displayName=PE;var EE="DialogOverlay",jE=e.forwardRef(((e,t)=>{const n=_E(EE,e.__scopeDialog),{forceMount:o=n.forceMount}=e,r=yr(e,cE),i=wE(EE,e.__scopeDialog);return i.modal?(0,Ss.jsx)(ok,{present:o||i.open,children:(0,Ss.jsx)(TE,l(l({},r),{},{ref:t}))}):null}));jE.displayName=EE;var TE=e.forwardRef(((e,t)=>{const{__scopeDialog:n}=e,o=yr(e,dE),r=wE(EE,n);return(0,Ss.jsx)(PP,{as:lw,allowPinchZoom:!0,shards:[r.contentRef],children:(0,Ss.jsx)(pw.div,l(l({"data-state":HE(r.open)},o),{},{ref:t,style:l({pointerEvents:"auto"},o.style)}))})})),ME="DialogContent",AE=e.forwardRef(((e,t)=>{const n=_E(ME,e.__scopeDialog),{forceMount:o=n.forceMount}=e,r=yr(e,uE),i=wE(ME,e.__scopeDialog);return(0,Ss.jsx)(ok,{present:o||i.open,children:i.modal?(0,Ss.jsx)(OE,l(l({},r),{},{ref:t})):(0,Ss.jsx)(DE,l(l({},r),{},{ref:t}))})}));AE.displayName=ME;var OE=e.forwardRef(((t,n)=>{const o=wE(ME,t.__scopeDialog),r=e.useRef(null),i=iw(n,o.contentRef,r);return e.useEffect((()=>{const e=r.current;if(e)return Ok(e)}),[]),(0,Ss.jsx)(RE,l(l({},t),{},{ref:i,trapFocus:o.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:Qb(t.onCloseAutoFocus,(e=>{var t;e.preventDefault(),null===(t=o.triggerRef.current)||void 0===t||t.focus()})),onPointerDownOutside:Qb(t.onPointerDownOutside,(e=>{const t=e.detail.originalEvent,n=0===t.button&&!0===t.ctrlKey;(2===t.button||n)&&e.preventDefault()})),onFocusOutside:Qb(t.onFocusOutside,(e=>e.preventDefault()))}))})),DE=e.forwardRef(((t,n)=>{const o=wE(ME,t.__scopeDialog),r=e.useRef(!1),i=e.useRef(!1);return(0,Ss.jsx)(RE,l(l({},t),{},{ref:n,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:e=>{var n,s;(null===(n=t.onCloseAutoFocus)||void 0===n||n.call(t,e),e.defaultPrevented)||(r.current||null===(s=o.triggerRef.current)||void 0===s||s.focus(),e.preventDefault());r.current=!1,i.current=!1},onInteractOutside:e=>{var n,s;null===(n=t.onInteractOutside)||void 0===n||n.call(t,e),e.defaultPrevented||(r.current=!0,"pointerdown"===e.detail.originalEvent.type&&(i.current=!0));const a=e.target;(null===(s=o.triggerRef.current)||void 0===s?void 0:s.contains(a))&&e.preventDefault(),"focusin"===e.detail.originalEvent.type&&i.current&&e.preventDefault()}}))})),RE=e.forwardRef(((t,n)=>{const{__scopeDialog:o,trapFocus:r,onOpenAutoFocus:i,onCloseAutoFocus:s}=t,a=yr(t,hE),c=wE(ME,o),d=e.useRef(null),u=iw(n,d);return Ow(),(0,Ss.jsxs)(Ss.Fragment,{children:[(0,Ss.jsx)(Fw,{asChild:!0,loop:!0,trapped:r,onMountAutoFocus:i,onUnmountAutoFocus:s,children:(0,Ss.jsx)(_w,l(l({role:"dialog",id:c.contentId,"aria-describedby":c.descriptionId,"aria-labelledby":c.titleId,"data-state":HE(c.open)},a),{},{ref:u,onDismiss:()=>c.onOpenChange(!1)}))}),(0,Ss.jsxs)(Ss.Fragment,{children:[(0,Ss.jsx)(qE,{titleId:c.titleId}),(0,Ss.jsx)(YE,{contentRef:d,descriptionId:c.descriptionId})]})]})})),LE="DialogTitle",zE=e.forwardRef(((e,t)=>{const{__scopeDialog:n}=e,o=yr(e,pE),r=wE(LE,n);return(0,Ss.jsx)(pw.h2,l(l({id:r.titleId},o),{},{ref:t}))}));zE.displayName=LE;var NE="DialogDescription",FE=e.forwardRef(((e,t)=>{const{__scopeDialog:n}=e,o=yr(e,fE),r=wE(NE,n);return(0,Ss.jsx)(pw.p,l(l({id:r.descriptionId},o),{},{ref:t}))}));FE.displayName=NE;var BE="DialogClose",UE=e.forwardRef(((e,t)=>{const{__scopeDialog:n}=e,o=yr(e,gE),r=wE(BE,n);return(0,Ss.jsx)(pw.button,l(l({type:"button"},o),{},{ref:t,onClick:Qb(e.onClick,(()=>r.onOpenChange(!1)))}))}));function HE(e){return e?"open":"closed"}UE.displayName=BE;var KE="DialogTitleWarning",[VE,WE]=function(t,n){const o=e.createContext(n),r=t=>{const{children:n}=t,r=yr(t,Jb),i=e.useMemo((()=>r),Object.values(r));return(0,Ss.jsx)(o.Provider,{value:i,children:n})};return r.displayName=t+"Provider",[r,function(r){const i=e.useContext(o);if(i)return i;if(void 0!==n)return n;throw new Error("`".concat(r,"` must be used within `").concat(t,"`"))}]}(KE,{contentName:ME,titleName:LE,docsSlug:"dialog"}),qE=t=>{let{titleId:n}=t;const o=WE(KE),r="`".concat(o.contentName,"` requires a `").concat(o.titleName,"` for the component to be accessible for screen reader users.\n\nIf you want to hide the `").concat(o.titleName,"`, you can wrap it with our VisuallyHidden component.\n\nFor more information, see https://radix-ui.com/primitives/docs/components/").concat(o.docsSlug);return e.useEffect((()=>{if(n){document.getElementById(n)||console.error(r)}}),[r,n]),null},YE=t=>{let{contentRef:n,descriptionId:o}=t;const r=WE("DialogDescriptionWarning"),i="Warning: Missing `Description` or `aria-describedby={undefined}` for {".concat(r.contentName,"}.");return e.useEffect((()=>{var e;const t=null===(e=n.current)||void 0===e?void 0:e.getAttribute("aria-describedby");if(o&&t){document.getElementById(o)||console.warn(i)}}),[i,n,o]),null},GE=xE,XE=IE,$E=jE,ZE=AE;const QE=["small","invertIcon","icon","color","className"],JE=(0,e.memo)((function(t){var n;let{small:o,invertIcon:r,icon:i,color:s,className:a}=t,c=yr(t,QE);const d=ZI(),u=null!==(n=d.icons[i])&&void 0!==n?n:d.icons["question-mark-circle"],h=(0,e.useRef)(null);return(0,e.useLayoutEffect)((()=>{u||console.error("Icon not found: ".concat(i,". Add it to the assetUrls.icons object.")),null!==h&&void 0!==h&&h.current&&(h.current.style.webkitMask="url(".concat(u,") center 100% / 100% no-repeat"))}),[h,u,i]),"none"===i?(0,Ss.jsx)("div",{className:ks("tlui-icon tlui-icon__placeholder",{"tlui-icon__small":o},a)}):(0,Ss.jsx)("div",l(l({},c),{},{ref:h,className:ks("tlui-icon",{"tlui-icon__small":o},a),style:{color:s,mask:"url(".concat(u,") center 100% / 100% no-repeat"),transform:r?"scale(-1, 1)":void 0}}))}));function ej(e){let{icon:t,small:n,invertIcon:o}=e;return(0,Ss.jsx)(JE,{className:"tlui-button__icon",icon:t,small:n,invertIcon:o})}function tj(e){let{className:t,children:n}=e;return(0,Ss.jsx)("div",{className:ks("tlui-dialog__header",t),children:n})}function nj(e){let{className:t,children:n}=e;return(0,Ss.jsx)(zE,{dir:"ltr",className:ks("tlui-dialog__header__title",t),children:n})}function oj(){return(0,Ss.jsx)("div",{className:"tlui-dialog__header__close",children:(0,Ss.jsx)(UE,{"data-testid":"dialog.close",dir:"ltr",asChild:!0,children:(0,Ss.jsx)(sE,{type:"icon","aria-label":"Close",onTouchEnd:e=>e.target.click(),children:(0,Ss.jsx)(ej,{small:!0,icon:"cross-2"})})})})}function rj(e){let{className:t,children:n,style:o}=e;return(0,Ss.jsx)("div",{className:ks("tlui-dialog__body",t),style:o,children:n})}function ij(e){let{className:t,children:n}=e;return(0,Ss.jsx)("div",{className:ks("tlui-dialog__footer",t),children:n})}const sj=e.forwardRef((function(t,n){let{className:o,label:r,icon:i,iconLeft:s,autoSelect:a=!1,autoFocus:l=!1,defaultValue:c,placeholder:d,onComplete:u,onValueChange:h,onCancel:p,onFocus:f,onBlur:g,shouldManuallyMaintainScrollPositionWhenFocused:m=!1,children:y,value:v}=t;const b=Fs(),w=e.useRef(null);e.useImperativeHandle(n,(()=>w.current));const x=rE(),S=e.useRef(null!==c&&void 0!==c?c:""),k=e.useRef(null!==c&&void 0!==c?c:""),[P,C]=e.useState(!1),_=e.useCallback((e=>{C(!0);const t=e.currentTarget;k.current=t.value,b?b.timers.requestAnimationFrame((()=>{a&&t.select()})):Jh.requestAnimationFrame("anon",(()=>{a&&t.select()})),null===f||void 0===f||f()}),[a,b,f]),I=e.useCallback((e=>{const t=e.currentTarget.value;k.current=t,null===h||void 0===h||h(t)}),[h]),E=e.useCallback((e=>{switch(e.key){case"Enter":e.currentTarget.blur(),za(e),null===u||void 0===u||u(e.currentTarget.value);break;case"Escape":e.currentTarget.value=S.current,null===p||void 0===p||p(e.currentTarget.value),e.currentTarget.blur(),za(e)}}),[u,p]),j=e.useCallback((e=>{C(!1);const t=e.currentTarget.value;null===g||void 0===g||g(t)}),[g]);return e.useEffect((()=>{if(!ka.isIos)return;const e=window.visualViewport;if(P&&m&&e){const t=()=>{var e;null===(e=w.current)||void 0===e||e.scrollIntoView({block:"center"})};return e.addEventListener("resize",t),e.addEventListener("scroll",t),b?b.timers.requestAnimationFrame((()=>{var e;null===(e=w.current)||void 0===e||e.scrollIntoView({block:"center"})})):Jh.requestAnimationFrame("anon",(()=>{var e;null===(e=w.current)||void 0===e||e.scrollIntoView({block:"center"})})),()=>{e.removeEventListener("resize",t),e.removeEventListener("scroll",t)}}}),[P,b,m]),(0,Ss.jsxs)("div",{draggable:!1,className:"tlui-input__wrapper",children:[y,r&&(0,Ss.jsx)("label",{children:x(r)}),s&&(0,Ss.jsx)(JE,{icon:s,className:"tlui-icon-left",small:!0}),(0,Ss.jsx)("input",{ref:w,className:ks("tlui-input",o),type:"text",defaultValue:c,onKeyDownCapture:E,onChange:I,onFocus:_,onBlur:j,autoFocus:l,placeholder:d,value:v}),i&&(0,Ss.jsx)(JE,{icon:i,small:!!r})]})}));function aj(e){return So.isValid(e)?{isValid:!0,hasProtocol:!0}:So.isValid("https://"+e)?{isValid:!0,hasProtocol:!1}:{isValid:!1,hasProtocol:!1}}const lj=fn((function(e){let{onClose:t}=e;const n=Ns().getOnlySelectedShape();return n&&"url"in n.props&&"string"===typeof n.props.url?(0,Ss.jsx)(cj,{onClose:t,selectedShape:n}):null})),cj=fn((function(t){let{onClose:n,selectedShape:o}=t;const r=Ns(),i=rE(),s=(0,e.useRef)(null);(0,e.useEffect)((()=>{r.timers.requestAnimationFrame((()=>{var e;return null===(e=s.current)||void 0===e?void 0:e.focus()}))}),[r]);const a=(0,e.useRef)(o.props.url),[l,c]=(0,e.useState)((()=>{const e=aj(o.props.url),t=!0===e.isValid?e.hasProtocol?o.props.url:"https://"+o.props.url:"https://";return{actual:t,safe:t,valid:!0}})),d=(0,e.useCallback)((e=>{const t=e.replace(/https?:\/\/(https?:\/\/)/,((e,t)=>t)),n=aj(t),o=!0===n.isValid?n.hasProtocol?t:"https://"+t:"https://";c({actual:t,safe:o,valid:n.isValid})}),[]),u=(0,e.useCallback)((()=>{const e=r.getOnlySelectedShape();e&&(r.updateShapes([{id:e.id,type:e.type,props:{url:""}}]),n())}),[r,n]),h=(0,e.useCallback)((()=>{const e=r.getOnlySelectedShape();e&&(e&&"url"in e.props&&e.props.url!==l.safe&&r.updateShapes([{id:e.id,type:e.type,props:{url:l.safe}}]),n())}),[r,n,l]),p=(0,e.useCallback)((()=>{n()}),[n]);if(!o)return n(),null;const f=a.current&&!l.valid;return(0,Ss.jsxs)(Ss.Fragment,{children:[(0,Ss.jsxs)(tj,{children:[(0,Ss.jsx)(nj,{children:i("edit-link-dialog.title")}),(0,Ss.jsx)(oj,{})]}),(0,Ss.jsx)(rj,{children:(0,Ss.jsxs)("div",{className:"tlui-edit-link-dialog",children:[(0,Ss.jsx)(sj,{ref:s,className:"tlui-edit-link-dialog__input",label:"edit-link-dialog.url",autoFocus:!0,value:l.actual,onValueChange:d,onComplete:h,onCancel:p}),(0,Ss.jsx)("div",{children:l.valid?i("edit-link-dialog.detail"):i("edit-link-dialog.invalid-url")})]})}),(0,Ss.jsxs)(ij,{className:"tlui-dialog__footer__actions",children:[(0,Ss.jsx)(sE,{type:"normal",onClick:p,onTouchEnd:p,children:(0,Ss.jsx)(aE,{children:i("edit-link-dialog.cancel")})}),f?(0,Ss.jsx)(sE,{type:"danger",onTouchEnd:u,onClick:u,children:(0,Ss.jsx)(aE,{children:i("edit-link-dialog.clear")})}):(0,Ss.jsx)(sE,{type:"primary",disabled:!l.valid,onTouchEnd:h,onClick:h,children:(0,Ss.jsx)(aE,{children:i("edit-link-dialog.save")})})]})]})})),dj=/(^\/r\/[^/]+\/?$)/,uj=[{type:"tldraw",title:"tldraw",hostnames:["beta.tldraw.com","tldraw.com","localhost:3000"],minWidth:300,minHeight:300,width:720,height:500,doesResize:!0,overridePermissions:{"allow-top-navigation":!0},toEmbedUrl:e=>{const t=mt(e);if(t&&t.pathname.match(dj))return e},fromEmbedUrl:e=>{const t=mt(e);if(t&&t.pathname.match(dj))return e}},{type:"figma",title:"Figma",hostnames:["figma.com"],width:720,height:500,doesResize:!0,toEmbedUrl:e=>{if(e.match(/https:\/\/([\w\.-]+\.)?figma.com\/(file|proto)\/([0-9a-zA-Z]{22,128})(?:\/.*)?$/)&&!e.includes("figma.com/embed"))return"https://www.figma.com/embed?embed_host=share&url=".concat(e)},fromEmbedUrl:e=>{const t=mt(e);if(t&&t.pathname.match(/^\/embed\/?$/)){const e=t.searchParams.get("url");if(e)return e}}},{type:"google_maps",title:"Google Maps",hostnames:["google.*"],width:720,height:500,doesResize:!0,overridePermissions:{"allow-presentation":!0},toEmbedUrl:e=>{if(e.includes("/maps/")){const t=e.match(/@(.*),(.*),(.*)z/);let n;if(t){const[,o,r,i]=t,s=new URL(e).host.replace("www.","");n="https://".concat(s,"/maps/embed/v1/view?key=").concat({NODE_ENV:"production",PUBLIC_URL:"/whiteboard",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.NEXT_PUBLIC_GC_API_KEY,"&center=").concat(o,",").concat(r,"&zoom=").concat(i)}else n="";return n}},fromEmbedUrl:e=>{const t=mt(e);if(!t)return;if(t.pathname.match(/^\/maps\/embed\/v1\/view\/?$/)&&t.searchParams.has("center")&&t.searchParams.get("zoom")){const e=t.searchParams.get("zoom"),[n,o]=t.searchParams.get("center").split(",");return"https://www.google.com/maps/@".concat(n,",").concat(o,",").concat(e,"z")}}},{type:"val_town",title:"Val Town",hostnames:["val.town"],minWidth:260,minHeight:100,width:720,height:500,doesResize:!0,toEmbedUrl:e=>{const t=mt(e),n=t&&t.pathname.match(/\/v\/(.+)\/?/);if(n)return"https://www.val.town/embed/".concat(n[1])},fromEmbedUrl:e=>{const t=mt(e),n=t&&t.pathname.match(/\/embed\/(.+)\/?/);if(n)return"https://www.val.town/v/".concat(n[1])}},{type:"codesandbox",title:"CodeSandbox",hostnames:["codesandbox.io"],minWidth:300,minHeight:300,width:720,height:500,doesResize:!0,toEmbedUrl:e=>{const t=mt(e),n=t&&t.pathname.match(/\/s\/([^/]+)\/?/);if(n)return"https://codesandbox.io/embed/".concat(n[1])},fromEmbedUrl:e=>{const t=mt(e),n=t&&t.pathname.match(/\/embed\/([^/]+)\/?/);if(n)return"https://codesandbox.io/s/".concat(n[1])}},{type:"codepen",title:"Codepen",hostnames:["codepen.io"],minWidth:300,minHeight:300,width:520,height:400,doesResize:!0,toEmbedUrl:e=>{const t=e.match(/https:\/\/codepen.io\/([^/]+)\/pen\/([^/]+)/);if(t){const[e,n,o]=t;return"https://codepen.io/".concat(n,"/embed/").concat(o)}},fromEmbedUrl:e=>{const t=e.match(/https:\/\/codepen.io\/([^/]+)\/embed\/([^/]+)/);if(t){const[e,n,o]=t;return"https://codepen.io/".concat(n,"/pen/").concat(o)}}},{type:"scratch",title:"Scratch",hostnames:["scratch.mit.edu"],width:520,height:400,doesResize:!1,toEmbedUrl:e=>{const t=e.match(/https?:\/\/scratch.mit.edu\/projects\/([^/]+)/);if(t){const[e,n]=t;return"https://scratch.mit.edu/projects/embed/".concat(n)}},fromEmbedUrl:e=>{const t=e.match(/https:\/\/scratch.mit.edu\/projects\/embed\/([^/]+)/);if(t){const[e,n]=t;return"https://scratch.mit.edu/projects/".concat(n)}}},{type:"youtube",title:"YouTube",hostnames:["*.youtube.com","youtube.com","youtu.be"],width:800,height:450,doesResize:!0,overridePermissions:{"allow-presentation":!0,"allow-popups-to-escape-sandbox":!0},isAspectRatioLocked:!0,toEmbedUrl:e=>{const t=mt(e);if(!t)return;const n=t.hostname.replace(/^www./,"");if("youtu.be"===n){const e=t.pathname.split("/").filter(Boolean)[0];return"https://www.youtube.com/embed/".concat(e)}if(("youtube.com"===n||"m.youtube.com"===n)&&t.pathname.match(/^\/watch/)){const e=t.searchParams.get("v");return"https://www.youtube.com/embed/".concat(e)}},fromEmbedUrl:e=>{const t=mt(e);if(!t)return;if("youtube.com"===t.hostname.replace(/^www./,"")){const e=t.pathname.match(/^\/embed\/([^/]+)\/?/);if(e)return"https://www.youtube.com/watch?v=".concat(e[1])}}},{type:"google_calendar",title:"Google Calendar",hostnames:["calendar.google.*"],width:720,height:500,minWidth:460,minHeight:360,doesResize:!0,instructionLink:"https://support.google.com/calendar/answer/41207?hl=en",overridePermissions:{"allow-popups-to-escape-sandbox":!0},toEmbedUrl:e=>{const t=mt(e),n=null===t||void 0===t?void 0:t.searchParams.get("cid");if(null!==t&&void 0!==t&&t.pathname.match(/\/calendar\/u\/0/)&&n){t.pathname="/calendar/embed";const e=Array.from(t.searchParams.keys());for(const n of e)t.searchParams.delete(n);return t.searchParams.set("src",n),t.href}},fromEmbedUrl:e=>{const t=mt(e),n=null===t||void 0===t?void 0:t.searchParams.get("src");if(null!==t&&void 0!==t&&t.pathname.match(/\/calendar\/embed/)&&n){t.pathname="/calendar/u/0";const e=Array.from(t.searchParams.keys());for(const n of e)t.searchParams.delete(n);return t.searchParams.set("cid",n),t.href}}},{type:"google_slides",title:"Google Slides",hostnames:["docs.google.*"],width:720,height:500,minWidth:460,minHeight:360,doesResize:!0,overridePermissions:{"allow-popups-to-escape-sandbox":!0},toEmbedUrl:e=>{const t=mt(e);if(null!==t&&void 0!==t&&t.pathname.match(/^\/presentation/)&&null!==t&&void 0!==t&&t.pathname.match(/\/pub\/?$/)){t.pathname=t.pathname.replace(/\/pub$/,"/embed");const e=Array.from(t.searchParams.keys());for(const n of e)t.searchParams.delete(n);return t.href}},fromEmbedUrl:e=>{const t=mt(e);if(null!==t&&void 0!==t&&t.pathname.match(/^\/presentation/)&&null!==t&&void 0!==t&&t.pathname.match(/\/embed\/?$/)){t.pathname=t.pathname.replace(/\/embed$/,"/pub");const e=Array.from(t.searchParams.keys());for(const n of e)t.searchParams.delete(n);return t.href}}},{type:"github_gist",title:"GitHub Gist",hostnames:["gist.github.com"],width:720,height:500,doesResize:!0,toEmbedUrl:e=>{const t=mt(e);if(t&&t.pathname.match(/\/([^/]+)\/([^/]+)/)){if(!e.split("/").pop())return;return e}},fromEmbedUrl:e=>{const t=mt(e);if(t&&t.pathname.match(/\/([^/]+)\/([^/]+)/)){if(!e.split("/").pop())return;return e}}},{type:"replit",title:"Replit",hostnames:["replit.com"],width:720,height:500,doesResize:!0,toEmbedUrl:e=>{const t=mt(e);if(t&&t.pathname.match(/\/@([^/]+)\/([^/]+)/))return"".concat(e,"?embed=true")},fromEmbedUrl:e=>{const t=mt(e);if(t&&t.pathname.match(/\/@([^/]+)\/([^/]+)/)&&t.searchParams.has("embed"))return t.searchParams.delete("embed"),t.href}},{type:"felt",title:"Felt",hostnames:["felt.com"],width:720,height:500,doesResize:!0,toEmbedUrl:e=>{const t=mt(e);if(t&&t.pathname.match(/^\/map\//))return t.origin+"/embed"+t.pathname},fromEmbedUrl:e=>{const t=mt(e);if(t&&t.pathname.match(/^\/embed\/map\//))return t.pathname=t.pathname.replace(/^\/embed/,""),t.href}},{type:"spotify",title:"Spotify",hostnames:["open.spotify.com"],width:720,height:500,minHeight:500,overrideOutlineRadius:12,doesResize:!0,toEmbedUrl:e=>{const t=mt(e);if(t&&t.pathname.match(/^\/(artist|album)\//))return t.origin+"/embed"+t.pathname},fromEmbedUrl:e=>{const t=mt(e);if(t&&t.pathname.match(/^\/embed\/(artist|album)\//))return t.origin+t.pathname.replace(/^\/embed/,"")}},{type:"vimeo",title:"Vimeo",hostnames:["vimeo.com","player.vimeo.com"],width:640,height:360,doesResize:!0,isAspectRatioLocked:!0,toEmbedUrl:e=>{const t=mt(e);if(t&&"vimeo.com"===t.hostname&&t.pathname.match(/^\/[0-9]+/))return"https://player.vimeo.com/video/"+t.pathname.split("/")[1]+"?title=0&byline=0"},fromEmbedUrl:e=>{const t=mt(e);if(t&&"player.vimeo.com"===t.hostname){const e=t.pathname.match(/^\/video\/([^/]+)\/?$/);if(e)return"https://vimeo.com/"+e[1]}}},{type:"excalidraw",title:"Excalidraw",hostnames:["excalidraw.com"],width:720,height:500,doesResize:!0,isAspectRatioLocked:!0,toEmbedUrl:e=>{const t=mt(e);if(t&&t.hash.match(/#room=/))return e},fromEmbedUrl:e=>{const t=mt(e);if(t&&t.hash.match(/#room=/))return e}},{type:"observable",title:"Observable",hostnames:["observablehq.com"],width:720,height:500,doesResize:!0,isAspectRatioLocked:!1,backgroundColor:"#fff",toEmbedUrl:e=>{const t=mt(e);if(t&&t.pathname.match(/^\/@([^/]+)\/([^/]+)\/?$/))return"".concat(t.origin,"/embed").concat(t.pathname,"?cell=*");if(t&&t.pathname.match(/^\/d\/([^/]+)\/?$/)){const e=t.pathname.replace(/^\/d/,"");return"".concat(t.origin,"/embed").concat(e,"?cell=*")}},fromEmbedUrl:e=>{const t=mt(e);return t&&t.pathname.match(/^\/embed\/@([^/]+)\/([^/]+)\/?$/)?"".concat(t.origin).concat(t.pathname.replace("/embed",""),"#cell-*"):t&&t.pathname.match(/^\/embed\/([^/]+)\/?$/)?"".concat(t.origin).concat(t.pathname.replace("/embed","/d"),"#cell-*"):void 0}},{type:"desmos",title:"Desmos",hostnames:["desmos.com"],width:700,height:450,doesResize:!0,toEmbedUrl:e=>{const t=mt(e);if(t&&"www.desmos.com"===t.hostname&&t.pathname.match(/^\/calculator\/([^/]+)\/?$/)&&""===t.search&&""===t.hash)return"".concat(e,"?embed")},fromEmbedUrl:e=>{const t=mt(e);if(t&&"www.desmos.com"===t.hostname&&t.pathname.match(/^\/calculator\/([^/]+)\/?$/)&&"?embed"===t.search&&""===t.hash)return e.replace("?embed","")}}],hj={"allow-downloads-without-user-activation":!1,"allow-downloads":!1,"allow-modals":!1,"allow-orientation-lock":!1,"allow-pointer-lock":!1,"allow-popups":!0,"allow-popups-to-escape-sandbox":!1,"allow-presentation":!1,"allow-storage-access-by-user-activation":!1,"allow-top-navigation":!1,"allow-top-navigation-by-user-activation":!1,"allow-scripts":!0,"allow-same-origin":!0,"allow-forms":!0},pj=uj.map((e=>e.type));function fj(){return Ns().getShapeUtil("embed")}function gj(){const e=fj();return t=>e?e.getEmbedDefinition(t):void 0}const mj=fn((function(t){let{onClose:n}=t;const o=Ns(),r=rE(),i=ZI(),[s,a]=(0,e.useState)(null),[l,c]=(0,e.useState)(""),[d,u]=(0,e.useState)(null),[h,p]=(0,e.useState)(!1),f=(0,e.useRef)(-1),g=function(){const e=fj();return e?e.getEmbedDefinitions():[]}(),m=gj();return(0,Ss.jsxs)(Ss.Fragment,{children:[(0,Ss.jsxs)(tj,{children:[(0,Ss.jsx)(nj,{children:s?"".concat(r("embed-dialog.title")," \u2014 ").concat(s.title):r("embed-dialog.title")}),(0,Ss.jsx)(oj,{})]}),s?(0,Ss.jsxs)(Ss.Fragment,{children:[(0,Ss.jsxs)(rj,{className:"tlui-embed-dialog__enter",children:[(0,Ss.jsx)(sj,{className:"tlui-embed-dialog__input",label:"embed-dialog.url",placeholder:"https://example.com",autoFocus:!0,onValueChange:e=>{c(e);const t=m(e);u(t&&t.definition.type===s.type?t:null),p(!1),clearTimeout(f.current),f.current=o.timers.setTimeout((()=>p(!t)),320)}}),""===l?(0,Ss.jsxs)("div",{className:"tlui-embed-dialog__instruction",children:[(0,Ss.jsx)("span",{children:r("embed-dialog.instruction")})," ",s.instructionLink&&(0,Ss.jsxs)("a",{target:"_blank",rel:"noopener noreferrer",href:s.instructionLink,className:"tlui-embed-dialog__instruction__link",children:["Learn more.",(0,Ss.jsx)(JE,{icon:"external-link",small:!0})]})]}):(0,Ss.jsx)("div",{className:"tlui-embed-dialog__warning",children:h?r("embed-dialog.invalid-url"):"\xa0"})]}),(0,Ss.jsxs)(ij,{className:"tlui-dialog__footer__actions",children:[(0,Ss.jsx)(sE,{type:"normal",onClick:()=>{a(null),u(null),c("")},children:(0,Ss.jsx)(aE,{children:r("embed-dialog.back")})}),(0,Ss.jsx)("div",{className:"tlui-embed__spacer"}),(0,Ss.jsx)(sE,{type:"normal",onClick:n,children:(0,Ss.jsx)(aE,{children:r("embed-dialog.cancel")})}),(0,Ss.jsx)(sE,{type:"primary",disabled:!d,onClick:()=>{d&&(o.putExternalContent({type:"embed",url:l,point:o.getViewportPageBounds().center,embed:d.definition}),n())},children:(0,Ss.jsx)(aE,{children:r("embed-dialog.create")})})]})]}):(0,Ss.jsx)(Ss.Fragment,{children:(0,Ss.jsx)(rj,{className:"tlui-embed-dialog__list",children:g.map((e=>{const t=(n=e.type,pj.includes(n)?i.embedIcons[e.type]:function(e){return"icon"in e}(e)?e.icon:void 0);var n;return(0,Ss.jsxs)(sE,{type:"menu",onClick:()=>a(e),children:[(0,Ss.jsx)(aE,{children:e.title}),t&&(0,Ss.jsx)("div",{className:"tlui-embed-dialog__item__image",style:{backgroundImage:"url(".concat(t,")")}})]},e.type)}))})})]})}));async function yj(e,t,n){const o=C(t.map((t=>{const n=e.getShape(t);if(!n)return;return void 0!==e.getShapeUtil(n.type).toSvg?n:void 0})));if(0===o.length)return;if(1===o.length){const t=o[0];if(!t)return;if(e.isShapeOfType(t,"image"))return}const r=[];if(void 0!==n){const t=o.map((t=>({shape:t,bounds:e.getShapeMaskedPageBounds(t).clone().expandBy(n)})));for(let e=0;e<t.length;e++){const n=t[e];if(0===e){r[0]={shapes:[n.shape],bounds:n.bounds};continue}let o=!1;for(const e of r)if(e.bounds.includes(n.bounds)){e.shapes.push(n.shape),e.bounds.expand(n.bounds),o=!0;break}o||r.push({shapes:[n.shape],bounds:n.bounds})}}else{const t=rc.Common(o.map((t=>e.getShapeMaskedPageBounds(t))));r.push({shapes:o,bounds:t})}const i=e.options.flattenImageBoundsPadding;for(const a of r){void 0!==n&&a.bounds.expandBy(-n);const t=await e.getSvgString(a.shapes,{padding:i});if(null===t||void 0===t||!t.svg)continue;const o=new Blob([t.svg],{type:"image/svg+xml"}),r=await e.getAssetForExternalContent({type:"file",file:new File([o],"asset.svg",{type:"image/svg+xml"})});r&&(a.asset=r)}const s=[];return Xt((()=>{for(const n of r){var t;const{asset:o,bounds:r,shapes:a}=n;if(!o)continue;const c=null!==(t=e.findCommonAncestor(a))&&void 0!==t?t:e.getCurrentPageId();if(!c)continue;let d,u,h,p="a1";for(const e of a)if(e.parentId===c){e.index>p&&(p=e.index);break}if(Ho(c)){const t=e.getShape(c);if(!t)continue;const n=e.getPointInShapeSpace(t,{x:r.x,y:r.y});h=e.getShapePageTransform(c).rotation(),n.sub(new Vs(i,i).rot(-h)),d=n.x,u=n.y}else d=r.x-i,u=r.y-i,h=0;e.deleteShapes(a),e.createAssets([l(l({},o),{},{id:o.id})]);const f=Ko();e.createShape({id:f,type:"image",index:p,parentId:c,x:d,y:u,rotation:-h,props:{assetId:o.id,w:r.w+2*i,h:r.h+2*i}}),s.push(f)}})),s}function vj(){const e=Fs();return void 0!==(null===e||void 0===e?void 0:e.store.props.collaboration)}const bj=[0,389,436,476,580,640,840,1023];var wj=(e=>(e[e.ZERO=0]="ZERO",e[e.MOBILE_XXS=1]="MOBILE_XXS",e[e.MOBILE_XS=2]="MOBILE_XS",e[e.MOBILE_SM=3]="MOBILE_SM",e[e.MOBILE=4]="MOBILE",e[e.TABLET_SM=5]="TABLET_SM",e[e.TABLET=6]="TABLET",e[e.DESKTOP=7]="DESKTOP",e))(wj||{});const xj=e.createContext(null);function Sj(e){let{forceMobile:t=!1,children:n}=e;const o=Fs(),r=yn("breakpoint",(()=>{var e;const{width:n}=null!==(e=null===o||void 0===o?void 0:o.getViewportScreenBounds())&&void 0!==e?e:{width:window.innerWidth},r=t?wj.MOBILE_SM:bj.length-1;for(let t=0;t<r;t++)if(n>bj[t]&&n<=bj[t+1])return t;return r}),[o]);return(0,Ss.jsx)(xj.Provider,{value:r,children:n})}function kj(){const t=(0,e.useContext)(xj);if(null===t)throw new Error("useBreakpoint must be used inside of the <BreakpointProvider /> component");return t}const Pj=(0,e.createContext)(null);function Cj(t){let{context:n,children:o}=t;const r=Zb(),i=gn("dialogs",[]),s=(0,e.useMemo)((()=>({dialogs:i,addDialog(e){var t;const o=null!==(t=e.id)&&void 0!==t?t:$();return i.update((t=>[...t.filter((t=>t.id!==e.id)),l(l({},e),{},{id:o})])),r("open-menu",{source:"dialog",id:o}),Qh.addOpenMenu(o,n),o},removeDialog(e){const t=i.get().find((t=>t.id===e));var o;t&&(null===(o=t.onClose)||void 0===o||o.call(t),r("close-menu",{source:"dialog",id:e}),Qh.deleteOpenMenu(e,n),i.update((e=>e.filter((e=>e!==t)))));return e},clearDialogs(){const e=i.get();0!==e.length&&(e.forEach((e=>{var t;null===(t=e.onClose)||void 0===t||t.call(e),r("close-menu",{source:"dialog",id:e.id}),Qh.deleteOpenMenu(e.id,n)})),i.set([]))}})),[r,i,n]);return(0,Ss.jsx)(Pj.Provider,{value:s,children:o})}function _j(){const t=(0,e.useContext)(Pj);if(!t)throw new Error("useDialogs must be used within a DialogsProvider");return t}var Ij=e.forwardRef(((e,t)=>(0,Ss.jsx)(pw.span,l(l({},e),{},{ref:t,style:l({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"},e.style)}))));Ij.displayName="VisuallyHidden";const Ej=["__scopeToast","hotkey","label"],jj=["__scopeToast","onFocusFromOutsideViewport"],Tj=["forceMount","open","defaultOpen","onOpenChange"],Mj=["__scopeToast","type","duration","open","onClose","onEscapeKeyDown","onPause","onResume","onSwipeStart","onSwipeMove","onSwipeCancel","onSwipeEnd"],Aj=["__scopeToast","children"],Oj=["__scopeToast"],Dj=["__scopeToast"],Rj=["altText"],Lj=["__scopeToast"],zj=["__scopeToast","altText"];var Nj="ToastProvider",[Fj,Bj,Uj]=mw("Toast"),[Hj,Kj]=tw("Toast",[Uj]),[Vj,Wj]=Hj(Nj),qj=t=>{const{__scopeToast:n,label:o="Notification",duration:r=5e3,swipeDirection:i="right",swipeThreshold:s=50,children:a}=t,[l,c]=e.useState(null),[d,u]=e.useState(0),h=e.useRef(!1),p=e.useRef(!1);return o.trim()||console.error("Invalid prop `label` supplied to `".concat(Nj,"`. Expected non-empty `string`.")),(0,Ss.jsx)(Fj.Provider,{scope:n,children:(0,Ss.jsx)(Vj,{scope:n,label:o,duration:r,swipeDirection:i,swipeThreshold:s,toastCount:d,viewport:l,onViewportChange:c,onToastAdd:e.useCallback((()=>u((e=>e+1))),[]),onToastRemove:e.useCallback((()=>u((e=>e-1))),[]),isFocusedToastEscapeKeyDownRef:h,isClosePausedRef:p,children:a})})};qj.displayName=Nj;var Yj="ToastViewport",Gj=["F8"],Xj="toast.viewportPause",$j="toast.viewportResume",Zj=e.forwardRef(((t,n)=>{const{__scopeToast:o,hotkey:r=Gj,label:i="Notifications ({hotkey})"}=t,s=yr(t,Ej),a=Wj(Yj,o),c=Bj(o),d=e.useRef(null),u=e.useRef(null),h=e.useRef(null),p=e.useRef(null),f=iw(n,p,a.onViewportChange),g=r.join("+").replace(/Key/g,"").replace(/Digit/g,""),m=a.toastCount>0;e.useEffect((()=>{const e=e=>{var t;0!==r.length&&r.every((t=>e[t]||e.code===t))&&(null===(t=p.current)||void 0===t||t.focus())};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)}),[r]),e.useEffect((()=>{const e=d.current,t=p.current;if(m&&e&&t){const n=()=>{if(!a.isClosePausedRef.current){const e=new CustomEvent(Xj);t.dispatchEvent(e),a.isClosePausedRef.current=!0}},o=()=>{if(a.isClosePausedRef.current){const e=new CustomEvent($j);t.dispatchEvent(e),a.isClosePausedRef.current=!1}},r=t=>{!e.contains(t.relatedTarget)&&o()},i=()=>{e.contains(document.activeElement)||o()};return e.addEventListener("focusin",n),e.addEventListener("focusout",r),e.addEventListener("pointermove",n),e.addEventListener("pointerleave",i),window.addEventListener("blur",n),window.addEventListener("focus",o),()=>{e.removeEventListener("focusin",n),e.removeEventListener("focusout",r),e.removeEventListener("pointermove",n),e.removeEventListener("pointerleave",i),window.removeEventListener("blur",n),window.removeEventListener("focus",o)}}}),[m,a.isClosePausedRef]);const y=e.useCallback((e=>{let{tabbingDirection:t}=e;const n=c().map((e=>{const n=e.ref.current,o=[n,...mT(n)];return"forwards"===t?o:o.reverse()}));return("forwards"===t?n.reverse():n).flat()}),[c]);return e.useEffect((()=>{const e=p.current;if(e){const t=t=>{const n=t.altKey||t.ctrlKey||t.metaKey;if("Tab"===t.key&&!n){const n=document.activeElement,s=t.shiftKey;var o;if(t.target===e&&s)return void(null===(o=u.current)||void 0===o||o.focus());const a=y({tabbingDirection:s?"backwards":"forwards"}),l=a.findIndex((e=>e===n));var r,i;if(yT(a.slice(l+1)))t.preventDefault();else s?null===(r=u.current)||void 0===r||r.focus():null===(i=h.current)||void 0===i||i.focus()}};return e.addEventListener("keydown",t),()=>e.removeEventListener("keydown",t)}}),[c,y]),(0,Ss.jsxs)(Mw,{ref:d,role:"region","aria-label":i.replace("{hotkey}",g),tabIndex:-1,style:{pointerEvents:m?void 0:"none"},children:[m&&(0,Ss.jsx)(Jj,{ref:u,onFocusFromOutsideViewport:()=>{yT(y({tabbingDirection:"forwards"}))}}),(0,Ss.jsx)(Fj.Slot,{scope:o,children:(0,Ss.jsx)(pw.ol,l(l({tabIndex:-1},s),{},{ref:f}))}),m&&(0,Ss.jsx)(Jj,{ref:h,onFocusFromOutsideViewport:()=>{yT(y({tabbingDirection:"backwards"}))}})]})}));Zj.displayName=Yj;var Qj="ToastFocusProxy",Jj=e.forwardRef(((e,t)=>{const{__scopeToast:n,onFocusFromOutsideViewport:o}=e,r=yr(e,jj),i=Wj(Qj,n);return(0,Ss.jsx)(Ij,l(l({"aria-hidden":!0,tabIndex:0},r),{},{ref:t,style:{position:"fixed"},onFocus:e=>{var t;const n=e.relatedTarget;!(null!==(t=i.viewport)&&void 0!==t&&t.contains(n))&&o()}}))}));Jj.displayName=Qj;var eT="Toast",tT=e.forwardRef(((e,t)=>{const{forceMount:n,open:o,defaultOpen:r,onOpenChange:i}=e,s=yr(e,Tj),[a=!0,c]=ik({prop:o,defaultProp:r,onChange:i});return(0,Ss.jsx)(ok,{present:n||a,children:(0,Ss.jsx)(rT,l(l({open:a},s),{},{ref:t,onClose:()=>c(!1),onPause:bw(e.onPause),onResume:bw(e.onResume),onSwipeStart:Qb(e.onSwipeStart,(e=>{e.currentTarget.setAttribute("data-swipe","start")})),onSwipeMove:Qb(e.onSwipeMove,(e=>{const{x:t,y:n}=e.detail.delta;e.currentTarget.setAttribute("data-swipe","move"),e.currentTarget.style.setProperty("--radix-toast-swipe-move-x","".concat(t,"px")),e.currentTarget.style.setProperty("--radix-toast-swipe-move-y","".concat(n,"px"))})),onSwipeCancel:Qb(e.onSwipeCancel,(e=>{e.currentTarget.setAttribute("data-swipe","cancel"),e.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),e.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),e.currentTarget.style.removeProperty("--radix-toast-swipe-end-x"),e.currentTarget.style.removeProperty("--radix-toast-swipe-end-y")})),onSwipeEnd:Qb(e.onSwipeEnd,(e=>{const{x:t,y:n}=e.detail.delta;e.currentTarget.setAttribute("data-swipe","end"),e.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),e.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),e.currentTarget.style.setProperty("--radix-toast-swipe-end-x","".concat(t,"px")),e.currentTarget.style.setProperty("--radix-toast-swipe-end-y","".concat(n,"px")),c(!1)}))}))})}));tT.displayName=eT;var[nT,oT]=Hj(eT,{onClose(){}}),rT=e.forwardRef(((t,n)=>{const{__scopeToast:o,type:r="foreground",duration:i,open:s,onClose:a,onEscapeKeyDown:c,onPause:d,onResume:u,onSwipeStart:h,onSwipeMove:p,onSwipeCancel:f,onSwipeEnd:g}=t,m=yr(t,Mj),y=Wj(eT,o),[v,b]=e.useState(null),w=iw(n,(e=>b(e))),x=e.useRef(null),S=e.useRef(null),k=i||y.duration,P=e.useRef(0),C=e.useRef(k),_=e.useRef(0),{onToastAdd:I,onToastRemove:E}=y,j=bw((()=>{var e;(null===v||void 0===v?void 0:v.contains(document.activeElement))&&(null===(e=y.viewport)||void 0===e||e.focus()),a()})),T=e.useCallback((e=>{e&&e!==1/0&&(window.clearTimeout(_.current),P.current=(new Date).getTime(),_.current=window.setTimeout(j,e))}),[j]);e.useEffect((()=>{const e=y.viewport;if(e){const t=()=>{T(C.current),null===u||void 0===u||u()},n=()=>{const e=(new Date).getTime()-P.current;C.current=C.current-e,window.clearTimeout(_.current),null===d||void 0===d||d()};return e.addEventListener(Xj,n),e.addEventListener($j,t),()=>{e.removeEventListener(Xj,n),e.removeEventListener($j,t)}}}),[y.viewport,k,d,u,T]),e.useEffect((()=>{s&&!y.isClosePausedRef.current&&T(k)}),[s,k,y.isClosePausedRef,T]),e.useEffect((()=>(I(),()=>E())),[I,E]);const M=e.useMemo((()=>v?pT(v):null),[v]);return y.viewport?(0,Ss.jsxs)(Ss.Fragment,{children:[M&&(0,Ss.jsx)(iT,{__scopeToast:o,role:"status","aria-live":"foreground"===r?"assertive":"polite","aria-atomic":!0,children:M}),(0,Ss.jsx)(nT,{scope:o,onClose:j,children:Cu.createPortal((0,Ss.jsx)(Fj.ItemSlot,{scope:o,children:(0,Ss.jsx)(Tw,{asChild:!0,onEscapeKeyDown:Qb(c,(()=>{y.isFocusedToastEscapeKeyDownRef.current||j(),y.isFocusedToastEscapeKeyDownRef.current=!1})),children:(0,Ss.jsx)(pw.li,l(l({role:"status","aria-live":"off","aria-atomic":!0,tabIndex:0,"data-state":s?"open":"closed","data-swipe-direction":y.swipeDirection},m),{},{ref:w,style:l({userSelect:"none",touchAction:"none"},t.style),onKeyDown:Qb(t.onKeyDown,(e=>{"Escape"===e.key&&(null===c||void 0===c||c(e.nativeEvent),e.nativeEvent.defaultPrevented||(y.isFocusedToastEscapeKeyDownRef.current=!0,j()))})),onPointerDown:Qb(t.onPointerDown,(e=>{0===e.button&&(x.current={x:e.clientX,y:e.clientY})})),onPointerMove:Qb(t.onPointerMove,(e=>{if(!x.current)return;const t=e.clientX-x.current.x,n=e.clientY-x.current.y,o=Boolean(S.current),r=["left","right"].includes(y.swipeDirection),i=["left","up"].includes(y.swipeDirection)?Math.min:Math.max,s=r?i(0,t):0,a=r?0:i(0,n),l="touch"===e.pointerType?10:2,c={x:s,y:a},d={originalEvent:e,delta:c};o?(S.current=c,fT("toast.swipeMove",p,d,{discrete:!1})):gT(c,y.swipeDirection,l)?(S.current=c,fT("toast.swipeStart",h,d,{discrete:!1}),e.target.setPointerCapture(e.pointerId)):(Math.abs(t)>l||Math.abs(n)>l)&&(x.current=null)})),onPointerUp:Qb(t.onPointerUp,(e=>{const t=S.current,n=e.target;if(n.hasPointerCapture(e.pointerId)&&n.releasePointerCapture(e.pointerId),S.current=null,x.current=null,t){const n=e.currentTarget,o={originalEvent:e,delta:t};gT(t,y.swipeDirection,y.swipeThreshold)?fT("toast.swipeEnd",g,o,{discrete:!0}):fT("toast.swipeCancel",f,o,{discrete:!0}),n.addEventListener("click",(e=>e.preventDefault()),{once:!0})}}))}))})}),y.viewport)})]}):null})),iT=t=>{const{__scopeToast:n,children:o}=t,r=yr(t,Aj),i=Wj(eT,n),[s,a]=e.useState(!1),[c,d]=e.useState(!1);return function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:()=>{};const t=bw(e);qw((()=>{let e=0,n=0;return e=window.requestAnimationFrame((()=>n=window.requestAnimationFrame(t))),()=>{window.cancelAnimationFrame(e),window.cancelAnimationFrame(n)}}),[t])}((()=>a(!0))),e.useEffect((()=>{const e=window.setTimeout((()=>d(!0)),1e3);return()=>window.clearTimeout(e)}),[]),c?null:(0,Ss.jsx)(nk,{asChild:!0,children:(0,Ss.jsx)(Ij,l(l({},r),{},{children:s&&(0,Ss.jsxs)(Ss.Fragment,{children:[i.label," ",o]})}))})},sT=e.forwardRef(((e,t)=>{const{__scopeToast:n}=e,o=yr(e,Oj);return(0,Ss.jsx)(pw.div,l(l({},o),{},{ref:t}))}));sT.displayName="ToastTitle";var aT=e.forwardRef(((e,t)=>{const{__scopeToast:n}=e,o=yr(e,Dj);return(0,Ss.jsx)(pw.div,l(l({},o),{},{ref:t}))}));aT.displayName="ToastDescription";var lT="ToastAction",cT=e.forwardRef(((e,t)=>{const{altText:n}=e,o=yr(e,Rj);return n.trim()?(0,Ss.jsx)(hT,{altText:n,asChild:!0,children:(0,Ss.jsx)(uT,l(l({},o),{},{ref:t}))}):(console.error("Invalid prop `altText` supplied to `".concat(lT,"`. Expected non-empty `string`.")),null)}));cT.displayName=lT;var dT="ToastClose",uT=e.forwardRef(((e,t)=>{const{__scopeToast:n}=e,o=yr(e,Lj),r=oT(dT,n);return(0,Ss.jsx)(hT,{asChild:!0,children:(0,Ss.jsx)(pw.button,l(l({type:"button"},o),{},{ref:t,onClick:Qb(e.onClick,r.onClose)}))})}));uT.displayName=dT;var hT=e.forwardRef(((e,t)=>{const{__scopeToast:n,altText:o}=e,r=yr(e,zj);return(0,Ss.jsx)(pw.div,l(l({"data-radix-toast-announce-exclude":"","data-radix-toast-announce-alt":o||void 0},r),{},{ref:t}))}));function pT(e){const t=[];return Array.from(e.childNodes).forEach((e=>{if(e.nodeType===e.TEXT_NODE&&e.textContent&&t.push(e.textContent),function(e){return e.nodeType===e.ELEMENT_NODE}(e)){const n=e.ariaHidden||e.hidden||"none"===e.style.display,o=""===e.dataset.radixToastAnnounceExclude;if(!n)if(o){const n=e.dataset.radixToastAnnounceAlt;n&&t.push(n)}else t.push(...pT(e))}})),t}function fT(e,t,n,o){let{discrete:r}=o;const i=n.originalEvent.currentTarget,s=new CustomEvent(e,{bubbles:!0,cancelable:!0,detail:n});t&&i.addEventListener(e,t,{once:!0}),r?fw(i,s):i.dispatchEvent(s)}var gT=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const o=Math.abs(e.x),r=Math.abs(e.y),i=o>r;return"left"===t||"right"===t?i&&o>n:!i&&r>n};function mT(e){const t=[],n=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:e=>{const t="INPUT"===e.tagName&&"hidden"===e.type;return e.disabled||e.hidden||t?NodeFilter.FILTER_SKIP:e.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)t.push(n.currentNode);return t}function yT(e){const t=document.activeElement;return e.some((e=>e===t||(e.focus(),document.activeElement!==t)))}var vT=tT,bT=sT,wT=aT,xT=cT,ST=uT;const kT=(0,e.createContext)(null);function PT(t){let{children:n}=t;const o=gn("toasts",[]),r=(0,e.useMemo)((()=>({toasts:o,addToast(e){var t;const n=null!==(t=e.id)&&void 0!==t?t:$();return o.update((t=>[...t.filter((t=>t.id!==e.id)),l(l({},e),{},{id:n})])),n},removeToast:e=>(o.update((t=>t.filter((t=>t.id!==e)))),e),clearToasts(){o.set([])}})),[o]);return(0,Ss.jsx)(qj,{children:(0,Ss.jsx)(kT.Provider,{value:r,children:n})})}function CT(){const t=(0,e.useContext)(kT);if(!t)throw new Error("useToasts must be used within a ToastsProvider");return t}var _T=n(3393);const IT="web image/vnd.tldraw+png",ET={"image/png":IT},jT={[IT]:"image/png"};function TT(e){var t;return null!==(t=he(jT,e))&&void 0!==t?t:e}async function MT(e,t,n){const{elements:o,files:r}=t,i={shapes:[],bindings:[],rootShapeIds:[],assets:[],schema:e.store.schema.serialize()},s=new Map,a=new Map,c=e.getCurrentPageId(),d=new Map,u=[],h=new Set;o.forEach((e=>{if(d.set(e.id,Ko()),null!==e.boundElements)for(const t of e.boundElements)"text"===t.type&&h.add(t.id)}));let p="a0";for(const C of o){if(h.has(C.id))continue;const e=d.get(C.id),t={id:e,typeName:"shape",parentId:c,index:p,x:C.x,y:C.y,rotation:0,isLocked:C.locked,opacity:AT(C.opacity),meta:{}};var f;if(0!==C.angle&&a.set(e,C.angle),C.groupIds&&C.groupIds.length>0)if(s.has(C.groupIds[0]))null===(f=s.get(C.groupIds[0]))||void 0===f||f.push(e);else s.set(C.groupIds[0],[e]);else u.push(e);switch(C.type){case"rectangle":case"ellipse":case"diamond":{var g,m,y;let e="",n="middle";if(null!==C.boundElements)for(const t of C.boundElements)if("text"===t.type){const r=o.find((e=>e.id===t.id));r&&(e=r.text,n=HT[r.textAlign])}const r="transparent"===C.backgroundColor?C.strokeColor:C.backgroundColor;i.shapes.push(l(l({},t),{},{type:"geo",props:{geo:C.type,url:null!==(g=C.link)&&void 0!==g?g:"",w:C.width,h:C.height,size:null!==(m=OT[C.strokeWidth])&&void 0!==m?m:"draw",color:null!==(y=FT[r])&&void 0!==y?y:"black",text:e,align:n,dash:qT(C),fill:YT(C)}}));break}case"freedraw":var v;i.shapes.push(l(l({},t),{},{type:"draw",props:{dash:qT(C),size:OT[C.strokeWidth],color:null!==(v=FT[C.strokeColor])&&void 0!==v?v:"black",segments:[{type:"free",points:C.points.map((e=>{let[t,n,o=.5]=e;return{x:t,y:n,z:o}}))}]}}));break;case"line":{var b;if(C.points.slice().length<2)break;const e=Qe(C.points.length);i.shapes.push(l(l({},t),{},{type:"line",props:{dash:qT(C),size:OT[C.strokeWidth],color:null!==(b=FT[C.strokeColor])&&void 0!==b?b:"black",spline:C.roundness?"cubic":"line",points:l({},Object.fromEntries(C.points.map(((t,n)=>{let[o,r]=t;const i=e[n];return[i,{id:i,index:i,x:o,y:r}]}))))}}));break}case"arrow":{var w,x,S,k,P,_;let n="";if(null!==C.boundElements)for(const e of C.boundElements)if("text"===e.type){const t=o.find((t=>t.id===e.id));t&&(n=t.text)}const r=C.points[0],s=C.points[C.points.length-1],a=d.get(null===(w=C.startBinding)||void 0===w?void 0:w.elementId),c=d.get(null===(x=C.endBinding)||void 0===x?void 0:x.elementId);i.shapes.push(l(l({},t),{},{type:"arrow",props:{text:n,bend:WT(C,r,s),dash:qT(C),size:null!==(S=OT[C.strokeWidth])&&void 0!==S?S:"m",color:null!==(k=FT[C.strokeColor])&&void 0!==k?k:"black",start:{x:r[0],y:r[1]},end:{x:s[0],y:s[1]},arrowheadEnd:null!==(P=VT[C.endArrowhead])&&void 0!==P?P:"none",arrowheadStart:null!==(_=VT[C.startArrowhead])&&void 0!==_?_:"none"}})),a&&i.bindings.push({id:Ro(),typeName:"binding",type:"arrow",fromId:e,toId:a,props:{terminal:"start",normalizedAnchor:{x:.5,y:.5},isPrecise:!1,isExact:!1},meta:{}}),c&&i.bindings.push({id:Ro(),typeName:"binding",type:"arrow",fromId:e,toId:c,props:{terminal:"end",normalizedAnchor:{x:.5,y:.5},isPrecise:!1,isExact:!1},meta:{}});break}case"text":{var I,E;const{size:e,scale:n}=RT(C.fontSize);i.shapes.push(l(l({},t),{},{type:"text",props:{size:e,scale:n,font:null!==(I=LT[C.fontFamily])&&void 0!==I?I:"draw",color:null!==(E=FT[C.strokeColor])&&void 0!==E?E:"black",text:C.text,textAlign:KT[C.textAlign]}}));break}case"image":{var j;const e=r[C.fileId];if(!e)break;const n=Pi.createId();i.assets.push({id:n,typeName:"asset",type:"image",props:{w:C.width,h:C.height,fileSize:e.size,name:null!==(j=C.id)&&void 0!==j?j:"Untitled",isAnimated:!1,mimeType:e.mimeType,src:e.dataURL},meta:{}}),i.shapes.push(l(l({},t),{},{type:"image",props:{w:C.width,h:C.height,assetId:n}}))}}p=Ze(p)}const T=null!==n&&void 0!==n?n:e.inputs.shiftKey?e.inputs.currentPagePoint:void 0;e.markHistoryStoppingPoint("paste"),e.putContentOntoCurrentPage(i,{point:T,select:!1,preserveIds:!0});for(const l of s.values())if(l.length>1){e.groupShapes(l);const t=e.getShape(l[0]);null!==t&&void 0!==t&&t.parentId&&Ho(t.parentId)&&u.push(t.parentId)}for(const[l,C]of a)e.select(l),e.rotateShapesBy([l],C);const M=C(u.map((t=>e.getShape(t)))),A=rc.Common(M.map((t=>e.getShapePageBounds(t)))),O=e.getViewportPageBounds().center;e.updateShapes(M.map((e=>{var t,n;const o=(null!==(t=e.x)&&void 0!==t?t:0)-(A.x+A.w/2),r=(null!==(n=e.y)&&void 0!==n?n:0)-(A.y+A.h/2);return{id:e.id,type:e.type,x:O.x+o,y:O.y+r}}))),e.setSelectedShapes(u)}const AT=e=>{const t=e/100;return t<.2?.1:t<.4?.25:t<.6?.5:t<.8?.75:1},OT={1:"s",2:"m",3:"l",4:"xl"},DT={16:"s",20:"m",28:"l",36:"xl"};function RT(e){const t=DT[e];return t?{size:t,scale:1}:e<16?{size:"s",scale:e/16}:e>36?{size:"xl",scale:e/36}:{size:"m",scale:1}}const LT={1:"draw",2:"sans",3:"mono"},zT={gray:["#f8f9fa","#e9ecef","#ced4da","#868e96","#343a40"],red:["#fff5f5","#ffc9c9","#ff8787","#fa5252","#e03131"],pink:["#fff0f6","#fcc2d7","#f783ac","#e64980","#c2255c"],grape:["#f8f0fc","#eebefa","#da77f2","#be4bdb","#9c36b5"],violet:["#f3f0ff","#d0bfff","#9775fa","#7950f2","#6741d9"],indigo:["#edf2ff","#bac8ff","#748ffc","#4c6ef5","#3b5bdb"],blue:["#e7f5ff","#a5d8ff","#4dabf7","#228be6","#1971c2"],cyan:["#e3fafc","#99e9f2","#3bc9db","#15aabf","#0c8599"],teal:["#e6fcf5","#96f2d7","#38d9a9","#12b886","#099268"],green:["#ebfbee","#b2f2bb","#69db7c","#40c057","#2f9e44"],lime:["#f4fce3","#d8f5a2","#a9e34b","#82c91e","#66a80f"],yellow:["#fff9db","#ffec99","#ffd43b","#fab005","#f08c00"],orange:["#fff4e6","#ffd8a8","#ffa94d","#fd7e14","#e8590c"]};function NT(e,t,n){const o=[0,1,2,3,4].map((t=>zT[e][t]));return Object.fromEntries(o.map(((e,o)=>[e,o<3?t:n])))}const FT=l(l(l(l(l(l(l(l(l(l(l({},NT("gray","grey","black")),NT("red","light-red","red")),NT("pink","light-red","red")),NT("grape","light-violet","violet")),NT("blue","light-blue","blue")),NT("cyan","light-blue","blue")),NT("teal","light-green","green")),NT("green","light-green","green")),NT("yellow","yellow","orange")),NT("orange","yellow","orange")),{},{"#ffffff":"white","#000000":"black"}),BT={solid:"draw",dashed:"dashed",dotted:"dotted"},UT={"cross-hatch":"pattern",hachure:"pattern",solid:"solid"},HT={left:"start",center:"middle",right:"end"},KT={left:"start",center:"middle",right:"end"},VT={arrow:"arrow",dot:"dot",triangle:"triangle",bar:"pipe"};function WT(e,t,n){let o=0;if(e.points.length>2){const r=new Vs(t[0],t[1]),i=new Vs(n[0],n[1]),s=new Vs(e.points[1][0],e.points[1][1]),a=Vs.Sub(i,r),l=Vs.Per(a),c=Vs.Med(i,r),d=Vs.Sub(c,l),u=Vs.Add(c,l),h=Vs.NearestPointOnLineSegment(d,u,s,!1);o=Vs.Dist(h,c),Vs.Clockwise(h,i,c)&&(o*=-1)}return o}const qT=e=>{var t;let n=null!==(t=BT[e.strokeStyle])&&void 0!==t?t:"draw";return"draw"===n&&0===e.roughness&&(n="solid"),n},YT=e=>{var t;return"transparent"===e.backgroundColor?"none":null!==(t=UT[e.fillStyle])&&void 0!==t?t:"solid"};function GT(e,t,n){const o=e.getSelectionPageBounds();e.markHistoryStoppingPoint("paste"),e.putContentOntoCurrentPage(t,{point:n,select:!0});const r=e.getSelectionPageBounds();o&&r&&null!==o&&void 0!==o&&o.collides(r)&&(e.updateInstanceState({isChangingStyle:!0}),e.timers.setTimeout((()=>{e.updateInstanceState({isChangingStyle:!1})}),150))}async function XT(e,t,n,o){return e.markHistoryStoppingPoint("paste"),await e.putExternalContent({type:"url",point:n,url:t,sources:o})}const $T=[IT,"image/png","image/jpeg","image/webp","image/svg+xml"];function ZT(e){const t=document.implementation.createHTMLDocument("");return t.documentElement.innerHTML=e.trim(),t.body.textContent||t.body.innerText||""}const QT=["input","select","textarea"];function JT(e){const{activeElement:t}=document;return e.menus.hasAnyOpenMenus()||t&&(t.getAttribute("contenteditable")||QT.indexOf(t.tagName.toLowerCase())>-1)}const eM=(e,t,n,o)=>{const r=(e=>{const t=e.split(/[\n\s]/);for(const o of t)try{const e=new URL(o);if("http:"!==e.protocol&&"https:"!==e.protocol)return}catch(n){return}return dc(t)})(t);if(r)for(const i of r)XT(e,i,n);else(e=>{try{const t=new URL(e);return"http:"===t.protocol||"https:"===t.protocol}catch(t){return!1}})(t)?XT(e,t,n):/^<svg/.test(t)?(e.markHistoryStoppingPoint("paste"),e.putExternalContent({type:"svg-text",text:t,point:n,sources:o})):(e.markHistoryStoppingPoint("paste"),e.putExternalContent({type:"text",text:t,point:n,sources:o}))},tM=async(e,t,n)=>{const o=[];for(const r of t){for(const e of $T)if(r.types.includes(e)){const t=r.getType(e).then((t=>H.rewriteMimeType(t,TT(e))));o.push({type:"blob",source:t});break}r.types.includes("text/html")&&o.push({type:"html",source:(async()=>{const e=await r.getType("text/html");return await H.blobToText(e)})()}),r.types.includes("text/uri-list")&&o.push({type:"url",source:(async()=>{const e=await r.getType("text/uri-list");return await H.blobToText(e)})()}),r.types.includes("text/plain")&&o.push({type:"text",source:(async()=>{const e=await r.getType("text/plain");return await H.blobToText(e)})()})}return await nM(e,o,n)};async function nM(e,t,n){const o=t.filter((e=>("file"===e.type||"blob"===e.type)&&null!==e.source));if(o.length){if(o.length>e.options.maxFilesAtOnce)throw Error("Too many files");const t=C(await Promise.all(o.map((e=>e.source))));return await async function(e,t,n,o){const r=t.map((e=>e instanceof File?e:new File([e],"tldrawFile",{type:e.type})));e.markHistoryStoppingPoint("paste"),await e.putExternalContent({type:"files",files:r,point:n,ignoreParent:!1,sources:o})}(e,t,n)}const r=await Promise.all(t.filter((e=>"file"!==e.type)).map((e=>new Promise((t=>{const n=e;"file"!==n.type?n.source.then((e=>{var o;const r=null===(o=e.match(/<div data-tldraw[^>]*>(.*)<\/div>/))||void 0===o?void 0:o[1];if(r)try{const e=_T.decompressFromBase64(r);if(null===e)return void t({type:"error",data:e,reason:"found tldraw data comment but could not parse base64"});{const n=JSON.parse(e);return"application/tldraw"!==n.type&&t({type:"error",data:n,reason:"found tldraw data comment but JSON was of a different type: ".concat(n.type)}),"string"===typeof n.data?void t({type:"error",data:n,reason:"found tldraw json but data was a string instead of a TLClipboardModel object"}):void t({type:"tldraw",data:n.data})}}catch(i){return void t({type:"error",data:r,reason:"found tldraw json but data was a string instead of a TLClipboardModel object"})}else{if("html"===n.type)return void t({type:"text",data:e,subtype:"html"});if("url"===n.type)return void t({type:"text",data:e,subtype:"url"});try{const n=JSON.parse(e);return"excalidraw/clipboard"===n.type?void t({type:"excalidraw",data:n}):void t({type:"text",data:e,subtype:"json"})}catch(s){return void t({type:"text",data:e,subtype:"text"})}}t({type:"error",data:e,reason:"unhandled case"})})):t({type:"error",data:null,reason:"unexpected file"})})))));for(const i of r)if("tldraw"===i.type)return void GT(e,i.data,n);for(const i of r)if("excalidraw"===i.type)return void MT(e,i.data,n);for(const i of r)if("text"===i.type&&"html"===i.subtype){const t=(new DOMParser).parseFromString(i.data,"text/html").querySelector("body");if(t&&1===Array.from(t.children).filter((e=>1===e.nodeType)).length&&t.firstElementChild&&"A"===t.firstElementChild.tagName&&t.firstElementChild.hasAttribute("href")&&""!==t.firstElementChild.getAttribute("href")){const o=t.firstElementChild.getAttribute("href");return void eM(e,o,n,r)}if(!r.some((e=>"text"===e.type&&"html"!==e.subtype))&&i.data.trim())return void eM(e,ZT(i.data),n,r)}for(const i of r)if("text"===i.type&&"url"===i.subtype)return void XT(e,i.data,n,r);for(const i of r)if("text"===i.type&&"text"===i.subtype&&i.data.trim())return void eM(e,i.data,n,r)}const oM=async e=>{const t=await e.resolveAssetsInContent(e.getContentFromCurrentPage(e.getSelectedShapeIds()));if(!t)return void(navigator&&navigator.clipboard&&navigator.clipboard.writeText(""));const n=_T.compressToBase64(JSON.stringify({type:"application/tldraw",kind:"content",data:t}));if("undefined"!==typeof navigator){var o;const r=t.shapes.map((t=>e.getShapeUtil(t).getText(t))).filter(yt);if(null!==(o=navigator.clipboard)&&void 0!==o&&o.write){const e=new Blob(["<div data-tldraw>".concat(n,"</div>")],{type:"text/html"});let t=r.join(" ");""===t&&(t=" "),navigator.clipboard.write([new ClipboardItem({"text/html":e,"text/plain":new Blob([t],{type:"text/plain"})})])}else navigator.clipboard.writeText&&navigator.clipboard.writeText("<div data-tldraw>".concat(n,"</div>"))}};function rM(){const t=Ns(),n=Zb(),o=yn("editor.isFocused",(()=>t.getInstanceState().isFocused),[t]);(0,e.useEffect)((()=>{if(!o)return;const e=async e=>{0===t.getSelectedShapeIds().length||null!==t.getEditingShapeId()||JT(t)||(Da(e),await oM(t),n("copy",{source:"kbd"}))};async function r(e){0===t.getSelectedShapeIds().length||null!==t.getEditingShapeId()||JT(t)||(Da(e),await oM(t),t.deleteShapes(t.getSelectedShapeIds()),n("cut",{source:"kbd"}))}let i=!1;const s=e=>{1===e.button&&(i=!0,t.timers.requestAnimationFrame((()=>{i=!1})))},a=e=>{var o;if(i)return void za(e);if(null!==t.getEditingShapeId()||JT(t))return;let r,s=!1;t.inputs.shiftKey&&(s=!0),t.user.getIsPasteAtCursorMode()&&(s=!s),s&&(r=t.inputs.currentPagePoint);const a=()=>{e.clipboardData&&(async(e,t,n)=>{if(null!==e.getEditingShapeId())return;if(!t)throw Error("No clipboard data");const o=[];for(const r of Object.values(t.items))switch(r.kind){case"file":o.push({type:"file",source:new Promise((e=>e(r.getAsFile())))});break;case"string":"text/html"===r.type?o.push({type:"html",source:new Promise((e=>r.getAsString(e)))}):"text/plain"===r.type?o.push({type:"text",source:new Promise((e=>r.getAsString(e)))}):o.push({type:r.type,source:new Promise((e=>r.getAsString(e)))})}nM(e,o,n)})(t,e.clipboardData,r)};null!==(o=navigator.clipboard)&&void 0!==o&&o.read?navigator.clipboard.read().then((e=>{Array.isArray(e)&&e[0]instanceof ClipboardItem&&tM(t,e,r)}),(()=>{a()})):a(),Da(e),n("paste",{source:"kbd"})};return document.addEventListener("copy",e),document.addEventListener("cut",r),document.addEventListener("paste",a),document.addEventListener("pointerup",s),()=>{document.removeEventListener("copy",e),document.removeEventListener("cut",r),document.removeEventListener("paste",a),document.removeEventListener("pointerup",s)}}),[t,n,o])}function iM(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function sM(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?iM(Object(n),!0).forEach((function(t){aM(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):iM(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function aM(e,t,n){return(t=function(e){var t=function(e,t){if("object"!==typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,t||"default");if("object"!==typeof o)return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function lM(e,t){if(null==e)return{};var n,o,r=function(e,t){if(null==e)return{};var n,o,r={},i=Object.keys(e);for(o=0;o<i.length;o++)n=i[o],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(o=0;o<i.length;o++)n=i[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function cM(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var o,r,i,s,a=[],l=!0,c=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(o=i.call(n)).done)&&(a.push(o.value),a.length!==t);l=!0);}catch(EW){c=!0,r=EW}finally{try{if(!l&&null!=n.return&&(s=n.return(),Object(s)!==s))return}finally{if(c)throw r}}return a}}(e,t)||uM(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function dM(e){return function(e){if(Array.isArray(e))return hM(e)}(e)||function(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||uM(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function uM(e,t){if(e){if("string"===typeof e)return hM(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?hM(e,t):void 0}}function hM(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function pM(e){var t,n,o=e.sizes.shift(),r=Math.max(Math.ceil(o[0]),1),i=Math.max(Math.ceil(o[1]),1),s=[r-1,i-1,1,1],a=Date.now(),l="undefined"!==typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope;l?(t=new OffscreenCanvas(1,1),n=new OffscreenCanvas(r,i)):((t=document.createElement("canvas")).width=1,t.height=1,(n=document.createElement("canvas")).width=r,n.height=i);var c=t.getContext("2d"),d=n.getContext("2d");d&&(d.fillRect.apply(d,s),c.drawImage(n,r-1,i-1,1,1,0,0,1,1));var u=c&&0!==c.getImageData(0,0,1,1).data[3],h=Date.now()-a;return[t,n].forEach((function(e){e.height=0,e.width=0})),l?(postMessage({width:r,height:i,benchmark:h,isTestPass:u}),!u&&e.sizes.length&&pM(e)):u?e.onSuccess(r,i,h):(e.onError(r,i,h),e.sizes.length&&pM(e)),u}var fM=[16384,14188,11402,11180,10836,8192,4096,1],gM=[8388607,65535,32767,16384,8192,4096,1],mM=[4194303,65535,32767,16384,8192,4096,1],yM=["onError","onSuccess"],vM={max:null,min:1,sizes:[],step:1024,usePromise:!1,useWorker:!1,onError:Function.prototype,onSuccess:Function.prototype},bM={};function wM(e){var t=e.width===e.height,n=1===e.height,o=1===e.width,r=[];if(e.width&&e.height)for(var i=e.min||vM.min,s=e.step||vM.step,a=Math.max(e.width,e.height);a>=i;){var l=t||n?a:1,c=t||o?a:1;r.push([l,c]),a-=s}else e.sizes.forEach((function(e){var i=t||n?e:1,s=t||o?e:1;r.push([i,s])}));return r}function xM(e){var t=window&&"HTMLCanvasElement"in window,n=window&&"OffscreenCanvas"in window,o=Date.now(),r=e.onError,i=e.onSuccess,s=lM(e,yM),a=null;if(!t)return!1;if(e.useWorker&&n){var l="\n            var canvasTest = ".concat(pM.toString(),";\n            onmessage = function(e) {\n                canvasTest(e.data);\n            };\n        "),c=new Blob([l],{type:"application/javascript"}),d=URL.createObjectURL(c);a=new Worker(d),URL.revokeObjectURL(d),a.onmessage=function(e){var t=e.data,n=t.width,r=t.height,i=t.benchmark;t.isTestPass?(bM[o].onSuccess(n,r,i),delete bM[o]):bM[o].onError(n,r,i)}}return e.usePromise?new Promise((function(t,n){var l=sM(sM({},e),{},{onError:function(t,o,i){var s;if(0===e.sizes.length)s=!0;else{var a=cM(e.sizes.slice(-1),1),l=cM(a[0],2),c=l[0],d=l[1];s=t===c&&o===d}r(t,o,i),s&&n({width:t,height:o,benchmark:i})},onSuccess:function(e,n,o){i(e,n,o),t({width:e,height:n,benchmark:o})}});if(a){var c=l.onError,d=l.onSuccess;bM[o]={onError:c,onSuccess:d},a.postMessage(s)}else pM(l)})):a?(bM[o]={onError:r,onSuccess:i},void a.postMessage(s)):pM(e)}var SM=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=wM({width:e.max,height:e.max,min:e.min,step:e.step,sizes:dM(fM)});return xM(sM(sM(sM({},vM),e),{},{sizes:t}))},kM=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=wM({width:1,height:e.max,min:e.min,step:e.step,sizes:dM(gM)});return xM(sM(sM(sM({},vM),e),{},{sizes:t}))},PM=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=wM({width:e.max,height:1,min:e.min,step:e.step,sizes:dM(mM)});return xM(sM(sM(sM({},vM),e),{},{sizes:t}))};let CM=null;function _M(){return CM||(CM=async function(){const e=await PM({usePromise:!0}),t=await kM({usePromise:!0}),n=await SM({usePromise:!0});return{maxWidth:e.width,maxHeight:t.height,maxArea:n.width*n.height}}()),CM}async function IM(e,t,n){const{type:o,width:r,height:i,quality:s=1,pixelRatio:a=2}=n;let[l,c]=await async function(e,t){if(e<=8192&&t<=8192&&e*t<=16777216)return[e,t];const{maxWidth:n,maxHeight:o,maxArea:r}=await _M(),i=e/t;if(e>n&&(t=(e=n)/i),t>o&&(e=(t=o)*i),e*t>r){const n=Math.sqrt(r/(e*t));e*=n,t*=n}return[e,t]}(r*a,i*a);l=Math.floor(l),c=Math.floor(c);const d=l/r,u=await H.blobToDataUrl(new Blob([t],{type:"image/svg+xml"})),h=await new Promise((e=>{const t=U();t.crossOrigin="anonymous",t.onload=async()=>{ka.isSafari&&await D(250);const n=document.createElement("canvas"),o=n.getContext("2d");n.width=l,n.height=c,o.imageSmoothingEnabled=!0,o.imageSmoothingQuality="high",o.drawImage(t,0,0,l,c),URL.revokeObjectURL(u),e(n)},t.onerror=()=>{e(null)},t.src=u}));if(!h)return null;const p=await new Promise((e=>h.toBlob((t=>{t&&!Ta.throwToBlob.get()||e(null),e(t)}),"image/"+o,s)));if(!p)return null;if("png"===o){const e=new DataView(await p.arrayBuffer());return ee.setPhysChunk(e,d,{type:"image/"+o})}return p}async function EM(e,t,n){var o;const r=await e.getSvgString(null!==t&&void 0!==t&&t.length?t:[...e.getCurrentPageShapeIds()],l({scale:null!==(o=n.scale)&&void 0!==o?o:1,background:e.getInstanceState().exportBackground},n));if(!r)throw new Error("Could not construct SVG.");return r}async function jM(e,t,n){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};switch(n){case"svg":var r;return null===(r=await EM(e,t,o))||void 0===r?void 0:r.svg;case"json":{const n=await e.resolveAssetsInContent(e.getContentFromCurrentPage(t));return JSON.stringify(n)}default:T(n)}}async function TM(e){let{editor:t,ids:n,format:o,opts:r={}}=e;switch(o){case"svg":return new Blob([await jM(t,n,"svg",r)],{type:"text/plain"});case"json":return new Blob([await jM(t,n,"json",r)],{type:"text/plain"});case"jpeg":case"png":case"webp":{const e=await EM(t,n,r);if(!e)throw new Error("Could not construct image.");const i=await IM(0,e.svg,{type:o,quality:r.quality,pixelRatio:r.pixelRatio,width:e.width,height:e.height});if(!i)throw new Error("Could not construct image.");return i}default:T(o)}}const MM={jpeg:"image/jpeg",png:"image/png",webp:"image/webp",json:"text/plain",svg:"text/plain"};function AM(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"svg",o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(!navigator.clipboard)return Promise.reject(new Error("Copy not supported"));if(navigator.clipboard.write){const{blobPromise:r,mimeType:i}=function(e,t,n){return{blobPromise:TM({editor:e,ids:t,format:n,opts:arguments.length>3&&void 0!==arguments[3]?arguments[3]:{}}),mimeType:MM[n]}}(e,t,n,o),s={[i]:r},a=function(e){var t;return null!==(t=he(ET,e))&&void 0!==t?t:null}(i);return a&&function(e){return"undefined"!==typeof ClipboardItem&&"supports"in ClipboardItem&&ClipboardItem.supports(e)}(a)&&(s[a]=r.then((e=>H.rewriteMimeType(e,a)))),function(e){const t=Object.entries(e);for(const[n,o]of t)o.catch((e=>console.error(e)));return navigator.clipboard.write([new ClipboardItem(e)]).catch((e=>(console.error(e),Promise.all(t.map((async e=>{let[t,n]=e;return[t,await n]}))).then((e=>{const t=me(e);return navigator.clipboard.write([new ClipboardItem(t)])})))))}(s)}switch(n){case"json":case"svg":return async function(e){var t,n;await(null===(t=navigator.clipboard)||void 0===t||null===(n=t.writeText)||void 0===n?void 0:n.call(t,await e()))}((async()=>jM(e,t,n,o)));case"jpeg":case"png":throw new Error("Copy not supported");default:T(n)}}function OM(){const t=Ns(),{addToast:n}=CT(),o=rE();return(0,e.useCallback)((function(e){AM(t,e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:"svg").catch((()=>{n({id:"copy-fail",severity:"warning",title:o("toast.error.copy-fail.title"),description:o("toast.error.copy-fail.desc")})}))}),[t,n,o])}async function DM(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"png",o=arguments.length>3?arguments[3]:void 0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};if(!o&&(o="shapes at ".concat(RM()),1===t.length)){const n=e.getShape(t[0]);o=e.isShapeOfType(n,"frame")?n.props.name||"frame":"".concat(Ds(n.id)," at ").concat(RM())}o+=".".concat(n);const i=await TM({editor:e,ids:t,format:n,opts:r});!function(e){const t=document.createElement("a"),n=URL.createObjectURL(e);t.href=n,t.download=e.name,t.click(),URL.revokeObjectURL(n)}(new File([i],o,{type:i.type}))}function RM(){const e=new Date,t=String(e.getFullYear()).slice(2),n=String(e.getMonth()+1).padStart(2,"0"),o=String(e.getDate()).padStart(2,"0"),r=String(e.getHours()).padStart(2,"0"),i=String(e.getMinutes()).padStart(2,"0"),s=String(e.getSeconds()).padStart(2,"0");return"".concat(t,"-").concat(n,"-").concat(o," ").concat(r,".").concat(i,".").concat(s)}function LM(){const t=Ns(),{addToast:n}=CT(),o=rE();return(0,e.useCallback)((function(e){DM(t,e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:"png",arguments.length>2?arguments[2]:void 0,{scale:1,background:t.getInstanceState().exportBackground}).catch((e=>{console.error(e.message),n({id:"export-fail",title:o("toast.error.export-fail.title"),description:o("toast.error.export-fail.desc"),severity:"error"})}))}),[t,n,o])}const zM=e.createContext([]);function NM(){const{addToast:t,removeToast:n,clearToasts:o}=CT(),{addDialog:r,clearDialogs:i,removeDialog:s}=_j(),a=rE(),l=function(){const t=Ns(),n=(0,e.useRef)(),o=ud(e.useContext(zM));return(0,e.useEffect)((()=>{var e;const r=window.document.createElement("input");async function i(e){const n=e.target.files;n&&0!==n.length&&(t.markHistoryStoppingPoint("insert media"),await t.putExternalContent({type:"files",files:Array.from(n),point:t.getViewportPageBounds().center,ignoreParent:!1}),r.value="")}return r.type="file",r.accept=null!==(e=null===o||void 0===o?void 0:o.join(","))&&void 0!==e?e:se,r.multiple=!0,n.current=r,r.addEventListener("change",i),()=>{n.current=void 0,r.removeEventListener("change",i)}}),[t,o]),(0,e.useCallback)((()=>{var e;null===(e=n.current)||void 0===e||e.click()}),[n])}(),c=function(){const t=Ns(),n=(0,e.useRef)(null),o=(0,e.useRef)(null);return(0,e.useCallback)((async function(){const e=document.createElement("div"),r=document.createElement("style"),i=(e,t)=>{e&&(e.innerHTML=""),t&&document.head.contains(t)&&document.head.removeChild(t),e&&document.body.contains(e)&&document.body.removeChild(e)};i(n.current,o.current),n.current=e,o.current=r;const s="tl-print-surface-".concat($());e.className=s,r.innerHTML="\n\t\t\t.".concat(s," {\n\t\t\t\tdisplay: none;\n\t\t\t}\n\n\t\t\t.").concat(s," svg {\n\t\t\t\tmax-width: 100%;\n\t\t\t\theight: 100%;\n\t\t\t\tdisplay: block;\n\t\t\t}\n\n\t\t\t@media print {\t\t\t\t  \n\t\t\t\thtml, body {\n\t\t\t\t\tmin-height: 100%;\n\t\t\t\t\theight: 100%;\n\t\t\t\t\tmargin: 0;\n\t\t\t\t}\n\n\t\t\t\tbody {\n\t\t\t\t\tposition: relative;\n\t\t\t\t}\n\n\t\t\t\tbody > * {\n\t\t\t\t\tdisplay: none;\n\t\t\t\t}\n\n\t\t\t\t.tldraw__editor {\n\t\t\t\t\tdisplay: none;\n\t\t\t\t}\n\n\t\t\t\t.").concat(s," {\n\t\t\t\t\tdisplay: block !important;\n\t\t\t\t\tbackground: white;\n\t\t\t\t\tmin-height: 100%;\n\t\t\t\t\theight: 100%;\n\t\t\t\t\tmax-width: 100%;\n\t\t\t\t}\n\n\t\t\t\t.").concat(s,"__item {\n\t\t\t\t\tpadding: 10mm;\n\t\t\t\t\tdisplay: flex;\n\t\t\t\t\tmin-height: 100%;\n\t\t\t\t\tflex-direction: column;\n\t\t\t\t\tpage-break-after: always;\n\t\t\t\t\tposition: relative;\n\t\t\t\t\toverflow: hidden;\n\t\t\t\t\theight: 100%;\n\t\t\t\t}\n\n\t\t\t\t.").concat(s,"__item__main {\n\t\t\t\t\tflex: 1;\n\t\t\t\t\tdisplay: flex;\n\t\t\t\t\talign-items: center;\n\t\t\t\t\tjustify-content: center;\n\t\t\t\t\tmax-height: 100%;\n\t\t\t\t}\n\n\t\t\t\t.").concat(s,"__item__header {\n\t\t\t\t\tdisplay: none;\n\t\t\t\t}\n\n\t\t\t\t.").concat(s,"__item__footer {\n\t\t\t\t\tdisplay: none;\n\t\t\t\t\ttext-align: right;\n\t\t\t\t}\n\n\t\t\t\t.").concat(s,"__item__footer__hide {\n\t\t\t\t\tdisplay: none;\n\t\t\t\t}\n\n\t\t\t\t").concat("","\n\t\t\t}\n\n\t\t");const a=()=>{document.head.appendChild(r),document.body.appendChild(e)},l=()=>{t.once("tick",(()=>{i(e,r)}))};function c(t,n,o){try{e.innerHTML+='<div class="'.concat(s,'__item">\n        <div class="').concat(s,'__item__header">\n          ').concat(t.replace(/</g,"&lt;").replace(/>/g,"&gt;"),'\n        </div>\n        <div class="').concat(s,'__item__main">\n          ').concat(o,'\n        </div>\n        <div class="').concat(s,"__item__footer ").concat(s,"__item__footer__").concat(n?"":"hide",'">\n          ').concat(null!==n&&void 0!==n?n:"","\n        </div>\n      </div>")}catch(r){console.error(r)}}function d(){ka.isChromeForIos?(a(),window.print()):ka.isSafari?(a(),document.execCommand("print",!1)):window.print()}window.addEventListener("beforeprint",a),window.addEventListener("afterprint",l);const u=t.getSelectedShapeIds(),h=t.getCurrentPageId(),p=t.getPages(),f={scale:1,background:!1,darkMode:!1,preserveAspectRatio:"xMidYMid meet"};if(t.getSelectedShapeIds().length>0){const e=await t.getSvgString(u,f);if(e){const t=p.find((e=>e.id===h));c("tldraw \u2014 ".concat(null===t||void 0===t?void 0:t.name),null,e.svg),d()}}else{const e=t.getCurrentPage(),n=await t.getSvgString(t.getSortedChildIdsForParent(e.id),f);n&&(c("tldraw \u2014 ".concat(e.name),null,n.svg),d())}window.removeEventListener("beforeprint",a),window.removeEventListener("afterprint",l)}),[t])}(),{cut:d,copy:u,paste:h}=function(){const t=Ns(),n=Zb(),o=(0,e.useCallback)((async function(e){0!==t.getSelectedShapeIds().length&&(await oM(t),n("copy",{source:e}))}),[t,n]),r=(0,e.useCallback)((async function(e){0!==t.getSelectedShapeIds().length&&(await oM(t),t.deleteShapes(t.getSelectedShapeIds()),n("cut",{source:e}))}),[t,n]),i=(0,e.useCallback)((async function(e,o,r){null===t.getEditingShapeId()&&(Array.isArray(e)&&e[0]instanceof ClipboardItem?(tM(t,e,r),n("paste",{source:"menu"})):navigator.clipboard.read().then((e=>{i(e,o,r)})))}),[t,n]);return{copy:o,cut:r,paste:i}}(),p=OM(),f=LM(),g=gj(),m=kj()<wj.TABLET_SM;return(0,e.useMemo)((()=>({addToast:t,removeToast:n,clearToasts:o,addDialog:r,removeDialog:s,clearDialogs:i,msg:a,isMobile:m,insertMedia:l,printSelectionOrPages:c,cut:d,copy:u,paste:h,copyAs:p,exportAs:f,getEmbedDefinition:g})),[t,n,o,r,s,i,a,m,l,c,d,u,h,p,f,g])}function FM(t){return(0,e.useMemo)((()=>t),t)}function BM(t){const n=FM(null==t?[]:Array.isArray(t)?t:[t]);return(0,e.useMemo)((()=>{const e={};for(const t of n)if(t.translations)for(const[n,o]of ge(t.translations)){let t=e[n];t||(t=e[n]={}),Object.assign(t,o)}return e}),[n])}function UM(t){const n=NM(),o=FM(null==t?[]:Array.isArray(t)?t:[t]);return(0,e.useMemo)((()=>function(e,t){const n={};for(const o of e)if(o.translations)for(const[e,t]of ge(o.translations)){let o=n[e];o||(o=n[e]={}),Object.assign(o,t)}return{actions:(t,n,o)=>{for(const r of e)r.actions&&(n=r.actions(t,n,o));return n},tools:(n,o,r)=>{for(const i of e)i.tools&&(o=i.tools(n,o,l(l({},t),r)));return o},translations:n}}(o,n)),[o,n])}const HM=e.createContext(null);function KM(e,t){if(0===e.getSelectedShapes().length)return e.getDocumentSettings().name||t}function VM(t){let{overrides:n,children:o}=t;const r=Ns(),i=vj(),s=NM(),a=Zb(),c=s.msg("document.default-name"),d=e.useMemo((()=>{function e(){return r.isIn("select")||(r.complete(),r.setCurrentTool("select")),!1}function t(){return r.isIn("select")&&r.getSelectedShapeIds().length>0}const o=[{id:"edit-link",label:"action.edit-link",icon:"link",onSelect(n){t()&&(e()||(a("edit-link",{source:n}),r.markHistoryStoppingPoint("edit-link"),s.addDialog({component:lj})))}},{id:"insert-embed",label:"action.insert-embed",kbd:"$i",onSelect(e){a("insert-embed",{source:e}),s.addDialog({component:mj})}},{id:"insert-media",label:"action.insert-media",kbd:"$u",onSelect(e){a("insert-media",{source:e}),s.insertMedia()}},{id:"undo",label:"action.undo",icon:"undo",kbd:"$z",onSelect(e){a("undo",{source:e}),r.undo()}},{id:"redo",label:"action.redo",icon:"redo",kbd:"$!z",onSelect(e){a("redo",{source:e}),r.redo()}},{id:"export-as-svg",label:{default:"action.export-as-svg",menu:"action.export-as-svg.short","context-menu":"action.export-as-svg.short"},readonlyOk:!0,onSelect(e){let t=r.getSelectedShapeIds();0===t.length&&(t=Array.from(r.getCurrentPageShapeIds().values())),0!==t.length&&(a("export-as",{format:"svg",source:e}),s.exportAs(t,"svg",KM(r,c)))}},{id:"export-as-png",label:{default:"action.export-as-png",menu:"action.export-as-png.short","context-menu":"action.export-as-png.short"},readonlyOk:!0,onSelect(e){let t=r.getSelectedShapeIds();0===t.length&&(t=Array.from(r.getCurrentPageShapeIds().values())),0!==t.length&&(a("export-as",{format:"png",source:e}),s.exportAs(t,"png",KM(r,c)))}},{id:"export-as-json",label:{default:"action.export-as-json",menu:"action.export-as-json.short","context-menu":"action.export-as-json.short"},readonlyOk:!0,onSelect(e){let t=r.getSelectedShapeIds();0===t.length&&(t=Array.from(r.getCurrentPageShapeIds().values())),0!==t.length&&(a("export-as",{format:"json",source:e}),s.exportAs(t,"json",KM(r,c)))}},{id:"export-all-as-svg",label:{default:"action.export-all-as-svg",menu:"action.export-all-as-svg.short","context-menu":"action.export-all-as-svg.short"},readonlyOk:!0,onSelect(e){let t=r.getSelectedShapeIds();0===t.length&&(t=Array.from(r.getCurrentPageShapeIds().values())),0!==t.length&&(a("export-all-as",{format:"svg",source:e}),s.exportAs(Array.from(r.getCurrentPageShapeIds()),"svg",KM(r,c)))}},{id:"export-all-as-png",label:{default:"action.export-all-as-png",menu:"action.export-all-as-png.short","context-menu":"action.export-all-as-png.short"},readonlyOk:!0,onSelect(e){const t=Array.from(r.getCurrentPageShapeIds().values());0!==t.length&&(a("export-all-as",{format:"png",source:e}),s.exportAs(t,"png",KM(r,c)))}},{id:"export-all-as-json",label:{default:"action.export-all-as-json",menu:"action.export-all-as-json.short","context-menu":"action.export-all-as-json.short"},readonlyOk:!0,onSelect(e){const t=Array.from(r.getCurrentPageShapeIds().values());0!==t.length&&(a("export-all-as",{format:"json",source:e}),s.exportAs(t,"json",KM(r,c)))}},{id:"copy-as-svg",label:{default:"action.copy-as-svg",menu:"action.copy-as-svg.short","context-menu":"action.copy-as-svg.short"},kbd:"$!c",readonlyOk:!0,onSelect(e){let t=r.getSelectedShapeIds();0===t.length&&(t=Array.from(r.getCurrentPageShapeIds().values())),0!==t.length&&(a("copy-as",{format:"svg",source:e}),s.copyAs(t,"svg"))}},{id:"copy-as-png",label:{default:"action.copy-as-png",menu:"action.copy-as-png.short","context-menu":"action.copy-as-png.short"},readonlyOk:!0,onSelect(e){let t=r.getSelectedShapeIds();0===t.length&&(t=Array.from(r.getCurrentPageShapeIds().values())),0!==t.length&&(a("copy-as",{format:"png",source:e}),s.copyAs(t,"png"))}},{id:"copy-as-json",label:{default:"action.copy-as-json",menu:"action.copy-as-json.short","context-menu":"action.copy-as-json.short"},readonlyOk:!0,onSelect(e){let t=r.getSelectedShapeIds();0===t.length&&(t=Array.from(r.getCurrentPageShapeIds().values())),0!==t.length&&(a("copy-as",{format:"json",source:e}),s.copyAs(t,"json"))}},{id:"toggle-auto-size",label:"action.toggle-auto-size",onSelect(n){if(!t())return;if(e())return;a("toggle-auto-size",{source:n}),r.markHistoryStoppingPoint("toggling auto size");const o=r.getSelectedShapes().filter((e=>r.isShapeOfType(e,"text")&&!1===e.props.autoSize));r.updateShapes(o.map((e=>({id:e.id,type:e.type,props:l(l({},e.props),{},{w:8,autoSize:!0})})))),WI(r,o.map((e=>e.id)))}},{id:"open-embed-link",label:"action.open-embed-link",readonlyOk:!0,onSelect(e){a("open-embed-link",{source:e});const t=r.getSelectedShapeIds(),n="No embed shapes selected";if(1!==t.length)return void console.error(n);const o=r.getShape(t[0]);o&&r.isShapeOfType(o,"embed")?function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"_blank";yd.openWindow(e,t)}(o.props.url,"_blank"):console.error(n)}},{id:"select-zoom-tool",readonlyOk:!0,kbd:"z",onSelect(e){var t;if("zoom"!==(null===(t=r.root.getCurrent())||void 0===t?void 0:t.id)&&(a("zoom-tool",{source:e}),!r.inputs.shiftKey&&!r.inputs.ctrlKey)){var n;const e=r.root.getCurrent();e&&"idle"===(null===(n=e.getCurrent())||void 0===n?void 0:n.id)&&r.setCurrentTool("zoom",{onInteractionEnd:e.id,maskAs:"zoom"})}}},{id:"convert-to-bookmark",label:"action.convert-to-bookmark",onSelect(n){t()&&(e()||r.run((()=>{a("convert-to-bookmark",{source:n});const e=r.getSelectedShapes(),t=[],o=[];for(const n of e){if(!n||!r.isShapeOfType(n,"embed")||!n.props.url)continue;const e=new Vs(n.x,n.y);e.rot(-n.rotation),e.add(new Vs(n.props.w/2-150,n.props.h/2-160)),e.rot(n.rotation);const i={id:Ko(),type:"bookmark",rotation:n.rotation,x:e.x,y:e.y,opacity:1,props:{url:n.props.url}};t.push(i),o.push(n.id)}r.markHistoryStoppingPoint("convert shapes to bookmark"),r.deleteShapes(o),r.createShapes(t)})))}},{id:"convert-to-embed",label:"action.convert-to-embed",onSelect(n){t()&&(e()||(a("convert-to-embed",{source:n}),r.run((()=>{const e=C(r.getSelectedShapeIds().map((e=>r.getShape(e)))),t=[],n=[];for(const o of e){if(!r.isShapeOfType(o,"bookmark"))continue;const{url:e}=o.props,i=s.getEmbedDefinition(e);if(!i)continue;if(!i.definition)continue;const{width:a,height:l}=i.definition,c=new Vs(o.x,o.y);c.rot(-o.rotation),c.add(new Vs(o.props.w/2-a/2,o.props.h/2-l/2)),c.rot(o.rotation);const d={id:Ko(),type:"embed",x:c.x,y:c.y,rotation:o.rotation,props:{url:e,w:a,h:l}};t.push(d),n.push(o.id)}r.markHistoryStoppingPoint("convert shapes to embed"),r.deleteShapes(n),r.createShapes(t)}))))}},{id:"duplicate",kbd:"$d",label:"action.duplicate",icon:"duplicate",onSelect(n){if(!t())return;if(e())return;a("duplicate-shapes",{source:n});const o=r.getInstanceState();let i,s;if(o.duplicateProps)i=o.duplicateProps.shapeIds,s=o.duplicateProps.offset;else{i=r.getSelectedShapeIds();const e=rc.Common(C(i.map((e=>r.getShapePageBounds(e)))));s=r.getCameraOptions().isLocked?{x:r.options.adjacentShapeMargin,y:r.options.adjacentShapeMargin}:{x:e.width+r.options.adjacentShapeMargin,y:0}}r.markHistoryStoppingPoint("duplicate shapes"),r.duplicateShapes(i,s),o.duplicateProps&&r.updateInstanceState({duplicateProps:l(l({},o.duplicateProps),{},{shapeIds:r.getSelectedShapeIds()})})}},{id:"ungroup",label:"action.ungroup",kbd:"$!g",icon:"ungroup",onSelect(n){t()&&(e()||(a("ungroup-shapes",{source:n}),r.markHistoryStoppingPoint("ungroup"),r.ungroupShapes(r.getSelectedShapeIds())))}},{id:"group",label:"action.group",kbd:"$g",icon:"group",onSelect(n){if(!t())return;if(e())return;a("group-shapes",{source:n});const o=r.getOnlySelectedShape();o&&r.isShapeOfType(o,"group")?(r.markHistoryStoppingPoint("ungroup"),r.ungroupShapes(r.getSelectedShapeIds())):(r.markHistoryStoppingPoint("group"),r.groupShapes(r.getSelectedShapeIds()))}},{id:"remove-frame",label:"action.remove-frame",kbd:"$!f",onSelect(e){if(!t())return;a("remove-frame",{source:e});const n=r.getSelectedShapes();n.length>0&&n.every((e=>r.isShapeOfType(e,"frame")))&&(r.markHistoryStoppingPoint("remove-frame"),function(e,t){const n=C(t.map((t=>e.getShape(t))).filter((t=>t&&e.isShapeOfType(t,"frame"))));if(!n.length)return;const o=[];e.run((()=>{n.map((t=>{const n=e.getSortedChildIdsForParent(t.id);n.length&&(e.reparentShapes(n,t.parentId,t.index),o.push(...n))})),e.setSelectedShapes(o),e.deleteShapes(t)}))}(r,n.map((e=>e.id))))}},{id:"fit-frame-to-content",label:"action.fit-frame-to-content",onSelect(e){if(!t())return;a("fit-frame-to-content",{source:e});const n=r.getOnlySelectedShape();n&&r.isShapeOfType(n,"frame")&&(r.markHistoryStoppingPoint("fit-frame-to-content"),function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const o=e.getShape(t);if(!o)return;const r=e.getSortedChildIdsForParent(o.id),i=C(r.map((t=>e.getShape(t))));if(!i.length)return;const s=rc.FromPoints(i.flatMap((t=>{const n=e.getShapeGeometry(t.id);return e.getShapeLocalTransform(t).applyToPoints(n.vertices)}))),{padding:a=GI}=n,l=s.w+2*a,c=s.h+2*a,d=a-s.minX,u=a-s.minY;if(0===d&&0===u&&o.props.w===l&&o.props.h===c)return;const h=new Vs(d,u).rot(o.rotation);e.run((()=>{const t=r.map((t=>{const n=e.getShape(t);return{id:n.id,type:n.type,x:n.x+d,y:n.y+u}}));t.push({id:o.id,type:o.type,x:o.x-h.x,y:o.y-h.y,props:{w:l,h:c}}),e.updateShapes(t)}))}(r,n.id))}},{id:"align-left",label:"action.align-left",kbd:"?A",icon:"align-left",onSelect(n){if(!t())return;if(e())return;a("align-shapes",{operation:"left",source:n}),r.markHistoryStoppingPoint("align left");const o=r.getSelectedShapeIds();r.alignShapes(o,"left"),WI(r,o)}},{id:"align-center-horizontal",label:{default:"action.align-center-horizontal","context-menu":"action.align-center-horizontal.short"},kbd:"?H",icon:"align-center-horizontal",onSelect(n){if(!t())return;if(e())return;a("align-shapes",{operation:"center-horizontal",source:n}),r.markHistoryStoppingPoint("align center horizontal");const o=r.getSelectedShapeIds();r.alignShapes(o,"center-horizontal"),WI(r,o)}},{id:"align-right",label:"action.align-right",kbd:"?D",icon:"align-right",onSelect(n){if(!t())return;if(e())return;a("align-shapes",{operation:"right",source:n}),r.markHistoryStoppingPoint("align right");const o=r.getSelectedShapeIds();r.alignShapes(o,"right"),WI(r,o)}},{id:"align-center-vertical",label:{default:"action.align-center-vertical","context-menu":"action.align-center-vertical.short"},kbd:"?V",icon:"align-center-vertical",onSelect(n){if(!t())return;if(e())return;a("align-shapes",{operation:"center-vertical",source:n}),r.markHistoryStoppingPoint("align center vertical");const o=r.getSelectedShapeIds();r.alignShapes(o,"center-vertical"),WI(r,o)}},{id:"align-top",label:"action.align-top",icon:"align-top",kbd:"?W",onSelect(n){if(!t())return;if(e())return;a("align-shapes",{operation:"top",source:n}),r.markHistoryStoppingPoint("align top");const o=r.getSelectedShapeIds();r.alignShapes(o,"top"),WI(r,o)}},{id:"align-bottom",label:"action.align-bottom",icon:"align-bottom",kbd:"?S",onSelect(n){if(!t())return;if(e())return;a("align-shapes",{operation:"bottom",source:n}),r.markHistoryStoppingPoint("align bottom");const o=r.getSelectedShapeIds();r.alignShapes(o,"bottom"),WI(r,o)}},{id:"distribute-horizontal",label:{default:"action.distribute-horizontal","context-menu":"action.distribute-horizontal.short"},icon:"distribute-horizontal",kbd:"?!h",onSelect(n){if(!t())return;if(e())return;a("distribute-shapes",{operation:"horizontal",source:n}),r.markHistoryStoppingPoint("distribute horizontal");const o=r.getSelectedShapeIds();r.distributeShapes(o,"horizontal"),WI(r,o)}},{id:"distribute-vertical",label:{default:"action.distribute-vertical","context-menu":"action.distribute-vertical.short"},icon:"distribute-vertical",kbd:"?!V",onSelect(n){if(!t())return;if(e())return;a("distribute-shapes",{operation:"vertical",source:n}),r.markHistoryStoppingPoint("distribute vertical");const o=r.getSelectedShapeIds();r.distributeShapes(o,"vertical"),WI(r,o)}},{id:"stretch-horizontal",label:{default:"action.stretch-horizontal","context-menu":"action.stretch-horizontal.short"},icon:"stretch-horizontal",onSelect(n){if(!t())return;if(e())return;a("stretch-shapes",{operation:"horizontal",source:n}),r.markHistoryStoppingPoint("stretch horizontal");const o=r.getSelectedShapeIds();r.stretchShapes(o,"horizontal"),WI(r,o)}},{id:"stretch-vertical",label:{default:"action.stretch-vertical","context-menu":"action.stretch-vertical.short"},icon:"stretch-vertical",onSelect(n){if(!t())return;if(e())return;a("stretch-shapes",{operation:"vertical",source:n}),r.markHistoryStoppingPoint("stretch vertical");const o=r.getSelectedShapeIds();r.stretchShapes(o,"vertical"),WI(r,o)}},{id:"flip-horizontal",label:{default:"action.flip-horizontal","context-menu":"action.flip-horizontal.short"},kbd:"!h",onSelect(n){if(!t())return;if(e())return;a("flip-shapes",{operation:"horizontal",source:n}),r.markHistoryStoppingPoint("flip horizontal");const o=r.getSelectedShapeIds();r.flipShapes(o,"horizontal"),WI(r,o)}},{id:"flip-vertical",label:{default:"action.flip-vertical","context-menu":"action.flip-vertical.short"},kbd:"!v",onSelect(n){if(!t())return;if(e())return;a("flip-shapes",{operation:"vertical",source:n}),r.markHistoryStoppingPoint("flip vertical");const o=r.getSelectedShapeIds();r.flipShapes(o,"vertical"),WI(r,o)}},{id:"pack",label:"action.pack",icon:"pack",onSelect(n){if(!t())return;if(e())return;a("pack-shapes",{source:n}),r.markHistoryStoppingPoint("pack");const o=r.getSelectedShapeIds();r.packShapes(o,r.options.adjacentShapeMargin),WI(r,o)}},{id:"stack-vertical",label:{default:"action.stack-vertical","context-menu":"action.stack-vertical.short"},icon:"stack-vertical",onSelect(n){if(!t())return;if(e())return;a("stack-shapes",{operation:"vertical",source:n}),r.markHistoryStoppingPoint("stack-vertical");const o=r.getSelectedShapeIds();r.stackShapes(o,"vertical",16),WI(r,o)}},{id:"stack-horizontal",label:{default:"action.stack-horizontal","context-menu":"action.stack-horizontal.short"},icon:"stack-horizontal",onSelect(n){if(!t())return;if(e())return;a("stack-shapes",{operation:"horizontal",source:n}),r.markHistoryStoppingPoint("stack-horizontal");const o=r.getSelectedShapeIds();r.stackShapes(o,"horizontal",16),WI(r,o)}},{id:"bring-to-front",label:"action.bring-to-front",kbd:"]",icon:"bring-to-front",onSelect(n){t()&&(e()||(a("reorder-shapes",{operation:"toFront",source:n}),r.markHistoryStoppingPoint("bring to front"),r.bringToFront(r.getSelectedShapeIds())))}},{id:"bring-forward",label:"action.bring-forward",icon:"bring-forward",kbd:"?]",onSelect(n){t()&&(e()||(a("reorder-shapes",{operation:"forward",source:n}),r.markHistoryStoppingPoint("bring forward"),r.bringForward(r.getSelectedShapeIds())))}},{id:"send-backward",label:"action.send-backward",icon:"send-backward",kbd:"?[",onSelect(n){t()&&(e()||(a("reorder-shapes",{operation:"backward",source:n}),r.markHistoryStoppingPoint("send backward"),r.sendBackward(r.getSelectedShapeIds())))}},{id:"send-to-back",label:"action.send-to-back",icon:"send-to-back",kbd:"[",onSelect(n){t()&&(e()||(a("reorder-shapes",{operation:"toBack",source:n}),r.markHistoryStoppingPoint("send to back"),r.sendToBack(r.getSelectedShapeIds())))}},{id:"cut",label:"action.cut",kbd:"$x",onSelect(n){t()&&(e()||(r.markHistoryStoppingPoint("cut"),s.cut(n)))}},{id:"copy",label:"action.copy",kbd:"$c",readonlyOk:!0,onSelect(n){t()&&(e()||s.copy(n))}},{id:"paste",label:"action.paste",kbd:"$v",onSelect(e){var t;null===(t=navigator.clipboard)||void 0===t||t.read().then((t=>{s.paste(t,e,"context-menu"===e?r.inputs.currentPagePoint:void 0)})).catch((()=>{s.addToast({title:s.msg("action.paste-error-title"),description:s.msg("action.paste-error-description"),severity:"error"})}))}},{id:"select-all",label:"action.select-all",kbd:"$a",readonlyOk:!0,onSelect(t){r.run((()=>{e()||(a("select-all-shapes",{source:t}),r.markHistoryStoppingPoint("select all kbd"),r.selectAll())}))}},{id:"select-none",label:"action.select-none",readonlyOk:!0,onSelect(n){t()&&(e()||(a("select-none-shapes",{source:n}),r.markHistoryStoppingPoint("select none"),r.selectNone()))}},{id:"delete",label:"action.delete",kbd:"\u232b,del,backspace",icon:"trash",onSelect(n){t()&&(e()||(a("delete-shapes",{source:n}),r.markHistoryStoppingPoint("delete"),r.deleteShapes(r.getSelectedShapeIds())))}},{id:"rotate-cw",label:"action.rotate-cw",icon:"rotate-cw",onSelect(n){if(!t())return;if(e())return;a("rotate-cw",{source:n}),r.markHistoryStoppingPoint("rotate-cw");const o=r.getSelectionRotation()%(Xs/2),i=ea(o,0)||ea(o,Xs/2),s=r.getSelectedShapeIds();r.rotateShapesBy(s,Xs/2-(i?0:o)),WI(r,s)}},{id:"rotate-ccw",label:"action.rotate-ccw",icon:"rotate-ccw",onSelect(n){if(!t())return;if(e())return;a("rotate-ccw",{source:n}),r.markHistoryStoppingPoint("rotate-ccw");const o=r.getSelectionRotation()%(Xs/2),i=ea(o,0),s=r.getSelectedShapeIds();r.rotateShapesBy(s,i?-Xs/2:-o),WI(r,s)}},{id:"zoom-in",label:"action.zoom-in",kbd:"$=,=",readonlyOk:!0,onSelect(e){a("zoom-in",{source:e}),r.zoomIn(void 0,{animation:{duration:r.options.animationMediumMs}})}},{id:"zoom-out",label:"action.zoom-out",kbd:"$-,-",readonlyOk:!0,onSelect(e){a("zoom-out",{source:e}),r.zoomOut(void 0,{animation:{duration:r.options.animationMediumMs}})}},{id:"zoom-to-100",label:"action.zoom-to-100",icon:"reset-zoom",kbd:"!0",readonlyOk:!0,onSelect(e){a("reset-zoom",{source:e}),r.resetZoom(void 0,{animation:{duration:r.options.animationMediumMs}})}},{id:"zoom-to-fit",label:"action.zoom-to-fit",kbd:"!1",readonlyOk:!0,onSelect(e){a("zoom-to-fit",{source:e}),r.zoomToFit({animation:{duration:r.options.animationMediumMs}})}},{id:"zoom-to-selection",label:"action.zoom-to-selection",kbd:"!2",readonlyOk:!0,onSelect(n){t()&&(e()||(a("zoom-to-selection",{source:n}),r.zoomToSelection({animation:{duration:r.options.animationMediumMs}})))}},{id:"toggle-snap-mode",label:{default:"action.toggle-snap-mode",menu:"action.toggle-snap-mode.menu"},onSelect(e){a("toggle-snap-mode",{source:e}),r.user.updateUserPreferences({isSnapMode:!r.user.getIsSnapMode()})},checkbox:!0},{id:"toggle-dark-mode",label:{default:"action.toggle-dark-mode",menu:"action.toggle-dark-mode.menu"},kbd:"$/",readonlyOk:!0,onSelect(e){const t=r.user.getIsDarkMode()?"light":"dark";a("color-scheme",{source:e,value:t}),r.user.updateUserPreferences({colorScheme:t})},checkbox:!0},{id:"toggle-wrap-mode",label:{default:"action.toggle-wrap-mode",menu:"action.toggle-wrap-mode.menu"},readonlyOk:!0,onSelect(e){a("toggle-wrap-mode",{source:e}),r.user.updateUserPreferences({isWrapMode:!r.user.getIsWrapMode()})},checkbox:!0},{id:"toggle-dynamic-size-mode",label:{default:"action.toggle-dynamic-size-mode",menu:"action.toggle-dynamic-size-mode.menu"},readonlyOk:!1,onSelect(e){a("toggle-dynamic-size-mode",{source:e}),r.user.updateUserPreferences({isDynamicSizeMode:!r.user.getIsDynamicResizeMode()})},checkbox:!0},{id:"toggle-paste-at-cursor",label:{default:"action.toggle-paste-at-cursor",menu:"action.toggle-paste-at-cursor.menu"},readonlyOk:!1,onSelect(e){a("toggle-paste-at-cursor",{source:e}),r.user.updateUserPreferences({isPasteAtCursorMode:!r.user.getIsPasteAtCursorMode()})},checkbox:!0},{id:"toggle-reduce-motion",label:{default:"action.toggle-reduce-motion",menu:"action.toggle-reduce-motion.menu"},readonlyOk:!0,onSelect(e){a("toggle-reduce-motion",{source:e}),r.user.updateUserPreferences({animationSpeed:0===r.user.getAnimationSpeed()?1:0})},checkbox:!0},{id:"toggle-edge-scrolling",label:{default:"action.toggle-edge-scrolling",menu:"action.toggle-edge-scrolling.menu"},readonlyOk:!0,onSelect(e){a("toggle-edge-scrolling",{source:e}),r.user.updateUserPreferences({edgeScrollSpeed:0===r.user.getEdgeScrollSpeed()?1:0})},checkbox:!0},{id:"toggle-transparent",label:{default:"action.toggle-transparent",menu:"action.toggle-transparent.menu","context-menu":"action.toggle-transparent.context-menu"},readonlyOk:!0,onSelect(e){a("toggle-transparent",{source:e}),r.updateInstanceState({exportBackground:!r.getInstanceState().exportBackground})},checkbox:!0},{id:"toggle-tool-lock",label:{default:"action.toggle-tool-lock",menu:"action.toggle-tool-lock.menu"},kbd:"q",onSelect(e){a("toggle-tool-lock",{source:e}),r.updateInstanceState({isToolLocked:!r.getInstanceState().isToolLocked})},checkbox:!0},{id:"unlock-all",label:"action.unlock-all",onSelect(e){a("unlock-all",{source:e});const t=[];for(const n of r.getCurrentPageShapes())n.isLocked&&t.push({id:n.id,type:n.type,isLocked:!1});t.length>0&&r.updateShapes(t)}},{id:"toggle-focus-mode",label:{default:"action.toggle-focus-mode",menu:"action.toggle-focus-mode.menu"},readonlyOk:!0,kbd:"$.",checkbox:!0,onSelect(e){r.timers.requestAnimationFrame((()=>{r.run((()=>{a("toggle-focus-mode",{source:e}),s.clearDialogs(),s.clearToasts(),r.updateInstanceState({isFocusMode:!r.getInstanceState().isFocusMode})}))}))}},{id:"toggle-grid",label:{default:"action.toggle-grid",menu:"action.toggle-grid.menu"},readonlyOk:!0,kbd:"$'",onSelect(e){a("toggle-grid-mode",{source:e}),r.updateInstanceState({isGridMode:!r.getInstanceState().isGridMode})},checkbox:!0},{id:"toggle-debug-mode",label:{default:"action.toggle-debug-mode",menu:"action.toggle-debug-mode.menu"},readonlyOk:!0,onSelect(e){a("toggle-debug-mode",{source:e}),r.updateInstanceState({isDebugMode:!r.getInstanceState().isDebugMode})},checkbox:!0},{id:"print",label:"action.print",kbd:"$p",readonlyOk:!0,onSelect(e){a("print",{source:e}),s.printSelectionOrPages()}},{id:"exit-pen-mode",label:"action.exit-pen-mode",icon:"cross-2",readonlyOk:!0,onSelect(e){a("exit-pen-mode",{source:e}),r.updateInstanceState({isPenMode:!1})}},{id:"stop-following",label:"action.stop-following",icon:"cross-2",readonlyOk:!0,onSelect(e){a("stop-following",{source:e}),r.stopFollowingUser()}},{id:"back-to-content",label:"action.back-to-content",icon:"arrow-left",readonlyOk:!0,onSelect(e){var t;a("zoom-to-content",{source:e});const n=null!==(t=r.getSelectionPageBounds())&&void 0!==t?t:r.getCurrentPageBounds();n&&r.zoomToBounds(n,{targetZoom:Math.min(1,r.getZoomLevel()),animation:{duration:220}})}},{id:"toggle-lock",label:"action.toggle-lock",kbd:"!l",onSelect(e){r.markHistoryStoppingPoint("locking"),a("toggle-lock",{source:e}),r.toggleLock(r.getSelectedShapeIds())}},{id:"move-to-new-page",label:"context.pages.new-page",onSelect(e){const t=_r.createId(),n=r.getSelectedShapeIds();r.run((()=>{r.markHistoryStoppingPoint("move_shapes_to_page"),r.createPage({name:s.msg("page-menu.new-page-initial-name"),id:t}),r.moveShapesToPage(n,t)})),a("move-to-new-page",{source:e})}},{id:"select-white-color",label:"color-style.white",kbd:"?t",onSelect(e){const t=Qo;r.run((()=>{r.markHistoryStoppingPoint("change-color"),r.isIn("select")&&r.setStyleForSelectedShapes(t,"white"),r.setStyleForNextShapes(t,"white")})),a("set-style",{source:e,id:t.id,value:"white"})}},{id:"select-fill-fill",label:"fill-style.fill",kbd:"?f",onSelect(e){const t=tr;r.run((()=>{r.markHistoryStoppingPoint("change-fill"),r.isIn("select")&&r.setStyleForSelectedShapes(t,"fill"),r.setStyleForNextShapes(t,"fill")})),a("set-style",{source:e,id:t.id,value:"fill"})}},{id:"flatten-to-image",label:"action.flatten-to-image",kbd:"!f",onSelect:async e=>{const t=r.getSelectedShapeIds();if(0===t.length)return;r.markHistoryStoppingPoint("flattening to image"),a("flatten-to-image",{source:e});const n=await yj(r,t,r.options.flattenImageBoundsExpand);null!==n&&void 0!==n&&n.length&&r.setSelectedShapes(n)}}];i&&o.push({id:"open-cursor-chat",label:"action.open-cursor-chat",readonlyOk:!0,kbd:"/",onSelect(e){a("open-cursor-chat",{source:e}),r.getInstanceState().isCoarsePointer||r.timers.requestAnimationFrame((()=>{r.updateInstanceState({isChatting:!0})}))}});const d=function(e){return Object.fromEntries(e.map((e=>[e.id,e])))}(o);return n?n(r,d,s):d}),[s,r,a,n,c,i]);return(0,Ss.jsx)(HM.Provider,{value:d,children:o})}function WM(){const t=e.useContext(HM);if(!t)throw new Error("useTools must be used within a ToolProvider");return t}function qM(e,t){var n;return e?"string"===typeof e?e:t?null!==(n=e[t])&&void 0!==n?n:e.default:void 0:void 0}function YM(){const e=Fs();return yn("isReadonlyMode",(()=>!(null===e||void 0===e||!e.getIsReadonly())),[e])}const GM=ka.isDarwin?"\u2318":"Ctrl",XM=ka.isDarwin?"\u2325":"Alt";function $M(e){return","===e?[","]:e.split(",")[0].split("").map((e=>{const t=e.replace(/\$/g,GM).replace(/\?/g,XM).replace(/!/g,"\u21e7");return t[0].toUpperCase()+t.slice(1)}))}function ZM(e){return"\u2014 "+$M(e).join("\u2009")}function QM(e){let{children:t,visibleOnMobileLayout:n=!1}=e;const o=kj();return!n&&o<wj.MOBILE?null:(0,Ss.jsx)("kbd",{className:"tlui-kbd",children:$M(t).map(((e,t)=>(0,Ss.jsx)("span",{children:e},t)))})}const JM=(0,e.createContext)(null);function eA(){const t=(0,e.useContext)(JM);if(!t)throw new Error("useTldrawUiMenuContext must be used within a TldrawUiMenuContextProvider");return t}function tA(e){let{type:t,sourceId:n,children:o}=e;return(0,Ss.jsx)(JM.Provider,{value:{type:t,sourceId:n},children:o})}function nA(e){let{id:t,kbd:n,label:o,readonlyOk:r,onSelect:i,toggle:s=!1,disabled:a=!1,checked:l=!1}=e;const{type:c,sourceId:d}=eA(),u=YM(),h=rE();if(u&&!r)return null;const p=qM(o,c),f=p?h(p):void 0;switch(c){case"menu":return(0,Ss.jsxs)(UI,{dir:"ltr",className:"tlui-button tlui-button__menu tlui-button__checkbox",title:f,onSelect:e=>{null===i||void 0===i||i(d),Da(e)},disabled:a,checked:l,children:[(0,Ss.jsx)(JE,{small:!0,icon:s?l?"toggle-on":"toggle-off":l?"check":"none"}),f&&(0,Ss.jsx)("span",{className:"tlui-button__label",draggable:!1,children:f}),n&&(0,Ss.jsx)(QM,{children:n})]});case"context-menu":return(0,Ss.jsxs)(Z_,{className:"tlui-button tlui-button__menu tlui-button__checkbox",dir:"ltr",title:f,onSelect:e=>{i(d),Da(e)},disabled:a,checked:l,children:[(0,Ss.jsx)(JE,{small:!0,icon:s?l?"toggle-on":"toggle-off":l?"check":"none"}),f&&(0,Ss.jsx)("span",{className:"tlui-button__label",draggable:!1,children:f}),n&&(0,Ss.jsx)(QM,{children:n})]},t);default:return null}}function oA(t,n){const o=Fs(),r=(0,e.useCallback)((e=>{e&&(null===o||void 0===o||o.complete()),null===n||void 0===n||n(e)}),[o,n]),i=Zb(),s=(0,e.useCallback)((e=>{i(e,{source:"unknown",id:t})}),[t,i]);return function(t,n,o){const r=(0,e.useRef)(!1),i=(0,e.useCallback)((e=>{r.current=e,e?Qh.addOpenMenu(t):Qh.deleteOpenMenu(t),null===n||void 0===n||n(e)}),[t,n]),s=yn("is menu open",(()=>Qh.getOpenMenus().includes(t)),[t]);return(0,e.useEffect)((()=>(r.current&&(null===o||void 0===o||o("open-menu"),Qh.addOpenMenu(t)),()=>{r.current&&(Qh.deleteOpenMenu(t),Qh.getOpenMenus().forEach((e=>{e.startsWith(t)&&(null===o||void 0===o||o("close-menu"),Qh.deleteOpenMenu(e))})),r.current=!1)})),[t,o]),[s,i]}(o?"".concat(t,"-").concat(o.contextId):t,r,s)}const rA=["children"];function iA(e){let{id:t,children:n,modal:o=!1,debugOpen:r=!1}=e;const[i,s]=oA(t);return(0,Ss.jsx)(RI,{open:r||i,dir:"ltr",modal:o,onOpenChange:s,children:n})}function sA(e){let{children:t}=e,n=yr(e,rA);return(0,Ss.jsx)(LI,l(l({dir:"ltr",asChild:!0,onTouchEnd:e=>Da(e)},n),{},{children:t}))}function aA(e){let{className:t,side:n="bottom",align:o="start",sideOffset:r=8,alignOffset:i=8,children:s}=e;const a=Va();return(0,Ss.jsx)(zI,{container:a,children:(0,Ss.jsx)(NI,{className:ks("tlui-menu",t),side:n,sideOffset:r,align:o,alignOffset:i,collisionPadding:4,children:s})})}function lA(e){let{id:t,children:n}=e;const[o,r]=oA(t);return(0,Ss.jsx)(HI,{open:o,onOpenChange:r,children:n})}function cA(e){let{id:t,label:n,title:o,disabled:r}=e;return(0,Ss.jsx)(KI,{dir:"ltr",asChild:!0,disabled:r,children:(0,Ss.jsxs)(sE,{"data-testid":t,type:"menu",className:"tlui-menu__submenu__trigger",disabled:r,title:o,children:[(0,Ss.jsx)(aE,{children:n}),(0,Ss.jsx)(ej,{icon:"chevron-right",small:!0})]})})}function dA(e){let{id:t,alignOffset:n=-1,sideOffset:o=-6,size:r="small",children:i}=e;const s=Va();return(0,Ss.jsx)(zI,{container:s,children:(0,Ss.jsx)(VI,{"data-testid":t,className:"tlui-menu tlui-menu__submenu__content",alignOffset:n,sideOffset:o,collisionPadding:4,"data-size":r,children:i})})}function uA(e){let{children:t}=e;return(0,Ss.jsx)(FI,{dir:"ltr",className:"tlui-menu__group",children:t})}function hA(e){let{noClose:t,children:n}=e;return(0,Ss.jsx)(BI,{dir:"ltr",asChild:!0,onClick:t?Da:void 0,children:n})}function pA(e){let{id:t,label:n,children:o}=e;const{type:r,sourceId:i}=eA(),s=rE(),a=qM(n,r),l=a?s(a):void 0;switch(r){case"panel":return(0,Ss.jsx)("div",{className:"tlui-menu__group","data-testid":"".concat(i,"-group.").concat(t),children:o});case"menu":return(0,Ss.jsx)(uA,{"data-testid":"".concat(i,"-group.").concat(t),children:o});case"context-menu":return(0,Ss.jsx)(D_,{dir:"ltr",className:"tlui-menu__group","data-testid":"".concat(i,"-group.").concat(t),children:o});case"keyboard-shortcuts":return(0,Ss.jsxs)("div",{className:"tlui-shortcuts-dialog__group","data-testid":"".concat(i,"-group.").concat(t),children:[(0,Ss.jsx)("h2",{className:"tlui-shortcuts-dialog__group__title",children:l}),(0,Ss.jsx)("div",{className:"tlui-shortcuts-dialog__group__content",children:o})]});default:return o}}function fA(e){var t;let{id:n,disabled:o=!1,label:r,size:i="small",children:s}=e;const{type:a,sourceId:l}=eA(),c=Va(),d=rE(),u=r?"string"===typeof r?r:null!==(t=r[a])&&void 0!==t?t:r.default:void 0,h=u?d(u):void 0;switch(a){case"menu":return(0,Ss.jsxs)(lA,{id:"".concat(l,"-sub.").concat(n),children:[(0,Ss.jsx)(cA,{id:"".concat(l,"-sub.").concat(n,"-button"),disabled:o,label:h,title:h}),(0,Ss.jsx)(dA,{id:"".concat(l,"-sub.").concat(n,"-content"),size:i,children:s})]});case"context-menu":return o?null:(0,Ss.jsxs)(gA,{id:"".concat(l,"-sub.").concat(n),children:[(0,Ss.jsx)(V_,{dir:"ltr",disabled:o,asChild:!0,children:(0,Ss.jsxs)(sE,{"data-testid":"".concat(l,"-sub.").concat(n,"-button"),type:"menu",className:"tlui-menu__submenu__trigger",children:[(0,Ss.jsx)(aE,{children:h}),(0,Ss.jsx)(ej,{icon:"chevron-right",small:!0})]})}),(0,Ss.jsx)(M_,{container:c,children:(0,Ss.jsx)(W_,{"data-testid":"".concat(l,"-sub.").concat(n,"-content"),className:"tlui-menu tlui-menu__submenu__content",alignOffset:-1,sideOffset:-4,collisionPadding:4,"data-size":i,children:s})})]});default:return s}}function gA(e){let{id:t,children:n}=e;const[o,r]=oA(t);return(0,Ss.jsx)(K_,{open:o,onOpenChange:r,children:n})}const mA=[{colorScheme:"light",label:"theme.light"},{colorScheme:"dark",label:"theme.dark"},{colorScheme:"system",label:"theme.system"}];function yA(){const e=Ns(),t=Zb(),n=yn("colorScheme",(()=>{var t;return null!==(t=e.user.getUserPreferences().colorScheme)&&void 0!==t?t:e.user.getIsDarkMode()?"dark":"light"}),[e]);return(0,Ss.jsx)(fA,{id:"help menu color-scheme",label:"menu.theme",children:(0,Ss.jsx)(pA,{id:"theme",children:mA.map((o=>{let{colorScheme:r,label:i}=o;return(0,Ss.jsx)(nA,{id:"color-scheme-".concat(r),label:i,checked:r===n,readonlyOk:!0,onSelect:()=>{e.user.updateUserPreferences({colorScheme:r}),t("color-scheme",{source:"menu",value:r})}},r)}))})})}const vA=t=>{let{id:n,component:o,onClose:r}=t;const{removeDialog:i}=_j(),s=Va(),a=(0,e.useCallback)((e=>{if(!e){if(r)try{r()}catch(EW){console.warn(EW)}i(n)}}),[n,r,i]);return(0,Ss.jsx)(GE,{onOpenChange:a,defaultOpen:!0,children:(0,Ss.jsx)(XE,{container:s,children:(0,Ss.jsx)($E,{dir:"ltr",className:"tlui-dialog__overlay",onClick:e=>{e.target===e.currentTarget&&a(!1)},children:(0,Ss.jsx)(ZE,{dir:"ltr",className:"tlui-dialog__content","aria-describedby":void 0,children:(0,Ss.jsx)(o,{onClose:()=>a(!1)})})})})})},bA=(0,e.memo)((function(){const{dialogs:e}=_j();return yn("dialogs",(()=>e.get()),[e]).map((e=>(0,Ss.jsx)(vA,l({},e),e.id)))})),wA={success:"check-circle",warning:"warning-triangle",error:"cross-circle",info:"info-circle"};function xA(e){var t,n;let{toast:o}=e;const{removeToast:r}=CT(),i=rE(),s=o.actions&&o.actions.length>0,a=o.icon||o.severity&&wA[o.severity];return(0,Ss.jsxs)(vT,{onOpenChange:e=>{e||r(o.id)},className:"tlui-toast__container",duration:o.keepOpen?1/0:4e3,"data-severity":o.severity,children:[a&&(0,Ss.jsx)("div",{className:"tlui-toast__icon",children:(0,Ss.jsx)(JE,{icon:a})}),(0,Ss.jsxs)("div",{className:"tlui-toast__main","data-title":!!o.title,"data-description":!!o.description,"data-actions":!!o.actions,children:[(0,Ss.jsxs)("div",{className:"tlui-toast__content",children:[o.title&&(0,Ss.jsx)(bT,{className:"tlui-toast__title",children:o.title}),o.description&&(0,Ss.jsx)(wT,{className:"tlui-toast__description",children:o.description})]}),o.actions&&(0,Ss.jsxs)("div",{className:"tlui-toast__actions",children:[o.actions.map(((e,t)=>(0,Ss.jsx)(xT,{altText:e.label,asChild:!0,onClick:e.onClick,children:(0,Ss.jsx)(sE,{type:e.type,children:(0,Ss.jsx)(aE,{children:e.label})})},t))),(0,Ss.jsx)(ST,{asChild:!0,children:(0,Ss.jsx)(sE,{type:"normal",className:"tlui-toast__close",style:{marginLeft:"auto"},children:(0,Ss.jsx)(aE,{children:null!==(t=o.closeLabel)&&void 0!==t?t:i("toast.close")})})})]})]}),!s&&(0,Ss.jsx)(ST,{asChild:!0,children:(0,Ss.jsx)(sE,{type:"normal",className:"tlui-toast__close",children:(0,Ss.jsx)(aE,{children:null!==(n=o.closeLabel)&&void 0!==n?n:i("toast.close")})})})]})}const SA=(0,e.memo)((function(){const{toasts:e}=CT(),t=yn("toasts",(()=>e.get()),[]);return(0,Ss.jsxs)(Ss.Fragment,{children:[t.map((e=>(0,Ss.jsx)(xA,{toast:e},e.id))),(0,Ss.jsx)(Zj,{className:"tlui-toast__viewport"})]})})),kA=["actionId"];function PA(e){let{actionId:t=""}=e,n=yr(e,kA);const o=WM()[t];return o?(0,Ss.jsx)(nA,l(l({},o),n)):null}function CA(e){return(0,Ss.jsx)("svg",l(l({width:16,height:16,viewBox:"0 0 16 16"},e),{},{children:(0,Ss.jsxs)("g",{strokeWidth:2,fill:"none",fillRule:"evenodd",children:[(0,Ss.jsx)("circle",{strokeOpacity:.25,cx:8,cy:8,r:7,stroke:"currentColor"}),(0,Ss.jsx)("path",{strokeLinecap:"round",d:"M15 8c0-4.5-4.5-7-7-7",stroke:"currentColor",children:(0,Ss.jsx)("animateTransform",{attributeName:"transform",type:"rotate",from:"0 8 8",to:"360 8 8",dur:"1s",repeatCount:"indefinite"})})]})}))}function _A(t){let{disabled:n=!1,spinner:o=!1,readonlyOk:r=!1,id:i,kbd:s,label:a,icon:l,onSelect:c,noClose:d,isSelected:u}=t;const{type:h,sourceId:p}=eA(),f=rE(),[g,m]=(0,e.useState)(!1);if(YM()&&!r)return null;const y=qM(a,h),v=s?ZM(s):void 0,b=y?f(y):void 0,w=b&&v?"".concat(b," ").concat(v):b;switch(h){case"menu":return(0,Ss.jsx)(hA,{children:(0,Ss.jsxs)(sE,{type:"menu","data-testid":"".concat(p,".").concat(i),disabled:n,title:w,onClick:e=>{d&&Da(e),g?m(!1):c(p)},children:[(0,Ss.jsx)(aE,{children:b}),s&&(0,Ss.jsx)(QM,{children:s})]})});case"context-menu":return n?null:(0,Ss.jsxs)(L_,{dir:"ltr",title:w,draggable:!1,className:"tlui-button tlui-button__menu","data-testid":"".concat(p,".").concat(i),onSelect:e=>{d&&Da(e),g?m(!1):c(p)},children:[(0,Ss.jsx)("span",{className:"tlui-button__label",draggable:!1,children:b}),s&&(0,Ss.jsx)(QM,{children:s}),o&&(0,Ss.jsx)(CA,{})]});case"panel":return(0,Ss.jsxs)(sE,{"data-testid":"".concat(p,".").concat(i),type:"menu",title:w,disabled:n,onClick:()=>c(p),children:[(0,Ss.jsx)(aE,{children:b}),o?(0,Ss.jsx)(CA,{}):l&&(0,Ss.jsx)(ej,{icon:l})]});case"small-icons":case"icons":return(0,Ss.jsx)(sE,{"data-testid":"".concat(p,".").concat(i),type:"icon",title:w,disabled:n,onClick:()=>c(p),children:(0,Ss.jsx)(ej,{icon:l,small:"small-icons"===h})});case"keyboard-shortcuts":return s?(0,Ss.jsxs)("div",{className:"tlui-shortcuts-dialog__key-pair","data-testid":"".concat(p,".").concat(i),children:[(0,Ss.jsx)("div",{className:"tlui-shortcuts-dialog__key-pair__key",children:b}),(0,Ss.jsx)("div",{className:"tlui-shortcuts-dialog__key-pair__value",children:(0,Ss.jsx)(QM,{visibleOnMobileLayout:!0,children:s})})]}):(console.warn("Menu item '".concat(a,"' isn't shown in the keyboard shortcuts dialog because it doesn't have a keyboard shortcut.")),null);case"helper-buttons":return(0,Ss.jsxs)(sE,{type:"low",onClick:()=>c(p),children:[(0,Ss.jsx)(ej,{icon:l}),(0,Ss.jsx)(aE,{children:b})]});case"toolbar":return(0,Ss.jsx)(sE,{type:"tool","data-testid":"tools.".concat(i),"aria-label":y,"data-value":i,onClick:()=>c("toolbar"),title:w,disabled:n,onTouchStart:e=>{Da(e),c("toolbar")},role:"radio","aria-checked":u?"true":"false",children:(0,Ss.jsx)(ej,{icon:l})});case"toolbar-overflow":return(0,Ss.jsx)(hA,{"aria-label":a,children:(0,Ss.jsx)(sE,{type:"icon",className:"tlui-button-grid__button",onClick:()=>{c("toolbar")},"data-testid":"tools.more.".concat(i),title:w,disabled:n,role:"radio","aria-checked":u?"true":"false","data-value":i,children:(0,Ss.jsx)(ej,{icon:l})})});default:throw T(h)}}const IA=["actionId"];function EA(e){let{actionId:t=""}=e,n=yr(e,IA);const o=WM()[t];return o?(0,Ss.jsx)(_A,l(l({},o),n)):null}const jA=e.createContext(null);function TA(t){let{overrides:n,children:o}=t;const r=Ns(),i=Zb(),s=NM(),a=e.useMemo((()=>{const e=[{id:"select",label:"tool.select",icon:"tool-pointer",kbd:"v",readonlyOk:!0,onSelect(e){if(r.isIn("select")){const e=r.root.getCurrent();e.exit({},e.id),e.enter({},e.id)}r.setCurrentTool("select"),i("select-tool",{source:e,id:"select"})}},{id:"hand",label:"tool.hand",icon:"tool-hand",kbd:"h",readonlyOk:!0,onSelect(e){r.setCurrentTool("hand"),i("select-tool",{source:e,id:"hand"})}},{id:"eraser",label:"tool.eraser",icon:"tool-eraser",kbd:"e",onSelect(e){r.setCurrentTool("eraser"),i("select-tool",{source:e,id:"eraser"})}},{id:"draw",label:"tool.draw",icon:"tool-pencil",kbd:"d,b,x",onSelect(e){r.setCurrentTool("draw"),i("select-tool",{source:e,id:"draw"})}},...[...Ui.values].map((e=>({id:e,label:"tool.".concat(e),meta:{geo:e},kbd:"rectangle"===e?"r":"ellipse"===e?"o":void 0,icon:"geo-"+e,onSelect(t){r.run((()=>{r.setStyleForNextShapes(Ui,e),r.setCurrentTool("geo"),i("select-tool",{source:t,id:"geo-".concat(e)})}))}}))),{id:"arrow",label:"tool.arrow",icon:"tool-arrow",kbd:"a",onSelect(e){r.setCurrentTool("arrow"),i("select-tool",{source:e,id:"arrow"})}},{id:"line",label:"tool.line",icon:"tool-line",kbd:"l",onSelect(e){r.setCurrentTool("line"),i("select-tool",{source:e,id:"line"})}},{id:"frame",label:"tool.frame",icon:"tool-frame",kbd:"f",onSelect(e){r.setCurrentTool("frame"),i("select-tool",{source:e,id:"frame"})}},{id:"text",label:"tool.text",icon:"tool-text",kbd:"t",onSelect(e){r.setCurrentTool("text"),i("select-tool",{source:e,id:"text"})}},{id:"asset",label:"tool.asset",icon:"tool-media",kbd:"$u",onSelect(e){s.insertMedia(),i("select-tool",{source:e,id:"media"})}},{id:"note",label:"tool.note",icon:"tool-note",kbd:"n",onSelect(e){r.setCurrentTool("note"),i("select-tool",{source:e,id:"note"})}},{id:"laser",label:"tool.laser",readonlyOk:!0,icon:"tool-laser",kbd:"k",onSelect(e){r.setCurrentTool("laser"),i("select-tool",{source:e,id:"laser"})}},{id:"embed",label:"tool.embed",icon:"dot",onSelect(e){s.addDialog({component:mj}),i("select-tool",{source:e,id:"embed"})}},{id:"highlight",label:"tool.highlight",icon:"tool-highlight",kbd:"!d",onSelect(e){r.setCurrentTool("highlight"),i("select-tool",{source:e,id:"highlight"})}}];e.push();const t=Object.fromEntries(e.map((e=>[e.id,e])));return n?n(r,t,s):t}),[n,r,i,s]);return(0,Ss.jsx)(jA.Provider,{value:a,children:o})}function MA(){const t=e.useContext(jA);if(!t)throw new Error("useTools must be used within a ToolProvider");return t}const AA=["toolId"];function OA(e){let{toolId:t=""}=e,n=yr(e,AA);const o=MA()[t];return o?(0,Ss.jsx)(_A,l(l({},o),n)):null}function DA(e){let{children:t}=e;const n=Ns();return yn("shouldDisplayHandles",(()=>{if(n.isInAny("select.idle","select.pointing_handle","select.pointing_shape"))return!0;if(n.isInAny("select.editing_shape")){const e=n.getOnlySelectedShape();return e&&n.isShapeOfType(e,"note")}return!1}),[n])?(0,Ss.jsx)("svg",{className:"tl-user-handles tl-overlays__item",children:t}):null}const{PI:RA}=Math,LA=RA+1e-4;function zA(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{size:n=16,smoothing:o=.5}=t;if(0===e.length||n<=0)return{left:[],right:[]};const r=e[0],i=e[e.length-1],s=i.runningLength,a=Math.pow(n*o,2),l=[],c=[];let d,u=e[0].vector,h=e[0].point,p=h,f=h,g=p,m=!1;for(let y=0;y<e.length;y++){d=e[y];const{point:t,vector:n}=e[y],o=d.vector.dpr(u),v=(y<e.length-1?e[y+1]:e[y]).vector,b=y<e.length-1?v.dpr(d.vector):1,w=null!==b&&b<.2;if(o<0&&!m||w){if(b>-.62&&s-d.runningLength>d.radius){const e=u.clone().mul(d.radius);u.clone().cpr(v)<0?(f=Vs.Add(t,e),g=Vs.Sub(t,e)):(f=Vs.Sub(t,e),g=Vs.Add(t,e)),l.push(f),c.push(g)}else{const e=u.clone().mul(d.radius).per(),t=Vs.Sub(d.input,e);for(let n=1/13,o=0;o<1;o+=n)f=Vs.RotWith(t,d.input,LA*o),l.push(f),g=Vs.RotWith(t,d.input,LA+LA*-o),c.push(g)}h=f,p=g,w&&(m=!0);continue}if(m=!1,d===r||d===i){const e=Vs.Per(n).mul(d.radius);l.push(Vs.Sub(t,e)),c.push(Vs.Add(t,e));continue}const x=Vs.Lrp(v,n,b).per().mul(d.radius);f=Vs.Sub(t,x),(y<=1||Vs.Dist2(h,f)>a)&&(l.push(f),h=f),g=Vs.Add(t,x),(y<=1||Vs.Dist2(p,g)>a)&&(c.push(g),p=g),u=n}return{left:l,right:c}}function NA(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{size:n=16,start:o={},end:r={},last:i=!1}=t,{cap:s=!0}=o,{cap:a=!0}=r;if(0===e.length||n<=0)return[];const l=e[0],c=e[e.length-1],d=c.runningLength,u=!1===o.taper?0:!0===o.taper?Math.max(n,d):o.taper,h=!1===r.taper?0:!0===r.taper?Math.max(n,d):r.taper,{left:p,right:f}=zA(e,t),g=l.point,m=e.length>1?e[e.length-1].point:Vs.AddXY(l.point,1,1);if(1===e.length&&(!u&&!h||i)){const e=Vs.Add(g,Vs.Sub(g,m).uni().per().mul(-l.radius)),t=[];for(let n=1/13,o=n;o<=1;o+=n)t.push(Vs.RotWith(e,g,2*LA*o));return t}const y=[];if(u||h&&1===e.length);else if(s)for(let w=1/8,x=w;x<=1;x+=w){const e=Vs.RotWith(f[0],g,LA*x);y.push(e)}else{const e=Vs.Sub(p[0],f[0]),t=Vs.Mul(e,.5),n=Vs.Mul(e,.51);y.push(Vs.Sub(g,t),Vs.Sub(g,n),Vs.Add(g,n),Vs.Add(g,t))}const v=[],b=c.vector.clone().per().neg();if(h||u&&1===e.length)v.push(m);else if(a){const e=Vs.Add(m,Vs.Mul(b,c.radius));for(let t=1/29,n=t;n<1;n+=t)v.push(Vs.RotWith(e,m,3*LA*n))}else v.push(Vs.Add(m,Vs.Mul(b,c.radius)),Vs.Add(m,Vs.Mul(b,.99*c.radius)),Vs.Sub(m,Vs.Mul(b,.99*c.radius)),Vs.Sub(m,Vs.Mul(b,c.radius)));return p.concat(v,f.reverse(),y)}function FA(e){var t;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{streamline:o=.5,size:r=16,simulatePressure:i=!1}=n;if(0===e.length)return[];const s=.15+.85*(1-o);let a=e.map(Vs.From),l=0;if(!i){let e=a[0];for(;e&&!(e.z>=.025);)a.shift(),e=a[0]}if(!i){let e=a[a.length-1];for(;e&&!(e.z>=.01);)a.pop(),e=a[a.length-1]}if(0===a.length)return[{point:Vs.From(e[0]),input:Vs.From(e[0]),pressure:i?.5:.15,vector:new Vs(1,1),distance:0,runningLength:0,radius:1}];let c=a[1];for(;c&&!(Vs.Dist2(c,a[0])>(r/3)**2);)a[0].z=Math.max(a[0].z,c.z),a.splice(1,1),c=a[1];const d=a.pop();for(c=a[a.length-1];c&&!(Vs.Dist2(c,d)>(r/3)**2);)a.pop(),c=a[a.length-1],l++;a.push(d);const u=n.last||!n.simulatePressure||a.length>1&&Vs.Dist2(a[a.length-1],a[a.length-2])<r**2||l>0;if(2===a.length&&n.simulatePressure){const e=a[1];a=a.slice(0,-1);for(let t=1;t<5;t++){const n=Vs.Lrp(a[0],e,t/4);n.z=(a[0].z+(e.z-a[0].z))*t/4,a.push(n)}}const h=[{point:a[0],input:a[0],pressure:i?.5:a[0].z,vector:new Vs(1,1),distance:0,runningLength:0,radius:1}];let p,f,g=0,m=h[0];u&&o>0&&a.push(a[a.length-1].clone());for(let y=1,v=a.length;y<v;y++)p=!s||n.last&&y===v-1?a[y].clone():a[y].clone().lrp(m.point,1-s),m.point.equals(p)||(f=Vs.Dist(p,m.point),g+=f,y<4&&g<r||(m={input:a[y],point:p,pressure:i?.5:a[y].z,vector:Vs.Sub(m.point,p).uni(),distance:f,runningLength:g,radius:1},h.push(m)));if(null!==(t=h[1])&&void 0!==t&&t.vector&&(h[0].vector=h[1].vector.clone()),g<1){const e=Math.max(.5,...h.map((e=>e.pressure)));h.forEach((t=>t.pressure=e))}return h}const{min:BA}=Math,UA=.275;function HA(e,t){const{size:n=16,thinning:o=.5,simulatePressure:r=!0,easing:i=e=>e,start:s={},end:a={}}=t,{easing:l=Ks.easeOutQuad}=s,{easing:c=Ks.easeOutCubic}=a,d=e[e.length-1].runningLength;let u,h,p=e[0].pressure;if(!r&&d<n){const t=e.reduce(((e,t)=>Math.max(e,t.pressure)),.5);return e.forEach((e=>{e.pressure=t,e.radius=n*i(.5-o*(.5-e.pressure))})),e}{let t;for(let o=0,i=e.length;o<i&&(h=e[o],!(h.runningLength>5*n));o++){const e=BA(1,h.distance/n);if(r){const n=BA(1,1-e);t=BA(1,p+e*UA*(n-p))}else t=BA(1,p+.5*(h.pressure-p));p+=.5*(t-p)}for(let s=0;s<e.length;s++){if(h=e[s],o){let{pressure:e}=h;const t=BA(1,h.distance/n);if(r){const n=BA(1,1-t);e=BA(1,p+t*UA*(n-p))}else e=BA(1,p+t*UA*(e-p));h.radius=n*i(.5-o*(.5-e)),p=e}else h.radius=n/2;void 0===u&&(u=h.radius)}}const f=!1===s.taper?0:!0===s.taper?Math.max(n,d):s.taper,g=!1===a.taper?0:!0===a.taper?Math.max(n,d):a.taper;if(f||g)for(let m=0;m<e.length;m++){h=e[m];const{runningLength:t}=h,n=t<f?l(t/f):1,o=d-t<g?c((d-t)/g):1;h.radius=Math.max(.01,h.radius*Math.min(n,o))}return e}function KA(e){let{scribble:t,zoom:n,color:o,opacity:r,className:i}=e;if(!t.points.length)return null;const s=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return NA(HA(FA(e,t),t),t)}(t.points,{size:t.size/n,start:{taper:t.taper,easing:Ks.linear},last:"stopping"===t.state,simulatePressure:!1,streamline:.32});let a;if(s.length<4){const e=t.size/n/2,{x:o,y:r}=t.points[t.points.length-1];a="M ".concat(o-e,",").concat(r," a ").concat(e,",").concat(e," 0 1,0 ").concat(2*e,",0 a ").concat(e,",").concat(e," 0 1,0 ").concat(2*-e,",0")}else a=Gc(s);return(0,Ss.jsx)("svg",{className:i?ks("tl-overlays__item",i):i,children:(0,Ss.jsx)("path",{className:"tl-scribble",d:a,fill:null!==o&&void 0!==o?o:"var(--color-".concat(t.color,")"),opacity:null!==r&&void 0!==r?r:t.opacity})})}const VA=e=>{let{bounds:t,rotation:n}=e;const o=Ns();return yn("should display",(()=>o.isInAny("select.idle","select.brushing","select.scribble_brushing","select.pointing_shape","select.pointing_selection","text.resizing")),[o])?(0,Ss.jsx)($c,{bounds:t,rotation:n}):null};function WA(e){let{size:t,width:n,height:o,hideAlternateHandles:r}=e;const i=ga(t/3),s=i/2;return(0,Ss.jsxs)("svg",{className:"tl-overlays__item",children:[(0,Ss.jsx)("polyline",{className:"tl-corner-crop-handle",points:"\n\t\t\t\t\t\t".concat(ga(0-s),",").concat(ga(t)," \n\t\t\t\t\t\t").concat(ga(0-s),",").concat(ga(0-s)," \n\t\t\t\t\t\t").concat(ga(t),",").concat(ga(0-s)),strokeWidth:i,"data-testid":"selection.crop.top_left","aria-label":"top_left handle"}),(0,Ss.jsx)("line",{className:ks("tl-corner-crop-edge-handle",{"tl-hidden":r}),x1:ga(n/2-t),y1:ga(0-s),x2:ga(n/2+t),y2:ga(0-s),strokeWidth:i,"data-testid":"selection.crop.top","aria-label":"top handle"}),(0,Ss.jsx)("polyline",{className:ks("tl-corner-crop-handle",{"tl-hidden":r}),points:"\n\t\t\t\t\t\t".concat(ga(n-t),",").concat(ga(0-s)," \n\t\t\t\t\t\t").concat(ga(n+s),",").concat(ga(0-s)," \n\t\t\t\t\t\t").concat(ga(n+s),",").concat(ga(t)),strokeWidth:i,"data-testid":"selection.crop.top_right","aria-label":"top_right handle"}),(0,Ss.jsx)("line",{className:ks("tl-corner-crop-edge-handle",{"tl-hidden":r}),x1:ga(n+s),y1:ga(o/2-t),x2:ga(n+s),y2:ga(o/2+t),strokeWidth:i,"data-testid":"selection.crop.right","aria-label":"right handle"}),(0,Ss.jsx)("polyline",{className:"tl-corner-crop-handle",points:"\n\t\t\t\t\t\t".concat(ga(n+s),",").concat(ga(o-t)," \n\t\t\t\t\t\t").concat(ga(n+s),",").concat(ga(o+s),"\n\t\t\t\t\t\t").concat(ga(n-t),",").concat(ga(o+s)),strokeWidth:i,"data-testid":"selection.crop.bottom_right","aria-label":"bottom_right handle"}),(0,Ss.jsx)("line",{className:ks("tl-corner-crop-edge-handle",{"tl-hidden":r}),x1:ga(n/2-t),y1:ga(o+s),x2:ga(n/2+t),y2:ga(o+s),strokeWidth:i,"data-testid":"selection.crop.bottom","aria-label":"bottom handle"}),(0,Ss.jsx)("polyline",{className:ks("tl-corner-crop-handle",{"tl-hidden":r}),points:"\n\t\t\t\t\t\t".concat(ga(0+t),",").concat(ga(o+s)," \n\t\t\t\t\t\t").concat(ga(0-s),",").concat(ga(o+s),"\n\t\t\t\t\t\t").concat(ga(0-s),",").concat(ga(o-t)),strokeWidth:i,"data-testid":"selection.crop.bottom_left","aria-label":"bottom_left handle"}),(0,Ss.jsx)("line",{className:ks("tl-corner-crop-edge-handle",{"tl-hidden":r}),x1:ga(0-s),y1:ga(o/2-t),x2:ga(0-s),y2:ga(o/2+t),strokeWidth:i,"data-testid":"selection.crop.left","aria-label":"left handle"})]})}const qA=fn((function(t){var n,o;let{bounds:r,rotation:i}=t;const s=Ns(),a=(0,e.useRef)(null),c=YM(),d=Bb("top"),u=Bb("right"),h=Bb("bottom"),p=Bb("left"),f=Bb("top_left"),g=Bb("top_right"),m=Bb("bottom_right"),y=Bb("bottom_left"),v="default"===s.getInstanceState().cursor.type,b=s.getInstanceState().isCoarsePointer,w=s.getOnlySelectedShape(),x=w&&s.isShapeOrAncestorLocked(w),S=w?s.getShapeUtil(w).expandSelectionOutlinePx(w):0;if(Hs(a,null===(n=r)||void 0===n?void 0:n.x,null===(o=r)||void 0===o?void 0:o.y,1,s.getSelectionRotation(),{x:-S,y:-S}),w&&s.isShapeHidden(w))return null;if(!r)return null;r=r.clone().expandBy(S).zeroFix();const k=s.getZoomLevel(),P=s.getInstanceState().isChangingStyle,C=r.width,_=r.height,I=8/k,E=C<2*I,j=_<2*I,T=C<4*I,M=_<4*I,A=C<5*I,O=_<5*I,D=b?1.75:1,R=6/k*D,L=(T?R/2:R)*(.75*D),z=(M?R/2:R)*(.75*D),N=(!w||!s.getShapeUtil(w).hideSelectionBoundsFg(w))&&!P;let F=N&&s.isInAny("select.idle","select.brushing","select.scribble_brushing","select.pointing_canvas","select.pointing_selection","select.pointing_shape","select.crop.idle","select.crop.pointing_crop","select.crop.pointing_crop_handle","select.pointing_resize_handle")||N&&s.isIn("select.resizing")&&w&&s.isShapeOfType(w,"text");w&&F&&ka.isFirefox&&s.isShapeOfType(w,"embed")&&(F=!1);const B=s.isInAny("select.crop.idle","select.crop.pointing_crop","select.crop.pointing_crop_handle")&&!P&&!c,U=s.isInAny("select.idle","select.pointing_selection","select.pointing_shape","select.crop.idle")&&!P&&!c,H=!b&&!(E||j)&&(U||B)&&(!w||!s.getShapeUtil(w).hideRotateHandle(w))&&!x,K=b&&(!T||!M)&&(U||B)&&(!w||!s.getShapeUtil(w).hideRotateHandle(w))&&!x,V=U&&(!w||s.getShapeUtil(w).canResize(w)&&!s.getShapeUtil(w).hideResizeHandles(w))&&!B&&!x,W=E||j,q=E&&j,Y=A||O,G=V||B,X=!H,$=!U||!K,Z=!U||!G,Q=!U||!G||W,J=!U||!G||W,ee=!U||!G||q&&!B;let te=!0,ne=!0;if(B)te=Y,ne=Y;else if(V){te=W||q||b;const e=b&&w&&"text"===w.type;ne=te&&!e}const oe=Math.min(24/k,_-3*z),re=U&&b&&w&&s.isShapeOfType(w,"text")&&oe*k>=4;return(0,Ss.jsx)("svg",{className:"tl-overlays__item tl-selection__fg","data-testid":"selection-foreground",children:(0,Ss.jsxs)("g",{ref:a,children:[F&&(0,Ss.jsx)("rect",{className:"tl-selection__fg__outline",width:ga(C),height:ga(_)}),(0,Ss.jsx)(YA,{"data-testid":"selection.rotate.top-left",cx:0,cy:0,targetSize:R,corner:"top_left_rotate",cursor:v?gv("nwse-rotate",i):void 0,isHidden:X}),(0,Ss.jsx)(YA,{"data-testid":"selection.rotate.top-right",cx:C+3*R,cy:0,targetSize:R,corner:"top_right_rotate",cursor:v?gv("nesw-rotate",i):void 0,isHidden:X}),(0,Ss.jsx)(YA,{"data-testid":"selection.rotate.bottom-left",cx:0,cy:_+3*R,targetSize:R,corner:"bottom_left_rotate",cursor:v?gv("swne-rotate",i):void 0,isHidden:X}),(0,Ss.jsx)(YA,{"data-testid":"selection.rotate.bottom-right",cx:C+3*R,cy:_+3*R,targetSize:R,corner:"bottom_right_rotate",cursor:v?gv("senw-rotate",i):void 0,isHidden:X}),(0,Ss.jsx)(XA,{"data-testid":"selection.rotate.mobile",cx:T?1.5*-R:C/2,cy:T?_/2:1.5*-R,size:I,isHidden:$}),(0,Ss.jsx)("rect",l({className:ks("tl-transparent",{"tl-hidden":te}),"data-testid":"selection.resize.top","aria-label":"top target",pointerEvents:"all",x:0,y:ga(0-(M?2*z:z)),width:ga(C),height:ga(Math.max(1,2*z)),style:v?{cursor:gv("ns-resize",i)}:void 0},d)),(0,Ss.jsx)("rect",l({className:ks("tl-transparent",{"tl-hidden":ne}),"data-testid":"selection.resize.right","aria-label":"right target",pointerEvents:"all",x:ga(C-(T?0:L)),y:0,height:ga(_),width:ga(Math.max(1,2*L)),style:v?{cursor:gv("ew-resize",i)}:void 0},u)),(0,Ss.jsx)("rect",l({className:ks("tl-transparent",{"tl-hidden":te}),"data-testid":"selection.resize.bottom","aria-label":"bottom target",pointerEvents:"all",x:0,y:ga(_-(M?0:z)),width:ga(C),height:ga(Math.max(1,2*z)),style:v?{cursor:gv("ns-resize",i)}:void 0},h)),(0,Ss.jsx)("rect",l({className:ks("tl-transparent",{"tl-hidden":ne}),"data-testid":"selection.resize.left","aria-label":"left target",pointerEvents:"all",x:ga(0-(T?2*L:L)),y:0,height:ga(_),width:ga(Math.max(1,2*L)),style:v?{cursor:gv("ew-resize",i)}:void 0},p)),(0,Ss.jsx)("rect",l({className:ks("tl-transparent",{"tl-hidden":Z}),"data-testid":"selection.target.top-left","aria-label":"top-left target",pointerEvents:"all",x:ga(0-(T?2*L:1.5*L)),y:ga(0-(M?2*z:1.5*z)),width:ga(3*L),height:ga(3*z),style:v?{cursor:gv("nwse-resize",i)}:void 0},f)),(0,Ss.jsx)("rect",l({className:ks("tl-transparent",{"tl-hidden":Q}),"data-testid":"selection.target.top-right","aria-label":"top-right target",pointerEvents:"all",x:ga(C-(T?0:1.5*L)),y:ga(0-(M?2*z:1.5*z)),width:ga(3*L),height:ga(3*z),style:v?{cursor:gv("nesw-resize",i)}:void 0},g)),(0,Ss.jsx)("rect",l({className:ks("tl-transparent",{"tl-hidden":ee}),"data-testid":"selection.target.bottom-right","aria-label":"bottom-right target",pointerEvents:"all",x:ga(C-(T?L:1.5*L)),y:ga(_-(M?z:1.5*z)),width:ga(3*L),height:ga(3*z),style:v?{cursor:gv("nwse-resize",i)}:void 0},m)),(0,Ss.jsx)("rect",l({className:ks("tl-transparent",{"tl-hidden":J}),"data-testid":"selection.target.bottom-left","aria-label":"bottom-left target",pointerEvents:"all",x:ga(0-(T?3*L:1.5*L)),y:ga(_-(M?0:1.5*z)),width:ga(3*L),height:ga(3*z),style:v?{cursor:gv("nesw-resize",i)}:void 0},y)),V&&(0,Ss.jsxs)(Ss.Fragment,{children:[(0,Ss.jsx)("rect",{"data-testid":"selection.resize.top-left",className:ks("tl-corner-handle",{"tl-hidden":Z}),"aria-label":"top_left handle",x:ga(0-I/2),y:ga(0-I/2),width:ga(I),height:ga(I)}),(0,Ss.jsx)("rect",{"data-testid":"selection.resize.top-right",className:ks("tl-corner-handle",{"tl-hidden":Q}),"aria-label":"top_right handle",x:ga(C-I/2),y:ga(0-I/2),width:ga(I),height:ga(I)}),(0,Ss.jsx)("rect",{"data-testid":"selection.resize.bottom-right",className:ks("tl-corner-handle",{"tl-hidden":ee}),"aria-label":"bottom_right handle",x:ga(C-I/2),y:ga(_-I/2),width:ga(I),height:ga(I)}),(0,Ss.jsx)("rect",{"data-testid":"selection.resize.bottom-left",className:ks("tl-corner-handle",{"tl-hidden":J}),"aria-label":"bottom_left handle",x:ga(0-I/2),y:ga(_-I/2),width:ga(I),height:ga(I)})]}),re&&(0,Ss.jsxs)(Ss.Fragment,{children:[(0,Ss.jsx)("rect",{"data-testid":"selection.text-resize.left.handle",className:"tl-text-handle","aria-label":"bottom_left handle",x:ga(0-I/4),y:ga(_/2-oe/2),rx:I/4,width:ga(I/2),height:ga(oe)}),(0,Ss.jsx)("rect",{"data-testid":"selection.text-resize.right.handle",className:"tl-text-handle","aria-label":"bottom_left handle",rx:I/4,x:ga(C-I/4),y:ga(_/2-oe/2),width:ga(I/2),height:ga(oe)})]}),B&&(0,Ss.jsx)(WA,l({},{size:I,width:C,height:_,hideAlternateHandles:Y}))]})})})),YA=function(e){let{cx:t,cy:n,targetSize:o,corner:r,cursor:i,isHidden:s,"data-testid":a}=e;const c=Bb(r);return(0,Ss.jsx)("rect",l({className:ks("tl-transparent","tl-rotate-corner",{"tl-hidden":s}),"data-testid":a,"aria-label":"".concat(r," target"),pointerEvents:"all",x:ga(t-3*o),y:ga(n-3*o),width:ga(Math.max(1,3*o)),height:ga(Math.max(1,3*o)),cursor:i},c))},GA=Math.sqrt(Math.PI),XA=function(e){let{cx:t,cy:n,size:o,isHidden:r,"data-testid":i}=e;const s=Bb("mobile_rotate"),a=Ns(),c=yn("zoom level",(()=>a.getZoomLevel()),[a]),d=Math.max(1/c*14,20/Math.max(1,c));return(0,Ss.jsxs)("g",{children:[(0,Ss.jsx)("circle",l({"data-testid":i,pointerEvents:"all",className:ks("tl-transparent","tl-mobile-rotate__bg",{"tl-hidden":r}),cx:t,cy:n,r:d},s)),(0,Ss.jsx)("circle",{className:ks("tl-mobile-rotate__fg",{"tl-hidden":r}),cx:t,cy:n,r:o/GA})]})};function $A(){const e=Ns();return yn("is in a valid select state",(()=>e.isInAny("select.idle","select.brushing","select.scribble_brushing","select.editing_shape","select.pointing_shape","select.pointing_selection","select.pointing_handle")),[e])?(0,Ss.jsx)(od,{}):null}function ZA(e,t,n){const{arrowheadStart:o,arrowheadEnd:r}=t.props,i=sO(e,t,n),s=i.start.clone(),a=i.end.clone(),l=Vs.Med(s,a);if(Vs.Equals(s,a))return{bindings:n,isStraight:!0,start:{handle:s,point:s,arrowhead:t.props.arrowheadStart},end:{handle:a,point:a,arrowhead:t.props.arrowheadEnd},middle:l,isValid:!1,length:0};const c=Vs.Sub(a,s).uni(),d=tO(e,t,"start"),u=tO(e,t,"end"),h=e.getShapePageTransform(t);QA(a,i.start,h,u),QA(s,i.end,h,d);let p=0,f=0,g=0,m=0,y=cO*t.props.scale;const v=d&&u&&d.shape===u.shape,b=d&&u?pO(e,d.shape.id,u.shape.id):"safe";"safe"!==b||!d||!u||v||d.isExact||u.isExact||(u.didIntersect&&!d.didIntersect?d.isClosed&&s.setTo(a.clone().add(c.clone().mul(cO*t.props.scale))):u.didIntersect||u.isClosed&&a.setTo(s.clone().sub(c.clone().mul(cO*t.props.scale))));const w=Vs.Sub(a,s),x=Vs.Len(w)?w.uni():Vs.From(w),S=!Vs.Equals(x,c);v||("start-contains-end"!==b&&d&&"none"!==o&&!d.isExact&&(g=hO[t.props.size]/2+("size"in d.shape.props?hO[d.shape.props.size]/2:0),p=(dO+g)*t.props.scale,y+=g*t.props.scale),"end-contains-start"!==b&&u&&"none"!==r&&!u.isExact&&(m=hO[t.props.size]/2+("size"in u.shape.props?hO[u.shape.props.size]/2:0),f=(dO+m)*t.props.scale,y+=m*t.props.scale));const k=s.clone().add(x.clone().mul(p*(S?-1:1))),P=a.clone().sub(x.clone().mul(f*(S?-1:1)));Vs.DistMin(k,P,y)&&(0!==p&&0!==f?(p*=-1.5,f*=-1.5):0!==p?p*=-1:0!==f&&(f*=-1)),s.add(x.clone().mul(p*(S?-1:1))),a.sub(x.clone().mul(f*(S?-1:1))),S?(d&&u&&a.setTo(Vs.Add(s,x.clone().mul(-cO*t.props.scale))),l.setTo(Vs.Med(i.start,i.end))):l.setTo(Vs.Med(s,a));const C=Vs.Dist(s,a);return{bindings:n,isStraight:!0,start:{handle:i.start,point:s,arrowhead:t.props.arrowheadStart},end:{handle:i.end,point:a,arrowhead:t.props.arrowheadEnd},middle:l,isValid:C>0,length:C}}function QA(e,t,n,o){if(void 0===o)return;if(o.isExact)return;const r=ic.applyToPoint(n,t),i=ic.applyToPoint(n,e),s=ic.applyToPoint(ic.Inverse(o.transform),r),a=ic.applyToPoint(ic.Inverse(o.transform),i),l=o.isClosed,c=(l?iu:ru)(s,a,o.outline);let d;var u;null!==c&&(d=null!==(u=c.sort(((e,t)=>Vs.Dist2(e,s)-Vs.Dist2(t,s)))[0])&&void 0!==u?u:l?void 0:a);if(void 0===d)return;const h=ic.applyToPoint(o.transform,d),p=ic.applyToPoint(ic.Inverse(n),h);e.setTo(p),o.didIntersect=!0}function JA(e,t,n){const{arrowheadEnd:o,arrowheadStart:r}=t.props,i=t.props.bend;if(Math.abs(i)>Math.abs(t.props.bend*(uO*t.props.scale)))return ZA(e,t,n);const s=sO(e,t,n),a=Vs.Med(s.start,s.end),l=Vs.Sub(s.end,s.start),c=Vs.Len(l)?l.uni():Vs.From(l),d=Vs.Add(a,c.per().mul(-i)),u=tO(e,t,"start"),h=tO(e,t,"end"),p=s.start.clone(),f=s.end.clone(),g=d.clone();if(Vs.Equals(p,f))return{bindings:n,isStraight:!0,start:{handle:p,point:p,arrowhead:t.props.arrowheadStart},end:{handle:f,point:f,arrowhead:t.props.arrowheadEnd},middle:g,isValid:!1,length:0};const m=t.props.bend<0,y=m?oa:ra,v=eO(p,f,g),b=Vs.Angle(v.center,p),w=Vs.Angle(v.center,f),x=y(b,w);if(0===v.length||0===v.size||!ya(v.length)||!ya(v.size))return ZA(e,t,n);const S=p.clone(),k=f.clone(),P=g.clone(),C=e.getShapePageTransform(t);let _=0,I=0,E=cO*t.props.scale;if(u&&!u.isExact){const n=ic.applyToPoint(C,S),o=ic.applyToPoint(C,v.center),i=ic.applyToPoint(C,k),s=ic.Inverse(u.transform),a=ic.applyToPoint(s,n),l=ic.applyToPoint(s,o),c=ic.applyToPoint(s,i),{isClosed:d}=u;let h,p=(d?su:au)(l,v.radius,u.outline);if(p){var j;const e=l.angle(a),t=l.angle(c),n=y(e,t);p=p.filter((t=>y(e,l.angle(t))<=n));const o=.25*n;p.sort(d?(t,n)=>Math.abs(y(e,l.angle(t))-o)<Math.abs(y(e,l.angle(n))-o)?-1:1:(t,n)=>y(e,l.angle(t))<y(e,l.angle(n))?-1:1),h=null!==(j=p[0])&&void 0!==j?j:d?void 0:a}else h=d?void 0:a;if(h&&(S.setTo(e.getPointInShapeSpace(t,ic.applyToPoint(u.transform,h))),u.didIntersect=!0,"none"!==r)){const e=hO[t.props.size]/2+("size"in u.shape.props?hO[u.shape.props.size]/2:0);_=(dO+e)*t.props.scale,E+=e*t.props.scale}}if(h&&!h.isExact){const n=ic.applyToPoint(C,S),r=ic.applyToPoint(C,k),i=ic.applyToPoint(C,v.center),s=ic.Inverse(h.transform),a=ic.applyToPoint(s,n),l=ic.applyToPoint(s,i),c=ic.applyToPoint(s,r),d=h.isClosed;let u,p=(d?su:au)(l,v.radius,h.outline);if(p){const e=l.angle(a),t=l.angle(c),n=y(e,t),o=.75*n;p=p.filter((t=>y(e,l.angle(t))<=n)),p.sort(d?(t,n)=>Math.abs(y(e,l.angle(t))-o)<Math.abs(y(e,l.angle(n))-o)?-1:1:(t,n)=>y(e,l.angle(t))<y(e,l.angle(n))?-1:1),u=p[0]?p[0]:d?void 0:c}else u=d?void 0:c;if(u&&(k.setTo(e.getPointInShapeSpace(t,ic.applyToPoint(h.transform,u))),h.didIntersect=!0,"none"!==o)){const e=hO[t.props.size]/2+("size"in h.shape.props?hO[h.shape.props.size]/2:0);I=(dO+e)*t.props.scale,E+=e*t.props.scale}}let T=Vs.Angle(v.center,S),M=Vs.Angle(v.center,k),A=y(T,M),O=A*v.radius;const D=S.clone(),R=k.clone();if(0!==_&&D.setTo(v.center).add(Vs.FromAngle(T+A*(_/O*(m?1:-1))).mul(v.radius)),0!==I&&R.setTo(v.center).add(Vs.FromAngle(M+A*(I/O*(m?-1:1))).mul(v.radius)),Vs.DistMin(D,R,E)&&(0!==_&&0!==I?(_*=-1.5,I*=-1.5):0!==_?_*=-2:0!==I&&(I*=-2)),0!==_&&S.setTo(v.center).add(Vs.FromAngle(T+A*(_/O*(m?1:-1))).mul(v.radius)),0!==I&&k.setTo(v.center).add(Vs.FromAngle(M+A*(I/O*(m?-1:1))).mul(v.radius)),u&&h&&!u.isExact&&!h.isExact){T=Vs.Angle(v.center,S),M=Vs.Angle(v.center,k),A=y(T,M),O=A*v.radius;const n=pO(e,u.shape.id,h.shape.id);"double-bound"===n&&O<30?(S.setTo(p),k.setTo(f),P.setTo(g)):"safe"===n&&(u&&!u.didIntersect&&S.setTo(p),(h&&!h.didIntersect||y(b,T)>y(b,M))&&k.setTo(v.center).add(Vs.FromAngle(T+A*(Math.min(.9,cO*t.props.scale/O)*(m?1:-1))).mul(v.radius)))}!function(e,t,n,o,r,i,s){const a=Vs.Angle(e,n),l=Vs.Angle(e,o);let c=oa(a,l);s||(c=$s-c);if(r.setTo(e).add(Vs.FromAngle(a+c*(.5*(s?1:-1))).mul(t)),c>i){r.rotWith(e,Gs);const t=o.clone();o.setTo(n),n.setTo(t)}}(v.center,v.radius,S,k,P,x,m),S.equals(k)&&(S.setTo(P.clone().addXY(1,1)),k.setTo(P.clone().subXY(1,1))),p.setTo(S),f.setTo(k),g.setTo(P);const L=eO(p,f,g);return{bindings:n,isStraight:!1,start:{point:p,handle:s.start,arrowhead:t.props.arrowheadStart},end:{point:f,handle:s.end,arrowhead:t.props.arrowheadEnd},middle:g,handleArc:v,bodyArc:L,isValid:0!==L.length&&isFinite(L.center.x)&&isFinite(L.center.y)}}function eO(e,t,n){var o;const r=null!==(o=wa(e,t,n))&&void 0!==o?o:Vs.Med(e,t),i=Vs.Dist(r,e),s=+Vs.Clockwise(e,n,t),a=((e.y-t.y)**2+(e.x-t.x)**2)**.5,l=((t.y-n.y)**2+(t.x-n.x)**2)**.5,c=((n.y-e.y)**2+(n.x-e.x)**2)**.5,d=2*Math.acos((l*l+c*c-a*a)/(2*l*c)),u=($s-d)*(s?1:-1);return{center:r,radius:i,size:u,length:u*i,largeArcFlag:+(Gs>d),sweepFlag:s}}function tO(e,t,n){const o=e.getBindingsFromShape(t,"arrow").find((e=>e.props.terminal===n));if(!o)return;const r=e.getShape(o.toId);if(!r)return;const i=e.getShapePageTransform(r),s=e.getShapeGeometry(r),a=s instanceof ac?s.children[0].vertices:s.vertices;return{shape:r,transform:i,isClosed:s.isClosed,isExact:o.props.isExact,didIntersect:!1,outline:a}}function nO(e,t,n,o){const r=e.getShape(n.toId);if(r){const{point:i,size:s}=e.getShapeGeometry(r).bounds,a=Vs.Add(i,Vs.MulV(n.props.isPrecise||o?n.props.normalizedAnchor:{x:.5,y:.5},s)),l=ic.applyToPoint(e.getShapePageTransform(r),a);return ic.applyToPoint(ic.Inverse(t),l)}return new Vs(0,0)}function oO(e,t){const n=e.getBindingsFromShape(t,"arrow");return{start:n.find((e=>"start"===e.props.terminal)),end:n.find((e=>"end"===e.props.terminal))}}const rO=function(e,t,n){const o=new L;return{get:(r,i)=>o.get(r,(()=>(r instanceof Mn?r:r.store).createComputedCache(e,(e=>t(r,e)),n))).get(i)}}("arrow info",((e,t)=>{const n=oO(e,t);return function(e){return Math.abs(e.props.bend)<8*e.props.scale}(t)?ZA(e,t,n):JA(e,t,n)}));function iO(e,t){const n="string"===typeof t?t:t.id;return rO.get(e,n)}function sO(e,t,n){var o,r;const i=e.getShapePageTransform(t),s=pO(e,null===(o=n.start)||void 0===o?void 0:o.toId,null===(r=n.end)||void 0===r?void 0:r.toId);return{start:n.start?nO(e,i,n.start,"double-bound"===s||"start-contains-end"===s):Vs.From(t.props.start),end:n.end?nO(e,i,n.end,"double-bound"===s||"end-contains-start"===s):Vs.From(t.props.end)}}function aO(e,t,n,o){const r="string"===typeof t?t:t.id,i="string"===typeof n?n:n.id,s=e.getBindingsFromShape(r,"arrow").filter((e=>e.props.terminal===o.terminal));s.length>1&&e.deleteBindings(s.slice(1));const a=s[0];a?e.updateBinding(l(l({},a),{},{toId:i,props:o})):e.createBinding({type:"arrow",fromId:r,toId:i,props:o})}function lO(e,t,n){const o=e.getBindingsFromShape(t,"arrow").filter((e=>e.props.terminal===n));e.deleteBindings(o)}const cO=10,dO=10,uO=10,hO={s:2,m:3.5,l:5,xl:10};function pO(e,t,n){if(!t||!n)return"safe";if(t===n)return"double-bound";const o=e.getShapePageBounds(t),r=e.getShapePageBounds(n);if(o&&r){if(o.contains(r))return"start-contains-end";if(r.contains(o))return"end-contains-start"}return"safe"}class fO extends Ab{getDefaultProps(){return{isPrecise:!1,isExact:!1,normalizedAnchor:{x:.5,y:.5}}}onAfterCreate(e){let{binding:t}=e;const n=this.editor.getShape(t.fromId);n&&mO(this.editor,n)}onAfterChange(e){let{bindingAfter:t}=e;const n=this.editor.getShape(t.fromId);n&&mO(this.editor,n)}onAfterChangeFromShape(e){let{shapeAfter:t}=e;mO(this.editor,t)}onAfterChangeToShape(e){let{binding:t}=e;gO(this.editor,t.fromId)}onBeforeIsolateFromShape(e){let{binding:t}=e;const n=this.editor.getShape(t.fromId);n&&yO({editor:this.editor,arrow:n,terminal:t.props.terminal})}}function gO(e,t){const n=e.getShape(t);if(!n)return;const o=oO(e,n),{start:r,end:i}=o,s=r?e.getShape(r.toId):void 0,a=i?e.getShape(i.toId):void 0,l=e.getAncestorPageId(n);if(!l)return;let c;if(s&&a){var d;c=null!==(d=e.findCommonAncestor([s,a]))&&void 0!==d?d:l}else{if(!s&&!a)return;{var u;const e=null===(u=s||a)||void 0===u?void 0:u.parentId;c=e&&e===n.parentId?n.parentId:l}}c&&c!==n.parentId&&e.reparentShapes([t],c);const h=e.getShape(t);if(!h)throw Error("no reparented arrow");const p=e.getShapeNearestSibling(h,s),f=e.getShapeNearestSibling(h,a);let g,m;if(p&&f)g=p.index>f.index?p:f;else if(p&&!f)g=p;else{if(!f||p)return;g=f}const y=e.getSortedChildIdsForParent(g.parentId).map((t=>e.getShape(t))).filter((e=>e.index>g.index));if(y.length){const e=y.find((e=>"arrow"!==e.type));if(h.index>g.index&&(!e||h.index<e.index))return;m=$e(g.index,y[0].index)}else m=Ze(g.index);m!==h.index&&e.updateShapes([{id:t,type:"arrow",index:m}])}function mO(e,t){const n=oO(e,t);for(const o of["start","end"]){const r=n[o];if(!r)continue;const i=e.getShape(r.toId),s=e.getAncestorPageId(t)===e.getAncestorPageId(i);i&&s||yO({editor:e,arrow:t,terminal:o,unbind:!0})}gO(e,t.id)}function yO(e){let{editor:t,arrow:n,terminal:o,unbind:r=!1,useHandle:i=!1}=e;const s=iO(t,n);if(!s)throw new Error("expected arrow info");const a=i?s.start.handle:s.start.point,l=i?s.end.handle:s.end.point,c="start"===o?a:l,d={id:n.id,type:"arrow",props:{[o]:{x:c.x,y:c.y},bend:n.props.bend}};if(!s.isStraight){const e="start"===o?a:s.start.handle,t="end"===o?l:s.end.handle,r=Vs.Med(e,t),i=Vs.Sub(e,t).per().uni().mul(2*s.handleArc.radius*Math.sign(n.props.bend)),c=ou(s.handleArc.center,Vs.Add(r,i),s.handleArc.center,s.handleArc.radius);M(1===(null===c||void 0===c?void 0:c.length));const u=Vs.Dist(r,c[0])*Math.sign(n.props.bend);ea(u,d.props.bend)||(d.props.bend=u)}t.updateShape(d),r&&lO(t,n,o)}s(fO,"type","arrow"),s(fO,"props",hr),s(fO,"migrations",pr);const vO=[fO],bO={lineHeight:1.35,fontWeight:"normal",fontVariant:"normal",fontStyle:"normal",padding:"0px"},wO={s:2,m:3.5,l:5,xl:10},xO={s:18,m:24,l:36,xl:44},SO={s:18,m:22,l:26,xl:32},kO={s:18,m:20,l:24,xl:28},PO={draw:"var(--tl-font-draw)",sans:"var(--tl-font-sans)",serif:"var(--tl-font-serif)",mono:"var(--tl-font-mono)"},CO=16;const _O="  ";class IO{static insertTextFirefox(e,t){e.setRangeText(t,e.selectionStart||0,e.selectionEnd||0,"end"),e.dispatchEvent(new InputEvent("input",{data:t,inputType:"insertText",isComposing:!1}))}static insert(e,t){const n=e.ownerDocument,o=n.activeElement;o!==e&&e.focus(),n.execCommand("insertText",!1,t)||IO.insertTextFirefox(e,t),o===n.body?e.blur():o instanceof HTMLElement&&o!==e&&o.focus()}static set(e,t){e.select(),IO.insert(e,t)}static getSelection(e){const{selectionStart:t,selectionEnd:n}=e;return e.value.slice(t||void 0,n||void 0)}static wrapSelection(e,t,n){const{selectionStart:o,selectionEnd:r}=e,i=IO.getSelection(e);IO.insert(e,t+i+(null!==n&&void 0!==n?n:t)),e.selectionStart=(o||0)+t.length,e.selectionEnd=(r||0)+t.length}static replace(e,t,n){let o=0;e.value.replace(t,(function(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];const s=o+r[r.length-2],a=r[0].length;e.selectionStart=s,e.selectionEnd=s+a;const l="string"===typeof n?n:n(...r);return IO.insert(e,l),e.selectionStart=s,o+=l.length-a,l}))}static findLineEnd(e,t){const n=e.lastIndexOf("\n",t-1)+1;return"\t"!==e.charAt(n)?t:n+1}static indent(e){var t;const{selectionStart:n,selectionEnd:o,value:r}=e,i=r.slice(n,o),s=null===(t=/\n/g.exec(i))||void 0===t?void 0:t.length;if(s&&s>0){const t=r.lastIndexOf("\n",n-1)+1,i=e.value.slice(t,o-1),s=i.replace(/^|\n/g,"$&".concat(_O)),a=s.length-i.length;e.setSelectionRange(t,o-1),IO.insert(e,s),e.setSelectionRange(n+1,o+a)}else IO.insert(e,_O)}static unindent(e){const{selectionStart:t,selectionEnd:n,value:o}=e,r=o.lastIndexOf("\n",t-1)+1,i=IO.findLineEnd(o,n),s=e.value.slice(r,i),a=s.replace(/(^|\n)(\t| {1,2})/g,"$1"),l=s.length-a.length;e.setSelectionRange(r,i),IO.insert(e,a);const c=/\t| {1,2}/.exec(o.slice(r,t)),d=c?c[0].length:0,u=t-d;e.setSelectionRange(t-d,Math.max(u,n-l))}static indentCE(e){var t,n,o;const r=window.getSelection(),i=e.innerText,s=null!==(t=EO(e))&&void 0!==t?t:0,a=null!==(n=EO(e))&&void 0!==n?n:0,l=i.slice(s,a),c=null===(o=/\n/g.exec(l))||void 0===o?void 0:o.length;if(c&&c>0){const t=i.lastIndexOf("\n",s-1)+1,n=i.slice(t,a-1),o=n.replace(/^|\n/g,"$&".concat(_O)).length-n.length;r&&r.setBaseAndExtent(e,s+1,e,a+o)}else{const t=window.getSelection();e.innerText=i.slice(0,s)+_O+i.slice(s),null===t||void 0===t||t.setBaseAndExtent(e,s+1,e,s+2)}}static unindentCE(e){var t,n;const o=window.getSelection(),r=e.innerText,i=null!==(t=EO(e))&&void 0!==t?t:0,s=null!==(n=EO(e))&&void 0!==n?n:0,a=r.lastIndexOf("\n",i-1)+1,l=IO.findLineEnd(r,s),c=r.slice(a,l),d=c.replace(/(^|\n)(\t| {1,2})/g,"$1"),u=c.length-d.length;if(o){o.setBaseAndExtent(e,a,e,l);const t=/\t| {1,2}/.exec(r.slice(a,i)),n=t?t[0].length:0,c=i-n;o.setBaseAndExtent(e,i-n,e,Math.max(c,s-u))}}static normalizeText(e){return e.replace(IO.fixNewLines,"\n")}static normalizeTextForDom(e){return e.replace(IO.fixNewLines,"\n").split("\n").map((e=>e||" ")).join("\n")}}function EO(e){if("undefined"===typeof window.getSelection)return;const t=window.getSelection();if(!t)return;let n=0;if(0!==t.rangeCount){const o=t.getRangeAt(0),r=o.cloneRange();r.selectNodeContents(e),r.setEnd(o.endContainer,o.endOffset),n=r.toString().length}return n}s(IO,"fixNewLines",/\r?\n|\r/g);const jO=/[\u0590-\u05FF\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF\uFB50-\uFDFF\uFE70-\uFEFF]/;function TO(e){return jO.test(e)}const MO={"&amp;":"&","&quot;":'"',"&apos;":"'","&#34;":'"',"&#38;":"&","&#39;":"'","&#8211;":"\u2013","&#8212;":"\u2014","&#8216;":"\u2018","&#8217;":"\u2019","&#8220;":"\u201c","&#8221;":"\u201d","&#8230;":"\u2026"},AO=new RegExp(Object.keys(MO).join("|"),"g");function OO(e){return function(e){return e.replace(/[ \t]+$/gm,"").replace(/\n+$/,"")}(function(e){const t=e.split("\n");for(;t[0]&&0===t[0].trim().length;)t.shift();let n=1/0;for(const o of t)if(o.trim().length>0){const e=o.length-o.trimStart().length;n=Math.min(n,e)}return t.map((e=>e.slice(n))).join("\n")}(function(e){return e.replace(/\t/g,_O)}(e)))}function DO(e,t,n){let{maxImageDimension:o,maxAssetSize:r,acceptedImageMimeTypes:i,acceptedVideoMimeTypes:s}=t,{toasts:a,msg:c}=n;e.registerExternalAssetHandler("file",(async t=>{var n;let{file:l,assetId:d}=t;const u=i.includes(l.type),h=s.includes(l.type);u||h||a.addToast({title:c("assets.files.type-not-allowed"),severity:"error"}),M(u||h,"File type not allowed: ".concat(l.type)),l.size>r&&a.addToast({title:c("assets.files.size-too-big"),severity:"error"}),M(l.size<=r,"File size too big: ".concat((l.size/1024).toFixed(),"kb > ").concat((r/1024).toFixed(),"kb"));const p=V(await l.arrayBuffer());d=null!==(n=d)&&void 0!==n?n:Pi.createId(p);const f=await RO(l,d,u,h);if(isFinite(o)){const e={w:f.props.w,h:f.props.h},t=function(e,t){const n=e.w/t.w,o=e.h/t.h;return n<=1&&o<=1?e:n>o?{w:e.w/n,h:e.h/n}:{w:e.w/o,h:e.h/o}}(e,{w:o,h:o});e!==t&&ae.isStaticImageType(l.type)&&(f.props.w=t.w,f.props.h=t.h)}return f.props.src=await e.uploadAsset(f,l),Pi.create(f)})),e.registerExternalAssetHandler("url",(async e=>{let t,{url:n}=e;try{var o,r,i,s,l,d,u,h,p,f;const e=await B(n,{method:"GET",mode:"no-cors"}),a=await e.text(),c=(new DOMParser).parseFromString(a,"text/html");t={image:null!==(o=null===(r=c.head.querySelector('meta[property="og:image"]'))||void 0===r?void 0:r.getAttribute("content"))&&void 0!==o?o:"",favicon:null!==(i=null!==(s=null===(l=c.head.querySelector('link[rel="apple-touch-icon"]'))||void 0===l?void 0:l.getAttribute("href"))&&void 0!==s?s:null===(d=c.head.querySelector('link[rel="icon"]'))||void 0===d?void 0:d.getAttribute("href"))&&void 0!==i?i:"",title:null!==(u=null===(h=c.head.querySelector('meta[property="og:title"]'))||void 0===h?void 0:h.getAttribute("content"))&&void 0!==u?u:n,description:null!==(p=null===(f=c.head.querySelector('meta[property="og:description"]'))||void 0===f?void 0:f.getAttribute("content"))&&void 0!==p?p:""},t.image.startsWith("http")||(t.image=new URL(t.image,n).href),t.favicon.startsWith("http")||(t.favicon=new URL(t.favicon,n).href)}catch(g){console.error(g),a.addToast({title:c("assets.url.failed"),severity:"error"}),t={image:"",favicon:"",title:"",description:""}}return{id:Pi.createId(K(n)),typeName:"asset",type:"bookmark",props:{src:n,description:t.description,image:t.image,favicon:t.favicon,title:t.title},meta:{}}})),e.registerExternalContentHandler("svg-text",(async t=>{let{point:n,text:o}=t;const r=null!==n&&void 0!==n?n:e.inputs.shiftKey?e.inputs.currentPagePoint:e.getViewportPageBounds().center,i=(new DOMParser).parseFromString(o,"image/svg+xml").querySelector("svg");if(!i)throw new Error("No <svg/> element present");let s=parseFloat(i.getAttribute("width")||"0"),a=parseFloat(i.getAttribute("height")||"0");if(!s||!a){document.body.appendChild(i);const e=i.getBoundingClientRect();document.body.removeChild(i),s=e.width,a=e.height}const l=await e.getAssetForExternalContent({type:"file",file:new File([o],"asset.svg",{type:"image/svg+xml"})});if(!l)throw Error("Could not create an asset");LO(e,[l],r)})),e.registerExternalContentHandler("embed",(t=>{let{point:n,url:o,embed:r}=t;const i=null!==n&&void 0!==n?n:e.inputs.shiftKey?e.inputs.currentPagePoint:e.getViewportPageBounds().center,{width:s,height:a}=r,l=Ko(),c={id:l,type:"embed",x:i.x-(s||450)/2,y:i.y-(a||450)/2,props:{w:s,h:a,url:o}};e.createShapes([c]).select(l)})),e.registerExternalContentHandler("files",(async t=>{let{point:n,files:o}=t;if(o.length>e.options.maxFilesAtOnce)throw Error("Too many files");const d=null!==n&&void 0!==n?n:e.inputs.shiftKey?e.inputs.currentPagePoint:e.getViewportPageBounds().center,u=new Vs(d.x,d.y),h=[],p=[];for(const l of o){if(l.size>r){a.addToast({title:c("assets.files.size-too-big"),severity:"error"}),console.warn("File size too big: ".concat((l.size/1024).toFixed(),"kb > ").concat((r/1024).toFixed(),"kb"));continue}if(!l.type){a.addToast({title:c("assets.files.upload-failed"),severity:"error"}),console.error("No mime type");continue}if(!i.concat(s).includes(l.type)){a.addToast({title:c("assets.files.type-not-allowed"),severity:"error"}),console.warn("".concat(l.name," not loaded - Mime type not allowed ").concat(l.type,"."));continue}const t=i.includes(l.type),n=s.includes(l.type),o=V(await l.arrayBuffer()),d=Pi.createId(o),u=await RO(l,d,t,n);let f;t&&(f=e.createTemporaryAssetPreview(d,l)),h.push(u),p.push({asset:u,file:l,temporaryAssetPreview:f})}Promise.allSettled(p.map((async t=>{try{const n=await e.getAssetForExternalContent({type:"file",file:t.file});if(!n)throw Error("Could not create an asset");e.updateAssets([l(l({},n),{},{id:t.asset.id})])}catch(n){return a.addToast({title:c("assets.files.upload-failed"),severity:"error"}),void console.error(n)}}))),LO(e,h,u)})),e.registerExternalContentHandler("text",(async t=>{let{point:n,text:o}=t;const r=null!==n&&void 0!==n?n:e.inputs.shiftKey?e.inputs.currentPagePoint:e.getViewportPageBounds().center,i=e.getShapeUtil("text").getDefaultProps(),s=OO(o),a=e.getOnlySelectedShape();if(a&&"text"in a.props)return void e.updateShapes([{id:a.id,type:a.type,props:{text:s}}]);let c,d,u,h="middle";const p=s.split("\n").length>1,f=TO(s);p&&(h=p?f?"end":"start":"middle");const g=e.textMeasure.measureText(s,l(l({},bO),{},{fontFamily:PO[i.font],fontSize:xO[i.size],maxWidth:null})),m=Math.min(p?.9*e.getViewportPageBounds().width:920,Math.max(200,.9*e.getViewportPageBounds().width));if(g.w>m){const t=e.textMeasure.measureText(s,l(l({},bO),{},{fontFamily:PO[i.font],fontSize:xO[i.size],maxWidth:m}));c=t.w,d=t.h,u=!1,h=f?"end":"start"}else c=g.w,d=g.h,u=!0;r.y-d/2<e.getViewportPageBounds().minY+40&&(r.y=e.getViewportPageBounds().minY+40+d/2),e.createShapes([{id:Ko(),type:"text",x:r.x-c/2,y:r.y-d/2,props:{text:s,textAlign:h,autoSize:u,w:c}}])})),e.registerExternalContentHandler("url",(async t=>{let{point:n,url:o}=t;const r=e.getShapeUtil("embed"),i=null===r||void 0===r?void 0:r.getEmbedDefinition(o);if(i)return e.putExternalContent({type:"embed",url:i.url,point:n,embed:i.definition});const s=null!==n&&void 0!==n?n:e.inputs.shiftKey?e.inputs.currentPagePoint:e.getViewportPageBounds().center,l=Pi.createId(K(o)),d=function(e,t,n){const o={id:Ko(),type:"bookmark",x:n.x-150,y:n.y-160,opacity:1,props:{assetId:null,url:t}};return e.run((()=>{e.createShapes([o]).select(o.id),zO(e,n)})),e.getShape(o.id)}(e,o,s);let u=e.getAsset(l),h=!1;if(!u){h=!0;try{const t=await e.getAssetForExternalContent({type:"url",url:o});if(!t)throw Error("Could not create an asset");u=t}catch(p){return void a.addToast({title:c("assets.url.failed"),severity:"error"})}}e.run((()=>{h&&e.createAssets([u]),e.updateShapes([{id:d.id,type:d.type,props:{assetId:u.id}}])}))}))}async function RO(e,t,n,o){let r=e.type;"video/quicktime"===e.type&&(r="video/mp4");const i=n?await ae.getImageSize(e):await ae.getVideoSize(e),s=await ae.isAnimated(e)||o;return{id:t,type:n?"image":"video",typeName:"asset",props:{name:e.name,src:"",w:i.w,h:i.h,fileSize:e.size,mimeType:r,isAnimated:s},meta:{}}}async function LO(e,t,n){if(!t.length)return[];const o=Vs.From(n),r=[];for(let i=0;i<t.length;i++){const e=t[i];switch(e.type){case"image":r.push({id:Ko(),type:"image",x:o.x,y:o.y,opacity:1,props:{assetId:e.id,w:e.props.w,h:e.props.h}}),o.x+=e.props.w;break;case"video":r.push({id:Ko(),type:"video",x:o.x,y:o.y,opacity:1,props:{assetId:e.id,w:e.props.w,h:e.props.h}}),o.x+=e.props.w}}return e.run((()=>{const o=t.filter((t=>!e.getAsset(t.id)));o.length&&e.createAssets(o),e.createShapes(r).select(...r.map((e=>e.id))),zO(e,n)})),r.map((e=>e.id))}function zO(e,t){const n=e.getViewportPageBounds();let o=e.getSelectionPageBounds();if(o){const n=o.center.sub(t);e.updateShapes(e.getSelectedShapes().map((t=>{const o=e.getShapeParentTransform(t).decompose().rotation,r=Vs.Rot(n,-o);return{id:t.id,type:t.type,x:t.x-r.x,y:t.y-r.y}})))}if(o=e.getSelectionPageBounds(),o&&e.getInstanceState().isGridMode){const t=e.getDocumentSettings().gridSize,n=new Vs(o.minX,o.minY),r=n.clone().snapToGrid(t),i=Vs.Sub(n,r);e.updateShapes(e.getSelectedShapes().map((e=>{const t={x:e.x-i.x,y:e.y-i.y};return{id:e.id,type:e.type,x:t.x,y:t.y}})))}o=e.getSelectionPageBounds(),o&&!n.contains(o)&&e.zoomToSelection({animation:{duration:e.options.animationMediumMs}})}class NO extends gm{onPointerDown(e){this.parent.transition("pointing",e)}onEnter(){this.editor.setCursor({type:"cross",rotation:0})}onCancel(){this.editor.setCurrentTool("select")}onKeyUp(e){if("Enter"===e.key){if(this.editor.getIsReadonly())return null;const n=this.editor.getOnlySelectedShape();var t;if(n&&this.editor.getShapeUtil(n).canEdit(n))this.editor.setCurrentTool("select"),this.editor.setEditingShape(n.id),null===(t=this.editor.root.getCurrent())||void 0===t||t.transition("editing_shape",l(l({},e),{},{target:"shape",shape:n}))}}}s(NO,"id","idle");class FO extends gm{constructor(){super(...arguments),s(this,"shape",void 0),s(this,"markId",""),s(this,"preciseTimeout",-1),s(this,"didTimeout",!1)}onEnter(){this.markId="",this.didTimeout=!1;const e=this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint,{filter:e=>!e.isLocked&&this.editor.canBindShapes({fromShape:"arrow",toShape:e,binding:"arrow"}),margin:0,hitInside:!0,renderingOnly:!0});e?this.editor.setHintingShapes([e.id]):this.createArrowShape(),this.startPreciseTimeout()}onExit(){this.shape=void 0,this.editor.setHintingShapes([]),this.clearPreciseTimeout()}onPointerMove(){if(this.editor.inputs.isDragging){if(this.shape||this.createArrowShape(),!this.shape)throw Error("expected shape");this.updateArrowShapeEndHandle(),this.editor.setCurrentTool("select.dragging_handle",{shape:this.shape,handle:{id:"end",type:"vertex",index:"a3",x:0,y:0},isCreating:!0,creatingMarkId:this.markId||void 0,onInteractionEnd:"arrow"})}}onPointerUp(){this.cancel()}onCancel(){this.cancel()}onComplete(){this.cancel()}onInterrupt(){this.cancel()}cancel(){this.shape&&this.editor.bailToMark(this.markId),this.editor.setHintingShapes([]),this.parent.transition("idle")}createArrowShape(){var e;const{originPagePoint:t}=this.editor.inputs,n=Ko();this.markId=this.editor.markHistoryStoppingPoint("creating_arrow:".concat(n));const o=zb(t,this.editor);this.editor.createShape({id:n,type:"arrow",x:o.x,y:o.y,props:{scale:this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1}});const r=this.editor.getShape(n);if(!r)throw Error("expected shape");const i=this.editor.getShapeHandles(r);if(!i)throw Error("expected handles for arrow");const s=this.editor.getShapeUtil("arrow"),a=this.shape,c=i.find((e=>"start"===e.id)),d=null===(e=s.onHandleDrag)||void 0===e?void 0:e.call(s,r,{handle:l(l({},c),{},{x:0,y:0}),isPrecise:!0,initial:a});d&&this.editor.updateShapes([d]),this.shape=this.editor.getShape(n),this.editor.select(n)}updateArrowShapeEndHandle(){const e=this.shape;if(!e)throw Error("expected shape");const t=this.editor.getShapeHandles(e);if(!t)throw Error("expected handles for arrow");{var n;const o=this.editor.getShapeUtil("arrow"),r=this.shape,i=t.find((e=>"start"===e.id)),s=null===(n=o.onHandleDrag)||void 0===n?void 0:n.call(o,e,{handle:l(l({},i),{},{x:0,y:0}),isPrecise:this.didTimeout,initial:r});s&&this.editor.updateShapes([s])}{var o;const n=this.editor.getShapeUtil("arrow"),r=this.shape,i=this.editor.getPointInShapeSpace(e,this.editor.inputs.currentPagePoint),s=t.find((e=>"end"===e.id)),a=null===(o=n.onHandleDrag)||void 0===o?void 0:o.call(n,this.editor.getShape(e),{handle:l(l({},s),{},{x:i.x,y:i.y}),isPrecise:!1,initial:r});a&&this.editor.updateShapes([a])}this.shape=this.editor.getShape(e.id)}startPreciseTimeout(){this.preciseTimeout=this.editor.timers.setTimeout((()=>{this.getIsActive()&&(this.didTimeout=!0)}),320)}clearPreciseTimeout(){clearTimeout(this.preciseTimeout)}}s(FO,"id","pointing");class BO extends gm{constructor(){super(...arguments),s(this,"shapeType","arrow")}static children(){return[NO,FO]}}s(BO,"id","arrow"),s(BO,"initial","idle");class UO extends gm{constructor(){super(...arguments),s(this,"info",{}),s(this,"initialShape",void 0),s(this,"shapeType","highlight"===this.parent.id?"highlight":"draw"),s(this,"util",this.editor.getShapeUtil(this.shapeType)),s(this,"isPen",!1),s(this,"isPenOrStylus",!1),s(this,"segmentMode","free"),s(this,"didJustShiftClickToExtendPreviousShapeLine",!1),s(this,"pagePointWhereCurrentSegmentChanged",{}),s(this,"pagePointWhereNextSegmentChanged",null),s(this,"lastRecordedPoint",{}),s(this,"mergeNextPoint",!1),s(this,"currentLineLength",0),s(this,"markId",null)}onEnter(e){this.markId=null,this.info=e,this.lastRecordedPoint=this.editor.inputs.currentPagePoint.clone(),this.startShape()}onPointerMove(){const{inputs:e}=this.editor;if(this.isPen&&!e.isPen&&this.markId)return this.editor.bailToMark(this.markId),void this.startShape();this.isPenOrStylus?Vs.Dist(e.currentPagePoint,this.lastRecordedPoint)>=1/this.editor.getZoomLevel()?(this.lastRecordedPoint=e.currentPagePoint.clone(),this.mergeNextPoint=!1):this.mergeNextPoint=!0:this.mergeNextPoint=!1,this.updateDrawingShape()}onKeyDown(e){if("Shift"===e.key)switch(this.segmentMode){case"free":this.segmentMode="starting_straight",this.pagePointWhereNextSegmentChanged=this.editor.inputs.currentPagePoint.clone();break;case"starting_free":this.segmentMode="starting_straight"}this.updateDrawingShape()}onKeyUp(e){if("Shift"===e.key)switch(this.editor.snaps.clearIndicators(),this.segmentMode){case"straight":this.segmentMode="starting_free",this.pagePointWhereNextSegmentChanged=this.editor.inputs.currentPagePoint.clone();break;case"starting_straight":this.pagePointWhereNextSegmentChanged=null,this.segmentMode="free"}this.updateDrawingShape()}onExit(){this.editor.snaps.clearIndicators(),this.pagePointWhereCurrentSegmentChanged=this.editor.inputs.currentPagePoint.clone()}canClose(){return"highlight"!==this.shapeType}getIsClosed(e,t,n){if(!this.canClose())return!1;const o=wO[t],r=e[0].points[0],i=e[e.length-1],s=i.points[i.points.length-1];return r!==s&&this.currentLineLength>4*o*n&&Vs.DistMin(r,s,2*o*n)}startShape(){const{inputs:{originPagePoint:e,isPen:t}}=this.editor;this.markId=this.editor.markHistoryStoppingPoint("draw start");const{z:n=.5}=this.info.point;this.isPen=t,this.isPenOrStylus=t||n>0&&n<.5||n>.5&&n<1;const o=this.isPenOrStylus?1.25*n:.5;if(this.segmentMode=this.editor.inputs.shiftKey?"straight":"free",this.didJustShiftClickToExtendPreviousShapeLine=!1,this.lastRecordedPoint=e.clone(),this.initialShape){const t=this.editor.getShape(this.initialShape.id);if(t&&"straight"===this.segmentMode){this.didJustShiftClickToExtendPreviousShapeLine=!0;const n=_(t.props.segments);if(!n)throw Error("Expected a previous segment!");const r=_(n.points);if(!r)throw Error("Expected a previous point!");const{x:i,y:s}=this.editor.getPointInShapeSpace(t,e).toFixed(),a={type:this.segmentMode,points:[{x:r.x,y:r.y,z:+o.toFixed(2)},{x:i,y:s,z:+o.toFixed(2)}]},l=ic.applyToPoint(this.editor.getShapePageTransform(t.id),r);this.pagePointWhereCurrentSegmentChanged=l,this.pagePointWhereNextSegmentChanged=null;const c=[...t.props.segments,a];this.currentLineLength<4*wO[t.props.size]&&(this.currentLineLength=this.getLineLength(c));const d={id:t.id,type:this.shapeType,props:{segments:c}};return this.canClose()&&(d.props.isClosed=this.getIsClosed(c,t.props.size,t.props.scale)),void this.editor.updateShapes([d])}}this.pagePointWhereCurrentSegmentChanged=e.clone();const r=Ko();this.editor.createShapes([{id:r,type:this.shapeType,x:e.x,y:e.y,props:{isPen:this.isPenOrStylus,scale:this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1,segments:[{type:this.segmentMode,points:[{x:0,y:0,z:+o.toFixed(2)}]}]}}]),this.currentLineLength=0,this.initialShape=this.editor.getShape(r)}updateDrawingShape(){const{initialShape:e}=this,{inputs:t}=this.editor;if(!e)return;const{id:n,props:{size:o,scale:r}}=e,i=this.editor.getShape(n);if(!i)return;const{segments:s}=i.props,{x:a,y:c,z:d}=this.editor.getPointInShapeSpace(i,t.currentPagePoint).toFixed(),u={x:a,y:c,z:this.isPenOrStylus?+(1.25*t.currentPagePoint.z).toFixed(2):.5};switch(this.segmentMode){case"starting_straight":{const{pagePointWhereNextSegmentChanged:e}=this;if(null===e)throw Error("We should have a point where the segment changed");if(Vs.Dist2(e,t.currentPagePoint)>this.editor.options.dragDistanceSquared){this.pagePointWhereCurrentSegmentChanged=this.pagePointWhereNextSegmentChanged.clone(),this.pagePointWhereNextSegmentChanged=null,this.segmentMode="straight";const e=_(s);if(!e)throw Error("Expected a previous segment!");const t=_(e.points);if(!t)throw Error("Expected a previous last point!");let a;const c=this.editor.getPointInShapeSpace(i,this.pagePointWhereCurrentSegmentChanged).toFixed().toJson();if("straight"===e.type){this.currentLineLength+=Vs.Dist(t,c),a={type:"straight",points:[l({},t),c]};const e=this.editor.getShapePageTransform(i);this.pagePointWhereCurrentSegmentChanged=ic.applyToPoint(e,t)}else a={type:"straight",points:[c,u]};const d={id:n,type:this.shapeType,props:{segments:[...s,a]}};this.canClose()&&(d.props.isClosed=this.getIsClosed(s,o,r)),this.editor.updateShapes([d])}break}case"starting_free":{const{pagePointWhereNextSegmentChanged:e}=this;if(null===e)throw Error("We should have a point where the segment changed");if(Vs.Dist2(e,t.currentPagePoint)>this.editor.options.dragDistanceSquared){this.pagePointWhereCurrentSegmentChanged=this.pagePointWhereNextSegmentChanged.clone(),this.pagePointWhereNextSegmentChanged=null,this.segmentMode="free";const e=s.slice(),t=_(e[e.length-1].points);if(!t)throw Error("No previous point!");const a={type:"free",points:[...Vs.PointsBetween(t,u,6).map((e=>({x:ma(e.x),y:ma(e.y),z:ma(e.z)})))]},l=[...e,a];this.currentLineLength<4*wO[i.props.size]&&(this.currentLineLength=this.getLineLength(l));const c={id:n,type:this.shapeType,props:{segments:l}};this.canClose()&&(c.props.isClosed=this.getIsClosed(l,o,r)),this.editor.updateShapes([c])}break}case"straight":{const e=s.slice(),t=e[e.length-1],{pagePointWhereCurrentSegmentChanged:a}=this,{ctrlKey:c,currentPagePoint:d}=this.editor.inputs;if(!a)throw Error("We should have a point where the segment changed");let u,h=!1;this.didJustShiftClickToExtendPreviousShapeLine?this.editor.inputs.isDragging&&(h=!c,this.didJustShiftClickToExtendPreviousShapeLine=!1):h=!c;let p,f=this.editor.getPointInShapeSpace(i,d).toFixed().toJson(),g=!1;if((this.editor.user.getIsSnapMode()?!c:c)&&e.length>2){let e,t=8/this.editor.getZoomLevel();for(let n=0,o=s.length-2;n<o;n++){const o=s[n];if(!o)break;if("free"===o.type)continue;const r=o.points[0],i=_(o.points);if(!r||!i)continue;const a=Vs.NearestPointOnLineSegment(r,i,f);if(Vs.DistMin(a,f,t)){e=a.toFixed().toJson(),t=Vs.Dist(a,f),p=o;break}}e&&(g=!0,f=e)}if(g&&p){const e=this.editor.getShapePageTransform(i),t=p.points[0],n=_(p.points);if(!n)throw Error("Expected a last point!");const o=ic.applyToPoint(e,t),r=ic.applyToPoint(e,n),s=ic.applyToPoint(e,f);this.editor.snaps.setIndicators([{id:$(),type:"points",points:[o,s,r]}])}else{if(this.editor.snaps.clearIndicators(),h){const e=Vs.Angle(a,d),t=aa(e,24)-e;u=Vs.RotWith(d,a,t)}else u=d;f=this.editor.getPointInShapeSpace(i,u).toFixed().toJson()}this.currentLineLength+=Vs.Dist(t.points[0],f),e[e.length-1]=l(l({},t),{},{type:"straight",points:[t.points[0],f]});const m={id:n,type:this.shapeType,props:{segments:e}};this.canClose()&&(m.props.isClosed=this.getIsClosed(s,o,r)),this.editor.updateShapes([m]);break}case"free":{const e=s.slice(),a=e[e.length-1],c=[...a.points];if(c.length&&this.mergeNextPoint){const{z:e}=c[c.length-1];c[c.length-1]={x:u.x,y:u.y,z:e?Math.max(e,u.z):u.z}}else this.currentLineLength+=Vs.Dist(c[c.length-1],u),c.push(u);e[e.length-1]=l(l({},a),{},{points:c}),this.currentLineLength<4*wO[i.props.size]&&(this.currentLineLength=this.getLineLength(e));const h={id:n,type:this.shapeType,props:{segments:e}};if(this.canClose()&&(h.props.isClosed=this.getIsClosed(e,o,r)),this.editor.updateShapes([h]),c.length>this.editor.options.maxPointsPerDrawShape){this.editor.updateShapes([{id:n,type:this.shapeType,props:{isComplete:!0}}]);const e=Ko(),o=this.editor.getShape(n).props;this.editor.createShapes([{id:e,type:this.shapeType,x:ma(t.currentPagePoint.x),y:ma(t.currentPagePoint.y),props:{isPen:this.isPenOrStylus,scale:o.scale,segments:[{type:"free",points:[{x:0,y:0,z:this.isPenOrStylus?+(1.25*d).toFixed():.5}]}]}}]),this.initialShape=bt(this.editor.getShape(e)),this.mergeNextPoint=!1,this.lastRecordedPoint=t.currentPagePoint.clone(),this.currentLineLength=0}break}}}getLineLength(e){let t=0;for(const n of e)for(let e=0;e<n.points.length-1;e++){const o=n.points[e],r=n.points[e+1];t+=Vs.Dist2(r,o)}return Math.sqrt(t)}onPointerUp(){this.complete()}onCancel(){this.cancel()}onComplete(){this.complete()}onInterrupt(){this.editor.inputs.isDragging||(this.markId&&this.editor.bailToMark(this.markId),this.cancel())}complete(){const{initialShape:e}=this;e&&(this.editor.updateShapes([{id:e.id,type:e.type,props:{isComplete:!0}}]),this.parent.transition("idle"))}cancel(){this.parent.transition("idle",this.info)}}s(UO,"id","drawing");class HO extends gm{onPointerDown(e){this.parent.transition("drawing",e)}onEnter(){this.editor.setCursor({type:"cross",rotation:0})}onCancel(){this.editor.setCurrentTool("select")}}s(HO,"id","idle");class KO extends gm{constructor(){super(...arguments),s(this,"shapeType","draw")}static children(){return[HO,UO]}onExit(){this.children.drawing.initialShape=void 0}}s(KO,"id","draw"),s(KO,"initial","idle"),s(KO,"isLockable",!1);class VO extends Nb{constructor(){super(...arguments),s(this,"shapeType","frame")}onCreate(e){if(!e)return;const t=this.editor.getShapePageBounds(e),n=[],o=this.editor.getShapeAncestors(e).map((e=>e.id));this.editor.getSortedChildIdsForParent(e.parentId).map((r=>{const i=this.editor.getShape(r);if(!i)return;if(i.id===e.id)return;if(i.isLocked)return;const s=this.editor.getShapePageBounds(i);s&&t.contains(s)&&function(e,t,n){if(t.includes(e.id))return!1;if(e.parentId===n.parentId)return!0;return!1}(i,o,e)&&n.push(i.id)})),this.editor.reparentShapes(n,e.id),this.editor.getInstanceState().isToolLocked?this.editor.setCurrentTool("frame"):this.editor.setCurrentTool("select.idle")}}s(VO,"id","frame"),s(VO,"initial","idle");class WO extends gm{onPointerDown(e){this.parent.transition("pointing",e)}onEnter(){this.editor.setCursor({type:"cross",rotation:0})}onKeyUp(e){if("Enter"===e.key){if(this.editor.getIsReadonly())return null;const n=this.editor.getOnlySelectedShape();var t;if(n&&this.editor.getShapeUtil(n).canEdit(n))this.editor.setCurrentTool("select"),this.editor.setEditingShape(n.id),null===(t=this.editor.root.getCurrent())||void 0===t||t.transition("editing_shape",l(l({},e),{},{target:"shape",shape:n}))}}onCancel(){this.editor.setCurrentTool("select")}}s(WO,"id","idle");class qO extends gm{onPointerUp(){this.complete()}onPointerMove(e){if(this.editor.inputs.isDragging){const{originPagePoint:t}=this.editor.inputs,n=Ko(),o=this.editor.markHistoryStoppingPoint("creating_geo:".concat(n)),r=zb(t,this.editor);this.editor.createShapes([{id:n,type:"geo",x:r.x,y:r.y,props:{w:1,h:1,geo:this.editor.getStyleForNextShape(Ui),scale:this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1}}]).select(n).setCurrentTool("select.resizing",l(l({},e),{},{target:"selection",handle:"bottom_right",isCreating:!0,creatingMarkId:o,creationCursorOffset:{x:1,y:1},onInteractionEnd:"geo"}))}}onCancel(){this.cancel()}onComplete(){this.complete()}onInterrupt(){this.cancel()}complete(){const{originPagePoint:e}=this.editor.inputs,t=Ko();this.editor.markHistoryStoppingPoint("creating_geo:".concat(t));const n=this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1,o=this.editor.getStyleForNextShape(Ui),r="star"===o?{w:200,h:190}:"cloud"===o?{w:300,h:180}:{w:200,h:200};this.editor.createShapes([{id:t,type:"geo",x:e.x,y:e.y,props:l({geo:this.editor.getStyleForNextShape(Ui),scale:n},r)}]);const i=this.editor.getShape(t);if(!i)return;const{w:s,h:a}=i.props,c=new Vs(s/2,a/2).mul(n),d=this.editor.getShapeParentTransform(i);d&&c.rot(-d.rotation());const u=zb(new Vs(i.x-c.x,i.y-c.y),this.editor);this.editor.select(t),this.editor.updateShape({id:i.id,type:"geo",x:u.x,y:u.y,props:{geo:this.editor.getStyleForNextShape(Ui),w:s*n,h:a*n}}),this.editor.getInstanceState().isToolLocked?this.parent.transition("idle"):this.editor.setCurrentTool("select",{})}cancel(){this.parent.transition("idle")}}s(qO,"id","pointing");class YO extends gm{constructor(){super(...arguments),s(this,"shapeType","geo")}static children(){return[WO,qO]}}s(YO,"id","geo"),s(YO,"initial","idle");class GO extends gm{constructor(){super(...arguments),s(this,"shapeType","highlight")}static children(){return[HO,UO]}onExit(){this.children.drawing.initialShape=void 0}}s(GO,"id","highlight"),s(GO,"initial","idle"),s(GO,"isLockable",!1);class XO extends gm{constructor(){super(...arguments),s(this,"shapeId","")}onEnter(e){this.shapeId=e.shapeId,this.editor.setCursor({type:"cross",rotation:0})}onPointerDown(){this.parent.transition("pointing",{shapeId:this.shapeId})}onCancel(){this.editor.setCurrentTool("select")}}s(XO,"id","idle");class $O extends gm{constructor(){super(...arguments),s(this,"shape",{}),s(this,"markId",void 0)}onEnter(e){const{inputs:t}=this.editor,{currentPagePoint:n}=t;this.markId=void 0;const o=e.shapeId&&this.editor.getShape(e.shapeId);if(o&&t.shiftKey){this.markId=this.editor.markHistoryStoppingPoint("creating_line:".concat(o.id)),this.shape=o;const e=this.editor.getShapeHandles(this.shape);if(!e)return;const t=e.filter((e=>"vertex"===e.type)).sort(Je),r=t[t.length-1],i=t[t.length-2],s=ic.applyToPoint(this.editor.getShapeParentTransform(this.shape),new Vs(this.shape.x,this.shape.y)),a=zb(Vs.Sub(n,s).addXY(.1,.1),this.editor),l=bt(this.shape.props.points);if(Vs.DistMin(r,i,2)||Vs.DistMin(a,r,2))l[r.id]={id:r.id,index:r.index,x:a.x,y:a.y};else{const e=Ze(r.index);l[e]={id:e,index:e,x:a.x,y:a.y}}this.editor.updateShapes([{id:this.shape.id,type:this.shape.type,props:{points:l}}])}else{const e=Ko();this.markId=this.editor.markHistoryStoppingPoint("creating_line:".concat(e));const t=zb(n,this.editor);this.editor.createShapes([{id:e,type:"line",x:t.x,y:t.y,props:{scale:this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1}}]),this.editor.select(e),this.shape=this.editor.getShape(e)}}onPointerMove(){if(this.shape&&this.editor.inputs.isDragging){const e=this.editor.getShapeHandles(this.shape);if(!e)throw this.markId&&this.editor.bailToMark(this.markId),Error("No handles found");const t=_(e);this.editor.setCurrentTool("select.dragging_handle",{shape:this.shape,isCreating:!0,creatingMarkId:this.markId,handle:l(l({},t),{},{x:t.x-.1,y:t.y-.1}),onInteractionEnd:"line"})}}onPointerUp(){this.complete()}onCancel(){this.cancel()}onComplete(){this.complete()}onInterrupt(){this.parent.transition("idle"),this.markId&&this.editor.bailToMark(this.markId),this.editor.snaps.clearIndicators()}complete(){this.parent.transition("idle",{shapeId:this.shape.id}),this.editor.snaps.clearIndicators()}cancel(){this.markId&&this.editor.bailToMark(this.markId),this.parent.transition("idle",{shapeId:this.shape.id}),this.editor.snaps.clearIndicators()}}s($O,"id","pointing");class ZO extends gm{constructor(){super(...arguments),s(this,"shapeType","line")}static children(){return[XO,$O]}}s(ZO,"id","line"),s(ZO,"initial","idle");class QO extends gm{onPointerDown(e){this.parent.transition("pointing",e)}onEnter(){this.editor.setCursor({type:"cross",rotation:0})}onCancel(){this.editor.setCurrentTool("select")}}s(QO,"id","idle");const JO=200,eD=new Vs(100,100);function tD(e,t){if(1===t)return(e=>[[["a1"],new Vs(100,-100-e.options.adjacentShapeMargin)],[["a2"],new Vs(300+e.options.adjacentShapeMargin,100)],[["a3"],new Vs(100,300+e.options.adjacentShapeMargin)],[["a4"],new Vs(-100-e.options.adjacentShapeMargin,100)]])(e);const n=JO*t,o=e.options.adjacentShapeMargin*t;return[[["a1"],new Vs(.5*n,-.5*n-o)],[["a2"],new Vs(1.5*n+o,.5*n)],[["a3"],new Vs(.5*n,1.5*n+o)],[["a4"],new Vs(-.5*n-o,.5*n)]]}function nD(e,t,n,o,r,i){return Object.fromEntries(tD(e,i).map(((e,i)=>{let[s,a]=e;const l=a.clone();return 0===i&&r?l.y-=r:2===i&&o&&(l.y+=o),[s,l.rot(n).add(t)]})))}function oD(e,t,n,o){const r=new Set(e.getSelectedShapeIds()),i=(JO+e.options.adjacentShapeMargin+o)**2,s=new Map,a=[];for(const d of e.getCurrentPageShapes()){if(!e.isShapeOfType(d,"note")||n!==d.props.scale||r.has(d.id))continue;const i=e.getShapePageTransform(d.id);t===i.rotation()&&(s.set(d,e.getShapePageBounds(d).center),a.push(...Object.values(nD(e,i.point(),t,d.props.growY,o,n))))}const l=a.length;let c;for(const[d,u]of s)for(let t=0;t<l;t++)c=a[t],c&&(Vs.Dist2(u,c)>i||e.isPointInShape(d,c)&&(a[t]=void 0));return C(a)}function rD(e,t,n,o){let r,i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const s=e.getCurrentPageShapesSorted(),a=(JO+e.options.adjacentShapeMargin**2)**t.props.scale;for(let l=s.length-1;l>=0;l--){const o=s[l];if("note"===o.type&&o.id!==t.id){const t=e.getShapePageBounds(o);if(t&&Vs.Dist2(t.center,n)<a&&e.isPointInShape(o,n)){r=o;break}}}if(e.complete(),!r||i){e.markHistoryStoppingPoint("creating note shape");const i=Ko();e.createShape({id:i,type:"note",x:n.x,y:n.y,rotation:o,opacity:t.opacity,props:l(l({},t.props),{},{text:"",growY:0,fontSizeAdjustment:0,url:""})});const s=e.getShape(i);if(!s)return;const a=e.getPointInParentSpace(s,Vs.Sub(n,Vs.Rot(eD.clone().mul(s.props.scale),o)));e.updateShape({id:i,type:"note",x:a.x,y:a.y}),r=e.getShape(i)}return function(e){const t=e.getSelectionPageBounds(),n=e.getViewportPageBounds();if(t&&!n.contains(t)){const o=t.clone().expandBy(iD/e.getZoomLevel()).expand(n),r=n.clone().translate({x:2*(o.center.x-n.center.x),y:2*(o.center.y-n.center.y)});e.zoomToBounds(r,{animation:{duration:e.options.animationMediumMs},inset:0})}}(e),r}const iD=16;class sD extends gm{constructor(){super(...arguments),s(this,"dragged",!1),s(this,"info",{}),s(this,"markId",""),s(this,"shape",{})}onEnter(){const{editor:e}=this,t=Ko();this.markId=e.markHistoryStoppingPoint("creating_note:".concat(t));const n=this.editor.inputs.originPagePoint.clone(),o=function(e,t,n){let o,r=10/e.getZoomLevel();for(const i of oD(e,0,n,0)){const e=Vs.Sub(t,i),n=e.len();n<r&&(r=n,o=e)}return o}(this.editor,n,this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1);o&&n.sub(o),this.shape=function(e,t,n){e.createShape({id:t,type:"note",x:n.x,y:n.y,props:{scale:e.user.getIsDynamicResizeMode()?1/e.getZoomLevel():1}}).select(t);const o=e.getShape(t),r=e.getShapeGeometry(o).bounds,i=zb(new Vs(o.x-r.width/2,o.y-r.height/2),e);return e.updateShapes([{id:t,type:"note",x:i.x,y:i.y}]),e.getShape(t)}(this.editor,t,n)}onPointerMove(e){this.editor.inputs.isDragging&&this.editor.setCurrentTool("select.translating",l(l({},e),{},{target:"shape",shape:this.shape,onInteractionEnd:"note",isCreating:!0,creatingMarkId:this.markId,onCreate:()=>{this.editor.setEditingShape(this.shape.id),this.editor.setCurrentTool("select.editing_shape")}}))}onPointerUp(){this.complete()}onInterrupt(){this.cancel()}onComplete(){this.complete()}onCancel(){this.cancel()}complete(){this.editor.getInstanceState().isToolLocked?this.parent.transition("idle"):(this.editor.setEditingShape(this.shape.id),this.editor.setCurrentTool("select.editing_shape",l(l({},this.info),{},{target:"shape",shape:this.shape})))}cancel(){this.editor.bailToMark(this.markId),this.parent.transition("idle",this.info)}}s(sD,"id","pointing");class aD extends gm{constructor(){super(...arguments),s(this,"shapeType","note")}static children(){return[QO,sD]}}s(aD,"id","note"),s(aD,"initial","idle");const lD=y((function(e){const t=e.getShapeAtPoint(e.inputs.currentPagePoint,{hitInside:!1,hitLabels:!1,margin:e.options.hitTestMargin/e.getZoomLevel(),renderingOnly:!0});if(!t)return e.setHoveredShape(null);let n;const o=e.getOutermostSelectableShape(t);return n=o===t||o.id===e.getFocusedGroupId()||e.getSelectedShapeIds().includes(o.id)?t:o,e.setHoveredShape(n.id)}),32);class cD extends gm{onPointerMove(e){switch(e.target){case"shape":case"canvas":lD(this.editor)}}onPointerDown(e){this.parent.transition("pointing",e)}onEnter(){this.editor.setCursor({type:"cross",rotation:0})}onExit(){lD.cancel()}onKeyDown(e){if("Enter"===e.key){if(this.editor.getIsReadonly())return null;const n=this.editor.getOnlySelectedShape();var t;if(n&&this.editor.getShapeUtil(n).canEdit(n))this.editor.setCurrentTool("select"),this.editor.setEditingShape(n.id),null===(t=this.editor.root.getCurrent())||void 0===t||t.transition("editing_shape",l(l({},e),{},{target:"shape",shape:n}))}}onCancel(){this.editor.setCurrentTool("select")}}s(cD,"id","idle");class dD extends gm{constructor(){super(...arguments),s(this,"shape",void 0),s(this,"markId",""),s(this,"enterTime",0)}onEnter(){this.enterTime=Date.now()}onExit(){this.editor.setHintingShapes([])}onPointerMove(e){if(Date.now()-this.enterTime<150)return;const{editor:t}=this,{isPointing:n}=t.inputs;if(!n)return;const{originPagePoint:o,currentPagePoint:r}=t.inputs,i=Math.abs(o.x-r.x);if(i>6*Math.sqrt(t.getInstanceState().isCoarsePointer?t.options.coarseDragDistanceSquared:t.options.dragDistanceSquared)/t.getZoomLevel()){const n=Ko();this.markId=t.markHistoryStoppingPoint("creating_text:".concat(n));const r=this.createTextShape(n,o,!1,i);if(!r)return void this.cancel();this.shape=t.getShape(r),t.select(n),t.setCurrentTool("select.resizing",l(l({},e),{},{target:"selection",handle:"right",isCreating:!0,creatingMarkId:this.markId,creationCursorOffset:{x:i,y:1},onInteractionEnd:"text",onCreate:()=>{t.setEditingShape(r.id)}}))}}onPointerUp(){this.complete()}onComplete(){this.cancel()}onCancel(){this.cancel()}onInterrupt(){this.cancel()}complete(){this.editor.markHistoryStoppingPoint("creating text shape");const e=Ko(),{originPagePoint:t}=this.editor.inputs;this.createTextShape(e,t,!0,20)&&(this.editor.select(e),this.editor.setEditingShape(e))}cancel(){this.parent.transition("idle"),this.editor.bailToMark(this.markId)}createTextShape(e,t,n,o){this.editor.createShape({id:e,type:"text",x:t.x,y:t.y,props:{text:"",autoSize:n,w:o,scale:this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1}});const r=this.editor.getShape(e);if(!r)return void this.cancel();const i=this.editor.getShapePageBounds(r),s=new Vs;if(n)switch(r.props.textAlign){case"start":s.x=0;break;case"middle":s.x=-i.width/2;break;case"end":s.x=-i.width}else s.x=0;if(s.y=-i.height/2,Ho(r.parentId)){const e=this.editor.getShapeParentTransform(r);s.rot(-e.rotation())}const a=r.x+s.x,c=r.y+s.y;if(this.editor.getInstanceState().isGridMode){const e=new Vs(a,c),t=zb(e,this.editor),n=Vs.Sub(e,t);this.editor.updateShape(l(l({},r),{},{x:a-n.x,y:c-n.y}))}else this.editor.updateShape(l(l({},r),{},{x:a,y:c}));return r}}s(dD,"id","pointing");class uD extends gm{constructor(){super(...arguments),s(this,"shapeType","text")}static children(){return[cD,dD]}}s(uD,"id","text"),s(uD,"initial","idle");const hD=[uD,KO,YO,aD,ZO,VO,BO,GO];function pD(){return Zo({isDarkMode:lv()})}function fD(e){return{key:"".concat(nr.id,":").concat(e),async getElement(){const t=function(e){const t=or[e];for(const n of document.fonts)if(t.includes(n.family)&&"$$_url"in n&&"string"===typeof n.$$_url&&"$$_fontface"in n&&"string"===typeof n.$$_fontface)return{url:n.$$_url,fontFaceRule:n.$$_fontface};return null}(e);if(!t)return null;const{url:n,fontFaceRule:o}=t,r=await(await B(n)).blob(),i=await H.blobToDataUrl(r),s=o.replace(n,i);return(0,Ss.jsx)("style",{children:s})}}}function gD(e){return{key:"".concat(nr.id,":").concat(e),getElement:async()=>"pattern"!==e?null:(0,Ss.jsx)(mD,{})}}function mD(){const e=kD(),t=As(),n=pD(),o=8/12;return(0,Ss.jsxs)(Ss.Fragment,{children:[(0,Ss.jsxs)("mask",{id:t,children:[(0,Ss.jsx)("rect",{x:"0",y:"0",width:"8",height:"8",fill:"white"}),(0,Ss.jsxs)("g",{strokeLinecap:"round",stroke:"black",children:[(0,Ss.jsx)("line",{x1:1*o,y1:2,x2:2,y2:1*o}),(0,Ss.jsx)("line",{x1:5*o,y1:7*o,x2:7*o,y2:5*o}),(0,Ss.jsx)("line",{x1:6,y1:11*o,x2:11*o,y2:6})]})]}),(0,Ss.jsx)("pattern",{id:e(1,n.id),width:"8",height:"8",patternUnits:"userSpaceOnUse",children:(0,Ss.jsx)("rect",{x:"0",y:"0",width:"8",height:"8",fill:n.solid,mask:"url(#".concat(t,")")})})]})}function yD(){return{key:"".concat(nr.id,":pattern"),component:_D}}const vD=8,bD=(e,t,n)=>new Promise(((o,r)=>{const i=vD*t*e,s=document.createElement("canvas");s.width=i,s.height=i;const a=s.getContext("2d");if(!a)return;a.fillStyle=n?$o.darkMode.solid:$o.lightMode.solid,a.fillRect(0,0,i,i),a.globalCompositeOperation="destination-out",a.lineCap="round",a.lineWidth=1.25*t*e;const l=8/12,c=n=>n*t*e;a.beginPath(),a.moveTo(c(1*l),c(2)),a.lineTo(c(2),c(1*l)),a.moveTo(c(5*l),c(7*l)),a.lineTo(c(7*l),c(5*l)),a.moveTo(c(6),c(11*l)),a.lineTo(c(11*l),c(6)),a.stroke(),s.toBlob((e=>{!e||Ta.throwToBlob.get()?r():o(e)}))})),wD=(e,t)=>{const n=document.createElement("canvas");n.width=e[0],n.height=e[1];const o=n.getContext("2d");return o?(t(o),n.toDataURL()):""};let xD=null;function SD(e){return Math.ceil(Math.log2(Math.max(1,e)))}function kD(){const t=Os("hash_pattern");return(0,e.useCallback)(((e,n)=>{const o=SD(e);return Ms(t,"".concat(n,"_").concat(o))}),[t])}function PD(e){const t=[],n=SD(e);for(let o=0;o<=n;o++)t.push(Math.pow(2,o));return t}function CD(e){const t=(xD||(xD={white:wD([1,1],(e=>{e.fillStyle="#f8f9fa",e.fillRect(0,0,1,1)})),black:wD([1,1],(e=>{e.fillStyle="#212529",e.fillRect(0,0,1,1)}))}),xD);return PD(e).flatMap((e=>[{zoom:e,url:t.white,theme:"light"},{zoom:e,url:t.black,theme:"dark"}]))}function _D(){const t=Ns(),n=(0,e.useRef)(null),{defs:o,isReady:r}=function(){const t=Ns(),n=yn("devicePixelRatio",(()=>t.getInstanceState().devicePixelRatio),[t]),o=yn("maxZoom",(()=>Math.ceil(_(t.getCameraOptions().zoomSteps))),[t]),[r,i]=(0,e.useState)(!1),[s,a]=(0,e.useState)((()=>CD(o))),l=kD();return(0,e.useEffect)((()=>{const e=Promise.all(PD(o).flatMap((e=>[bD(n,e,!1).then((t=>({zoom:e,theme:"light",url:URL.createObjectURL(t)}))),bD(n,e,!0).then((t=>({zoom:e,theme:"dark",url:URL.createObjectURL(t)})))])));let t=!1;return e.then((e=>{t||(a(e),i(!0))})),()=>{t=!0,i(!1),e.then((e=>{for(const{url:t}of e)URL.revokeObjectURL(t)}))}}),[n,o]),{defs:(0,Ss.jsx)(Ss.Fragment,{children:s.map((e=>{const t=l(e.zoom,e.theme);return(0,Ss.jsx)("pattern",{id:t,width:vD,height:vD,patternUnits:"userSpaceOnUse",children:(0,Ss.jsx)("image",{href:e.url,width:vD,height:vD})},t)}))}),isReady:r}}();return(0,e.useEffect)((()=>{if(r&&ka.isSafari){const e=ID(n.current);e&&t.timers.requestAnimationFrame((()=>{e.style.display="none",t.timers.requestAnimationFrame((()=>{e.style.display=""}))}))}}),[t,r]),(0,Ss.jsx)("g",{ref:n,"data-testid":r?"ready-pattern-fill-defs":void 0,children:o})}function ID(e){return e.classList.contains("tl-html-layer")?e:e.parentElement?ID(e.parentElement):null}const ED=e.memo((function(e){let{theme:t,d:n,color:o,fill:r,scale:i}=e;switch(r){case"none":return null;case"solid":return(0,Ss.jsx)("path",{fill:t[o].semi,d:n});case"semi":return(0,Ss.jsx)("path",{fill:t.solid,d:n});case"fill":return(0,Ss.jsx)("path",{fill:t[o].fill,d:n});case"pattern":return(0,Ss.jsx)(jD,{theme:t,color:o,fill:r,d:n,scale:i})}}));function jD(e){let{d:t,color:n,theme:o}=e;const r=Ns(),i=Ih(),s=yn("zoomLevel",(()=>r.getZoomLevel()),[r]),a=kD(),l=r.getZoomLevel()<=.18;return(0,Ss.jsxs)(Ss.Fragment,{children:[(0,Ss.jsx)("path",{fill:o[n].pattern,d:t}),(0,Ss.jsx)("path",{fill:i?"url(#".concat(a(1,o.id),")"):l?o[n].semi:"url(#".concat(a(s,o.id),")"),d:t})]})}function TD(e,t,n){var o,r;const{padding:i=0}=n;if(0===t.length)return null;const s=rc.From(t[0].box);for(const{box:h}of t)s.union(h);const a=i+(null!==(o=n.offsetX)&&void 0!==o?o:0),l=(null!==(r=n.offsetY)&&void 0!==r?r:0)+n.fontSize/2+("start"===n.verticalTextAlign?i:"end"===n.verticalTextAlign?n.height-i-s.height:(Math.ceil(n.height)-s.height)/2);let c=null;const d=[];for(const{text:h,box:p}of t){null!==c&&p.y>c&&d.push((0,Ss.jsx)("tspan",{alignmentBaseline:"mathematical",x:a,y:p.y+l,children:"\n"},d.length)),d.push((0,Ss.jsx)("tspan",{alignmentBaseline:"mathematical",x:p.x+a,y:p.y+l,unicodeBidi:"plaintext",children:(u=h,u.replace(/\s/g,"\xa0"))},d.length)),c=p.y}var u;return(0,Ss.jsx)("text",{fontSize:n.fontSize,fontFamily:n.fontFamily,fontStyle:n.fontStyle,fontWeight:n.fontWeight,dominantBaseline:"mathematical",alignmentBaseline:"mathematical",stroke:n.stroke,strokeWidth:n.strokeWidth,fill:n.fill,children:d})}function MD(e){let{fontSize:t,font:n,align:o,verticalAlign:r,text:i,labelColor:s,bounds:a,padding:l=16,stroke:c=!0}=e;const d=Ns(),u=pD(),h={fontSize:t,fontFamily:or[n],textAlign:o,verticalTextAlign:r,width:Math.ceil(a.width),height:Math.ceil(a.height),padding:l,lineHeight:bO.lineHeight,fontStyle:"normal",fontWeight:"normal",overflow:"wrap",offsetX:0,offsetY:0,fill:s,stroke:void 0,strokeWidth:void 0},p=d.textMeasure.measureTextSpans(i,h),f=function(e,t,n,o){if(("start-legacy"===e||"end-legacy"===e)&&0!==n.length){const r=rc.From(n[0].box);for(const{box:e}of n)r.union(e);if("start-legacy"===e)return(o-2*t-r.width)/2;if("end-legacy"===e)return-(o-2*t-r.width)/2}}(o,l,p,a.width);f&&(h.offsetX=f),h.offsetX+=a.x,h.offsetY+=a.y;const g=TD(0,p,h);let m=null;return c&&(h.fill=u.background,h.stroke=u.background,h.strokeWidth=2,m=TD(0,p,h)),(0,Ss.jsxs)(Ss.Fragment,{children:[m,g]})}const AD=(0,e.forwardRef)((function(e,t){let{isEditing:n,text:o,handleFocus:r,handleChange:i,handleKeyDown:s,handleBlur:a,handleInputPointerDown:l,handleDoubleClick:c}=e;return(0,Ss.jsx)("textarea",{ref:t,className:"tl-text tl-text-input",name:"text",tabIndex:-1,readOnly:!n,autoComplete:"off",autoCapitalize:"off",autoCorrect:"off",autoSave:"off",placeholder:"",spellCheck:"true",wrap:"off",dir:"auto",defaultValue:o,onFocus:r,onChange:i,onKeyDown:s,onBlur:a,onTouchEnd:za,onContextMenu:n?za:void 0,onPointerDown:l,onDoubleClick:c,onDragStart:Da})}));const OD=["rInput","isEmpty","isEditing","isEditingAnything"],DD=e.memo((function(t){let{shapeId:n,type:o,text:r,labelColor:i,font:s,fontSize:a,lineHeight:c,align:d,verticalAlign:u,wrap:h,isSelected:p,padding:f=0,onKeyDown:g,classNamePrefix:m,style:y,textWidth:v,textHeight:b}=t;const w=function(t,n,o){const r=Ns(),i=(0,e.useRef)(null),s=yn("isEditing",(()=>r.getEditingShapeId()===t),[r]),a=yn("isEditingAnything",(()=>!!r.getEditingShapeId()),[r]);(0,e.useEffect)((()=>{function e(e){var n;e.shapeId===t&&(null===(n=i.current)||void 0===n||n.select())}return r.on("select-all-text",e),()=>{r.off("select-all-text",e)}}),[r,t,s]),(0,e.useEffect)((()=>{var e,t,n,o;s&&(document.activeElement!==i.current&&(null===(e=i.current)||void 0===e||e.focus()),r.getInstanceState().isCoarsePointer&&(null===(t=i.current)||void 0===t||t.select()),ka.isSafari&&(null===(n=i.current)||void 0===n||n.blur(),null===(o=i.current)||void 0===o||o.focus()))}),[r,s]);const c=(0,e.useCallback)((e=>{r.getEditingShapeId()===t&&"Enter"===e.key&&(e.ctrlKey||e.metaKey)&&r.complete()}),[r,t]),d=(0,e.useCallback)((e=>{if(r.getEditingShapeId()!==t)return;let o=IO.normalizeText(e.currentTarget.value);const i=o.replace(/\t/g,_O);if(i!==o){const t=e.currentTarget.selectionStart;e.currentTarget.value=i,e.currentTarget.selectionStart=t+(i.length-o.length),e.currentTarget.selectionEnd=t+(i.length-o.length),o=i}r.updateShape({id:t,type:n,props:{text:o}})}),[r,t,n]),u=(0,e.useCallback)((e=>{r.dispatch(l(l({},Ba(e)),{},{type:"pointer",name:"pointer_down",target:"shape",shape:r.getShape(t)})),za(e)}),[r,t]);return{rInput:i,handleFocus:E,handleBlur:E,handleKeyDown:c,handleChange:d,handleInputPointerDown:u,handleDoubleClick:za,isEmpty:0===o.trim().length,isEditing:s,isEditingAnything:a}}(n,o,r),{rInput:x,isEmpty:S,isEditing:k,isEditingAnything:P}=w,C=yr(w,OD),[_,I]=(0,e.useState)(r);(0,e.useEffect)((()=>{k||I(r)}),[k,r]);const j=IO.normalizeTextForDom(r),T=j.length>0,M=function(e){return"start-legacy"===e||"middle-legacy"===e||"end-legacy"===e}(d);if(!k&&!T)return null;const A=m||"tl-text";return(0,Ss.jsx)("div",{className:"".concat(A,"-label tl-text-wrapper"),"data-font":s,"data-align":d,"data-hastext":!S,"data-isediting":k,"data-iseditinganything":P,"data-textwrap":!!h,"data-isselected":p,style:l({justifyContent:"middle"===d||M?"center":d,alignItems:"middle"===u?"center":u,padding:f},y),children:(0,Ss.jsxs)("div",{className:"".concat(A,"-label__inner tl-text-content__wrapper"),style:{fontSize:a,lineHeight:Math.floor(a*c)+"px",minHeight:Math.floor(a*c)+"px",minWidth:Math.ceil(v||0),color:i,width:v?Math.ceil(v):void 0,height:b?Math.ceil(b):void 0},children:[(0,Ss.jsx)("div",{className:"".concat(A," tl-text tl-text-content"),dir:"auto",children:j.split("\n").map(((e,t)=>(0,Ss.jsx)("div",{dir:"auto",children:e},t)))}),(P||p)&&(0,Ss.jsx)(AD,l(l({ref:x,text:r,isEditing:k},C),{},{handleKeyDown:null!==g&&void 0!==g?g:C.handleKeyDown}),_)]})})})),RD=new L;function LD(e,t){var n;return""===t.props.text.trim()?new Vs(0,0).addScalar(8.5*t.props.scale):null!==(n=function(e){return RD.get(e,(()=>e.store.createComputedCache("arrowLabelSize",(t=>{const n=iO(e,t);let o=0,r=0;const i=n.isStraight?new fu({start:Vs.From(n.start.point),end:Vs.From(n.end.point)}):new Hb({center:Vs.Cast(n.handleArc.center),start:Vs.Cast(n.start.point),end:Vs.Cast(n.end.point),sweepFlag:n.bodyArc.sweepFlag,largeArcFlag:n.bodyArc.largeArcFlag});if(t.props.text.trim()){const n=i.bounds,s=HD(t),{w:a,h:c}=e.textMeasure.measureText(t.props.text,l(l({},bO),{},{fontFamily:PO[t.props.font],fontSize:s,maxWidth:null}));o=a,r=c;let d=!1;if(n.width>n.height?(o=Math.max(Math.min(a,64),Math.min(n.width-64,a)),d=!0):o>16*s&&(o=16*s,d=!0),d){const{w:n,h:i}=e.textMeasure.measureText(t.props.text,l(l({},bO),{},{fontFamily:PO[t.props.font],fontSize:s,maxWidth:o}));o=n,r=i}}return new Vs(o,r).addScalar(8.5*t.props.scale)}))))}(e).get(t.id))&&void 0!==n?n:new Vs(0,0)}function zD(e){const t=wO[e.props.size];return(20+2*(t-wO.s)+(t===wO.xl?20:0))*e.props.scale}function ND(e,t){let n;const o=[],r=iO(e,t),i={hasStartBinding:!!r.bindings.start,hasEndBinding:!!r.bindings.end,hasStartArrowhead:"none"!==r.start.arrowhead,hasEndArrowhead:"none"!==r.end.arrowhead};if(r.isStraight){const o=function(e,t,n){const o=LD(e,t),r=zD(t),i=Vs.Nudge(n.start.point,n.end.point,r),s=Vs.Nudge(n.end.point,n.start.point,r),a=iu(i,s,rc.FromCenter(n.middle,o).corners);if(!a||2!==a.length)return{start:.5,end:.5};let[l,c]=a;Vs.Dist2(l,i)>Vs.Dist2(c,i)&&([c,l]=a);const d=i.add(Vs.Sub(n.middle,l)),u=s.add(Vs.Sub(n.middle,c));return{start:Vs.Dist(n.start.point,d)/n.length,end:Vs.Dist(n.start.point,u)/n.length}}(e,t,r),s=FD(e,t,o,i);n=Vs.Lrp(r.start.point,r.end.point,s)}else{const s=function(e,t,n){var o,r;const i=LD(e,t),s=zD(t),a=Math.sign(t.props.bend),l=s/n.handleArc.radius*a,c=Vs.Angle(n.bodyArc.center,n.start.point)-l,d=Vs.Angle(n.bodyArc.center,n.end.point)+l,u=ca(n.bodyArc.center,n.bodyArc.radius,c),h=ca(n.bodyArc.center,n.bodyArc.radius,d),p=[],f=BD(n.bodyArc.center,n.bodyArc.radius,c,d,a,rc.FromCenter(u,i).corners);p.push(new mu({points:rc.FromCenter(u,i).corners,debugColor:"lime",isFilled:!1,ignore:!0}));const g=BD(n.bodyArc.center,n.bodyArc.radius,c,d,a,rc.FromCenter(h,i).corners);p.push(new mu({points:rc.FromCenter(h,i).corners,debugColor:"lime",isFilled:!1,ignore:!0}));for(const k of[...null!==f&&void 0!==f?f:[],...null!==g&&void 0!==g?g:[],u,h])p.push(new Kb({x:k.x-3,y:k.y-3,radius:3,isFilled:!1,debugColor:"magenta",ignore:!0}));const m=null!==(o=f&&UD(n.start.point,f))&&void 0!==o?o:n.middle,y=null!==(r=g&&UD(n.end.point,g))&&void 0!==r?r:n.middle,v=Vs.Angle(n.bodyArc.center,n.start.point),b=Vs.Angle(n.bodyArc.center,n.end.point),w=Vs.Angle(n.bodyArc.center,m),x=Vs.Angle(n.bodyArc.center,y);if(va(v,w,a)>va(v,x,a))return{start:.5,end:.5,dbg:p};const S=va(v,b,a);return{start:va(v,w,a)/S,end:va(v,x,a)/S,dbg:p}}(e,t,r);s.dbg&&o.push(...s.dbg);const a=FD(e,t,s,i),l=function(e,t,n,o){const r=va(e,t,n);return e+r*o*n*-1}(Vs.Angle(r.bodyArc.center,r.start.point),Vs.Angle(r.bodyArc.center,r.end.point),Math.sign(t.props.bend),a);n=ca(r.bodyArc.center,r.bodyArc.radius,l)}const s=LD(e,t);return{box:rc.FromCenter(n,s),debugGeom:o}}function FD(e,t,n,o){const{hasEndArrowhead:r,hasEndBinding:i,hasStartBinding:s,hasStartArrowhead:a}=o,l=ZD(e,t);let c=Qs(t.props.labelPosition,a||s?n.start:0,r||i?n.end:1);const d=Math.min(.02,500/l*.02);return c=c>=.5-d&&c<=.5+d?.5:c,c}function BD(e,t,n,o,r,i){const s=su(e,t,i),a=va(n,o,r);return null===s||void 0===s?void 0:s.filter((t=>{const o=va(n,Vs.Angle(e,t),r);return o>=0&&o<=a}))}function UD(e,t){let n=null,o=-1/0;for(const r of t){const t=Vs.Dist2(e,r);t>o&&(n=r,o=t)}return n}function HD(e){return kO[e.props.size]*e.props.scale}function KD(e,t,n){const o="end"===t?e.end.point:e.start.point,r="end"===t?e.start.point:e.end.point,i=e.isStraight?Vs.Dist(r,o):Math.abs(e.bodyArc.length),s=Math.max(Math.min(i/5,3*n),n);let a;if(e.isStraight)a=Vs.Nudge(o,r,s);else{const n=function(e,t,n,o){let r=n.x-e.x,i=n.y-e.y;const s=Math.sqrt(r*r+i*i),a=(s*s-o*o+t*t)/(2*s),l=Math.sqrt(t*t-a*a);return r/=s,i/=s,[new Vs(e.x+r*a-i*l,e.y+i*a+r*l),new Vs(e.x+r*a+i*l,e.y+i*a-r*l)]}(o,s,e.handleArc.center,e.handleArc.radius);a="end"===t?e.handleArc.sweepFlag?n[0]:n[1]:e.handleArc.sweepFlag?n[1]:n[0]}return Vs.IsNaN(a)&&(a=e.start.point),{point:o,int:a}}function VD(e,t,n){const o="end"===t?e.end.arrowhead:e.start.arrowhead;if("none"===o)return;const r=KD(e,t,n);if(r){switch(o){case"bar":return function(e){let{int:t,point:n}=e;const o=Vs.Sub(t,n).div(2),r=Vs.Add(n,Vs.Rot(o,Xs)),i=Vs.Sub(n,Vs.Rot(o,Xs));return"M ".concat(r.x," ").concat(r.y," L ").concat(i.x," ").concat(i.y)}(r);case"square":return function(e){let{int:t,point:n}=e;const o=Vs.Lrp(n,t,.85),r=Vs.Sub(o,n).div(2),i=Vs.Add(n,Vs.Rot(r,Xs)),s=Vs.Sub(n,Vs.Rot(r,Xs)),a=Vs.Add(o,Vs.Rot(r,Xs)),l=Vs.Sub(o,Vs.Rot(r,Xs));return"M ".concat(i.x," ").concat(i.y," L ").concat(a.x," ").concat(a.y," L ").concat(l.x," ").concat(l.y," L ").concat(s.x," ").concat(s.y," Z")}(r);case"diamond":return function(e){let{point:t,int:n}=e;const o=Vs.Lrp(t,n,.75),r=Vs.RotWith(o,t,Gs/4),i=Vs.RotWith(o,t,-Gs/4),s=Vs.Lrp(r,i,.5);return s.add(Vs.Sub(s,t)),"M ".concat(s.x," ").concat(s.y," L ").concat(i.x," ").concat(i.y," ").concat(t.x," ").concat(t.y," L ").concat(r.x," ").concat(r.y," Z")}(r);case"dot":return function(e){let{point:t,int:n}=e;const o=Vs.Lrp(t,n,.45),r=Vs.Dist(o,t);return"M ".concat(o.x-r,",").concat(o.y,"\n  a ").concat(r,",").concat(r," 0 1,0 ").concat(2*r,",0\n  a ").concat(r,",").concat(r," 0 1,0 -").concat(2*r,",0 ")}(r);case"inverted":return function(e){let{point:t,int:n}=e;const o=Vs.Sub(n,t).div(2),r=Vs.Add(t,Vs.Rot(o,Xs)),i=Vs.Sub(t,Vs.Rot(o,Xs));return"M ".concat(r.x," ").concat(r.y," L ").concat(n.x," ").concat(n.y," L ").concat(i.x," ").concat(i.y," Z")}(r);case"arrow":return function(e){let{point:t,int:n}=e;const o=Vs.RotWith(n,t,Gs/6),r=Vs.RotWith(n,t,-Gs/6);return"M ".concat(o.x," ").concat(o.y," L ").concat(t.x," ").concat(t.y," L ").concat(r.x," ").concat(r.y)}(r);case"triangle":return function(e){let{point:t,int:n}=e;const o=Vs.RotWith(n,t,Gs/6),r=Vs.RotWith(n,t,-Gs/6);return"M ".concat(o.x," ").concat(o.y," L ").concat(r.x," ").concat(r.y," L ").concat(t.x," ").concat(t.y," Z")}(r)}return""}}function WD(e){const{start:t,end:n,handleArc:{radius:o,largeArcFlag:r,sweepFlag:i}}=e;return"M".concat(t.handle.x,",").concat(t.handle.y," A").concat(o," ").concat(o," 0 ").concat(r," ").concat(i," ").concat(n.handle.x,",").concat(n.handle.y)}function qD(e){const{start:t,end:n,bodyArc:{radius:o,largeArcFlag:r,sweepFlag:i}}=e;return"M".concat(t.point.x,",").concat(t.point.y," A").concat(o," ").concat(o," 0 ").concat(r," ").concat(i," ").concat(n.point.x,",").concat(n.point.y)}function YD(e,t){return"M".concat(e.x,",").concat(e.y,"L").concat(t.x,",").concat(t.y)}function GD(e){return YD(e.start.handle,e.end.handle)}function XD(e){return YD(e.start.point,e.end.point)}class $D extends vu{constructor(){super(...arguments),s(this,"_resizeInitialBindings",new L)}canEdit(){return!0}canBind(e){let{toShapeType:t}=e;return"arrow"!==t}canSnap(){return!1}hideResizeHandles(){return!0}hideRotateHandle(){return!0}hideSelectionBoundsBg(){return!0}hideSelectionBoundsFg(){return!0}canBeLaidOut(e){const t=oO(this.editor,e);return!t.start&&!t.end}getDefaultProps(){return{dash:"draw",size:"m",fill:"none",color:"black",labelColor:"black",bend:0,start:{x:0,y:0},end:{x:2,y:0},arrowheadStart:"none",arrowheadEnd:"arrow",text:"",labelPosition:.5,font:"draw",scale:1}}getGeometry(e){const t=iO(this.editor,e),n=[],o=t.isStraight?new fu({start:Vs.From(t.start.point),end:Vs.From(t.end.point)}):new Hb({center:Vs.Cast(t.handleArc.center),start:Vs.Cast(t.start.point),end:Vs.Cast(t.end.point),sweepFlag:t.bodyArc.sweepFlag,largeArcFlag:t.bodyArc.largeArcFlag});let r;if(e.props.text.trim()){const t=ND(this.editor,e);n.push(...t.debugGeom),r=new yu({x:t.box.x,y:t.box.y,width:t.box.w,height:t.box.h,isFilled:!0,isLabel:!0})}return new ac({children:[...r?[o,r]:[o],...n]})}getHandles(e){const t=iO(this.editor,e);return[{id:"start",type:"vertex",index:"a0",x:t.start.handle.x,y:t.start.handle.y},{id:"middle",type:"virtual",index:"a2",x:t.middle.x,y:t.middle.y},{id:"end",type:"vertex",index:"a3",x:t.end.handle.x,y:t.end.handle.y}].filter(Boolean)}getText(e){return e.props.text}onHandleDrag(e,t){let{handle:n,isPrecise:o}=t;const r=n.id,i=oO(this.editor,e);if("middle"===r){const{start:t,end:o}=sO(this.editor,e,i),r=Vs.Sub(o,t),s=Vs.Per(r),a=Vs.Med(o,t),l=Vs.Sub(a,s),c=Vs.Add(a,s),d=Vs.NearestPointOnLineSegment(l,c,n,!1);let u=Vs.Dist(d,a);return Vs.Clockwise(d,o,a)&&(u*=-1),{id:e.id,type:e.type,props:{bend:u}}}const s={id:e.id,type:"arrow",props:{}},a=i[r],c=i["start"===r?"end":"start"];if(this.editor.inputs.ctrlKey)return lO(this.editor,e,r),s.props[r]={x:n.x,y:n.y},s;const d=this.editor.getShapePageTransform(e.id).applyToPoint(n),u=this.editor.getShapeAtPoint(d,{hitInside:!0,hitFrameInside:!0,margin:0,filter:t=>!t.isLocked&&this.editor.canBindShapes({fromShape:e,toShape:t,binding:"arrow"})});if(!u){lO(this.editor,e,r);const t=zb(new Vs(n.x,n.y),this.editor);return s.props[r]={x:t.x,y:t.y},s}const h=this.editor.getShapeGeometry(u),p=rc.ZeroFix(h.bounds),f=this.editor.getShapePageTransform(s.id).applyToPoint(n),g=this.editor.getPointInShapeSpace(u,f);let m=o;m||(!a||a&&u.id!==a.toId)&&(m=this.editor.inputs.pointerVelocity.len()<.5),o||(h.isClosed||(m=!0),c&&u.id===c.toId&&c.props.isPrecise&&(m=!0));const y={x:(g.x-p.minX)/p.width,y:(g.y-p.minY)/p.height};m&&Vs.Dist(g,p.center)<Math.max(4,Math.min(.15*Math.min(p.width,p.height),16))/this.editor.getZoomLevel()&&(y.x=.5,y.y=.5);const v={terminal:r,normalizedAnchor:y,isPrecise:m,isExact:this.editor.inputs.altKey};aO(this.editor,e,u.id,v),this.editor.setHintingShapes([u.id]);const b=oO(this.editor,e);return b.start&&b.end&&b.start.toId===b.end.toId&&Vs.Equals(b.start.props.normalizedAnchor,b.end.props.normalizedAnchor)&&aO(this.editor,e,b.end.toId,l(l({},b.end.props),{},{normalizedAnchor:{x:b.end.props.normalizedAnchor.x+.05,y:b.end.props.normalizedAnchor.y}})),s}onTranslateStart(e){const t=oO(this.editor,e),n=sO(this.editor,e,t),o=this.editor.getShapePageTransform(e.id),r=this.editor.getSelectedShapeIds();if(!(t.start&&(r.includes(t.start.toId)||this.editor.isAncestorSelected(t.start.toId))||t.end&&(r.includes(t.end.toId)||this.editor.isAncestorSelected(t.end.toId)))){eR.set(e,{pagePosition:o.applyToPoint(e),terminalBindings:ve(n,((e,n)=>{const r=t[e];return r?{binding:r,shapePosition:n,pagePosition:o.applyToPoint(n)}:null}))}),t.start&&(yO({editor:this.editor,arrow:e,terminal:"start",useHandle:!0}),e=this.editor.getShape(e.id)),t.end&&yO({editor:this.editor,arrow:e,terminal:"end",useHandle:!0});for(const e of["start","end"]){const n=t[e];n&&this.editor.updateBinding(l(l({},n),{},{props:l(l({},n.props),{},{isPrecise:!0})}))}}}onTranslate(e,t){const n=eR.get(e);if(!n)return;const o=this.editor.getShapePageTransform(t.id),r=Vs.Sub(o.applyToPoint(t),n.pagePosition);for(const i of Object.values(n.terminalBindings)){if(!i)continue;const e=Vs.Add(i.pagePosition,Vs.Mul(r,.5)),n=this.editor.getShapeAtPoint(e,{hitInside:!0,hitFrameInside:!0,margin:0,filter:e=>!e.isLocked&&this.editor.canBindShapes({fromShape:t,toShape:e,binding:"arrow"})});if((null===n||void 0===n?void 0:n.id)===i.binding.toId){const o=rc.ZeroFix(this.editor.getShapeGeometry(n).bounds),r=this.editor.getPointInShapeSpace(n,e),s={x:(r.x-o.minX)/o.width,y:(r.y-o.minY)/o.height};aO(this.editor,t,n.id,l(l({},i.binding.props),{},{normalizedAnchor:s,isPrecise:!0}))}else lO(this.editor,t,i.binding.props.terminal)}}onResize(e,t){const{scaleX:n,scaleY:o}=t,r=this._resizeInitialBindings.get(e,(()=>oO(this.editor,e))),i=sO(this.editor,e,r),{start:s,end:a}=bt(e.props);let{bend:c}=e.props;r.start||(s.x=i.start.x*n,s.y=i.start.y*o),r.end||(a.x=i.end.x*n,a.y=i.end.y*o);const d=Math.abs(n),u=Math.abs(o),h=null!==r&&void 0!==r&&r.start?Vs.From(r.start.props.normalizedAnchor):null,p=null!==r&&void 0!==r&&r.end?Vs.From(r.end.props.normalizedAnchor):null;n<0&&o>=0?(0!==c&&(c*=-1,c*=Math.max(d,u)),h&&(h.x=1-h.x),p&&(p.x=1-p.x)):n>=0&&o<0?(0!==c&&(c*=-1,c*=Math.max(d,u)),h&&(h.y=1-h.y),p&&(p.y=1-p.y)):n>=0&&o>=0?0!==c&&(c*=Math.max(d,u)):n<0&&o<0&&(0!==c&&(c*=Math.max(d,u)),h&&(h.x=1-h.x,h.y=1-h.y),p&&(p.x=1-p.x,p.y=1-p.y)),r.start&&h&&aO(this.editor,e,r.start.toId,l(l({},r.start.props),{},{normalizedAnchor:h.toJson()})),r.end&&p&&aO(this.editor,e,r.end.toId,l(l({},r.end.props),{},{normalizedAnchor:p.toJson()}));return{props:{start:s,end:a,bend:c}}}onDoubleClickHandle(e,t){switch(t.id){case"start":return{id:e.id,type:e.type,props:l(l({},e.props),{},{arrowheadStart:"none"===e.props.arrowheadStart?"arrow":"none"})};case"end":return{id:e.id,type:e.type,props:l(l({},e.props),{},{arrowheadEnd:"none"===e.props.arrowheadEnd?"arrow":"none"})}}}component(e){const t=pD(),n=this.editor.getOnlySelectedShape(),o=this.editor.isInAny("select.idle","select.pointing_handle","select.dragging_handle","select.translating","arrow.dragging")&&!this.editor.getIsReadonly(),r=iO(this.editor,e);if(null===r||void 0===r||!r.isValid)return null;const i=ND(this.editor,e),s=e.id===this.editor.getOnlySelectedShapeId(),a=this.editor.getEditingShapeId()===e.id||e.props.text;return(0,Ss.jsxs)(Ss.Fragment,{children:[(0,Ss.jsx)(tu,{style:{minWidth:50,minHeight:50},children:(0,Ss.jsx)(QD,{shape:e,shouldDisplayHandles:o&&(null===n||void 0===n?void 0:n.id)===e.id})}),a&&(0,Ss.jsx)(DD,{shapeId:e.id,classNamePrefix:"tl-arrow",type:"arrow",font:e.props.font,fontSize:HD(e),lineHeight:bO.lineHeight,align:"middle",verticalAlign:"middle",text:e.props.text,labelColor:t[e.props.labelColor].solid,textWidth:i.box.w-8.5*e.props.scale,isSelected:s,padding:0,style:{transform:"translate(".concat(i.box.center.x,"px, ").concat(i.box.center.y,"px)")}})]})}indicator(e){const t=Fb(e.id),n=Os(e.id+"_clip"),o=iO(this.editor,e);if(!o)return null;const{start:r,end:i}=sO(this.editor,e,null===o||void 0===o?void 0:o.bindings),s=this.editor.getShapeGeometry(e),a=s.bounds,l=e.props.text.trim()?s.children[1]:null;if(Vs.Equals(r,i))return null;const c=wO[e.props.size]*e.props.scale,d=o.start.arrowhead&&VD(o,"start",c),u=o.end.arrowhead&&VD(o,"end",c),h=o.isStraight?XD(o):qD(o),p=d&&"arrow"!==o.start.arrowhead||u&&"arrow"!==o.end.arrowhead||!!l;if(t&&l)return(0,Ss.jsx)("rect",{x:ga(l.x),y:ga(l.y),width:l.w,height:l.h,rx:3.5*e.props.scale,ry:3.5*e.props.scale});const f=!("none"===o.start.arrowhead||"arrow"===o.start.arrowhead),g=!("none"===o.end.arrowhead||"arrow"===o.end.arrowhead);return(0,Ss.jsxs)("g",{children:[p&&(0,Ss.jsx)("defs",{children:(0,Ss.jsx)(JD,{hasText:e.props.text.trim().length>0,bounds:a,labelBounds:l?l.getBounds():new rc(0,0,0,0),as:f&&d?d:"",ae:g&&u?u:""})}),(0,Ss.jsxs)("g",{style:{clipPath:p?"url(#".concat(n,")"):void 0,WebkitClipPath:p?"url(#".concat(n,")"):void 0},children:[p&&(0,Ss.jsx)("rect",{x:a.minX-100,y:a.minY-100,width:a.width+200,height:a.height+200,opacity:0}),(0,Ss.jsx)("path",{d:h})]}),d&&(0,Ss.jsx)("path",{d:d}),u&&(0,Ss.jsx)("path",{d:u}),l&&(0,Ss.jsx)("rect",{x:ga(l.x),y:ga(l.y),width:l.w,height:l.h,rx:3.5,ry:3.5})]})}onEditEnd(e){const{id:t,type:n,props:{text:o}}=e;o.trimEnd()!==e.props.text&&this.editor.updateShapes([{id:t,type:n,props:{text:o.trimEnd()}}])}toSvg(e,t){t.addExportDef(gD(e.props.fill)),e.props.text&&t.addExportDef(fD(e.props.font));const n=Zo(t),o=1/e.props.scale;return(0,Ss.jsxs)("g",{transform:"scale(".concat(o,")"),children:[(0,Ss.jsx)(QD,{shape:e,shouldDisplayHandles:!1}),(0,Ss.jsx)(MD,{fontSize:HD(e),font:e.props.font,align:"middle",verticalAlign:"middle",text:e.props.text,labelColor:n[e.props.labelColor].solid,bounds:ND(this.editor,e).box.clone().expandBy(-4.25*e.props.scale),padding:0})]})}getCanvasSvgDefs(){return[yD(),{key:"arrow:dot",component:tR},{key:"arrow:cross",component:nR}]}getInterpolatedProps(e,t,n){return l(l({},n>.5?t.props:e.props),{},{scale:le(e.props.scale,t.props.scale,n),start:{x:le(e.props.start.x,t.props.start.x,n),y:le(e.props.start.y,t.props.start.y,n)},end:{x:le(e.props.end.x,t.props.end.x,n),y:le(e.props.end.y,t.props.end.y,n)},bend:le(e.props.bend,t.props.bend,n),labelPosition:le(e.props.labelPosition,t.props.labelPosition,n)})}}function ZD(e,t){const n=iO(e,t);return n.isStraight?Vs.Dist(n.start.handle,n.end.handle):Math.abs(n.handleArc.length)}s($D,"type","arrow"),s($D,"props",lr),s($D,"migrations",ur);const QD=fn((function(e){let{shape:t,shouldDisplayHandles:n}=e;const o=Ns(),r=pD(),i=iO(o,t),s=rc.ZeroFix(o.getShapeGeometry(t).bounds),a=oO(o,t),l=yn("force solid",(()=>o.getZoomLevel()<.2),[o]),c=Os(t.id+"_clip"),d=Os("arrowhead-dot"),u=Os("arrowhead-cross");if(null===i||void 0===i||!i.isValid)return null;const h=wO[t.props.size]*t.props.scale,p=i.start.arrowhead&&VD(i,"start",h),f=i.end.arrowhead&&VD(i,"end",h),g=i.isStraight?XD(i):qD(i);let m=null;if(n){const e=2/o.getZoomLevel(),{strokeDasharray:n,strokeDashoffset:r}=bu(ZD(o,t),e,{end:"skip",start:"skip",lengthRatio:2.5});m=a.start||a.end?(0,Ss.jsx)("path",{className:"tl-arrow-hint",d:i.isStraight?GD(i):WD(i),strokeDasharray:n,strokeDashoffset:r,strokeWidth:e,markerStart:a.start?a.start.props.isExact?"":a.start.props.isPrecise?"url(#".concat(u,")"):"url(#".concat(d,")"):"",markerEnd:a.end?a.end.props.isExact?"":a.end.props.isPrecise?"url(#".concat(u,")"):"url(#".concat(d,")"):"",opacity:.16}):null}const{strokeDasharray:y,strokeDashoffset:v}=bu(i.isStraight?i.length:Math.abs(i.bodyArc.length),h,{style:t.props.dash,forceSolid:l}),b=ND(o,t),w=!("none"===i.start.arrowhead||"arrow"===i.start.arrowhead),x=!("none"===i.end.arrowhead||"arrow"===i.end.arrowhead);return(0,Ss.jsxs)(Ss.Fragment,{children:[(0,Ss.jsx)("defs",{children:(0,Ss.jsx)("clipPath",{id:c,children:(0,Ss.jsx)(JD,{hasText:t.props.text.trim().length>0,bounds:s,labelBounds:b.box,as:w&&p?p:"",ae:x&&f?f:""})})}),(0,Ss.jsxs)("g",{fill:"none",stroke:r[t.props.color].solid,strokeWidth:h,strokeLinejoin:"round",strokeLinecap:"round",pointerEvents:"none",children:[m,(0,Ss.jsxs)("g",{style:{clipPath:"url(#".concat(c,")"),WebkitClipPath:"url(#".concat(c,")")},children:[(0,Ss.jsx)("rect",{x:ga(s.minX-100),y:ga(s.minY-100),width:ga(s.width+200),height:ga(s.height+200),opacity:0}),(0,Ss.jsx)("path",{d:g,strokeDasharray:y,strokeDashoffset:v})]}),p&&w&&"none"!==t.props.fill&&(0,Ss.jsx)(ED,{theme:r,d:p,color:t.props.color,fill:t.props.fill,scale:t.props.scale}),f&&x&&"none"!==t.props.fill&&(0,Ss.jsx)(ED,{theme:r,d:f,color:t.props.color,fill:t.props.fill,scale:t.props.scale}),p&&(0,Ss.jsx)("path",{d:p}),f&&(0,Ss.jsx)("path",{d:f})]})]})}));function JD(e){let{hasText:t,bounds:n,labelBounds:o,as:r,ae:i}=e;const s="M".concat(ga(n.minX-100),",").concat(ga(n.minY-100)," h").concat(n.width+200," v").concat(n.height+200," h-").concat(n.width+200," Z"),a="M".concat(ga(o.minX),",").concat(ga(o.minY)," v").concat(o.height," h").concat(o.width," v-").concat(o.height," Z");return(0,Ss.jsx)("path",{d:"".concat(s).concat(t?a:"").concat(r).concat(i)})}const eR=new WeakMap;function tR(){const e=Os("arrowhead-dot");return(0,Ss.jsx)("marker",{id:e,className:"tl-arrow-hint",refX:"3.0",refY:"3.0",orient:"0",children:(0,Ss.jsx)("circle",{cx:"3",cy:"3",r:"2",strokeDasharray:"100%"})})}function nR(){const e=Os("arrowhead-cross");return(0,Ss.jsxs)("marker",{id:e,className:"tl-arrow-hint",refX:"3.0",refY:"3.0",orient:"auto",children:[(0,Ss.jsx)("line",{x1:"1.5",y1:"1.5",x2:"4.5",y2:"4.5",strokeDasharray:"100%"}),(0,Ss.jsx)("line",{x1:"1.5",y1:"4.5",x2:"4.5",y2:"1.5",strokeDasharray:"100%"})]})}const oR="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='30' height='30' fill='none'%3E%3Cpath stroke='%23000' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M13 5H7a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6M19 5h6m0 0v6m0-6L13 17'/%3E%3C/svg%3E";function rR(e){let{url:t}=e;const n=Ns(),o=yn("zoomLevel",(()=>n.getZoomLevel()<.32),[n]);return(0,Ss.jsx)("a",{className:ks("tl-hyperlink-button",{"tl-hyperlink-button__hidden":o}),href:t,target:"_blank",rel:"noopener noreferrer",onPointerDown:za,onPointerUp:za,title:t,draggable:!1,children:(0,Ss.jsx)("div",{className:"tl-hyperlink__icon",style:{mask:'url("'.concat(oR,'") center 100% / 100% no-repeat'),WebkitMask:'url("'.concat(oR,'") center 100% / 100% no-repeat')}})})}const iR="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='30' height='30' fill='none'%3E%3Cpath stroke='%23000' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M13 5H7a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6M19 5h6m0 0v6m0-6L13 17'/%3E%3C/svg%3E",sR=[{offsetX:0,offsetY:2,blur:4,spread:0,color:"#00000029"},{offsetX:0,offsetY:3,blur:6,spread:0,color:"#0000001f"}];function aR(e){return sR.map((t=>{const{offsetX:n,offsetY:o,blur:r,spread:i,color:s}=t,a=new Vs(n,o),{x:l,y:c}=a.rot(-e);return"".concat(l,"px ").concat(c,"px ").concat(r,"px ").concat(i,"px ").concat(s)})).join(", ")}class lR extends Db{canResize(){return!1}hideSelectionBoundsFg(){return!0}getText(e){return e.props.url}getDefaultProps(){return{url:"",w:300,h:320,assetId:null}}component(e){return(0,Ss.jsx)(cR,{shape:e,util:this})}indicator(e){return(0,Ss.jsx)("rect",{width:ga(e.props.w),height:ga(e.props.h),rx:"6",ry:"6"})}onBeforeCreate(e){return dR(this.editor,e)}onBeforeUpdate(e,t){if(e.props.url!==t.props.url){if(!So.isValid(t.props.url))return l(l({},t),{},{props:l(l({},t.props),{},{url:e.props.url})});!function(e,t){const{url:n}=t.props,o=Pi.createId(K(n));e.getAsset(o)?t.props.assetId!==o&&e.updateShapes([{id:t.id,type:t.type,props:{assetId:o}}]):(e.updateShapes([{id:t.id,type:t.type,props:{assetId:null}}]),hR(e,t))}(this.editor,t)}if(e.props.assetId!==t.props.assetId)return dR(this.editor,t)}getInterpolatedProps(e,t,n){return l(l({},n>.5?t.props:e.props),{},{w:le(e.props.w,t.props.w,n),h:le(e.props.h,t.props.h,n)})}}function cR(t){let{shape:n,util:o}=t;const r=n.props.assetId?o.editor.getAsset(n.props.assetId):null,i=!!Ih()&&ka.isSafari,s=o.editor.getShapePageTransform(n).rotation(),a=uR(n),[l,c]=(0,e.useState)(!0);return(0,Ss.jsx)(Mb,{children:(0,Ss.jsxs)("div",{className:ks("tl-bookmark__container",i&&"tl-bookmark__container--safariExport"),style:{boxShadow:i?void 0:aR(s),maxHeight:n.props.h},children:[(!r||r.props.image)&&(0,Ss.jsxs)("div",{className:"tl-bookmark__image_container",children:[r?(0,Ss.jsx)("img",{className:"tl-bookmark__image",draggable:!1,referrerPolicy:"strict-origin-when-cross-origin",src:null===r||void 0===r?void 0:r.props.image,alt:(null===r||void 0===r?void 0:r.props.title)||""}):(0,Ss.jsx)("div",{className:"tl-bookmark__placeholder"}),(null===r||void 0===r?void 0:r.props.image)&&(0,Ss.jsx)(rR,{url:n.props.url})]}),(0,Ss.jsxs)("div",{className:"tl-bookmark__copy_container",children:[null!==r&&void 0!==r&&r.props.title?(0,Ss.jsx)("h2",{className:"tl-bookmark__heading",children:(d=r.props.title,d.replace(AO,(e=>MO[e])))}):null,null!==r&&void 0!==r&&r.props.description&&null!==r&&void 0!==r&&r.props.image?(0,Ss.jsx)("p",{className:"tl-bookmark__description",children:r.props.description}):null,(0,Ss.jsxs)("a",{className:"tl-bookmark__link",href:n.props.url||"",target:"_blank",rel:"noopener noreferrer",onPointerDown:za,onPointerUp:za,onClick:za,children:[l&&null!==r&&void 0!==r&&r.props.favicon?(0,Ss.jsx)("img",{className:"tl-bookmark__favicon",src:null===r||void 0===r?void 0:r.props.favicon,referrerPolicy:"strict-origin-when-cross-origin",onError:()=>c(!1),alt:"favicon of ".concat(a)}):(0,Ss.jsx)("div",{className:"tl-hyperlink__icon",style:{mask:'url("'.concat(iR,'") center 100% / 100% no-repeat'),WebkitMask:'url("'.concat(iR,'") center 100% / 100% no-repeat')}}),(0,Ss.jsx)("span",{children:a})]})]})]})});var d}function dR(e,t){const n=t.props.assetId?e.getAsset(t.props.assetId):null;let o=320;return n&&(n.props.image||(o=n.props.title?101:46)),l(l({},t),{},{props:l(l({},t.props),{},{h:o})})}s(lR,"type","bookmark"),s(lR,"props",Ci),s(lR,"migrations",Ii);const uR=e=>{try{return new URL(e.props.url).hostname.replace(/^www\./,"")}catch(t){return e.props.url}};const hR=z((async(e,t)=>{if(e.isDisposed)return;const{url:n}=t.props,o=await e.getAssetForExternalContent({type:"url",url:n});o&&e.run((()=>{e.createAssets([o]),e.updateShapes([{id:t.id,type:t.type,props:{assetId:o.id}}])}))}),500);function pR(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=e.length;if(n<2)return"";let o=e[0].point,r=e[1].point;if(2===n)return"M".concat(qs(o),"L").concat(qs(r));let i="";for(let s=2,a=n-1;s<a;s++)o=e[s].point,r=e[s+1].point,i+=Ys(o,r);return t?"M".concat(Ys(e[0].point,e[1].point),"Q").concat(qs(e[1].point)).concat(Ys(e[1].point,e[2].point),"T").concat(i).concat(Ys(e[n-1].point,e[0].point)).concat(Ys(e[0].point,e[1].point),"Z"):"M".concat(qs(e[0].point),"Q").concat(qs(e[1].point)).concat(Ys(e[1].point,e[2].point)).concat(e.length>3?"T":"").concat(i,"L").concat(qs(e[n-1].point))}function fR(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{start:n={},end:o={}}=t,{cap:r=!0}=n,{cap:i=!0}=o;M(!n.taper&&!o.taper,"cap taper not supported here"),M(!n.easing&&!o.easing,"cap easing not supported here"),M(r&&i,"cap must be true");const s=FA(e,t);HA(s,t);const a=function(e){if(e.length<=2)return[e];const t=[];let n,o,r,i,s,a=[e[0]],c=Vs.Sub(e[1].point,e[0].point).uni();for(let d=1,u=e.length;d<u-1;d++)if(r=e[d-1],i=e[d],s=e[d+1],n=Vs.Sub(s.point,i.point).uni(),o=Vs.Dpr(c,n),c=n,o<-.8){const e=l(l({},i),{},{point:i.input});a.push(e),t.push(gR(a)),a=[e]}else a.push(i),o>.7||(Vs.Dist2(r.point,i.point)+Vs.Dist2(i.point,s.point))/((r.radius+i.radius+s.radius)/3)**2<1.5&&(a.push(i),t.push(gR(a)),a=[i]);return a.push(e[e.length-1]),t.push(gR(a)),t}(s);let c="";for(const l of a)c+=mR(l,t);return c}function gR(e){const t=e[0];let n;for(;e.length>2&&(n=e[1],Vs.Dist2(t.point,n.point)<((t.radius+n.radius)/2*.5)**2);)e.splice(1,1);const o=e[e.length-1];let r;for(;e.length>2&&(r=e[e.length-2],Vs.Dist2(o.point,r.point)<((o.radius+r.radius)/2*.5)**2);)e.splice(e.length-2,1);return e.length>1&&(e[0]=l(l({},e[0]),{},{vector:Vs.Sub(e[0].point,e[1].point).uni()}),e[e.length-1]=l(l({},e[e.length-1]),{},{vector:Vs.Sub(e[e.length-2].point,e[e.length-1].point).uni()})),e}function mR(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(0===e.length)return"";if(1===e.length)return n=e[0].point.x,o=e[0].point.y,r=e[0].radius,"M "+n+" "+o+" m -"+r+", 0 a "+r+","+r+" 0 1,1 "+2*r+",0 a "+r+","+r+" 0 1,1 -"+2*r+",0";var n,o,r;const{left:i,right:s}=zA(e,t);s.reverse();let a="M".concat(qs(i[0]),"T");for(let l=1;l<i.length;l++)a+=Ys(i[l-1],i[l]);{const t=e[e.length-1],n=t.radius,o=t.vector.clone().per().neg(),r=Vs.Add(t.point,Vs.Mul(o,n)),i=Vs.Add(t.point,Vs.Mul(o,-n));a+="".concat(qs(r),"A").concat(ga(n),",").concat(ga(n)," 0 0 1 ").concat(qs(i),"T")}for(let l=1;l<s.length;l++)a+=Ys(s[l-1],s[l]);{const t=e[0],n=t.radius,o=t.vector.clone().per(),r=Vs.Add(t.point,Vs.Mul(o,n)),i=Vs.Add(t.point,Vs.Mul(o,-n));a+="".concat(qs(r),"A").concat(ga(n),",").concat(ga(n)," 0 0 1 ").concat(qs(i),"Z")}return a}const yR=(e,t,n)=>{const o=[],r=[];e.forEach((e=>o.push(...e.points))),t.forEach((e=>r.push(...e.points)));const i=Math.max(o.length,r.length),s=[],a=[];for(let l=0;l<i;l++)s.push(o[l]||o[o.length-1]),a.push(r[l]||r[r.length-1]);return[{type:"free",points:s.map(((e,t)=>{let o=.5;return void 0!==a[t].z&&void 0!==e.z&&(o=le(e.z,a[t].z,n)),{x:le(e.x,a[t].x,n),y:le(e.y,a[t].y,n),z:o}}))}]},vR=e=>.65*e+.35*Zs(e*Gs/2),bR=e=>({size:e,thinning:0,streamline:de(e,[9,16],[.64,.74],!0),smoothing:.62,simulatePressure:!1,easing:Ks.linear});function wR(e){let{strokeWidth:t,showAsComplete:n}=e;return{size:1+t,thinning:0,streamline:.5,smoothing:.5,simulatePressure:!1,easing:Ks.easeOutSine,last:n}}function xR(e,t,n,o){const r=e.isComplete||n;return o?e.isPen?l(l({},(e=>({size:e,thinning:0,streamline:.62,smoothing:.62,simulatePressure:!1,easing:Ks.linear}))(t)),{},{last:r}):l(l({},bR(t)),{},{last:r}):"draw"===e.dash?e.isPen?l(l({},(e=>({size:1+1.2*e,thinning:.62,streamline:.62,smoothing:.62,simulatePressure:!1,easing:vR}))(t)),{},{last:r}):l(l({},(e=>({size:e,thinning:.5,streamline:de(e,[9,16],[.64,.74],!0),smoothing:.62,easing:Ks.easeOutSine,simulatePressure:!0}))(t)),{},{last:r}):l(l({},bR(t)),{},{last:r})}function SR(e){const t=[];for(const n of e)if("free"===n.type||n.points.length<2)t.push(...n.points.map(Vs.Cast));else{const e=Math.max(4,Math.floor(Vs.Dist(n.points[0],n.points[1])/16));t.push(...Vs.PointsBetween(n.points[0],n.points[1],e))}return t}function kR(e,t,n){return{draw:"none",solid:"none",dotted:"".concat(n," ").concat(2*t),dashed:"".concat(2*t," ").concat(2*t)}[e.props.dash]}class PR extends vu{hideResizeHandles(e){return _R(e)}hideRotateHandle(e){return _R(e)}hideSelectionBoundsFg(e){return _R(e)}getDefaultProps(){return{segments:[],color:"black",fill:"none",dash:"draw",size:"m",isComplete:!1,isClosed:!1,isPen:!1,scale:1}}getGeometry(e){const t=SR(e.props.segments),n=(wO[e.props.size]+1)*e.props.scale;if(1===e.props.segments.length){const e=rc.FromPoints(t);if(e.width<2*n&&e.height<2*n)return new Kb({x:-n,y:-n,radius:n,isFilled:!0})}const o=FA(t,xR(e.props,n,e.props.isPen,!0)).map((e=>e.point));return e.props.isClosed?new mu({points:o,isFilled:"none"!==e.props.fill}):new gu({points:o})}component(e){return(0,Ss.jsx)(tu,{children:(0,Ss.jsx)(IR,{shape:e})})}indicator(e){var t;const n=SR(e.props.segments);let o=(wO[e.props.size]+1)*e.props.scale;const r=this.editor.getZoomLevel();r<.5&&r<1.5/o||e.props.isPen||"draw"!==e.props.dash||1!==n.length||(o+=ce(e.id)()*(o/6));const i=e.props.isComplete||"straight"===(null===(t=_(e.props.segments))||void 0===t?void 0:t.type),s=FA(n,xR(e.props,o,i,!0)),a=s.length>1?pR(s,e.props.isClosed):CR(n[0],o);return(0,Ss.jsx)("path",{d:a})}toSvg(e,t){t.addExportDef(gD(e.props.fill));const n=1/e.props.scale;return(0,Ss.jsx)("g",{transform:"scale(".concat(n,")"),children:(0,Ss.jsx)(IR,{shape:e,zoomOverride:1})})}getCanvasSvgDefs(){return[yD()]}onResize(e,t){const{scaleX:n,scaleY:o}=t,r=[];for(const i of e.props.segments)r.push(l(l({},i),{},{points:i.points.map((e=>{let{x:t,y:r,z:i}=e;return{x:ma(n*t),y:ma(o*r),z:i}}))}));return{props:{segments:r}}}expandSelectionOutlinePx(e){const t="draw"===e.props.dash?1.6:1;return wO[e.props.size]*t/2*e.props.scale}getInterpolatedProps(e,t,n){return l(l({},n>.5?t.props:e.props),{},{segments:yR(e.props.segments,t.props.segments,n),scale:le(e.props.scale,t.props.scale,n)})}}function CR(e,t){const n=.5*(t+1);return"M ".concat(e.x," ").concat(e.y," m -").concat(n,", 0 a ").concat(n,",").concat(n," 0 1,0 ").concat(2*n,",0 a ").concat(n,",").concat(n," 0 1,0 -").concat(2*n,",0")}function _R(e){return 1===e.props.segments.length&&e.props.segments[0].points.length<2}function IR(e){var t;let{shape:n,zoomOverride:o}=e;const r=pD(),i=Ns(),s=SR(n.props.segments),a=n.props.isComplete||"straight"===(null===(t=_(n.props.segments))||void 0===t?void 0:t.type);let l=(wO[n.props.size]+1)*n.props.scale;const c=yn("force solid",(()=>{const e=null!==o&&void 0!==o?o:i.getZoomLevel();return e<.5&&e<1.5/l}),[i,l,o]),d=yn("dot adjustment",(()=>(null!==o&&void 0!==o?o:i.getZoomLevel())<.2?0:.1),[i,o]);c||n.props.isPen||"draw"!==n.props.dash||1!==s.length||(l+=ce(n.id)()*(l/6));const u=xR(n.props,l,a,c);if(!c&&"draw"===n.props.dash)return(0,Ss.jsxs)(Ss.Fragment,{children:[n.props.isClosed&&n.props.fill&&s.length>1?(0,Ss.jsx)(ED,{d:pR(FA(s,u),n.props.isClosed),theme:r,color:n.props.color,fill:n.props.isClosed?n.props.fill:"none",scale:n.props.scale}):null,(0,Ss.jsx)("path",{d:fR(s,u),strokeLinecap:"round",fill:r[n.props.color].solid})]});const h=FA(s,u),p=h.length<2,f=p?CR(s[0],0):pR(h,n.props.isClosed);return(0,Ss.jsxs)(Ss.Fragment,{children:[(0,Ss.jsx)(ED,{d:f,theme:r,color:n.props.color,fill:p||n.props.isClosed?n.props.fill:"none",scale:n.props.scale}),(0,Ss.jsx)("path",{d:f,strokeLinecap:"round",fill:p?r[n.props.color].solid:"none",stroke:r[n.props.color].solid,strokeWidth:l,strokeDasharray:p?"none":kR(n,l,d),strokeDashoffset:"0"})]})}s(PR,"type","draw"),s(PR,"props",ji),s(PR,"migrations",Mi);const ER=e=>e.split("*").map((e=>function(e){if("string"!==typeof e)throw new TypeError("Expected a string");return e.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")}(e))).join(".+"),jR=(e,t)=>!!e.find((e=>{const n=new RegExp(ER(e));return t.match(n)}));function TR(e,t){try{var n;return null!==(n=function(e,t){const n=mt(t);if(!n)return;const o=n.host.replace("www.","");for(const r of e)if(jR(r.hostnames,o)){const e=r.toEmbedUrl(t);if(e)return{definition:r,embedUrl:e,url:t}}}(e,t))&&void 0!==n?n:function(e,t){const n=mt(t);if(!n)return;const o=n.host.replace("www.","");for(const r of e)if(jR(r.hostnames,o)){const e=r.fromEmbedUrl(t);if(e)return{definition:r,url:e,embedUrl:t}}}(e,t)}catch(o){return}}class MR extends Db{static setEmbedDefinitions(e){MR.embedDefinitions=e}getEmbedDefinitions(){return MR.embedDefinitions}getEmbedDefinition(e){return TR(MR.embedDefinitions,e)}getText(e){return e.props.url}hideSelectionBoundsFg(e){return!this.canResize(e)}canEdit(){return!0}canResize(e){var t;return!(null===(t=this.getEmbedDefinition(e.props.url))||void 0===t||null===(t=t.definition)||void 0===t||!t.doesResize)}canEditInReadOnly(){return!0}getDefaultProps(){return{w:300,h:300,url:""}}isAspectRatioLocked(e){var t;const n=this.getEmbedDefinition(e.props.url);return null!==(t=null===n||void 0===n?void 0:n.definition.isAspectRatioLocked)&&void 0!==t&&t}onResize(e,t){var n,o;const r=this.isAspectRatioLocked(e),i=this.getEmbedDefinition(e.props.url);let s=null!==(n=null===i||void 0===i?void 0:i.definition.minWidth)&&void 0!==n?n:200,a=null!==(o=null===i||void 0===i?void 0:i.definition.minHeight)&&void 0!==o?o:200;if(r){const t=e.props.w/e.props.h;t>1?s*=t:a/=t}return Ob(e,t,{minWidth:s,minHeight:a})}component(e){var t,n;const o=Ih(),{w:r,h:i,url:s}=e.props,a=Fb(e.id),c=this.getEmbedDefinition(s),d=yn("is hovering",(()=>{const{editingShapeId:e,hoveredShapeId:t}=this.editor.getCurrentPageState();if(e&&t!==e){const t=this.editor.getShape(e);if(t&&this.editor.isShapeOfType(t,"embed"))return!0}return!1}),[]),u=this.editor.getShapePageTransform(e).rotation();var h,p;if(o)return(0,Ss.jsx)(Mb,{className:"tl-embed-container",id:e.id,children:(0,Ss.jsx)("div",{className:"tl-embed",style:{border:0,boxShadow:aR(u),borderRadius:null!==(h=null===c||void 0===c?void 0:c.definition.overrideOutlineRadius)&&void 0!==h?h:8,background:null!==(p=null===c||void 0===c?void 0:c.definition.backgroundColor)&&void 0!==p?p:"var(--color-background)",width:r,height:i}})});const f=a||d;if("undefined"!==typeof window&&(window!==window.top||window.self!==window.parent)&&"tldraw"===(null===c||void 0===c?void 0:c.definition.type))return null;if("github_gist"===(null===c||void 0===c?void 0:c.definition.type)){const t=c.url.split("/").pop();if(!t)throw Error("No gist id!");return(0,Ss.jsx)(Mb,{className:"tl-embed-container",id:e.id,children:(0,Ss.jsx)(AR,{id:t,width:ga(r),height:ga(i),isInteractive:f,pageRotation:u})})}const g=(m=l(l({},hj),null!==(t=null===c||void 0===c?void 0:c.definition.overridePermissions)&&void 0!==t?t:{}),Object.entries(m).filter((e=>{let[t,n]=e;return n})).map((e=>{let[t]=e;return t})).join(" "));var m;return(0,Ss.jsx)(Mb,{className:"tl-embed-container",id:e.id,children:null!==c&&void 0!==c&&c.definition?(0,Ss.jsx)("iframe",{className:"tl-embed",sandbox:g,src:c.embedUrl,width:ga(r),height:ga(i),draggable:!1,frameBorder:"0",referrerPolicy:"no-referrer-when-downgrade",style:{border:0,pointerEvents:f?"auto":"none",zIndex:f?"":"-1",boxShadow:aR(u),borderRadius:null!==(n=null===c||void 0===c?void 0:c.definition.overrideOutlineRadius)&&void 0!==n?n:8,background:null===c||void 0===c?void 0:c.definition.backgroundColor}}):null})}indicator(e){var t,n;const o=this.getEmbedDefinition(e.props.url);return(0,Ss.jsx)("rect",{width:ga(e.props.w),height:ga(e.props.h),rx:null!==(t=null===o||void 0===o?void 0:o.definition.overrideOutlineRadius)&&void 0!==t?t:8,ry:null!==(n=null===o||void 0===o?void 0:o.definition.overrideOutlineRadius)&&void 0!==n?n:8})}getInterpolatedProps(e,t,n){return l(l({},n>.5?t.props:e.props),{},{w:le(e.props.w,t.props.w,n),h:le(e.props.h,t.props.h,n)})}}function AR(e){let{id:t,file:n,isInteractive:o,width:r,height:i,style:s,pageRotation:a}=e;return(0,Ss.jsx)("iframe",{className:"tl-embed",draggable:!1,width:ga(r),height:ga(i),frameBorder:"0",scrolling:"no",seamless:!0,referrerPolicy:"no-referrer-when-downgrade",style:l(l({},s),{},{pointerEvents:o?"all":"none",zIndex:o?"":"-1",boxShadow:aR(a)}),srcDoc:'\n\t\t\t<html>\n\t\t\t\t<head>\n\t\t\t\t\t<base target="_blank">\n\t\t\t\t</head>\n\t\t\t\t<body>\n\t\t\t\t\t<script src='.concat("https://gist.github.com/".concat(t,".js").concat(n?"?file=".concat(n):""),'><\/script>\n\t\t\t\t\t<style type="text/css">\n\t\t\t\t\t\t* { margin: 0px; }\n\t\t\t\t\t\ttable { height: 100%; background-color: red; }\n\t\t\t\t\t\t.gist { background-color: none; height: 100%;  }\n\t\t\t\t\t\t.gist .gist-file { height: calc(100vh - 2px); padding: 0px; display: grid; grid-template-rows: 1fr auto; }\n\t\t\t\t\t</style>\n\t\t\t\t</body>\n\t\t\t</html>')})}function OR(e,t){const n=((na(e.getShapePageTransform(t.id).rotation())+Math.PI/4)*(2/Math.PI)+4)%4;return Math.floor(n)}function DR(e,t,n){const o=e.textMeasure.measureTextSpans(FR(t.props.name,"Frame")+String.fromCharCode(8203),n),r=o[0],i=_(o),s=i.box.w+i.box.x-r.box.x;return{box:new rc(0,-n.height,s,n.height),spans:o}}function RR(e,t){return{fontSize:12,fontFamily:"Inter, sans-serif",textAlign:"start",width:e.props.w,height:32,padding:0,lineHeight:1,fontStyle:"normal",fontWeight:"normal",overflow:"truncate-ellipsis",verticalTextAlign:"middle",fill:t,offsetY:-34,offsetX:2}}function LR(e,t,n){const o=n?"":"px",r=n?"":"deg";let i;switch(t){case 0:i="";break;case 3:i="translate(".concat(ga(e.props.w)).concat(o,", 0").concat(o,") rotate(90").concat(r,")");break;case 2:i="translate(".concat(ga(e.props.w)).concat(o,", ").concat(ga(e.props.h)).concat(o,") rotate(180").concat(r,")");break;case 1:i="translate(0".concat(o,", ").concat(ga(e.props.h)).concat(o,") rotate(270").concat(r,")");break;default:throw Error("labelSide out of bounds")}return i}s(MR,"type","embed"),s(MR,"props",Di),s(MR,"migrations",Li),s(MR,"embedDefinitions",uj);const zR=(0,e.forwardRef)(((t,n)=>{let{id:o,name:r,isEditing:i}=t;const s=Ns(),a=(0,e.useCallback)((e=>{"Enter"!==e.key||e.nativeEvent.isComposing||(za(e),e.currentTarget.blur(),s.setEditingShape(null))}),[s]),l=(0,e.useCallback)((e=>{const t=s.getShape(o);if(!t)return;const n=t.props.name,r=e.currentTarget.value.trim();n!==r&&s.updateShapes([{id:o,type:"frame",props:{name:r}}])}),[o,s]),c=(0,e.useCallback)((e=>{const t=s.getShape(o);if(!t)return;const n=t.props.name,r=e.currentTarget.value;n!==r&&s.updateShapes([{id:o,type:"frame",props:{name:r}}])}),[o,s]);return(0,Ss.jsxs)("div",{className:"tl-frame-label ".concat(i?"tl-frame-label__editing":""),children:[(0,Ss.jsx)("input",{className:"tl-frame-name-input",ref:n,style:{display:i?void 0:"none"},value:r,autoFocus:!0,onKeyDown:a,onBlur:l,onChange:c}),FR(r,"Frame")+String.fromCharCode(8203)]})}));function NR(t){let{id:n,name:o,width:r,height:i}=t;const s=Ns(),{side:a,translation:l}=yn("shape rotation",(()=>{const e=s.getShape(n);if(!e)return{side:0,translation:"translate(0, 0)"};const t=OR(s,e);return{side:t,translation:LR(e,t,!1)}}),[s,n]),c=(0,e.useRef)(null),d=Fb(n);return(0,e.useEffect)((()=>{const e=c.current;e&&d&&(e.focus(),e.select())}),[c,d]),(0,Ss.jsx)("div",{className:"tl-frame-heading",style:{overflow:d?"visible":"hidden",maxWidth:"calc(var(--tl-zoom) * ".concat(0===a||2===a?Math.ceil(r):Math.ceil(i),"px + var(--space-5))"),bottom:"100%",transform:"".concat(l," scale(var(--tl-scale)) translateX(calc(-1 * var(--space-3))")},children:(0,Ss.jsx)("div",{className:"tl-frame-heading-hit-area",children:(0,Ss.jsx)(zR,{ref:c,id:n,name:o,isEditing:d})})})}function FR(e,t){return e.match(/^\s*$/)?t:e}class BR extends Db{canEdit(){return!0}getDefaultProps(){return{w:320,h:180,name:""}}getGeometry(e){const{editor:t}=this,n=t.getZoomLevel(),o=DR(t,e,RR(e,"black")),r=OR(t,e);let i,s,a,l;const{w:c,h:d}=o.box,u=Math.min(c,e.props.w*n),h=Math.min(d,e.props.h*n);switch(r){case 0:i=-8/n,s=(-d-4)/n,a=(u+16)/n,l=d/n;break;case 1:i=(-d-4)/n,l=(h+16)/n,s=e.props.h-l+8/n,a=d/n;break;case 2:i=e.props.w-(u+8)/n,s=e.props.h+4/n,a=(h+16)/n,l=d/n;break;case 3:i=e.props.w+4/n,l=(h+16)/n,s=-8/n,a=d/n}return new ac({children:[new yu({width:e.props.w,height:e.props.h,isFilled:!1}),new yu({x:i,y:s,width:a,height:l,isFilled:!0,isLabel:!0})]})}getText(e){return e.props.name}component(e){const t=this.editor.getShapeGeometry(e).bounds,n=pD(),o=yn("is creating this shape",(()=>{const t=this.editor.getStateDescendant("select.resizing");if(!t)return!1;if(!t.getIsActive())return!1;const n=null===t||void 0===t?void 0:t.info;return!!n&&(n.isCreating&&this.editor.getOnlySelectedShapeId()===e.id)}),[e.id]);return(0,Ss.jsxs)(Ss.Fragment,{children:[(0,Ss.jsx)(tu,{children:(0,Ss.jsx)("rect",{className:ks("tl-frame__body",{"tl-frame__creating":o}),width:t.width,height:t.height,fill:n.solid,stroke:n.text})}),o?null:(0,Ss.jsx)(NR,{id:e.id,name:e.props.name,width:t.width,height:t.height})]})}toSvg(e,t){const n=Zo({isDarkMode:t.isDarkMode}),o=LR(e,OR(this.editor,e),!0),r=RR(e,n.text),{box:i,spans:s}=DR(this.editor,e,r),a=TD(this.editor,s,r);return(0,Ss.jsxs)(Ss.Fragment,{children:[(0,Ss.jsx)("rect",{width:e.props.w,height:e.props.h,fill:n.solid,stroke:n.black.solid,strokeWidth:1,rx:1,ry:1}),(0,Ss.jsxs)("g",{transform:o,children:[(0,Ss.jsx)("rect",{x:i.x-8,y:i.y-4,width:i.width+20,height:i.height,fill:n.background,rx:4,ry:4}),a]})]})}indicator(e){const t=this.editor.getShapeGeometry(e).bounds;return(0,Ss.jsx)("rect",{width:ga(t.width),height:ga(t.height),className:"tl-frame-indicator"})}canReceiveNewChildrenOfType(e,t){return!e.isLocked}providesBackgroundForChildren(){return!0}canDropShapes(e,t){return!e.isLocked}onDragShapesOver(e,t){t.every((t=>t.parentId===e.id))||this.editor.reparentShapes(t,e.id)}onDragShapesOut(e,t){const n=this.editor.getShape(e.parentId);n&&this.editor.isShapeOfType(n,"group")?this.editor.reparentShapes(t,n.id):this.editor.reparentShapes(t,this.editor.getCurrentPageId())}onResize(e,t){return Ob(e,t)}getInterpolatedProps(e,t,n){return l(l({},n>.5?t.props:e.props),{},{w:le(e.props.w,t.props.w,n),h:le(e.props.h,t.props.h,n)})}}function UR(e,t){return e>t?2*(Gs*(t/2)+(e-t)):2*(Gs*(e/2)+(t-e))}function HR(e,t){return KR(e,t).map(((e,t)=>e.getSvgPathData(0===t))).join(" ")+" Z"}function KR(e,t){const n=e/4,o=t/4;return[new Vb({start:new Vs(e/2,t),cp1:new Vs(1.5*n,3*o),cp2:new Vs(0,2.5*o),end:new Vs(0,1.2*o)}),new Vb({start:new Vs(0,1.2*o),cp1:new Vs(0,.32*-o),cp2:new Vs(1.85*n,.32*-o),end:new Vs(e/2,.9*o)}),new Vb({start:new Vs(e/2,.9*o),cp1:new Vs(2.15*n,.32*-o),cp2:new Vs(e,.32*-o),end:new Vs(e,1.2*o)}),new Vb({start:new Vs(e,1.2*o),cp1:new Vs(e,2.5*o),cp2:new Vs(2.5*n,3*o),end:new Vs(e/2,t)})]}function VR(e,t,n,o){return pR(function(e,t,n,o){const r=ce(e),i=t/2,s=n/2,a=ta(i,s),l=[],c=$s*r(),d=$s+Xs/2+Math.abs(r())*Xs,u=Math.max(16,a/10);for(let h=0;h<u;h++){const e=h/(u-1),o=c+e*d,a=Math.cos(o),p=Math.sin(o);l.push(new Vs(i*a+.5*t+.05*r(),s*p+n/2+.05*r(),Math.min(1,.5+Math.abs(.5-(r()>0?Ks.easeInOutSine(e):Ks.easeInExpo(e)))/2)))}return FA(l,function(e){return{size:1+e,thinning:.25,end:{taper:e},start:{taper:e},streamline:0,smoothing:1,simulatePressure:!1}}(o))}(e,t,n,o))}function WR(e){let t="M";let n,o,r;for(let i=0,s=e.length;i<s;i+=3)n=e[i],o=e[i+1],r=e[i+2],t+="".concat(qs(n),"L").concat(qs(o),"Q").concat(qs(r));return t+="".concat(qs(e[0])),t}function qR(e,t,n,o,r){const i=[],s=ce(e);let a,l=t[0];const c=t.length;for(let d=0,u=c*r;d<u;d++){a=Vs.AddXY(t[(d+1)%c],s()*n,s()*n);const e=Vs.Sub(a,l),r=Vs.Len(e),u=Vs.Div(e,r).mul(Math.min(r/4,o));i.push(Vs.Add(l,u),Vs.Add(a,u.neg()),a),l=a}return i}s(BR,"type","frame"),s(BR,"props",zi),s(BR,"migrations",Ni);const YR={s:50,m:70,l:100,xl:130};function GR(e,t,n,o,r){const i=ce(n),s=UR(e,t),a=Math.max(Math.ceil(s/YR[o]),6,Math.ceil(s/Math.min(e,t))),l=s/a*.2,c=Math.max(e-2*l,1),d=Math.max(t-2*l,1),u=UR(c,d)/a,h=(e-c)/2,p=(t-d)/2,f=function(e,t,n){const o=Math.min(e,t)/2,r=Math.max(e,t)-2*o,i=(Math.PI*(2*o)+2*r)/n,s=e>t?[{type:"straight",start:new Vs(o,0),delta:new Vs(1,0)},{type:"arc",center:new Vs(e-o,o),startAngle:-Gs/2},{type:"straight",start:new Vs(e-o,t),delta:new Vs(-1,0)},{type:"arc",center:new Vs(o,o),startAngle:Gs/2}]:[{type:"straight",start:new Vs(e,o),delta:new Vs(0,1)},{type:"arc",center:new Vs(o,t-o),startAngle:0},{type:"straight",start:new Vs(0,t-o),delta:new Vs(0,-1)},{type:"arc",center:new Vs(o,o),startAngle:Gs}];let a=0;const l=[];for(let c=0;c<n;c++){const e=s[0];"straight"===e.type?l.push(Vs.Add(e.start,Vs.Mul(e.delta,a))):l.push(ca(e.center,o,e.startAngle+a/o)),a+=i;let t="straight"===e.type?r:Gs*o;for(;a>t;)a-=t,s.push(s.shift()),t="straight"===s[0].type?r:Gs*o}return l}(c,d,a).map((e=>e.addXY(h,p))),g=e<20?0:.3*l,m=t<20?0:.3*l,y=f.slice(0);for(let b=0;b<Math.floor(a/2);b++)y[b]=Vs.AddXY(y[b],i()*g*r,i()*m*r),y[a-b-1]=Vs.AddXY(y[a-b-1],i()*g*r,i()*m*r);const v=[];for(let b=0;b<y.length;b++){const n=b===y.length-1?0:b+1,o=y[b],r=y[n],i=f[b],s=f[n],a=Vs.Dist(i,s),l=u-a,c=Vs.Dist(o,r)/a,d=(Math.max(h,p)+l)*c,g=Vs.Lrp(i,s,.5).add(Vs.Sub(s,i).uni().per().mul(d));g.x<0?g.x=0:g.x>e&&(g.x=e),g.y<0?g.y=0:g.y>t&&(g.y=t);const m=wa(o,r,g),w=Vs.Dist(m||Vs.Average([o,r]),o);v.push({leftPoint:o,rightPoint:r,arcPoint:g,center:m,radius:w})}return v}function XR(e,t,n,o,r){const i=[],s=GR(e,t,n,o,r);for(const{center:a,radius:l,leftPoint:c,rightPoint:d}of s)i.push(...xa(c,d,a,l,10));return i}function $R(e,t,n,o,r){const i=GR(e,t,n,o,r);let s="M".concat(i[0].leftPoint.toFixed());for(const{leftPoint:a,rightPoint:l,radius:c,center:d}of i){if(null===d){s+=" L".concat(l.toFixed());continue}const e=Vs.Clockwise(a,l,d)?"0":"1";s+=" A".concat(ga(c),",").concat(ga(c)," 0 ").concat(e,",1 ").concat(l.toFixed())}return s+=" Z",s}const ZR={s:.5,m:.7,l:.9,xl:1.6};function QR(e,t){switch(e.geo){case"x-box":return function(e,t,n,o){const r="draw"===o?.62:0;if("dashed"===o)return[[new Vs(0,0),new Vs(e/2,t/2)],[new Vs(e,t),new Vs(e/2,t/2)],[new Vs(0,t),new Vs(e/2,t/2)],[new Vs(e,0),new Vs(e/2,t/2)]];const i=t=>Math.max(0,Math.min(e,t)),s=e=>Math.max(0,Math.min(t,e));return[[new Vs(i(n*r),s(n*r)),new Vs(i(e-n*r),s(t-n*r))],[new Vs(i(n*r),s(t-n*r)),new Vs(i(e-n*r),s(n*r))]]}(e.w,e.h,t,e.dash);case"check-box":return function(e,t){const n=.82*Math.min(e,t),o=(e-n)/2,r=(t-n)/2,i=t=>Math.max(0,Math.min(e,t)),s=e=>Math.max(0,Math.min(t,e));return[[new Vs(i(o+.25*n),s(r+.52*n)),new Vs(i(o+.45*n),s(r+.82*n))],[new Vs(i(o+.45*n),s(r+.82*n)),new Vs(i(o+.82*n),s(r+.22*n))]]}(e.w,e.h);default:return}}function JR(e){let{shape:t,shouldScale:n,forceSolid:o}=e;const r=n?t.props.scale:1,i=Ns(),s=pD(),{id:a,props:l}=t,{w:c,color:d,fill:u,dash:h,growY:p,size:f,scale:g}=l,m=wO[f]*r,y=l.h+p;switch(l.geo){case"cloud":if("solid"===h){const e=$R(c,y,a,f,g);return(0,Ss.jsxs)(Ss.Fragment,{children:[(0,Ss.jsx)(ED,{theme:s,d:e,color:d,fill:u,scale:r}),(0,Ss.jsx)("path",{d:e,stroke:s[d].solid,strokeWidth:m,fill:"none"})]})}if("draw"===h){const e=function(e,t,n,o,r){const i=ce(n),s=ZR[o]*r,a=GR(e,t,n,o,r),l=a.reduce(((e,t)=>e+Vs.Dist2(t.leftPoint,t.rightPoint)),0)/a.length>(15*s)**2?e=>Vs.AddXY(e,i()*s*2,i()*s*2):e=>e;let c="M".concat(a[0].leftPoint.toFixed()),d=l(a[0].leftPoint),u="M".concat(d.toFixed());for(const{leftPoint:h,center:p,rightPoint:f,radius:g,arcPoint:m}of a){if(null===p){c+=" L".concat(f.toFixed());const e=l(f);u+=" L".concat(e.toFixed()),d=e;continue}const e=Vs.Clockwise(h,f,p)?"0":"1";c+=" A".concat(ga(g),",").concat(ga(g)," 0 ").concat(e,",1 ").concat(f.toFixed());const t=l(f),n=wa(d,t,l(m));if(!n){u+=" L".concat(t.toFixed()),d=t;continue}const o=Math.abs(Vs.Dist(n,d));u+=" A".concat(ga(o),",").concat(ga(o)," 0 ").concat(e,",1 ").concat(t.toFixed()),d=t}return c+u+" Z"}(c,y,a,f,g);return(0,Ss.jsxs)(Ss.Fragment,{children:[(0,Ss.jsx)(ED,{theme:s,d:e,color:d,fill:u,scale:r}),(0,Ss.jsx)("path",{d:e,stroke:s[d].solid,strokeWidth:m,fill:"none"})]})}{const e=$R(c,y,a,f,g),t=GR(c,y,a,f,g);return(0,Ss.jsxs)(Ss.Fragment,{children:[(0,Ss.jsx)(ED,{theme:s,d:e,color:d,fill:u,scale:r}),(0,Ss.jsx)("g",{strokeWidth:m,stroke:s[d].solid,fill:"none",pointerEvents:"all",children:t.map(((e,t)=>{let{leftPoint:n,rightPoint:r,center:i,radius:s}=e;const a=i?s*na(na(Vs.Angle(i,r))-na(Vs.Angle(i,n))):Vs.Dist(n,r),{strokeDasharray:l,strokeDashoffset:c}=bu(a,m,{style:h,start:"outset",end:"outset",forceSolid:o});return(0,Ss.jsx)("path",{d:i?"M".concat(n.x,",").concat(n.y,"A").concat(s,",").concat(s,",0,0,1,").concat(r.x,",").concat(r.y):"M".concat(n.x,",").concat(n.y,"L").concat(r.x,",").concat(r.y),strokeDasharray:l,strokeDashoffset:c},t)}))})]})}case"ellipse":{const e=n?i.getShapeGeometry(t):i.getShapeUtil(t).getGeometry(t),a=e.getSvgPathData(!0);if("dashed"===h||"dotted"===h){const t=e.length,{strokeDasharray:n,strokeDashoffset:i}=bu(t<64?2*t:t,m,{style:h,snap:4,closed:!0,forceSolid:o});return(0,Ss.jsxs)(Ss.Fragment,{children:[(0,Ss.jsx)(ED,{theme:s,d:a,color:d,fill:u,scale:r}),(0,Ss.jsx)("path",{d:a,strokeWidth:m,fill:"none",stroke:s[d].solid,strokeDasharray:n,strokeDashoffset:i})]})}{const e=(n?i.getShapeGeometry(t):i.getShapeUtil(t).getGeometry(t)).getSvgPathData(!0);return(0,Ss.jsxs)(Ss.Fragment,{children:[(0,Ss.jsx)(ED,{theme:s,d:e,color:d,fill:u,scale:r}),(0,Ss.jsx)("path",{d:e,stroke:s[d].solid,strokeWidth:m,fill:"none"})]})}}case"oval":{const e=n?i.getShapeGeometry(t):i.getShapeUtil(t).getGeometry(t),a=e.getSvgPathData(!0);if("dashed"===h||"dotted"===h){const t=e.getLength(),{strokeDasharray:n,strokeDashoffset:i}=bu(t<64?2*t:t,m,{style:h,snap:4,start:"outset",end:"outset",closed:!0,forceSolid:o});return(0,Ss.jsxs)(Ss.Fragment,{children:[(0,Ss.jsx)(ED,{theme:s,d:a,color:d,fill:u,scale:r}),(0,Ss.jsx)("path",{d:a,strokeWidth:m,fill:"none",stroke:s[d].solid,strokeDasharray:n,strokeDashoffset:i})]})}return(0,Ss.jsxs)(Ss.Fragment,{children:[(0,Ss.jsx)(ED,{theme:s,d:a,color:d,fill:u,scale:r}),(0,Ss.jsx)("path",{d:a,stroke:s[d].solid,strokeWidth:m,fill:"none"})]})}case"heart":if("dashed"===h||"dotted"===h||"solid"===h){const e=HR(c,y),t=KR(c,y);return(0,Ss.jsxs)(Ss.Fragment,{children:[(0,Ss.jsx)(ED,{theme:s,d:e,color:d,fill:u,scale:r}),t.map(((e,t)=>{const{strokeDasharray:n,strokeDashoffset:r}=bu(e.length,m,{style:h,snap:1,start:"outset",end:"outset",closed:!0,forceSolid:o});return(0,Ss.jsx)("path",{d:e.getSvgPathData(),strokeWidth:m,fill:"none",stroke:s[d].solid,strokeDasharray:n,strokeDashoffset:r,pointerEvents:"all"},"curve_".concat(t))}))]})}{const e=function(e,t,n,o){const r=e/4,i=t/4,s=ce(o),a=.75*n,l=e=>e.addXY(s()*a,s()*a),c=new Vs(e/2,t),d=new Vs(0,1.2*i),u=new Vs(e/2,.9*i),h=new Vs(e,1.2*i),p=l(new Vs(e/2,t)),f=l(new Vs(0,1.2*i)),g=l(new Vs(e/2,.9*i)),m=l(new Vs(e,1.2*i));return[new Vb({start:c,cp1:new Vs(1.5*r,3*i),cp2:new Vs(0,2.5*i),end:d}),new Vb({start:d,cp1:new Vs(0,.32*-i),cp2:new Vs(1.85*r,.32*-i),end:u}),new Vb({start:u,cp1:new Vs(2.15*r,.32*-i),cp2:new Vs(e,.32*-i),end:h}),new Vb({start:h,cp1:new Vs(e,2.5*i),cp2:new Vs(2.5*r,3*i),end:p}),new Vb({start:p,cp1:new Vs(1.5*r,3*i),cp2:new Vs(0,2.5*i),end:f}),new Vb({start:f,cp1:new Vs(0,.32*-i),cp2:new Vs(1.85*r,.32*-i),end:g}),new Vb({start:g,cp1:new Vs(2.15*r,.32*-i),cp2:new Vs(e,.32*-i),end:m}),new Vb({start:m,cp1:new Vs(e,2.5*i),cp2:new Vs(2.5*r,3*i),end:c})].map(((e,t)=>e.getSvgPathData(0===t))).join(" ")+" Z"}(c,y,m,t.id);return(0,Ss.jsxs)(Ss.Fragment,{children:[(0,Ss.jsx)(ED,{theme:s,d:e,color:d,fill:u,scale:r}),(0,Ss.jsx)("path",{d:e,stroke:s[d].solid,strokeWidth:m,fill:"none"})]})}default:{const e=n?i.getShapeGeometry(t):i.getShapeUtil(t).getGeometry(t),l=e instanceof ac?e.children[0].vertices:e.vertices,c=QR(t.props,m);if("solid"===h){let e="M"+l[0]+"L"+l.slice(1)+"Z";if(c)for(const[t,n]of c)e+="M".concat(t.x,",").concat(t.y,"L").concat(n.x,",").concat(n.y);return(0,Ss.jsxs)(Ss.Fragment,{children:[(0,Ss.jsx)(ED,{theme:s,d:e,color:d,fill:u,scale:r}),(0,Ss.jsx)("path",{d:e,stroke:s[d].solid,strokeWidth:m,fill:"none"})]})}if("dashed"===h||"dotted"===h){const e="M"+l[0]+"L"+l.slice(1)+"Z";return(0,Ss.jsxs)(Ss.Fragment,{children:[(0,Ss.jsx)(ED,{theme:s,d:e,color:d,fill:u,scale:r}),(0,Ss.jsxs)("g",{strokeWidth:m,stroke:s[d].solid,fill:"none",pointerEvents:"all",children:[Array.from(Array(l.length)).map(((e,t)=>{const n=Vs.ToFixed(l[t]),r=Vs.ToFixed(l[(t+1)%l.length]),i=Vs.Dist(n,r),{strokeDasharray:s,strokeDashoffset:a}=bu(i,m,{style:h,start:"outset",end:"outset",forceSolid:o});return(0,Ss.jsx)("line",{x1:n.x,y1:n.y,x2:r.x,y2:r.y,strokeDasharray:s,strokeDashoffset:a},t)})),c&&c.map(((e,t)=>{let[n,r]=e;const i=Vs.Dist(n,r),{strokeDasharray:a,strokeDashoffset:l}=bu(i,m,{style:h,start:"skip",end:"skip",snap:"dotted"===h?4:void 0,forceSolid:o});return(0,Ss.jsx)("path",{d:"M".concat(n.x,",").concat(n.y,"L").concat(r.x,",").concat(r.y),stroke:s[d].solid,strokeWidth:m,fill:"none",strokeDasharray:a,strokeDashoffset:l},"line_fg_".concat(t))}))]})]})}if("draw"===h){let e=WR(qR(a,l,m/3,2*m,2));if(c)for(const[n,o]of c)e+="M".concat(n.toFixed(),"L").concat(o.toFixed());const t=WR(qR(a,l,0,2*m,1));return(0,Ss.jsxs)(Ss.Fragment,{children:[(0,Ss.jsx)(ED,{theme:s,d:t,color:d,fill:u,scale:r}),(0,Ss.jsx)("path",{d:e,stroke:s[d].solid,strokeWidth:m,fill:"none"})]})}}}}class eL extends Db{canEdit(){return!0}getDefaultProps(){return{w:100,h:100,geo:"rectangle",color:"black",labelColor:"black",fill:"none",dash:"draw",size:"m",font:"draw",text:"",align:"middle",verticalAlign:"middle",growY:0,url:"",scale:1}}getGeometry(e){const t=Math.max(1,e.props.w),n=Math.max(1,e.props.h+e.props.growY),o=t/2,r=n/2,i="none"!==e.props.fill;let s;switch(e.props.geo){case"cloud":s=new mu({points:XR(t,n,e.id,e.props.size,e.props.scale),isFilled:i});break;case"triangle":s=new mu({points:[new Vs(o,0),new Vs(t,n),new Vs(0,n)],isFilled:i});break;case"diamond":s=new mu({points:[new Vs(o,0),new Vs(t,r),new Vs(o,n),new Vs(0,r)],isFilled:i});break;case"pentagon":s=new mu({points:da(t,n,5),isFilled:i});break;case"hexagon":s=new mu({points:da(t,n,6),isFilled:i});break;case"octagon":s=new mu({points:da(t,n,8),isFilled:i});break;case"ellipse":s=new qb({width:t,height:n,isFilled:i});break;case"oval":s=new Yb({width:t,height:n,isFilled:i});break;case"star":{const e=5,o=$s/e/2,r=2*Math.floor(e/4),a=2*e-r,l=0,c=2*Math.floor(e/2),d=Math.cos(r*o-Xs)*t/2,u=Math.cos(a*o-Xs)*t/2,h=Math.sin(l*o-Xs)*n/2,p=Math.sin(c*o-Xs)*n/2,f=t-Math.abs(d-u),g=n-Math.abs(p-h),m=1,y=(t-(t/2+u-(t/2-d)))/2,v=(n-(n/2+h-(n/2-p)))/2,b=(t+f)/2,w=(n+g)/2,x=b*m/2,S=w*m/2;s=new mu({points:Array.from(Array(2*e)).map(((e,t)=>{const n=t*o-Xs;return new Vs(y+(t%2?x:b)*Math.cos(n),v+(t%2?S:w)*Math.sin(n))})),isFilled:i});break}case"rhombus":{const e=Math.min(.38*t,.38*n);s=new mu({points:[new Vs(e,0),new Vs(t,0),new Vs(t-e,n),new Vs(0,n)],isFilled:i});break}case"rhombus-2":{const e=Math.min(.38*t,.38*n);s=new mu({points:[new Vs(0,0),new Vs(t-e,0),new Vs(t,n),new Vs(e,n)],isFilled:i});break}case"trapezoid":{const e=Math.min(.38*t,.38*n);s=new mu({points:[new Vs(e,0),new Vs(t-e,0),new Vs(t,n),new Vs(0,n)],isFilled:i});break}case"arrow-right":{const e=.38*Math.min(t,n),o=.16*n;s=new mu({points:[new Vs(0,o),new Vs(t-e,o),new Vs(t-e,0),new Vs(t,n/2),new Vs(t-e,n),new Vs(t-e,n-o),new Vs(0,n-o)],isFilled:i});break}case"arrow-left":{const e=.38*Math.min(t,n),o=.16*n;s=new mu({points:[new Vs(e,0),new Vs(e,o),new Vs(t,o),new Vs(t,n-o),new Vs(e,n-o),new Vs(e,n),new Vs(0,n/2)],isFilled:i});break}case"arrow-up":{const e=.16*t,o=.38*Math.min(t,n);s=new mu({points:[new Vs(t/2,0),new Vs(t,o),new Vs(t-e,o),new Vs(t-e,n),new Vs(e,n),new Vs(e,o),new Vs(0,o)],isFilled:i});break}case"arrow-down":{const e=.16*t,o=.38*Math.min(t,n);s=new mu({points:[new Vs(e,0),new Vs(t-e,0),new Vs(t-e,n-o),new Vs(t,n-o),new Vs(t/2,n),new Vs(0,n-o),new Vs(e,n-o)],isFilled:i});break}case"check-box":case"x-box":case"rectangle":s=new yu({width:t,height:n,isFilled:i});break;case"heart":{const e=KR(t,n).reduce(((e,t)=>(e.push(...t.vertices),e)),[]);s=new mu({points:e,isFilled:i});break}default:T(e.props.geo)}const a=tL(this.editor,e),l=t/e.props.scale,c=n/e.props.scale,d=Math.min(100,l/2),u=Math.min(SO[e.props.size]*bO.lineHeight+32,c/2),h=Math.min(l,Math.max(a.w,Math.min(d,Math.max(1,l-8)))),p=Math.min(c,Math.max(a.h,Math.min(u,Math.max(1,c-8)))),f=QR(e.props,wO[e.props.size]*e.props.scale),g=f?f.map((e=>new gu({points:e}))):[];return new ac({children:[s,new yu({x:"start"===e.props.align?0:"end"===e.props.align?(l-h)*e.props.scale:(l-h)/2*e.props.scale,y:"start"===e.props.verticalAlign?0:"end"===e.props.verticalAlign?(c-p)*e.props.scale:(c-p)/2*e.props.scale,width:h*e.props.scale,height:p*e.props.scale,isFilled:!0,isLabel:!0}),...g]})}getHandleSnapGeometry(e){const t=this.getGeometry(e),n=t.children[0];switch(e.props.geo){case"arrow-down":case"arrow-left":case"arrow-right":case"arrow-up":case"check-box":case"diamond":case"hexagon":case"octagon":case"pentagon":case"rectangle":case"rhombus":case"rhombus-2":case"star":case"trapezoid":case"triangle":case"x-box":return{outline:n,points:[...n.getVertices(),t.bounds.center]};case"cloud":case"ellipse":case"heart":case"oval":return{outline:n,points:[t.bounds.center]};default:T(e.props.geo)}}getText(e){return e.props.text}onEditEnd(e){const{id:t,type:n,props:{text:o}}=e;o.trimEnd()!==e.props.text&&this.editor.updateShapes([{id:t,type:n,props:{text:o.trimEnd()}}])}component(e){const{id:t,type:n,props:o}=e,{fill:r,font:i,align:s,verticalAlign:a,size:l,text:c}=o,d=pD(),{editor:u}=this,h=yn("isGeoOnlySelected",(()=>e.id===u.getOnlySelectedShapeId()),[]),p=null!==u.getEditingShapeId()||e.props.text,f=yn("force solid",(()=>u.getZoomLevel()<.2),[u]);return(0,Ss.jsxs)(Ss.Fragment,{children:[(0,Ss.jsx)(tu,{children:(0,Ss.jsx)(JR,{shape:e,shouldScale:!0,forceSolid:f})}),p&&(0,Ss.jsx)(Mb,{style:{overflow:"hidden",width:e.props.w,height:e.props.h+o.growY},children:(0,Ss.jsx)(DD,{shapeId:t,type:n,font:i,fontSize:SO[l]*e.props.scale,lineHeight:bO.lineHeight,padding:CO*e.props.scale,fill:r,align:s,verticalAlign:a,text:c,isSelected:h,labelColor:d[o.labelColor].solid,wrap:!0})}),e.props.url&&(0,Ss.jsx)(rR,{url:e.props.url})]})}indicator(e){const{id:t,props:n}=e,{w:o,size:r}=n,i=n.h+n.growY,s=wO[r],a=this.editor.getShapeGeometry(e);switch(n.geo){case"ellipse":return"draw"===n.dash?(0,Ss.jsx)("path",{d:VR(t,o,i,s)}):(0,Ss.jsx)("path",{d:a.getSvgPathData(!0)});case"heart":return(0,Ss.jsx)("path",{d:HR(o,i)});case"oval":return(0,Ss.jsx)("path",{d:a.getSvgPathData(!0)});case"cloud":return(0,Ss.jsx)("path",{d:$R(o,i,t,r,e.props.scale)});default:{const o=this.editor.getShapeGeometry(e),r=o instanceof ac?o.children[0].vertices:o.vertices;let i;if("draw"===n.dash){i=WR(qR(t,r,0,2*s*e.props.scale,1))}else i="M"+r[0]+"L"+r.slice(1)+"Z";const a=QR(e.props,s);if(a)for(const[e,t]of a)i+="M".concat(e.x,",").concat(e.y,"L").concat(t.x,",").concat(t.y);return(0,Ss.jsx)("path",{d:i})}}}toSvg(e,t){const n=l(l({},e),{},{props:l(l({},e.props),{},{w:e.props.w/e.props.scale,h:e.props.h/e.props.scale})}),o=n.props;let r;if(t.addExportDef(gD(o.fill)),o.text){t.addExportDef(fD(o.font));const e=Zo(t),n=new rc(0,0,o.w,o.h+o.growY);r=(0,Ss.jsx)(MD,{fontSize:SO[o.size],font:o.font,align:o.align,verticalAlign:o.verticalAlign,text:o.text,labelColor:e[o.labelColor].solid,bounds:n,padding:16})}return(0,Ss.jsxs)(Ss.Fragment,{children:[(0,Ss.jsx)(JR,{shouldScale:!1,shape:n,forceSolid:!1}),r]})}getCanvasSvgDefs(){return[yD()]}onResize(e,t){let{handle:n,newPoint:o,scaleX:r,scaleY:i,initialShape:s}=t;let a=s.props.w/s.props.scale*r,c=(s.props.h/s.props.scale+s.props.growY/s.props.scale)*i,d=0,u=0;const h=51;if(e.props.text.trim()){let t=Math.max(Math.abs(a),h),n=Math.max(Math.abs(c),h);t<h&&n===h&&(t=h),t===h&&n<h&&(n=h);const o=tL(this.editor,l(l({},e),{},{props:l(l({},e.props),{},{w:t*e.props.scale,h:n*e.props.scale})})),r=Math.max(Math.abs(a),o.w)*Math.sign(a),i=Math.max(Math.abs(c),o.h)*Math.sign(c);d=Math.abs(r)-Math.abs(a),u=Math.abs(i)-Math.abs(c),a=r,c=i}const p=a*e.props.scale,f=c*e.props.scale,g=new Vs(0,0);r<0&&(g.x+=p),"left"!==n&&"top_left"!==n&&"bottom_left"!==n||(g.x+=r<0?d:-d),i<0&&(g.y+=f),"top"!==n&&"top_left"!==n&&"top_right"!==n||(g.y+=i<0?u:-u);const{x:m,y:y}=g.rot(e.rotation).add(o);return{x:m,y:y,props:{w:Math.max(Math.abs(p),1),h:Math.max(Math.abs(f),1),growY:0}}}onBeforeCreate(e){if(!e.props.text)return e.props.growY?l(l({},e),{},{props:l(l({},e.props),{},{growY:0})}):void 0;const t=e.props.h/e.props.scale,n=tL(this.editor,e).h;let o=null;return n>t?o=n-t:e.props.growY&&(o=0),null!==o?l(l({},e),{},{props:l(l({},e.props),{},{growY:o*e.props.scale})}):void 0}onBeforeUpdate(e,t){const n=e.props.text,o=t.props.text;if(n===o&&e.props.font===t.props.font&&e.props.size===t.props.size)return;if(n&&!o)return l(l({},t),{},{props:l(l({},t.props),{},{growY:0})});const r=e.props.w/e.props.scale,i=e.props.h/e.props.scale,s=e.props.growY/e.props.scale,a=tL(this.editor,t);if(!n&&o&&1===o.length){let e=Math.max(r,a.w),n=Math.max(i,a.h);const o=51;return r<o&&i<o&&(e=Math.max(e,o),n=Math.max(n,o),e=Math.max(e,n),n=Math.max(e,n)),l(l({},t),{},{props:l(l({},t.props),{},{w:e*t.props.scale,h:n*t.props.scale,growY:0})})}let c=null;if(a.h>i?c=a.h-i:s&&(c=0),null!==c){const e=t.props.w/t.props.scale;return l(l({},t),{},{props:l(l({},t.props),{},{growY:c*t.props.scale,w:Math.max(e,a.w)*t.props.scale})})}return a.w>r?l(l({},t),{},{props:l(l({},t.props),{},{w:a.w*t.props.scale})}):void 0}onDoubleClick(e){if(this.editor.inputs.altKey)switch(e.props.geo){case"rectangle":return l(l({},e),{},{props:{geo:"check-box"}});case"check-box":return l(l({},e),{},{props:{geo:"rectangle"}})}}getInterpolatedProps(e,t,n){return l(l({},n>.5?t.props:e.props),{},{w:le(e.props.w,t.props.w,n),h:le(e.props.h,t.props.h,n),scale:le(e.props.scale,t.props.scale,n)})}}function tL(e,t){const{text:n,font:o,size:r,w:i}=t.props;if(!n)return{w:0,h:0};const s=e.textMeasure.measureText("w",l(l({},bO),{},{fontFamily:PO[o],fontSize:SO[r],maxWidth:100})),a=e.textMeasure.measureText(n,l(l({},bO),{},{fontFamily:PO[o],fontSize:SO[r],minWidth:s.w,maxWidth:Math.max(0,Math.ceil(s.w+{s:2,m:3.5,l:5,xl:10}[r]),Math.ceil(i/t.props.scale-32))}));return{w:a.w+32,h:a.h+32}}s(eL,"type","geo"),s(eL,"props",Hi),s(eL,"migrations",Vi);class nL extends vu{hideResizeHandles(e){return iL(e)}hideRotateHandle(e){return iL(e)}hideSelectionBoundsFg(e){return iL(e)}getDefaultProps(){return{segments:[],color:"black",size:"m",isComplete:!1,isPen:!1,scale:1}}getGeometry(e){const t=rL(e);if(iL(e))return new Kb({x:-t/2,y:-t/2,radius:t/2,isFilled:!0});const{strokePoints:n,sw:o}=oL(e,t,!0),r=wR({strokeWidth:o,showAsComplete:!0});return HA(n,r),new mu({points:NA(n,r),isFilled:!0})}component(e){const t=aL(this.editor,e),n=rL(e);return(0,Ss.jsx)(tu,{children:(0,Ss.jsx)(sL,{shape:e,forceSolid:t,strokeWidth:n,opacity:.35})})}backgroundComponent(e){const t=aL(this.editor,e),n=rL(e);return(0,Ss.jsx)(tu,{children:(0,Ss.jsx)(sL,{shape:e,forceSolid:t,strokeWidth:n,opacity:.82})})}indicator(e){const t=aL(this.editor,e),n=rL(e),{strokePoints:o,sw:r}=oL(e,n,t),i=SR(e.props.segments);let s;return s=o.length<2?function(e,t){const n=t/2;return"M ".concat(e.x," ").concat(e.y," m -").concat(n,", 0 a ").concat(n,",").concat(n," 0 1,0 ").concat(2*n,",0 a ").concat(n,",").concat(n," 0 1,0 -").concat(2*n,",0")}(i[0],r):pR(o,!1),(0,Ss.jsx)("path",{d:s})}toSvg(e){const t=rL(e),n=t<1.5,o=1/e.props.scale;return(0,Ss.jsx)("g",{transform:"scale(".concat(o,")"),children:(0,Ss.jsx)(sL,{forceSolid:n,strokeWidth:t,shape:e,opacity:.35})})}toBackgroundSvg(e){const t=rL(e),n=t<1.5,o=1/e.props.scale;return(0,Ss.jsx)("g",{transform:"scale(".concat(o,")"),children:(0,Ss.jsx)(sL,{forceSolid:n,strokeWidth:t,shape:e,opacity:.82})})}onResize(e,t){const{scaleX:n,scaleY:o}=t,r=[];for(const i of e.props.segments)r.push(l(l({},i),{},{points:i.points.map((e=>{let{x:t,y:r,z:i}=e;return{x:n*t,y:o*r,z:i}}))}));return{props:{segments:r}}}getInterpolatedProps(e,t,n){return l(l(l({},n>.5?t.props:e.props),t.props),{},{segments:yR(e.props.segments,t.props.segments,n),scale:le(e.props.scale,t.props.scale,n)})}}function oL(e,t,n){var o;const r=SR(e.props.segments),i=e.props.isComplete||"straight"===(null===(o=_(e.props.segments))||void 0===o?void 0:o.type);let s=t;n||e.props.isPen||1!==r.length||(s+=ce(e.id)()*(t/6));return{strokePoints:FA(r,wR({strokeWidth:s,showAsComplete:i})),sw:s}}function rL(e){return 1.12*xO[e.props.size]*e.props.scale}function iL(e){return 1===e.props.segments.length&&e.props.segments[0].points.length<2}function sL(t){var n;let{strokeWidth:o,forceSolid:r,shape:i,opacity:s}=t;const a=pD(),l=SR(i.props.segments);let c=o;r||i.props.isPen||1!==l.length||(c+=ce(i.id)()*(c/6));const d=FA(l,wR({strokeWidth:c,showAsComplete:i.props.isComplete||"straight"===(null===(n=_(i.props.segments))||void 0===n?void 0:n.type)})),u=d.length>1?pR(d,!1):function(e){const t=.1;return"M ".concat(e.x," ").concat(e.y," m -").concat(t,", 0 a ").concat(t,",").concat(t," 0 1,0 ").concat(.2,",0 a ").concat(t,",").concat(t," 0 1,0 -").concat(.2,",0")}(i.props.segments[0].points[0]),h=function(){const[t,n]=(0,e.useState)(!1);return(0,e.useEffect)((()=>{const e=CSS.supports("color","color(display-p3 1 1 1)"),t=matchMedia("(color-gamut: p3)");n(e&&t.matches);const o=()=>n(e&&t.matches);return t.addEventListener("change",o),()=>t.removeEventListener("change",o)}),[]),yn(Ta.forceSrgb)||!t?"srgb":"p3"}(),p=a[i.props.color].highlight[h];return(0,Ss.jsx)("path",{d:u,strokeLinecap:"round",fill:"none",pointerEvents:"all",stroke:p,strokeWidth:c,opacity:s})}function aL(e,t){return yn("forceSolid",(()=>rL(t)/e.getZoomLevel()<1.5),[e])}function lL(){return(0,Ss.jsxs)("svg",{width:"15",height:"15",viewBox:"0 0 30 30",xmlns:"http://www.w3.org/2000/svg",fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,Ss.jsx)("path",{d:"M3,11 L3,3 11,3",strokeWidth:"2"}),(0,Ss.jsx)("path",{d:"M19,27 L27,27 L27,19",strokeWidth:"2"}),(0,Ss.jsx)("path",{d:"M27,3 L3,27",strokeWidth:"2"})]})}function cL(t){let{shapeId:n,assetId:o}=t;const r=Ns(),i=!!Ih(),s=function(){const t=(0,e.useContext)(Ch),[n]=(0,e.useState)(O);return(0,e.useEffect)((()=>(null===t||void 0===t||t.waitUntil(n),()=>{n.resolve()})),[n,t]),Ph((()=>{n.resolve()}))}(),a=(0,e.useMemo)((()=>z(dL,500)),[]),[c,d]=(0,e.useState)((()=>{var e;return{asset:o&&null!==(e=r.getAsset(o))&&void 0!==e?e:null,url:null}})),u=(0,e.useRef)(!1),h=(0,e.useRef)(null);return(0,e.useEffect)((()=>{if(!o)return;let e,t=!1;const c=Ht("update state",(()=>{if(!i&&r.getCulledShapes().has(n))return;const c=r.getAsset(o);if(!c)return;const p=r.getShape(n);if(!p)return;if(!c.props.src){const e=r.getTemporaryAssetPreview(c.id);if(e)return void(h.current!==e&&(h.current=e,d((t=>l(l({},t),{},{isPlaceholder:!0,url:e}))),s()))}const f=r.getZoomLevel()*(p.props.w/c.props.w);function g(e,n){t||h.current!==n&&(u.current=!0,h.current=n,d({asset:e,url:n}),s())}u.current?(a(r,o,f,i,(e=>g(c,e))),e=a.cancel):dL(r,o,f,i,(e=>g(c,e)))}));return()=>{var n;c(),null===(n=e)||void 0===n||n(),t=!0}}),[r,o,i,s,n,a]),c}function dL(e,t,n,o,r){e.resolveAssetUrl(t,{screenScale:n,shouldResolveToOriginal:o}).then((e=>{r(e)}))}s(nL,"type","highlight"),s(nL,"props",Yi),s(nL,"migrations",Gi);function uL(){const[t,n]=(0,e.useState)(!1);return(0,e.useEffect)((()=>{if("undefined"===typeof window||!("matchMedia"in window))return;const e=window.matchMedia("(prefers-reduced-motion: reduce)"),t=()=>{n(e.matches)};return t(),e.addEventListener("change",t),()=>e.removeEventListener("change",t)}),[]),t}class hL extends Db{isAspectRatioLocked(){return!0}canCrop(){return!0}getDefaultProps(){return{w:100,h:100,assetId:null,playing:!0,url:"",crop:null,flipX:!1,flipY:!1}}onResize(e,t){let n=Ob(e,t);const{flipX:o,flipY:r}=t.initialShape.props,{scaleX:i,scaleY:s,mode:a}=t;if(n=l(l({},n),{},{props:l(l({},n.props),{},{flipX:i<0!==o,flipY:s<0!==r})}),!e.props.crop)return n;const c="scale_shape"===a&&-1===i||"resize_bounds"===a&&o!==n.props.flipX,d="scale_shape"===a&&-1===s||"resize_bounds"===a&&r!==n.props.flipY,{topLeft:u,bottomRight:h}=e.props.crop;return n.props.crop={topLeft:{x:c?1-h.x:u.x,y:d?1-h.y:u.y},bottomRight:{x:c?1-u.x:h.x,y:d?1-u.y:h.y}},n}component(e){return(0,Ss.jsx)(pL,{shape:e})}indicator(e){return this.editor.getCroppingShapeId()===e.id?null:(0,Ss.jsx)("rect",{width:ga(e.props.w),height:ga(e.props.h)})}async toSvg(e){if(!e.props.assetId)return null;if(!this.editor.getAsset(e.props.assetId))return null;let t=await this.editor.resolveAssetUrl(e.props.assetId,{shouldResolveToOriginal:!0});return t?((t.startsWith("blob:")||t.startsWith("http")||t.startsWith("/")||t.startsWith("./"))&&(t=await async function(e){const t=await B(e),n=await t.blob();return H.blobToDataUrl(n)}(t)||""),(0,Ss.jsx)(mL,{shape:e,src:t})):null}onDoubleClickEdge(e){const t=e.props;if(!t)return;if(this.editor.getCroppingShapeId()!==e.id)return;const n=bt(t.crop)||{topLeft:{x:0,y:0},bottomRight:{x:1,y:1}},o=1/(n.bottomRight.x-n.topLeft.x)*e.props.w,r=1/(n.bottomRight.y-n.topLeft.y)*e.props.h,i=new Vs(n.topLeft.x*o,n.topLeft.y*r).rot(e.rotation),s={id:e.id,type:e.type,x:e.x-i.x,y:e.y-i.y,props:{crop:{topLeft:{x:0,y:0},bottomRight:{x:1,y:1}},w:o,h:r}};this.editor.updateShapes([s])}getInterpolatedProps(e,t,n){return l(l({},n>.5?t.props:e.props),{},{w:le(e.props.w,t.props.w,n),h:le(e.props.h,t.props.h,n),crop:function(e,t){var o,r,i,s;if(null===e.props.crop&&null===t.props.crop)return null;const a=(null===(o=e.props.crop)||void 0===o?void 0:o.topLeft)||{x:0,y:0},l=(null===(r=e.props.crop)||void 0===r?void 0:r.bottomRight)||{x:1,y:1},c=(null===(i=t.props.crop)||void 0===i?void 0:i.topLeft)||{x:0,y:0},d=(null===(s=t.props.crop)||void 0===s?void 0:s.bottomRight)||{x:1,y:1};return{topLeft:{x:le(a.x,c.x,n),y:le(a.y,c.y,n)},bottomRight:{x:le(l.x,d.x,n),y:le(l.y,d.y,n)}}}(e,t)})}}s(hL,"type","image"),s(hL,"props",$i),s(hL,"migrations",Qi);const pL=(0,e.memo)((function(t){var n;let{shape:o}=t;const r=Ns(),{asset:i,url:s}=cL({shapeId:o.id,assetId:o.props.assetId}),a=uL(),[c,d]=(0,e.useState)(""),[u,h]=(0,e.useState)(null),p=function(e,t){const n=t.props.assetId?e.getAsset(t.props.assetId):void 0;return!!n&&("mimeType"in n.props&&ae.isAnimatedImageType(null===n||void 0===n?void 0:n.props.mimeType)||"isAnimated"in n.props&&n.props.isAnimated)}(r,o);(0,e.useEffect)((()=>{if(s&&p){let e=!1;const t=U();return t.onload=()=>{if(e)return;const n=document.createElement("canvas");n.width=t.width,n.height=t.height;const o=n.getContext("2d");o&&(o.drawImage(t,0,0),d(n.toDataURL()),h(s))},t.crossOrigin="anonymous",t.src=s,()=>{e=!0}}}),[r,p,a,s]);const f=yn("show crop preview",(()=>o.id===r.getOnlySelectedShapeId()&&r.getCroppingShapeId()===o.id&&r.isIn("select.crop")),[r,o.id]),g=a&&((null===i||void 0===i||null===(n=i.props.mimeType)||void 0===n?void 0:n.includes("video"))||p),m=fL(o),y=s===u?null:s,v=g?c:u;if(!s&&(null===i||void 0===i||!i.props.src))return(0,Ss.jsxs)(Mb,{id:o.id,style:{overflow:"hidden",width:o.props.w,height:o.props.h,color:"var(--color-text-3)",backgroundColor:"var(--color-low)",border:"1px solid var(--color-low-border)"},children:[(0,Ss.jsx)("div",{className:ks("tl-image-container",i&&"tl-image-container-loading"),style:m,children:i?null:(0,Ss.jsx)(lL,{})}),"url"in o.props&&o.props.url&&(0,Ss.jsx)(rR,{url:o.props.url})]});const b=p?"anonymous":void 0;return(0,Ss.jsxs)(Ss.Fragment,{children:[f&&v&&(0,Ss.jsx)("div",{style:m,children:(0,Ss.jsx)("img",{className:"tl-image",style:l(l({},gL(o)),{},{opacity:.1}),crossOrigin:b,src:v,referrerPolicy:"strict-origin-when-cross-origin",draggable:!1})}),(0,Ss.jsxs)(Mb,{id:o.id,style:{overflow:"hidden",width:o.props.w,height:o.props.h},children:[(0,Ss.jsxs)("div",{className:ks("tl-image-container"),style:m,children:[v&&(0,Ss.jsx)("img",{className:"tl-image",style:gL(o),crossOrigin:b,src:v,referrerPolicy:"strict-origin-when-cross-origin",draggable:!1},v),y&&(0,Ss.jsx)("img",{className:"tl-image",style:gL(o),crossOrigin:b,src:y,referrerPolicy:"strict-origin-when-cross-origin",draggable:!1,onLoad:()=>h(y)},y)]}),o.props.url&&(0,Ss.jsx)(rR,{url:o.props.url})]})]})}));function fL(e){const t=e.props.crop,n=null===t||void 0===t?void 0:t.topLeft;if(!n)return{width:e.props.w,height:e.props.h};const o=1/(t.bottomRight.x-t.topLeft.x)*e.props.w,r=1/(t.bottomRight.y-t.topLeft.y)*e.props.h,i=-n.x*o,s=-n.y*r;return{transform:"translate(".concat(i,"px, ").concat(s,"px)"),width:o,height:r}}function gL(e,t){const{flipX:n,flipY:o}=e.props;if(!n&&!o)return;const r="scale(".concat(n?-1:1,", ").concat(o?-1:1,")"),i=t?"translate(".concat(n?t.width:0,"px, ").concat(o?t.height:0,"px)"):"";return{transform:"".concat(i," ").concat(r),transformOrigin:t?"0 0":"center center"}}function mL(e){let{shape:t,src:n}=e;const o=As(),r=fL(t),i=t.props.crop;if(r.transform&&i){const{transform:e,width:s,height:a}=r,c=(i.bottomRight.x-i.topLeft.x)*s,d=(i.bottomRight.y-i.topLeft.y)*a,u=[new Vs(0,0),new Vs(c,0),new Vs(c,d),new Vs(0,d)],h=gL(t,{width:s,height:a});return(0,Ss.jsxs)(Ss.Fragment,{children:[(0,Ss.jsx)("defs",{children:(0,Ss.jsx)("clipPath",{id:o,children:(0,Ss.jsx)("polygon",{points:u.map((e=>"".concat(e.x,",").concat(e.y))).join(" ")})})}),(0,Ss.jsx)("g",{clipPath:"url(#".concat(o,")"),children:(0,Ss.jsx)("image",{href:n,width:s,height:a,style:h?l(l({},h),{},{transform:"".concat(e," ").concat(h.transform)}):{transform:e}})})]})}return(0,Ss.jsx)("image",{href:n,width:t.props.w,height:t.props.h,style:gL(t,{width:t.props.w,height:t.props.h})})}function yL(e){return{size:e,thinning:.4,streamline:0,smoothing:.5,simulatePressure:!0,last:!0}}function vL(e,t,n){return FA(t.vertices,yL(n))}function bL(e,t,n){const o=function(e,t,n){const o=yL(n);return NA(HA(vL(0,t,n),o),o)}(0,t,n);return Gc(o)}function wL(e,t,n){let o="M ".concat(qs(t[0]),"L"),r="M ".concat(qs(t[0]),"L");const i=n/3,s=2*n,a=ce(e);let l,c,d=t[0],u=t[0];for(let h=0,p=t.length-1;h<p;h++){l=t[h+1],c=Vs.AddXY(t[h+1],a()*i,a()*i);const e=Vs.Sub(l,d),n=Vs.Len(e),f=Vs.Div(e,n).mul(Math.min(n/4,s)),g=Vs.Add(d,f),m=Vs.Add(l,f.neg()),y=Vs.Sub(c,u),v=Vs.Len(y),b=Vs.Div(y,v).mul(Math.min(v/4,s)),w=Vs.Add(u,b),x=Vs.Add(c,b.neg());h===p-1?(o+="".concat(qs(g),"L ").concat(qs(l)),r+="".concat(qs(w),"L ").concat(qs(c))):(o+="".concat(qs(g),"L ").concat(qs(m),"Q ").concat(qs(l)),r+="".concat(qs(w),"L ").concat(qs(x),"Q ").concat(qs(c)),d=l,u=c)}return[o,o+r]}const xL=new L;class SL extends vu{hideResizeHandles(){return!0}hideRotateHandle(){return!0}hideSelectionBoundsFg(){return!0}hideSelectionBoundsBg(){return!0}getDefaultProps(){const[e,t]=Qe(2);return{dash:"draw",size:"m",color:"black",spline:"line",points:{[e]:{id:e,index:e,x:0,y:0},[t]:{id:t,index:t,x:.1,y:.1}},scale:1}}getGeometry(e){return PL(e)}getHandles(e){return xL.get(e.props,(()=>{const t=PL(e),n=kL(e),o=n.map((e=>l(l({},e),{},{id:e.index,type:"vertex",canSnap:!0})));for(let e=0;e<n.length-1;e++){const r=$e(n[e].index,n[e+1].index),i=t.segments[e].midPoint();o.push({id:r,type:"create",index:r,x:i.x,y:i.y,canSnap:!0})}return o.sort(Je)}))}onResize(e,t){const{scaleX:n,scaleY:o}=t;return{props:{points:ve(e.props.points,((e,t)=>{let{id:r,index:i,x:s,y:a}=t;return{id:r,index:i,x:s*n,y:a*o}}))}}}onBeforeCreate(e){const{props:{points:t}}=e,n=Object.keys(t);if(n.length<2)return;const o=t[n[0]];if(n.every((e=>{const n=t[e];return n.x===o.x&&n.y===o.y}))){const o=n[n.length-1];return t[o]=l(l({},t[o]),{},{x:t[o].x+.1,y:t[o].y+.1}),e}}onHandleDrag(e,t){let{handle:n}=t;if("vertex"!==n.type)return;const o=zb(new Vs(n.x,n.y),this.editor);return l(l({},e),{},{props:l(l({},e.props),{},{points:l(l({},e.props.points),{},{[n.id]:{id:n.id,index:n.index,x:o.x,y:o.y}})})})}component(e){return(0,Ss.jsx)(tu,{children:(0,Ss.jsx)(CL,{shape:e})})}indicator(e){const t=hO[e.props.size]*e.props.scale,n=PL(e),{dash:o}=e.props;let r;if("line"===e.props.spline){const i=n.points;if("solid"===o||"dotted"===o||"dashed"===o)r="M"+i[0]+"L"+i.slice(1);else{const[n]=wL(e.id,i,t);r=n}}else r=function(e,t,n){if("draw"===e.props.dash)return pR(vL(0,t,n));return t.getSvgPathData()}(e,n,t);return(0,Ss.jsx)("path",{d:r})}toSvg(e){return(0,Ss.jsx)(CL,{shouldScale:!0,shape:e})}getHandleSnapGeometry(e){const t=kL(e);return{points:t,getSelfSnapPoints:n=>{const o=this.getHandles(e).filter((e=>"vertex"===e.type)).findIndex((e=>e.id===n.id));return t.filter(((e,t)=>Math.abs(t-o)>1)).map(Vs.From)},getSelfSnapOutline:t=>{const n=this.getHandles(e).filter((e=>"vertex"===e.type)).findIndex((e=>e.id===t.id)),o=PL(e).segments.filter(((e,t)=>t!==n-1&&t!==n));return o.length?new ac({children:o}):null}}}getInterpolatedProps(e,t,n){const o=kL(e),r=kL(t),i=[],s=[];let a="a0";if(o.length>r.length)for(let c=0;c<o.length;c++)i[c]=l({},o[c]),void 0===r[c]?s[c]=l(l({},r[r.length-1]),{},{id:a}):s[c]=l(l({},r[c]),{},{id:a}),a=Ze(a);else if(r.length>o.length)for(let c=0;c<r.length;c++)s[c]=l({},r[c]),void 0===o[c]?i[c]=l(l({},o[o.length-1]),{},{id:a}):i[c]=l(l({},o[c]),{},{id:a}),a=Ze(a);else for(let l=0;l<r.length;l++)i[l]=o[l],s[l]=r[l];return l(l({},n>.5?t.props:e.props),{},{points:Object.fromEntries(i.map(((e,t)=>{const o=s[t];return[e.id,l(l({},e),{},{x:le(e.x,o.x,n),y:le(e.y,o.y,n)})]}))),scale:le(e.props.scale,t.props.scale,n)})}}function kL(e){return Object.values(e.props.points).sort(Je)}function PL(e){const t=kL(e).map(Vs.From);switch(e.props.spline){case"cubic":return new Wb({points:t});case"line":return new gu({points:t})}}function CL(e){let{shape:t,shouldScale:n=!1,forceSolid:o=!1}=e;const r=pD(),i=PL(t),{dash:s,color:a,size:l}=t.props,c=1/t.props.scale,d=n?c:1,u=hO[l]*t.props.scale;if("line"===t.props.spline){if("solid"===s){const e=i.points,t="M"+e[0]+"L"+e.slice(1);return(0,Ss.jsx)("path",{d:t,stroke:r[a].solid,strokeWidth:u,fill:"none",transform:"scale(".concat(d,")")})}if("dashed"===s||"dotted"===s)return(0,Ss.jsx)("g",{stroke:r[a].solid,strokeWidth:u,transform:"scale(".concat(d,")"),children:i.segments.map(((e,t)=>{const{strokeDasharray:n,strokeDashoffset:r}=o?{strokeDasharray:"none",strokeDashoffset:"none"}:bu(e.length,u,{style:s,start:t>0?"outset":"none",end:t<i.segments.length-1?"outset":"none"});return(0,Ss.jsx)("path",{strokeDasharray:n,strokeDashoffset:r,d:e.getSvgPathData(!0),fill:"none"},t)}))});if("draw"===s){const e=i.points,[n,o]=wL(t.id,e,u);return(0,Ss.jsx)("path",{d:o,stroke:r[a].solid,strokeWidth:u,fill:"none",transform:"scale(".concat(d,")")})}}if("cubic"===t.props.spline){const e=i.getSvgPathData();if("solid"===s)return(0,Ss.jsx)("path",{strokeWidth:u,stroke:r[a].solid,fill:"none",d:e,transform:"scale(".concat(d,")")});if("dashed"===s||"dotted"===s)return(0,Ss.jsx)("g",{stroke:r[a].solid,strokeWidth:u,transform:"scale(".concat(d,")"),children:i.segments.map(((e,t)=>{const{strokeDasharray:n,strokeDashoffset:r}=bu(e.length,u,{style:s,start:t>0?"outset":"none",end:t<i.segments.length-1?"outset":"none",forceSolid:o});return(0,Ss.jsx)("path",{strokeDasharray:n,strokeDashoffset:r,d:e.getSvgPathData(),fill:"none"},t)}))});if("draw"===s)return(0,Ss.jsx)("path",{d:bL(0,i,u),strokeWidth:1,stroke:r[a].solid,fill:r[a].solid,transform:"scale(".concat(d,")")})}}s(SL,"type","line"),s(SL,"props",ts),s(SL,"migrations",os);class _L extends vu{canEdit(){return!0}hideResizeHandles(){return!0}hideSelectionBoundsFg(){return!1}getDefaultProps(){return{color:"black",size:"m",text:"",font:"draw",align:"middle",verticalAlign:"middle",labelColor:"black",growY:0,fontSizeAdjustment:0,url:"",scale:1}}getGeometry(e){const{labelHeight:t,labelWidth:n}=jL(this.editor,e),{scale:o}=e.props,r=t*o,i=n*o,s=JO*o,a=TL(e);return new ac({children:[new yu({width:s,height:a,isFilled:!0}),new yu({x:"start"===e.props.align?0:"end"===e.props.align?s-i:(s-i)/2,y:"start"===e.props.verticalAlign?0:"end"===e.props.verticalAlign?a-r:(a-r)/2,width:i,height:r,isFilled:!0,isLabel:!0})]})}getHandles(e){const{scale:t}=e.props;if(this.editor.getInstanceState().isCoarsePointer)return[];const n=this.editor.getZoomLevel();if(n*t<.25)return[];const o=TL(e),r=JO*t,i=0/n*t;return n*t<.5?[{id:"bottom",index:"a3",type:"clone",x:r/2,y:o+i}]:[{id:"top",index:"a1",type:"clone",x:r/2,y:-i},{id:"right",index:"a2",type:"clone",x:r+i,y:o/2},{id:"bottom",index:"a3",type:"clone",x:r/2,y:o+i},{id:"left",index:"a4",type:"clone",x:-i,y:o/2}]}getText(e){return e.props.text}component(t){const{id:n,type:o,props:{labelColor:r,scale:i,color:s,font:a,size:l,align:c,text:d,verticalAlign:u,fontSizeAdjustment:h}}=t,p=function(t){const n=Ns(),o=nE();return(0,e.useCallback)((e=>{const r=n.getShape(t);if(!r)return;const i="Tab"===e.key,s=(e.metaKey||e.ctrlKey)&&"Enter"===e.key;if(i||s){e.preventDefault();const a=n.getShapePageTransform(t),l=a.rotation(),c=!("rtl"!==o.dir&&!TO(r.props.text)),d=(JO+n.options.adjacentShapeMargin+(s&&!e.shiftKey?r.props.growY:0))*r.props.scale,u=new Vs(i?e.shiftKey!=c?-1:1:0,s?e.shiftKey?-1:1:0).mul(d).add(eD.clone().mul(r.props.scale)).rot(l).add(a.point()),h=rD(n,r,u,l);h&&(n.markHistoryStoppingPoint("editing adjacent shape"),YI(n,h,!0))}}),[t,n,o.dir])}(n),f=pD(),g=JO*i,m=TL(t),y=yn("shape rotation",(()=>{var e,t;return null!==(e=null===(t=this.editor.getShapePageTransform(n))||void 0===t?void 0:t.rotation())&&void 0!==e?e:0}),[this.editor]),v=yn("zoom",(()=>this.editor.getZoomLevel()<.35/i),[i,this.editor]),b=yn("dark mode",(()=>this.editor.user.getIsDarkMode()),[this.editor]),w=t.id===this.editor.getOnlySelectedShapeId();return(0,Ss.jsxs)(Ss.Fragment,{children:[(0,Ss.jsx)("div",{id:n,className:"tl-note__container",style:{width:g,height:m,backgroundColor:f[s].note.fill,borderBottom:v?"".concat(2*i,b?"px solid rgb(20, 20, 20)":"px solid rgb(144, 144, 144)"):"none",boxShadow:v?"none":ML(t.id,y,i)},children:(0,Ss.jsx)(DD,{shapeId:n,type:o,font:a,fontSize:(h||SO[l])*i,lineHeight:bO.lineHeight,align:c,verticalAlign:u,text:d,isNote:!0,isSelected:w,labelColor:"black"===r?f[s].note.text:f[r].fill,wrap:!0,padding:16*i,onKeyDown:p})}),"url"in t.props&&t.props.url&&(0,Ss.jsx)(rR,{url:t.props.url})]})}indicator(e){const{scale:t}=e.props;return(0,Ss.jsx)("rect",{rx:t,width:ga(JO*t),height:ga(TL(e))})}toSvg(e,t){e.props.text&&t.addExportDef(fD(e.props.font));const n=Zo({isDarkMode:t.isDarkMode}),o=function(e){return new rc(0,0,JO,JO+e.props.growY)}(e);return(0,Ss.jsxs)(Ss.Fragment,{children:[(0,Ss.jsx)("rect",{x:5,y:5,rx:1,width:190,height:o.h,fill:"rgba(0,0,0,.1)"}),(0,Ss.jsx)("rect",{rx:1,width:JO,height:o.h,fill:n[e.props.color].note.fill}),(0,Ss.jsx)(MD,{fontSize:e.props.fontSizeAdjustment||SO[e.props.size],font:e.props.font,align:e.props.align,verticalAlign:e.props.verticalAlign,text:e.props.text,labelColor:n[e.props.color].note.text,bounds:o,stroke:!1})]})}onBeforeCreate(e){return IL(this.editor,e)}onBeforeUpdate(e,t){if(e.props.text!==t.props.text||e.props.font!==t.props.font||e.props.size!==t.props.size)return IL(this.editor,t)}onEditEnd(e){const{id:t,type:n,props:{text:o}}=e;o.trimEnd()!==e.props.text&&this.editor.updateShapes([{id:t,type:n,props:{text:o.trimEnd()}}])}getInterpolatedProps(e,t,n){return l(l({},n>.5?t.props:e.props),{},{scale:le(e.props.scale,t.props.scale,n)})}}function IL(e,t){const{labelHeight:n,fontSizeAdjustment:o}=jL(e,t),r=Math.max(0,n-JO);if(r!==t.props.growY||o!==t.props.fontSizeAdjustment)return l(l({},t),{},{props:l(l({},t.props),{},{growY:r,fontSizeAdjustment:o})})}s(_L,"type","note"),s(_L,"props",rs),s(_L,"migrations",ss);const EL=new L;function jL(e,t){return EL.get(t,(()=>function(e,t){const{text:n}=t.props;if(!n)return{labelHeight:SO[t.props.size]*bO.lineHeight+32,labelWidth:100,fontSizeAdjustment:0};const o=SO[t.props.size];let r=0,i=0,s=JO,a=JO;do{r=Math.min(o,o-i);const c=e.textMeasure.measureText(n,l(l({},bO),{},{fontFamily:PO[t.props.font],fontSize:r,maxWidth:167,disableOverflowWrapBreaking:!0}));if(s=c.h+32,a=c.w+32,r<=14){const o=e.textMeasure.measureText(n,l(l({},bO),{},{fontFamily:PO[t.props.font],fontSize:r,maxWidth:167}));s=o.h+32,a=o.w+32;break}if(c.scrollWidth.toFixed(0)===c.w.toFixed(0))break}while(i++<50);return{labelHeight:s,labelWidth:a,fontSizeAdjustment:r}}(e,t)))}function TL(e){return(JO+e.props.growY)*e.props.scale}function ML(e,t,n){const o=ce(e),r=Math.abs(o())+.5,i=Math.cos(t),s=5*n,a=4*n,l=6*n,c=7*n;return"0px ".concat(s-r,"px ").concat(s,"px -").concat(s,"px rgba(15, 23, 31, .6),\n\t0px ").concat((a+r*c)*Math.max(0,i),"px ").concat(l+r*c,"px -").concat(a+r*l,"px rgba(15, 23, 31, ").concat((.3+.1*r).toFixed(2),"), \n\t0px ").concat(48*n,"px ").concat(10*n,"px -").concat(10*n,"px inset rgba(15, 23, 44, ").concat(((.022+.005*o())*((1+i)/2)).toFixed(2),")")}const AL=new L;class OL extends vu{getDefaultProps(){return{color:"black",size:"m",w:8,text:"",font:"draw",textAlign:"start",autoSize:!0,scale:1}}getMinDimensions(e){return AL.get(e.props,(e=>DL(this.editor,e)))}getGeometry(e){const{scale:t}=e.props,{width:n,height:o}=this.getMinDimensions(e);return new yu({width:n*t,height:o*t,isFilled:!0,isLabel:!0})}getText(e){return e.props.text}canEdit(){return!0}isAspectRatioLocked(){return!0}component(t){const{id:n,props:{font:o,size:r,text:i,color:s,scale:a,textAlign:l}}=t,{width:c,height:d}=this.getMinDimensions(t),u=t.id===this.editor.getOnlySelectedShapeId(),h=pD(),p=function(t){const n=Ns();return(0,e.useCallback)((e=>{if(n.getEditingShapeId()===t)switch(e.key){case"Enter":(e.ctrlKey||e.metaKey)&&n.complete();break;case"Tab":Da(e),e.shiftKey?IO.unindent(e.currentTarget):IO.indent(e.currentTarget)}}),[n,t])}(n);return(0,Ss.jsx)(DD,{shapeId:n,classNamePrefix:"tl-text-shape",type:"text",font:o,fontSize:xO[r],lineHeight:bO.lineHeight,align:l,verticalAlign:"middle",text:i,labelColor:h[s].solid,isSelected:u,textWidth:c,textHeight:d,style:{transform:"scale(".concat(a,")"),transformOrigin:"top left"},wrap:!0,onKeyDown:p})}indicator(e){const t=this.editor.getShapeGeometry(e).bounds,n=Ns();return e.props.autoSize&&n.getEditingShapeId()===e.id?null:(0,Ss.jsx)("rect",{width:ga(t.width),height:ga(t.height)})}toSvg(e,t){var n,o;e.props.text&&t.addExportDef(fD(e.props.font));const r=this.editor.getShapeGeometry(e).bounds,i=r.width/(null!==(n=e.props.scale)&&void 0!==n?n:1),s=r.height/(null!==(o=e.props.scale)&&void 0!==o?o:1),a=Zo(t);return(0,Ss.jsx)(MD,{fontSize:xO[e.props.size],font:e.props.font,align:e.props.textAlign,verticalAlign:"middle",text:e.props.text,labelColor:a[e.props.color].solid,bounds:new rc(0,0,i,s),padding:0})}onResize(e,t){const{newPoint:n,initialBounds:o,initialShape:r,scaleX:i,handle:s}=t;if("scale_shape"===t.mode||"right"!==s&&"left"!==s)return l({id:e.id,type:e.type},function(e,t){let{initialBounds:n,scaleX:o,scaleY:r,newPoint:i}=t;const s=Math.max(.01,Math.min(Math.abs(o),Math.abs(r))),a=new Vs(0,0);o<0&&(a.x=-n.width*s),r<0&&(a.y=-n.height*s);const{x:l,y:c}=Vs.Add(i,a.rot(e.rotation));return{x:l,y:c,props:{scale:s*e.props.scale}}}(e,t));{const t=Math.max(1,Math.abs(o.width*i)),{x:s,y:a}=i<0?Vs.Sub(n,Vs.FromAngle(e.rotation).mul(t)):n;return{id:e.id,type:e.type,x:s,y:a,props:{w:t/r.props.scale,autoSize:!1}}}}onEditEnd(e){const{id:t,type:n,props:{text:o}}=e,r=e.props.text.trimEnd();0===r.length?this.editor.deleteShapes([e.id]):r!==e.props.text&&this.editor.updateShapes([{id:t,type:n,props:{text:o.trimEnd()}}])}onBeforeUpdate(e,t){if(!t.props.autoSize)return;const n=e.props.size!==t.props.size||e.props.textAlign!==t.props.textAlign||e.props.font!==t.props.font||1!==e.props.scale&&1===t.props.scale,o=e.props.text!==t.props.text;if(!n&&!o)return;const r=this.getMinDimensions(e),i=DL(this.editor,t.props),s=r.width*e.props.scale,a=r.height*e.props.scale,c=i.width*t.props.scale,d=i.height*t.props.scale;let u;switch(t.props.textAlign){case"middle":u=new Vs((c-s)/2,o?0:(d-a)/2);break;case"end":u=new Vs(c-s,o?0:(d-a)/2);break;default:if(o)break;u=new Vs(0,(d-a)/2)}if(u){u.rot(t.rotation);const{x:e,y:n}=t;return l(l({},t),{},{x:e-u.x,y:n-u.y,props:l(l({},t.props),{},{w:c})})}return l(l({},t),{},{props:l(l({},t.props),{},{w:c})})}}function DL(e,t){const{font:n,text:o,autoSize:r,size:i,w:s}=t,a=r?16:Math.max(16,s),c=xO[i],d=r?null:Math.floor(Math.max(a,s)),u=e.textMeasure.measureText(o,l(l({},bO),{},{fontFamily:PO[n],fontSize:c,maxWidth:d}));return r&&(u.w+=1),{width:Math.max(a,u.w),height:Math.max(c,u.h)}}s(OL,"type","text"),s(OL,"props",ls),s(OL,"migrations",ds);class RL extends Db{canEdit(){return!0}isAspectRatioLocked(){return!0}getDefaultProps(){return{w:100,h:100,assetId:null,time:0,playing:!0,url:""}}component(e){return(0,Ss.jsx)(LL,{shape:e})}indicator(e){return(0,Ss.jsx)("rect",{width:ga(e.props.w),height:ga(e.props.h)})}async toSvg(e){const t=await async function(e,t){const n=await e.resolveAssetUrl(t.props.assetId,{shouldResolveToOriginal:!0});if(!n)return null;const o=await ae.loadVideo(n);return ae.getVideoFrameAsDataUrl(o,0)}(this.editor,e);return t?(0,Ss.jsx)("image",{href:t,width:e.props.w,height:e.props.h}):null}}s(RL,"type","video"),s(RL,"props",us),s(RL,"migrations",ps);const LL=(0,e.memo)((function(t){let{shape:n}=t;const o=Ns(),r=o.getShapeGeometry(n).bounds.w*o.getZoomLevel()>=110,i=Fb(n.id),s=uL(),{Spinner:a}=md(),{asset:l,url:c}=cL({shapeId:n.id,assetId:n.props.assetId}),d=(0,e.useRef)(null),[u,h]=(0,e.useState)(!1),[p,f]=(0,e.useState)(!1);(0,e.useEffect)((()=>{const e=()=>f(document.fullscreenElement===d.current);return document.addEventListener("fullscreenchange",e),()=>document.removeEventListener("fullscreenchange",e)}));const g=(0,e.useCallback)((e=>{e.currentTarget&&h(!0)}),[]);return(0,e.useEffect)((()=>{const e=d.current;e&&i&&document.activeElement!==e&&e.focus()}),[i,u]),(0,e.useEffect)((()=>{if(s){const e=d.current;if(!e)return;e.pause(),e.currentTime=0}}),[d,s]),(0,Ss.jsxs)(Ss.Fragment,{children:[(0,Ss.jsx)(Mb,{id:n.id,style:{color:"var(--color-text-3)",backgroundColor:l?"transparent":"var(--color-low)",border:l?"none":"1px solid var(--color-low-border)"},children:(0,Ss.jsx)("div",{className:"tl-counter-scaled",children:(0,Ss.jsx)("div",{className:"tl-video-container",children:l?a&&!l.props.src?(0,Ss.jsx)(a,{}):c?(0,Ss.jsxs)(Ss.Fragment,{children:[(0,Ss.jsx)("video",{ref:d,style:i?{pointerEvents:"all"}:u?void 0:{display:"none"},className:ks("tl-video","tl-video-shape-".concat(n.id.split(":")[1]),{"tl-video-is-fullscreen":p}),width:"100%",height:"100%",draggable:!1,playsInline:!0,autoPlay:!0,muted:!0,loop:!0,disableRemotePlayback:!0,disablePictureInPicture:!0,controls:i&&r,onLoadedData:g,hidden:!u,children:(0,Ss.jsx)("source",{src:c})}),!u&&a&&(0,Ss.jsx)(a,{})]}):null:(0,Ss.jsx)(lL,{})})})}),"url"in n.props&&n.props.url&&(0,Ss.jsx)(rR,{url:n.props.url})]})}));const zL=[OL,lR,PR,eL,_L,SL,BR,$D,nL,MR,hL,RL];class NL extends gm{constructor(){super(...arguments),s(this,"info",{}),s(this,"scribbleId","id"),s(this,"markId",""),s(this,"excludedShapeIds",new Set)}onEnter(e){this.markId=this.editor.markHistoryStoppingPoint("erase scribble begin"),this.info=e;const{originPagePoint:t}=this.editor.inputs;this.excludedShapeIds=new Set(this.editor.getCurrentPageShapes().filter((e=>{if(this.editor.isShapeOrAncestorLocked(e))return!0;if(this.editor.isShapeOfType(e,"group")||this.editor.isShapeOfType(e,"frame")){const n=this.editor.getPointInShapeSpace(e,t);return this.editor.getShapeGeometry(e).bounds.containsPoint(n)}return!1})).map((e=>e.id)));const n=this.editor.scribbles.addScribble({color:"muted-1",size:12});this.scribbleId=n.id,this.update()}pushPointToScribble(){const{x:e,y:t}=this.editor.inputs.currentPagePoint;this.editor.scribbles.addPoint(this.scribbleId,e,t)}onExit(){this.editor.setErasingShapes([]),this.editor.scribbles.stop(this.scribbleId)}onPointerMove(){this.update()}onPointerUp(){this.complete()}onCancel(){this.cancel()}onComplete(){this.complete()}update(){const{editor:e,excludedShapeIds:t}=this,n=e.getErasingShapeIds(),o=e.getZoomLevel(),r=e.getCurrentPageRenderingShapesSorted(),{inputs:{currentPagePoint:i,previousPagePoint:s}}=e;this.pushPointToScribble();const a=new Set(n),l=this.editor.options.hitTestMargin/o;for(const c of r){if(e.isShapeOfType(c,"group"))continue;const t=e.getShapeMask(c.id);if(t&&!fa(i,t))continue;const n=e.getShapeGeometry(c),o=e.getShapePageTransform(c);if(!n||!o)continue;const r=o.clone().invert(),d=r.applyToPoint(s),u=r.applyToPoint(i),{bounds:h}=n;h.minX-l>Math.max(d.x,u.x)||h.minY-l>Math.max(d.y,u.y)||h.maxX+l<Math.min(d.x,u.x)||h.maxY+l<Math.min(d.y,u.y)||n.hitTestLineSegment(d,u,l)&&a.add(e.getOutermostSelectableShape(c).id)}this.editor.setErasingShapes([...a].filter((e=>!t.has(e))))}complete(){const{editor:e}=this;e.deleteShapes(e.getCurrentPageState().erasingShapeIds),this.parent.transition("idle")}cancel(){const{editor:e}=this;e.bailToMark(this.markId),this.parent.transition("idle",this.info)}}s(NL,"id","erasing");class FL extends gm{onPointerDown(e){this.parent.transition("pointing",e)}onCancel(){this.editor.setCurrentTool("select")}}s(FL,"id","idle");class BL extends gm{onEnter(){const e=this.editor.getZoomLevel(),t=this.editor.getCurrentPageRenderingShapesSorted(),{inputs:{currentPagePoint:n}}=this.editor,o=new Set,r=o.size;for(let i=t.length-1;i>=0;i--){const s=t[i];if(!this.editor.isShapeOrAncestorLocked(s)&&!this.editor.isShapeOfType(s,"group")&&this.editor.isPointInShape(s,n,{hitInside:!1,margin:this.editor.options.hitTestMargin/e})){const e=this.editor.getOutermostSelectableShape(s);if(this.editor.isShapeOfType(e,"frame")&&o.size>r)break;o.add(e.id)}}this.editor.setErasingShapes([...o])}onLongPress(e){this.startErasing(e)}onExit(e,t){"erasing"!==t&&this.editor.setErasingShapes([])}onPointerMove(e){this.editor.inputs.isDragging&&this.startErasing(e)}onPointerUp(){this.complete()}onCancel(){this.cancel()}onComplete(){this.complete()}onInterrupt(){this.cancel()}startErasing(e){this.parent.transition("erasing",e)}complete(){const e=this.editor.getErasingShapeIds();e.length&&(this.editor.markHistoryStoppingPoint("erase end"),this.editor.deleteShapes(e)),this.parent.transition("idle")}cancel(){this.parent.transition("idle")}}s(BL,"id","pointing");class UL extends gm{static children(){return[FL,BL,NL]}onEnter(){this.editor.setCursor({type:"cross",rotation:0})}}s(UL,"id","eraser"),s(UL,"initial","idle"),s(UL,"isLockable",!1);class HL extends gm{constructor(){super(...arguments),s(this,"initialCamera",new Vs)}onEnter(){this.initialCamera=Vs.From(this.editor.getCamera()),this.update()}onPointerMove(){this.update()}onPointerUp(){this.complete()}onCancel(){this.parent.transition("idle")}onComplete(){this.complete()}update(){const{initialCamera:e,editor:t}=this,{currentScreenPoint:n,originScreenPoint:o}=t.inputs,r=Vs.Sub(n,o).div(t.getZoomLevel());0!==r.len2()&&t.setCamera(e.clone().add(r))}complete(){const{editor:e}=this,{pointerVelocity:t}=e.inputs,n=Math.min(t.len(),2);n>.1&&this.editor.slideCamera({speed:n,direction:t}),this.parent.transition("idle")}}s(HL,"id","dragging");class KL extends gm{onEnter(){this.editor.setCursor({type:"grab",rotation:0})}onPointerDown(e){this.parent.transition("pointing",e)}onCancel(){this.editor.setCurrentTool("select")}}s(KL,"id","idle");class VL extends gm{onEnter(){this.editor.stopCameraAnimation(),this.editor.setCursor({type:"grabbing",rotation:0})}onLongPress(){this.startDragging()}onPointerMove(){this.editor.inputs.isDragging&&this.startDragging()}startDragging(){this.parent.transition("dragging")}onPointerUp(){this.complete()}onCancel(){this.complete()}onComplete(){this.complete()}onInterrupt(){this.complete()}complete(){this.parent.transition("idle")}}s(VL,"id","pointing");class WL extends gm{static children(){return[KL,VL,HL]}onDoubleClick(e){if("settle"===e.phase){const{currentScreenPoint:e}=this.editor.inputs;this.editor.zoomIn(e,{animation:{duration:220,easing:Ks.easeOutQuint}})}}onTripleClick(e){if("settle"===e.phase){const{currentScreenPoint:e}=this.editor.inputs;this.editor.zoomOut(e,{animation:{duration:320,easing:Ks.easeOutQuint}})}}onQuadrupleClick(e){if("settle"===e.phase){const e=this.editor.getZoomLevel(),{inputs:{currentScreenPoint:t}}=this.editor;1===e?this.editor.zoomToFit({animation:{duration:400,easing:Ks.easeOutQuint}}):this.editor.resetZoom(t,{animation:{duration:320,easing:Ks.easeOutQuint}})}}}s(WL,"id","hand"),s(WL,"initial","idle"),s(WL,"isLockable",!1);class qL extends gm{onPointerDown(e){this.parent.transition("lasering",e)}}s(qL,"id","idle");class YL extends gm{constructor(){super(...arguments),s(this,"scribbleId","id")}onEnter(){const e=this.editor.scribbles.addScribble({color:"laser",opacity:.7,size:4,delay:this.editor.options.laserDelayMs,shrink:.05,taper:!0});this.scribbleId=e.id,this.pushPointToScribble()}onExit(){this.editor.scribbles.stop(this.scribbleId)}onPointerMove(){this.pushPointToScribble()}onPointerUp(){this.complete()}pushPointToScribble(){const{x:e,y:t}=this.editor.inputs.currentPagePoint;this.editor.scribbles.addPoint(this.scribbleId,e,t)}onCancel(){this.cancel()}onComplete(){this.complete()}complete(){this.parent.transition("idle")}cancel(){this.parent.transition("idle")}}s(YL,"id","lasering");class GL extends gm{static children(){return[qL,YL]}onEnter(){this.editor.setCursor({type:"cross",rotation:0})}}s(GL,"id","laser"),s(GL,"initial","idle"),s(GL,"isLockable",!1);class XL extends gm{constructor(){super(...arguments),s(this,"info",{}),s(this,"initialSelectedShapeIds",[]),s(this,"excludedShapeIds",new Set),s(this,"isWrapMode",!1),s(this,"initialStartShape",null)}onEnter(e){const{altKey:t,currentPagePoint:n}=this.editor.inputs;this.isWrapMode=this.editor.user.getIsWrapMode(),t?this.parent.transition("scribble_brushing",e):(this.excludedShapeIds=new Set(this.editor.getCurrentPageShapes().filter((e=>this.editor.isShapeOfType(e,"group")||this.editor.isShapeOrAncestorLocked(e))).map((e=>e.id))),this.info=e,this.initialSelectedShapeIds=this.editor.getSelectedShapeIds().slice(),this.initialStartShape=this.editor.getShapesAtPoint(n)[0],this.hitTestShapes())}onExit(){this.initialSelectedShapeIds=[],this.editor.updateInstanceState({brush:null})}onTick(e){let{elapsed:t}=e;const{editor:n}=this;n.edgeScrollManager.updateEdgeScrolling(t)}onPointerMove(){this.hitTestShapes()}onPointerUp(){this.complete()}onComplete(){this.complete()}onCancel(e){this.editor.setSelectedShapes(this.initialSelectedShapeIds),this.parent.transition("idle",e)}onKeyDown(e){this.editor.inputs.altKey?this.parent.transition("scribble_brushing",e):this.hitTestShapes()}onKeyUp(){this.hitTestShapes()}complete(){this.hitTestShapes(),this.parent.transition("idle")}hitTestShapes(){const{editor:e,excludedShapeIds:t,isWrapMode:n}=this,{inputs:{originPagePoint:o,currentPagePoint:r,shiftKey:i,ctrlKey:s}}=e,a=new Set(i?this.initialSelectedShapeIds:[]),c=n?!s:s,d=rc.FromPoints([o,r]),{corners:u}=d;let h,p,f,g,m,y;const v=e.getCurrentPageRenderingShapesSorted(),b=e.getCurrentPageId();e:for(let l=0,S=v.length;l<S;l++)if(f=v[l],!t.has(f.id)&&!a.has(f.id)&&(g=e.getShapePageBounds(f),g))if(d.contains(g))this.handleHit(f,r,b,a,u);else if(!c&&!e.isShapeOfType(f,"frame")&&d.collides(g)){if(m=e.getShapePageTransform(f),!m)continue e;y=m.clone().invert().applyToPoints(u);const t=e.getShapeGeometry(f);t:for(let e=0;e<4;e++)if(h=y[e],p=y[(e+1)%4],t.hitTestLineSegment(h,p,0)){this.handleHit(f,r,b,a,u);break t}}const w=e.getInstanceState().brush;w&&d.equals(w)||e.updateInstanceState({brush:l({},d.toJson())});const x=e.getSelectedShapeIds();(x.length!==a.size||x.some((e=>!a.has(e))))&&e.setSelectedShapes(Array.from(a))}onInterrupt(){this.editor.updateInstanceState({brush:null})}handleHit(e,t,n,o,r){if(e.parentId===n)return void o.add(e.id);const i=this.editor.getOutermostSelectableShape(e),s=this.editor.getShapeMask(i.id);(!s||hu(s,r)||fa(t,s))&&o.add(i.id)}}s(XL,"id","brushing");const $L={bottom:"ns-resize",top:"ns-resize",left:"ew-resize",right:"ew-resize",bottom_left:"nesw-resize",bottom_right:"nwse-resize",top_left:"nwse-resize",top_right:"nesw-resize",bottom_left_rotate:"swne-rotate",bottom_right_rotate:"senw-rotate",top_left_rotate:"nwse-rotate",top_right_rotate:"nesw-rotate",mobile_rotate:"grabbing"};class ZL extends gm{constructor(){super(...arguments),s(this,"info",{})}updateCursor(){const e=this.editor.getSelectedShapes(),t=$L[this.info.handle];this.editor.setCursor({type:t,rotation:1===e.length?this.editor.getSelectionRotation():0})}onEnter(e){this.info=e,this.updateCursor()}onPointerMove(){this.editor.inputs.isDragging&&this.startResizing()}onLongPress(){this.startResizing()}startResizing(){this.editor.getIsReadonly()||this.parent.transition("resizing",this.info)}onPointerUp(){this.complete()}onCancel(){this.cancel()}onComplete(){this.cancel()}onInterrupt(){this.cancel()}complete(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}cancel(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}}s(ZL,"id","pointing_resize_handle");class QL extends gm{constructor(){super(...arguments),s(this,"info",{}),s(this,"markId",""),s(this,"snapshot",{})}onEnter(e){this.info=e,this.markId=this.editor.markHistoryStoppingPoint("cropping"),this.snapshot=this.createSnapshot(),this.updateShapes()}onPointerMove(){this.updateShapes()}onPointerUp(){this.complete()}onComplete(){this.complete()}onCancel(){this.cancel()}updateCursor(){if(!this.editor.getSelectedShapes()[0])return;const e=$L[this.info.handle];this.editor.setCursor({type:e,rotation:this.editor.getSelectionRotation()})}getDefaultCrop(){return{topLeft:{x:0,y:0},bottomRight:{x:1,y:1}}}updateShapes(){var e;const{shape:t,cursorHandleOffset:n}=this.snapshot;if(!t)return;if(!this.editor.getShapeUtil("image"))return;const o=t.props,r=this.editor.inputs.currentPagePoint.clone().sub(n),i=this.editor.inputs.originPagePoint.clone().sub(n),s=r.clone().sub(i).rot(-t.rotation),a=null!==(e=o.crop)&&void 0!==e?e:this.getDefaultCrop(),l=bt(a),c=new Vs(t.x,t.y),d=new Vs(0,0),u=1/(a.bottomRight.x-a.topLeft.x)*o.w,h=1/(a.bottomRight.y-a.topLeft.y)*o.h;let p=!1;switch(this.info.handle){case"top":case"top_left":case"top_right":if(h<8)break;p=!0,l.topLeft.y=l.topLeft.y+s.y/h;h*(l.bottomRight.y-l.topLeft.y)<8?(l.topLeft.y=l.bottomRight.y-8/h,d.y=(l.topLeft.y-a.topLeft.y)*h):l.topLeft.y<=0?(l.topLeft.y=0,d.y=(l.topLeft.y-a.topLeft.y)*h):d.y=s.y;break;case"bottom":case"bottom_left":case"bottom_right":if(h<8)break;p=!0,l.bottomRight.y=Math.min(1,l.bottomRight.y+s.y/h);h*(l.bottomRight.y-l.topLeft.y)<8&&(l.bottomRight.y=l.topLeft.y+8/h);break}switch(this.info.handle){case"left":case"top_left":case"bottom_left":if(u<8)break;p=!0,l.topLeft.x=l.topLeft.x+s.x/u;u*(l.bottomRight.x-l.topLeft.x)<8?(l.topLeft.x=l.bottomRight.x-8/u,d.x=(l.topLeft.x-a.topLeft.x)*u):l.topLeft.x<=0?(l.topLeft.x=0,d.x=(l.topLeft.x-a.topLeft.x)*u):d.x=s.x;break;case"right":case"top_right":case"bottom_right":if(u<8)break;p=!0,l.bottomRight.x=Math.min(1,l.bottomRight.x+s.x/u);u*(l.bottomRight.x-l.topLeft.x)<8&&(l.bottomRight.x=l.topLeft.x+8/u);break}if(!p)return;c.add(d.rot(t.rotation));const f={id:t.id,type:t.type,x:c.x,y:c.y,props:{crop:l,w:(l.bottomRight.x-l.topLeft.x)*u,h:(l.bottomRight.y-l.topLeft.y)*h}};this.editor.updateShapes([f]),this.updateCursor()}complete(){this.updateShapes(),WI(this.editor,[this.snapshot.shape.id]),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):(this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle"))}cancel(){this.editor.bailToMark(this.markId),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):(this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle"))}createSnapshot(){const e=this.editor.getSelectionRotation(),{inputs:{originPagePoint:t}}=this.editor,n=this.editor.getOnlySelectedShape(),o=this.editor.getSelectionRotatedPageBounds(),r=Vs.RotWith(o.getHandlePoint(this.info.handle),o.point,e);return{shape:n,cursorHandleOffset:Vs.Sub(t,r)}}}function JL(e){var t;let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const o=e.getZoomLevel(),{inputs:{currentPagePoint:r}}=e;return null!==(t=e.getShapeAtPoint(r,{hitInside:!1,hitLabels:n,margin:e.options.hitTestMargin/o,renderingOnly:!0}))&&void 0!==t?t:e.getSelectedShapeAtPoint(r)}function ez(e,t,n){if(!t)throw Error("Needs to translate a cropped shape!");const{crop:o}=t.props;if(!o)return;const r=e.inputs.shiftKey?Math.abs(n.x)<Math.abs(n.y)?"x":"y":null;"x"===r?n.x=0:"y"===r&&(n.y=0),n.rot(-t.rotation);const i=1/(o.bottomRight.x-o.topLeft.x)*t.props.w,s=1/(o.bottomRight.y-o.topLeft.y)*t.props.h,a=o.bottomRight.y-o.topLeft.y,l=o.bottomRight.x-o.topLeft.x,c=bt(o);c.topLeft.x=Math.min(1-l,Math.max(0,c.topLeft.x-n.x/i)),c.topLeft.y=Math.min(1-a,Math.max(0,c.topLeft.y-n.y/s)),c.bottomRight.x=c.topLeft.x+l,c.bottomRight.y=c.topLeft.y+a;return{id:t.id,type:t.type,props:{crop:c}}}s(QL,"id","cropping");class tz extends gm{onEnter(){this.editor.setCursor({type:"default",rotation:0});const e=this.editor.getOnlySelectedShape();e&&this.editor.setCroppingShape(e.id)}onExit(){this.editor.setCursor({type:"default",rotation:0})}onCancel(){this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle",{})}onPointerDown(e){if(e.accelKey)return this.cancel(),void this.editor.root.handleEvent(e);switch(e.target){case"canvas":{const t=JL(this.editor);if(t&&!this.editor.isShapeOfType(t,"group"))return void this.onPointerDown(l(l({},e),{},{shape:t,target:"shape"}));this.cancel(),this.editor.root.handleEvent(e);break}case"shape":if(e.shape.id===this.editor.getCroppingShapeId())return void this.editor.setCurrentTool("select.crop.pointing_crop",e);var t;null!==(t=this.editor.getShapeUtil(e.shape))&&void 0!==t&&t.canCrop(e.shape)?(this.editor.setCroppingShape(e.shape.id),this.editor.setSelectedShapes([e.shape.id]),this.editor.setCurrentTool("select.crop.pointing_crop",e)):(this.cancel(),this.editor.root.handleEvent(e));break;case"selection":switch(e.handle){case"mobile_rotate":case"top_left_rotate":case"top_right_rotate":case"bottom_left_rotate":case"bottom_right_rotate":this.editor.setCurrentTool("select.pointing_rotate_handle",l(l({},e),{},{onInteractionEnd:"select.crop.idle"}));break;case"top":case"right":case"bottom":case"left":case"top_left":case"top_right":case"bottom_left":case"bottom_right":this.editor.setCurrentTool("select.crop.pointing_crop_handle",l(l({},e),{},{onInteractionEnd:"select.crop.idle"}));break;default:this.cancel()}}}onDoubleClick(e){if(this.editor.inputs.shiftKey||"up"!==e.phase)return;const t=this.editor.getCroppingShapeId();if(!t)return;const n=this.editor.getShape(t);if(!n)return;const o=this.editor.getShapeUtil(n);var r;o&&("selection"!==e.target?(this.cancel(),this.editor.root.handleEvent(e)):null===(r=o.onDoubleClickEdge)||void 0===r||r.call(o,n))}onKeyDown(){this.nudgeCroppingImage(!1)}onKeyRepeat(){this.nudgeCroppingImage(!0)}onKeyUp(e){if("Enter"===e.code)this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle",{})}cancel(){this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle",{})}nudgeCroppingImage(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const{editor:{inputs:{keys:t}}}=this,n=t.has("ShiftLeft"),o=new Vs(0,0);if(t.has("ArrowLeft")&&(o.x+=1),t.has("ArrowRight")&&(o.x-=1),t.has("ArrowUp")&&(o.y+=1),t.has("ArrowDown")&&(o.y-=1),o.equals(new Vs(0,0)))return;n&&o.mul(10);const r=this.editor.getShape(this.editor.getCroppingShapeId());if(!r)return;const i=ez(this.editor,r,o);i&&(e||this.editor.markHistoryStoppingPoint("translate crop"),this.editor.updateShapes([i]))}}s(tz,"id","idle");class nz extends gm{onCancel(){this.editor.setCurrentTool("select.crop.idle",{})}onPointerMove(e){this.editor.inputs.isDragging&&this.editor.setCurrentTool("select.crop.translating_crop",e)}onPointerUp(e){this.editor.setCurrentTool("select.crop.idle",e)}}s(nz,"id","pointing_crop");class oz extends gm{constructor(){super(...arguments),s(this,"info",{})}onEnter(e){this.info=e,this.parent.setCurrentToolIdMask(e.onInteractionEnd);const t=this.editor.getSelectedShapes()[0];if(!t)return;const n=$L[this.info.handle];this.editor.setCursor({type:n,rotation:this.editor.getSelectionRotation()}),this.editor.setCroppingShape(t.id)}onExit(){this.editor.setCursor({type:"default",rotation:0}),this.parent.setCurrentToolIdMask(void 0)}onPointerMove(){this.editor.inputs.isDragging&&this.startCropping()}onLongPress(){this.startCropping()}startCropping(){this.editor.getIsReadonly()||this.parent.transition("cropping",l(l({},this.info),{},{onInteractionEnd:this.info.onInteractionEnd}))}onPointerUp(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):(this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle"))}onCancel(){this.cancel()}onComplete(){this.cancel()}onInterrupt(){this.cancel()}cancel(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):(this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle"))}}s(oz,"id","pointing_crop_handle");class rz extends gm{constructor(){super(...arguments),s(this,"info",{}),s(this,"markId",""),s(this,"snapshot",{})}onEnter(e){this.info=e,this.snapshot=this.createSnapshot(),this.markId=this.editor.markHistoryStoppingPoint("translating_crop"),this.editor.setCursor({type:"move",rotation:0}),this.updateShapes()}onExit(){this.editor.setCursor({type:"default",rotation:0})}onPointerMove(){this.updateShapes()}onPointerUp(){this.complete()}onComplete(){this.complete()}onCancel(){this.cancel()}onKeyDown(e){switch(e.key){case"Alt":case"Shift":return void this.updateShapes()}}onKeyUp(e){switch(e.key){case"Enter":return void this.complete();case"Alt":case"Shift":this.updateShapes()}}complete(){this.updateShapes(),this.editor.setCurrentTool("select.crop.idle",this.info)}cancel(){this.editor.bailToMark(this.markId),this.editor.setCurrentTool("select.crop.idle",this.info)}createSnapshot(){return{shape:this.editor.getOnlySelectedShape()}}updateShapes(){const e=this.snapshot.shape;if(!e)return;const{originPagePoint:t,currentPagePoint:n}=this.editor.inputs,o=n.clone().sub(t),r=ez(this.editor,e,o);r&&this.editor.updateShapes([r])}}s(rz,"id","translating_crop");class iz extends gm{constructor(){super(...arguments),s(this,"markId",""),s(this,"didExit",!1)}static children(){return[tz,rz,nz,oz,QL]}onEnter(){this.didExit=!1,this.markId=this.editor.markHistoryStoppingPoint("crop")}onExit(){this.didExit||(this.didExit=!0,this.editor.squashToMark(this.markId))}onCancel(){this.didExit||(this.didExit=!0,this.editor.bailToMark(this.markId))}}s(iz,"id","crop"),s(iz,"initial","idle");class sz extends gm{constructor(){super(...arguments),s(this,"shapeId",""),s(this,"initialHandle",{}),s(this,"initialAdjacentHandle",null),s(this,"initialPagePoint",{}),s(this,"markId",""),s(this,"initialPageTransform",void 0),s(this,"initialPageRotation",void 0),s(this,"info",{}),s(this,"isPrecise",!1),s(this,"isPreciseId",null),s(this,"pointingId",null),s(this,"exactTimeout",-1)}onEnter(e){const{shape:t,isCreating:n,creatingMarkId:o,handle:r}=e;if(this.info=e,this.parent.setCurrentToolIdMask(e.onInteractionEnd),this.shapeId=t.id,this.markId="",n)if(o)this.markId=o;else{const e=this.editor.getMarkIdMatching("creating:".concat(this.editor.getOnlySelectedShapeId()));e&&(this.markId=e)}else this.markId=this.editor.markHistoryStoppingPoint("dragging handle");if(this.initialHandle=bt(r),this.editor.isShapeOfType(t,"line")&&"create"===this.initialHandle.type){this.editor.updateShape(l(l({},t),{},{props:{points:l(l({},t.props.points),{},{[r.index]:{id:r.index,index:r.index,x:r.x,y:r.y}})}}));const e=this.editor.getShapeHandles(t).find((e=>e.index===r.index));this.initialHandle=bt(e)}this.initialPageTransform=this.editor.getShapePageTransform(t),this.initialPageRotation=this.initialPageTransform.rotation(),this.initialPagePoint=this.editor.inputs.originPagePoint.clone(),this.editor.setCursor({type:n?"cross":"grabbing",rotation:0});const i=this.editor.getShapeHandles(t).sort(Je),s=i.findIndex((t=>t.id===e.handle.id));this.initialAdjacentHandle=null;for(let a=s+1;a<i.length;a++){const t=i[a];if("vertex"===t.type&&"middle"!==t.id&&t.id!==e.handle.id){this.initialAdjacentHandle=t;break}}if(!this.initialAdjacentHandle)for(let a=i.length-1;a>=0;a--){const t=i[a];if("vertex"===t.type&&"middle"!==t.id&&t.id!==e.handle.id){this.initialAdjacentHandle=t;break}}if(this.editor.isShapeOfType(t,"arrow")){const n=oO(this.editor,t)[e.handle.id];this.isPrecise=!1,n?(this.editor.setHintingShapes([n.toId]),this.isPrecise=n.props.isPrecise,this.isPrecise?this.isPreciseId=n.toId:this.resetExactTimeout()):this.editor.setHintingShapes([])}this.update(),this.editor.select(this.shapeId)}resetExactTimeout(){-1!==this.exactTimeout&&this.clearExactTimeout(),this.exactTimeout=this.editor.timers.setTimeout((()=>{this.getIsActive()&&!this.isPrecise&&(this.isPrecise=!0,this.isPreciseId=this.pointingId,this.update()),this.exactTimeout=-1}),750)}clearExactTimeout(){-1!==this.exactTimeout&&(clearTimeout(this.exactTimeout),this.exactTimeout=-1)}onPointerMove(){this.update()}onKeyDown(){this.update()}onKeyUp(){this.update()}onPointerUp(){this.complete()}onComplete(){this.update(),this.complete()}onCancel(){this.cancel()}onExit(){this.parent.setCurrentToolIdMask(void 0),this.editor.setHintingShapes([]),this.editor.snaps.clearIndicators(),this.editor.setCursor({type:"default",rotation:0})}complete(){this.editor.snaps.clearIndicators(),WI(this.editor,[this.shapeId]);const{onInteractionEnd:e}=this.info;this.editor.getInstanceState().isToolLocked&&e?this.editor.setCurrentTool(e,{shapeId:this.shapeId}):this.parent.transition("idle")}cancel(){this.editor.bailToMark(this.markId),this.editor.snaps.clearIndicators();const{onInteractionEnd:e}=this.info;e?this.editor.setCurrentTool(e,{shapeId:this.shapeId}):this.parent.transition("idle")}update(){var e;const{editor:t,shapeId:n,initialPagePoint:o}=this,{initialHandle:r,initialPageRotation:i,initialAdjacentHandle:s}=this,a=this.editor.getHintingShapeIds(),c=this.editor.user.getIsSnapMode(),{snaps:d,inputs:{currentPagePoint:u,shiftKey:h,ctrlKey:p,altKey:f,pointerVelocity:g}}=t,m=this.info.shape,y=t.getShape(n);if(!y)return;const v=t.getShapeUtil(y);let b=u.clone().sub(o).rot(-i).add(r);if(h&&s&&"middle"!==r.id){const e=Vs.Angle(s,b),t=aa(e,24)-e;b=Vs.RotWith(b,s,t)}t.snaps.clearIndicators();let w=l(l({},r),{},{x:b.x,y:b.y});if(r.canSnap&&(c?!p:p)){if(!t.getShapePageTransform(y.id))throw Error("Expected a page transform");const e=d.handles.snapHandle({currentShapeId:n,handle:w});e&&(e.nudge.rot(-t.getShapeParentTransform(y).rotation()),b.add(e.nudge),w=l(l({},r),{},{x:b.x,y:b.y}))}const x=null===(e=v.onHandleDrag)||void 0===e?void 0:e.call(v,y,{handle:w,isPrecise:this.isPrecise||f,initial:m}),S=l({id:y.id,type:y.type},x);if("vertex"===r.type&&this.editor.isShapeOfType(y,"arrow")){const e=oO(t,y)[r.id];e?a[0]!==e.toId&&(t.setHintingShapes([e.toId]),this.pointingId=e.toId,this.isPrecise=g.len()<.5||f,this.isPreciseId=this.isPrecise?e.toId:null,this.resetExactTimeout()):a.length>0&&(t.setHintingShapes([]),this.pointingId=null,this.isPrecise=!1,this.isPreciseId=null,this.resetExactTimeout())}x&&t.updateShapes([S])}}function az(e){return e.isLabel?[e]:e instanceof ac?e.children.filter((e=>e.isLabel)):[]}s(sz,"id","dragging_handle");class lz extends gm{constructor(){super(...arguments),s(this,"hitShapeForPointerUp",null),s(this,"info",{})}onEnter(e){const t=this.editor.getEditingShape();if(!t)throw Error("Entered editing state without an editing shape");this.hitShapeForPointerUp=null,this.info=e,e.isCreatingTextWhileToolLocked&&this.parent.setCurrentToolIdMask("text"),lD(this.editor),this.editor.select(t)}onExit(){var e;const{editingShapeId:t}=this.editor.getCurrentPageState();if(!t)return;this.editor.setEditingShape(null),lD.cancel();const n=this.editor.getShape(t),o=this.editor.getShapeUtil(n);null===(e=o.onEditEnd)||void 0===e||e.call(o,n),this.info.isCreatingTextWhileToolLocked&&(this.parent.setCurrentToolIdMask(void 0),this.editor.setCurrentTool("text",{}))}onPointerMove(e){if(this.hitShapeForPointerUp&&this.editor.inputs.isDragging){if(this.editor.getIsReadonly())return;if(this.hitShapeForPointerUp.isLocked)return;return this.editor.select(this.hitShapeForPointerUp),this.parent.transition("translating",e),void(this.hitShapeForPointerUp=null)}switch(e.target){case"shape":case"canvas":return void lD(this.editor)}}onPointerDown(e){switch(this.hitShapeForPointerUp=null,e.target){case"shape":{const{shape:t}=e,n=this.editor.getEditingShape();if(!n)throw Error("Expected an editing shape!");const o=az(this.editor.getShapeUtil(t).getGeometry(t)),r=1===o.length?o[0]:void 0,i=this.editor.isShapeOfType(n,"text")&&""===n.props.text.trim();if(!r||i)return t.id!==n.id?void this.parent.transition("pointing_shape",e):void(this.editor.isShapeOfType(t,"frame")&&(this.editor.setEditingShape(null),this.parent.transition("idle",e)));{const e=this.editor.getPointInShapeSpace(t,this.editor.inputs.currentPagePoint);if(r.bounds.containsPoint(e,0)&&r.hitTestPoint(e))return t.id===n.id?void 0:(this.hitShapeForPointerUp=t,this.editor.markHistoryStoppingPoint("editing on pointer up"),void this.editor.select(t.id))}break}}this.parent.transition("idle",e),this.editor.root.handleEvent(e)}onPointerUp(e){const t=this.hitShapeForPointerUp;if(!t)return;this.hitShapeForPointerUp=null;const n=this.editor.getShapeUtil(t);t.isLocked||(!this.editor.getIsReadonly()||n.canEditInReadOnly(t)?(this.editor.select(t.id),this.editor.setEditingShape(t.id),lD(this.editor)):this.parent.transition("pointing_shape",e))}onComplete(e){this.parent.transition("idle",e)}onCancel(e){this.parent.transition("idle",e)}}function cz(e){const t=e.getOnlySelectedShape();return!(!t||e.isShapeOrAncestorLocked(t)||!e.getShapeUtil(t).canCrop(t))}function dz(e,t){const n=e.getSelectedShapeIds(),{currentPagePoint:o}=e.inputs,{shiftKey:r,altKey:i,accelKey:s}=t,a=r||s,l=e.getShapeAtPoint(o,{hitInside:!1,margin:e.options.hitTestMargin/e.getZoomLevel(),hitLabels:!0,renderingOnly:!0,filter:e=>!e.isLocked});if(l){const t=e.getOutermostSelectableShape(l);if(a&&!i)e.cancelDoubleClick(),n.includes(t.id)?(e.markHistoryStoppingPoint("deselecting shape"),e.deselect(t)):(e.markHistoryStoppingPoint("shift selecting shape"),e.setSelectedShapes([...n,t.id]));else{let o;o=t===l||t.id===e.getFocusedGroupId()||n.includes(t.id)?l:t,o&&!n.includes(o.id)&&(e.markHistoryStoppingPoint("selecting shape"),e.select(o.id))}}else{if(a)return;{n.length>0&&(e.markHistoryStoppingPoint("selecting none"),e.selectNone());const t=e.getFocusedGroupId();if(Ho(t)){const n=e.getShape(t);e.isPointInShape(n,o,{margin:0,hitInside:!0})||e.setFocusedGroup(null)}}}}s(lz,"id","editing_shape");const uz=["Delete","Backspace","[","]","Enter"," ","Shift","Tab"];class hz extends gm{onEnter(){this.parent.setCurrentToolIdMask(void 0),lD(this.editor),this.editor.setCursor({type:"default",rotation:0})}onExit(){lD.cancel()}onPointerMove(){lD(this.editor)}onPointerDown(e){const t=e.ctrlKey&&cz(this.editor);switch(e.target){case"canvas":{const t=JL(this.editor);if(t&&!t.isLocked)return void this.onPointerDown(l(l({},e),{},{shape:t,target:"shape"}));const n=this.editor.getSelectedShapeIds(),o=this.editor.getOnlySelectedShape(),{inputs:{currentPagePoint:r}}=this.editor;if((n.length>1||o&&!this.editor.getShapeUtil(o).hideSelectionBoundsBg(o))&&mz(this.editor,r))return void this.onPointerDown(l(l({},e),{},{target:"selection"}));this.parent.transition("pointing_canvas",e);break}case"shape":{const{shape:t}=e;if(this.isOverArrowLabelTest(t)){this.parent.transition("pointing_arrow_label",e);break}if(this.editor.isShapeOrAncestorLocked(t)){this.parent.transition("pointing_canvas",e);break}this.parent.transition("pointing_shape",e);break}case"handle":if(this.editor.getIsReadonly())break;this.editor.inputs.altKey?this.parent.transition("pointing_shape",e):this.parent.transition("pointing_handle",e);break;case"selection":switch(e.handle){case"mobile_rotate":case"top_left_rotate":case"top_right_rotate":case"bottom_left_rotate":case"bottom_right_rotate":if(e.accelKey){this.parent.transition("brushing",e);break}this.parent.transition("pointing_rotate_handle",e);break;case"top":case"right":case"bottom":case"left":case"top_left":case"top_right":case"bottom_left":case"bottom_right":if(t)this.parent.transition("crop.pointing_crop_handle",e);else{if(e.accelKey){this.parent.transition("brushing",e);break}this.parent.transition("pointing_resize_handle",e)}break;default:{const t=this.editor.getHoveredShape();if(t&&!this.editor.getSelectedShapeIds().includes(t.id)&&!t.isLocked)return void this.onPointerDown(l(l({},e),{},{shape:t,target:"shape"}));this.parent.transition("pointing_selection",e)}}}}onDoubleClick(e){if(!this.editor.inputs.shiftKey&&"up"===e.phase&&!e.ctrlKey&&!e.shiftKey)switch(e.target){case"canvas":{var t;const n=this.editor.getHoveredShape(),o=n&&!this.editor.isShapeOfType(n,"group")?n:null!==(t=this.editor.getSelectedShapeAtPoint(this.editor.inputs.currentPagePoint))&&void 0!==t?t:this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint,{margin:this.editor.options.hitTestMargin/this.editor.getZoomLevel(),hitInside:!1}),r=this.editor.getFocusedGroupId();if(o){if(this.editor.isShapeOfType(o,"group"))return void dz(this.editor,e);{const t=this.editor.getShape(o.parentId);if(t&&this.editor.isShapeOfType(t,"group")&&(!r||t.id!==r))return void dz(this.editor,e)}return void this.onDoubleClick(l(l({},e),{},{shape:o,target:"shape"}))}this.editor.inputs.shiftKey||this.handleDoubleClickOnCanvas(e);break}case"selection":{if(this.editor.getIsReadonly())break;const t=this.editor.getOnlySelectedShape();if(t){const o=this.editor.getShapeUtil(t);if(!this.canInteractWithShapeInReadOnly(t))return;if("right"===e.handle||"left"===e.handle||"top"===e.handle||"bottom"===e.handle){var n;const e=null===(n=o.onDoubleClickEdge)||void 0===n?void 0:n.call(o,t);if(e)return this.editor.markHistoryStoppingPoint("double click edge"),this.editor.updateShapes([e]),void WI(this.editor,[t.id])}if(o.canCrop(t)&&!this.editor.isShapeOrAncestorLocked(t))return void this.parent.transition("crop",e);this.shouldStartEditingShape(t)&&this.startEditingShape(t,e,!0)}break}case"shape":{const{shape:t}=e,n=this.editor.getShapeUtil(t);if("video"!==t.type&&"embed"!==t.type&&this.editor.getIsReadonly())break;if(n.onDoubleClick){var o;const e=null===(o=n.onDoubleClick)||void 0===o?void 0:o.call(n,t);if(e)return void this.editor.updateShapes([e])}var r;if(n.canCrop(t)&&!this.editor.isShapeOrAncestorLocked(t))return this.editor.markHistoryStoppingPoint("select and crop"),this.editor.select(null===(r=e.shape)||void 0===r?void 0:r.id),void this.parent.transition("crop",e);this.shouldStartEditingShape(t)?this.startEditingShape(t,e,!0):this.handleDoubleClickOnCanvas(e);break}case"handle":{var i;if(this.editor.getIsReadonly())break;const{shape:t,handle:n}=e,o=this.editor.getShapeUtil(t),r=null===(i=o.onDoubleClickHandle)||void 0===i?void 0:i.call(o,t,n);r?this.editor.updateShapes([r]):this.shouldStartEditingShape(t)&&this.startEditingShape(t,e,!0)}}}onRightClick(e){switch(e.target){case"canvas":{const t=this.editor.getHoveredShape(),n=t&&!this.editor.isShapeOfType(t,"group")?t:this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint,{margin:this.editor.options.hitTestMargin/this.editor.getZoomLevel(),hitInside:!1,hitLabels:!0,hitLocked:!0,hitFrameInside:!0,renderingOnly:!0});if(n)return void this.onRightClick(l(l({},e),{},{shape:n,target:"shape"}));const o=this.editor.getSelectedShapeIds(),r=this.editor.getOnlySelectedShape(),{inputs:{currentPagePoint:i}}=this.editor;if((o.length>1||r&&!this.editor.getShapeUtil(r).hideSelectionBoundsBg(r))&&mz(this.editor,i))return void this.onRightClick(l(l({},e),{},{target:"selection"}));this.editor.selectNone();break}case"shape":{const{selectedShapeIds:t}=this.editor.getCurrentPageState(),{shape:n}=e,o=this.editor.getOutermostSelectableShape(n,(e=>!t.includes(e.id)));t.includes(o.id)||this.editor.findShapeAncestor(o,(e=>t.includes(e.id)))||(this.editor.markHistoryStoppingPoint("selecting shape"),this.editor.setSelectedShapes([o.id]));break}}}onCancel(){this.editor.getFocusedGroupId()!==this.editor.getCurrentPageId()&&this.editor.getSelectedShapeIds().length>0?this.editor.popFocusedGroupId():(this.editor.markHistoryStoppingPoint("clearing selection"),this.editor.selectNone())}onKeyDown(e){switch(e.code){case"ArrowLeft":case"ArrowRight":case"ArrowUp":case"ArrowDown":return void this.nudgeSelectedShapes(!1)}if(Ta.editOnType.get()&&!uz.includes(e.key)&&!e.altKey&&!e.ctrlKey){const t=this.editor.getOnlySelectedShape();if(t&&this.editor.isShapeOfType(t,"note")&&this.shouldStartEditingShape(t))return void this.startEditingShape(t,l(l({},e),{},{target:"shape",shape:t}),!0)}}onKeyRepeat(e){switch(e.code){case"ArrowLeft":case"ArrowRight":case"ArrowUp":case"ArrowDown":this.nudgeSelectedShapes(!0)}}onKeyUp(e){switch(e.code){case"Enter":{const t=this.editor.getSelectedShapes();if(t.every((e=>this.editor.isShapeOfType(e,"group"))))return void this.editor.setSelectedShapes(t.flatMap((e=>this.editor.getSortedChildIdsForParent(e.id))));const n=this.editor.getOnlySelectedShape();if(n&&this.shouldStartEditingShape(n))return void this.startEditingShape(n,l(l({},e),{},{target:"shape",shape:n}),!0);cz(this.editor)&&this.parent.transition("crop",e);break}}}shouldStartEditingShape(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.editor.getOnlySelectedShape();return!!e&&((!this.editor.isShapeOrAncestorLocked(e)||"embed"===e.type)&&(!!this.canInteractWithShapeInReadOnly(e)&&this.editor.getShapeUtil(e).canEdit(e)))}startEditingShape(e,t,n){this.editor.isShapeOrAncestorLocked(e)&&"embed"!==e.type||(this.editor.markHistoryStoppingPoint("editing shape"),YI(this.editor,e,n),this.parent.transition("editing_shape",t))}isOverArrowLabelTest(e){if(!e)return!1;const t=this.editor.getPointInShapeSpace(e,this.editor.inputs.currentPagePoint);if(this.editor.isShapeOfType(e,"arrow")){const n=this.editor.getShapeGeometry(e).children[1];if(n&&fa(t,n.vertices))return!0}return!1}handleDoubleClickOnCanvas(e){if(this.editor.getIsReadonly())return;if(!this.editor.options.createTextOnCanvasDoubleClick)return;this.editor.markHistoryStoppingPoint("creating text shape");const t=Ko(),{x:n,y:o}=this.editor.inputs.currentPagePoint;this.editor.createShapes([{id:t,type:"text",x:n,y:o,props:{text:"",autoSize:!0}}]);const r=this.editor.getShape(t);if(!r)return;const i=this.editor.getShapeUtil(r);this.editor.getIsReadonly()&&!i.canEditInReadOnly(r)||(this.editor.setEditingShape(t),this.editor.select(t),this.parent.transition("editing_shape",e))}nudgeSelectedShapes(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const{editor:{inputs:{keys:t}}}=this,n=t.has("ShiftLeft"),o=new Vs(0,0);if(t.has("ArrowLeft")&&(o.x-=1),t.has("ArrowRight")&&(o.x+=1),t.has("ArrowUp")&&(o.y-=1),t.has("ArrowDown")&&(o.y+=1),o.equals(new Vs(0,0)))return;e||this.editor.markHistoryStoppingPoint("nudge shapes");const{gridSize:r}=this.editor.getDocumentSettings(),i=this.editor.getInstanceState().isGridMode?n?r*gz:r:n?pz:fz,s=this.editor.getSelectedShapeIds();this.editor.nudgeShapes(s,o.mul(i)),WI(this.editor,s)}canInteractWithShapeInReadOnly(e){if(!this.editor.getIsReadonly())return!0;return!!this.editor.getShapeUtil(e).canEditInReadOnly(e)}}s(hz,"id","idle");const pz=10,fz=1,gz=5;function mz(e,t){const n=e.getSelectionRotatedPageBounds();if(!n)return!1;const o=e.getSelectionRotation();return o?fa(t,n.corners.map((e=>Vs.RotWith(e,n.point,o)))):n.containsPoint(t)}class yz extends gm{constructor(){super(...arguments),s(this,"shapeId",""),s(this,"markId",""),s(this,"wasAlreadySelected",!1),s(this,"didDrag",!1),s(this,"didCtrlOnEnter",!1),s(this,"info",{}),s(this,"_labelDragOffset",new Vs(0,0))}updateCursor(){this.editor.setCursor({type:"grabbing",rotation:0})}onEnter(e){const{shape:t}=e;this.parent.setCurrentToolIdMask(e.onInteractionEnd),this.info=e,this.shapeId=t.id,this.didDrag=!1,this.didCtrlOnEnter=e.accelKey,this.wasAlreadySelected=this.editor.getOnlySelectedShapeId()===t.id,this.updateCursor();const n=this.editor.getShapeGeometry(t).children[1];if(!n)throw Error("Expected to find an arrow label geometry for shape: ".concat(t.id));const{currentPagePoint:o}=this.editor.inputs,r=this.editor.getPointInShapeSpace(t,o);this._labelDragOffset=Vs.Sub(n.center,r),this.markId=this.editor.markHistoryStoppingPoint("label-drag start"),this.editor.setSelectedShapes([this.shapeId])}onExit(){this.parent.setCurrentToolIdMask(void 0),this.editor.setCursor({type:"default",rotation:0})}onPointerMove(){const{isDragging:e}=this.editor.inputs;if(!e)return;if(this.didCtrlOnEnter)return void this.parent.transition("brushing",this.info);const t=this.editor.getShape(this.shapeId);if(!t)return;const n=iO(this.editor,t),o=this.editor.getShapeGeometry(t),r=o.children[0],i=this.editor.getPointInShapeSpace(t,this.editor.inputs.currentPagePoint),s=r.nearestPoint(Vs.Add(i,this._labelDragOffset));let a;if(n.isStraight){const e=Vs.Dist(n.start.point,n.end.point);a=1-Vs.Dist(n.end.point,s)/e}else{const{_center:e,measure:t,angleEnd:n,angleStart:r}=o.children[0];a=ba(t,r,n,e.angle(s))}isNaN(a)&&(a=.5),this.didDrag=!0,this.editor.updateShape({id:t.id,type:t.type,props:{labelPosition:a}})}onPointerUp(){const e=this.editor.getShape(this.shapeId);e&&(this.didDrag||!this.wasAlreadySelected?this.complete():this.editor.getIsReadonly()||(this.editor.setEditingShape(e.id),this.editor.setCurrentTool("select.editing_shape")))}onCancel(){this.cancel()}onComplete(){this.cancel()}onInterrupt(){this.cancel()}complete(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}cancel(){this.editor.bailToMark(this.markId),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}}s(yz,"id","pointing_arrow_label");class vz extends gm{onEnter(e){e.shiftKey||e.accelKey||this.editor.getSelectedShapeIds().length>0&&(this.editor.markHistoryStoppingPoint("selecting none"),this.editor.selectNone())}onPointerMove(e){this.editor.inputs.isDragging&&this.parent.transition("brushing",e)}onPointerUp(e){dz(this.editor,e),this.complete()}onComplete(){this.complete()}onInterrupt(){this.parent.transition("idle")}complete(){this.parent.transition("idle")}}s(vz,"id","pointing_canvas");class bz extends gm{constructor(){super(...arguments),s(this,"didCtrlOnEnter",!1),s(this,"info",{})}onEnter(e){this.info=e,this.didCtrlOnEnter=e.accelKey;const{shape:t}=e;if(this.editor.isShapeOfType(t,"arrow")){const n=oO(this.editor,t)[e.handle.id];n&&this.editor.setHintingShapes([n.toId])}this.editor.setCursor({type:"grabbing",rotation:0})}onExit(){this.editor.setHintingShapes([]),this.editor.setCursor({type:"default",rotation:0})}onPointerUp(){const{shape:e,handle:t}=this.info;if(this.editor.isShapeOfType(e,"note")){const{editor:n}=this,o=wz(n,e,t,!1);if(o)return void YI(n,o,!0)}this.parent.transition("idle",this.info)}onPointerMove(e){const{editor:t}=this;t.inputs.isDragging&&(this.didCtrlOnEnter?this.parent.transition("brushing",e):this.startDraggingHandle())}onLongPress(){this.startDraggingHandle()}startDraggingHandle(){const{editor:e}=this;if(e.getIsReadonly())return;const{shape:t,handle:n}=this.info;if(e.isShapeOfType(t,"note")){const o=wz(e,t,n,!0);if(o){const n=e.getPointInParentSpace(o,e.inputs.originPagePoint).sub(Vs.Rot(eD.clone().mul(t.props.scale),o.rotation));return e.updateShape(l(l({},o),{},{x:n.x,y:n.y})),void e.setHoveredShape(o.id).select(o.id).setCurrentTool("select.translating",l(l({},this.info),{},{target:"shape",shape:e.getShape(o),onInteractionEnd:"note",isCreating:!0,onCreate:()=>{YI(e,o,!0)}}))}}this.parent.transition("dragging_handle",this.info)}onCancel(){this.cancel()}onComplete(){this.cancel()}onInterrupt(){this.cancel()}cancel(){this.parent.transition("idle")}}function wz(e,t,n,o){const r=e.getShapePageTransform(t.id),i=r.point(),s=r.rotation(),a=nD(e,i,s,t.props.growY,0,t.props.scale)[n.index];if(a)return rD(e,t,a,s,o)}s(bz,"id","pointing_handle");class xz extends gm{constructor(){super(...arguments),s(this,"info",{})}updateCursor(){this.editor.setCursor({type:$L[this.info.handle],rotation:this.editor.getSelectionRotation()})}onEnter(e){this.parent.setCurrentToolIdMask(e.onInteractionEnd),this.info=e,this.updateCursor()}onExit(){this.parent.setCurrentToolIdMask(void 0),this.editor.setCursor({type:"default",rotation:0})}onPointerMove(){this.editor.inputs.isDragging&&this.startRotating()}onLongPress(){this.startRotating()}startRotating(){this.editor.getIsReadonly()||this.parent.transition("rotating",this.info)}onPointerUp(){this.complete()}onCancel(){this.cancel()}onComplete(){this.cancel()}onInterrupt(){this.cancel()}complete(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}cancel(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}}s(xz,"id","pointing_rotate_handle");class Sz extends gm{constructor(){super(...arguments),s(this,"info",{})}onEnter(e){this.info=e}onPointerUp(e){dz(this.editor,e),this.parent.transition("idle",e)}onPointerMove(e){this.editor.inputs.isDragging&&this.startTranslating(e)}onLongPress(e){this.startTranslating(e)}startTranslating(e){this.editor.getIsReadonly()||this.parent.transition("translating",e)}onDoubleClick(e){const t=this.editor.getHoveredShape(),n=t&&!this.editor.isShapeOfType(t,"group")?t:this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint,{hitInside:!0,margin:0,renderingOnly:!0});var o,r;if(n)return this.parent.transition("idle"),void(null===(o=(r=this.parent).onDoubleClick)||void 0===o||o.call(r,l(l({},e),{},{target:"shape",shape:this.editor.getShape(n)})))}onCancel(){this.cancel()}onComplete(){this.cancel()}onInterrupt(){this.cancel()}cancel(){this.parent.transition("idle")}}s(Sz,"id","pointing_selection");class kz extends gm{constructor(){super(...arguments),s(this,"hitShape",{}),s(this,"hitShapeForPointerUp",{}),s(this,"isDoubleClick",!1),s(this,"didCtrlOnEnter",!1),s(this,"didSelectOnEnter",!1)}onEnter(e){const t=this.editor.getSelectedShapeIds(),n=this.editor.getSelectionRotatedPageBounds(),o=this.editor.getFocusedGroupId(),{inputs:{currentPagePoint:r}}=this.editor,{shiftKey:i,altKey:s,accelKey:a}=e;this.hitShape=e.shape,this.isDoubleClick=!1,this.didCtrlOnEnter=a;const l=this.editor.getOutermostSelectableShape(e.shape),c=this.editor.findShapeAncestor(l,(e=>t.includes(e.id)));if(this.didCtrlOnEnter||this.editor.getShapeUtil(e.shape).onClick||l.id===o||t.includes(l.id)||c||t.length>1&&null!==n&&void 0!==n&&n.containsPoint(r))return this.didSelectOnEnter=!1,void(this.hitShapeForPointerUp=l);this.didSelectOnEnter=!0,i&&!s?(this.editor.cancelDoubleClick(),t.includes(l.id)||(this.editor.markHistoryStoppingPoint("shift selecting shape"),this.editor.setSelectedShapes([...t,l.id]))):(this.editor.markHistoryStoppingPoint("selecting shape"),this.editor.setSelectedShapes([l.id]))}onPointerUp(e){var t;const n=this.editor.getSelectedShapeIds(),o=this.editor.getFocusedGroupId(),r=this.editor.getZoomLevel(),{inputs:{currentPagePoint:i}}=this.editor,s=e.shiftKey||e.accelKey,a=null!==(t=this.editor.getShapeAtPoint(i,{margin:this.editor.options.hitTestMargin/r,hitInside:!0,renderingOnly:!0}))&&void 0!==t?t:this.hitShape,l=a?this.editor.getOutermostSelectableShape(a):this.hitShapeForPointerUp;if(l){const t=this.editor.getShapeUtil(l);if(t.onClick){var c;const n=null===(c=t.onClick)||void 0===c?void 0:c.call(t,l);if(n)return this.editor.markHistoryStoppingPoint("shape on click"),this.editor.updateShapes([n]),void this.parent.transition("idle",e)}if(l.id===o)return n.length>0?(this.editor.markHistoryStoppingPoint("clearing shape ids"),this.editor.setSelectedShapes([])):this.editor.popFocusedGroupId(),void this.parent.transition("idle",e)}if(!this.didSelectOnEnter){const e=this.editor.getOutermostSelectableShape(a,(e=>!n.includes(e.id)));if(n.includes(e.id))if(s)this.editor.markHistoryStoppingPoint("deselecting on pointer up"),this.editor.deselect(l);else if(n.includes(l.id)){if(1===n.length){const e=az(this.editor.getShapeUtil(l).getGeometry(l)),t=1===e.length?e[0]:void 0;if(t){const e=this.editor.getPointInShapeSpace(l,i);if(t.bounds.containsPoint(e,0)&&t.hitTestPoint(e))return void this.editor.run((()=>{this.editor.markHistoryStoppingPoint("editing on pointer up"),this.editor.select(l.id);const e=this.editor.getShapeUtil(l);this.editor.getIsReadonly()&&!e.canEditInReadOnly(l)||(this.editor.setEditingShape(l.id),this.editor.setCurrentTool("select.editing_shape"),this.isDoubleClick&&this.editor.emit("select-all-text",{shapeId:l.id}))}))}}this.editor.markHistoryStoppingPoint("selecting on pointer up"),this.editor.select(l.id)}else this.editor.markHistoryStoppingPoint("selecting on pointer up"),this.editor.select(l);else if(s){const t=this.editor.getShapeAncestors(e);this.editor.markHistoryStoppingPoint("shift deselecting on pointer up"),this.editor.setSelectedShapes([...this.editor.getSelectedShapeIds().filter((e=>!t.find((t=>t.id===e)))),e.id])}else this.editor.markHistoryStoppingPoint("selecting on pointer up"),this.editor.setSelectedShapes([e.id])}this.parent.transition("idle",e)}onDoubleClick(){this.isDoubleClick=!0}onPointerMove(e){this.editor.inputs.isDragging&&(this.didCtrlOnEnter?this.parent.transition("brushing",e):this.startTranslating(e))}onLongPress(e){this.startTranslating(e)}startTranslating(e){this.editor.getIsReadonly()||(this.editor.focus(),this.parent.transition("translating",e))}onCancel(){this.cancel()}onComplete(){this.cancel()}onInterrupt(){this.cancel()}cancel(){this.parent.transition("idle")}}s(kz,"id","pointing_shape");class Pz extends gm{constructor(){super(...arguments),s(this,"info",{}),s(this,"markId",""),s(this,"didHoldCommand",!1),s(this,"creationCursorOffset",{x:0,y:0}),s(this,"snapshot",{})}onEnter(e){const{isCreating:t=!1,creatingMarkId:n,creationCursorOffset:o={x:0,y:0}}=e;if(this.info=e,this.didHoldCommand=!1,this.parent.setCurrentToolIdMask(e.onInteractionEnd),this.creationCursorOffset=o,this.snapshot=this._createSnapshot(),this.markId="",t)if(n)this.markId=n;else{const e=this.editor.getMarkIdMatching("creating:".concat(this.editor.getOnlySelectedShapeId()));e&&(this.markId=e)}else this.markId=this.editor.markHistoryStoppingPoint("starting resizing");t&&this.editor.setCursor({type:"cross",rotation:0}),this.handleResizeStart(),this.updateShapes()}onTick(e){let{elapsed:t}=e;const{editor:n}=this;n.edgeScrollManager.updateEdgeScrolling(t)}onPointerMove(){this.updateShapes()}onKeyDown(){this.updateShapes()}onKeyUp(){this.updateShapes()}onPointerUp(){this.complete()}onComplete(){this.complete()}onCancel(){this.cancel()}cancel(){this.editor.bailToMark(this.markId),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}complete(){var e,t;(WI(this.editor,this.snapshot.selectedShapeIds),this.handleResizeEnd(),this.info.isCreating&&this.info.onCreate)?null===(e=(t=this.info).onCreate)||void 0===e||e.call(t,this.editor.getOnlySelectedShape()):this.editor.getInstanceState().isToolLocked&&this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}handleResizeStart(){const{shapeSnapshots:e}=this.snapshot,t=[];e.forEach((e=>{var n;let{shape:o}=e;const r=this.editor.getShapeUtil(o),i=null===(n=r.onResizeStart)||void 0===n?void 0:n.call(r,o);i&&t.push(i)})),t.length>0&&this.editor.updateShapes(t)}handleResizeEnd(){const{shapeSnapshots:e}=this.snapshot,t=[];e.forEach((e=>{var n;let{shape:o}=e;const r=this.editor.getShape(o.id),i=this.editor.getShapeUtil(o),s=null===(n=i.onResizeEnd)||void 0===n?void 0:n.call(i,o,r);s&&t.push(s)})),t.length>0&&this.editor.updateShapes(t)}updateShapes(){const{altKey:e,shiftKey:t}=this.editor.inputs,{frames:n,shapeSnapshots:o,selectionBounds:r,cursorHandleOffset:i,selectedShapeIds:s,selectionRotation:a,canShapesDeform:l}=this.snapshot;let c=t||!l;if(1===o.size){const e=[...o.values()][0];this.editor.isShapeOfType(e.shape,"text")&&(c=!("left"===this.info.handle||"right"===this.info.handle))}const{ctrlKey:d}=this.editor.inputs,u=this.editor.inputs.currentPagePoint.clone().sub(i).sub(this.creationCursorOffset),h=this.editor.inputs.originPagePoint.clone().sub(i);if(this.editor.getInstanceState().isGridMode&&!d){const{gridSize:e}=this.editor.getDocumentSettings();u.snapToGrid(e)}const p=this.info.handle,f=_z(p,Math.PI);this.editor.snaps.clearIndicators();if((this.editor.user.getIsSnapMode()?!d:d)&&a%Xs===0){const{nudge:t}=this.editor.snaps.shapeBounds.snapResizeShapes({dragDelta:Vs.Sub(u,h),initialSelectionPageBounds:this.snapshot.initialSelectionPageBounds,handle:_z(p,a),isAspectRatioLocked:c,isResizingFromCenter:e});u.add(t)}const g=Vs.RotWith(e?r.center:r.getHandlePoint(f),r.point,a),m=Vs.Sub(u,g).rot(-a),y=Vs.Sub(h,g).rot(-a),v=Vs.DivV(m,y);Number.isFinite(v.x)||(v.x=1),Number.isFinite(v.y)||(v.y=1);const b="top"===p||"bottom"===p,w="left"===p||"right"===p;c?w?v.y=Math.abs(v.x):b?v.x=Math.abs(v.y):Math.abs(v.x)>Math.abs(v.y)?v.y=Math.abs(v.x)*(v.y<0?-1:1):v.x=Math.abs(v.y)*(v.x<0?-1:1):(b&&(v.x=1),w&&(v.y=1)),this.info.isCreating||this.updateCursor({dragHandle:p,isFlippedX:v.x<0,isFlippedY:v.y<0,rotation:a});for(const x of o.keys()){const e=o.get(x);this.editor.resizeShape(x,v,{initialShape:e.shape,initialBounds:e.bounds,initialPageTransform:e.pageTransform,dragHandle:p,mode:1===s.length&&x===s[0]?"resize_bounds":"scale_shape",scaleOrigin:g,isAspectRatioLocked:c,scaleAxisRotation:a,skipStartAndEndCallbacks:!0})}if(this.editor.inputs.ctrlKey){this.didHoldCommand=!0;for(const{id:e,children:t}of n){if(!t.length)continue;const n=o.get(e).shape,r=this.editor.getShape(e);if(!n||!r)continue;const i=r.x-n.x,s=r.y-n.y,a=new Vs(i,s).rot(-n.rotation);if(0!==a.x||0!==a.y)for(const e of t)this.editor.updateShape({id:e.id,type:e.type,x:e.x-a.x,y:e.y-a.y})}}else if(this.didHoldCommand){this.didHoldCommand=!1;for(const{children:e}of n)if(e.length)for(const t of e)this.editor.updateShape({id:t.id,type:t.type,x:t.x,y:t.y})}}updateCursor(e){let{dragHandle:t,isFlippedX:n,isFlippedY:o,rotation:r}=e;const i=l({},this.editor.getInstanceState().cursor);switch(t){case"top_left":case"bottom_right":i.type="nwse-resize",n!==o&&(i.type="nesw-resize");break;case"top_right":case"bottom_left":i.type="nesw-resize",n!==o&&(i.type="nwse-resize")}i.rotation=r,this.editor.setCursor(i)}onExit(){this.parent.setCurrentToolIdMask(void 0),this.editor.setCursor({type:"default",rotation:0}),this.editor.snaps.clearIndicators()}_createSnapshot(){const e=this.editor.getSelectedShapeIds(),t=this.editor.getSelectionRotation(),{inputs:{originPagePoint:n}}=this.editor,o=this.editor.getSelectionRotatedPageBounds(),r=Vs.RotWith(o.getHandlePoint(this.info.handle),o.point,t),i=Vs.Sub(n,r),s=new Map,a=[];e.forEach((t=>{const n=this.editor.getShape(t);if(n){if("frame"===n.type&&a.push({id:t,children:C(this.editor.getSortedChildIdsForParent(n).map((e=>this.editor.getShape(e))))}),s.set(n.id,this._createShapeSnapshot(n)),this.editor.isShapeOfType(n,"frame")&&1===e.length)return;this.editor.visitDescendants(n.id,(e=>{const t=this.editor.getShape(e);if(t&&(s.set(t.id,this._createShapeSnapshot(t)),this.editor.isShapeOfType(t,"frame")))return!1}))}}));const l=![...s.values()].some((e=>!la(e.pageRotation,t)||e.isAspectRatioLocked));return{shapeSnapshots:s,selectionBounds:o,cursorHandleOffset:i,selectionRotation:t,selectedShapeIds:e,canShapesDeform:l,initialSelectionPageBounds:this.editor.getSelectionPageBounds(),frames:a}}_createShapeSnapshot(e){const t=this.editor.getShapePageTransform(e),n=this.editor.getShapeUtil(e);return{shape:e,bounds:this.editor.getShapeGeometry(e).bounds,pageTransform:t,pageRotation:ic.Decompose(t).rotation,isAspectRatioLocked:n.isAspectRatioLocked(e)}}}s(Pz,"id","resizing");const Cz=["top","top_right","right","bottom_right","bottom","bottom_left","left","top_left"];function _z(e,t){t%=$s;const n=Math.round(t/(Gs/4)),o=Cz.indexOf(e);return Cz[(o+n)%Cz.length]}const Iz=Math.PI/180;class Ez extends gm{constructor(){super(...arguments),s(this,"snapshot",{}),s(this,"info",{}),s(this,"markId","")}onEnter(e){this.info=e,this.parent.setCurrentToolIdMask(e.onInteractionEnd),this.markId=this.editor.markHistoryStoppingPoint("rotate start");const t=cp({editor:this.editor,ids:this.editor.getSelectedShapeIds()});if(!t)return this.parent.transition("idle",this.info);this.snapshot=t;const n=this._getRotationFromPointerPosition({snapToNearestDegree:!1});dp({editor:this.editor,delta:this._getRotationFromPointerPosition({snapToNearestDegree:!1}),snapshot:this.snapshot,stage:"start"}),this.editor.setCursor({type:$L[this.info.handle],rotation:n+this.snapshot.initialShapesRotation})}onExit(){this.editor.setCursor({type:"default",rotation:0}),this.parent.setCurrentToolIdMask(void 0),this.snapshot={}}onPointerMove(){this.update()}onKeyDown(){this.update()}onKeyUp(){this.update()}onPointerUp(){this.complete()}onComplete(){this.complete()}onCancel(){this.cancel()}update(){const e=this._getRotationFromPointerPosition({snapToNearestDegree:!1});dp({editor:this.editor,delta:e,snapshot:this.snapshot,stage:"update"}),this.editor.setCursor({type:$L[this.info.handle],rotation:e+this.snapshot.initialShapesRotation})}cancel(){this.editor.bailToMark(this.markId),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):this.parent.transition("idle",this.info)}complete(){dp({editor:this.editor,delta:this._getRotationFromPointerPosition({snapToNearestDegree:!0}),snapshot:this.snapshot,stage:"end"}),WI(this.editor,this.snapshot.shapeSnapshots.map((e=>e.shape.id))),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):this.parent.transition("idle",this.info)}_getRotationFromPointerPosition(e){let{snapToNearestDegree:t}=e;const n=this.editor.getSelectionRotation(),o=this.editor.getSelectionRotatedPageBounds(),{inputs:{shiftKey:r,currentPagePoint:i}}=this.editor,{initialCursorAngle:s,initialShapesRotation:a}=this.snapshot;if(!o)return a;let l=a+(o.center.clone().rotWith(o.point,n).angle(i)-s);if(r)l=aa(l,24);else if(t&&(l=Math.round(l/Iz)*Iz,this.editor.getInstanceState().isCoarsePointer)){const e=aa(l,4),t=ia(l,e);Math.abs(t)<5*Gs/180&&(l=e)}return l-a}}s(Ez,"id","rotating");class jz extends gm{constructor(){super(...arguments),s(this,"hits",new Set),s(this,"size",0),s(this,"scribbleId","id"),s(this,"initialSelectedShapeIds",new Set),s(this,"newlySelectedShapeIds",new Set)}onEnter(){this.initialSelectedShapeIds=new Set(this.editor.inputs.shiftKey?this.editor.getSelectedShapeIds():[]),this.newlySelectedShapeIds=new Set,this.size=0,this.hits.clear();const e=this.editor.scribbles.addScribble({color:"selection-stroke",opacity:.32,size:12});this.scribbleId=e.id,this.updateScribbleSelection(!0),this.editor.updateInstanceState({brush:null})}onExit(){this.editor.scribbles.stop(this.scribbleId)}onPointerMove(){this.updateScribbleSelection(!0)}onPointerUp(){this.complete()}onKeyDown(){this.updateScribbleSelection(!1)}onKeyUp(){this.editor.inputs.altKey?this.updateScribbleSelection(!1):this.parent.transition("brushing")}onCancel(){this.cancel()}onComplete(){this.complete()}pushPointToScribble(){const{x:e,y:t}=this.editor.inputs.currentPagePoint;this.editor.scribbles.addPoint(this.scribbleId,e,t)}updateScribbleSelection(e){const{editor:t}=this,n=this.editor.getCurrentPageRenderingShapesSorted(),{inputs:{shiftKey:o,originPagePoint:r,previousPagePoint:i,currentPagePoint:s}}=this.editor,{newlySelectedShapeIds:a,initialSelectedShapeIds:l}=this;e&&this.pushPointToScribble();const c=n;let d,u,h,p;for(let m=0,y=c.length;m<y;m++){if(d=c[m],t.isShapeOfType(d,"group")||a.has(d.id)||t.isShapeOrAncestorLocked(d))continue;if(u=t.getShapeGeometry(d),t.isShapeOfType(d,"frame")&&u.bounds.containsPoint(t.getPointInShapeSpace(d,r)))continue;const e=t.getShapePageTransform(d);if(!u||!e)continue;const n=e.clone().invert();h=n.applyToPoint(i),p=n.applyToPoint(s);const{bounds:o}=u;if(!(o.minX-0>Math.max(h.x,p.x)||o.minY-0>Math.max(h.y,p.y)||o.maxX+0<Math.min(h.x,p.x)||o.maxY+0<Math.min(h.y,p.y))&&u.hitTestLineSegment(h,p,0)){const e=this.editor.getOutermostSelectableShape(d),t=this.editor.getShapeMask(e.id);if(t){if(null!==iu(i,s,t)){if(!fa(s,t))continue}}a.add(e.id)}}const f=t.getSelectedShapeIds(),g=new Set(o?[...a,...l]:[...a]);(f.length!==g.size||f.some((e=>!g.has(e))))&&this.editor.setSelectedShapes(Array.from(g))}complete(){this.updateScribbleSelection(!0),this.parent.transition("idle")}cancel(){this.editor.setSelectedShapes([...this.initialSelectedShapeIds]),this.parent.transition("idle")}}s(jz,"id","scribble_brushing");var Tz,Mz,Az=Object.create,Oz=Object.defineProperty,Dz=Object.getOwnPropertyDescriptor,Rz=(e,t)=>(t=Symbol[e])?t:Symbol.for("Symbol."+e),Lz=e=>{throw TypeError(e)},zz=(e,t,n)=>t in e?Oz(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Nz=(e,t)=>Oz(e,"name",{value:t,configurable:!0}),Fz=["class","method","getter","setter","accessor","field","value","get","set"],Bz=e=>void 0!==e&&"function"!==typeof e?Lz("Function expected"):e,Uz=(e,t,n,o,r)=>({kind:Fz[e],name:t,metadata:o,addInitializer:e=>n._?Lz("Already initialized"):r.push(Bz(e||null))}),Hz=(e,t)=>zz(t,Rz("metadata"),e[3]),Kz=(e,t,n)=>zz(e,"symbol"!==typeof t?t+"":t,n),Vz=(e,t,n)=>t.has(e)||Lz("Cannot "+n),Wz=(e,t)=>Object(t)!==t?Lz('Cannot use the "in" operator on this value'):e.has(t),qz=(e,t,n)=>(Vz(e,t,"read from private field"),n?n.call(e):t.get(e)),Yz=(e,t,n,o)=>(Vz(e,t,"write to private field"),o?o.call(e,n):t.set(e,n),n),Gz=(e,t,n)=>(Vz(e,t,"access private method"),n);Tz=[R];class Xz{constructor(e){this.editor=e,((e,t,n,o)=>{for(var r=0,i=e[t>>1],s=i&&i.length;r<s;r++)1&t?i[r].call(n):o=i[r].call(n,o)})(Mz,5,this),Kz(this,"prevDroppingShapeId",null),Kz(this,"droppingNodeTimer",null),Kz(this,"first",!0),e.disposables.add(this.dispose)}updateDroppingNode(e,t){var n,o;this.first&&(this.editor.setHintingShapes(e.map((e=>this.editor.findShapeAncestor(e,(e=>"group"!==e.type)))).filter((e=>e))),this.prevDroppingShapeId=null!==(n=null===(o=this.editor.getDroppingOverShape(this.editor.inputs.originPagePoint,e))||void 0===o?void 0:o.id)&&void 0!==n?n:null,this.first=!1);null===this.droppingNodeTimer?this.setDragTimer(e,20,t):this.editor.inputs.pointerVelocity.len()>.5&&(clearTimeout(this.droppingNodeTimer),this.setDragTimer(e,100,t))}setDragTimer(e,t,n){this.droppingNodeTimer=this.editor.timers.setTimeout((()=>{this.editor.run((()=>{this.handleDrag(this.editor.inputs.currentPagePoint,e,n)})),this.droppingNodeTimer=null}),t)}handleDrag(e,t,n){var o,r;t=C(t.map((e=>this.editor.getShape(e.id))));const i=null!==(o=null===(r=this.editor.getDroppingOverShape(e,t))||void 0===r?void 0:r.id)&&void 0!==o?o:null;if(i===this.prevDroppingShapeId)return void this.hintParents(t);const{prevDroppingShapeId:s}=this,a=s&&this.editor.getShape(s),l=i&&this.editor.getShape(i);var c,d,u,h;a&&(null===(c=(d=this.editor.getShapeUtil(a)).onDragShapesOut)||void 0===c||c.call(d,a,t));l&&(null===(u=(h=this.editor.getShapeUtil(l)).onDragShapesOver)||void 0===u||u.call(h,l,t));this.hintParents(t),null===n||void 0===n||n(),this.prevDroppingShapeId=i}hintParents(e){const t=new Map;for(const o of e){const e=this.editor.findShapeAncestor(o,(e=>"group"!==e.type));e&&(t.has(e.id)||t.set(e.id,[]),t.get(e.id).push(o.id))}const n=[];for(const[o,r]of t){const e=this.editor.getShape(o);e&&(qI(this.editor,e).length<r.length&&n.push(e.id))}this.editor.setHintingShapes(n)}dropShapes(e){const{prevDroppingShapeId:t}=this;if(this.handleDrag(this.editor.inputs.currentPagePoint,e),t){var n,o;const r=this.editor.getShape(t);if(!r)return;null===(n=(o=this.editor.getShapeUtil(r)).onDropShapesOver)||void 0===n||n.call(o,r,e)}}clear(){this.prevDroppingShapeId=null,null!==this.droppingNodeTimer&&clearTimeout(this.droppingNodeTimer),this.droppingNodeTimer=null,this.editor.setHintingShapes([]),this.first=!0}dispose(){this.clear()}}((e,t,n,o,r,i)=>{var s,a,l,c,d,u=7&t,h=!!(8&t),p=!!(16&t),f=u>3?e.length+1:u?h?1:2:0,g=Fz[u+5],m=u>3&&(e[f-1]=[]),y=e[f]||(e[f]=[]),v=u&&(!p&&!h&&(r=r.prototype),u<5&&(u>3||!p)&&Dz(u<4?r:{get[n](){return qz(this,i)},set[n](e){return Yz(this,i,e)}},n));u?p&&u<4&&Nz(i,(u>2?"set ":u>1?"get ":"")+n):Nz(r,n);for(var b=o.length-1;b>=0;b--)c=Uz(u,n,l={},e[3],y),u&&(c.static=h,c.private=p,d=c.access={has:p?e=>Wz(r,e):e=>n in e},3^u&&(d.get=p?e=>(1^u?qz:Gz)(e,r,4^u?i:v.get):e=>e[n]),u>2&&(d.set=p?(e,t)=>Yz(e,r,t,4^u?i:v.set):(e,t)=>e[n]=t)),a=(0,o[b])(u?u<4?p?i:v[g]:u>4?void 0:{get:v.get,set:v.set}:r,c),l._=1,4^u||void 0===a?Bz(a)&&(u>4?m.unshift(a):u?p?i=a:v[g]=a:r=a):"object"!==typeof a||null===a?Lz("Object expected"):(Bz(s=a.get)&&(v.get=s),Bz(s=a.set)&&(v.set=s),Bz(s=a.init)&&m.unshift(s));u||Hz(e,r),v&&Oz(r,n,v)})(Mz=(e=>{var t;return[,,,Az(null!==(t=null===e||void 0===e?void 0:e[Rz("metadata")])&&void 0!==t?t:null)]})(null),1,"dispose",Tz,Xz),Hz(Mz,Xz);var $z,Zz,Qz,Jz=Object.create,eN=Object.defineProperty,tN=Object.getOwnPropertyDescriptor,nN=(e,t)=>(t=Symbol[e])?t:Symbol.for("Symbol."+e),oN=e=>{throw TypeError(e)},rN=(e,t,n)=>t in e?eN(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,iN=(e,t)=>eN(e,"name",{value:t,configurable:!0}),sN=["class","method","getter","setter","accessor","field","value","get","set"],aN=e=>void 0!==e&&"function"!==typeof e?oN("Function expected"):e,lN=(e,t,n,o,r)=>({kind:sN[e],name:t,metadata:o,addInitializer:e=>n._?oN("Already initialized"):r.push(aN(e||null))}),cN=(e,t)=>rN(t,nN("metadata"),e[3]),dN=(e,t,n)=>rN(e,"symbol"!==typeof t?t+"":t,n),uN=(e,t,n)=>t.has(e)||oN("Cannot "+n),hN=(e,t)=>Object(t)!==t?oN('Cannot use the "in" operator on this value'):e.has(t),pN=(e,t,n)=>(uN(e,t,"read from private field"),n?n.call(e):t.get(e)),fN=(e,t,n,o)=>(uN(e,t,"write to private field"),o?o.call(e,n):t.set(e,n),n),gN=(e,t,n)=>(uN(e,t,"access private method"),n);class mN extends(Zz=gm,$z=[R],Zz){constructor(){super(...arguments),((e,t,n,o)=>{for(var r=0,i=e[t>>1],s=i&&i.length;r<s;r++)1&t?i[r].call(n):o=i[r].call(n,o)})(Qz,5,this),dN(this,"info",{}),dN(this,"selectionSnapshot",{}),dN(this,"snapshot",{}),dN(this,"markId",""),dN(this,"isCloning",!1),dN(this,"isCreating",!1),dN(this,"dragAndDropManager",new Xz(this.editor))}onCreate(e){}onEnter(e){var t;const{isCreating:n=!1,creatingMarkId:o,onCreate:r=()=>{}}=e;if(null!==(t=this.editor.getSelectedShapeIds())&&void 0!==t&&t.length){if(this.info=e,this.parent.setCurrentToolIdMask(e.onInteractionEnd),this.isCreating=n,this.markId="",n)if(o)this.markId=o;else{const e=this.editor.getMarkIdMatching("creating:".concat(this.editor.getOnlySelectedShapeId()));e&&(this.markId=e)}else this.markId=this.editor.markHistoryStoppingPoint("translating");this.onCreate=r,this.isCloning=!1,this.info=e,this.editor.setCursor({type:"move",rotation:0}),this.selectionSnapshot=yN(this.editor),this.isCreating||!this.editor.inputs.altKey?(this.snapshot=this.selectionSnapshot,this.handleStart(),this.updateShapes()):this.startCloning()}else this.parent.transition("idle")}onExit(){this.parent.setCurrentToolIdMask(void 0),this.selectionSnapshot={},this.snapshot={},this.editor.snaps.clearIndicators(),this.editor.setCursor({type:"default",rotation:0}),this.dragAndDropManager.clear()}onTick(e){let{elapsed:t}=e;const{editor:n}=this;this.dragAndDropManager.updateDroppingNode(this.snapshot.movingShapes,this.updateParentTransforms),n.edgeScrollManager.updateEdgeScrolling(t)}onPointerMove(){this.updateShapes()}onKeyDown(){!this.editor.inputs.altKey||this.isCloning?this.updateShapes():this.startCloning()}onKeyUp(){this.editor.inputs.altKey||!this.isCloning?this.updateShapes():this.stopCloning()}onPointerUp(){this.complete()}onComplete(){this.complete()}onCancel(){this.cancel()}startCloning(){this.isCreating||(this.isCloning=!0,this.reset(),this.markId=this.editor.markHistoryStoppingPoint("translate cloning"),this.editor.duplicateShapes(Array.from(this.editor.getSelectedShapeIds())),this.snapshot=yN(this.editor),this.handleStart(),this.updateShapes())}stopCloning(){this.isCloning=!1,this.snapshot=this.selectionSnapshot,this.reset(),this.markId=this.editor.markHistoryStoppingPoint("translate"),this.updateShapes()}reset(){this.editor.bailToMark(this.markId)}complete(){var e;(this.updateShapes(),this.dragAndDropManager.dropShapes(this.snapshot.movingShapes),WI(this.editor,this.snapshot.movingShapes.map((e=>e.id))),this.handleEnd(),this.editor.getInstanceState().isToolLocked&&this.info.onInteractionEnd)?this.editor.setCurrentTool(this.info.onInteractionEnd):this.isCreating?null===(e=this.onCreate)||void 0===e||e.call(this,this.editor.getOnlySelectedShape()):this.parent.transition("idle")}cancel(){this.reset(),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd):this.parent.transition("idle",this.info)}handleStart(){const{movingShapes:e}=this.snapshot,t=[];e.forEach((e=>{var n;const o=this.editor.getShapeUtil(e),r=null===(n=o.onTranslateStart)||void 0===n?void 0:n.call(o,e);r&&t.push(r)})),t.length>0&&this.editor.updateShapes(t),this.editor.setHoveredShape(null)}handleEnd(){const{movingShapes:e}=this.snapshot;if(this.isCloning&&e.length>0){const t=Vs.Average(e.map((e=>this.editor.getShapePageTransform(e.id).point()))),n=Vs.Sub(t,this.selectionSnapshot.averagePagePoint);Vs.IsNaN(n)||this.editor.updateInstanceState({duplicateProps:{shapeIds:e.map((e=>e.id)),offset:{x:n.x,y:n.y}}})}const t=[];e.forEach((e=>{var n;const o=this.editor.getShape(e.id),r=this.editor.getShapeUtil(e),i=null===(n=r.onTranslateEnd)||void 0===n?void 0:n.call(r,e,o);i&&t.push(i)})),t.length>0&&this.editor.updateShapes(t)}updateShapes(){const{snapshot:e}=this;this.dragAndDropManager.updateDroppingNode(e.movingShapes,this.updateParentTransforms),function(e){let{editor:t,snapshot:n}=e;const{inputs:o}=t,{noteSnapshot:r,noteAdjacentPositions:i,initialPageBounds:s,initialSnapPoints:a,shapeSnapshots:l,averagePagePoint:c}=n,d=t.getInstanceState().isGridMode,u=t.getDocumentSettings().gridSize,h=Vs.Sub(o.currentPagePoint,o.originPagePoint),p=t.inputs.shiftKey?Math.abs(h.x)<Math.abs(h.y)?"x":"y":null;"x"===p?h.x=0:"y"===p&&(h.y=0);t.snaps.clearIndicators();const f=t.user.getIsSnapMode()?!o.ctrlKey:o.ctrlKey;let g=!1;if(f&&t.inputs.pointerVelocity.len()<.5){const{nudge:e}=t.snaps.shapeBounds.snapTranslateShapes({dragDelta:h,initialSelectionPageBounds:s,lockedAxis:p,initialSelectionSnapPoints:a});h.add(e)}else if(r&&i){const{scale:e}=r.shape.props,n=r.pagePoint.clone().add(h).add(eD.clone().mul(e).rot(r.pageRotation));let o=10/t.getZoomLevel(),s=new Vs(0,0);for(const t of i){const e=Vs.Sub(n,t),r=e.len();r<o&&(g=!0,o=r,s=e)}h.sub(s)}const m=Vs.Add(c,h),y=t.snaps.getIndicators();!d||o.ctrlKey||g||0!==y.length||m.snapToGrid(u);const v=Vs.Sub(m,c);t.updateShapes(C(l.map((e=>{let{shape:t,pagePoint:n,parentTransform:o}=e;const r=Vs.Add(n,v),i=o?ic.applyToPoint(o,r):r;return{id:t.id,type:t.type,x:i.x,y:i.y}}))))}({editor:this.editor,snapshot:e});const{movingShapes:t}=e,n=[];t.forEach((e=>{var t;const o=this.editor.getShape(e.id),r=this.editor.getShapeUtil(e),i=null===(t=r.onTranslate)||void 0===t?void 0:t.call(r,e,o);i&&n.push(i)})),n.length>0&&this.editor.updateShapes(n)}updateParentTransforms(){const{editor:e,snapshot:{shapeSnapshots:t}}=this,n=[];t.forEach((t=>{const o=e.getShape(t.shape.id);if(!o)return null;n.push(o);const r=Ir(o.parentId)?null:ic.Inverse(e.getShapePageTransform(o.parentId));t.parentTransform=r}))}}function yN(e){const t=[],n=[],o=C(e.getSelectedShapeIds().map((o=>{const r=e.getShape(o);if(!r)return null;t.push(r);const i=e.getShapePageTransform(o),s=i.point(),a=i.rotation();n.push(s);return{shape:r,pagePoint:s,pageRotation:a,parentTransform:_r.isId(r.parentId)?null:ic.Inverse(e.getShapePageTransform(r.parentId))}}))),r=e.getOnlySelectedShape();let i,s,a=[];if(r)a=e.snaps.shapeBounds.getSnapPoints(r.id);else{const t=e.getSelectionPageBounds();t&&(a=t.cornersAndCenter.map(((e,t)=>({id:"selection:"+t,x:e.x,y:e.y}))))}const{originPagePoint:l}=e.inputs,c=o.filter((t=>e.isShapeOfType(t.shape,"note")&&e.isPointInShape(t.shape,l)));if(0===c.length);else if(1===c.length)s=c[0];else{var d;const t=e.getCurrentPageShapesSorted();s=null===(d=c.map((e=>({snapshot:e,index:t.findIndex((t=>t.id===e.shape.id))}))).sort(((e,t)=>t.index-e.index))[0])||void 0===d?void 0:d.snapshot}var u;s&&(i=oD(e,s.pageRotation,s.shape.props.scale,null!==(u=s.shape.props.growY)&&void 0!==u?u:0));return{averagePagePoint:Vs.Average(n),movingShapes:t,shapeSnapshots:o,initialPageBounds:e.getSelectionPageBounds(),initialSnapPoints:a,noteAdjacentPositions:i,noteSnapshot:s}}((e,t,n,o,r,i)=>{var s,a,l,c,d,u=7&t,h=!!(8&t),p=!!(16&t),f=u>3?e.length+1:u?h?1:2:0,g=sN[u+5],m=u>3&&(e[f-1]=[]),y=e[f]||(e[f]=[]),v=u&&(!p&&!h&&(r=r.prototype),u<5&&(u>3||!p)&&tN(u<4?r:{get[n](){return pN(this,i)},set[n](e){return fN(this,i,e)}},n));u?p&&u<4&&iN(i,(u>2?"set ":u>1?"get ":"")+n):iN(r,n);for(var b=o.length-1;b>=0;b--)c=lN(u,n,l={},e[3],y),u&&(c.static=h,c.private=p,d=c.access={has:p?e=>hN(r,e):e=>n in e},3^u&&(d.get=p?e=>(1^u?pN:gN)(e,r,4^u?i:v.get):e=>e[n]),u>2&&(d.set=p?(e,t)=>fN(e,r,t,4^u?i:v.set):(e,t)=>e[n]=t)),a=(0,o[b])(u?u<4?p?i:v[g]:u>4?void 0:{get:v.get,set:v.set}:r,c),l._=1,4^u||void 0===a?aN(a)&&(u>4?m.unshift(a):u?p?i=a:v[g]=a:r=a):"object"!==typeof a||null===a?oN("Object expected"):(aN(s=a.get)&&(v.get=s),aN(s=a.set)&&(v.set=s),aN(s=a.init)&&m.unshift(s));u||cN(e,r),v&&eN(r,n,v)})(Qz=(e=>{var t;return[,,,Jz(null!==(t=null===e||void 0===e?void 0:e[nN("metadata")])&&void 0!==t?t:null)]})(Zz),1,"updateParentTransforms",$z,mN),cN(Qz,mN),dN(mN,"id","translating");class vN extends gm{constructor(){super(...arguments),s(this,"reactor",void 0)}static children(){return[iz,QL,hz,vz,kz,mN,XL,jz,oz,Sz,ZL,lz,Pz,Ez,xz,yz,bz,sz]}cleanUpDuplicateProps(){const e=this.editor.getSelectedShapeIds(),t=this.editor.getInstanceState();if(!t.duplicateProps)return;const n=new Set(t.duplicateProps.shapeIds);e.length===n.size&&e.every((e=>n.has(e)))||this.editor.updateInstanceState({duplicateProps:null})}onEnter(){this.reactor=Ht("clean duplicate props",(()=>{try{this.cleanUpDuplicateProps()}catch(e){console.error(e)}}))}onExit(){var e;null===(e=this.reactor)||void 0===e||e.call(this),this.editor.getCurrentPageState().editingShapeId&&this.editor.setEditingShape(null)}}s(vN,"id","select"),s(vN,"initial","idle"),s(vN,"isLockable",!1);class bN extends gm{constructor(){super(...arguments),s(this,"info",{})}onEnter(e){this.info=e}onPointerDown(){this.parent.transition("pointing",this.info)}}s(bN,"id","idle");class wN extends gm{constructor(){super(...arguments),s(this,"info",{})}onEnter(e){this.info=e}onPointerUp(){this.complete()}onPointerMove(){this.editor.inputs.isDragging&&this.parent.transition("zoom_brushing",this.info)}onCancel(){this.cancel()}complete(){const{currentScreenPoint:e}=this.editor.inputs;this.editor.inputs.altKey?this.editor.zoomOut(e,{animation:{duration:220}}):this.editor.zoomIn(e,{animation:{duration:220}}),this.parent.transition("idle",this.info)}cancel(){this.parent.transition("idle",this.info)}}s(wN,"id","pointing");class xN extends gm{constructor(){super(...arguments),s(this,"info",{}),s(this,"zoomBrush",new rc)}onEnter(e){this.info=e,this.update()}onExit(){this.editor.updateInstanceState({zoomBrush:null})}onPointerMove(){this.update()}onPointerUp(){this.complete()}onCancel(){this.cancel()}update(){const{inputs:{originPagePoint:e,currentPagePoint:t}}=this.editor;this.zoomBrush.setTo(rc.FromPoints([e,t])),this.editor.updateInstanceState({zoomBrush:this.zoomBrush.toJson()})}cancel(){this.parent.transition("idle",this.info)}complete(){const{zoomBrush:e}=this,t=8/this.editor.getZoomLevel();if(e.width<t&&e.height<t){const e=this.editor.inputs.currentScreenPoint;this.editor.inputs.altKey?this.editor.zoomOut(e,{animation:{duration:220}}):this.editor.zoomIn(e,{animation:{duration:220}})}else{const t=this.editor.inputs.altKey?this.editor.getZoomLevel()/2:void 0;this.editor.zoomToBounds(e,{targetZoom:t,animation:{duration:220}})}this.parent.transition("idle",this.info)}}s(xN,"id","zoom_brushing");class SN extends gm{constructor(){super(...arguments),s(this,"info",{})}static children(){return[bN,xN,wN]}onEnter(e){this.info=e,this.parent.setCurrentToolIdMask(e.onInteractionEnd),this.updateCursor()}onExit(){this.parent.setCurrentToolIdMask(void 0),this.editor.updateInstanceState({zoomBrush:null,cursor:{type:"default",rotation:0}}),this.parent.setCurrentToolIdMask(void 0)}onKeyDown(){this.updateCursor()}onKeyUp(e){this.updateCursor(),"KeyZ"===e.code&&this.complete()}onInterrupt(){this.complete()}complete(){this.info.onInteractionEnd&&"select"!==this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):this.parent.transition("select")}updateCursor(){this.editor.inputs.altKey?this.editor.setCursor({type:"zoom-out",rotation:0}):this.editor.setCursor({type:"zoom-in",rotation:0})}}s(SN,"id","zoom"),s(SN,"initial","idle"),s(SN,"isLockable",!1);const kN=[UL,WL,GL,SN,vN];function PN(){const e=Ns(),t=yn("follow",(()=>e.getInstanceState().followingUserId),[e]);return t?(0,Ss.jsx)(CN,{userId:t}):null}function CN(e){let{userId:t}=e;const n=hc(t);return n?(0,Ss.jsx)("div",{className:"tlui-following-indicator",style:{borderColor:n.color}}):null}let _N={fonts:{draw:"".concat(rp(),"/fonts/Shantell_Sans-Tldrawish.woff2"),serif:"".concat(rp(),"/fonts/IBMPlexSerif-Medium.woff2"),sansSerif:"".concat(rp(),"/fonts/IBMPlexSans-Medium.woff2"),monospace:"".concat(rp(),"/fonts/IBMPlexMono-Medium.woff2")}};function IN(t){return(0,e.useMemo)((()=>t?{fonts:l(l({},_N.fonts),null===t||void 0===t?void 0:t.fonts)}:_N),[t])}let EN=l(l({},_N),{},{icons:Object.fromEntries(["align-bottom","align-center-horizontal","align-center-vertical","align-left","align-right","align-top","arrow-left","arrowhead-arrow","arrowhead-bar","arrowhead-diamond","arrowhead-dot","arrowhead-none","arrowhead-square","arrowhead-triangle-inverted","arrowhead-triangle","blob","bring-forward","bring-to-front","broken","check-circle","check","chevron-down","chevron-left","chevron-right","chevron-up","chevrons-ne","chevrons-sw","clipboard-copied","clipboard-copy","color","cross-2","cross-circle","dash-dashed","dash-dotted","dash-draw","dash-solid","disconnected","discord","distribute-horizontal","distribute-vertical","dot","dots-horizontal","dots-vertical","drag-handle-dots","duplicate","edit","external-link","fill-fill","fill-none","fill-pattern","fill-semi","fill-solid","follow","following","font-draw","font-mono","font-sans","font-serif","geo-arrow-down","geo-arrow-left","geo-arrow-right","geo-arrow-up","geo-check-box","geo-cloud","geo-diamond","geo-ellipse","geo-heart","geo-hexagon","geo-octagon","geo-oval","geo-pentagon","geo-rectangle","geo-rhombus-2","geo-rhombus","geo-star","geo-trapezoid","geo-triangle","geo-x-box","github","group","horizontal-align-end","horizontal-align-middle","horizontal-align-start","info-circle","leading","link","lock","menu","minus","mixed","pack","plus","question-mark-circle","question-mark","redo","reset-zoom","rotate-ccw","rotate-cw","send-backward","send-to-back","share-1","size-extra-large","size-large","size-medium","size-small","spline-cubic","spline-line","stack-horizontal","stack-vertical","status-offline","stretch-horizontal","stretch-vertical","text-align-center","text-align-left","text-align-right","toggle-off","toggle-on","tool-arrow","tool-eraser","tool-frame","tool-hand","tool-highlight","tool-laser","tool-line","tool-media","tool-note","tool-pencil","tool-pointer","tool-screenshot","tool-text","trash","twitter","undo","ungroup","unlock","vertical-align-end","vertical-align-middle","vertical-align-start","warning-triangle","zoom-in","zoom-out"].map((e=>[e,"".concat(rp(),"/icons/icon/0_merged.svg#").concat(e)]))),translations:Object.fromEntries(bs.map((e=>[e.locale,"".concat(rp(),"/translations/").concat(e.locale,".json")]))),embedIcons:Object.fromEntries(uj.map((e=>[e.type,"".concat(rp(),"/embed-icons/").concat(e.type,".png")])))});function jN(e){return e?{fonts:Object.assign(l({},EN.fonts),l({},null===e||void 0===e?void 0:e.fonts)),icons:Object.assign(l({},EN.icons),l({},null===e||void 0===e?void 0:e.icons)),embedIcons:Object.assign(l({},EN.embedIcons),l({},null===e||void 0===e?void 0:e.embedIcons)),translations:Object.assign(l({},EN.translations),l({},null===e||void 0===e?void 0:e.translations))}:EN}const TN=["__scopePopover"],MN=["__scopePopover"],AN=["forceMount"],ON=["__scopePopover","trapFocus","onOpenAutoFocus","onCloseAutoFocus","disableOutsidePointerEvents","onEscapeKeyDown","onPointerDownOutside","onFocusOutside","onInteractOutside"],DN=["__scopePopover"],RN=["__scopePopover"];var LN="Popover",[zN,NN]=tw(LN,[RS]),FN=RS(),[BN,UN]=zN(LN),HN=t=>{const{__scopePopover:n,children:o,open:r,defaultOpen:i,onOpenChange:s,modal:a=!1}=t,c=FN(n),d=e.useRef(null),[u,h]=e.useState(!1),[p=!1,f]=ik({prop:r,defaultProp:i,onChange:s});return(0,Ss.jsx)(ZS,l(l({},c),{},{children:(0,Ss.jsx)(BN,{scope:n,contentId:Xw(),triggerRef:d,open:p,onOpenChange:f,onOpenToggle:e.useCallback((()=>f((e=>!e))),[f]),hasCustomAnchor:u,onCustomAnchorAdd:e.useCallback((()=>h(!0)),[]),onCustomAnchorRemove:e.useCallback((()=>h(!1)),[]),modal:a,children:o})}))};HN.displayName=LN;var KN="PopoverAnchor",VN=e.forwardRef(((t,n)=>{const{__scopePopover:o}=t,r=yr(t,TN),i=UN(KN,o),s=FN(o),{onCustomAnchorAdd:a,onCustomAnchorRemove:c}=i;return e.useEffect((()=>(a(),()=>c())),[a,c]),(0,Ss.jsx)(QS,l(l(l({},s),r),{},{ref:n}))}));VN.displayName=KN;var WN="PopoverTrigger",qN=e.forwardRef(((e,t)=>{const{__scopePopover:n}=e,o=yr(e,MN),r=UN(WN,n),i=FN(n),s=iw(t,r.triggerRef),a=(0,Ss.jsx)(pw.button,l(l({type:"button","aria-haspopup":"dialog","aria-expanded":r.open,"aria-controls":r.contentId,"data-state":iF(r.open)},o),{},{ref:s,onClick:Qb(e.onClick,r.onOpenToggle)}));return r.hasCustomAnchor?a:(0,Ss.jsx)(QS,l(l({asChild:!0},i),{},{children:a}))}));qN.displayName=WN;var YN="PopoverPortal",[GN,XN]=zN(YN,{forceMount:void 0}),$N=e=>{const{__scopePopover:t,forceMount:n,children:o,container:r}=e,i=UN(YN,t);return(0,Ss.jsx)(GN,{scope:t,forceMount:n,children:(0,Ss.jsx)(ok,{present:n||i.open,children:(0,Ss.jsx)(nk,{asChild:!0,container:r,children:o})})})};$N.displayName=YN;var ZN="PopoverContent",QN=e.forwardRef(((e,t)=>{const n=XN(ZN,e.__scopePopover),{forceMount:o=n.forceMount}=e,r=yr(e,AN),i=UN(ZN,e.__scopePopover);return(0,Ss.jsx)(ok,{present:o||i.open,children:i.modal?(0,Ss.jsx)(JN,l(l({},r),{},{ref:t})):(0,Ss.jsx)(eF,l(l({},r),{},{ref:t}))})}));QN.displayName=ZN;var JN=e.forwardRef(((t,n)=>{const o=UN(ZN,t.__scopePopover),r=e.useRef(null),i=iw(n,r),s=e.useRef(!1);return e.useEffect((()=>{const e=r.current;if(e)return Ok(e)}),[]),(0,Ss.jsx)(PP,{as:lw,allowPinchZoom:!0,children:(0,Ss.jsx)(tF,l(l({},t),{},{ref:i,trapFocus:o.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:Qb(t.onCloseAutoFocus,(e=>{var t;e.preventDefault(),s.current||null===(t=o.triggerRef.current)||void 0===t||t.focus()})),onPointerDownOutside:Qb(t.onPointerDownOutside,(e=>{const t=e.detail.originalEvent,n=0===t.button&&!0===t.ctrlKey,o=2===t.button||n;s.current=o}),{checkForDefaultPrevented:!1}),onFocusOutside:Qb(t.onFocusOutside,(e=>e.preventDefault()),{checkForDefaultPrevented:!1})}))})})),eF=e.forwardRef(((t,n)=>{const o=UN(ZN,t.__scopePopover),r=e.useRef(!1),i=e.useRef(!1);return(0,Ss.jsx)(tF,l(l({},t),{},{ref:n,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:e=>{var n,s;(null===(n=t.onCloseAutoFocus)||void 0===n||n.call(t,e),e.defaultPrevented)||(r.current||null===(s=o.triggerRef.current)||void 0===s||s.focus(),e.preventDefault());r.current=!1,i.current=!1},onInteractOutside:e=>{var n,s;null===(n=t.onInteractOutside)||void 0===n||n.call(t,e),e.defaultPrevented||(r.current=!0,"pointerdown"===e.detail.originalEvent.type&&(i.current=!0));const a=e.target;(null===(s=o.triggerRef.current)||void 0===s?void 0:s.contains(a))&&e.preventDefault(),"focusin"===e.detail.originalEvent.type&&i.current&&e.preventDefault()}}))})),tF=e.forwardRef(((e,t)=>{const{__scopePopover:n,trapFocus:o,onOpenAutoFocus:r,onCloseAutoFocus:i,disableOutsidePointerEvents:s,onEscapeKeyDown:a,onPointerDownOutside:c,onFocusOutside:d,onInteractOutside:u}=e,h=yr(e,ON),p=UN(ZN,n),f=FN(n);return Ow(),(0,Ss.jsx)(Fw,{asChild:!0,loop:!0,trapped:o,onMountAutoFocus:r,onUnmountAutoFocus:i,children:(0,Ss.jsx)(_w,{asChild:!0,disableOutsidePointerEvents:s,onInteractOutside:u,onEscapeKeyDown:a,onPointerDownOutside:c,onFocusOutside:d,onDismiss:()=>p.onOpenChange(!1),children:(0,Ss.jsx)(JS,l(l(l({"data-state":iF(p.open),role:"dialog",id:p.contentId},f),h),{},{ref:t,style:l(l({},h.style),{"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"})}))})})})),nF="PopoverClose",oF=e.forwardRef(((e,t)=>{const{__scopePopover:n}=e,o=yr(e,DN),r=UN(nF,n);return(0,Ss.jsx)(pw.button,l(l({type:"button"},o),{},{ref:t,onClick:Qb(e.onClick,(()=>r.onOpenChange(!1)))}))}));oF.displayName=nF;var rF=e.forwardRef(((e,t)=>{const{__scopePopover:n}=e,o=yr(e,RN),r=FN(n);return(0,Ss.jsx)(ek,l(l(l({},r),o),{},{ref:t}))}));function iF(e){return e?"open":"closed"}rF.displayName="PopoverArrow";var sF=HN,aF=qN,lF=$N,cF=QN;function dF(e){let{id:t,children:n,onOpenChange:o,open:r}=e;const[i,s]=oA(t,o);return(0,Ss.jsx)(sF,{onOpenChange:s,open:r||i,children:(0,Ss.jsx)("div",{className:"tlui-popover",children:n})})}function uF(e){let{children:t}=e;return(0,Ss.jsx)(aF,{asChild:!0,dir:"ltr",children:t})}function hF(e){let{side:t,children:n,align:o="center",sideOffset:r=8,alignOffset:i=0,disableEscapeKeyDown:s=!1}=e;const a=Va();return(0,Ss.jsx)(lF,{container:a,children:(0,Ss.jsx)(cF,{className:"tlui-popover__content",side:t,sideOffset:r,align:o,alignOffset:i,dir:"ltr",onEscapeKeyDown:e=>s&&e.preventDefault(),children:n})})}const pF=()=>{const e=Ns();return yn("threeStackableItems",(()=>function(e){return e.getSelectedShapeIds().map((t=>e.getShape(t))).filter((t=>{if(!t)return!1;if(e.isShapeOfType(t,"arrow")){const n=oO(e,t);if(n.start||n.end)return!1}return!0}))}(e).length>2),[e])},fF=()=>{const e=Ns();return yn("isInSelectState",(()=>e.isIn("select")),[e])},gF=()=>{const e=Ns();return yn("allow group",(()=>{const t=e.getSelectedShapes();if(t.length<2)return!1;for(const n of t)if(e.isShapeOfType(n,"arrow")){const o=oO(e,n);if(o.start&&!t.some((e=>e.id===o.start.toId)))return!1;if(o.end&&!t.some((e=>e.id===o.end.toId)))return!1}return!0}),[e])},mF=()=>{const e=Ns();return yn("allowUngroup",(()=>e.getSelectedShapeIds().some((t=>{var n;return"group"===(null===(n=e.getShape(t))||void 0===n?void 0:n.type)}))),[e])},yF="undefined"!==typeof window&&"navigator"in window&&Boolean(navigator.clipboard)&&Boolean(navigator.clipboard.read);function vF(e,t){const n=Ns();return yn("selectedShapes",(()=>{const o=n.getSelectedShapes().length;return void 0===e?void 0===t?o:o<=t:void 0===t?o>=e:o>=e&&o<=t}),[n,e,t])}function bF(e,t){const n=Ns();return yn("selectedShapes",(()=>{const o=n.getSelectedShapes().filter((e=>!n.isShapeOrAncestorLocked(e))).length;return void 0===e?void 0===t?o:o<=t:void 0===t?o>=e:o>=e&&o<=t}),[n])}function wF(){const e=Ns();return yn("hasLinkShapeSelected",(()=>{const t=e.getOnlySelectedShape();return!(!t||"embed"===t.type||!("url"in t.props)||t.isLocked)}),[e])}function xF(){const e=Ns();return yn("useCanRedo",(()=>e.getCanRedo()),[e])}function SF(){const e=Ns();return yn("useCanUndo",(()=>e.getCanUndo()),[e])}function kF(){return(0,Ss.jsxs)(Ss.Fragment,{children:[(0,Ss.jsx)(PF,{}),(0,Ss.jsx)(CF,{}),(0,Ss.jsx)(_F,{}),(0,Ss.jsx)(IF,{}),(0,Ss.jsx)(EF,{}),(0,Ss.jsx)(MF,{}),(0,Ss.jsx)(AF,{}),(0,Ss.jsx)(OF,{})]})}function PF(){const e=bF(2),t=fF(),n=e&&t;return(0,Ss.jsxs)(Ss.Fragment,{children:[(0,Ss.jsx)(EA,{actionId:"align-left",disabled:!n}),(0,Ss.jsx)(EA,{actionId:"align-center-horizontal",disabled:!n}),(0,Ss.jsx)(EA,{actionId:"align-right",disabled:!n}),(0,Ss.jsx)(EA,{actionId:"stretch-horizontal",disabled:!n}),(0,Ss.jsx)(EA,{actionId:"align-top",disabled:!n}),(0,Ss.jsx)(EA,{actionId:"align-center-vertical",disabled:!n}),(0,Ss.jsx)(EA,{actionId:"align-bottom",disabled:!n}),(0,Ss.jsx)(EA,{actionId:"stretch-vertical",disabled:!n})]})}function CF(){const e=bF(3),t=fF(),n=e&&t;return(0,Ss.jsxs)(Ss.Fragment,{children:[(0,Ss.jsx)(EA,{actionId:"distribute-horizontal",disabled:!n}),(0,Ss.jsx)(EA,{actionId:"distribute-vertical",disabled:!n})]})}function _F(){const e=pF(),t=fF(),n=e&&t;return(0,Ss.jsxs)(Ss.Fragment,{children:[(0,Ss.jsx)(EA,{actionId:"stack-horizontal",disabled:!n}),(0,Ss.jsx)(EA,{actionId:"stack-vertical",disabled:!n})]})}function IF(){const e=bF(1),t=fF(),n=e&&t;return(0,Ss.jsxs)(Ss.Fragment,{children:[(0,Ss.jsx)(EA,{actionId:"send-to-back",disabled:!n}),(0,Ss.jsx)(EA,{actionId:"send-backward",disabled:!n}),(0,Ss.jsx)(EA,{actionId:"bring-forward",disabled:!n}),(0,Ss.jsx)(EA,{actionId:"bring-to-front",disabled:!n})]})}function EF(){return kj()<wj.TABLET_SM?(0,Ss.jsx)(jF,{}):(0,Ss.jsx)(TF,{})}function jF(){const e=Ns(),t=yn("zoom is 1",(()=>1===e.getZoomLevel()),[e]);return(0,Ss.jsx)(EA,{actionId:"zoom-to-100",disabled:t})}function TF(){const e=bF(1),t=fF(),n=e&&t;return(0,Ss.jsx)(EA,{actionId:"rotate-ccw",disabled:!n})}function MF(){const e=bF(1),t=fF(),n=e&&t;return(0,Ss.jsx)(EA,{actionId:"rotate-cw",disabled:!n})}function AF(){const e=wF(),t=fF(),n=e&&t;return(0,Ss.jsx)(EA,{actionId:"edit-link",disabled:!n})}function OF(){const e=gF(),t=mF();return e?(0,Ss.jsx)(DF,{}):t?(0,Ss.jsx)(RF,{}):(0,Ss.jsx)(DF,{})}function DF(){const e=bF(2),t=fF(),n=e&&t;return(0,Ss.jsx)(EA,{actionId:"group",disabled:!n})}function RF(){return(0,Ss.jsx)(EA,{actionId:"ungroup"})}const LF=(0,e.memo)((function(t){let{children:n}=t;const o=rE(),r=kj(),i=YM(),s=(0,e.useRef)(null);cb(s);const a=Ns(),l=yn("should display quick actions when in readonly",(()=>a.isInAny("hand","zoom")),[a]),c=null!==n&&void 0!==n?n:(0,Ss.jsx)(kF,{});if(!i||l)return(0,Ss.jsxs)(dF,{id:"actions-menu",children:[(0,Ss.jsx)(uF,{children:(0,Ss.jsx)(sE,{type:"icon","data-testid":"actions-menu.button",title:o("actions-menu.title"),children:(0,Ss.jsx)(ej,{icon:"dots-vertical",small:!0})})}),(0,Ss.jsx)(hF,{side:r>=wj.TABLET?"bottom":"top",sideOffset:6,children:(0,Ss.jsx)("div",{ref:s,className:"tlui-actions-menu tlui-buttons__grid","data-testid":"actions-menu.content",children:(0,Ss.jsx)(tA,{type:"icons",sourceId:"actions-menu",children:c})})})]})}));function zF(){return function(){const e=Ns();return yn("showAutoSizeToggle",(()=>{const t=e.getSelectedShapes();return 1===t.length&&e.isShapeOfType(t[0],"text")&&!1===t[0].props.autoSize}),[e])}()?(0,Ss.jsx)(EA,{actionId:"toggle-auto-size"}):null}function NF(){return wF()?(0,Ss.jsx)(EA,{actionId:"edit-link"}):null}function FF(){return bF(1)?(0,Ss.jsx)(EA,{actionId:"duplicate"}):null}function BF(){const e=Ns();return yn("should display flatten option",(()=>{if(0===e.getSelectedShapeIds().length)return!1;const t=e.getOnlySelectedShape();return!t||!e.isShapeOfType(t,"image")}),[e])?(0,Ss.jsx)(EA,{actionId:"flatten-to-image"}):null}function UF(){return gF()?(0,Ss.jsx)(EA,{actionId:"group"}):null}function HF(){return mF()?(0,Ss.jsx)(EA,{actionId:"ungroup"}):null}function KF(){const e=Ns();return yn("allow unframe",(()=>{const t=e.getSelectedShapes();return 0!==t.length&&t.every((t=>e.isShapeOfType(t,"frame")))}),[e])?(0,Ss.jsx)(EA,{actionId:"remove-frame"}):null}function VF(){const e=Ns();return yn("allow fit frame to content",(()=>{const t=e.getOnlySelectedShape();return!!t&&(e.isShapeOfType(t,"frame")&&e.getSortedChildIdsForParent(t).length>0)}),[e])?(0,Ss.jsx)(EA,{actionId:"fit-frame-to-content"}):null}function WF(){const e=Ns();return yn("selected shapes",(()=>e.getSelectedShapes().length>0),[e])?(0,Ss.jsx)(EA,{actionId:"toggle-lock"}):null}function qF(){const e=Ns(),t=yn("isTransparentBg",(()=>!e.getInstanceState().exportBackground),[e]);return(0,Ss.jsx)(PA,{actionId:"toggle-transparent",checked:t,toggle:!0})}function YF(){const e=Ns(),t=yn("any shapes",(()=>e.getCurrentPageShapeIds().size>0),[e]);return(0,Ss.jsx)(EA,{actionId:"unlock-all",disabled:!t})}function GF(){const e=Ns(),t=yn("zoomed to 100",(()=>1===e.getZoomLevel()),[e]);return(0,Ss.jsx)(EA,{actionId:"zoom-to-100",noClose:!0,disabled:t})}function XF(){const e=Ns(),t=yn("has shapes",(()=>e.getCurrentPageShapeIds().size>0),[e]);return(0,Ss.jsx)(EA,{actionId:"zoom-to-fit",disabled:!t,"data-testid":"minimap.zoom-menu.zoom-to-fit",noClose:!0})}function $F(){const e=Ns(),t=yn("has shapes",(()=>e.getSelectedShapeIds().length>0),[e]);return(0,Ss.jsx)(EA,{actionId:"zoom-to-selection",disabled:!t,"data-testid":"minimap.zoom-menu.zoom-to-selection",noClose:!0})}function ZF(){return(0,Ss.jsxs)(pA,{id:"clipboard",children:[(0,Ss.jsx)(JF,{}),(0,Ss.jsx)(eB,{}),(0,Ss.jsx)(tB,{}),(0,Ss.jsx)(FF,{}),(0,Ss.jsx)(rB,{})]})}function QF(){var e;const t=Ns(),n=yn("atLeastOneShapeOnPage",(()=>t.getCurrentPageShapeIds().size>0),[t]);return(0,Ss.jsxs)(fA,{id:"copy-as",label:"context-menu.copy-as",size:"small",disabled:!n,children:[(0,Ss.jsxs)(pA,{id:"copy-as-group",children:[(0,Ss.jsx)(EA,{actionId:"copy-as-svg"}),Boolean(null===(e=window.navigator.clipboard)||void 0===e?void 0:e.write)&&(0,Ss.jsx)(EA,{actionId:"copy-as-png"}),(0,Ss.jsx)(EA,{actionId:"copy-as-json"})]}),(0,Ss.jsx)(pA,{id:"copy-as-bg",children:(0,Ss.jsx)(qF,{})})]})}function JF(){const e=bF(1);return(0,Ss.jsx)(EA,{actionId:"cut",disabled:!e})}function eB(){const e=vF(1);return(0,Ss.jsx)(EA,{actionId:"copy",disabled:!e})}function tB(){const e=yF;return(0,Ss.jsx)(EA,{actionId:"paste",disabled:!e})}function nB(){const e=Ns();return yn("atLeastOneShapeOnPage",(()=>e.getCurrentPageShapeIds().size>0),[e])?(0,Ss.jsxs)(pA,{id:"conversions",children:[(0,Ss.jsx)(QF,{}),(0,Ss.jsxs)(fA,{id:"export-as",label:"context-menu.export-as",size:"small",children:[(0,Ss.jsxs)(pA,{id:"export-as-group",children:[(0,Ss.jsx)(EA,{actionId:"export-as-svg"}),(0,Ss.jsx)(EA,{actionId:"export-as-png"}),(0,Ss.jsx)(EA,{actionId:"export-as-json"})]}),(0,Ss.jsx)(pA,{id:"export-as-bg",children:(0,Ss.jsx)(qF,{})})]})]}):null}function oB(){const e=Ns(),t=yn("atLeastOneShapeOnPage",(()=>e.getCurrentPageShapeIds().size>0),[e]);return(0,Ss.jsx)(EA,{actionId:"select-all",disabled:!t})}function rB(){const e=bF(1);return(0,Ss.jsx)(EA,{actionId:"delete",disabled:!e})}function iB(){const e=YM();return vF(1)?e?null:(0,Ss.jsxs)(fA,{id:"edit",label:"context-menu.edit",size:"small",children:[(0,Ss.jsx)(UF,{}),(0,Ss.jsx)(HF,{}),(0,Ss.jsx)(BF,{}),(0,Ss.jsx)(NF,{}),(0,Ss.jsx)(VF,{}),(0,Ss.jsx)(KF,{}),(0,Ss.jsx)(hB,{}),(0,Ss.jsx)(uB,{}),(0,Ss.jsx)(zF,{}),(0,Ss.jsx)(WF,{})]}):null}function sB(){const e=bF(2),t=function(){const e=Ns();return yn("onlyFlippableShape",(()=>{const t=e.getOnlySelectedShape();return t&&(e.isShapeOfType(t,"group")||e.isShapeOfType(t,"image")||e.isShapeOfType(t,"arrow")||e.isShapeOfType(t,"line")||e.isShapeOfType(t,"draw"))}),[e])}();return YM()?null:e||t?(0,Ss.jsxs)(fA,{id:"arrange",label:"context-menu.arrange",size:"small",children:[e&&(0,Ss.jsxs)(pA,{id:"align",children:[(0,Ss.jsx)(EA,{actionId:"align-left"}),(0,Ss.jsx)(EA,{actionId:"align-center-horizontal"}),(0,Ss.jsx)(EA,{actionId:"align-right"}),(0,Ss.jsx)(EA,{actionId:"align-top"}),(0,Ss.jsx)(EA,{actionId:"align-center-vertical"}),(0,Ss.jsx)(EA,{actionId:"align-bottom"})]}),(0,Ss.jsx)(aB,{}),e&&(0,Ss.jsxs)(pA,{id:"stretch",children:[(0,Ss.jsx)(EA,{actionId:"stretch-horizontal"}),(0,Ss.jsx)(EA,{actionId:"stretch-vertical"})]}),(e||t)&&(0,Ss.jsxs)(pA,{id:"flip",children:[(0,Ss.jsx)(EA,{actionId:"flip-horizontal"}),(0,Ss.jsx)(EA,{actionId:"flip-vertical"})]}),(0,Ss.jsx)(lB,{})]}):null}function aB(){return bF(3)?(0,Ss.jsxs)(pA,{id:"distribute",children:[(0,Ss.jsx)(EA,{actionId:"distribute-horizontal"}),(0,Ss.jsx)(EA,{actionId:"distribute-vertical"})]}):null}function lB(){const e=bF(2),t=pF();return e?(0,Ss.jsxs)(pA,{id:"order",children:[(0,Ss.jsx)(EA,{actionId:"pack"}),t&&(0,Ss.jsx)(EA,{actionId:"stack-horizontal"}),t&&(0,Ss.jsx)(EA,{actionId:"stack-vertical"})]}):null}function cB(){const e=YM(),t=bF(1);return e?null:t?(0,Ss.jsx)(fA,{id:"reorder",label:"context-menu.reorder",size:"small",children:(0,Ss.jsxs)(pA,{id:"reorder",children:[(0,Ss.jsx)(EA,{actionId:"bring-to-front"}),(0,Ss.jsx)(EA,{actionId:"bring-forward"}),(0,Ss.jsx)(EA,{actionId:"send-backward"}),(0,Ss.jsx)(EA,{actionId:"send-to-back"})]})}):null}function dB(){const e=Ns(),t=yn("pages",(()=>e.getPages()),[e]),n=yn("current page id",(()=>e.getCurrentPageId()),[e]),{addToast:o}=CT(),r=Zb(),i=YM();return bF(1)?i?null:(0,Ss.jsxs)(fA,{id:"move-to-page",label:"context-menu.move-to-page",size:"small",children:[(0,Ss.jsx)(pA,{id:"pages",children:t.map((t=>(0,Ss.jsx)(_A,{id:t.id,disabled:n===t.id,label:t.name.length>30?"".concat(t.name.slice(0,30),"\u2026"):t.name,onSelect:()=>{e.markHistoryStoppingPoint("move_shapes_to_page"),e.moveShapesToPage(e.getSelectedShapeIds(),t.id);const i=e.getPage(t.id);i&&o({title:"Changed Page",description:"Moved to ".concat(i.name,"."),actions:[{label:"Go Back",type:"primary",onClick:()=>{e.markHistoryStoppingPoint("change-page"),e.setCurrentPage(n)}}]}),r("move-to-page",{source:"context-menu"})}},t.id)))}),(0,Ss.jsx)(pA,{id:"new-page",children:(0,Ss.jsx)(EA,{actionId:"move-to-new-page"})})]}):null}function uB(){const e=Ns();return yn("oneEmbedSelected",(()=>{const t=e.getOnlySelectedShape();return!!t&&!(!e.isShapeOfType(t,"embed")||!t.props.url||e.isShapeOrAncestorLocked(t))}),[e])?(0,Ss.jsx)(EA,{actionId:"convert-to-bookmark"}):null}function hB(){const e=Ns(),t=gj();return yn("oneEmbeddableBookmarkSelected",(()=>{const n=e.getOnlySelectedShape();return!!n&&!(!(e.isShapeOfType(n,"bookmark")&&n.props.url&&t(n.props.url))||e.isShapeOrAncestorLocked(n))}),[e])?(0,Ss.jsx)(EA,{actionId:"convert-to-embed"}):null}function pB(){const e=Ns(),t=yn("isSnapMode",(()=>e.user.getIsSnapMode()),[e]);return(0,Ss.jsx)(PA,{actionId:"toggle-snap-mode",checked:t})}function fB(){const e=Ns(),t=yn("isToolLock",(()=>e.getInstanceState().isToolLocked),[e]);return(0,Ss.jsx)(PA,{actionId:"toggle-tool-lock",checked:t})}function gB(){const e=Ns(),t=yn("isGridMode",(()=>e.getInstanceState().isGridMode),[e]);return(0,Ss.jsx)(PA,{actionId:"toggle-grid",checked:t})}function mB(){const e=Ns(),t=yn("isWrapMode",(()=>e.user.getIsWrapMode()),[e]);return(0,Ss.jsx)(PA,{actionId:"toggle-wrap-mode",checked:t})}function yB(){const e=Ns(),t=yn("isFocusMode",(()=>e.getInstanceState().isFocusMode),[e]);return(0,Ss.jsx)(PA,{actionId:"toggle-focus-mode",checked:t})}function vB(){const e=Ns(),t=yn("edgeScrollSpeed",(()=>e.user.getEdgeScrollSpeed()),[e]);return(0,Ss.jsx)(PA,{actionId:"toggle-edge-scrolling",checked:1===t})}function bB(){const e=Ns(),t=yn("animationSpeed",(()=>e.user.getAnimationSpeed()),[e]);return(0,Ss.jsx)(PA,{actionId:"toggle-reduce-motion",checked:0===t})}function wB(){const e=Ns(),t=yn("isDebugMode",(()=>e.getInstanceState().isDebugMode),[e]);return(0,Ss.jsx)(PA,{actionId:"toggle-debug-mode",checked:t})}function xB(){const e=Ns(),t=yn("dynamic resize",(()=>e.user.getIsDynamicResizeMode()),[e]);return(0,Ss.jsx)(PA,{actionId:"toggle-dynamic-size-mode",checked:t})}function SB(){const e=Ns(),t=yn("paste at cursor",(()=>e.user.getIsPasteAtCursorMode()),[e]);return(0,Ss.jsx)(PA,{actionId:"toggle-paste-at-cursor",checked:t})}function kB(){const e=Ns();return yn("show cursor chat",(()=>"select"===e.getCurrentToolId()&&!e.getInstanceState().isCoarsePointer),[e])?(0,Ss.jsx)(EA,{actionId:"open-cursor-chat"}):null}function PB(){const e=Ns(),t=vj(),n=yn("isSelectToolActive",(()=>"select"===e.getCurrentToolId()),[e]),o=yn("isSinglePageMode",(()=>e.options.maxPages<=1),[e]);return n?(0,Ss.jsxs)(Ss.Fragment,{children:[t&&(0,Ss.jsx)(kB,{}),(0,Ss.jsxs)(pA,{id:"modify",children:[(0,Ss.jsx)(iB,{}),(0,Ss.jsx)(sB,{}),(0,Ss.jsx)(cB,{}),!o&&(0,Ss.jsx)(dB,{})]}),(0,Ss.jsx)(ZF,{}),(0,Ss.jsx)(nB,{}),(0,Ss.jsx)(pA,{id:"select-all",children:(0,Ss.jsx)(oB,{})})]}):null}const CB=(0,e.memo)((function(t){let{children:n,disabled:o=!1}=t;const r=Ns(),{Canvas:i}=md(),s=(0,e.useCallback)((e=>{if(e){if(r.getInstanceState().isCoarsePointer){const e=r.getSelectedShapes(),{inputs:{currentPagePoint:t}}=r,n=r.getShapesAtPoint(t);if(!r.getSelectedShapes().length||!n.some((t=>e.includes(t)))){const e=n.filter((e=>r.isShapeOrAncestorLocked(e)));e.length&&r.select(...e.map((e=>e.id)))}}}else{const e=r.getOnlySelectedShape();e&&r.isShapeOrAncestorLocked(e)&&r.setSelectedShapes([])}}),[r]),a=Va(),[l,c]=oA("context menu",s),d=null!==n&&void 0!==n?n:(0,Ss.jsx)(PB,{});return(0,Ss.jsxs)(Y_,{dir:"ltr",onOpenChange:c,modal:!1,children:[(0,Ss.jsx)(G_,{onContextMenu:void 0,dir:"ltr",disabled:o,children:i?(0,Ss.jsx)(i,{}):null}),l&&(0,Ss.jsx)(X_,{container:a,children:(0,Ss.jsx)($_,{className:"tlui-menu scrollable","data-testid":"context-menu",alignOffset:-4,collisionPadding:4,onContextMenu:Da,children:(0,Ss.jsx)(tA,{type:"context-menu",sourceId:"context-menu",children:d})})})]})})),_B=fn((function(){const t=Ns(),{isChatting:n,chatMessage:o}=t.getInstanceState(),r=(0,e.useRef)(-1),[i,s]=(0,e.useState)("");return(0,e.useEffect)((()=>{if(!n&&o||n){const e=n?5e3:2e3;r.current=t.timers.setTimeout((()=>{t.updateInstanceState({chatMessage:"",isChatting:!1}),s(""),t.focus()}),e)}return()=>{clearTimeout(r.current)}}),[t,o,n]),n?(0,Ss.jsx)(jB,{value:i,setValue:s,chatMessage:o}):o.trim()?(0,Ss.jsx)(EB,{chatMessage:o}):null}));function IB(t){const n=Ns();(0,e.useLayoutEffect)((()=>{var e;if(!t.current)return;const{x:o,y:r}=n.inputs.currentScreenPoint;function i(e){var o;const{minX:r,minY:i}=n.getViewportScreenBounds();null===(o=t.current)||void 0===o||o.style.setProperty("transform","translate(".concat(e.clientX-r,"px, ").concat(e.clientY-i,"px)"))}return null===(e=t.current)||void 0===e||e.style.setProperty("transform","translate(".concat(o,"px, ").concat(r,"px)")),window.addEventListener("pointermove",i),()=>{window.removeEventListener("pointermove",i)}}),[t,n])}const EB=t=>{let{chatMessage:n}=t;const o=Ns(),r=(0,e.useRef)(null);return IB(r),(0,Ss.jsx)("div",{ref:r,className:"tl-cursor-chat tl-cursor-chat__bubble",style:{backgroundColor:o.user.getColor()},children:n})},jB=fn((function(t){let{chatMessage:n,value:o,setValue:r}=t;const i=Ns(),s=rE(),a=(0,e.useRef)(null),l=n||s("cursor-chat.type-to-chat");IB(a),(0,e.useLayoutEffect)((()=>{const e=a.current;if(!e)return;const t=i.textMeasure.measureText(o||l,{fontFamily:"var(--font-body)",fontSize:12,fontWeight:"500",fontStyle:"normal",maxWidth:null,lineHeight:1,padding:"6px"});e.style.setProperty("width",t.w+"px")}),[i,o,l]),(0,e.useLayoutEffect)((()=>{const e=i.timers.requestAnimationFrame((()=>{var e;null===(e=a.current)||void 0===e||e.focus()}));return()=>{cancelAnimationFrame(e)}}),[i]);const c=(0,e.useCallback)((()=>{i.updateInstanceState({isChatting:!1}),i.focus()}),[i]),d=(0,e.useCallback)((e=>{const{value:t}=e.target;r(t.slice(0,64)),i.updateInstanceState({chatMessage:t})}),[i,r]),u=(0,e.useCallback)((e=>{const t=a.current;if(!t)return;const{value:n}=t;switch(e.key){case"Enter":if(Da(e),e.stopPropagation(),!n)return void c();r("");break;case"Escape":Da(e),e.stopPropagation(),c()}}),[c,r]),h=(0,e.useCallback)((e=>{e.stopPropagation()}),[]);return(0,Ss.jsx)("input",{ref:a,className:"tl-cursor-chat",style:{backgroundColor:i.user.getColor()},onBlur:c,onChange:d,onKeyDown:u,onPaste:h,value:o,placeholder:l,spellCheck:!1})}));function TB(e){let{checked:t}=e;return(0,Ss.jsx)(JE,{icon:t?"check":"none",className:"tlui-button__icon",small:!0})}function MB(){const t=Ns(),{addToast:n}=CT(),{addDialog:o}=_j(),[r,i]=e.useState(!1);return(0,Ss.jsxs)(Ss.Fragment,{children:[(0,Ss.jsxs)(pA,{id:"items",children:[(0,Ss.jsx)(_A,{id:"add-toast",onSelect:()=>{n({id:$(),title:"Something good happened",description:"Hey, attend to this thing over here. It might be important!",keepOpen:!0,severity:"success"}),n({id:$(),title:"Something happened",description:"Hey, attend to this thing over here. It might be important!",keepOpen:!0,severity:"info",actions:[{label:"Primary",type:"primary",onClick:()=>{}},{label:"Normal",type:"normal",onClick:()=>{}},{label:"Danger",type:"danger",onClick:()=>{}}]}),n({id:$(),title:"Something maybe bad happened",description:"Hey, attend to this thing over here. It might be important!",keepOpen:!0,severity:"warning",actions:[{label:"Primary",type:"primary",onClick:()=>{}},{label:"Normal",type:"normal",onClick:()=>{}},{label:"Danger",type:"danger",onClick:()=>{}}]}),n({id:$(),title:"Something bad happened",severity:"error",keepOpen:!0})},label:"Show toast"}),(0,Ss.jsx)(_A,{id:"show-dialog",label:"Show dialog",onSelect:()=>{o({component:e=>{let{onClose:t}=e;return(0,Ss.jsx)(DB,{displayDontShowAgain:!0,onCancel:()=>t(),onContinue:()=>t()})},onClose:()=>{}})}}),(0,Ss.jsx)(_A,{id:"create-shapes",label:"Create 100 shapes",onSelect:()=>function(e,t){const n=Array(t),o=Math.floor(Math.sqrt(t));for(let r=0;r<t;r++)LB++,n[r]={id:Ko("box"+LB),type:"geo",x:r%o*132,y:132*Math.floor(r/o)};e.run((()=>{e.createShapes(n).setSelectedShapes(n.map((e=>e.id)))}))}(t,100)}),(0,Ss.jsx)(_A,{id:"count-nodes",label:"Count shapes / nodes",onSelect:()=>{var e;const n=t.getSelectedShapes(),o=0===n.length?t.getRenderingShapes():n;window.alert("Shapes ".concat(o.length,", DOM nodes:").concat(null===(e=document.querySelector(".tl-shapes").querySelectorAll("*"))||void 0===e?void 0:e.length))}}),(()=>{if(r)throw Error("oh no!");return null})(),(0,Ss.jsx)(_A,{id:"throw-error",onSelect:()=>i(!0),label:"Throw error"}),(0,Ss.jsx)(_A,{id:"hard-reset",onSelect:vd,label:"Hard reset"})]}),(0,Ss.jsxs)(pA,{id:"flags",children:[(0,Ss.jsx)(AB,{}),(0,Ss.jsx)(OB,{})]})]})}function AB(){const e=Object.values(Ta);return e.length?(0,Ss.jsx)(fA,{id:"debug flags",label:"Debug Flags",children:(0,Ss.jsx)(pA,{id:"debug flags",children:e.map((e=>(0,Ss.jsx)(RB,{flag:e},e.name)))})}):null}function OB(){const e=Object.values(Ea);return e.length?(0,Ss.jsx)(fA,{id:"feature flags",label:"Feature Flags",children:(0,Ss.jsx)(pA,{id:"feature flags",children:e.map((e=>(0,Ss.jsx)(RB,{flag:e},e.name)))})}):null}function DB(t){let{title:n="title",body:o="hello hello hello",cancel:r="Cancel",confirm:i="Continue",displayDontShowAgain:s=!1,onCancel:a,onContinue:l}=t;const[c,d]=e.useState(!1);return(0,Ss.jsxs)(Ss.Fragment,{children:[(0,Ss.jsxs)(tj,{children:[(0,Ss.jsx)(nj,{children:n}),(0,Ss.jsx)(oj,{})]}),(0,Ss.jsx)(rj,{style:{maxWidth:350},children:o}),(0,Ss.jsxs)(ij,{className:"tlui-dialog__footer__actions",children:[s&&(0,Ss.jsxs)(sE,{type:"normal",onClick:()=>d(!c),style:{marginRight:"auto"},children:[(0,Ss.jsx)(TB,{checked:c}),(0,Ss.jsx)(aE,{children:"Don\u2019t show again"})]}),(0,Ss.jsx)(sE,{type:"normal",onClick:a,children:(0,Ss.jsx)(aE,{children:r})}),(0,Ss.jsx)(sE,{type:"primary",onClick:async()=>l(),children:(0,Ss.jsx)(aE,{children:i})})]})]})}const RB=fn((function(e){let{flag:t,onChange:n}=e;const o=t.get();return(0,Ss.jsx)(nA,{id:t.name,title:t.name,label:t.name.replace(/([a-z0-9])([A-Z])/g,(e=>"".concat(e[0]," ").concat(e[1].toLowerCase()))).replace(/^[a-z]/,(e=>e.toUpperCase())),checked:o,onSelect:()=>{t.set(!o),null===n||void 0===n||n(!o)}})}));let LB=0;function zB(e){let{children:t}=e;const n=null!==t&&void 0!==t?t:(0,Ss.jsx)(MB,{});return(0,Ss.jsxs)(iA,{id:"debug",children:[(0,Ss.jsx)(sA,{children:(0,Ss.jsx)(sE,{type:"icon",title:"Debug menu",children:(0,Ss.jsx)(ej,{icon:"dots-horizontal"})})}),(0,Ss.jsx)(aA,{side:"top",align:"end",alignOffset:0,children:(0,Ss.jsx)(tA,{type:"menu",sourceId:"debug-panel",children:n})})]})}const NB=(0,e.memo)((function(){const{DebugMenu:t}=CV(),n=(0,e.useRef)(null);return cb(n),(0,Ss.jsxs)("div",{ref:n,className:"tlui-debug-panel",children:[(0,Ss.jsx)(FB,{}),(0,Ss.jsx)(BB,{}),t&&(0,Ss.jsx)(t,{})]})}));const FB=fn((function(){!function(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const[n,o]=(0,e.useState)(0),r=Ns();(0,e.useEffect)((()=>{if(!t)return;const e=()=>o((e=>e+1));return r.on("tick",e),()=>{r.off("tick",e)}}),[r,t])}();const t=Ns(),n=t.getPath(),o=t.getHoveredShape(),r=t.getOnlySelectedShape(),i="select.idle"!==n&&n.includes("select.")?r:o,s=i&&n.includes("select.")?" / ".concat(i.type||"").concat("geo"in i.props?" / "+i.props.geo:""," / [").concat(Vs.ToInt(t.getPointInShapeSpace(i,t.inputs.currentPagePoint)),"]"):"",a=n.startsWith("select.")&&!n.includes(".idle")?" / [".concat(Vs.ToInt(t.inputs.originPagePoint),"] \u2192 [").concat(Vs.ToInt(t.inputs.currentPagePoint),"] = ").concat(Vs.Dist(t.inputs.originPagePoint,t.inputs.currentPagePoint).toFixed(0)):"";return(0,Ss.jsx)("div",{className:"tlui-debug-panel__current-state",children:"".concat(n).concat(s).concat(a)})}));function BB(){const t=Ns(),n=yn("show_fps",(()=>Ta.showFps.get()),[Ta]),o=(0,e.useRef)(null);return(0,e.useEffect)((()=>{if(!n)return;const e=250;let r=0,i=-1,s=performance.now(),a=0,l=0,c=!1;return function n(){if(l++,a=performance.now()-s,a>e){const t=Math.round(l*(e/a)*4);t>r&&(r=t);const n=.75*r;(t<n&&!c||t>=n&&c)&&(c=!c),o.current.innerHTML="FPS ".concat(t.toString()),o.current.className="tlui-debug-panel__fps"+(c?" tlui-debug-panel__fps__slow":""),a-=e,l=0,s=performance.now()}i=t.timers.requestAnimationFrame(n)}(),()=>{cancelAnimationFrame(i)}}),[n,t]),n?(0,Ss.jsx)("div",{ref:o}):null}const UB=(0,e.memo)((function(){const t=kj(),n=(0,e.useRef)(null);cb(n);const{MainMenu:o,QuickActions:r,ActionsMenu:i,PageMenu:s}=CV(),a=Ns(),l=yn("isSinglePageMode",(()=>a.options.maxPages<=1),[a]),c="menu"===a.options.actionShortcutsLocation||"toolbar"!==a.options.actionShortcutsLocation&&t>=wj.TABLET;return o||s||c?(0,Ss.jsx)("div",{ref:n,className:"tlui-menu-zone",children:(0,Ss.jsxs)("div",{className:"tlui-buttons__horizontal",children:[o&&(0,Ss.jsx)(o,{}),s&&!l&&(0,Ss.jsx)(s,{}),c?(0,Ss.jsxs)(Ss.Fragment,{children:[r&&(0,Ss.jsx)(r,{}),i&&(0,Ss.jsx)(i,{})]}):null]})}):null}));function HB(){const t=Ns(),n=WM(),[o,r]=(0,e.useState)(!1),i=(0,e.useRef)(!1);return mn("toggle showback to content",(()=>{const e=i.current,n=t.getCurrentPageShapeIds();let o=!1;n.size&&(o=n.size===t.getCulledShapes().size),e!==o&&(r(o),i.current=o)}),[t]),o?(0,Ss.jsx)(EA,{actionId:"back-to-content",onSelect:()=>{n["back-to-content"].onSelect("helper-buttons"),r(!1)}}):null}function KB(){const e=Ns();return yn("is pen mode",(()=>e.getInstanceState().isPenMode),[e])?(0,Ss.jsx)(EA,{actionId:"exit-pen-mode"}):null}function VB(){const e=Ns(),t=WM();return yn("is following user",(()=>!!e.getInstanceState().followingUserId),[e])?(0,Ss.jsx)(_A,l({},t["stop-following"])):null}function WB(){return(0,Ss.jsxs)(Ss.Fragment,{children:[(0,Ss.jsx)(KB,{}),(0,Ss.jsx)(HB,{}),(0,Ss.jsx)(VB,{})]})}function qB(e){let{children:t}=e;const n=null!==t&&void 0!==t?t:(0,Ss.jsx)(WB,{});return(0,Ss.jsx)("div",{className:"tlui-helper-buttons",children:(0,Ss.jsx)(tA,{type:"helper-buttons",sourceId:"helper-buttons",children:n})})}function YB(){const e=vj();return(0,Ss.jsxs)(Ss.Fragment,{children:[(0,Ss.jsxs)(pA,{label:"shortcuts-dialog.tools",id:"tools",children:[(0,Ss.jsx)(EA,{actionId:"toggle-tool-lock"}),(0,Ss.jsx)(EA,{actionId:"insert-media"}),(0,Ss.jsx)(OA,{toolId:"select"}),(0,Ss.jsx)(OA,{toolId:"draw"}),(0,Ss.jsx)(OA,{toolId:"eraser"}),(0,Ss.jsx)(OA,{toolId:"hand"}),(0,Ss.jsx)(OA,{toolId:"rectangle"}),(0,Ss.jsx)(OA,{toolId:"ellipse"}),(0,Ss.jsx)(OA,{toolId:"arrow"}),(0,Ss.jsx)(OA,{toolId:"line"}),(0,Ss.jsx)(OA,{toolId:"text"}),(0,Ss.jsx)(OA,{toolId:"frame"}),(0,Ss.jsx)(OA,{toolId:"note"}),(0,Ss.jsx)(OA,{toolId:"laser"}),(0,Ss.jsx)(_A,{id:"pointer-down",label:"tool.pointer-down",kbd:",",onSelect:()=>{}})]}),(0,Ss.jsxs)(pA,{label:"shortcuts-dialog.preferences",id:"preferences",children:[(0,Ss.jsx)(EA,{actionId:"toggle-dark-mode"}),(0,Ss.jsx)(EA,{actionId:"toggle-focus-mode"}),(0,Ss.jsx)(EA,{actionId:"toggle-grid"})]}),(0,Ss.jsxs)(pA,{label:"shortcuts-dialog.edit",id:"edit",children:[(0,Ss.jsx)(EA,{actionId:"undo"}),(0,Ss.jsx)(EA,{actionId:"redo"}),(0,Ss.jsx)(EA,{actionId:"cut"}),(0,Ss.jsx)(EA,{actionId:"copy"}),(0,Ss.jsx)(EA,{actionId:"paste"}),(0,Ss.jsx)(EA,{actionId:"select-all"}),(0,Ss.jsx)(EA,{actionId:"delete"}),(0,Ss.jsx)(EA,{actionId:"duplicate"})]}),(0,Ss.jsxs)(pA,{label:"shortcuts-dialog.view",id:"view",children:[(0,Ss.jsx)(EA,{actionId:"zoom-in"}),(0,Ss.jsx)(EA,{actionId:"zoom-out"}),(0,Ss.jsx)(EA,{actionId:"zoom-to-100"}),(0,Ss.jsx)(EA,{actionId:"zoom-to-fit"}),(0,Ss.jsx)(EA,{actionId:"zoom-to-selection"})]}),(0,Ss.jsxs)(pA,{label:"shortcuts-dialog.transform",id:"transform",children:[(0,Ss.jsx)(EA,{actionId:"bring-to-front"}),(0,Ss.jsx)(EA,{actionId:"bring-forward"}),(0,Ss.jsx)(EA,{actionId:"send-backward"}),(0,Ss.jsx)(EA,{actionId:"send-to-back"}),(0,Ss.jsx)(EA,{actionId:"group"}),(0,Ss.jsx)(EA,{actionId:"ungroup"}),(0,Ss.jsx)(EA,{actionId:"flip-horizontal"}),(0,Ss.jsx)(EA,{actionId:"flip-vertical"}),(0,Ss.jsx)(EA,{actionId:"align-top"}),(0,Ss.jsx)(EA,{actionId:"align-center-vertical"}),(0,Ss.jsx)(EA,{actionId:"align-bottom"}),(0,Ss.jsx)(EA,{actionId:"align-left"}),(0,Ss.jsx)(EA,{actionId:"align-center-horizontal"}),(0,Ss.jsx)(EA,{actionId:"align-right"})]}),e&&(0,Ss.jsx)(pA,{label:"shortcuts-dialog.collaboration",id:"collaboration",children:(0,Ss.jsx)(EA,{actionId:"open-cursor-chat"})})]})}const GB=(0,e.memo)((function(e){let{children:t}=e;const n=rE(),o=kj(),r=null!==t&&void 0!==t?t:(0,Ss.jsx)(YB,{});return(0,Ss.jsxs)(Ss.Fragment,{children:[(0,Ss.jsxs)(tj,{className:"tlui-shortcuts-dialog__header",children:[(0,Ss.jsx)(nj,{children:n("shortcuts-dialog.title")}),(0,Ss.jsx)(oj,{})]}),(0,Ss.jsx)(rj,{className:ks("tlui-shortcuts-dialog__body",{"tlui-shortcuts-dialog__body__mobile":o<=wj.MOBILE_XS,"tlui-shortcuts-dialog__body__tablet":o<=wj.TABLET}),children:(0,Ss.jsx)(tA,{type:"keyboard-shortcuts",sourceId:"kbd",children:r})}),(0,Ss.jsx)("div",{className:"tlui-dialog__scrim"})]})}));function XB(){const e=Fs(),t=Zb(),n=yn("locale",(()=>null===e||void 0===e?void 0:e.user.getLocale()),[e]);return e?(0,Ss.jsx)(fA,{id:"help menu language",label:"menu.language",children:(0,Ss.jsx)(pA,{id:"languages",children:bs.map((o=>{let{locale:r,label:i}=o;return(0,Ss.jsx)(nA,{id:"language-".concat(r),title:r,label:i,checked:r===n,readonlyOk:!0,onSelect:()=>{e.user.updateUserPreferences({locale:r}),t("change-language",{source:"menu",locale:r})}},r)}))})}):null}function $B(){return(0,Ss.jsxs)(Ss.Fragment,{children:[(0,Ss.jsx)(XB,{}),(0,Ss.jsx)(ZB,{})]})}function ZB(){const{KeyboardShortcutsDialog:t}=CV(),{addDialog:n}=_j(),o=(0,e.useCallback)((()=>{t&&n({component:t})}),[n,t]);return t?(0,Ss.jsx)(_A,{id:"keyboard-shortcuts-button",label:"help-menu.keyboard-shortcuts",readonlyOk:!0,onSelect:o}):null}function QB(){return(0,Ss.jsxs)(Ss.Fragment,{children:[(0,Ss.jsx)(eU,{}),(0,Ss.jsx)(rU,{}),(0,Ss.jsx)(JB,{}),(0,Ss.jsx)(iU,{}),(0,Ss.jsx)(sU,{})]})}function JB(){return(0,Ss.jsxs)(fA,{id:"export-all-as",label:"context-menu.export-all-as",size:"small",children:[(0,Ss.jsxs)(pA,{id:"export-all-as-group",children:[(0,Ss.jsx)(EA,{actionId:"export-all-as-svg"}),(0,Ss.jsx)(EA,{actionId:"export-all-as-png"}),(0,Ss.jsx)(EA,{actionId:"export-all-as-json"})]}),(0,Ss.jsx)(pA,{id:"export-all-as-bg",children:(0,Ss.jsx)(qF,{})})]})}function eU(){const e=Ns(),t=yn("isSelectToolActive",(()=>"select"===e.getCurrentToolId()),[e]);return(0,Ss.jsxs)(fA,{id:"edit",label:"menu.edit",disabled:!t,children:[(0,Ss.jsx)(oU,{}),(0,Ss.jsx)(ZF,{}),(0,Ss.jsx)(nB,{}),(0,Ss.jsx)(tU,{}),(0,Ss.jsx)(nU,{}),(0,Ss.jsx)(pA,{id:"select-all",children:(0,Ss.jsx)(oB,{})})]})}function tU(){return(0,Ss.jsxs)(pA,{id:"misc",children:[(0,Ss.jsx)(UF,{}),(0,Ss.jsx)(HF,{}),(0,Ss.jsx)(NF,{}),(0,Ss.jsx)(zF,{}),(0,Ss.jsx)(KF,{}),(0,Ss.jsx)(VF,{}),(0,Ss.jsx)(hB,{}),(0,Ss.jsx)(uB,{}),(0,Ss.jsx)(BF,{})]})}function nU(){return(0,Ss.jsxs)(pA,{id:"lock",children:[(0,Ss.jsx)(WF,{}),(0,Ss.jsx)(YF,{})]})}function oU(){const e=SF(),t=xF();return(0,Ss.jsxs)(pA,{id:"undo-redo",children:[(0,Ss.jsx)(EA,{actionId:"undo",disabled:!e}),(0,Ss.jsx)(EA,{actionId:"redo",disabled:!t})]})}function rU(){return(0,Ss.jsx)(fA,{id:"view",label:"menu.view",children:(0,Ss.jsxs)(pA,{id:"view-actions",children:[(0,Ss.jsx)(EA,{actionId:"zoom-in"}),(0,Ss.jsx)(EA,{actionId:"zoom-out"}),(0,Ss.jsx)(GF,{}),(0,Ss.jsx)(XF,{}),(0,Ss.jsx)($F,{})]})})}function iU(){return(0,Ss.jsxs)(pA,{id:"extras",children:[(0,Ss.jsx)(EA,{actionId:"insert-embed"}),(0,Ss.jsx)(EA,{actionId:"insert-media"})]})}function sU(){return(0,Ss.jsxs)(pA,{id:"preferences",children:[(0,Ss.jsxs)(fA,{id:"preferences",label:"menu.preferences",children:[(0,Ss.jsxs)(pA,{id:"preferences-actions",children:[(0,Ss.jsx)(pB,{}),(0,Ss.jsx)(fB,{}),(0,Ss.jsx)(gB,{}),(0,Ss.jsx)(mB,{}),(0,Ss.jsx)(yB,{}),(0,Ss.jsx)(vB,{}),(0,Ss.jsx)(bB,{}),(0,Ss.jsx)(xB,{}),(0,Ss.jsx)(SB,{}),(0,Ss.jsx)(wB,{})]}),(0,Ss.jsx)(pA,{id:"color-scheme",children:(0,Ss.jsx)(yA,{})})]}),(0,Ss.jsx)(XB,{}),(0,Ss.jsx)(ZB,{})]})}const aU=(0,e.memo)((function(e){let{children:t}=e;const n=Va(),[o,r]=oA("main menu"),i=rE(),s=null!==t&&void 0!==t?t:(0,Ss.jsx)(QB,{});return(0,Ss.jsxs)(RI,{dir:"ltr",open:o,onOpenChange:r,modal:!1,children:[(0,Ss.jsx)(LI,{asChild:!0,dir:"ltr",children:(0,Ss.jsx)(sE,{type:"icon","data-testid":"main-menu.button",title:i("menu.title"),children:(0,Ss.jsx)(ej,{icon:"menu",small:!0})})}),(0,Ss.jsx)(zI,{container:n,children:(0,Ss.jsx)(NI,{className:"tlui-menu",side:"bottom",align:"start",collisionPadding:4,alignOffset:0,sideOffset:6,children:(0,Ss.jsx)(tA,{type:"menu",sourceId:"main-menu",children:s})})})]})})),lU={};function cU(e){if(lU[e])return lU[e];const t=document.createElement("canvas").getContext("2d");t.fillStyle=e,t.fillRect(0,0,1,1);const[n,o,r,i]=t.getImageData(0,0,1,1).data,s=new Float32Array([n/255,o/255,r/255,i/255]);return lU[e]=s,s}function dU(e,t){let{center:n,radius:o,numArcSegments:r=20,startAngle:i=0,endAngle:s=$s,offset:a=0}=t;const l=(s-i)/r;let c=a;for(let d=i;d<s;d+=l)e[c++]=n.x,e[c++]=n.y,e[c++]=n.x+Math.cos(d)*o,e[c++]=n.y+Math.sin(d)*o,e[c++]=n.x+Math.cos(d+l)*o,e[c++]=n.y+Math.sin(d+l)*o;return e}function uU(e,t,n,o,r,i){e[t++]=n,e[t++]=o,e[t++]=n,e[t++]=o+i,e[t++]=n+r,e[t++]=o,e[t++]=n+r,e[t++]=o,e[t++]=n,e[t++]=o+i,e[t++]=n+r,e[t++]=o+i}function hU(e,t){const n=e.createBuffer();if(!n)throw new Error("Failed to create buffer");return{buffer:n,vertices:new Float32Array(t)}}function pU(e,t,n){let o=e.vertices.length;for(;o<t+n.length;)o*=2;if(o!=e.vertices.length){const t=new Float32Array(o);t.set(e.vertices),e.vertices=t}e.vertices.set(n,t)}var fU,gU,mU,yU,vU,bU,wU,xU,SU,kU,PU,CU=Object.create,_U=Object.defineProperty,IU=Object.getOwnPropertyDescriptor,EU=(e,t)=>(t=Symbol[e])?t:Symbol.for("Symbol."+e),jU=e=>{throw TypeError(e)},TU=(e,t,n)=>t in e?_U(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,MU=(e,t)=>_U(e,"name",{value:t,configurable:!0}),AU=["class","method","getter","setter","accessor","field","value","get","set"],OU=e=>void 0!==e&&"function"!==typeof e?jU("Function expected"):e,DU=(e,t,n,o,r)=>({kind:AU[e],name:t,metadata:o,addInitializer:e=>n._?jU("Already initialized"):r.push(OU(e||null))}),RU=(e,t)=>TU(t,EU("metadata"),e[3]),LU=(e,t,n,o,r,i)=>{var s,a,l,c,d,u=7&t,h=!!(8&t),p=!!(16&t),f=u>3?e.length+1:u?h?1:2:0,g=AU[u+5],m=u>3&&(e[f-1]=[]),y=e[f]||(e[f]=[]),v=u&&(!p&&!h&&(r=r.prototype),u<5&&(u>3||!p)&&IU(u<4?r:{get[n](){return BU(this,i)},set[n](e){return UU(this,i,e)}},n));u?p&&u<4&&MU(i,(u>2?"set ":u>1?"get ":"")+n):MU(r,n);for(var b=o.length-1;b>=0;b--)c=DU(u,n,l={},e[3],y),u&&(c.static=h,c.private=p,d=c.access={has:p?e=>FU(r,e):e=>n in e},3^u&&(d.get=p?e=>(1^u?BU:HU)(e,r,4^u?i:v.get):e=>e[n]),u>2&&(d.set=p?(e,t)=>UU(e,r,t,4^u?i:v.set):(e,t)=>e[n]=t)),a=(0,o[b])(u?u<4?p?i:v[g]:u>4?void 0:{get:v.get,set:v.set}:r,c),l._=1,4^u||void 0===a?OU(a)&&(u>4?m.unshift(a):u?p?i=a:v[g]=a:r=a):"object"!==typeof a||null===a?jU("Object expected"):(OU(s=a.get)&&(v.get=s),OU(s=a.set)&&(v.set=s),OU(s=a.init)&&m.unshift(s));return u||RU(e,r),v&&_U(r,n,v),p?4^u?i:v:r},zU=(e,t,n)=>TU(e,"symbol"!==typeof t?t+"":t,n),NU=(e,t,n)=>t.has(e)||jU("Cannot "+n),FU=(e,t)=>Object(t)!==t?jU('Cannot use the "in" operator on this value'):e.has(t),BU=(e,t,n)=>(NU(e,t,"read from private field"),n?n.call(e):t.get(e)),UU=(e,t,n,o)=>(NU(e,t,"write to private field"),o?o.call(e,n):t.set(e,n),n),HU=(e,t,n)=>(NU(e,t,"access private method"),n);kU=[R],SU=[cn],xU=[cn],wU=[cn],bU=[cn],vU=[cn],yU=[cn],mU=[cn],gU=[cn],fU=[R];class KU{constructor(e,t,n){this.editor=e,this.elem=t,this.container=n,((e,t,n,o)=>{for(var r=0,i=e[t>>1],s=i&&i.length;r<s;r++)1&t?i[r].call(n):o=i[r].call(n,o)})(PU,5,this),zU(this,"disposables",[]),zU(this,"gl"),zU(this,"shapeGeometryCache"),zU(this,"colors"),zU(this,"id",$()),zU(this,"canvasBoundingClientRect",Qt("canvasBoundingClientRect",new rc)),zU(this,"originPagePoint",new Vs),zU(this,"originPageCenter",new Vs),zU(this,"isInViewport",!1),this.gl=function(e){if(!e)throw new Error("Canvas element not found");const t=e.getContext("webgl2",{premultipliedAlpha:!1});if(!t)throw new Error("Failed to get webgl2 context");const n=t.createShader(t.VERTEX_SHADER);if(!n)throw new Error("Failed to create vertex shader");if(t.shaderSource(n,"#version 300 es\n  precision mediump float;\n  \n  in vec2 shapeVertexPosition;\n\n\tuniform vec4 canvasPageBounds;\n\n\t// taken (with thanks) from\n\t// https://webglfundamentals.org/webgl/lessons/webgl-2d-matrices.html\n  void main() {\n\t\t// convert the position from pixels to 0.0 to 1.0\n\t\tvec2 zeroToOne = (shapeVertexPosition - canvasPageBounds.xy) / canvasPageBounds.zw;\n\t\n\t\t// convert from 0->1 to 0->2\n\t\tvec2 zeroToTwo = zeroToOne * 2.0;\n\t\n\t\t// convert from 0->2 to -1->+1 (clipspace)\n\t\tvec2 clipSpace = zeroToTwo - 1.0;\n\t\n\t\tgl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);\n  }"),t.compileShader(n),!t.getShaderParameter(n,t.COMPILE_STATUS))throw new Error("Failed to compile vertex shader");const o=t.createShader(t.FRAGMENT_SHADER);if(!o)throw new Error("Failed to create fragment shader");if(t.shaderSource(o,"#version 300 es\n  precision mediump float;\n  \n\tuniform vec4 fillColor;\n  out vec4 outputColor;\n\n  void main() {\n\toutputColor = fillColor;\n  }"),t.compileShader(o),!t.getShaderParameter(o,t.COMPILE_STATUS))throw new Error("Failed to compile fragment shader");const r=t.createProgram();if(!r)throw new Error("Failed to create program");if(t.attachShader(r,n),t.attachShader(r,o),t.linkProgram(r),!t.getProgramParameter(r,t.LINK_STATUS))throw new Error("Failed to link program");t.useProgram(r);const i=t.getAttribLocation(r,"shapeVertexPosition");if(i<0)throw new Error("Failed to get shapeVertexPosition attribute location");t.enableVertexAttribArray(i);const s=t.getUniformLocation(r,"canvasPageBounds"),a=t.getUniformLocation(r,"fillColor");if(!t.createBuffer())throw new Error("Failed to create buffer");if(!t.createBuffer())throw new Error("Failed to create buffer");return{context:t,selectedShapes:hU(t,1024),unselectedShapes:hU(t,4096),viewport:hU(t,300),collaborators:hU(t,1024),prepareTriangles(e,n){t.bindBuffer(t.ARRAY_BUFFER,e.buffer),t.bufferData(t.ARRAY_BUFFER,e.vertices,t.STATIC_DRAW,0,n),t.enableVertexAttribArray(i),t.vertexAttribPointer(i,2,t.FLOAT,!1,0,0)},drawTrianglesTransparently(e){t.enable(t.BLEND),t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA),t.drawArrays(t.TRIANGLES,0,e/2),t.disable(t.BLEND)},drawTriangles(e){t.drawArrays(t.TRIANGLES,0,e/2)},setFillColor(e){t.uniform4fv(a,e)},setCanvasPageBounds(e){t.uniform4fv(s,e)}}}(t),this.shapeGeometryCache=e.store.createComputedCache("webgl-geometry",(t=>{const n=e.getShapeMaskedPageBounds(t.id);if(!n)return null;const o=new Float32Array(12);return uU(o,0,n.x,n.y,n.w,n.h),o})),this.colors=this._getColors(),this.disposables.push(this._listenForCanvasResize(),Ht("minimap render",this.render))}close(){return this.disposables.forEach((e=>e()))}_getColors(){const e=getComputedStyle(this.editor.getContainer());return{shapeFill:cU(e.getPropertyValue("--color-text-3").trim()),selectFill:cU(e.getPropertyValue("--color-selected").trim()),viewportFill:cU(e.getPropertyValue("--color-muted-1").trim()),background:cU(e.getPropertyValue("--color-low").trim())}}updateColors(){this.colors=this._getColors()}getDpr(){return this.editor.getInstanceState().devicePixelRatio}getContentPageBounds(){const e=this.editor.getViewportPageBounds(),t=this.editor.getCurrentPageBounds();return t?rc.Expand(t,e):e}getContentScreenBounds(){const e=this.getContentPageBounds(),t=this.editor.pageToScreen(e.point),n=this.editor.pageToScreen(new Vs(e.maxX,e.maxY));return new rc(t.x,t.y,n.x-t.x,n.y-t.y)}_getCanvasBoundingRect(){const{x:e,y:t,width:n,height:o}=this.elem.getBoundingClientRect();return new rc(e,t,n,o)}getCanvasScreenBounds(){return this.canvasBoundingClientRect.get()}_listenForCanvasResize(){const e=new ResizeObserver((()=>{const e=this._getCanvasBoundingRect();this.canvasBoundingClientRect.set(e)}));return e.observe(this.elem),e.observe(this.container),()=>e.disconnect()}getCanvasSize(){const e=this.canvasBoundingClientRect.get(),t=this.getDpr();return new Vs(e.width*t,e.height*t)}getCanvasClientPosition(){return this.canvasBoundingClientRect.get().point}getCanvasPageBounds(){const e=this.getCanvasScreenBounds(),t=this.getContentPageBounds(),n=e.width/e.height;let o=t.width,r=o/n;r<t.height&&(r=t.height,o=r*n);const i=new rc(0,0,o,r);return i.center=t.center,i}getZoom(){return this.getCanvasPageBounds().width/this.getCanvasScreenBounds().width}getCanvasPageBoundsArray(){const{x:e,y:t,w:n,h:o}=this.getCanvasPageBounds();return new Float32Array([e,t,n,o])}getMinimapPagePoint(e,t){const n=this.getCanvasPageBounds(),o=this.getCanvasScreenBounds();let r=e-o.x,i=t-o.y;return r*=n.width/o.width,i*=n.height/o.height,r+=n.minX,i+=n.minY,new Vs(r,i,1)}minimapScreenPointToPagePoint(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const{editor:r}=this,i=r.getViewportPageBounds();let{x:s,y:a}=this.getMinimapPagePoint(e,t);if(o){var l;const e=null!==(l=this.editor.getCurrentPageBounds())&&void 0!==l?l:new rc,t=e.minX-i.width/2,n=e.maxX+i.width/2,o=e.minY-i.height/2,r=e.maxY+i.height/2;s+=(Math.max(0,t+i.width-s)-Math.max(0,-(n-i.width-s)))/2,a+=(Math.max(0,o+i.height-a)-Math.max(0,-(r-i.height-a)))/2,s=Qs(s,t,n),a=Qs(a,o,r)}if(n){const{originPagePoint:e}=this;Math.abs(s-e.x)>Math.abs(a-e.y)?a=e.y:s=e.x}return new Vs(s,a)}render(){const e=this.gl.context,t=this.getCanvasSize();this.gl.setCanvasPageBounds(this.getCanvasPageBoundsArray()),this.elem.width=t.x,this.elem.height=t.y,e.viewport(0,0,t.x,t.y),e.clearColor(this.colors.background[0],this.colors.background[1],this.colors.background[2],1),e.clear(e.COLOR_BUFFER_BIT);const n=new Set(this.editor.getSelectedShapeIds()),o=this.colors;let r=0,i=0;const s=this.editor.getCurrentPageShapeIdsSorted();for(let a=0,l=s.length;a<l;a++){const e=s[a],t=this.shapeGeometryCache.get(e);if(!t)continue;const o=t.length;n.has(e)?(pU(this.gl.selectedShapes,r,t),r+=o):(pU(this.gl.unselectedShapes,i,t),i+=o)}this.drawShapes(this.gl.unselectedShapes,i,o.shapeFill),this.drawShapes(this.gl.selectedShapes,r,o.selectFill),this.drawViewport(),this.drawCollaborators()}drawShapes(e,t,n){this.gl.prepareTriangles(e,t),this.gl.setFillColor(n),this.gl.drawTriangles(t)}drawViewport(){const e=this.editor.getViewportPageBounds(),t=function(e,t,n){const o=10;n=Math.min(n,Math.min(t.w,t.h)/2);const r=rc.ExpandBy(t,-n);if(r.w<=0||r.h<=0)return dU(e,{center:t.center,radius:n,numArcSegments:40}),240;let i=0;return uU(e,i,r.minX,r.minY,r.w,r.h),i+=12,uU(e,i,r.minX,t.minY,r.w,n),i+=12,uU(e,i,r.maxX,r.minY,n,r.h),i+=12,uU(e,i,r.minX,r.maxY,r.w,n),i+=12,uU(e,i,t.minX,r.minY,n,r.h),i+=12,dU(e,{numArcSegments:o,offset:i,center:r.point,radius:n,startAngle:Gs,endAngle:1.5*Gs}),i+=60,dU(e,{numArcSegments:o,offset:i,center:Vs.Add(r.point,new Vs(r.w,0)),radius:n,startAngle:1.5*Gs,endAngle:$s}),i+=60,dU(e,{numArcSegments:o,offset:i,center:Vs.Add(r.point,r.size),radius:n,startAngle:0,endAngle:Xs}),i+=60,dU(e,{numArcSegments:o,offset:i,center:Vs.Add(r.point,new Vs(0,r.h)),radius:n,startAngle:Xs,endAngle:Gs}),300}(this.gl.viewport.vertices,e,4*this.getZoom());this.gl.prepareTriangles(this.gl.viewport,t),this.gl.setFillColor(this.colors.viewportFill),this.gl.drawTrianglesTransparently(t),ka.isSafari&&(this.gl.drawTrianglesTransparently(t),this.gl.drawTrianglesTransparently(t),this.gl.drawTrianglesTransparently(t))}drawCollaborators(){const e=this.editor.getCollaboratorsOnCurrentPage();if(!e.length)return;const t=120,n=t*e.length;this.gl.collaborators.vertices.length<n&&(this.gl.collaborators.vertices=new Float32Array(n));const o=this.gl.collaborators.vertices;let r=0;const i=this.getZoom();for(const{cursor:s}of e)dU(o,{center:Vs.From(s),radius:3*i,offset:r,numArcSegments:20}),r+=t;this.gl.prepareTriangles(this.gl.collaborators,n),r=0;for(const{color:s}of e)this.gl.setFillColor(cU(s)),this.gl.context.drawArrays(this.gl.context.TRIANGLES,r/2,60),r+=t}}function VU(){const t=Ns(),n=Va(),o=e.useRef(null),r=e.useRef(!1),i=e.useRef();e.useEffect((()=>{try{const e=new KU(t,o.current,n);return i.current=e,i.current.close}catch(e){t.annotateError(e,{origin:"minimap",willCrashApp:!1}),t.timers.setTimeout((()=>{throw e}))}}),[t,n]);const s=e.useCallback((e=>{if(!t.getCurrentPageShapeIds().size)return;if(!i.current)return;const n=i.current.minimapScreenPointToPagePoint(e.clientX,e.clientY,!1,!1),o=i.current.minimapScreenPointToPagePoint(e.clientX,e.clientY,!1,!0);i.current.originPagePoint.setTo(o),i.current.originPageCenter.setTo(t.getViewportPageBounds().center),t.centerOnPoint(n,{animation:{duration:t.options.animationMediumMs}})}),[t]),a=e.useCallback((e=>{if(!i.current)return;const n=e.currentTarget;if(Ra(n,e),!t.getCurrentPageShapeIds().size)return;r.current=!0,i.current.isInViewport=!1;const o=i.current.minimapScreenPointToPagePoint(e.clientX,e.clientY,!1,!1),s=t.getViewportPageBounds(),a=i.current.getContentPageBounds();if(new rc(a.x-s.width/2,a.y-s.height/2,a.width+s.width,a.height+s.height).containsPoint(o)&&!s.containsPoint(o)){i.current.isInViewport=s.containsPoint(o);const e=Vs.Sub(s.center,s.point),n=Vs.Add(o,e);i.current.originPagePoint.setTo(n),i.current.originPageCenter.setTo(o),t.centerOnPoint(o,{animation:{duration:t.options.animationMediumMs}})}else{const t=i.current.minimapScreenPointToPagePoint(e.clientX,e.clientY,!1,!0);i.current.isInViewport=s.containsPoint(t),i.current.originPagePoint.setTo(t),i.current.originPageCenter.setTo(s.center)}document.body.addEventListener("pointerup",(function e(t){n&&La(n,t),r.current=!1,document.body.removeEventListener("pointerup",e)}))}),[t]),c=e.useCallback((e=>{if(!i.current)return;const n=i.current.minimapScreenPointToPagePoint(e.clientX,e.clientY,e.shiftKey,!0);if(r.current){if(i.current.isInViewport){const e=i.current.originPagePoint.clone().sub(i.current.originPageCenter);return void t.centerOnPoint(Vs.Sub(n,e))}t.centerOnPoint(n)}const o=i.current.getMinimapPagePoint(e.clientX,e.clientY),s=t.pageToScreen(o),a=l(l({type:"pointer",target:"canvas",name:"pointer_move"},Ba(e)),{},{point:s,isPen:t.getInstanceState().isPenMode});t.dispatch(a)}),[t]),d=e.useCallback((e=>{const n=Ql(e);t.dispatch({type:"wheel",name:"wheel",delta:n,point:new Vs(e.clientX,e.clientY),shiftKey:e.shiftKey,altKey:e.altKey,ctrlKey:e.metaKey||e.ctrlKey,metaKey:e.metaKey,accelKey:Fa(e)})}),[t]),u=lv();return e.useEffect((()=>{t.timers.setTimeout((()=>{var e,t;null===(e=i.current)||void 0===e||e.updateColors(),null===(t=i.current)||void 0===t||t.render()}))}),[u,t]),(0,Ss.jsx)("div",{className:"tlui-minimap",children:(0,Ss.jsx)("canvas",{role:"img","aria-label":"minimap",ref:o,className:"tlui-minimap__canvas",onDoubleClick:s,onPointerMove:c,onPointerDown:a,onWheelCapture:d})})}LU(PU=(e=>{var t;return[,,,CU(null!==(t=null===e||void 0===e?void 0:e[EU("metadata")])&&void 0!==t?t:null)]})(null),1,"close",kU,KU),LU(PU,1,"getDpr",SU,KU),LU(PU,1,"getContentPageBounds",xU,KU),LU(PU,1,"getContentScreenBounds",wU,KU),LU(PU,1,"getCanvasSize",bU,KU),LU(PU,1,"getCanvasClientPosition",vU,KU),LU(PU,1,"getCanvasPageBounds",yU,KU),LU(PU,1,"getZoom",mU,KU),LU(PU,1,"getCanvasPageBoundsArray",gU,KU),LU(PU,1,"render",fU,KU),RU(PU,KU);const WU=(0,e.memo)((function(){const t=WM(),n=rE(),o=kj(),r=(0,e.useRef)(null);cb(r);const[i,s]=function(t,n){const[o,r]=e.useState(n);return e.useLayoutEffect((()=>{const e=tt(t);if(e)try{r(JSON.parse(e))}catch(n){console.error("Could not restore value ".concat(t," from local storage."))}}),[t]),[o,e.useCallback((e=>{r((n=>{const o="function"===typeof e?e(n):e;return nt(t,JSON.stringify(o)),o}))}),[t])]}("minimap",!0),a=(0,e.useCallback)((()=>{s((e=>!e))}),[s]),{ZoomMenu:l,Minimap:c}=CV();return o<wj.MOBILE?null:(0,Ss.jsxs)("div",{ref:r,className:"tlui-navigation-panel",children:[(0,Ss.jsx)("div",{className:"tlui-buttons__horizontal",children:l&&o<wj.TABLET?(0,Ss.jsx)(l,{}):i?(0,Ss.jsxs)(Ss.Fragment,{children:[l&&(0,Ss.jsx)(l,{}),c&&(0,Ss.jsx)(sE,{type:"icon","data-testid":"minimap.toggle-button",title:n("navigation-zone.toggle-minimap"),className:"tlui-navigation-panel__toggle",onClick:a,children:(0,Ss.jsx)(ej,{icon:i?"chevrons-ne":"chevrons-sw"})})]}):(0,Ss.jsxs)(Ss.Fragment,{children:[(0,Ss.jsx)(sE,{type:"icon","data-testid":"minimap.zoom-out",title:"".concat(n(qM(t["zoom-out"].label))," ").concat(ZM(t["zoom-out"].kbd)),onClick:()=>t["zoom-out"].onSelect("navigation-zone"),children:(0,Ss.jsx)(ej,{icon:"minus"})}),l&&(0,Ss.jsx)(l,{}),(0,Ss.jsx)(sE,{type:"icon","data-testid":"minimap.zoom-in",title:"".concat(n(qM(t["zoom-in"].label))," ").concat(ZM(t["zoom-in"].kbd)),onClick:()=>t["zoom-in"].onSelect("navigation-zone"),children:(0,Ss.jsx)(ej,{icon:"plus"})}),c&&(0,Ss.jsx)(sE,{type:"icon","data-testid":"minimap.toggle-button",title:n("navigation-zone.toggle-minimap"),className:"tlui-navigation-panel__toggle",onClick:a,children:(0,Ss.jsx)(ej,{icon:i?"chevrons-ne":"chevrons-sw"})})]})}),c&&o>=wj.TABLET&&!i&&(0,Ss.jsx)(c,{})]})})),qU=function(t){let{name:n,id:o,isCurrentPage:r,onCancel:i}=t;const s=Ns(),a=Zb(),l=(0,e.useRef)(null),c=(0,e.useRef)(null),d=(0,e.useCallback)((()=>{c.current=s.markHistoryStoppingPoint("rename page")}),[s]),u=(0,e.useCallback)((e=>{s.renamePage(o,e||"New Page"),a("rename-page",{source:"page-menu"})}),[s,o,a]),h=(0,e.useCallback)((()=>{c.current&&s.bailToMark(c.current),i()}),[s,i]);return(0,Ss.jsx)(sj,{className:"tlui-page-menu__item__input",ref:e=>l.current=e,defaultValue:n,onValueChange:u,onCancel:h,onFocus:d,shouldManuallyMaintainScrollPositionWhenFocused:!0,autoFocus:r,autoSelect:!0})},YU=(e,t,n,o,r)=>{let i;const s=e.getPages(),a=n>o?s[o-1]:s[o],l=n>o?s[o]:s[o+1];i=a&&!l?Ze(a.index):!a&&l?function(){return Ye(null,arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,1)[0]}(s[0].index):$e(a.index,l.index),i!==s[n].index&&(e.markHistoryStoppingPoint("moving page"),e.updatePage({id:t,index:i}),r("move-page",{source:"page-menu"}))},GU=fn((function(t){let{index:n,listSize:o,item:r,onRename:i}=t;const s=Ns(),a=rE(),l=s.getPages(),c=Zb(),d=(0,e.useCallback)((()=>{s.markHistoryStoppingPoint("creating page");const e=_r.createId();s.duplicatePage(r.id,e),c("duplicate-page",{source:"page-menu"})}),[s,r,c]),u=(0,e.useCallback)((()=>{YU(s,r.id,n,n-1,c)}),[s,r,n,c]),h=(0,e.useCallback)((()=>{YU(s,r.id,n,n+1,c)}),[s,r,n,c]),p=(0,e.useCallback)((()=>{s.markHistoryStoppingPoint("deleting page"),s.deletePage(r.id),c("delete-page",{source:"page-menu"})}),[s,r,c]);return(0,Ss.jsxs)(iA,{id:"page item submenu ".concat(n),children:[(0,Ss.jsx)(sA,{children:(0,Ss.jsx)(sE,{type:"icon",title:a("page-menu.submenu.title"),children:(0,Ss.jsx)(ej,{icon:"dots-vertical",small:!0})})}),(0,Ss.jsx)(aA,{alignOffset:0,side:"right",sideOffset:-4,children:(0,Ss.jsxs)(tA,{type:"menu",sourceId:"page-menu",children:[(0,Ss.jsxs)(pA,{id:"modify",children:[i&&(0,Ss.jsx)(_A,{id:"rename",label:"page-menu.submenu.rename",onSelect:i}),(0,Ss.jsx)(_A,{id:"duplicate",label:"page-menu.submenu.duplicate-page",onSelect:d,disabled:l.length>=s.options.maxPages}),n>0&&(0,Ss.jsx)(_A,{id:"move-up",onSelect:u,label:"page-menu.submenu.move-up"}),n<o-1&&(0,Ss.jsx)(_A,{id:"move-down",label:"page-menu.submenu.move-down",onSelect:h})]}),o>1&&(0,Ss.jsx)(pA,{id:"delete",children:(0,Ss.jsx)(_A,{id:"delete",onSelect:p,label:"page-menu.submenu.delete"})})]})})]})})),XU=(0,e.memo)((function(){const t=Ns(),n=Zb(),o=rE(),r=kj(),i=(0,e.useCallback)((()=>v(!1)),[]),[s,a]=oA("page-menu",i),c=36,d=(0,e.useRef)(null),u=yn("pages",(()=>t.getPages()),[t]),h=yn("currentPage",(()=>t.getCurrentPage()),[t]),p=yn("currentPageId",(()=>t.getCurrentPageId()),[t]),f=YM(),g=yn("maxPageCountReached",(()=>t.getPages().length>=t.options.maxPages),[t]),m=yn("isCoarsePointer",(()=>t.getInstanceState().isCoarsePointer),[t]),[y,v]=(0,e.useState)(!1),b=(0,e.useCallback)((()=>{f||v((e=>!e))}),[f]),w=(0,e.useRef)({isPointing:!1,status:"idle",pointing:null,startY:0,startIndex:0,dragIndex:0}),[x,S]=(0,e.useState)(Object.fromEntries(u.map(((e,t)=>[e.id,{y:t*c,offsetY:0,isSelected:!1}]))));(0,e.useLayoutEffect)((()=>{S(Object.fromEntries(u.map(((e,t)=>[e.id,{y:t*c,offsetY:0,isSelected:!1}]))))}),[c,u]),(0,e.useEffect)((()=>{s&&t.timers.requestAnimationFrame((()=>{const e=document.querySelector('[data-testid="page-menu-item-'.concat(p,'"]'));if(e){const t=d.current;if(!t)return;const n=e.offsetTop;n<t.scrollTop&&t.scrollTo({top:n});const o=n+c;o>t.scrollTop+t.offsetHeight&&t.scrollTo({top:o-t.offsetHeight})}}))}),[c,p,s,t]);const k=(0,e.useCallback)((e=>{const{clientY:t,currentTarget:n}=e,{dataset:{id:o,index:r}}=n;if(!o||!r)return;const i=w.current;Ra(e.currentTarget,e),i.status="pointing",i.pointing={id:o,index:+r};const s=x[o].y;i.startY=t,i.startIndex=Math.max(0,Math.min(Math.round(s/c),u.length-1))}),[c,u.length,x]),P=(0,e.useCallback)((e=>{const t=w.current;if("pointing"===t.status){const{clientY:n}=e,o=n-t.startY;Math.abs(o)>5&&(t.status="dragging")}if("dragging"===t.status){const{clientY:n}=e,o=n-t.startY,r=x[t.pointing.id],{startIndex:i,pointing:s}=t,a=r.y+o,d=Math.max(0,Math.min(Math.round(a/c),u.length-1)),h=l({},x);if(h[s.id]={y:r.y,offsetY:o,isSelected:!0},d!==t.dragIndex){t.dragIndex=d;for(let e=0;e<u.length;e++){const n=u[e];if(n.id===t.pointing.id)continue;let{y:o}=h[n.id];d===i?o=e*c:d<i?o=d<=e&&e<i?(e+1)*c:e*c:d>i&&(o=d>=e&&e>i?(e-1)*c:e*c),o!==h[n.id].y&&(h[n.id]={y:o,offsetY:0,isSelected:!0})}}S(h)}}),[c,u,x]),C=(0,e.useCallback)((e=>{const o=w.current;if("dragging"===o.status){const{id:e,index:r}=o.pointing;YU(t,e,r,o.dragIndex,n)}La(e.currentTarget,e),o.status="idle"}),[t,n]),_=(0,e.useCallback)((e=>{const t=w.current;"Escape"===e.key&&("dragging"===t.status&&S(Object.fromEntries(u.map(((e,t)=>[e.id,{y:t*c,offsetY:0,isSelected:!1}])))),t.status="idle")}),[c,u]),I=(0,e.useCallback)((()=>{f||(t.run((()=>{t.markHistoryStoppingPoint("creating page");const e=_r.createId();t.createPage({name:o("page-menu.new-page-initial-name"),id:e}),t.setCurrentPage(e),v(!0)})),n("new-page",{source:"page-menu"}))}),[t,o,f,n]),E=(0,e.useCallback)((e=>{t.setCurrentPage(e),n("change-page",{source:"page-menu"})}),[t,n]),j=(0,e.useCallback)(((e,o)=>{t.renamePage(e,o),n("rename-page",{source:"page-menu"})}),[t,n]);return(0,Ss.jsxs)(dF,{id:"pages",onOpenChange:a,open:s,children:[(0,Ss.jsx)(uF,{"data-testid":"main.page-menu",children:(0,Ss.jsxs)(sE,{type:"menu",title:h.name,"data-testid":"page-menu.button",className:"tlui-page-menu__trigger",children:[(0,Ss.jsx)("div",{className:"tlui-page-menu__name",children:h.name}),(0,Ss.jsx)(ej,{icon:"chevron-down",small:!0})]})}),(0,Ss.jsx)(hF,{side:"bottom",align:"start",sideOffset:6,disableEscapeKeyDown:y,children:(0,Ss.jsxs)("div",{className:"tlui-page-menu__wrapper",children:[(0,Ss.jsxs)("div",{className:"tlui-page-menu__header",children:[(0,Ss.jsx)("div",{className:"tlui-page-menu__header__title",children:o("page-menu.title")}),!f&&(0,Ss.jsxs)("div",{className:"tlui-buttons__horizontal",children:[(0,Ss.jsx)(sE,{type:"icon","data-testid":"page-menu.edit",title:o(y?"page-menu.edit-done":"page-menu.edit-start"),onClick:b,children:(0,Ss.jsx)(ej,{icon:y?"check":"edit"})}),(0,Ss.jsx)(sE,{type:"icon","data-testid":"page-menu.create",title:o(g?"page-menu.max-page-count-reached":"page-menu.create-new-page"),disabled:g,onClick:I,children:(0,Ss.jsx)(ej,{icon:"plus"})})]})]}),(0,Ss.jsx)("div",{"data-testid":"page-menu.list",className:"tlui-page-menu__list tlui-menu__group",style:{height:c*u.length+4},ref:d,children:u.map(((e,n)=>{var i;const s=null!==(i=x[e.id])&&void 0!==i?i:{position:40*n,offsetY:0};return y?(0,Ss.jsxs)("div",{"data-testid":"page-menu.item",className:"tlui-page_menu__item__sortable",style:{zIndex:e.id===h.id?888:n,transform:"translate(0px, ".concat(s.y+s.offsetY,"px)")},children:[(0,Ss.jsx)(sE,{type:"icon",tabIndex:-1,className:"tlui-page_menu__item__sortable__handle",onPointerDown:k,onPointerUp:C,onPointerMove:P,onKeyDown:_,"data-id":e.id,"data-index":n,children:(0,Ss.jsx)(ej,{icon:"drag-handle-dots"})}),r<wj.TABLET_SM&&m?(0,Ss.jsxs)(sE,{type:"normal",className:"tlui-page-menu__item__button",onClick:()=>{const t=window.prompt("Rename page",e.name);t&&t!==e.name&&j(e.id,t)},onDoubleClick:b,children:[(0,Ss.jsx)(TB,{checked:e.id===h.id}),(0,Ss.jsx)(aE,{children:e.name})]}):(0,Ss.jsx)("div",{className:"tlui-page_menu__item__sortable__title",style:{height:c},children:(0,Ss.jsx)(qU,{id:e.id,name:e.name,isCurrentPage:e.id===h.id,onCancel:()=>{v(!1),t.menus.clearOpenMenus()}})}),!f&&(0,Ss.jsx)("div",{className:"tlui-page_menu__item__submenu","data-isediting":y,children:(0,Ss.jsx)(GU,{index:n,item:e,listSize:u.length})})]},e.id+"_editing"):(0,Ss.jsxs)("div",{"data-testid":"page-menu.item",className:"tlui-page-menu__item",children:[(0,Ss.jsxs)(sE,{type:"normal",className:"tlui-page-menu__item__button",onClick:()=>E(e.id),onDoubleClick:b,title:o("page-menu.go-to-page"),children:[(0,Ss.jsx)(TB,{checked:e.id===h.id}),(0,Ss.jsx)(aE,{children:e.name})]}),!f&&(0,Ss.jsx)("div",{className:"tlui-page_menu__item__submenu",children:(0,Ss.jsx)(GU,{index:n,item:e,listSize:u.length,onRename:()=>{if(ka.isIos){const t=window.prompt("Rename page",e.name);t&&t!==e.name&&j(e.id,t)}else v(!0),p!==e.id&&E(e.id)}})})]},e.id)}))})]})})]})}));function $U(){const e=Ns(),t=SF(),n=xF(),o=bF(1),r=YM(),i=yn("should display quick actions",(()=>e.isInAny("select","hand","zoom")),[e]),s=fF(),a=o&&s;if(!r||i)return(0,Ss.jsxs)(Ss.Fragment,{children:[(0,Ss.jsx)(EA,{actionId:"undo",disabled:!t}),(0,Ss.jsx)(EA,{actionId:"redo",disabled:!n}),(0,Ss.jsx)(EA,{actionId:"delete",disabled:!a}),(0,Ss.jsx)(EA,{actionId:"duplicate",disabled:!a})]})}const ZU=(0,e.memo)((function(e){let{children:t}=e;const n=null!==t&&void 0!==t?t:(0,Ss.jsx)($U,{});return(0,Ss.jsx)(tA,{type:"small-icons",sourceId:"quick-actions",children:n})}));function QU(e){var t;let{userId:n}=e;const o=hc(n);return o?(0,Ss.jsx)("div",{className:"tlui-people-menu__avatar",style:{backgroundColor:o.color},children:"New User"===o.userName?"":null!==(t=o.userName[0])&&void 0!==t?t:""},n):null}const JU=fn((function(t){var n;let{userId:o}=t;const r=Ns(),i=rE(),s=Zb(),a=hc(o),l=(0,e.useCallback)((()=>{r.getInstanceState().followingUserId===o?(r.stopFollowingUser(),s("stop-following",{source:"people-menu"})):(r.startFollowingUser(o),s("start-following",{source:"people-menu"}))}),[r,o,s]),c=(null===a||void 0===a?void 0:a.followingUserId)===r.user.getId(),d=r.getInstanceState().followingUserId===o;return a?(0,Ss.jsxs)("div",{className:"tlui-people-menu__item tlui-buttons__horizontal",children:[(0,Ss.jsxs)(sE,{type:"menu",className:"tlui-people-menu__item__button",onClick:()=>r.zoomToUser(o),onDoubleClick:l,children:[(0,Ss.jsx)(JE,{icon:"color",color:a.color}),(0,Ss.jsx)("div",{className:"tlui-people-menu__name",children:null!==(n=a.userName)&&void 0!==n?n:"New User"})]}),(0,Ss.jsx)(sE,{type:"icon",className:"tlui-people-menu__item__follow",title:i(c?"people-menu.leading":d?"people-menu.following":"people-menu.follow"),onClick:l,disabled:c,"data-active":d||c,children:(0,Ss.jsx)(ej,{icon:c?"leading":d?"following":"follow"})})]}):null}));function eH(e){let{count:t}=e;return(0,Ss.jsx)("div",{className:"tlui-people-menu__more",children:"+"+Math.abs(t)})}const tH=fn((function(){const t=Ns(),n=Va(),o=rE(),r=Zb(),i=(0,e.useRef)(!1),[s,a]=(0,e.useState)(!1),l=(0,e.useCallback)((e=>{a(e)}),[]),c=t.user.getColor(),d=(0,e.useCallback)((e=>{t.user.updateUserPreferences({color:e}),r("set-color",{source:"people-menu"})}),[t,r]),{handleButtonClick:u,handleButtonPointerDown:h,handleButtonPointerEnter:p,handleButtonPointerUp:f}=e.useMemo((()=>{const e=()=>{i.current=!1,window.removeEventListener("pointerup",e)};return{handleButtonClick:e=>{const{id:t}=e.currentTarget.dataset;t&&c!==t&&d(t)},handleButtonPointerDown:t=>{const{id:n}=t.currentTarget.dataset;n&&(d(n),i.current=!0,window.addEventListener("pointerup",e))},handleButtonPointerEnter:e=>{if(!i.current)return;const{id:t}=e.currentTarget.dataset;t&&d(t)},handleButtonPointerUp:e=>{const{id:t}=e.currentTarget.dataset;t&&d(t)}}}),[c,d]);return(0,Ss.jsxs)(sF,{onOpenChange:l,open:s,children:[(0,Ss.jsx)(aF,{dir:"ltr",asChild:!0,children:(0,Ss.jsx)(sE,{type:"icon",className:"tlui-people-menu__user__color",style:{color:t.user.getColor()},title:o("people-menu.change-color"),children:(0,Ss.jsx)(ej,{icon:"color"})})}),(0,Ss.jsx)(lF,{container:n,children:(0,Ss.jsx)(cF,{dir:"ltr",className:"tlui-menu tlui-people-menu__user__color-picker",align:"start",side:"left",sideOffset:8,children:(0,Ss.jsx)("div",{className:"tlui-buttons__grid",children:Pd.map((e=>(0,Ss.jsx)(sE,{type:"icon","data-id":e,"data-testid":e,"aria-label":e,"data-state":c===e?"hinted":void 0,title:e,className:"tlui-button-grid__button",style:{color:e},onPointerEnter:p,onPointerDown:h,onPointerUp:f,onClick:u,children:(0,Ss.jsx)(ej,{icon:"color"})},e)))})})})]})}));function nH(){const t=Ns(),n=Zb(),o=yn("userName",(()=>t.user.getName()),[]),r=rE(),i=(0,e.useRef)(o),s=(0,e.useRef)(o),[a,l]=(0,e.useState)(!1),c=(0,e.useCallback)((()=>{l((e=>!e))}),[]),d=(0,e.useCallback)((e=>{s.current=e,t.user.updateUserPreferences({name:e})}),[t]),u=(0,e.useCallback)((()=>{i.current!==s.current&&(n("change-user-name",{source:"people-menu"}),i.current=s.current)}),[n]),h=(0,e.useCallback)((()=>{l(!1),t.user.updateUserPreferences({name:i.current}),t.menus.clearOpenMenus()}),[t]);return(0,Ss.jsxs)("div",{className:"tlui-people-menu__user",children:[(0,Ss.jsx)(tH,{}),a?(0,Ss.jsx)(sj,{className:"tlui-people-menu__user__input",defaultValue:o,onValueChange:d,onComplete:c,onCancel:h,onBlur:u,shouldManuallyMaintainScrollPositionWhenFocused:!0,autoFocus:!0,autoSelect:!0}):(0,Ss.jsxs)(Ss.Fragment,{children:[(0,Ss.jsx)("div",{className:"tlui-people-menu__user__name",onDoubleClick:()=>{a||l(!0)},children:o}),"New User"===o?(0,Ss.jsx)("div",{className:"tlui-people-menu__user__label",children:r("people-menu.user")}):null]}),(0,Ss.jsx)(sE,{type:"icon",className:"tlui-people-menu__user__edit","data-testid":"people-menu.change-name",title:r("people-menu.change-name"),onClick:c,children:(0,Ss.jsx)(ej,{icon:a?"check":"edit"})})]})}function oH(e){var t;let{displayUserWhenAlone:n,children:o}=e;const r=rE(),i=Va(),s=Ns(),a=uc(),l=yn("user",(()=>s.user.getColor()),[s]),c=yn("user",(()=>s.user.getName()),[s]),[d,u]=oA("people menu");return(0,Ss.jsxs)(sF,{onOpenChange:u,open:d,children:[(0,Ss.jsx)(aF,{dir:"ltr",asChild:!0,children:(0,Ss.jsxs)("button",{className:"tlui-people-menu__avatars-button",title:r("people-menu.title"),children:[a.length>5&&(0,Ss.jsx)(eH,{count:a.length-5}),(0,Ss.jsxs)("div",{className:"tlui-people-menu__avatars",children:[a.slice(-5).map((e=>(0,Ss.jsx)(QU,{userId:e},e))),(n||a.length>0)&&(0,Ss.jsx)("div",{className:"tlui-people-menu__avatar",style:{backgroundColor:l},children:"New User"===c?"":null!==(t=c[0])&&void 0!==t?t:""})]})]})}),(0,Ss.jsx)(lF,{container:i,children:(0,Ss.jsx)(cF,{dir:"ltr",className:"tlui-menu",side:"bottom",sideOffset:2,collisionPadding:4,onEscapeKeyDown:Da,children:(0,Ss.jsxs)("div",{className:"tlui-people-menu__wrapper",children:[(0,Ss.jsx)("div",{className:"tlui-people-menu__section",children:(0,Ss.jsx)(nH,{})}),a.length>0&&(0,Ss.jsx)("div",{className:"tlui-people-menu__section",children:a.map((e=>(0,Ss.jsx)(JU,{userId:e},e+"_presence")))}),o]})})})]})}function rH(){return(0,Ss.jsx)("div",{className:"tlui-share-zone",draggable:!1,children:(0,Ss.jsx)(oH,{displayUserWhenAlone:!0})})}const iH=Object.freeze([Qo,er,tr,rr]);function sH(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:iH;const t=Ns();return yn("getRelevantStyles",(()=>{var n;const o=new op(t.getSharedStyles()),r=!(null===(n=t.root.getCurrent())||void 0===n||!n.shapeType),i=t.isIn("select")&&t.getSelectedShapeIds().length>0;if(0===o.size&&t.isIn("select")&&0===t.getSelectedShapeIds().length)for(const s of e)o.applyValue(s,t.getStyleForNextShape(s));return r||i||o.size>0?o:null}),[t])}const aH={color:[{value:"black",icon:"color"},{value:"grey",icon:"color"},{value:"light-violet",icon:"color"},{value:"violet",icon:"color"},{value:"blue",icon:"color"},{value:"light-blue",icon:"color"},{value:"yellow",icon:"color"},{value:"orange",icon:"color"},{value:"green",icon:"color"},{value:"light-green",icon:"color"},{value:"light-red",icon:"color"},{value:"red",icon:"color"}],fill:[{value:"none",icon:"fill-none"},{value:"semi",icon:"fill-semi"},{value:"solid",icon:"fill-solid"},{value:"pattern",icon:"fill-pattern"}],dash:[{value:"draw",icon:"dash-draw"},{value:"dashed",icon:"dash-dashed"},{value:"dotted",icon:"dash-dotted"},{value:"solid",icon:"dash-solid"}],size:[{value:"s",icon:"size-small"},{value:"m",icon:"size-medium"},{value:"l",icon:"size-large"},{value:"xl",icon:"size-extra-large"}],font:[{value:"draw",icon:"font-draw"},{value:"sans",icon:"font-sans"},{value:"serif",icon:"font-serif"},{value:"mono",icon:"font-mono"}],textAlign:[{value:"start",icon:"text-align-left"},{value:"middle",icon:"text-align-center"},{value:"end",icon:"text-align-right"}],horizontalAlign:[{value:"start",icon:"horizontal-align-start"},{value:"middle",icon:"horizontal-align-middle"},{value:"end",icon:"horizontal-align-end"}],verticalAlign:[{value:"start",icon:"vertical-align-start"},{value:"middle",icon:"vertical-align-middle"},{value:"end",icon:"vertical-align-end"}],geo:[{value:"rectangle",icon:"geo-rectangle"},{value:"ellipse",icon:"geo-ellipse"},{value:"triangle",icon:"geo-triangle"},{value:"diamond",icon:"geo-diamond"},{value:"star",icon:"geo-star"},{value:"pentagon",icon:"geo-pentagon"},{value:"hexagon",icon:"geo-hexagon"},{value:"octagon",icon:"geo-octagon"},{value:"rhombus",icon:"geo-rhombus"},{value:"rhombus-2",icon:"geo-rhombus-2"},{value:"oval",icon:"geo-oval"},{value:"trapezoid",icon:"geo-trapezoid"},{value:"arrow-left",icon:"geo-arrow-left"},{value:"arrow-up",icon:"geo-arrow-up"},{value:"arrow-down",icon:"geo-arrow-down"},{value:"arrow-right",icon:"geo-arrow-right"},{value:"cloud",icon:"geo-cloud"},{value:"x-box",icon:"geo-x-box"},{value:"check-box",icon:"geo-check-box"},{value:"heart",icon:"geo-heart"}],arrowheadStart:[{value:"none",icon:"arrowhead-none"},{value:"arrow",icon:"arrowhead-arrow"},{value:"triangle",icon:"arrowhead-triangle"},{value:"square",icon:"arrowhead-square"},{value:"dot",icon:"arrowhead-dot"},{value:"diamond",icon:"arrowhead-diamond"},{value:"inverted",icon:"arrowhead-triangle-inverted"},{value:"bar",icon:"arrowhead-bar"}],arrowheadEnd:[{value:"none",icon:"arrowhead-none"},{value:"arrow",icon:"arrowhead-arrow"},{value:"triangle",icon:"arrowhead-triangle"},{value:"square",icon:"arrowhead-square"},{value:"dot",icon:"arrowhead-dot"},{value:"diamond",icon:"arrowhead-diamond"},{value:"inverted",icon:"arrowhead-triangle-inverted"},{value:"bar",icon:"arrowhead-bar"}],spline:[{value:"line",icon:"spline-line"},{value:"cubic",icon:"spline-cubic"}]},lH=(0,e.memo)((function(t){const{uiType:n,items:o,title:r,style:i,value:s,onValueChange:a,onHistoryMark:l,theme:c}=t,d=rE(),u=(0,e.useRef)(!1),h=(0,e.useRef)(null),{handleButtonClick:p,handleButtonPointerDown:f,handleButtonPointerEnter:g,handleButtonPointerUp:m}=(0,e.useMemo)((()=>{const e=()=>{u.current=!1,window.removeEventListener("pointerup",e);const t=h.current;t&&["TEXTAREA","INPUT"].includes(t.nodeName)&&t.focus(),h.current=null};return{handleButtonClick:e=>{const{id:t}=e.currentTarget.dataset;"shared"===s.type&&s.value===t||(null===l||void 0===l||l("point picker item"),a(i,t))},handleButtonPointerDown:t=>{const{id:n}=t.currentTarget.dataset;null===l||void 0===l||l("point picker item"),a(i,n),u.current=!0,h.current=document.activeElement,window.addEventListener("pointerup",e)},handleButtonPointerEnter:e=>{if(!u.current)return;const{id:t}=e.currentTarget.dataset;a(i,t)},handleButtonPointerUp:e=>{const{id:t}=e.currentTarget.dataset;"shared"===s.type&&s.value===t||a(i,t)}}}),[s,l,a,i]);return(0,Ss.jsx)("div",{"data-testid":"style.".concat(n),className:ks("tlui-buttons__grid"),children:o.map((e=>(0,Ss.jsx)(sE,{type:"icon","data-id":e.value,"data-testid":"style.".concat(n,".").concat(e.value),"aria-label":e.value,"data-state":"shared"===s.type&&s.value===e.value?"hinted":void 0,title:r+" \u2014 "+d("".concat(n,"-style.").concat(e.value)),className:ks("tlui-button-grid__button"),style:i===Qo?{color:c[e.value].solid}:void 0,onPointerEnter:g,onPointerDown:f,onPointerUp:m,onClick:p,children:(0,Ss.jsx)(ej,{icon:e.icon})},e.value)))})}));function cH(e,t){let[n,o]=t;return Math.min(o,Math.max(n,e))}const dH=["name","min","max","step","orientation","disabled","minStepsBetweenThumbs","defaultValue","value","onValueChange","onValueCommit","inverted","form"],uH=["min","max","dir","inverted","onSlideStart","onSlideMove","onSlideEnd","onStepKeyDown"],hH=["min","max","inverted","onSlideStart","onSlideMove","onSlideEnd","onStepKeyDown"],pH=["__scopeSlider","onSlideStart","onSlideMove","onSlideEnd","onHomeKeyDown","onEndKeyDown","onStepKeyDown"],fH=["__scopeSlider"],gH=["__scopeSlider"],mH=["__scopeSlider","index","name"],yH=["value"];var vH=["PageUp","PageDown"],bH=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],wH={"from-left":["Home","PageDown","ArrowDown","ArrowLeft"],"from-right":["Home","PageDown","ArrowDown","ArrowRight"],"from-bottom":["Home","PageDown","ArrowDown","ArrowLeft"],"from-top":["Home","PageDown","ArrowUp","ArrowLeft"]},xH="Slider",[SH,kH,PH]=mw(xH),[CH,_H]=tw(xH,[PH]),[IH,EH]=CH(xH),jH=e.forwardRef(((t,n)=>{const{name:o,min:r=0,max:i=100,step:s=1,orientation:a="horizontal",disabled:c=!1,minStepsBetweenThumbs:d=0,defaultValue:u=[r],value:h,onValueChange:p=()=>{},onValueCommit:f=()=>{},inverted:g=!1,form:m}=t,y=yr(t,dH),v=e.useRef(new Set),b=e.useRef(0),w="horizontal"===a?AH:OH,[x=[],S]=ik({prop:h,defaultProp:u,onChange:e=>{var t;null===(t=[...v.current][b.current])||void 0===t||t.focus(),p(e)}}),k=e.useRef(x);function P(e,t){let{commit:n}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{commit:!1};const o=function(e){return(String(e).split(".")[1]||"").length}(s),a=function(e,t){const n=Math.pow(10,t);return Math.round(e*n)/n}(Math.round((e-r)/s)*s+r,o),l=cH(a,[r,i]);S((function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const o=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;const o=[...e];return o[n]=t,o.sort(((e,t)=>e-t))}(e,l,t);if(function(e,t){if(t>0){const n=function(e){return e.slice(0,-1).map(((t,n)=>e[n+1]-t))}(e);return Math.min(...n)>=t}return!0}(o,d*s)){b.current=o.indexOf(l);const t=String(o)!==String(e);return t&&n&&f(o),t?o:e}return e}))}return(0,Ss.jsx)(IH,{scope:t.__scopeSlider,name:o,disabled:c,min:r,max:i,valueIndexToChangeRef:b,thumbs:v.current,values:x,orientation:a,form:m,children:(0,Ss.jsx)(SH.Provider,{scope:t.__scopeSlider,children:(0,Ss.jsx)(SH.Slot,{scope:t.__scopeSlider,children:(0,Ss.jsx)(w,l(l({"aria-disabled":c,"data-disabled":c?"":void 0},y),{},{ref:n,onPointerDown:Qb(y.onPointerDown,(()=>{c||(k.current=x)})),min:r,max:i,inverted:g,onSlideStart:c?void 0:function(e){const t=function(e,t){if(1===e.length)return 0;const n=e.map((e=>Math.abs(e-t))),o=Math.min(...n);return n.indexOf(o)}(x,e);P(e,t)},onSlideMove:c?void 0:function(e){P(e,b.current)},onSlideEnd:c?void 0:function(){const e=k.current[b.current];x[b.current]!==e&&f(x)},onHomeKeyDown:()=>!c&&P(r,0,{commit:!0}),onEndKeyDown:()=>!c&&P(i,x.length-1,{commit:!0}),onStepKeyDown:e=>{let{event:t,direction:n}=e;if(!c){const e=vH.includes(t.key)||t.shiftKey&&bH.includes(t.key)?10:1,o=b.current;P(x[o]+s*e*n,o,{commit:!0})}}}))})})})}));jH.displayName=xH;var[TH,MH]=CH(xH,{startEdge:"left",endEdge:"right",size:"width",direction:1}),AH=e.forwardRef(((t,n)=>{const{min:o,max:r,dir:i,inverted:s,onSlideStart:a,onSlideMove:c,onSlideEnd:d,onStepKeyDown:u}=t,h=yr(t,uH),[p,f]=e.useState(null),g=iw(n,(e=>f(e))),m=e.useRef(void 0),y=vw(i),v="ltr"===y,b=v&&!s||!v&&s;function w(e){const t=m.current||p.getBoundingClientRect(),n=VH([0,t.width],b?[o,r]:[r,o]);return m.current=t,n(e-t.left)}return(0,Ss.jsx)(TH,{scope:t.__scopeSlider,startEdge:b?"left":"right",endEdge:b?"right":"left",direction:b?1:-1,size:"width",children:(0,Ss.jsx)(DH,l(l({dir:y,"data-orientation":"horizontal"},h),{},{ref:g,style:l(l({},h.style),{},{"--radix-slider-thumb-transform":"translateX(-50%)"}),onSlideStart:e=>{const t=w(e.clientX);null===a||void 0===a||a(t)},onSlideMove:e=>{const t=w(e.clientX);null===c||void 0===c||c(t)},onSlideEnd:()=>{m.current=void 0,null===d||void 0===d||d()},onStepKeyDown:e=>{const t=wH[b?"from-left":"from-right"].includes(e.key);null===u||void 0===u||u({event:e,direction:t?-1:1})}}))})})),OH=e.forwardRef(((t,n)=>{const{min:o,max:r,inverted:i,onSlideStart:s,onSlideMove:a,onSlideEnd:c,onStepKeyDown:d}=t,u=yr(t,hH),h=e.useRef(null),p=iw(n,h),f=e.useRef(void 0),g=!i;function m(e){const t=f.current||h.current.getBoundingClientRect(),n=VH([0,t.height],g?[r,o]:[o,r]);return f.current=t,n(e-t.top)}return(0,Ss.jsx)(TH,{scope:t.__scopeSlider,startEdge:g?"bottom":"top",endEdge:g?"top":"bottom",size:"height",direction:g?1:-1,children:(0,Ss.jsx)(DH,l(l({"data-orientation":"vertical"},u),{},{ref:p,style:l(l({},u.style),{},{"--radix-slider-thumb-transform":"translateY(50%)"}),onSlideStart:e=>{const t=m(e.clientY);null===s||void 0===s||s(t)},onSlideMove:e=>{const t=m(e.clientY);null===a||void 0===a||a(t)},onSlideEnd:()=>{f.current=void 0,null===c||void 0===c||c()},onStepKeyDown:e=>{const t=wH[g?"from-bottom":"from-top"].includes(e.key);null===d||void 0===d||d({event:e,direction:t?-1:1})}}))})})),DH=e.forwardRef(((e,t)=>{const{__scopeSlider:n,onSlideStart:o,onSlideMove:r,onSlideEnd:i,onHomeKeyDown:s,onEndKeyDown:a,onStepKeyDown:c}=e,d=yr(e,pH),u=EH(xH,n);return(0,Ss.jsx)(pw.span,l(l({},d),{},{ref:t,onKeyDown:Qb(e.onKeyDown,(e=>{"Home"===e.key?(s(e),e.preventDefault()):"End"===e.key?(a(e),e.preventDefault()):vH.concat(bH).includes(e.key)&&(c(e),e.preventDefault())})),onPointerDown:Qb(e.onPointerDown,(e=>{const t=e.target;t.setPointerCapture(e.pointerId),e.preventDefault(),u.thumbs.has(t)?t.focus():o(e)})),onPointerMove:Qb(e.onPointerMove,(e=>{e.target.hasPointerCapture(e.pointerId)&&r(e)})),onPointerUp:Qb(e.onPointerUp,(e=>{const t=e.target;t.hasPointerCapture(e.pointerId)&&(t.releasePointerCapture(e.pointerId),i(e))}))}))})),RH="SliderTrack",LH=e.forwardRef(((e,t)=>{const{__scopeSlider:n}=e,o=yr(e,fH),r=EH(RH,n);return(0,Ss.jsx)(pw.span,l(l({"data-disabled":r.disabled?"":void 0,"data-orientation":r.orientation},o),{},{ref:t}))}));LH.displayName=RH;var zH="SliderRange",NH=e.forwardRef(((t,n)=>{const{__scopeSlider:o}=t,r=yr(t,gH),i=EH(zH,o),s=MH(zH,o),a=iw(n,e.useRef(null)),c=i.values.length,d=i.values.map((e=>KH(e,i.min,i.max))),u=c>1?Math.min(...d):0,h=100-Math.max(...d);return(0,Ss.jsx)(pw.span,l(l({"data-orientation":i.orientation,"data-disabled":i.disabled?"":void 0},r),{},{ref:a,style:l(l({},t.style),{},{[s.startEdge]:u+"%",[s.endEdge]:h+"%"})}))}));NH.displayName=zH;var FH="SliderThumb",BH=e.forwardRef(((t,n)=>{const o=kH(t.__scopeSlider),[r,i]=e.useState(null),s=iw(n,(e=>i(e))),a=e.useMemo((()=>r?o().findIndex((e=>e.ref.current===r)):-1),[o,r]);return(0,Ss.jsx)(UH,l(l({},t),{},{ref:s,index:a}))})),UH=e.forwardRef(((t,n)=>{const{__scopeSlider:o,index:r,name:i}=t,s=yr(t,mH),a=EH(FH,o),c=MH(FH,o),[d,u]=e.useState(null),h=iw(n,(e=>u(e))),p=!d||(a.form||!!d.closest("form")),f=jS(d),g=a.values[r],m=void 0===g?0:KH(g,a.min,a.max),y=function(e,t){return t>2?"Value ".concat(e+1," of ").concat(t):2===t?["Minimum","Maximum"][e]:void 0}(r,a.values.length),v=null===f||void 0===f?void 0:f[c.size],b=v?function(e,t,n){const o=e/2,r=VH([0,50],[0,o]);return(o-r(t)*n)*n}(v,m,c.direction):0;return e.useEffect((()=>{if(d)return a.thumbs.add(d),()=>{a.thumbs.delete(d)}}),[d,a.thumbs]),(0,Ss.jsxs)("span",{style:{transform:"var(--radix-slider-thumb-transform)",position:"absolute",[c.startEdge]:"calc(".concat(m,"% + ").concat(b,"px)")},children:[(0,Ss.jsx)(SH.ItemSlot,{scope:t.__scopeSlider,children:(0,Ss.jsx)(pw.span,l(l({role:"slider","aria-label":t["aria-label"]||y,"aria-valuemin":a.min,"aria-valuenow":g,"aria-valuemax":a.max,"aria-orientation":a.orientation,"data-orientation":a.orientation,"data-disabled":a.disabled?"":void 0,tabIndex:a.disabled?void 0:0},s),{},{ref:h,style:void 0===g?{display:"none"}:t.style,onFocus:Qb(t.onFocus,(()=>{a.valueIndexToChangeRef.current=r}))}))}),p&&(0,Ss.jsx)(HH,{name:null!==i&&void 0!==i?i:a.name?a.name+(a.values.length>1?"[]":""):void 0,form:a.form,value:g},r)]})}));BH.displayName=FH;var HH=t=>{const{value:n}=t,o=yr(t,yH),r=e.useRef(null),i=function(t){const n=e.useRef({value:t,previous:t});return e.useMemo((()=>(n.current.value!==t&&(n.current.previous=n.current.value,n.current.value=t),n.current.previous)),[t])}(n);return e.useEffect((()=>{const e=r.current,t=window.HTMLInputElement.prototype,o=Object.getOwnPropertyDescriptor(t,"value").set;if(i!==n&&o){const t=new Event("input",{bubbles:!0});o.call(e,n),e.dispatchEvent(t)}}),[i,n]),(0,Ss.jsx)("input",l(l({style:{display:"none"}},o),{},{ref:r,defaultValue:n}))};function KH(e,t,n){return cH(100/(n-t)*(e-t),[0,100])}function VH(e,t){return n=>{if(e[0]===e[1]||t[0]===t[1])return t[0];const o=(t[1]-t[0])/(e[1]-e[0]);return t[0]+o*(n-e[0])}}var WH=jH,qH=LH,YH=NH,GH=BH;const XH=(0,e.memo)((function(t){let{onHistoryMark:n,title:o,steps:r,value:i,label:s,onValueChange:a,"data-testid":l}=t;const c=rE(),d=(0,e.useCallback)((e=>{a(e[0])}),[a]),u=(0,e.useCallback)((()=>{n("click slider")}),[n]),h=(0,e.useCallback)((()=>{i&&a(i)}),[i,a]);return(0,Ss.jsx)("div",{className:"tlui-slider__container",children:(0,Ss.jsxs)(WH,{"data-testid":l,className:"tlui-slider","area-label":"Opacity",dir:"ltr",min:0,max:r,step:1,value:i?[i]:void 0,onPointerDown:u,onValueChange:d,onPointerUp:h,title:o+" \u2014 "+c(s),children:[(0,Ss.jsx)(qH,{className:"tlui-slider__track",dir:"ltr",children:null!==i&&(0,Ss.jsx)(YH,{className:"tlui-slider__range",dir:"ltr"})}),null!==i&&(0,Ss.jsx)(GH,{className:"tlui-slider__thumb",dir:"ltr"})]})})}));const $H=e.memo((function(t){let{label:n,uiTypeA:o,uiTypeB:r,labelA:i,labelB:s,itemsA:a,itemsB:l,styleA:c,styleB:d,valueA:u,valueB:h,onValueChange:p}=t;const f=rE(),g=e.useMemo((()=>{var e,t;return null!==(e=null===(t=a.find((e=>"shared"===u.type&&u.value===e.value)))||void 0===t?void 0:t.icon)&&void 0!==e?e:"mixed"}),[a,u]),m=e.useMemo((()=>{var e,t;return null!==(e=null===(t=l.find((e=>"shared"===h.type&&h.value===e.value)))||void 0===t?void 0:t.icon)&&void 0!==e?e:"mixed"}),[l,h]);return void 0===u&&void 0===h?null:(0,Ss.jsxs)("div",{className:"tlui-style-panel__double-select-picker",children:[(0,Ss.jsx)("div",{title:f(n),className:"tlui-style-panel__double-select-picker-label",children:f(n)}),(0,Ss.jsxs)("div",{className:"tlui-buttons__horizontal",children:[(0,Ss.jsxs)(iA,{id:"style panel ".concat(o," A"),children:[(0,Ss.jsx)(sA,{children:(0,Ss.jsx)(sE,{type:"icon","data-testid":"style.".concat(o),title:f(i)+" \u2014 "+(null===u||"mixed"===u.type?f("style-panel.mixed"):f("".concat(o,"-style.").concat(u.value))),children:(0,Ss.jsx)(ej,{icon:g,small:!0,invertIcon:!0})})}),(0,Ss.jsx)(aA,{side:"left",align:"center",sideOffset:80,alignOffset:0,children:(0,Ss.jsx)("div",{className:"tlui-buttons__grid",children:a.map(((e,t)=>(0,Ss.jsx)(hA,{"data-testid":"style.".concat(o,".").concat(e.value),children:(0,Ss.jsx)(sE,{type:"icon",onClick:()=>p(c,e.value),title:"".concat(f(i)," \u2014 ").concat(f("".concat(o,"-style.").concat(e.value))),children:(0,Ss.jsx)(ej,{icon:e.icon,invertIcon:!0})},e.value)},t)))})})]}),(0,Ss.jsxs)(iA,{id:"style panel ".concat(r),children:[(0,Ss.jsx)(sA,{children:(0,Ss.jsx)(sE,{type:"icon","data-testid":"style.".concat(r),title:f(s)+" \u2014 "+(null===h||"mixed"===h.type?f("style-panel.mixed"):f("".concat(r,"-style.").concat(h.value))),children:(0,Ss.jsx)(ej,{icon:m,small:!0})})}),(0,Ss.jsx)(aA,{side:"left",align:"center",sideOffset:116,alignOffset:0,children:(0,Ss.jsx)("div",{className:"tlui-buttons__grid",children:l.map((e=>(0,Ss.jsx)(hA,{children:(0,Ss.jsx)(sE,{type:"icon",title:"".concat(f(s)," \u2014 ").concat(f("".concat(r,"-style.").concat(e.value))),"data-testid":"style.".concat(r,".").concat(e.value),onClick:()=>p(d,e.value),children:(0,Ss.jsx)(ej,{icon:e.icon})})},e.value)))})})]})]})]})}));const ZH=e.memo((function(t){let{id:n,label:o,uiType:r,stylePanelType:i,style:s,items:a,type:l,value:c,onValueChange:d}=t;const u=rE(),h=Ns(),p=e.useMemo((()=>{var e;return null===(e=a.find((e=>"shared"===c.type&&e.value===c.value)))||void 0===e?void 0:e.icon}),[a,c]),f=u("style-panel.".concat(i)),g="mixed"===c.type?u("style-panel.mixed"):f+" \u2014 "+u("".concat(r,"-style.").concat(c.value)),m=o?u(o):"";return(0,Ss.jsxs)(iA,{id:"style panel ".concat(n),children:[(0,Ss.jsx)(sA,{children:(0,Ss.jsxs)(sE,{type:l,"data-testid":"style.".concat(r),title:g,children:[m&&(0,Ss.jsx)(aE,{children:m}),(0,Ss.jsx)(ej,{icon:null!==p&&void 0!==p?p:"mixed"})]})}),(0,Ss.jsx)(aA,{side:"left",align:"center",alignOffset:0,children:(0,Ss.jsx)("div",{className:"tlui-buttons__grid",children:a.map((e=>(0,Ss.jsx)(hA,{children:(0,Ss.jsx)(sE,{type:"icon","data-testid":"style.".concat(r,".").concat(e.value),title:f+" \u2014 "+u("".concat(r,"-style.").concat(e.value)),onClick:()=>{h.markHistoryStoppingPoint("select style dropdown item"),d(s,e.value)},children:(0,Ss.jsx)(ej,{icon:e.icon})})},e.value)))})})]})}));function QH(e){let{styles:t}=e;const n=lv();if(!t)return null;const o=t.get(Ui),r=t.get(ar),i=t.get(sr),s=void 0===o,a=void 0===r&&void 0===i,l=void 0===t.get(Ji),c=void 0===t.get(nr),d=Zo({isDarkMode:n});return(0,Ss.jsxs)(Ss.Fragment,{children:[(0,Ss.jsx)(eK,{theme:d,styles:t}),!c&&(0,Ss.jsx)(tK,{theme:d,styles:t}),!(s&&a&&l)&&(0,Ss.jsxs)("div",{className:"tlui-style-panel__section","aria-label":"style panel styles",children:[(0,Ss.jsx)(nK,{styles:t}),(0,Ss.jsx)(rK,{styles:t}),(0,Ss.jsx)(oK,{styles:t})]})]})}function JH(){const t=Ns(),n=Zb();return e.useMemo((()=>function(e,o){t.run((()=>{t.isIn("select")&&t.setStyleForSelectedShapes(e,o),t.setStyleForNextShapes(e,o),t.updateInstanceState({isChangingStyle:!0})})),n("set-style",{source:"style-panel",id:e.id,value:o})}),[t,n])}function eK(t){let{styles:n,theme:o}=t;const r=rE(),i=Ns(),s=(0,e.useCallback)((e=>i.markHistoryStoppingPoint(e)),[i]),a=JH(),l=n.get(Qo),c=n.get(tr),d=n.get(er),u=n.get(rr),h=void 0!==c||void 0!==d||void 0!==u;return(0,Ss.jsxs)(Ss.Fragment,{children:[(0,Ss.jsxs)("div",{tabIndex:-1,className:"tlui-style-panel__section__common","aria-label":"style panel styles","data-testid":"style.panel",children:[void 0===l?null:(0,Ss.jsx)(lH,{title:r("style-panel.color"),uiType:"color",style:Qo,items:aH.color,value:l,onValueChange:a,theme:o,onHistoryMark:s}),(0,Ss.jsx)(sK,{})]}),h&&(0,Ss.jsxs)("div",{className:"tlui-style-panel__section","aria-label":"style panel styles",children:[void 0===c?null:(0,Ss.jsx)(lH,{title:r("style-panel.fill"),uiType:"fill",style:tr,items:aH.fill,value:c,onValueChange:a,theme:o,onHistoryMark:s}),void 0===d?null:(0,Ss.jsx)(lH,{title:r("style-panel.dash"),uiType:"dash",style:er,items:aH.dash,value:d,onValueChange:a,theme:o,onHistoryMark:s}),void 0===u?null:(0,Ss.jsx)(lH,{title:r("style-panel.size"),uiType:"size",style:rr,items:aH.size,value:u,onValueChange:(e,t)=>{a(e,t);const n=i.getSelectedShapeIds();n.length>0&&WI(i,n)},theme:o,onHistoryMark:s})]})]})}function tK(t){let{theme:n,styles:o}=t;const r=rE(),i=JH(),s=Ns(),a=(0,e.useCallback)((e=>s.markHistoryStoppingPoint(e)),[s]),l=o.get(nr),c=o.get(as),d=o.get(Fi),u=o.get(Bi);return void 0===l&&void 0===d?null:(0,Ss.jsxs)("div",{className:"tlui-style-panel__section","aria-label":"style panel text",children:[void 0===l?null:(0,Ss.jsx)(lH,{title:r("style-panel.font"),uiType:"font",style:nr,items:aH.font,value:l,onValueChange:i,theme:n,onHistoryMark:a}),void 0===c?null:(0,Ss.jsxs)("div",{className:"tlui-style-panel__row",children:[(0,Ss.jsx)(lH,{title:r("style-panel.align"),uiType:"align",style:as,items:aH.textAlign,value:c,onValueChange:i,theme:n,onHistoryMark:a}),(0,Ss.jsx)("div",{className:"tlui-style-panel__row__extra-button",children:(0,Ss.jsx)(sE,{type:"icon",title:r("style-panel.vertical-align"),"data-testid":"vertical-align",disabled:!0,children:(0,Ss.jsx)(ej,{icon:"vertical-align-middle"})})})]}),void 0===d?null:(0,Ss.jsxs)("div",{className:"tlui-style-panel__row",children:[(0,Ss.jsx)(lH,{title:r("style-panel.label-align"),uiType:"align",style:Fi,items:aH.horizontalAlign,value:d,onValueChange:i,theme:n,onHistoryMark:a}),(0,Ss.jsx)("div",{className:"tlui-style-panel__row__extra-button",children:void 0===u?(0,Ss.jsx)(sE,{type:"icon",title:r("style-panel.vertical-align"),"data-testid":"vertical-align",disabled:!0,children:(0,Ss.jsx)(ej,{icon:"vertical-align-middle"})}):(0,Ss.jsx)(ZH,{type:"icon",id:"geo-vertical-alignment",uiType:"verticalAlign",stylePanelType:"vertical-align",style:Bi,items:aH.verticalAlign,value:u,onValueChange:i})})]})]})}function nK(e){let{styles:t}=e;const n=JH(),o=t.get(Ui);return void 0===o?null:(0,Ss.jsx)(ZH,{id:"geo",type:"menu",label:"style-panel.geo",uiType:"geo",stylePanelType:"geo",style:Ui,items:aH.geo,value:o,onValueChange:n})}function oK(e){let{styles:t}=e;const n=JH(),o=t.get(Ji);return void 0===o?null:(0,Ss.jsx)(ZH,{id:"spline",type:"menu",label:"style-panel.spline",uiType:"spline",stylePanelType:"spline",style:Ji,items:aH.spline,value:o,onValueChange:n})}function rK(e){let{styles:t}=e;const n=JH(),o=t.get(ar),r=t.get(sr);return o&&r?(0,Ss.jsx)($H,{label:"style-panel.arrowheads",uiTypeA:"arrowheadStart",styleA:sr,itemsA:aH.arrowheadStart,valueA:r,uiTypeB:"arrowheadEnd",styleB:ar,itemsB:aH.arrowheadEnd,valueB:o,onValueChange:n,labelA:"style-panel.arrowhead-start",labelB:"style-panel.arrowhead-end"}):null}const iK=[.1,.25,.5,.75,1];function sK(){const t=Ns(),n=(0,e.useCallback)((e=>t.markHistoryStoppingPoint(e)),[t]),o=yn("opacity",(()=>t.getSharedOpacity()),[t]),r=Zb(),i=rE(),s=e.useCallback((e=>{const n=iK[e];t.run((()=>{t.isIn("select")&&t.setOpacityForSelectedShapes(n),t.setOpacityForNextShapes(n),t.updateInstanceState({isChangingStyle:!0})})),r("set-style",{source:"style-panel",id:"opacity",value:e})}),[t,r]);if(void 0===o)return null;const a="mixed"===o.type?-1:iK.indexOf(function(e,t){let n,o=1/0;for(const r of e){const e=t(r);e<o&&(n=r,o=e)}return n}(iK,(e=>Math.abs(e-o.value))));return(0,Ss.jsx)(XH,{"data-testid":"style.opacity",value:a>=0?a:iK.length-1,label:"mixed"===o.type?"style-panel.mixed":"opacity-style.".concat(o.value),onValueChange:s,steps:iK.length-1,title:i("style-panel.opacity"),onHistoryMark:n})}const aK=(0,e.memo)((function(t){let{isMobile:n,children:o}=t;const r=Ns(),i=(0,e.useRef)(null);cb(i);const s=sH(),a=(0,e.useCallback)((()=>{n||r.updateInstanceState({isChangingStyle:!1})}),[r,n]),l=null!==o&&void 0!==o?o:(0,Ss.jsx)(QH,{styles:s});return(0,Ss.jsx)("div",{ref:i,className:ks("tlui-style-panel",{"tlui-style-panel__wrapper":!n}),"data-ismobile":n,onPointerLeave:a,children:l})}));function lK(){const t=Ns(),n=rE(),o=sH(),r=null===o||void 0===o?void 0:o.get(Qo),i=Zo({isDarkMode:t.user.getIsDarkMode()}),s=("shared"===(null===r||void 0===r?void 0:r.type)?i[r.value]:i.black).solid,a=yn("disable style panel",(()=>t.isInAny("hand","zoom","eraser","laser")),[t]),l=(0,e.useCallback)((e=>{e||t.updateInstanceState({isChangingStyle:!1})}),[t]),{StylePanel:c}=CV();return c?(0,Ss.jsxs)(dF,{id:"mobile style menu",onOpenChange:l,children:[(0,Ss.jsx)(uF,{children:(0,Ss.jsx)(sE,{type:"tool","data-testid":"mobile-styles.button",style:{color:a?"var(--color-muted-1)":s},title:n("style-panel.title"),disabled:a,children:(0,Ss.jsx)(ej,{icon:a?"blob":"mixed"===(null===r||void 0===r?void 0:r.type)?"mixed":"blob"})})}),(0,Ss.jsx)(hF,{side:"top",align:"end",children:c&&(0,Ss.jsx)(c,{isMobile:!0})})]}):null}function cK(){return(0,Ss.jsxs)(Ss.Fragment,{children:[(0,Ss.jsx)(hK,{}),(0,Ss.jsx)(pK,{}),(0,Ss.jsx)(fK,{}),(0,Ss.jsx)(gK,{}),(0,Ss.jsx)(mK,{}),(0,Ss.jsx)(yK,{}),(0,Ss.jsx)(vK,{}),(0,Ss.jsx)(bK,{}),(0,Ss.jsx)(wK,{}),(0,Ss.jsx)(xK,{}),(0,Ss.jsx)(kK,{}),(0,Ss.jsx)(SK,{}),(0,Ss.jsx)(_K,{}),(0,Ss.jsx)(jK,{}),(0,Ss.jsx)(PK,{}),(0,Ss.jsx)(EK,{}),(0,Ss.jsx)(IK,{}),(0,Ss.jsx)(CK,{}),(0,Ss.jsx)(TK,{}),(0,Ss.jsx)(MK,{}),(0,Ss.jsx)(AK,{}),(0,Ss.jsx)(OK,{}),(0,Ss.jsx)(DK,{}),(0,Ss.jsx)(RK,{}),(0,Ss.jsx)(LK,{}),(0,Ss.jsx)(zK,{}),(0,Ss.jsx)(FK,{}),(0,Ss.jsx)(NK,{})]})}function dK(e){var t;const n=Ns(),o=null===(t=e.meta)||void 0===t?void 0:t.geo;return yn("is tool selected",(()=>{const t=n.getCurrentToolId(),r=n.getSharedStyles().getAsKnownValue(Ui);return o?"geo"===t&&r===o:t===e.id}),[n,e.id,o])}function uK(e){let{tool:t}=e;const n=dK(MA()[t]);return(0,Ss.jsx)(OA,{toolId:t,isSelected:n})}function hK(){return(0,Ss.jsx)(uK,{tool:"select"})}function pK(){return(0,Ss.jsx)(uK,{tool:"hand"})}function fK(){return(0,Ss.jsx)(uK,{tool:"draw"})}function gK(){return(0,Ss.jsx)(uK,{tool:"eraser"})}function mK(){return(0,Ss.jsx)(uK,{tool:"arrow"})}function yK(){return(0,Ss.jsx)(uK,{tool:"text"})}function vK(){return(0,Ss.jsx)(uK,{tool:"note"})}function bK(){return(0,Ss.jsx)(OA,{toolId:"asset"})}function wK(){return(0,Ss.jsx)(uK,{tool:"rectangle"})}function xK(){return(0,Ss.jsx)(uK,{tool:"ellipse"})}function SK(){return(0,Ss.jsx)(uK,{tool:"diamond"})}function kK(){return(0,Ss.jsx)(uK,{tool:"triangle"})}function PK(){return(0,Ss.jsx)(uK,{tool:"rhombus"})}function CK(){return(0,Ss.jsx)(uK,{tool:"heart"})}function _K(){return(0,Ss.jsx)(uK,{tool:"hexagon"})}function IK(){return(0,Ss.jsx)(uK,{tool:"cloud"})}function EK(){return(0,Ss.jsx)(uK,{tool:"star"})}function jK(){return(0,Ss.jsx)(uK,{tool:"oval"})}function TK(){return(0,Ss.jsx)(uK,{tool:"x-box"})}function MK(){return(0,Ss.jsx)(uK,{tool:"check-box"})}function AK(){return(0,Ss.jsx)(uK,{tool:"arrow-left"})}function OK(){return(0,Ss.jsx)(uK,{tool:"arrow-up"})}function DK(){return(0,Ss.jsx)(uK,{tool:"arrow-down"})}function RK(){return(0,Ss.jsx)(uK,{tool:"arrow-right"})}function LK(){return(0,Ss.jsx)(uK,{tool:"line"})}function zK(){return(0,Ss.jsx)(uK,{tool:"highlight"})}function NK(){return(0,Ss.jsx)(uK,{tool:"frame"})}function FK(){return(0,Ss.jsx)(uK,{tool:"laser"})}const BK="undefined"!==typeof navigator&&navigator.userAgent.toLowerCase().indexOf("firefox")>0;function UK(e,t,n,o){e.addEventListener?e.addEventListener(t,n,o):e.attachEvent&&e.attachEvent("on".concat(t),n)}function HK(e,t,n,o){e.removeEventListener?e.removeEventListener(t,n,o):e.detachEvent&&e.detachEvent("on".concat(t),n)}function KK(e,t){const n=t.slice(0,t.length-1);for(let o=0;o<n.length;o++)n[o]=e[n[o].toLowerCase()];return n}function VK(e){"string"!==typeof e&&(e="");const t=(e=e.replace(/\s/g,"")).split(",");let n=t.lastIndexOf("");for(;n>=0;)t[n-1]+=",",t.splice(n,1),n=t.lastIndexOf("");return t}const WK={backspace:8,"\u232b":8,tab:9,clear:12,enter:13,"\u21a9":13,return:13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,del:46,delete:46,ins:45,insert:45,home:36,end:35,pageup:33,pagedown:34,capslock:20,num_0:96,num_1:97,num_2:98,num_3:99,num_4:100,num_5:101,num_6:102,num_7:103,num_8:104,num_9:105,num_multiply:106,num_add:107,num_enter:108,num_subtract:109,num_decimal:110,num_divide:111,"\u21ea":20,",":188,".":190,"/":191,"`":192,"-":BK?173:189,"=":BK?61:187,";":BK?59:186,"'":222,"[":219,"]":221,"\\":220},qK={"\u21e7":16,shift:16,"\u2325":18,alt:18,option:18,"\u2303":17,ctrl:17,control:17,"\u2318":91,cmd:91,command:91},YK={16:"shiftKey",18:"altKey",17:"ctrlKey",91:"metaKey",shiftKey:16,ctrlKey:17,altKey:18,metaKey:91},GK={16:!1,18:!1,17:!1,91:!1},XK={};for(let n=1;n<20;n++)WK["f".concat(n)]=111+n;let $K=[],ZK=null,QK="all";const JK=new Map,eV=e=>WK[e.toLowerCase()]||qK[e.toLowerCase()]||e.toUpperCase().charCodeAt(0);function tV(e){QK=e||"all"}function nV(){return QK||"all"}function oV(e){if("undefined"===typeof e)Object.keys(XK).forEach((e=>{Array.isArray(XK[e])&&XK[e].forEach((e=>rV(e))),delete XK[e]})),lV(null);else if(Array.isArray(e))e.forEach((e=>{e.key&&rV(e)}));else if("object"===typeof e)e.key&&rV(e);else if("string"===typeof e){for(var t=arguments.length,n=new Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];let[r,i]=n;"function"===typeof r&&(i=r,r=""),rV({key:e,scope:r,method:i,splitKey:"+"})}}const rV=e=>{let{key:t,scope:n,method:o,splitKey:r="+"}=e;VK(t).forEach((e=>{const t=e.split(r),i=t.length,s=t[i-1],a="*"===s?"*":eV(s);if(!XK[a])return;n||(n=nV());const l=i>1?KK(qK,t):[],c=[];XK[a]=XK[a].filter((e=>{const t=(!o||e.method===o)&&e.scope===n&&function(e,t){const n=e.length>=t.length?e:t,o=e.length>=t.length?t:e;let r=!0;for(let i=0;i<n.length;i++)-1===o.indexOf(n[i])&&(r=!1);return r}(e.mods,l);return t&&c.push(e.element),!t})),c.forEach((e=>lV(e)))}))};function iV(e,t,n,o){if(t.element!==o)return;let r;if(t.scope===n||"all"===t.scope){r=t.mods.length>0;for(const e in GK)Object.prototype.hasOwnProperty.call(GK,e)&&(!GK[e]&&t.mods.indexOf(+e)>-1||GK[e]&&-1===t.mods.indexOf(+e))&&(r=!1);(0!==t.mods.length||GK[16]||GK[18]||GK[17]||GK[91])&&!r&&"*"!==t.shortcut||(t.keys=[],t.keys=t.keys.concat($K),!1===t.method(e,t)&&(e.preventDefault?e.preventDefault():e.returnValue=!1,e.stopPropagation&&e.stopPropagation(),e.cancelBubble&&(e.cancelBubble=!0)))}}function sV(e,t){const n=XK["*"];let o=e.keyCode||e.which||e.charCode;if(!aV.filter.call(this,e))return;if(93!==o&&224!==o||(o=91),-1===$K.indexOf(o)&&229!==o&&$K.push(o),["metaKey","ctrlKey","altKey","shiftKey"].forEach((t=>{const n=YK[t];e[t]&&-1===$K.indexOf(n)?$K.push(n):!e[t]&&$K.indexOf(n)>-1?$K.splice($K.indexOf(n),1):"metaKey"===t&&e[t]&&($K=$K.filter((e=>e in YK||e===o)))})),o in GK){GK[o]=!0;for(const e in qK)qK[e]===o&&(aV[e]=!0);if(!n)return}for(const a in GK)Object.prototype.hasOwnProperty.call(GK,a)&&(GK[a]=e[YK[a]]);e.getModifierState&&(!e.altKey||e.ctrlKey)&&e.getModifierState("AltGraph")&&(-1===$K.indexOf(17)&&$K.push(17),-1===$K.indexOf(18)&&$K.push(18),GK[17]=!0,GK[18]=!0);const r=nV();if(n)for(let a=0;a<n.length;a++)n[a].scope===r&&("keydown"===e.type&&n[a].keydown||"keyup"===e.type&&n[a].keyup)&&iV(e,n[a],r,t);if(!(o in XK))return;const i=XK[o],s=i.length;for(let a=0;a<s;a++)if(("keydown"===e.type&&i[a].keydown||"keyup"===e.type&&i[a].keyup)&&i[a].key){const n=i[a],{splitKey:o}=n,s=n.key.split(o),l=[];for(let e=0;e<s.length;e++)l.push(eV(s[e]));l.sort().join("")===$K.sort().join("")&&iV(e,n,r,t)}}function aV(e,t,n){$K=[];const o=VK(e);let r=[],i="all",s=document,a=0,l=!1,c=!0,d="+",u=!1,h=!1;for(void 0===n&&"function"===typeof t&&(n=t),"[object Object]"===Object.prototype.toString.call(t)&&(t.scope&&(i=t.scope),t.element&&(s=t.element),t.keyup&&(l=t.keyup),void 0!==t.keydown&&(c=t.keydown),void 0!==t.capture&&(u=t.capture),"string"===typeof t.splitKey&&(d=t.splitKey),!0===t.single&&(h=!0)),"string"===typeof t&&(i=t),h&&oV(e,i);a<o.length;a++)r=[],(e=o[a].split(d)).length>1&&(r=KK(qK,e)),(e="*"===(e=e[e.length-1])?"*":eV(e))in XK||(XK[e]=[]),XK[e].push({keyup:l,keydown:c,scope:i,mods:r,shortcut:o[a],method:n,key:o[a],splitKey:d,element:s});if("undefined"!==typeof s&&window){if(!JK.has(s)){const e=function(){return sV(arguments.length>0&&void 0!==arguments[0]?arguments[0]:window.event,s)},t=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window.event;sV(e,s),function(e){let t=e.keyCode||e.which||e.charCode;const n=$K.indexOf(t);if(n>=0&&$K.splice(n,1),e.key&&"meta"===e.key.toLowerCase()&&$K.splice(0,$K.length),93!==t&&224!==t||(t=91),t in GK){GK[t]=!1;for(const e in qK)qK[e]===t&&(aV[e]=!1)}}(e)};JK.set(s,{keydownListener:e,keyupListenr:t,capture:u}),UK(s,"keydown",e,u),UK(s,"keyup",t,u)}if(!ZK){const e=()=>{$K=[]};ZK={listener:e,capture:u},UK(window,"focus",e,u)}}}function lV(e){const t=Object.values(XK).flat();if(t.findIndex((t=>{let{element:n}=t;return n===e}))<0){const{keydownListener:t,keyupListenr:n,capture:o}=JK.get(e)||{};t&&n&&(HK(e,"keyup",n,o),HK(e,"keydown",t,o),JK.delete(e))}if(t.length<=0||JK.size<=0){if(Object.keys(JK).forEach((e=>{const{keydownListener:t,keyupListenr:n,capture:o}=JK.get(e)||{};t&&n&&(HK(e,"keyup",n,o),HK(e,"keydown",t,o),JK.delete(e))})),JK.clear(),Object.keys(XK).forEach((e=>delete XK[e])),ZK){const{listener:e,capture:t}=ZK;HK(window,"focus",e,t),ZK=null}}}const cV={getPressedKeyString:function(){return $K.map((e=>{return t=e,Object.keys(WK).find((e=>WK[e]===t))||(e=>Object.keys(qK).find((t=>qK[t]===e)))(e)||String.fromCharCode(e);var t}))},setScope:tV,getScope:nV,deleteScope:function(e,t){let n,o;e||(e=nV());for(const r in XK)if(Object.prototype.hasOwnProperty.call(XK,r))for(n=XK[r],o=0;o<n.length;)if(n[o].scope===e){n.splice(o,1).forEach((e=>{let{element:t}=e;return lV(t)}))}else o++;nV()===e&&tV(t||"all")},getPressedKeyCodes:function(){return $K.slice(0)},getAllKeyCodes:function(){const e=[];return Object.keys(XK).forEach((t=>{XK[t].forEach((t=>{let{key:n,scope:o,mods:r,shortcut:i}=t;e.push({scope:o,shortcut:i,mods:r,keys:n.split("+").map((e=>eV(e)))})}))})),e},isPressed:function(e){return"string"===typeof e&&(e=eV(e)),-1!==$K.indexOf(e)},filter:function(e){const t=e.target||e.srcElement,{tagName:n}=t;let o=!0;const r="INPUT"===n&&!["checkbox","radio","range","button","file","reset","submit","color"].includes(t.type);return(t.isContentEditable||(r||"TEXTAREA"===n||"SELECT"===n)&&!t.readOnly)&&(o=!1),o},trigger:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"all";Object.keys(XK).forEach((n=>{XK[n].filter((n=>n.scope===t&&n.shortcut===e)).forEach((e=>{e&&e.method&&e.method()}))}))},unbind:oV,keyMap:WK,modifier:qK,modifierMap:YK};for(const n in cV)Object.prototype.hasOwnProperty.call(cV,n)&&(aV[n]=cV[n]);if("undefined"!==typeof window){const e=window.hotkeys;aV.noConflict=t=>(t&&window.hotkeys===aV&&(window.hotkeys=e),aV),window.hotkeys=aV}const dV=["copy","cut","paste","asset"];function uV(e){return function(e){"string"!==typeof e&&(e="");const t=(e=e.replace(/\s/g,"")).split(",");let n=t.lastIndexOf("");for(;n>=0;)t[n-1]+=",",t.splice(n,1),n=t.lastIndexOf("");return t}(e).map((e=>{let t="";const n=e.split("");return t=1===n.length?n[0]:"!"===n[0]?"shift+".concat(n[1]):"?"===n[0]?3===n.length&&"!"===n[1]?"alt+shift+".concat(n[2]):"alt+".concat(n[1]):"$"===n[0]?"!"===n[1]?"cmd+shift+".concat(n[2],",ctrl+shift+").concat(n[2]):"?"===n[1]?"cmd+\u2325+".concat(n[2],",ctrl+alt+").concat(n[2]):"cmd+".concat(n[1],",ctrl+").concat(n[1]):e,t})).join(",")}function hV(e){return e.menus.hasAnyOpenMenus()||null!==e.getEditingShapeId()||e.getCrashingError()}const pV=(0,e.createContext)(!1);function fV(t){let{children:n}=t;const o=Ns(),r=As(),i=kj(),s=rE(),a=Math.min(8,5+i),[l,c]=(0,e.useState)(0),d=(0,e.useRef)(null),[u,h]=(0,e.useState)(null),p=(0,e.useMemo)((()=>{const e=u?':not([data-value="'.concat(u,'"])'):"";return"\n\t\t\t#".concat(r,"_main > *:nth-child(n + ").concat(a+(u?1:2),")").concat(e," {\n\t\t\t\tdisplay: none;\n\t\t\t}\n\t\t\t#").concat(r,"_more > *:nth-child(-n + ").concat(a,") {\n\t\t\t\tdisplay: none;\n\t\t\t}\n        ")}),[u,r,a]),f=Ph((()=>{if(!d.current)return;const e=Array.from(d.current.children);c(e.length);e.findIndex((e=>e.getAttribute("data-value")===u))<=a&&h(null);const t=Array.from(d.current.children).findIndex((e=>"true"===e.getAttribute("aria-checked")));-1!==t&&t>=a&&h(e[t].getAttribute("data-value"))}));return(0,e.useLayoutEffect)((()=>{f()})),(0,e.useLayoutEffect)((()=>{if(!d.current)return;const e=new MutationObserver(f);return e.observe(d.current,{childList:!0,subtree:!0,attributeFilter:["data-value","aria-checked"]}),()=>{e.disconnect()}}),[f]),(0,e.useEffect)((()=>{const e=[["1",0],["2",1],["3",2],["4",3],["5",4],["6",5],["7",6],["8",7],["9",8],["0",9]];for(const[t,n]of e)aV(t,(e=>{var t,r;if(hV(o))return;Da(e);const i=Array.from(null!==(t=null===(r=d.current)||void 0===r?void 0:r.children)&&void 0!==t?t:[]).filter((e=>e instanceof HTMLElement&&("button"===e.tagName.toLowerCase()&&!(!e.offsetWidth&&!e.offsetHeight))))[n];i&&i.click()}));return()=>{aV.unbind("1,2,3,4,5,6,7,8,9,0")}}),[o]),(0,Ss.jsxs)(Ss.Fragment,{children:[(0,Ss.jsx)("style",{children:p}),(0,Ss.jsxs)("div",{className:ks("tlui-toolbar__tools",{"tlui-toolbar__tools__mobile":i<wj.TABLET_SM}),role:"radiogroup",children:[(0,Ss.jsx)("div",{id:"".concat(r,"_main"),ref:d,className:"tlui-toolbar__tools__list",children:(0,Ss.jsx)(tA,{type:"toolbar",sourceId:"toolbar",children:n})}),l>a+1&&(0,Ss.jsx)(pV.Provider,{value:!0,children:(0,Ss.jsxs)(iA,{id:"toolbar overflow",modal:!1,children:[(0,Ss.jsx)(sA,{children:(0,Ss.jsx)(sE,{title:s("tool-panel.more"),type:"tool",className:"tlui-toolbar__overflow","data-testid":"tools.more-button",children:(0,Ss.jsx)(ej,{icon:"chevron-up"})})}),(0,Ss.jsx)(aA,{side:"top",align:"center",children:(0,Ss.jsx)("div",{className:"tlui-buttons__grid","data-testid":"tools.more-content",id:"".concat(r,"_more"),children:(0,Ss.jsx)(tA,{type:"toolbar-overflow",sourceId:"toolbar",children:n})})})]})})]})]})}function gV(e){let{activeToolId:t}=e;const n=Ns(),o=kj(),r=rE(),i=yn("is tool locked",(()=>n.getInstanceState().isToolLocked),[n]),s=yn("current tool",(()=>n.getCurrentTool()),[n]);return t&&s.isLockable?(0,Ss.jsx)(sE,{type:"normal",title:r("action.toggle-tool-lock"),"data-testid":"tool-lock",className:ks("tlui-toolbar__lock-button",{"tlui-toolbar__lock-button__mobile":o<wj.TABLET_SM}),onClick:()=>n.updateInstanceState({isToolLocked:!i}),children:(0,Ss.jsx)(ej,{icon:i?"lock":"unlock",small:!0})}):null}const mV=(0,e.memo)((function(t){let{children:n}=t;const o=Ns(),r=kj(),i=YM(),s=yn("current tool id",(()=>o.getCurrentToolId()),[o]),a=(0,e.useRef)(null);cb(a);const{ActionsMenu:l,QuickActions:c}=CV(),d="menu"!==o.options.actionShortcutsLocation&&("toolbar"===o.options.actionShortcutsLocation||r<wj.TABLET);return(0,Ss.jsx)("div",{ref:a,className:"tlui-toolbar",children:(0,Ss.jsxs)("div",{className:"tlui-toolbar__inner",children:[(0,Ss.jsxs)("div",{className:"tlui-toolbar__left",children:[!i&&(0,Ss.jsxs)("div",{className:"tlui-toolbar__extras",children:[d&&(0,Ss.jsxs)("div",{className:"tlui-toolbar__extras__controls tlui-buttons__horizontal",children:[c&&(0,Ss.jsx)(c,{}),l&&(0,Ss.jsx)(l,{})]}),(0,Ss.jsx)(gV,{activeToolId:s})]}),(0,Ss.jsx)(fV,{children:null!==n&&void 0!==n?n:(0,Ss.jsx)(cK,{})})]}),r<wj.TABLET_SM&&!i&&(0,Ss.jsx)("div",{className:"tlui-toolbar__tools",children:(0,Ss.jsx)(lK,{})})]})})}));function yV(){const e=rE();return(0,Ss.jsxs)("div",{className:ks("tlui-offline-indicator"),children:[e("status.offline"),(0,Ss.jsx)(JE,{"aria-label":"offline",icon:"status-offline",small:!0})]})}function vV(t){let{maxWidth:n=420,ignoreRightWidth:o=0,stylePanelWidth:r=148,marginBetweenZones:i=12,squeezeAmount:s=52,children:a}=t;const l=(0,e.useRef)(null),c=kj(),d=(0,e.useCallback)((()=>{const e=l.current;if(!e)return;const t=e.parentElement.parentElement,a=t.querySelector(".tlui-layout__top__left"),d=t.querySelector(".tlui-layout__top__right"),u=t.offsetWidth,h=a.offsetWidth,p=d.offsetWidth;let f=(u-(e.offsetWidth-o))/2;u%2!==0&&(f-=.5);const g=h+i,m=e.offsetLeft,y=Math.min(u-p-h-2*i,n),v=Math.max(f,g)-m;d.offsetWidth>r&&c<=6?e.style.setProperty("max-width",y-s+"px"):e.style.setProperty("max-width",y+"px"),e.style.setProperty("transform","translate(".concat(v,"px, 0px)"))}),[c,o,i,n,s,r]);return(0,e.useLayoutEffect)((()=>{const e=l.current;if(!e)return;const t=e.parentElement.parentElement,n=t.querySelector(".tlui-layout__top__left"),o=t.querySelector(".tlui-layout__top__right"),r=new ResizeObserver(d);return r.observe(n),r.observe(o),r.observe(t),r.observe(e),d(),()=>{r.disconnect()}}),[d]),(0,e.useLayoutEffect)((()=>{d()})),(0,Ss.jsx)("div",{ref:l,className:"tlui-top-panel__container",children:a})}function bV(){const e="offline"===function(){const e=Fs();return yn("sync status",(()=>{var t;return null!==e&&void 0!==e&&null!==(t=e.store.props.collaboration)&&void 0!==t&&t.status?e.store.props.collaboration.status.get():null}),[e])}();return(0,Ss.jsx)(vV,{children:e&&(0,Ss.jsx)(yV,{})})}function wV(){return(0,Ss.jsxs)(Ss.Fragment,{children:[(0,Ss.jsx)(EA,{actionId:"zoom-in",noClose:!0}),(0,Ss.jsx)(EA,{actionId:"zoom-out",noClose:!0}),(0,Ss.jsx)(GF,{}),(0,Ss.jsx)(XF,{}),(0,Ss.jsx)($F,{})]})}const xV=(0,e.memo)((function(e){let{children:t}=e;const n=Va(),[o,r]=oA("zoom menu"),i=null!==t&&void 0!==t?t:(0,Ss.jsx)(wV,{});return(0,Ss.jsxs)(RI,{dir:"ltr",open:o,onOpenChange:r,modal:!1,children:[(0,Ss.jsx)(LI,{asChild:!0,dir:"ltr",children:(0,Ss.jsx)(SV,{})}),(0,Ss.jsx)(zI,{container:n,children:(0,Ss.jsx)(NI,{className:"tlui-menu",side:"top",align:"start",alignOffset:0,sideOffset:8,collisionPadding:4,children:(0,Ss.jsx)(tA,{type:"menu",sourceId:"zoom-menu",children:i})})})]})})),SV=(0,e.forwardRef)((function(t,n){const o=Ns(),r=kj(),i=yn("zoom",(()=>o.getZoomLevel()),[o]),s=rE(),a=(0,e.useCallback)((()=>{o.resetZoom(o.getViewportScreenCenter(),{animation:{duration:o.options.animationMediumMs}})}),[o]);return(0,Ss.jsx)(sE,l(l({ref:n},t),{},{type:"icon",title:"".concat(s("navigation-zone.zoom")),"data-testid":"minimap.zoom-menu-button",className:r<wj.TABLET_SM?"tlui-zoom-menu__button":"tlui-zoom-menu__button__pct",onDoubleClick:a,children:r<wj.MOBILE?null:(0,Ss.jsxs)("span",{style:{flexGrow:0,textAlign:"center"},children:[Math.floor(100*i),"%"]})}))})),kV=(0,e.createContext)(null);function PV(t){let{overrides:n={},children:o}=t;const r=pd(n),i=vj();return(0,Ss.jsx)(kV.Provider,{value:(0,e.useMemo)((()=>l({ContextMenu:CB,ActionsMenu:LF,HelpMenu:null,ZoomMenu:xV,MainMenu:aU,Minimap:VU,StylePanel:aK,PageMenu:XU,NavigationPanel:WU,Toolbar:mV,KeyboardShortcutsDialog:GB,QuickActions:ZU,HelperButtons:qB,DebugPanel:NB,DebugMenu:zB,MenuPanel:UB,SharePanel:i?rH:null,CursorChatBubble:i?_B:null,TopPanel:i?bV:null},r)),[r,i]),children:o})}function CV(){const t=(0,e.useContext)(kV);if(!t)throw new Error("useTldrawUiComponents must be used within a TldrawUiComponentsProvider");return t}const _V=fn((function(e){var t;let{overrides:n,components:o,assetUrls:r,onUiEvent:i,forceMobile:s,mediaMimeTypes:a,children:l}=e;const c=Fs();return(0,Ss.jsx)(zM.Provider,{value:a,children:(0,Ss.jsx)($I,{assetUrls:jN(r),children:(0,Ss.jsx)(oE,{overrides:BM(n),locale:null!==(t=null===c||void 0===c?void 0:c.user.getLocale())&&void 0!==t?t:_d.locale,children:(0,Ss.jsx)($b,{onEvent:i,children:(0,Ss.jsx)(PT,{children:(0,Ss.jsx)(Cj,{context:null===c||void 0===c?void 0:c.contextId,children:(0,Ss.jsx)(Sj,{forceMobile:s,children:(0,Ss.jsx)(PV,{overrides:o,children:c?(0,Ss.jsx)(IV,{overrides:n,children:l}):l})})})})})})})})}));function IV(e){let{overrides:t,children:n}=e;const o=UM(t);return(0,Ss.jsx)(VM,{overrides:o.actions,children:(0,Ss.jsx)(TA,{overrides:o.tools,children:n})})}const EV=["renderDebugMenuItems","children","hideUi","components"],jV=["children","hideUi"],TV=e.memo((function(e){let{renderDebugMenuItems:t,children:n,hideUi:o,components:r}=e,i=yr(e,EV);return(0,Ss.jsx)(_V,l(l({},i),{},{components:r,children:(0,Ss.jsx)(MV,{hideUi:o,renderDebugMenuItems:t,children:n})}))})),MV=e.memo((function(e){let{children:t,hideUi:n}=e,o=yr(e,jV);return(0,Ss.jsxs)(Ss.Fragment,{children:[t,n?null:(0,Ss.jsx)(AV,l({},o))]})})),AV=e.memo((function(){const t=Ns(),n=rE(),o=kj(),r=YM(),i=yn("focus",(()=>t.getInstanceState().isFocusMode),[t]),s=yn("debug",(()=>t.getInstanceState().isDebugMode),[t]),{SharePanel:a,TopPanel:l,MenuPanel:c,StylePanel:d,Toolbar:u,HelpMenu:h,NavigationPanel:p,HelperButtons:f,DebugPanel:g,CursorChatBubble:m}=CV();!function(){const t=Ns(),n=YM(),o=WM(),r=MA(),i=yn("is focused",(()=>t.getInstanceState().isFocused),[t]);(0,e.useEffect)((()=>{if(!i)return;const e=new Array,s=(t,n)=>{aV(t,{element:document.body},n),e.push((()=>{aV.unbind(t,n)}))};for(const r of Object.values(o))r.kbd&&(n&&!r.readonlyOk||dV.includes(r.id)||s(uV(r.kbd),(e=>{hV(t)||(Da(e),r.onSelect("kbd"))})));for(const n of Object.values(r))!n.kbd||!n.readonlyOk&&t.getIsReadonly()||dV.includes(n.id)||s(uV(n.kbd),(e=>{hV(t)||(Da(e),n.onSelect("kbd"))}));return s(",",(e=>{if(hV(t))return;if(t.inputs.keys.has("Comma"))return;Da(e),t.focus(),t.inputs.keys.add("Comma");const{x:n,y:o,z:r}=t.inputs.currentPagePoint,i=t.pageToScreen({x:n,y:o}),s={type:"pointer",name:"pointer_down",point:{x:i.x,y:i.y,z:r},shiftKey:e.shiftKey,altKey:e.altKey,ctrlKey:e.metaKey||e.ctrlKey,metaKey:e.metaKey,accelKey:Fa(e),pointerId:0,button:0,isPen:t.getInstanceState().isPenMode,target:"canvas"};t.dispatch(s)})),((t,n)=>{aV(t,{element:document.body,keyup:!0,keydown:!1},n),e.push((()=>{aV.unbind(t,n)}))})(",",(e=>{if(hV(t))return;if(!t.inputs.keys.has("Comma"))return;t.inputs.keys.delete("Comma");const{x:n,y:o,z:r}=t.inputs.currentScreenPoint,i={type:"pointer",name:"pointer_up",point:{x:n,y:o,z:r},shiftKey:e.shiftKey,altKey:e.altKey,ctrlKey:e.metaKey||e.ctrlKey,metaKey:e.metaKey,accelKey:Fa(e),pointerId:0,button:0,isPen:t.getInstanceState().isPenMode,target:"canvas"};t.dispatch(i)})),()=>{e.forEach((e=>e()))}}),[o,r,n,t,i])}(),rM(),function(){const t=Ns(),{addToast:n}=CT();(0,e.useEffect)((()=>{function e(e){let{name:t,count:o}=e;n({title:"Maximum Shapes Reached",description:"You've reached the maximum number of shapes allowed on ".concat(t," (").concat(o,"). Please delete some shapes or move to a different page to continue."),severity:"warning"})}return t.addListener("max-shapes",e),()=>{t.removeListener("max-shapes",e)}}),[t,n])}();const{"toggle-focus-mode":y}=WM();return(0,Ss.jsxs)("div",{className:ks("tlui-layout",{"tlui-layout__mobile":o<wj.TABLET_SM}),"data-breakpoint":o,children:[i?(0,Ss.jsx)("div",{className:"tlui-layout__top",children:(0,Ss.jsx)(sE,{type:"icon",className:"tlui-focus-button",title:n("focus-mode.toggle-focus-mode"),onClick:()=>y.onSelect("menu"),children:(0,Ss.jsx)(ej,{icon:"dot"})})}):(0,Ss.jsxs)(Ss.Fragment,{children:[(0,Ss.jsxs)("div",{className:"tlui-layout__top",children:[(0,Ss.jsxs)("div",{className:"tlui-layout__top__left",children:[c&&(0,Ss.jsx)(c,{}),f&&(0,Ss.jsx)(f,{})]}),(0,Ss.jsx)("div",{className:"tlui-layout__top__center",children:l&&(0,Ss.jsx)(l,{})}),(0,Ss.jsxs)("div",{className:"tlui-layout__top__right",children:[a&&(0,Ss.jsx)(a,{}),d&&o>=wj.TABLET_SM&&!r&&(0,Ss.jsx)(d,{})]})]}),(0,Ss.jsxs)("div",{className:"tlui-layout__bottom",children:[(0,Ss.jsxs)("div",{className:"tlui-layout__bottom__main",children:[p&&(0,Ss.jsx)(p,{}),u&&(0,Ss.jsx)(u,{}),h&&(0,Ss.jsx)(h,{})]}),s&&g&&(0,Ss.jsx)(g,{})]})]}),(0,Ss.jsx)(SA,{}),(0,Ss.jsx)(bA,{}),(0,Ss.jsx)(PN,{}),m&&(0,Ss.jsx)(m,{})]})}));const OV=(t,n)=>{const[o,r]=(0,e.useState)(2);return(0,e.useEffect)((()=>{let e=!1;return r(2),async function(e,t){const{url:n,style:o="normal",weight:r="500",display:i,featureSettings:s,stretch:a,unicodeRange:l,variant:c,format:d}=t,u={style:o,weight:r,display:i,featureSettings:s,stretch:a,unicodeRange:l,variant:c},h=new FontFace(e,"url(".concat(n,")"),u);return await h.load(),document.fonts.add(h),h.$$_url=n,h.$$_fontface="\n@font-face {\n\tfont-family: ".concat(h.family,";\n\tfont-stretch: ").concat(h.stretch,";\n\tfont-weight: ").concat(h.weight,";\n\tfont-style: ").concat(h.style,';\n\tsrc: url("').concat(n,'") format("').concat(d,'")\n}'),h}(t,n).then((()=>{e||r(0)})).catch((t=>{e||(console.error(t),r(1))})),()=>{e=!0}}),[t,n]),o};function DV(t){const n=(0,e.useMemo)((()=>function(e){return{draw:{url:e.fonts.draw,format:e.fonts.draw.split(".").pop()},serif:{url:e.fonts.serif,format:e.fonts.serif.split(".").pop()},sansSerif:{url:e.fonts.sansSerif,format:e.fonts.sansSerif.split(".").pop()},monospace:{url:e.fonts.monospace,format:e.fonts.monospace.split(".").pop()}}}(t)),[t]),o=[OV("tldraw_draw",n.draw),OV("tldraw_serif",n.serif),OV("tldraw_sans",n.sansSerif),OV("tldraw_mono",n.monospace)];return{error:o.some((e=>1===e)),done:!o.some((e=>2===e))}}const RV=["children","maxImageDimension","maxAssetSize","acceptedImageMimeTypes","acceptedVideoMimeTypes","onMount","components","shapeUtils","bindingUtils","tools","embeds"];function LV(t){const{children:n,maxImageDimension:o,maxAssetSize:r,acceptedImageMimeTypes:i,acceptedVideoMimeTypes:s,onMount:a,components:c={},shapeUtils:d=[],bindingUtils:u=[],tools:h=[],embeds:p}=t,f=yr(t,RV),g=pd(c),m=(0,e.useMemo)((()=>l({Scribble:KA,ShapeIndicators:$A,CollaboratorScribble:KA,SelectionForeground:qA,SelectionBackground:VA,Handles:DA},g)),[g]),y=ud(d),v=(0,e.useMemo)((()=>[...zL,...y]),[y]),b=ud(u),w=(0,e.useMemo)((()=>[...vO,...b]),[b]),x=ud(h),S=(0,e.useMemo)((()=>[...kN,...hD,...x]),[x]),k=ud(null!==i&&void 0!==i?i:re),P=ud(null!==s&&void 0!==s?s:ie),C=(0,e.useMemo)((()=>[...k,...P]),[k,P]),_=IN(f.assetUrls),{done:I,error:E}=DV(_);if(E)return(0,Ss.jsx)(Eb,{children:"Could not load assets. Please refresh the page."});if(!I)return(0,Ss.jsx)(Ib,{children:(0,Ss.jsx)(ad,{})});return v.find((e=>"embed"===e.type))&&p&&MR.setEmbedDefinitions(p),(0,Ss.jsx)(wb,l(l({initialState:"select"},f),{},{components:m,shapeUtils:v,bindingUtils:w,tools:S,children:(0,Ss.jsxs)(TV,l(l({},f),{},{components:m,mediaMimeTypes:C,children:[(0,Ss.jsx)(zV,{maxImageDimension:o,maxAssetSize:r,acceptedImageMimeTypes:k,acceptedVideoMimeTypes:P,onMount:a}),n]}))}))}function zV(e){let{maxImageDimension:t=5e3,maxAssetSize:n=10485760,acceptedImageMimeTypes:o=re,acceptedVideoMimeTypes:r=ie,onMount:i}=e;const s=Ns(),a=CT(),l=rE();jb((()=>{const e=[];return e.push(function(e){return e.sideEffects.register({instance_page_state:{afterChange:(t,n)=>{if(t.croppingShapeId!==n.croppingShapeId){const o=e.isIn("select.crop");!t.croppingShapeId&&n.croppingShapeId?o||e.setCurrentTool("select.crop.idle"):t.croppingShapeId&&!n.croppingShapeId&&o&&e.setCurrentTool("select.idle")}if(t.editingShapeId!==n.editingShapeId)if(!t.editingShapeId&&n.editingShapeId){if(!e.isIn("select.editing_shape")){const t=e.getEditingShape();t&&"text"===t.type&&e.isInAny("text.pointing","select.resizing")&&e.getInstanceState().isToolLocked?e.setCurrentTool("select.editing_shape",{isCreatingTextWhileToolLocked:!0}):e.setCurrentTool("select.editing_shape")}}else t.editingShapeId&&!n.editingShapeId&&e.isIn("select.editing_shape")&&e.setCurrentTool("select.idle")}}})}(s)),DO(s,{maxImageDimension:t,maxAssetSize:n,acceptedImageMimeTypes:o,acceptedVideoMimeTypes:r},{toasts:a,msg:l}),e.push(s.store.props.onMount(s)),e.push(null===i||void 0===i?void 0:i(s)),()=>{e.forEach((e=>null===e||void 0===e?void 0:e()))}}));const{Canvas:c}=md(),{ContextMenu:d}=CV();return d?(0,Ss.jsx)(d,{}):c?(0,Ss.jsx)(c,{}):null}(0,e.memo)((function(t){var n,o;const[r,i]=(0,e.useState)(null),[s,a]=(0,e.useState)(null),l=ud(null!==(n=t.shapeUtils)&&void 0!==n?n:[]),c=(0,e.useMemo)((()=>[...zL,...l]),[l]),d=ud(null!==(o=t.bindingUtils)&&void 0!==o?o:[]),u=(0,e.useMemo)((()=>[...vO,...d]),[d]),h=function(t){const[n,o]=(0,e.useState)((()=>({store:wv(t),opts:t})));if(!be(n.opts,t)){const e={store:wv(t),opts:t};return o(e),e.store}return n.store}({snapshot:t.snapshot,shapeUtils:c}),p=IN(t.assetUrls),{done:f,error:g}=DV(p),{pageId:m,bounds:y,scale:v,pixelRatio:b,background:w,padding:x,darkMode:S,preserveAspectRatio:k,format:P="svg",licenseKey:C}=t;return(0,e.useLayoutEffect)((()=>{if(!s)return;if(!h)return;if(!f)return;let e=!1;const t=document.createElement("div");s.appendChild(t),s.classList.add("tl-container","tl-theme__light");const n=new nv({store:h,shapeUtils:c,bindingUtils:u,tools:[],getContainer:()=>t,licenseKey:C});m&&n.setCurrentPage(m);const o=n.getCurrentPageShapeIds();return async function(){const t=await n.getSvgString([...o],{bounds:y,scale:v,background:w,padding:x,darkMode:S,preserveAspectRatio:k});if(t&&!e)if("svg"===P){if(!e){const e=new Blob([t.svg],{type:"image/svg+xml"}),n=URL.createObjectURL(e);i(n)}}else if("png"===P){const n=await IM(0,t.svg,{type:P,width:t.width,height:t.height,pixelRatio:b});if(n&&!e){const e=URL.createObjectURL(n);i(e)}}n.dispose()}(),()=>{e=!0}}),[P,s,h,c,u,m,y,v,w,x,S,k,f,g,C,b]),g?(0,Ss.jsx)(Eb,{children:"Could not load assets."}):f?(0,Ss.jsx)("div",{ref:a,style:{position:"relative",width:"100%",height:"100%"},children:r&&(0,Ss.jsx)("img",{src:r,referrerPolicy:"strict-origin-when-cross-origin",style:{width:"100%",height:"100%"}})}):(0,Ss.jsx)(Ib,{children:(0,Ss.jsx)(ad,{})})})),(0,e.memo)((function(t){let{children:n}=t;const o=rE(),r=kj(),i=(0,e.useRef)(null);cb(i);const s=null!==n&&void 0!==n?n:(0,Ss.jsx)($B,{});return r<wj.MOBILE?null:(0,Ss.jsx)("div",{ref:i,className:"tlui-help-menu",children:(0,Ss.jsxs)(iA,{id:"help menu",children:[(0,Ss.jsx)(sA,{children:(0,Ss.jsx)(sE,{type:"help",title:o("help-menu.title"),"data-testid":"help-menu.button",children:(0,Ss.jsx)(ej,{icon:"question-mark",small:!0})})}),(0,Ss.jsx)(aA,{side:"top",align:"end",alignOffset:0,sideOffset:8,children:(0,Ss.jsx)(tA,{type:"menu",sourceId:"help-menu",children:s})})]})})}));const NV=co({schemaVersion:so(1),storeVersion:oo,recordVersions:fo(Qn,co({version:oo,subTypeVersions:fo(Qn,oo).optional(),subTypeKey:Qn.optional()}))}),FV=co({schemaVersion:so(2),sequences:fo(Qn,oo)});co({tldrawFileFormatVersion:ro,schema:(BV="schemaVersion",UV={1:NV,2:FV},new Gn(BV,UV,((e,t)=>{throw new Hn("Expected one of ".concat(Object.keys(UV).map((e=>JSON.stringify(e))).join(" or "),", got ").concat(JSON.stringify(t)),[BV])}),!0)),records:lo(co({id:Qn,typeName:Qn}).allowUnknownProperties())});var BV,UV;u("tldraw","3.6.1","esm");const HV="put",KV="patch",VV="remove";const WV={Put:"put",Delete:"delete",Append:"append",Patch:"patch"};function qV(e,t){return YV(e,t,new Set(["props"]))}function YV(e,t,n){if(e===t)return null;let o=null;for(const r of Object.keys(e)){if(!(r in t)){o||(o={}),o[r]=[WV.Delete];continue}const i=e[r],s=t[r];if(!Cn(i,s))if(null!==n&&void 0!==n&&n.has(r)&&i&&s){const e=YV(i,s);e&&(o||(o={}),o[r]=[WV.Patch,e])}else if(Array.isArray(s)&&Array.isArray(i)){const e=XV(i,s);e&&(o||(o={}),o[r]=e)}else o||(o={}),o[r]=[WV.Put,s]}for(const r of Object.keys(t))r in e||(o||(o={}),o[r]=[WV.Put,t[r]]);return o}function GV(e,t){if(Object.is(e,t))return null;if(Array.isArray(e)&&Array.isArray(t))return XV(e,t);if(e&&t&&"object"===typeof e&&"object"===typeof t){const n=YV(e,t);return n?[WV.Patch,n]:null}return Cn(e,t)?null:[WV.Put,t]}function XV(e,t){if(Object.is(e,t))return null;if(e.length===t.length){const n=Math.max(e.length/5,1),o=[];for(let i=0;i<e.length;i++)if(!Cn(e[i],t[i])&&(o.push(i),o.length>n))return[WV.Put,t];if(0===o.length)return null;const r={};for(const i of o){const n=e[i],o=t[i];if(n&&o)if("object"===typeof n&&"object"===typeof o){const e=GV(n,o);e&&(r[i]=e)}else r[i]=[WV.Put,o];else r[i]=[WV.Put,o]}return[WV.Patch,r]}for(let n=0;n<e.length;n++)if(!Cn(e[n],t[n]))return[WV.Put,t];return[WV.Append,t.slice(e.length),e.length]}function $V(e,t){var n;if(!e||"object"!==typeof e)return e;const o=Array.isArray(e);let r;const i=(t,n)=>{r||(r=o?[...e]:l({},e)),o?r[Number(t)]=n:r[t]=n};for(const[s,a]of Object.entries(t))switch(a[0]){case WV.Put:{const t=a[1];Cn(e[s],t)||i(s,t);break}case WV.Append:{const t=a[1],n=a[2],o=e[s];Array.isArray(o)&&o.length===n&&i(s,[...o,...t]);break}case WV.Patch:if(e[s]&&"object"===typeof e[s]){const t=a[1],n=$V(e[s],t);n!==e[s]&&i(s,n)}break;case WV.Delete:s in e&&(r||(o?(console.error("Can't delete array item yet (this should never happen)"),r=[...e]):r=l({},e)),delete r[s])}return null!==(n=r)&&void 0!==n?n:e}function ZV(e,t){const n=setInterval(e,t);return()=>clearInterval(n)}const QV="NOT_FOUND",JV="FORBIDDEN",eW="NOT_AUTHENTICATED",tW="UNKNOWN_ERROR",nW="RATE_LIMITED",oW=5e3;class rW{debug(){this.isDebugging&&console.debug(...arguments)}constructor(e){var t;s(this,"lastServerClock",0),s(this,"lastServerInteractionTimestamp",Date.now()),s(this,"pendingPushRequests",[]),s(this,"speculativeChanges",{added:{},updated:{},removed:{}}),s(this,"disposables",[]),s(this,"store",void 0),s(this,"socket",void 0),s(this,"presenceState",void 0),s(this,"isConnectedToRoom",!1),s(this,"clientClock",0),s(this,"onAfterConnect",void 0),s(this,"isDebugging",!1),s(this,"presenceType",void 0),s(this,"didCancel",void 0),s(this,"latestConnectRequestId",null),s(this,"incomingDiffBuffer",[]),s(this,"lastPushedPresenceState",null),s(this,"flushPendingPushRequests",ft((()=>{if(this.debug("flushing pending push requests",{isConnectedToRoom:this.isConnectedToRoom,pendingPushRequests:this.pendingPushRequests}),this.isConnectedToRoom&&!this.store.isPossiblyCorrupted())for(const e of this.pendingPushRequests)if(!e.sent){if("online"!==this.socket.connectionStatus)return;this.socket.sendMessage(e.request),e.sent=!0}}))),s(this,"rebase",(()=>{if(this.store._flushHistory(),0===this.incomingDiffBuffer.length)return;const e=this.incomingDiffBuffer;this.incomingDiffBuffer=[];try{var t,n;this.store.mergeRemoteChanges((()=>{this.store.applyDiff(xn(this.speculativeChanges),{runCallbacks:!1});for(const n of e)if("patch"!==n.type){if(0===this.pendingPushRequests.length)throw new Error("Received push_result but there are no pending push requests");if(this.pendingPushRequests[0].request.clientClock!==n.clientClock)throw new Error("Received push_result for a push request that is not at the front of the queue");if("discard"===n.action)this.pendingPushRequests.shift();else if("commit"===n.action){const{request:e}=this.pendingPushRequests.shift();"diff"in e&&e.diff&&this.applyNetworkDiff(e.diff,!0)}else this.applyNetworkDiff(n.action.rebaseWithDiff,!0),this.pendingPushRequests.shift()}else this.applyNetworkDiff(n.diff,!0);try{this.speculativeChanges=this.store.extractingChanges((()=>{for(const{request:e}of this.pendingPushRequests)"diff"in e&&e.diff&&this.applyNetworkDiff(e.diff,!0)}))}catch(t){console.error(t),this.speculativeChanges={added:{},updated:{},removed:{}},this.resetConnection()}})),this.lastServerClock=null!==(t=null===(n=e.at(-1))||void 0===n?void 0:n.serverClock)&&void 0!==t?t:this.lastServerClock}catch(o){console.error(o),this.store.ensureStoreIsUsable(),this.resetConnection()}})),s(this,"scheduleRebase",ft(this.rebase)),this.didCancel=e.didCancel,this.presenceType=null!==(t=e.store.scopedTypes.presence.values().next().value)&&void 0!==t?t:null,"undefined"!==typeof window&&(window.tlsync=this),this.store=e.store,this.socket=e.socket,this.onAfterConnect=e.onAfterConnect;let n=!1;this.presenceState=e.presence,this.disposables.push(this.store.listen((e=>{var t;let{changes:n}=e;if(null!==(t=this.didCancel)&&void 0!==t&&t.call(this))return this.close();this.debug("received store changes",{changes:n}),this.push(n)}),{source:"user",scope:"document"}),this.socket.onReceiveMessage((t=>{var o;if(null!==(o=this.didCancel)&&void 0!==o&&o.call(this))return this.close();this.debug("received message from server",t),this.handleServerEvent(t),n||(n=!0,e.onLoad(this))})),this.socket.onStatusChange((t=>{var o;if(null!==(o=this.didCancel)&&void 0!==o&&o.call(this))return this.close();this.debug("socket status changed",t.status),"online"===t.status?this.sendConnectMessage():(this.resetConnection(),"error"===t.status&&(n=!0,e.onSyncError(t.reason),this.close()))})),ZV((()=>{var e;if(null!==(e=this.didCancel)&&void 0!==e&&e.call(this))return this.close();if(this.debug("ping loop",{isConnectedToRoom:this.isConnectedToRoom}),this.isConnectedToRoom)try{this.socket.sendMessage({type:"ping"})}catch(t){console.warn("ping failed, resetting",t),this.resetConnection()}}),oW),ZV((()=>{var e;if(null!==(e=this.didCancel)&&void 0!==e&&e.call(this))return this.close();if(this.debug("health check loop",{isConnectedToRoom:this.isConnectedToRoom}),!this.isConnectedToRoom)return;const t=Date.now()-this.lastServerInteractionTimestamp;t<1e4?this.debug("health check passed",{timeSinceLastServerInteraction:t}):(console.warn("Haven't heard from the server in a while, resetting connection..."),this.resetConnection())}),1e4)),this.presenceState&&this.disposables.push(Ht("pushPresence",(()=>{var e;if(null!==(e=this.didCancel)&&void 0!==e&&e.call(this))return this.close();this.pushPresence(this.presenceState.get())}))),"online"===this.socket.connectionStatus&&this.sendConnectMessage()}sendConnectMessage(){this.isConnectedToRoom?console.error("sendConnectMessage called while already connected"):(this.debug("sending connect message"),this.latestConnectRequestId=$(),this.socket.sendMessage({type:"connect",connectRequestId:this.latestConnectRequestId,schema:this.store.schema.serialize(),protocolVersion:7,lastServerClock:this.lastServerClock}))}resetConnection(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.debug("resetting connection"),e&&(this.lastServerClock=0),this.store.mergeRemoteChanges((()=>{this.store.remove(Object.keys(this.store.serialize("presence")))})),this.lastPushedPresenceState=null,this.isConnectedToRoom=!1,this.pendingPushRequests=[],this.incomingDiffBuffer=[],"online"===this.socket.connectionStatus&&this.socket.restart()}didReconnect(e){if(this.debug("did reconnect",e),e.connectRequestId===this.latestConnectRequestId){if(this.latestConnectRequestId=null,this.isConnectedToRoom)return console.error("didReconnect called while already connected"),void this.resetConnection(!0);if(this.pendingPushRequests.length>0)return console.error("pendingPushRequests should already be empty when we reconnect"),void this.resetConnection(!0);Xt((()=>{var t;const n=this.speculativeChanges;this.speculativeChanges={added:{},updated:{},removed:{}},this.store.mergeRemoteChanges((()=>{const t={},o="wipe_all"===e.hydrationType;o||this.store.applyDiff(xn(n),{runCallbacks:!1});for(const[e,n]of ge(this.store.serialize("all")))(o&&this.store.scopedTypes.document.has(n.typeName)||n.typeName===this.presenceType)&&(t[e]=[VV]);this.applyNetworkDiff(l(l({},t),e.diff),!0),this.isConnectedToRoom=!0;const r=this.store.filterChangesByScope(this.store.extractingChanges((()=>{this.store.applyDiff(n)})),"document");r&&this.push(r)})),null===(t=this.onAfterConnect)||void 0===t||t.call(this,this,{isReadonly:e.isReadonly})})),this.lastServerClock=e.serverClock}}handleServerEvent(e){switch(this.debug("received server event",e),this.lastServerInteractionTimestamp=Date.now(),e.type){case"connect":this.didReconnect(e);break;case"patch":case"push_result":if(!this.isConnectedToRoom)break;this.incomingDiffBuffer.push(e),this.scheduleRebase();break;case"data":if(!this.isConnectedToRoom)break;this.incomingDiffBuffer.push(...e.data),this.scheduleRebase();break;case"incompatibility_error":console.error("incompatibility error is legacy and should no longer be sent by the server");break;case"pong":break;default:T(e)}}close(){var e,t,n,o;this.debug("closing"),this.disposables.forEach((e=>e())),null===(e=(t=this.flushPendingPushRequests).cancel)||void 0===e||e.call(t),null===(n=(o=this.scheduleRebase).cancel)||void 0===n||n.call(o)}pushPresence(e){if(this.store._flushHistory(),!this.isConnectedToRoom)return;let t;if(!this.lastPushedPresenceState&&e)t=[HV,e];else if(this.lastPushedPresenceState&&e){const n=qV(this.lastPushedPresenceState,e);n&&(t=[KV,n])}if(!t)return;this.lastPushedPresenceState=e;const n=this.pendingPushRequests.at(-1);if(n&&!n.sent&&!n.request.presence)return void(n.request.presence=t);const o={type:"push",clientClock:this.clientClock++,presence:t};o&&(this.pendingPushRequests.push({request:o,sent:!1}),this.flushPendingPushRequests())}push(e){this.debug("push",e);const t=function(e){let t=null;for(const[n,o]of ge(e.added))t||(t={}),t[n]=[HV,o];for(const[n,o]of fe(e.updated)){const e=qV(n,o);e&&(t||(t={}),t[o.id]=[KV,e])}for(const n of Object.keys(e.removed))t||(t={}),t[n]=[VV];return t}(e);if(!t)return;if(this.speculativeChanges=kn([this.speculativeChanges,e]),!this.isConnectedToRoom)return;const n={type:"push",diff:t,clientClock:this.clientClock++};this.pendingPushRequests.push({request:n,sent:!1}),this.flushPendingPushRequests()}applyNetworkDiff(e,t){this.debug("applyNetworkDiff",e);const n={added:{},updated:{},removed:{}};let o=!1;for(const[r,i]of ge(e))if(i[0]===HV){const e=this.store.get(r);e&&!Cn(e,i[1])?(o=!0,n.updated[r]=[e,i[1]]):(o=!0,n.added[r]=i[1])}else if(i[0]===KV){const e=this.store.get(r);if(!e)continue;const t=$V(e,i[1]);o=!0,n.updated[r]=[e,t]}else i[0]===VV&&this.store.has(r)&&(o=!0,n.removed[r]=this.store.get(r));o&&this.store.applyDiff(n,{runCallbacks:t})}}function iW(e,t,n){return e.addEventListener(t,n),()=>{e.removeEventListener(t,n)}}function sW(){if("undefined"!==typeof window&&window.__tldraw_socket_debug){const o=new Date;for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];console.log("".concat(o.getHours(),":").concat(o.getMinutes(),":").concat(o.getSeconds(),".").concat(o.getMilliseconds()),...t)}}class aW{close(){var e;this.isDisposed=!0,this._reconnectManager.close(),null===(e=this._ws)||void 0===e||e.close()}constructor(e){s(this,"_ws",null),s(this,"isDisposed",!1),s(this,"_reconnectManager",void 0),s(this,"_connectionStatus",Qt("websocket connection status","initial")),s(this,"messageListeners",new Set),s(this,"statusListeners",new Set),this._reconnectManager=new cW(this,e)}_handleConnect(){sW("handleConnect"),this._connectionStatus.set("online"),this.statusListeners.forEach((e=>e({status:"online"}))),this._reconnectManager.connected()}_handleDisconnect(e,t,n,o){let r;switch(o=o||tW,sW("handleDisconnect",{currentStatus:this.connectionStatus,closeCode:t,reason:e}),e){case"closed":r=4099===t?"error":"offline";break;case"manual":r="offline"}1006!==t||n||St("Could not open WebSocket connection. This might be because you're trying to load a URL that doesn't support websockets. Check the URL you're trying to connect to."),this.connectionStatus===r||"error"===r&&"offline"===this.connectionStatus||(this._connectionStatus.set(r),this.statusListeners.forEach((e=>e("error"===r?{status:"error",reason:o}:{status:r})))),this._reconnectManager.disconnected()}_setNewSocket(e){var t;M(!this.isDisposed,"Tried to set a new websocket on a disposed socket"),M(null===this._ws||this._ws.readyState===WebSocket.CLOSED||this._ws.readyState===WebSocket.CLOSING,"Tried to set a new websocket in when the existing one was ".concat(null===(t=this._ws)||void 0===t?void 0:t.readyState));let n=!1;e.onopen=()=>{sW("ws.onopen"),M(this._ws===e,"sockets must only be orphaned when they are CLOSING or CLOSED, so they can't open"),n=!0,this._handleConnect()},e.onclose=t=>{sW("ws.onclose",t),this._ws===e?this._handleDisconnect("closed",t.code,n,t.reason):sW("ignoring onclose for an orphaned socket")},e.onerror=t=>{sW("ws.onerror",t),this._ws===e?this._handleDisconnect("closed"):sW("ignoring onerror for an orphaned socket")},e.onmessage=t=>{M(this._ws===e,"sockets must only be orphaned when they are CLOSING or CLOSED, so they can't receive messages");const n=JSON.parse(t.data.toString());this.messageListeners.forEach((e=>e(n)))},this._ws=e}_closeSocket(){null!==this._ws&&(this._ws.close(),this._ws=null,this._handleDisconnect("manual"))}get connectionStatus(){const e=this._connectionStatus.get();return"initial"===e?"offline":e}sendMessage(e){if(M(!this.isDisposed,"Tried to send message on a disposed socket"),this._ws)if("online"===this.connectionStatus){const t=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:262144;if(e.length<t)return[e];{const n=[];let o=0,r=e.length;for(;r>0;){const i="".concat(o,"_"),s=Math.max(Math.min(t-i.length,r),1);n.unshift(i+e.slice(r-s,r)),r-=s,o++}return n}}(JSON.stringify(e));for(const e of t)this._ws.send(e)}else console.warn("Tried to send message while "+this.connectionStatus)}onReceiveMessage(e){return M(!this.isDisposed,"Tried to add message listener on a disposed socket"),this.messageListeners.add(e),()=>{this.messageListeners.delete(e)}}onStatusChange(e){return M(!this.isDisposed,"Tried to add status listener on a disposed socket"),this.statusListeners.add(e),()=>{this.statusListeners.delete(e)}}restart(){M(!this.isDisposed,"Tried to restart a disposed socket"),sW("restarting"),this._closeSocket(),this._reconnectManager.maybeReconnected()}}const lW=500;class cW{constructor(e,t){s(this,"isDisposed",!1),s(this,"disposables",[()=>{this.reconnectTimeout&&clearTimeout(this.reconnectTimeout),this.recheckConnectingTimeout&&clearTimeout(this.recheckConnectingTimeout)}]),s(this,"reconnectTimeout",null),s(this,"recheckConnectingTimeout",null),s(this,"lastAttemptStart",null),s(this,"intendedDelay",lW),s(this,"state",void 0),this.socketAdapter=e,this.getUri=t,this.subscribeToReconnectHints(),this.disposables.push(iW(window,"offline",(()=>{sW("window went offline"),this.socketAdapter._closeSocket()}))),this.state="pendingAttempt",this.intendedDelay=lW,this.scheduleAttempt()}subscribeToReconnectHints(){if(this.disposables.push(iW(window,"online",(()=>{sW("window went online"),this.maybeReconnected()})),iW(document,"visibilitychange",(()=>{document.hidden||(sW("document became visible"),this.maybeReconnected())}))),Object.prototype.hasOwnProperty.call(navigator,"connection")){const e=navigator.connection;this.disposables.push(iW(e,"change",(()=>{sW("navigator.connection change"),this.maybeReconnected()})))}}scheduleAttempt(){M("pendingAttempt"===this.state),sW("scheduling a connection attempt"),Promise.resolve(this.getUri()).then((e=>{var t;"pendingAttempt"!==this.state||this.isDisposed||(M((null===(t=this.socketAdapter._ws)||void 0===t?void 0:t.readyState)!==WebSocket.OPEN,"There should be no connection attempts while already connected"),this.lastAttemptStart=Date.now(),this.socketAdapter._setNewSocket(new WebSocket(e.replace(/^http(s)?:/,"ws$1:"))),this.state="pendingAttemptResult")}))}getMaxDelay(){return document.hidden?3e5:2e3}getMinDelay(){return document.hidden?1e3:lW}clearReconnectTimeout(){this.reconnectTimeout&&(clearTimeout(this.reconnectTimeout),this.reconnectTimeout=null)}clearRecheckConnectingTimeout(){this.recheckConnectingTimeout&&(clearTimeout(this.recheckConnectingTimeout),this.recheckConnectingTimeout=null)}maybeReconnected(){var e,t;if(sW("ReconnectManager.maybeReconnected"),this.clearRecheckConnectingTimeout(),(null===(e=this.socketAdapter._ws)||void 0===e?void 0:e.readyState)!==WebSocket.OPEN)if((null===(t=this.socketAdapter._ws)||void 0===t?void 0:t.readyState)!==WebSocket.CONNECTING)sW("ReconnectManager.maybeReconnected: closing/closed/null, retry now"),this.intendedDelay=lW,this.disconnected();else{sW("ReconnectManager.maybeReconnected: connecting"),M(this.lastAttemptStart,"ReadyState=CONNECTING without lastAttemptStart should be impossible");const e=Date.now()-this.lastAttemptStart;e<1e3?(sW("ReconnectManager.maybeReconnected: connecting, rechecking later"),this.recheckConnectingTimeout=setTimeout((()=>this.maybeReconnected()),1e3-e)):(sW("ReconnectManager.maybeReconnected: connecting, but for too long, retry now"),this.clearRecheckConnectingTimeout(),this.socketAdapter._closeSocket())}else sW("ReconnectManager.maybeReconnected: already connected")}disconnected(){var e,t;if(sW("ReconnectManager.disconnected"),(null===(e=this.socketAdapter._ws)||void 0===e?void 0:e.readyState)!==WebSocket.OPEN&&(null===(t=this.socketAdapter._ws)||void 0===t?void 0:t.readyState)!==WebSocket.CONNECTING){let e;sW("ReconnectManager.disconnected: websocket is not OPEN or CONNECTING"),this.clearReconnectTimeout(),"connected"===this.state?(this.intendedDelay=this.getMinDelay(),e=this.intendedDelay):e=null!==this.lastAttemptStart?this.lastAttemptStart+this.intendedDelay-Date.now():0,e>0?(sW("ReconnectManager.disconnected: delaying, delayLeft",e),this.state="delay",this.reconnectTimeout=setTimeout((()=>this.disconnected()),e)):(this.state="pendingAttempt",this.intendedDelay=Math.min(this.getMaxDelay(),1.5*Math.max(this.getMinDelay(),this.intendedDelay)),sW("ReconnectManager.disconnected: attempting a connection, next delay",this.intendedDelay),this.scheduleAttempt())}}connected(){var e;sW("ReconnectManager.connected"),(null===(e=this.socketAdapter._ws)||void 0===e?void 0:e.readyState)===WebSocket.OPEN&&(sW("ReconnectManager.connected: websocket is OPEN"),this.state="connected",this.clearReconnectTimeout(),this.intendedDelay=lW)}close(){this.disposables.forEach((e=>e())),this.isDisposed=!0}}class dW extends Error{constructor(e){super("sync error: ".concat(e)),s(this,"name","RemoteSyncError"),this.reason=e}}u("@tldraw/sync-core","3.6.1","esm");const uW=["uri","roomId","assets","onMount","trackAnalyticsEvent","userInfo"],hW="multiplayer.client";function pW(t){const[n,o]=Zv(null),{uri:r,roomId:i="default",assets:s,onMount:a,trackAnalyticsEvent:l,userInfo:c}=t,d=function(t){const[n,o]=(0,e.useState)((()=>({opts:t,schema:bv(t)})));if(!be(n.opts,t)){const e=bv(t);return o({opts:t,schema:e}),e}return n.schema}(yr(t,uW)),u=pd(c),h=gn("userAtom",u);return(0,e.useEffect)((()=>{h.set(u)}),[u,h]),(0,e.useEffect)((()=>{const e=$(),t=cn("userPreferences",(()=>{var e,t,n;const o=h.get(),r=null!==(e=(i=o)instanceof Zt||i instanceof sn?o.get():o)&&void 0!==e?e:Ld();var i;return{id:r.id,color:null!==(t=r.color)&&void 0!==t?t:_d.color,name:null!==(n=r.name)&&void 0!==n?n:_d.name}})),n=new aW((async()=>{const t="string"===typeof r?r:await r(),n=new URL(t);if(n.searchParams.has("sessionId"))throw new Error('useSync. "sessionId" is a reserved query param name. Please use a different name');if(n.searchParams.has("storeId"))throw new Error('useSync. "storeId" is a reserved query param name. Please use a different name');return n.searchParams.set("sessionId",Vd),n.searchParams.set("storeId",e),n.toString()}));let c=!1;const u=cn("collaboration status",(()=>"error"===n.connectionStatus?"offline":n.connectionStatus)),p=Qt("sync mode","readwrite"),f=wv({id:e,schema:d,assets:s,onMount:a,collaboration:{status:u,mode:p}}),g=new rW({store:f,socket:n,didCancel:()=>c,onLoad(e){null===l||void 0===l||l(hW,{name:"load",roomId:i}),o({readyClient:e})},onSyncError(e){switch(console.error("sync error",e),e){case QV:null===l||void 0===l||l(hW,{name:"room-not-found",roomId:i});break;case JV:null===l||void 0===l||l(hW,{name:"forbidden",roomId:i});break;case eW:null===l||void 0===l||l(hW,{name:"not-authenticated",roomId:i});break;case nW:null===l||void 0===l||l(hW,{name:"rate-limited",roomId:i});break;default:null===l||void 0===l||l(hW,{name:"sync-error:"+e,roomId:i})}o({error:new dW(e)}),n.close()},onAfterConnect(e,t){let{isReadonly:n}=t;Xt((()=>{p.set(n?"readonly":"readwrite"),f.ensureStoreIsUsable()}))},presence:(m=t,e=>cn("instancePresence",(()=>{const t=e.get(Wr),n=e.get(Xr.createId(null===t||void 0===t?void 0:t.currentPageId)),o=e.get(mr.createId(null===t||void 0===t?void 0:t.currentPageId)),r=e.get(Jr),i=m.get();return n&&t&&o&&r&&i?oi.create({id:null!==y&&void 0!==y?y:oi.createId(e.id),selectedShapeIds:n.selectedShapeIds,brush:t.brush,scribbles:t.scribbles,userId:i.id,userName:i.name,followingUserId:t.followingUserId,camera:{x:o.x,y:o.y,z:o.z},color:i.color,currentPageId:t.currentPageId,cursor:{x:r.x,y:r.y,rotation:t.cursor.rotation,type:t.cursor.type},lastActivityTimestamp:r.lastActivityTimestamp,screenBounds:t.screenBounds,chatMessage:t.chatMessage,meta:{}}):null})))(f)});var m,y;return()=>{c=!0,g.close(),n.close(),o(null)}}),[s,a,h,i,d,o,l,r]),yn("remote synced store",(()=>{if(!n)return{status:"loading"};if(n.error)return{status:"error",error:n.error};if(!n.readyClient)return{status:"loading"};const e=n.readyClient.socket.connectionStatus;return{status:"synced-remote",connectionStatus:"error"===e?"offline":e,store:n.readyClient.store}}),[n])}const fW=["roomId","userInfo","host"];var gW,mW;function yW(e){try{return e()}catch(t){return}}const vW=null!==(gW=yW((()=>"https://demo.tldraw.xyz")))&&void 0!==gW?gW:"https://demo.tldraw.xyz",bW=null!==(mW=yW((()=>({NODE_ENV:"production",PUBLIC_URL:"/whiteboard",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.TLDRAW_IMAGE_URL))))&&void 0!==mW?mW:"https://images.tldraw.xyz";function wW(t){const{roomId:n,userInfo:o,host:r=vW}=t,i=yr(t,fW),s=(0,e.useMemo)((()=>function(e){return{upload:async(t,n)=>{const o=$(),r="".concat(o,"-").concat(n.name).replace(/\W/g,"-"),i="".concat(e,"/uploads/").concat(r);return await fetch(i,{method:"POST",body:n}),i},resolve(t,n){if(!t.props.src)return null;if("video"===t.type)return t.props.src;if("image"!==t.type)return null;if(!t.props.src.startsWith("http:")&&!t.props.src.startsWith("https:"))return t.props.src;if(n.shouldResolveToOriginal)return t.props.src;if(ae.isAnimatedImageType(null===t||void 0===t?void 0:t.props.mimeType)||t.props.isAnimated)return t.props.src;if(ae.isVectorImageType(null===t||void 0===t?void 0:t.props.mimeType))return t.props.src;const o=new URL(t.props.src);if(!(o.origin===e||/\.tldraw\.(?:com|xyz|dev|workers\.dev)$/.test(o.host)))return t.props.src;const{fileSize:r=0}=t.props;if(r>=1572864){const e=n.networkEffectiveType&&"4g"!==n.networkEffectiveType?.5:1,r=Math.ceil(Math.min(t.props.w*n.steppedScreenScale*e*n.dpr,t.props.w));o.searchParams.set("w",r.toString())}return"".concat(bW,"/").concat(o.host,"/").concat(o.toString().slice(o.origin.length+1))}}}(r)),[r]),a=pd(i),c=(0,e.useMemo)((()=>{var e,t;return"schema"in a&&a.schema?a:l(l({},a),{},{shapeUtils:"shapeUtils"in a?[...zL,...null!==(e=a.shapeUtils)&&void 0!==e?e:[]]:zL,bindingUtils:"bindingUtils"in a?[...vO,...null!==(t=a.bindingUtils)&&void 0!==t?t:[]]:vO})}),[a]);return pW(l({uri:"".concat(r,"/connect/").concat(encodeURIComponent(n)),roomId:n,userInfo:o,assets:s,onMount:(0,e.useCallback)((e=>{e.registerExternalAssetHandler("url",(async e=>{let{url:t}=e;return await async function(e,t){const n=K(t);try{var o,r,i,s;const a=new URL("".concat(e,"/bookmarks/unfurl"));a.searchParams.set("url",t);const l=await(await fetch(a,{method:"POST"})).json();return{id:Pi.createId(n),typeName:"asset",type:"bookmark",props:{src:t,description:null!==(o=null===l||void 0===l?void 0:l.description)&&void 0!==o?o:"",image:null!==(r=null===l||void 0===l?void 0:l.image)&&void 0!==r?r:"",favicon:null!==(i=null===l||void 0===l?void 0:l.favicon)&&void 0!==i?i:"",title:null!==(s=null===l||void 0===l?void 0:l.title)&&void 0!==s?s:""},meta:{}}}catch(a){return console.error(a),{id:Pi.createId(n),typeName:"asset",type:"bookmark",props:{src:t,description:"",image:"",favicon:"",title:""},meta:{}}}}(r,t)}))}),[r])},c))}u("@tldraw/sync","3.6.1","esm");class xW extends gm{onEnter(){this.editor.setCursor({type:"cross",rotation:0})}onPointerDown(){const{currentPagePoint:e}=this.editor.inputs;this.editor.createShape({type:"text",x:e.x-12,y:e.y-12,props:{text:"\u2764\ufe0f"}})}}xW.id="sticker";const SW={tools:(e,t)=>(t.sticker={id:"sticker",icon:"heart-icon",label:"sticker",kbd:"s",onSelect:()=>{e.setCurrentTool("sticker")}},t)},kW={Toolbar:e=>{const t=MA(),n=dK(t.sticker);return(0,Ss.jsxs)(mV,l(l({},e),{},{children:[(0,Ss.jsx)(_A,l(l({},t.sticker),{},{isSelected:n})),(0,Ss.jsx)(cK,{})]}))},KeyboardShortcutsDialog:e=>{const t=MA();return(0,Ss.jsxs)(GB,l(l({},e),{},{children:[(0,Ss.jsx)(YB,{}),(0,Ss.jsx)(_A,l({},t.sticker))]}))}},PW={icons:{"heart-icon":"/heart-431.svg"}},CW=[xW];const _W=function(){console.log("render");const{store:e}=wW({roomId:"1231234345345"});return(0,Ss.jsx)(Ss.Fragment,{children:(0,Ss.jsx)("div",{className:"tldraw__editor",style:{position:"fixed",inset:0},children:(0,Ss.jsx)(LV,{components:kW,tools:CW,overrides:SW,assetsUrls:PW,initialState:"sticker",store:e})})})},IW=e=>{e&&e instanceof Function&&n.e(488).then(n.bind(n,2488)).then((t=>{let{getCLS:n,getFID:o,getFCP:r,getLCP:i,getTTFB:s}=t;n(e),o(e),r(e),i(e),s(e)}))};o.createRoot(document.getElementById("root")).render((0,Ss.jsx)(e.StrictMode,{children:(0,Ss.jsx)(_W,{})})),IW()})()})();
//# sourceMappingURL=main.b8072b35.js.map